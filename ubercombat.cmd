## debug 10
var version 7.5.5
# Updated 3/17/22
#######################################################################################################################
#######################################################################################################################
#######################################################################################################################
#  UBER COMBAT - The Ultimate Combat Script for Genie3
#  Shroom of TF - Discord: Shroom#0046
#  Â© 2021 Author: Chris Sansalone - All rights reserved. Not for resale or distribution without author's consent.
#  Unauthorized distribution without the owner's consent will result in ban of account up to and including legal litigation.

# This Licensed Software contains material that is protected by United States copyright and trade secret law. All rights not expressly granted to Licensee under this Agreement are expressly reserved by Licensor and its licensors. All copyrights, patents, trade secrets, trademarks, service marks, trade names, moral rights and other intellectual property and proprietary rights in the Licensed Software shall remain the sole and exclusive property of Licensor or its licensors, as applicable.
#######################################################################################################################
#######################################################################################################################
#######################################################################################################################
#
# LATEST SCRIPT VERSIONS LISTED BELOW
# VARS / BUFFS FILES ARE ~ABSOLUTELY MANDATORY~
# ubercombat-vars.inc - v 6.4.1
# ubercombat-buffs.inc - v 1.5

## DISARM IS MANDATORY IF DISARMING
# Disarm - v 11.9
# disarm-vars.inc v 1.1

### WEAPON AND LINK ARE COMPLETELY OPTIONAL (BUT NEEDED IF USING GUI OPTION)
# ubercombat-weapon.inc - v 1.1
# ubercombat-link.inc - v 1.1
#
###########################################################################################################
#  Send any bug reports/feedback to: skultamaphon@gmail.com / Shroom#0046 - Discord
# IMPORTANT!! - IF YOU WANT TO RE-SETUP THE "AUTOMATIC MANA" SETTINGS FOR BUFFS -
# EVERY ONCE IN A WHILE RUN THE SCRIPT WITH "  .uber SETUP  " -
# THIS WILL RE-DISCERN ALL YOUR BUFF & OFFENSE SPELLS AND RECALCULATE THE MANA AMOUNTS FOR SMART MANA
# RUN THIS WHENEVER CHANGING SPELLS AROUND, OR EVERY 50-100 RANKS OF MAGIC
############################################################################################################
# ~ SPECIAL STARTUP COMMANDS ~
#
#  .uber SETUP ( Resets all your saved Mana variables for spells and re-discerns and sets up all your spells fresh )
#  .uber SETUP whenever you change spells around or every once in a while as you gain in skill to reset mana levels
#  .uber SPELL (Similar to SETUP - but only resets the ATTACK SPELLS mana, but NOT the saved mana for BUFFS.)
#
#  .uber QUICK (For starting the script QUICKLY - Skips the initial BUFFING routine, ARMOR CHECK (assumes you have your armor on) and other initial checks to make statup much faster)
#  .uber FIGHT (STARTS COMBAT IN THE ROOM YOU LAUNCH IN! Similar7to QUICK - EXCEPT DOES NOT USE AUTO-FIND CRITTER and ~DOES~ BUFF  )
#  .uber INVASION ( START COMBAT IN CURRENT ROOM - FIGHTS WITH HIGHEST WEAPON - SIMILAR TO FIGHT )
#  .uber HEAL  (Starts script and immediately jumps to ESCAPING FROM COMBAT - HEALING routine / TOWN RUN )
#  .uber TOWN  (Start script and jump straight to TOWN RUN - SKIPS OVER HEALING!!!! )
#  .uber SELL  (Start script and jump straight to SELLING GEMS/SKINS etc in town )
#  .uber MAIN  (If doing backtraining, this will start script and skip straight to MAIN combat creature first instead of Backtrain creature, for the first loop)
#  .uber NOOB ( For total NOOBS - Sits in one room and does basic training/listening to class)
#  .uber HEALBOT ( EMPATH HEALBOT MODE - Sits in single room and HEALS PLAYERS THAT LEAN )
#  .uber RITUAL ( FOR CLERICS - Start and immediately starts Cleric Rituals )
#
#  TESTING/TROUBLESHOOTING STARTUP COMMANDS
#  .uber DEBUG  (Starts script with debug 5 enabled from the beginning - useful for debugging startup / variable issues )
#  .uber JUMP <LABEL>   (Starts script and immediately jumps to specified LABEL in script, automatically turns ON debug mode)
#  .uber SKIP <LABEL>   (Same as JUMP - Starts and jumps to specified LABEL in script, except DOES NOT turn on debug)
############################################################################################################
# SPECIAL SCRIPT TRIGGERS
# TYPE THESE COMMANDS INTO GENIE WHILE SCRIPT IS RUNNING
#  WEAPON SWAP!  - When used during COMBAT, will stop training current weapon and switch to next weapon
#  TOWN RUN!     - When used during COMBAT, will escape from combat and initiate town run
#  MAGIC SWAP!   - When used during COMBAT, will skip to your next spell on the next rotation
#
#  SKIP!         - When used during TOWN RUN, will abort current module and skip to the next module
#  SKIPALL!      - When used during TOWN RUN, will abort current module and skip to end of town run and return back to combat
############################################################################################################
#
#  This Script is made to be as fast and efficient as humanly possible - SUPER AFK FRIENDLY!
#  Made to be as AUTOMATED as possible to handle ALMOST EVERY POSSIBLE SITUATION FOR EVERY GUILD
#  Trains as many weapon as you want. Super easy setup! Simply Set all your variables in ubercombat-vars.inc
#  NO NEED TO EDIT THIS SCRIPT (ubercombat.cmd) AT ALL (except for the variables ABOVE THIS (not neccessary)
#
#  - AUTOMATIC CRITTER PROGRESSION - Simply Set what Mode to Hunt in and it will choose your combat creature based on ranks!!
#  - AUTOMATICALLY MOVES TO ALMOST ANY COMBAT CREATURE IN THE GAME - JUST SET THE "COMBAT.CRITTER" VARIABLE
#  - Trains ALL weapons evenly and intelligently, training from the lowest weapons to the highest.
#  - Handles all Guild Specific combat moves and special abilities
#  - Handles all Magics and has extremely robust support for many different spells
#  - Automatically sets the optimal mana for buffs the first time you run it
#  - Can choose your own mana amount for Attack Spells, or let the script set it automatically!
#  - Setup with many Triggers during certain scenarios to make it easy to tie into your main scripts or add modules
#  - Out of the box, script can go in infinite training loops
#
#  When you get too hurt it auto runs away from combat towards town
#  - Option to have the script automatically visit the NPC Healer and get healed (or abort and let your script take over)
#  - Option to sell bundles and gems when in town, visit the bank and deposit money
#  - Option to have the script train scholarship, athletics and outdoorsmanship (ONLY WORKS IN CROSSING ATM)
#  - Option to RETURN TO YOUR ORIGINAL COMBAT ROOM after the town run and restart combat.
#  - MORE MODULES COMING SOON
#
#  REQUIRED: - UBERCOMBAT-VARS.inc and UBERCOMBAT-BUFFS.inc - Both files required for script to function.
#            - SPELL TIMER plugin is REQUIRED for many buffs/spells to function correctly.
#            - EXP TRACKER plugin is REQUIRED. EXP echo plugin is highly recommended
#            - CIRCLE CALCULATOR plugin is REQUIRED.
#            - TIME TRACKER plugin is REQUIRED for Moon Mages
#            - RESTART plugin is used if you wantget  to take advantage of the auto-restart Genie and restart script feature when Genie errors occur
#
#  INSTRUCTIONS:
#  NO EDITING OF UBERCOMBAT.CMD (THIS SCRIPT) IS NECESSARY. Simply put ubercombat, ubercombat-vars.inc and ubercombat-buffs.inc in your Genie scripts folder
#  Open and edit - UBERCOMBAT-VARS.INC - Set all your variables in here and run .ubercombat - All variables must be setup correct in ubercombat-vars.inc
#  All variables should be explained in the text above each variable set. Take your time and make sure the variables are set properly.
#
#  SCENARIOS AND TRIGGERS:
#  var RETURN.TO.COMBAT OFF - Script will completely exit after one full loop (combat and town) and parse: UBER COMBAT FINISHED!
#  var AUTOHEAL OFF - SCRIPT WILL ~NOT~ RUN TO AUTOHEALER AND WILL PARSE: "HELP ESCAPE PLZ!"  AND QUIT AFTER ESCAPING COMBAT
#  When the script needs to sell bundles/gems or bags are full or burden is too high it will parse: "GO SELL SKINS!" -  "BAGS TOO FULL!"  -  or "GO SELL GEMS!"
#
#  AUTOMATIC MANA SETTINGS FOR BUFFS:
#  The FIRST time you run the script, it will discern and auto detect the optimal mana for your buffs
#  Every time after it should remember the Mana settings UNLESS you run .ubercombat SETUP
#
#  AUTOMATIC MANA SETTINGS FOR OFFENSIVE SPELLS:
#  Every time you run the script, on the first launch it will discern and auto-detect the optimal mana for your spells and use that
#  To Turn this feature off and set your own mana for spells - set the varaible SMART.SPELLS OFF
#  NOTE FOR SYMBIOSIS - Auto-mana settings are NOT reliable with symbiosis training.7
#  IF YOU TRAIN WITH SYMBIOSIS ON YOU SHOULD SET THE MANA SETTINGS MANUALLY AND TURN ~SMART.SPELLS~ variable OFF
#
#  !!NOTES ON SORCERY SUPPORT!! - PROBABLY HAVE TO TURN OFF SMART MANA
#  Support for Sorcery spells has been added at request. USE AT YOUR OWN RISK!! I am not responsible for you blowing your arms/face off :P
#  If you DO use a sorcery spell, it is HIGHLY RECOMMENDED to turn SMART.MANA OFF, and set the mana levels for your spells MANUALLY.
#  SMART.MANA ON *MAY* work with sorcery spells, (It should use about half the mana of the normal spells to be safe)
#  But there is NO GUARANTEE that it's not going to backfire/backlash like crazy (or cast at optimal levels).
#
#  NOTES ON AUTO-PROGRESSION!
# Auto-Progression for all guild except Empath will automatically choose your MAIN creature to hunt based on main skills. Backtrain creature will not be auto-set.
# Auto-Progression for EMPATHS will automatically turn ON BACKTRAINING, and will choose your MAIN creature based on defenses, BACKTRAIN creature based on weapon skill
#
# Auto-Progression "rank" is calculated by taking your 4 main defenses (Evasion, Parry, Defending, Shield) and finding the average
# Then averaging that with your combined average weapons ranks - then using that calculation as general rank guide for choosing your combat creature
#
# IF YOU WANT TO CHOOSE COMBAT CREATURE MANUALLY - TURN AUTO.PROGRESSION OFF - AND JUST SET YOUR COMBAT.CRITTER
#
###########################################################################################################################################################################
###########################################################################################################################################################################
###########################################################################################################################################################################
#### YOU CAN IGNORE ALL THESE VARIABLES - YOU ONLY NEED TO EDIT UBERCOMBAT-VARS
## Ubermonsters - Script will target these monsters first if they come into the room
var ubermonster tusky
############################################################################################################
## (TF ONLY!) TURN PVP ~OFF~ TO SKIP REACTING TO THE KILL.ON.SIGHT LIST / GOING ON KILL RUNS IF KOS PEOPLE ARE ONLINE
var PVP OFF
## PUT YOUR NAME IN MURDERERS VARIABLE IF YOU ARE IN TF AND WANT TO GO ON KILL RUN AT END OF EVERY LOOP TO SEARCH FOR KOS LIST
var MURDERERS Shroom|NULL
## TF KILL ON SIGHT VARIABLES - WILL KILL ANY OF THESE PEOPLE IF THEY ENTER OUR ROOM OR WE FIND THEM ON A KILL RUN
var kill.on.sight Dickcheese|Meatcurtains|Smegmatip|Penisflytrap|Cunts|Rottenbox|Gloves|Dione|Grapefruit|Skylar
###############################################
# DO NOT TOUCH ANYTHING BELOW THIS LINE !!!
###############################################
var command NULL
# put #alias clear
if_1 then var command %1
if_2 then var alternate %2
if matchre("%command", "(?i)\bjump\b") then debug 5
if matchre("%command", "(?i)\bfast\b") then var command quick
if matchre("%command", "(?i)(debug|superjump)") then debug 10
if !matchre("%command", "(?i)start") then gosub WELCOME
UBERTOP:
     timer clear
     timer start
     if ($gametime = 0) then
          {
               echo
               echo ################################################
               echo *** Gametime = 0 ??? - WEIRD GENIE ERROR!
               echo *** IF YOU SEE THIS REPEATEDLY THEN RESTART YOUR GENIE!
               echo ################################################
               echo
               put #queue clear
               pause 2
               if ($connected = 0) then
                    {
                         put #connect
                         pause 3
                         put look
                         pause 3
                    }
               goto UBERTOP
          }
     put #config maxgosubdepth 50000
     put #config ignorescriptwarnings true
     put set MonsterBold
     put flag MonsterBold ON
     # put flag Description ON
     # put flag RoomNames ON
     # pause 0.01
     delay 0.0001
     if ($SpellTimer.HydraHex.active = 1) then gosub RELEASE HYH
     if ($SpellTimer.ShadowWeb.active = 1) then gosub RELEASE SHW
     if ($SpellTimer.UniversalSolvent.active = 1) then gosub RELEASE USOL
     if ($SpellTimer.QuickenEarth.active = 1) then gosub RELEASE QE
     if ($SpellTimer.ElectrostaticEddy.active = 1) then gosub RELEASE EE
     if ($SpellTimer.FireRain.active = 1) then gosub RELEASE FR
     if ($SpellTimer.PhoenixsPyre.active = 1) then gosub RELEASE PYRE
     if ($SpellTimer.DamarisLullaby.active = 1) then gosub RELEASE DALU
     if ($SpellTimer.RingofSpears.active = 1) then gosub RELEASE ROS
     if ($SpellTimer.FaenellasGrace.active = 1) then gosub RELEASE FAE
     if ($SpellTimer.AbandonedHeart.active = 1) then gosub RELEASE ABAN
     if ($SpellTimer.AlbredasBalm.active = 1) then gosub RELEASE ALB
     if ($SpellTimer.GlythtidesJoy.active = 1) then gosub RELEASE GJ
     if ($SpellTimer.SoulAttrition.active = 1) then gosub RELEASE SA
     delay 0.0001
     if ((!(def)ExpTracker.Persistent) || ($ExpTracker.Persistent = 0)) then put #var ExpTracker.Persistent 1
     if ($ExpTracker.Window = 0) then put #var ExpTracker.Window 1
     if ($ExpTracker.TrackSleep = 0) then put #var ExpTracker.TrackSleep 1
PRESENCE:
     matchre UBERTOP_BEGIN Please check NEWS NEXT|Welcome to DragonRealms|Obvious (paths|exits)|It's pitch|^You also see|^Also here
     put look
     matchwait 7
UBERTOP_CONNECT:
     pause 0.00001
     echo ########################
     echo ** -- NOT CONNECTED TO GAME?? --
     echo ** -- ATTEMPTING RECONNECT...  --
     echo ########################
     pause
     put #connect
     pause 4
     put look
     pause 4
     pause
     if ($connected = 0) then goto PRESENCE
#######################################################################
UBERTOP_BEGIN:
     put #var connected 1
     if matchre("%command", "(?i)(skip|jump|fast|quick|fight)") then goto VAR_SETUP
     echo
     echo =========================================================================================
     echo * ~~ UBER COMBAT SPECIAL STARTUP COMMANDS ~~~
     echo *
     echo * .uber SETUP ( FOR SMART MANA - Resets/Recalculates Smart Mana settings for ALL spells)
     echo * Use whenever changing magic variables / spells around.. or every few levels
     echo *
     echo * .uber SPELL ( SIMILAR to ~SETUP~ but FASTER - only resets OFFENSE spells / Skips resetting Buff Mana )
     echo *
     echo * .uber QUICK ( FAST STARTUP - Bypasses initial checks for Armor/Spells/etc, ~DOES~ MOVE TO COMBAT CRITTER! )
     echo * .uber FIGHT ( FASTEST STARTUP - Starts combat in CURRENT ROOM! ~DOES NOT~ MOVE ROOMS TO START COMBAT!! )
     echo * .uber INVASION ( Starts in CURRENT ROOM - USES HIGHEST WEAPON ONLY - SIMILAR TO FIGHT )
     echo *
     echo * .uber MAIN (WITH BACKTRAINING ON) - Starts with MAIN COMBAT ~instead~ of BACKTRAIN
     echo *
     echo * .uber HEAL ( Immediately escapes to ~GET HEALED~ -> Normal Town Run )
     echo * .uber TOWN ( Immediately escapes to ~TOWN RUN~ **BYPASSES HEALING!!!** )
     echo * .uber SELL ( Skips straight to ~SELL GEMS/SKINS/BUNDLES~ - Inventory Management )
     echo * .uber BURGLE ( Start with Burgle Run 2 first - then MAIN COMBAT )
     echo *
     echo * .uber NOCOMBAT ( Skips ~ALL Combat COMPLETELY~ - ONLY does TOWN RUNS on infinite loop )
     echo *
     echo * .uber HEALBOT ( EMPATH HEALBOT MODE - Sits in single room and HEALS PLAYERS THAT LEAN )
     echo * HEALBOT MODE IS ~NOT~ SETUP FOR NOOB EMPATHS!! MUST KNOW MOST OF THE HEAL SPELLS (Regen/FP/VH/CD)
     echo *
     echo * .uber CLERIC / .uber RITUAL ( FOR CLERICS - START SCRIPT AND IMMEDIATELY SKIP TO CLERIC TOWN RITUALS )
     echo *
     echo * .uber NOOB ( Special NOOB-ONLY module for total newbs )
     echo * - SITS in a single room & does very basic training while listening to classes
     echo * - Casts 1-2 spells, magic rope training, zills, compendiums, classes, etc
     echo * - Mostly helpful for LORE heavy guilds who just need a ton of lore skills/classes early on (Empath/MM)
     echo *
     echo * .uber DEAD ( Can be used right after departing - Will wait for rezz sickness to wear off before starting script )
     echo *
     echo * .uber DEBUG ( Runs w/ Debug on from beginning - useful for troubleshooting variable/setup issues )
     echo * .uber JUMP <LABEL> ( Jumps directly to specified LABEL - turns DEBUG ON )
     echo * .uber SKIP <LABEL> ( Jumps directly to specified LABEL - DOES ~NOT~ turn on Debug )
     echo *
     echo * ~~~ SPECIAL USER COMMANDS WHILE SCRIPT IS RUNNING ~~~
     echo * Type and enter these special commands into Genie during the right (scenario) to trigger a special event in the script:
     echo *
     echo * WEAPON SWAP! - (In Combat) ~INSTANTLY SWITCH TO NEXT WEAPON IN WEAPON CYCLE~
     echo * WEAPON SWAP 7 - (In Combat) ~SKIP X NUMBER AHEAD~ Set desired number, will skip that many weapons ahead in the cycle
     echo * TOWN RUN! - (In Combat) ~ESCAPE FROM COMBAT~ and initiate Heal/Town Run
     echo * SKIP! - (During Town Run) ~SKIP CURRENT TOWN MODULE~ and go to the next one
     echo * SKIPALL! (During Town Run) ~SKIPS ALL TOWN MODULES~ and skips to the very end of run ( reloop and back to Main Combat )
     echo =========================================================================================
     echo
     echo
     echo ###################
     echo ** RUNNING INITIAL SCANS
     echo ** SCRIPT SETUP **
     echo ###################
     echo
     if ($standing = 0) then gosub STAND
     if ($hidden = 1) then
          {
               put unhide
               pause 0.1
          }
     if matchre("$roomname", "Provincial Bank") then
          {
               send out
               pause 0.3
               send out
               pause 0.2
          }
     if ("$zoneid" = "1") then
          {
               if ((($roomid > 524) && ($roomid < 566)) || matchre("$roomid", "(1004|947|948|949)")) then gosub AUTOMOVE 72
          }
     if (("$zoneid" = "69") && ("$roomid" = "286")) then gosub AUTOMOVE horse
     if ("$zoneid" = "2a") then gosub AUTOMOVE cross
     if ($connected = 0) then goto UBERTOP_PAUSE
     goto VAR_SETUP
UBERTOP_PAUSE:
     echo *** Waiting for connection to game...
     pause 3
     goto UBERTOP
#######################################################################################
### BASE VARS - NO RESET!
### VARIABLES THAT SHOULD ~ONLY~ BE RESET TO 0 ON INITIAL STARTUP AND ~NOT~ AFTER LOOPS
#######################################################################################
VAR_SETUP:
     put #var UC_Summoning 0
     put #var UC_totalTime 0
     put #var UC_repairCost 0
     put #var UC_repairCurrency Kronars
     put #var UC_Profit 0
     put #var UC_TOTALRANKS 0
     put #var UC_Logouts 0
     put #var UC_NoCombat 0
     put #var AMMOSWAP 0
     put #var UC_combatCritter NULL
     put #var UC_alternateCritter NULL
     put #var UC_backtrainCritter NULL
     put #var automapper.typeahead 1
     var Backtrained 0
     var Backtraining 0
     var townRun 0
     var link 0
     var healbot 0
     var pouchesFull 0
     var TotalRope 0
     var TotalPouches 0
     var AltPouches 0
     var Necro.Known 0
     var breakthroughcount 0
     var Sorcery.Camb 15
     var firstlaunch 1
     var TempMax NULL
     var Temp.Right NULL
     var Temp.Left NULL
######################################################################################
### NEW ~ RESET ALL EXPTRACKER VARIABLES (IN CASE OF CHARACTER SWITCH ON SAME GENIE)
#####################################################################################
     ##put #var Shield_Usage.Ranks 0
     ##put #var Chain_Armor.Ranks 0
     ##put #var Light_Armor.Ranks 0
     ##put #var Brigandine.Ranks 0
     ##put #var Plate_Armor.Ranks 0
     ##put #var Parry Ability.Ranks 0
     ##put #var Small_Edged.Ranks 0
     ##put #var Large_Edged.Ranks 0
     ##put #var Twohanded_Edged.Ranks 0
     ##put #var Small_Blunt.Ranks 0
     ##put #var Large_Blunt.Ranks 0
     ##put #var Twohanded_Blunt.Ranks 0
     ##put #var Slings.Ranks 0
     ##put #var Bow.Ranks 0
     ##put #var Crossbow.Ranks 0
     ##put #var Staves.Ranks 0
     ##put #var Polearms.Ranks 0
     ##put #var Inner_Magic.Ranks 0
     ##put #var Primary_Magic.Ranks 0
     ##put #var Attunement.Ranks 0
     ##put #var Arcana.Ranks 0
     ##put #var Augmentation.Ranks 0
     ##put #var Debilitation.Ranks 0
     ##put #var Utility.Ranks 0
     ##put #var Warding.Ranks 0
     ##put #var Sorcery.Ranks 0
     ##put #var Evasion.Ranks 0
     ##put #var Athletics.Ranks 0
     ##put #var Perception.Ranks 0
     ##put #var Stealth.Ranks 0
     ##put #var Locksmithing.Ranks 0
     ##put #var Thievery.Ranks 0
     ##put #var First_Aid.Ranks 0
     ##put #var Outdoorsmanship.Ranks 0
     ##put #var Skinning.Ranks 0
     ##put #var Backstab.Ranks 0
     ##put #var Engineering.Ranks 0
     ##put #var Forging.Ranks 0
     ##put #var Outfitting.Ranks 0
     ##put #var Alchemy.Ranks 0
     ##put #var Enchanting.Ranks 0
     ##put #var Scholarship.Ranks 0
     ##put #var Mechanical_Lore.Ranks 0
     ##put #var Appraisal.Ranks 0
     ##put #var Performance.Ranks 0
     ##put #var Tactics.Ranks 0
     ##put #var Scouting.Ranks 0
     ##put #var Empathy.Ranks 0
     ##put #var Astrology.Ranks 0
     ##put #var Expertise.Ranks 0
     ##put #var Summoning.Ranks 0
     ##put #var Bardic_Lore.Ranks 0
     ##put #var Conviction.Ranks 0
     ##put #var Theurgy.Ranks 0
     ##put #var Thanatology.Ranks 0
     ##put #var Trading.Ranks 0
###############################################################
### START ALL BASE TIMERS - NON-GUILD SPECFIC - NO RESET ON LOOP
### TIMERS START - START TIMERS
###############################################################
TIMERS_START:
     var TownTimeLast 0
     var TownTime $gametime
     var startTime $gametime
     var AimTime $gametime
     var AimLast $gametime
     var AlmanacTime $gametime
     var AltWeaponTime $gametime
     var AppraiseTime $gametime
     var BuffTime $gametime
     var CastTime $gametime
     var CrystalTime $gametime
     var CyclicTime $gametime
     var DeadTime $gametime
     var DumpTime $gametime
     var FociTime $gametime
     var HuntTime $gametime
     var skinTime $gametime
     var PerceiveTime $gametime
     var TrainerLoopTime $gametime
     var TeachTime $gametime
     var WeatherTime $gametime
     var maneuverTime $gametime
     var doubleStrikeTime $gametime
     var darkTime $gametime
     var herbTime $gametime
     var portalTime $gametime
     var SummonDropTime $gametime
     #############################
     var TextbookTime $gametime
     var TextbookLast $gametime
     var TarantulaLast $gametime
     var TarantulaTime $gametime
     var WandLast $gametime
     var WandTime $gametime
     var OrbTime $gametime
     var BOSTime $gametime
     var SummonDropLast 90
     ##put #var lastSwap $gametime
     ###########################
     goto UBERTOP_GO
###########################################################
#### INITIAL PREP AFTER RESTARTING SCRIPT TO RESET ALL VARS
INIT_PREP:
     var command NULL
###########################################################
#### SCRIPT INITIALIZATION
UBERTOP_GO:
     var LAST UBERTOP_GO
     gosub clear
     put #var connected 1
     if matchre("$scriptlist" , "disarm\.cmd") then put #script abort disarm
     if matchre("$scriptlist" , "braid\.cmd") then put #script abort braid
     if matchre("$scriptlist" , "climbcross\.cmd") then put #script abort climbcross
     if matchre("$scriptlist" , "steal\.cmd") then put #script abort steal
     if matchre("$scriptlist" , "climb\.cmd") then put #script abort climb
     if matchre("$scriptlist" , "automapper\.cmd") then put #script abort automapper
     if matchre("$scriptlist" , "burgle\.cmd") then put #script abort burgle
     if matchre("$scriptlist" , "travel\.cmd") then put #script abort travel
     if matchre("$scriptlist" , "mastercraft\.cmd") then put #script abort mastercraft
     if matchre("$scriptlist" , "MC_Carve\.cmd") then put #script abort MC_Carve
     if matchre("$scriptlist" , "MC_Enchant\.cmd") then put #script abort MC_Enchant
     if matchre("$scriptlist" , "MC_Grind\.cmd") then put #script abort MC_Grind
     if matchre("$scriptlist" , "MC_Knit\.cmd") then put #script abort MC_Knit
     if matchre("$scriptlist" , "MC_Mix\.cmd") then put #script abort MC_Mix
     if matchre("$scriptlist" , "MC_Pound\.cmd") then put #script abort MC_Pound
     if matchre("$scriptlist" , "MC_Setup\.cmd") then put #script abort MC_Setup
     if matchre("$scriptlist" , "MC_Sew\.cmd") then put #script abort MC_Sew
     if matchre("$scriptlist" , "MC_Shape\.cmd") then put #script abort MC_Shape
     if matchre("$scriptlist" , "MC_Smelt\.cmd") then put #script abort MC_Smelt
     if matchre("$scriptlist" , "MC_Spin\.cmd") then put #script abort MC_Spin
     if matchre("$scriptlist" , "MC_Tinker\.cmd") then put #script abort MC_Tinker
     if matchre("$scriptlist" , "MC_Weave\.cmd") then put #script abort MC_Weave
#########################################################################################################################
## LOAD MAIN TRIGGERS
#########################################################################################################################
     ## TF KILL ON SIGHT / REACTION TRIGGERS
     var kill.target NULL
     action (TF) var kill.target $1; var coins.given $2; var coins.type $3; goto GIVE_COINS when ^(\w+) gives you (\d+) copper (.+)\.
     action (TF) var kill.target $1; goto KILL_BITCH when ^(\w+) closes to .* on you
     action (TF) var kill.target $1; goto KILL_BITCH when ^(\w+) turns to face you
     action (TF) var kill.target $1; goto KILL_BITCH when ^(\w+) poachs an? .* at you\.
     action (TF) var kill.target $1; goto KILL_BITCH when ^(.+) appears to be aiming at you
     action (TF) var kill.target $1; goto KILL_BITCH when ^(\w\w+) leaps from hiding and ambushes you
     action (TF) var kill.target $1; goto KILL_BITCH when ^(\w+) startles you as
     action (TF) var kill.target $1; goto KILL_BITCH when (%kill.on.sight) (throws|hurls|lobs) .* at you
     action (TF) var kill.target $1; goto KILL_BITCH when (%kill.on.sight).*joins your group
     action (TF) var kill.target $1; goto KILL_BITCH when ^.*?(%kill.on.sight) .*just arrived
     action (TF) var kill.target $1; goto KILL_BITCH when ^.*?(%kill.on.sight) begins to advance on you
     action (TF) var kill.target $1; goto KILL_BITCH when ^.*?(%kill.on.sight) begins to target
     action (TF) var kill.target $1; goto KILL_BITCH when ^.*?(%kill.on.sight) leaps from hiding
     action (TF) var kill.target $1; goto KILL_BITCH when sense the invisible presence of (%kill.on.sight)
     action (TF) var kill.target $1; var direction $2; goto KILL_BITCH_MOVE when ^Out of the corner of your eye\, you notice (%kill.on.sight) trying to sneak (\w+)
     action (TF) var kill.target $1; var drag.direction $2; goto KILL_DRAG when ^(%kill.on.sight) grabs .* and drags \w+ (\w+)
     action (TF) goto KILL_BITCH when eval matchre("$roomplayers", "(%kill.on.sight)")
     action (TF) goto ORIGINAL_ROOM when \w+ grabs your arm and drags you|flowing motion before sounding out a roar of deadly warning
     action (TF) var kill.target $1; goto DEPART_CAMP when (%kill.on.sight) is slain before your eyes\!
     #action (TF) var kill.target $1; goto KILL_BITCH when ^\s*\*.* (%kill.on.sight)

     ## PVP KILLING TRIGGERS
     action (PVP) goto DEPART_CAMP when (?:%kill.on.sight) is slain before your eyes
     # action goto KILL_BITCH when matchre("$roomplayers", "%kill.on.sight")

     # Trigger to initiate Genie Fuckup subroutine.
     action goto GENIE_FUCKUP when ^Your worn items are:

     ## AFK CHECKS / RPA CHECK
     action put #flash;put #play Done.wav;put #echo >Log #ff3399 **** RPA QUESTION ALERT - CHECK GAME WINDOW!!!! when \s*\[.*SUBMIT.*\]

     # DEAD TRIGGERS to initiate Full Exit subroutine.
     action goto EXIT_DEATH when eval ($dead = 1)
     action (dead) goto EXIT_DEATH when eval ($health < 2)
     action (dead) goto EXIT_FULL when eval ($health < 8)

     # ESCAPE TRIGGERS to initiate Escape Routine
     action (sorcery) goto ESCAPE when ^Will alone cannot conquer the paralysis
     action (sorcery) goto ESCAPE when ^An instant rush of black and blue fire explodes
     action (sorcery) goto ESCAPE when ^The spell pattern resists the influx of unstable mana and everything goes black
     action (sorcery) goto ESCAPE when ^Geysers of uncontrolled mana suddenly erupt from your flesh
     action (escape) goto ESCAPE when ^You run around in circles as the flames consume your .*\!
     action (escape) goto ESCAPE when eval ($health < 70)
     action (escape) goto ESCAPE when eval ($poisoned = 1)
     action (escape) goto ESCAPE when eval ($diseased = 1)
     # action (escape) goto ESCAPE when eval ($bleeding = 1)
     # action (escape) goto ESCAPE when ^You move along to follow your mark

     # Combat Triggers to initiate Temporary logout
     action (stunned) goto STUNNEDOUT when eval ($health <= 40)
     action (stunned) goto STUNNEDOUT when ^You're.*(extremely bad shape|smashed up|terribly wounded)
     action (stunned) goto STUNNEDOUT when ^Your body feels (extremely beat up|bad shape)

     # Pickup weapon after numbed hands / dropped weapon
     action (combat) goto DROPPED_WEAPON when ^Your (.+) falls to the ground\.

     # Trigger for ubermonster
     action (combat) goto UBERSWITCH when %ubermonster (just arrived|charges into view)\.

     # Balance Triggers
     action (combat) put #var UC_balance 1 when ^\[You\'re.+incredibly balanced
     action (combat) put #var UC_balance 2 when ^\[You\'re.+adeptly balanced
     action (combat) put #var UC_balance 3 when ^\[You\'re.+nimbly balanced
     action (combat) put #var UC_balance 4 when ^\[You\'re.+solidly balanced
     action (combat) put #var UC_balance 5 when ^\[You\'re.+slightly off balance
     action (combat) put #var UC_balance 6 when ^\[You\'re.+off balance
     action (combat) put #var UC_balance 7 when ^\[You\'re.+somewhat off balance
     action (combat) put #var UC_balance 8 when ^\[You\'re.+badly balanced
     action (combat) put #var UC_balance 9 when ^\[You\'re.+very badly balanced
     action (combat) put #var UC_balance 10 when ^\[You\'re.+extremely imbalanced
     action (combat) put #var UC_balance 11 when ^\[You\'re.+hopelessly unbalanced
     action (combat) put #var UC_balance 11 when ^\[You\'re.+completely imbalanced
     ## Aiming/Ammo Triggers
     action (combat) var fullAim 1 when ^You think you have your best shot possible now\.
     action (combat) var ammolodged 1 when (.+) lodges itself
     # action (escape) goto STUNNEDOUT when ^You're.*(badly hurt|very badly hurt)
     # action goto EXIT_NOW when eval contains("$prompt", "S")
     # action goto EXIT_NOW when ^You are still stunned\.
     #action goto EXIT_NOW when eval ($stunned = 1)

     # Burden Triggers
     action (combat) put #var UC_Burden 0 when ^\s*Encumbrance\s*\:\s*None
     action (combat) put #var UC_Burden 1 when ^\s*Encumbrance\s*\:\s*Light Burden
     action (combat) put #var UC_Burden 2 when ^\s*Encumbrance\s*\:\s*Somewhat Burdened
     action (combat) put #var UC_Burden 3 when ^\s*Encumbrance\s*\:\s*Burdened
     action (combat) put #var UC_Burden 4 when ^\s*Encumbrance\s*\:\s*Heavy Burden
     action (combat) put #var UC_Burden 5 when ^\s*Encumbrance\s*\:\s*Very Heavy Burden
     action (combat) put #var UC_Burden 6 when ^\s*Encumbrance\s*\:\s*Overburdened
     action (combat) put #var UC_Burden 7 when ^\s*Encumbrance\s*\:\s*Very Overburdened
     action (combat) put #var UC_Burden 8 when ^\s*Encumbrance\s*\:\s*Extremely Overburdened
     action (combat) put #var UC_Burden 9 when ^\s*Encumbrance\s*\:\s*Tottering Under Burden
     action (combat) put #var UC_Burden 10 when ^\s*Encumbrance\s*\:\s*Are you even able to move\?
     action (combat) put #var UC_Burden 11 when ^\s*Encumbrance\s*\:\s*It's amazing you aren't squashed\!

     # Analyze Triggers
     action (combat) var moveone $1 when by landing an? (\S+)\.
     action (combat) var moveone $1;var movetwo $2 when by landing an? (\S+) and an? (\S+)\.
     action (combat) var moveone $1;var movetwo $2;var movethree $3 when by landing an? (\S+)\, an? (\S+) and an? (\S+)\.
     action (combat) var moveone $1;var movetwo $2;var movethree $3;var movefour $4 when by landing an? (\S+)\, an? (\S+)\, an? (\S+) and an? (\S+)\.
     action (combat) var moveone $1;var movetwo $2;var movethree $3;var movefour $4;var movefive $5 when by landing an? (\S+)\, an? (\S+)\, an? (\S+)\, an? (\S+) and an? (\S+)\.

     # Trigger to know if you are wearing your shield or not
     action (shield) var shield 0 when ^You loosen the straps securing
     action (shield) var shield 0 when ^You thump a (.+) (buckler|shield|sipar|aegis|targe|pot lid|pavise|kwarf|metal block|mussel shell).+inside your (.*)
     action (shield) var shield 1 when ^You thump a (.+) (buckler|shield|sipar|aegis|targe|pot lid|pavise|kwarf|metal block|mussel shell).+(you are wearing|with the back of your hand)
     action (shield) var shield 1 when ^You slide your left arm through the straps on your (.+)
     action (shield) var shield 1 when ^Your attempt is significantly hindered by your (.*).
     action (shield) var shield 1 when ^Your (.+) makes the task more difficult
     action (shield) var shield 1 when ^You are unable to block with your (.*) while drawing a (.*)

     ## DEBT TRACKING PER PROVINCE
     action (debt) var $1Fine $2 when (\S+)\.\s*\((\d+) copper (Kronars?|Lirums?|Dokoras?|kronars?|lirums?|dokoras?)\)

     # OVER BANK LIMIT
     action (debt) put #echo >Log #FF0F00 *** OVER BANK LIMIT IN $zonename! MOVE MONEY TO ANOTHER BANK!!! when (?:.+)\"I'm sorry,\s+but that much money would be more than our accounts allow\.\s+.+\"\.

     # Gem Profit tracking Trigger
     action (gemprofit) var pouchsold 1;var newreport 1;evalmath TotalGemsSold %TotalGemsSold+1;evalmath TotalGemProfit %TotalGemProfit+$1;var gemProfitCurrency $2 when hands you (\d+) (Kronars?|Lirums?|Dokoras?|kronars?|lirums?|dokoras?)

     # Rank Tracking Trigger
     action math Ranks add 1 when ^You've gained (?:a new|\d+) (?:rank|ranks) in\s?(?:your ability (?:to|with)|using|maneuvering in|your)?\s?(.+)\s?(?:use|area)?\.

     # Auto-Movement Detection Trigger
     action (moving) var Moving 1 when Obvious (path|exits)|Roundtime

     # Combat Range Triggers
     action (retreat) var Melee.Range 1 when ^You close to melee range on .*\.|^.* closes to melee range on you\!|^\[You're .*\.\]$|^You .* at melee range\.|^.* you at melee range\.|^You .* at melee range\.|^You are already at melee
     action (retreat) var Melee.Range 0 when ^You retreat from combat\.|^You are already as far away as you can get\!|^You retreat back to pole range\.|^You sneak back out to pole range|^You aren't close enough to attack\.|^You begin to (stealthily )?advance
     action (retreat) var Pole.Range 1 when ^(.+) closes to pole weapon range on you\!|^You retreat back to pole range\.|^You (.+) at pole range\.|^You (.+) at pole weapon range\.|^You close to melee range on (.+)\.|^(.+) closes to melee range on you\!|^\[You're (.+)\.\]$|^You (.+) at melee range\.|^(.+) you at melee range\.
     action (retreat) var Pole.Range 0 when ^You retreat from combat\.|^You are already as far away as you can get\!
     action (combat) var newdead 1 when ^\[You're .*balanced?\]

     # Trigger to set variable for occupied room, when roaming.
     action (combat) var Occupied 1 when ^Also here\:|^Also in the room\:

     # MAGIC - Spell prep Triggers
     action (magic) var spellExpired 1 when ^Your concentration lapses and you lose your targeting pattern\.
     action (magic) var spellPrepped 1 when ^You feel fully prepared to cast your spell\.|^Your secondary spell pattern dissipates because your target is dead\, but the main spell remains intact\.
     action (magic) var spellPrepped 1 when ^Your target pattern has finished forming around the area\.|^The formation of the target pattern around .* has completed\.|^Your formation of a targeting pattern
     action (magic) var noTarget 0 when ^Your target pattern has finished forming around the area\.
     action (magic) var TM.Target $1 when ^You begin to weave mana lines into a target pattern around(?: an?)? (.+)\.
     action (magic) goto UNCLEAN_SOUL when ^Your spell pattern collapses\, unable to bear the weight of your unclean soul\.

     # Magic Tattoo TM Detection
     action (magic) var MagicTM 1 when ^The saturated tunnels in the tattoo form

     # Mana Backfire Trigger
     ## action (magic) var Backfired 1;math backfirecount add 1;var BackfireSeverity 1;var BackfireSpell %CurrentSpell when ^You strain\, but are too mentally fatigued to finish the pattern\, and it slips away\.
     action (magic) var Backfired 1;math backfirecount add 1;var BackfireSeverity 1;var BackfireSpell %CurrentSpell when ^Your spell barely backfires\.
     action (magic) var Backfired 1;math backfirecount add 1;var BackfireSeverity 2;var BackfireSpell %CurrentSpell when ^Your spell backfires\.
     action (magic) var Backfired 1;math backfirecount add 1;var BackfireSeverity 3;var BackfireSpell %CurrentSpell when ^Your spell backfires somewhat\.
     action (magic) var Backfired 1;math backfirecount add 1;var BackfireSeverity 4;var BackfireSpell %CurrentSpell when ^Your spell badly backfires\.
     action (magic) var Backfired 1;math backfirecount add 1;var BackfireSeverity 5;var BackfireSpell %CurrentSpell when ^Your spell horribly backfires\.
     action (magic) var Backfired 1;math backfirecount add 1;var BackfireSeverity 6;var BackfireSpell %CurrentSpell when ^Your spell hopelessly backfires\.
     ## action (magic) var Backfired 1;math backfirecount add 1;var BackfireSeverity 3;var BackfireSpell %CurrentSpell when ^You feel intense strain as you try to manipulate the mana streams

     ## MM Shard Count Trigger
     action (magic) var shards Zero when ^That was the last of your orbiting slivers\.
     # TM Trigger
     action (magic) var noTarget 1;echo **NO TM TARGET! when ^You are not engaged to anything\, so you must specify a target to focus on\!

     # WM PATHWAYS / DOMAIN
     action (magic) put #var domain 0 when ^A strange sense passes through you
     action (magic) put #var domain 1 when ^Discharging a burst of elemental power in the esoteric|^You sense the physics of the local area are being modified by|^Suddenly the area feels somehow more|^The air around you feels somehow thicker|^Strangely.*everything feels a tiny bit heavier|^A barely felt zap of static electricity accompanies your meditation|^You feel a sudden tingle of heat in your palms|^The humidity in the area noticeably increases
     action (magic) put #var pathway 1 when ^You focus on (?:manipulating|stretching) an aethereal pathway|^You are already manipulating the aether to your benefit
     action (magic) put #var pathway 0 when ^You gently relax your mind and release your hold on the aethereal pathways|^You aren't focusing on any of the aethereal pathways|^You find it impossible to manipulate the aether while stunned.  The complex web of manipulations collapse, allowing the aether to fall back into its natural contours

     # Triggers for too many items / Junk yard
     action (inventory) put #echo >Log #fd00f1 ** INVENTORY COUNT WARNING! REDUCE ITEM COUNT!;math invcount add 1 when ^It is recommended that you reduce your inventory count|^WARNING.*number of items on your person|^You're carrying far too many items already\.|You have a large number of items on your person\.
     action goto JUNK.YARD when ^You are here because you have too many items on your character\.

     # MAINTENANCE TRIGGER
     action goto ESCAPE.SHUTDOWN when ^Announcement\: DragonRealms\:?(.+)? will be shutting down in .* minutes
     action goto ESCAPE.SHUTDOWN.INSTANT when ^Announcement\: DragonRealms\:?(.+)? is now shutting down

     ## PANIC EXIT BACKSTAB/AMBUSH TRIGGERS
     action put #echo >Log *** Got ambushed by $1!!;goto EXIT_QUICK when (\S+) (?<!sprite |nyad |dryad |assassin |thug |cutthroat |footpad |ruffian |stalker |dancer |lout |rat |warcat |moneygrubber |graverobber |intercessor |sentinel |firecat |resuscitant |orek |blademaster |sorcerer )leaps from hiding and ambushes you
     action put #echo >Log *** Got ambushed by $1!!;goto EXIT_QUICK when (\S+) (?<!sprite |nyad |dryad |assassin |thug |cutthroat |footpad |ruffian |stalker |dancer |lout |rat |warcat |moneygrubber |graverobber |intercessor |sentinel |firecat |resuscitant |orek |blademaster |sorcerer )startles you as

     ## PANIC ESCAPE (ONLY WITH NO.CONTACT ON)
     action (PVPPLAYER) put #echo >Log *** $1 Advanced on me!!!;goto ESCAPE_STARTLED when ^(\S+) begins to advance on you\!
     action (PVPPLAYER) put #echo >Log *** $1 Aimed at me!!;goto ESCAPE_STARTLED when ^(\S+) appears to be aiming at you with .*\.
     action (PVPPLAYER) put #echo >Log *** $1 Poached at me!!;goto EXIT_QUICK when ^\s*\*?.*\,? (\S+) poachs an? .* at you\.
     action (PVPPLAYER) put #echo >Log *** $1 held my hand!!!;goto ESCAPE_STARTLED when ^(\S+) reaches over and holds your hand\.
     action (PVPPLAYER) put #echo >Log *** $1 held my hand!!!;goto ESCAPE_STARTLED when ^(\S+) clasps your hand tenderly\.
     action (PVPPLAYER) put #echo >Log *** $1 Dragged me!!!;goto ESCAPE_STARTLED when ^(\S+) grabs your arm and drags you.*\. \. \.
     action (PVPPLAYER) put #echo >Log *** $1 Tried to drag me!!!;goto ESCAPE_STARTLED when ^(\S+) grabs your arm and tries to drag you, but you resist and stand firm\.
     action (PVPPLAYER) put #echo >Log *** $1 Faced me!!!;goto ESCAPE_STARTLED when ^(\S+) turns to face you\.
     action (PVPPLAYER) put #echo >Log *** Escaping Combat - $1 is talking in our room - Message: $0;goto ESCAPE_STARTLED when (\S+) (?<!rat |bucca |shadow |shadowling |shadowcat |shadowpanther |shadowtabby |Cormyn |One |nyad |dryad |assassin |ruffian |stalker |footpad |thug |cutthroat |adventurer |wraith |magus |dancer |sprite |lout |warcat |moneygrubber |graverobber |firecat |resuscitant |orek |purifier |juggernaut |zealot |crone |sentinel |intercessor |blademaster |sorcerer |shadow beast )(?<!glances about|chuckles softly and |points at you and |snarls |scans the area |reels backward as it )(?:whispers|asks|says|exclaims|asks you|shouts|shouts|screams|yells)\,\s\"(?!(?:Take care, .+ $charactername|Foolisssh|Asketi|Tina mi|Please release me|Silence slave|Farewell|I'm a-pickin' stuff up|Welcome back|I like to (dance|play)|Siegery|Treasure hunting|Well I'll be dern|Me thinks|That's not worth|My eyes aren't|You can't see me|Visit a local dock|Your incessant|We heard the|Where are you\?\s+I will find you\!|I will not be held captive|The darkness of Maelshyve shall|This looks like a good|Is anyone (hunting|else|in|here).*\"))((.*)\"(?!"))

     ## ALERT TRIGGERS FOR PVP ACTIONS
     action put #echo >Log *** $1 Advanced on me!!! when ^(\S+) begins to advance on you\!
     action put #echo >Log *** $1 Aimed at me!! when ^(\S+) appears to be aiming at you with .*\.
     action put #echo >Log *** $1 Poached at me!! when ^\s*\*?.*\,? (\S+) poachs an? .* at you\.
     action put #echo >Log *** $1 held our hand!! when ^(\S+) reaches over and holds your hand\.
     action put #echo >Log *** $1 held our hand!! when ^(\S+) clasps your hand tenderly\.
     action put #echo >Log *** $1 Dragged me!! when ^(\S+) grabs your arm and drags you.*\. \. \.
     action put #echo >Log *** $1 Tried to Drag us!! when ^(\S+) grabs your arm and tries to drag you, but you resist and stand firm\.
     action put #echo >Log *** $1 Faced me! when ^(\S+) turns to face you\.

     # MISC Triggers
     action (footitem) var footitem $1;goto stowfootitem when ^You notice an?(?:(?:\s\b\w+\B)?(?:intricately|etched|polished|carved|engraved)*).*?(\S+) (?:(?=acid-etched|accented|adorned|affixed|attached|balanced|banded|bearing|bound|branded|braided|caked|carved|chased|chisled|cloaked|clutching|coated|constructed|connected|covered|crafted|crested|crowned|dangling|decorated|deformed|designed|detailed|displaying|draped|dyed|embedded|embellished|embroidered|enblazoned|enbossed|encrusted|engraved|enhanced|entitled|etched|fashioned|festooned|featuring|filed|filled|firestained|fitted|flecked|fletched|flaunting|forged|formed|from|gleaming|hewn|highlighted|hilted|hung|in|incised|inlaid|inscribed|inset|intricately|joined|labeled|lavishly|lined|linked|made|marked|mottled|mounted|of|ornamented|padded|painted|polished|reinforced|resembling|rimed|rivited|scattered|scarred|scorched|sealed|set|shaped|shod|spiraled|stamped|stitched|streaked|strung|studded|surmounted|swathed|tangled|tethered|that|tied|tinged|tinted|titled|that|tipped|tooled|topped|trimmed|veined|whorled|wrapped|wrought|with).*)?(?:lying )?at your feet, and do not wish to leave it behind\.
     action put #var UC_shardCitizen 0 when ^The Sentinel (.+) eventually frowns\.\s+\"Sorry\, you\'re not a citizen\.\s+I can't let you through\.\"
     action put #queue clear;goto WAKE_UP when ^\[Use WAKE to wake yourself up\.\]

     ### User Intervention Triggers
     action goto USER_ESCAPE when ^TOWNRUN\!?|^TOWN RUN\!?|^ESCAPE\!
     action (magic) math spellcount add 1 when ^(?i)MAGIC SWAP\!?$(?-i)
     action (skip) put #script abort automapper;put #queue clear;echo *** USER INTERRUPT! SKIPPING MODULE TO %NEXTSUB;goto %NEXTSUB when ^NEXT\!|^SKIP\!
     action (switch) put #queue clear;goto SWITCH when ^WEAPON SWAP|^WEAPONSWAP
     action (switch) put #queue clear;var combatadd $1;goto SWITCH when ^WEAPON SWAP (\d+)|^WEAPON SWAP(\d+)|^WEAPONSWAP(\d+)|^WEAPON SKIP (\d+)|^WEAPON SKIP(\d+)|^WEAPONSKIP(\d+)
     action (skip) put #script abort automapper;put #queue clear;echo *** USER INTERRUPT! SKIPPING BACK TO COMBAT;goto TELEPORT_BACK when ^SKIPALL\!

     ## Reaction Triggers
     action put #echo >Log Crimson **** LOST AND FOUND HAS ONE OF YOUR ITEMS! CHECK LOST AND FOUND IN VAULTS! when Our paperwork indicates you have a lost item in our possession
     action put #echo >Log Lime *** RECEIVED A GM RP AWARD! *** when Congratulations $charactername!  You just received an award for roleplaying!
     action put #echo >Log Lime *** GOT $1 PIRP POINT(S)! *** when You just received (\d+) PIRP points
     action put #echo >Log #ff0000 *** YOU DROPPED YOUR $1 !!!! **** when Your (.+) falls to the ground\.|Your fingers go numb as you drop a (.+)
     action put #echo >Log #ffff66 *** Found a treasure map!! when ^You pick up a worn and tattered map\.
     action put #echo >Log Pink *** Healed by Player: $1 when ^(\S+) lays (.+) hand on your arm

     ## THIEF REACTIONS
     action var slipped $1; goto SLIPPED when ^Odd\.\s+Where did that.*?(\w+) come from\?
     action put #echo >Log #ffff66 *** Thief slipped an item in your $1!! when ^Strange\.\s+Your (.+) just got a little heavier\.
     action put #echo >Log #ffff66 *** Thief slipped us some Money!! when ^You feel your pockets get slightly heavier
     action put #echo >Log *** MARKED BY $1 when ^You feel the familiar sensation of being sized up by (.+)\.
     action put #echo >Log #ff0000 **** $1 TRIED TO STEAL FROM US!! when You catch (\w+) making a grab for your pockets\!

     # Music Playing Triggers
     action var Playing 1 when ^You begin (.+) on your (.+)|^You continue playing on your|^You should stop playing before|^You struggle to begin a (.+)|^You fumble slightly as you begin|^You lose track of the time signature|^You try hard to continue playing
     action var Playing 1 when ^You begin (.+) on your (.+)|^You\'re already playing a song|^You .* as you begin a|^You effortlessly begin a (.+) on your (.+)|^You maneuver through a difficult|^You cannot (use|play) the (.+) while in combat\!
     action var Playing 0 when ^Your song comes to an end\.|^In the name of love\?|^You (stop|finish) (playing|performing)|^You cannot play that|But you\'re not performing anything\!
     # action send stop play;send 1 $lastcommand when ^You should stop playing before you do that|^You are a bit too busy performing to do that\.
     # action goto TOP when prods you between the shoulder

     # WEAPON XP
     action (combat) var WEAPON_EXP Brawling when ^BRAWLING\!
     action (combat) var WEAPON_EXP Small_Edged when ^SMALL_EDGED\!
     action (combat) var WEAPON_EXP Offhand_Weapon when ^OFFHAND\!
     action (combat) var WEAPON_EXP Heavy_Thrown when ^HEAVY_THROWN\!|^HT\!
     action (combat) var WEAPON_EXP Light_Thrown when ^LIGHT_THROWN!|^LT\!
     action (combat) var WEAPON_EXP Twohanded_Edged when ^TWOHANDED_EDGED\!
     action (combat) var WEAPON_EXP Large_Edged when ^LARGE_EDGED\!
     action (combat) var WEAPON_EXP Small_Edged when ^SMALL_EDGED\!
     action (combat) var WEAPON_EXP Twohanded_Blunt when ^TWOHANDED_BLUNT\!
     action (combat) var WEAPON_EXP Small_Blunt when ^SMALL_BLUNT\!
     action (combat) var WEAPON_EXP Large_Blunt when ^LARGE_BLUNT\!
     action (combat) var WEAPON_EXP Polearm when ^POLEARM\!
     action (combat) var WEAPON_EXP Staves when ^STAVES\!
     action (combat) var WEAPON_EXP Slings when ^SLINGS\!
     action (combat) var WEAPON_EXP Bow when ^BOW\!|^Training Bow\!
     action (combat) var WEAPON_EXP Crossbow when ^CROSSBOW\!|^Training Crossbow\!
     action (offhand) goto OFFHAND_ERROR when ^The .* is simply too large for an offhand

    # EXP MOD Tracking
     action (exp_mods) put #echo >ExpMods $0 when ^(\-|\+\d+ .+)
     action (exp_mods) put #echo >ExpMods +$1 $2 when (?:\-|\+)(\d+)(?:\(\-\)|\(\d+\%?\)) (.+) (\(\d+ effective)

     # RECONNECT ACTIONS
     action (reconnect) var TIMEOUT 1;goto INIT_PREP when eval $useridle = 1
     action (reconnect) var TIMEOUT 1;goto INIT_PREP when ^YOU HAVE BEEN IDLE TOO LONG
     action (reconnect) goto RECONNECTED when ^You look around\, taking a moment to get your bearings|^Welcome to DragonRealms
     action (reconnect) goto DISCONNECTED when eval $connected = 0
     action (reconnect) goto DISCONNECTED when ^Reconnect aborted|Unable to contact Genie Key server|^Please make sure that your internet connection|Connection closed\.|(ConnectionTimedOut)
     action (reconnect) goto DISCONNECTED when ^Connection lost|^ConnectionAborted|^Socket Error|^ReceiveCallback Exception|Unable to contact Genie Key server|Unable to get login key\.
     # action (reconnect) goto RECONNECTED when Please check for new or updated items in NEWS\!

     # Teaching Triggers
     # action if (!%Teaching) then var Student $1;put #var UC_teachingClass $2 when ^(.*) whispers, \"teach (.*)\"
     action var Teaching 1 when ^(.+) begins to listen to you teach the .* skill\.
     action var Teaching 1;put #var UC_teachingClass $1 when ^You are teaching a class on (.+) which (.+)\.
     action var Teaching 0 when ^You stop teaching\.
     action var Teaching 0 when ^All of your students have left\, so you stop teaching\.
     action var Listening 1;var Teacher $1;var ListenClass $2 when ^You begin to listen to (\w+) teach the (.*) skill
     action var Listening 0;var Teacher NULL;var ListenClass NULL when ^Your teacher is not here\, so you are no longer learning anything\.
     action instant if (!%Teaching) then var Student $1;put #tvar teachingClass $2 when ^(.*) whispers, \"teach (.*)\"

     ## MAGIC RESEARCH TRIGGERS
     action (research) var Research.Active 1;var Research.Inactive 0 when ^You start to research|^You tentatively reach out and begin manipulating the mana streams|^You continue to flex the mana streams|^You continue to research|^You begin to bend the mana streams|^You focus your magical perception as tightly as possible|^You are already busy at research\!|^You confidently begin to bend the mana|you feel your research is going well|^The symbols and sigils around you seem to pulse with meaning as you continue your project|^You continue to experiment with new spell patterns|^Noting that your research is progressing nicely|^You continue making theoretical strides\.|^Keeping your emotions on a razor's edge|^Abandoning the normal discipline required to manipulate the mana streams
     action (research) var Research.Active 0;var Research.Inactive 0;echo *** RESEARCH COMPLETE!!~;math breakthroughcount add 1 when ^Breakthrough\!|^You have abandoned your research project
     action (research) var Research.Active 1;var Research.Inactive 1 when ^You make definite progress in your .+ and decide to take a break|^You decide to stop researching

     # Empath Vars
     action goto EMPATHIC_SHOCK when ^Pain blossoms within you\,\syour delicate empathic senses singing with agony\.
     action var facing $1 when ^You (?:\(.*\) )?(?:turn to|are already|are) (?:face|facing|flanking|behind) (?:an?|the).*? ((?:\b\S+){0,1}\s?(?:\b\S+))\s?[(,.]

     # Moonie Observe Triggers
     action var Observe 0 when ^You have not pondered your last observation sufficiently
     action var Observe 1 when ^You feel you have sufficiently pondered your latest observation
     action (observe) put #var Time.isYavashUp 0 when ^Yavash is below the horizon\.
     action (observe) put #var Time.isKatambaUp 0 when ^Katamba is below the horizon\.
     action (observe) put #var Time.isXibarUp 0 when ^Xibar is below the horizon\.
     action (observe) var MM.Giant 1 when Giant
     action (observe) var MM.Toad 1 when Toad
     action (observe) var MM.Scales 1 when Scales
     action (observe) var MM.Ox 1 when Ox
     action (observe) var MM.Wolf 1 when Wolf
     action (observe) var MM.Cat 1 when Cat
     action (observe) var MM.Spider 1 when Spider
     action (observe) var MM.Boar 1 when Boar
     action (observe) var MM.Heart 1 when Heart
     action (observe) var MM.Archer 1 when Archer
     action (observe) var MM.Jackal 1 when Jackal
     action (observe) var MM.Triquetra 1 when Triquetra
     action (observe) var MM.Magpie 1 when Magpie
     action (observe) var MM.Heron 1 when Heron
     action (observe) var MM.Cow 1 when Cow
     action (observe) var MM.Ram 1 when Ram
     action (observe) var MM.KingSnake 1 when King Snake
     action (observe) var MM.Raven 1 when Raven
     action (observe) var MM.Hare 1 when Hare
     action (observe) var MM.Lion 1 when Lion
     action (observe) var MM.Wren 1 when Wren
     action (observe) var MM.Panther 1 when Panther
     action (observe) var MM.Cobra 1 when Cobra
     action (observe) var MM.Vulture 1 when Vulture
     action (observe) var MM.Dolphin 1 when Dolphin
     action (observe) var MM.Unicorn 1 when Unicorn
     action (observe) var MM.Wolverine 1 when Wolverine
     action (observe) var MM.Raccoon 1 when Raccoon
     action (observe) var MM.Nightingale 1 when Nightingale
     action (observe) var MM.Mongoose 1 when Mongoose
     action (observe) var MM.Goshawk 1 when Goshawk
     action (observe) var MM.Welkin 1 when Welkin
     action (observe) var MM.Dove 1 when Dove
     action (observe) var MM.Coyote 1 when Coyote
     action (observe) var MM.Donkey 1 when Donkey
     action (observe) var MM.Shardstar 1 when Shardstar
     action (observe) var MM.Shark 1 when Shark
     action (observe) var MM.Viper 1 when Viper
     action (observe) var MM.Weasel 1 when Weasel
     action (observe) var MM.Albatross 1 when Albatross
     action (observe) var MM.Verena 1 when Verena
     action (observe) var MM.Estrilda 1 when Estrilda
     action (observe) var MM.Yoakena 1 when Yoakena
     action (observe) var MM.Szeldia 1 when Szeldia
     action (observe) var MM.Dawgolesh 1 when Dawgolesh
     action (observe) var MM.Merewalda 1 when Merewalda
     action (observe) var MM.Morleena 1 when Morleena
     action (observe) var MM.Penhetia 1 when Penhetia
     action (observe) var MM.Durgaulda 1 when Durgaulda
     action (observe) var MM.Erqutra 1 when Erqutra
     action (observe) var MM.Kertigen 1 when Kertigen
     action (observe) var MM.Dergati 1 when Dergati
     action (observe) var MM.Ismenia 1 when Ismenia
     action (observe) var MM.Amlothi 1 when Amlothi
     action (observe) var MM.Scales 1 when Scales
     action (observe) var MM.Brigantine 1 when Brigantine
     action (observe) var MM.Erquta 1 when Er'quta

     #### STARTING - NEED TO BUILD THIS OUT - MAKE CHECKS FOR EACH POOL OF MAGIC AND ONLY PREDICT WHEN COMPLETE
     action (observe) var Pool.Magic $1 when ^You have (?:a )?(.+) understanding of the celestial influences over magic\.
     action (observe) var Pool.Lore $1 when ^You have (?:a )?(.+) understanding of the celestial influences over lore\.
     action (observe) var Pool.Offense $1 when ^You have (?:a )?(.+) understanding of the celestial influences over offensive combat\.
     action (observe) var Pool.Defense $1 when ^You have (?:a )?(.+) understanding of the celestial influences over defensive combat\.
     action (observe) var Pool.Survival $1 when ^You have (?:a )?(.+) understanding of the celestial influences over survival\.
     action (observe) var Pool.Magic complete when ^You believe you've learned all that you can about magic\.
     action (observe) var Pool.Survival complete when ^You believe you've learned all that you can about survival\.
     action (observe) var Pool.Lore complete when ^You believe you've learned all that you can about lore\.
     action (observe) var Pool.Offense complete when ^You believe you've learned all that you can about offensive combat\.
     action (observe) var Pool.Defense complete when ^You believe you've learned all that you can about defensive combat\.

     # Necro Zombie Triggers
     action (necro) var activezombie 0;var zombie 0 when ^You sense your Call from Beyond spell weaken and disperse
     action (necro) var activezombie 0;var zombie 0 when ^As if racing to catch up\, the decay process quickly overcomes an arisen caracal zombie\.  Putrid flesh withers and evaporates into a rancid cloud\, leaving brittle\, mottled bones behind that crumble to dust the moment they contact air\.
     action (necro) var activezombie 0;var zombie 0 when ^You do not have a zombie to command\!
     # Necro Justice Triggers
     var criminals sorcerer|monster|necromancer|criminal
     action (necro) var Known.Shard 1 when (%criminals) .+ (Shard|Ilithi)|(Shard|Ilithi) .+ (%criminals)
     action (necro) var Known.Cross 1 when (%criminals) .+ (Crossing|Zoluren)|(Crossing|Zoluren) .+ (%criminals)
     action (necro) var Known.Leth 1 when (%criminals) .+ (Leth Deriel|Zoluren)|(Leth Deriel|Zoluren) .+ (%criminals)
     action (necro) var Known.Hib 1 when (%criminals) .+ (Hibarnhvidar|Forfedhdar)|(Hibarnhvidar|Forfedhdar) .+ (%criminals)
     action (necro) var Known.Theren 1 when (%criminals) .+ (Therengia|Therenborough)|(Therengia|Therenborough) .+ (%criminals)
     action (necro) var Known.Muspari 1 when (%criminals) .+ (Muspar'i|Therengia)|(Muspar'i|Therengia) .+ (%criminals)
     action (necro) var Known.Haven 1 when (%criminals) .+ (Riverhaven|Therengia)|(Riverhaven|Therengia) .+ (%criminals)
     action (necro) var Known.Ratha 1 when (%criminals) .+ (Ratha|Qi'Reshalia)|(Ratha|Qi'Reshalia) .+ (%criminals)
     action (necro) var Known.Aesry 1 when (%criminals) .+ (Aesry|Qi'Reshalia)|(Aesry|Qi'Reshalia) .+ (%criminals)
     action (necro) var City.Known 1 when the (people|citizens|folk) are convinced .+ (%criminals)
     # Necro Ritual Triggers
     action (necro) var Know.Butchery 1 when Butchery\:
     # Necro Healing Triggers
     action (necroheal) var devour 1;var performed 0 when ^Tiny streams of viridian and copper leap from your outstretched hand
     action (necroheal) var devour 0 when ^You feel the feverish heat in your flesh gradually subside\.
     action (necroheal) var performed 1;var killed 0 when ^You kneel over the|Lacking any ritually prepared corpses or material,|.* kneels over the ship's rat's corpse briefly and makes a few quick, precise cuts with a knife
     action (necroheal) var killed 1 when and lies still\.
     action (necroheal) var healme 1 when ^Your body
     action (necroheal) var healme 0 when ^You have no significant injuries\.
     action (necroheal) var healme 0 when ^You have a dormant infection
     action (necroheal) var nerves 1 when ^Currently lacking the skill to complete the pattern, your spell fails completely\.
     action (necroheal) var nerves 0 when ^You gesture

     ## CLERIC
     action (communes) var OrbFull 1 when you realize that you are not skilled enough to harness this combination of spells into the magic of its core
     action (communes) put #var UC_meraud 0;put #var UC_truffenyi 0;put #var UC_eluned 0;put #var UC_tamsine 0 when ^You are not a vessel for the gods at present\.
     action (communes) put #var UC_truffenyi 1 when ^The power of Truffenyi has answered your prayer\.|The glass orb lands unerringly on your palm|^Truffenyi's power still holds your attention\.|Truffenyi is smiling down on (you|the area)|^The area is touched by Truffenyi\.|The miracle of Truffenyi has manifested about (you|the area)\.|^The power of Truffenyi is channeling through (you|the area)\.|^The area is being favored by Truffenyi\.|^The blessing of Truffenyi is with (you|the area)\.|^Truffenyi's benevolent eyes are upon (you|the area)\.|^A spark of Truffenyi's spirit is within (you|the area)\.|^(You|The area) (is|are) under the auspices of Truffenyi|^Truffenyi's influence is woven into your spirit\.
     # action var truffenyi 0 when
     action (communes) put #var UC_tamsine 1 when ^You feel warmth spread throughout your body\, making the very ends of your hair tingle\.
     action (communes) put #var UC_tamsine 1 when ^You have been recently enlightened by Tamsine\.|^Tamsine's power still holds your attention\.|Tamsine is smiling down on (you|the area)|^The area is touched by Tamsine\.|The miracle of Tamsine has manifested about (you|the area)\.|^The power of Tamsine is channeling through (you|the area)\.|^The area is being favored by Tamsine\.|^The blessing of Tamsine is with (you|the area)\.|^Tamsine's benevolent eyes are upon (you|the area)\.|^A spark of Tamsine's spirit is within (you|the area)\.|^(You|The area) (is|are) under the auspices of Tamsine|^Tamsine's influence is woven into your spirit\.
     action (communes) put #var UC_tamsine 0 when ^The vibrant blue nimbus of Tamsine's blessing fades from around you\.
     action (communes) put #var UC_meraud 1 when ^You close your eyes and concentrate\, letting your mind still and feeling your breathing grow shallow\.|^Meraud's power still holds your attention\.|Meraud is smiling down on (you|the area)|^The area is touched by Meraud\.|The miracle of Meraud has manifested about (you|the area)\.|^The power of Meraud is channeling through (you|the area)\.|^The area is being favored by Meraud\.|^The blessing of Meraud is with (you|the area)\.|^Meraud's benevolent eyes are upon (you|the area)\.|^A spark of Meraud's spirit is within (you|the area)\.|^(You|The area) (is|are) under the auspices of Meraud|^Meraud's influence is woven into your spirit\.
     action (communes) put #var UC_meraud 0 when ^The holy presence in the area fades quietly away|^You sense your connection to the area you consecrated earlier fade away\.
     action (communes) var HaveAnloral 1;var Anloral $1 when [Aa]nloral (\w+) pin
     action (communes) var HaveCandle 1 when (altar|votive) candle
     action (communes) var BathFull YES when waters of the pool are currently (very full|almost overflowing)\,
     action (communes) var DanceComplete YES when ^Your dance reaches its conclusion (flawlessly|at last|a perfect)\,|^You are not experienced enough to do this yet\.|^In your condition\?
     action (communes) var HaveChamomile 1 when a bag of chamomile
     action (communes) var HaveIncense 1 when (a stick of|some) (fragrant|burnt|blessed|sandalwood|yellow) incense
     action (communes) var HaveLavender 1 when a bag of lavender
     action (communes) var HaveSage 1 when a bag of sage
     action (communes) var HaveWine 1 when (red|silver|grey|modwyn|sacramental|golden) wine
     action (communes) var HaveFlint 1 when piece of black flint
     action (communes) var HaveDirt 1 when some dirt|full of dirt|three quarters full
     action (communes) var Winter YES when currently winter
     action (communes) var tamsine 1 when ^ - Tamsine -
     action (communes) var eluned 1 when ^The Blessing of Water
     action (communes) var kertigen 1 when ^ - Kertigen -
     action (communes) var hodierna 1 when ^ - Hodierna -
     action (communes) var meraud 1 when ^ - Meraud -
     action (communes) var glythtide 1 when ^ - Glythtide -
     action (communes) var truffenyi 1 when ^ - Truffenyi -

     ## JAIL TRIGGERS
     action (jail) goto JAIL_CHECK when a sound not unlike that of a tomb|binds you in chains|firmly off to jail|brings you to the jail|binds your hands behind your back
     action (jail) goto JAIL_CHECK when ^Arriving at the jail, the guard submits you to a brutal strip search
     action (jail) goto JAIL_CHECK when your (belongings|possessions) have been stripped|in a jail cell wearing a set of heavy manacles|strip you of all your possessions
     action (jail) goto JAIL_CHECK when the last thing you see before you black out|You are a wanted criminal, $charactername|As you are brought to the jailhouse
     action (jail) goto JAIL_CHECK when Your silence shall be taken as an indication of your guilt|The eyes of the court are upon you|Your silence can only be taken as evidence of your guilt
     action (jail) goto JAIL_CHECK when all your belongings have been stripped|^The guard brings you to the jail|strip you of all your possessions|Muspar'i constable marches you off
     action (jail) goto JAIL_CHECK when Several of the guards quickly tackle you\!|As you are brought to the jailhouse
     # action (jail) goto JAIL_CHECK when You hear the cries echo around you as everyone in the vicinity suddenly moves away|\"Burn him\!\s+Burn him\!\"
     action var fine 0;var platfine 0;var goldfine 0;var silverfine 0;var bronzefine 0;var copperfine 0;if ($1) then evalmath platfine $1*10000;if ($2) then evalmath goldfine $2*1000;if ($3) then evalmath silverfine $3*100;if ($4) then evalmath bronzefine $4*10;if ($5) then var copperfine $5;evalmath fine %platfine+%goldfine+%silverfine+%bronzefine+%copperfine when (I pronounce a fine upon you of|I hereby fine you a total of) (?:(\d+) platinum[,.]?)?(?:(?: and)? ?(\d+) gold[,.]?)?(?:(?: and)? ?(\d+) silver[,.]?)?(?:(?: and)? ?(\d+) bronze[,.]?)?(?:(?: and)? ?(\d+) copper\.)?
     action goto DEBT when OUT.OF.FUNDS\!

     ### HERB TRIGGERS
     action (herbs) var prep_aevaes $1;var have_aevaes 1 when aevaes (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_aevaes leaf;var have_aevaes 1 when aevaes leaves
     action (herbs) var prep_aevaes mead;var have_aevaes 1 when mead flavored with aevaes
     action (herbs) var prep_aloe $1;var have_aloe 1 when aloe (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_aloe leaf;var have_aloe 1 when aloe leaves
     action (herbs) var prep_belradi $1;var have_belradi 1 when dioica (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_blocil $1;var have_blocil 1 when blocil (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_blocil leaf;var have_blocil 1 when blocil leaves
     action (herbs) var prep_blocil scone;var have_blocil 1 when blocil berry scone
     action (herbs) var prep_cebi $1;var have_cebi 1 when cebi (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_cebi leaf;var have_cebi 1 when cebi leaves
     action (herbs) var prep_dioica $1;var have_dioica 1 when dioica (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_eghmok $1;var have_eghmok 1 when eghmok (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_eghmok leaf;var have_eghmok 1 when eghmok leaves
     action (herbs) var prep_georin $1;var have_georin 1 when georin (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_georin leaf;var have_georin 1 when georin leaves
     action (herbs) var prep_hisan $1;var have_hisan 1 when hisan (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|paste|pie|pollen|porridge|potion|powder|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|yogurt|draught)
     action (herbs) var prep_hisan leaf;var have_hisan 1 when hisan leaves
     action (herbs) var prep_hulnik $1;var have_hulnik 1 when hulnik (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_hulnik leaf;var have_hulnik 1 when hulnik leaves
     action (herbs) var prep_ithor $1;var have_ithor 1 when ithor (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_ithor leaf;var have_ithor 1 when ithor leaves
     action (herbs) var prep_jadice $1;var have_jadice 1 when jadice (balm|berries|coffee|elixir|flower|grass|leaf|mash|moss|potion|powder|pulp|root|salve|sap|solution|stem|tea|tincture)
     action (herbs) var prep_jadice leaf;var have_jadice 1 when jadice leaves
     action (herbs) var prep_jadice sticky-bun;var have_jadice 1 when jadice pollen sticky-bun
     action (herbs) var prep_junliar $1;var have_junliar 1 when junliar (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_junliar leaf;var have_junliar 1 when junliar leaves
     action (herbs) var prep_lujeakave $1;var have_lujeakave 1 when lujeakave (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_lujeakave leaf;var have_lujeakave 1 when lujeakave leaves
     action (herbs) var prep_muljin $1;var have_muljin 1 when muljin (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_muljin leaf;var have_muljin 1 when muljin leaves
     action (herbs) var prep_nemoih $1;var have_nemoih 1 when nemoih (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_nemoih leaf;var have_nemoih 1 when nemoih leaves
     action (herbs) var prep_nilos $1;var have_nilos 1 when nilos (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_nilos leaf;var have_nilos 1 when nilos leaves
     action (herbs) var prep_plovik $1;var have_plovik 1 when plovik (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_plovik leaf;var have_plovik 1 when plovik leaves
     action (herbs) var prep_riolur $1;var have_riolur 1 when riolur (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_riolur leaf;var have_riolur 1 when riolur leaves
     action (herbs) var prep_riolur cookie;var have_riolur 1 when riolur shortbread cookie
     action (herbs) var prep_sufil $1;var have_sufil 1 when sufil (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_sulfil leaf;var have_sufil 1 when sulfil leaves
     action (herbs) var prep_yelith $1;var have_yelith 1 when yelith (ale|balm|berries|berry|brandy|bread|brownie|butter|cake|coffee|cookie|cornbread|draught|drink|elixir|flower|grass|jam|kefir|leaf|mash|mead|moss|ointment|paste|pie|pollen|porridge|potion|powder|poultice|puff-pastry|pulp|root|salve|sap|sauce|scone|smoothie|solution|spread|stem|sticky-bun|tart|tea|tincture|tonic|ungent|yogurt)
     action (herbs) var prep_yelith leaf;var have_yelith 1 when yelith leaves
     #################################
     action (research) off
     action (sorcery) off
     action (backtraining) off
     action (combat) off
     action (communes) off
     action (debt) off
     action (dead) on
     action (escape) off
     action (exp_mods) off
     action (footitem) off
     action (gemprofit) off
     action (herbs) off
     action (inventory) off
     action (jail) on
     action (magic) off
     action (main) off
     action (moving) off
     action (necro) off
     action (necroheal) off
     action (observe) off
     action (offhand) off
     action (PVP) off
     action (PVPPLAYER) off
     action (reconnect) on
     action (retreat) off
     action (shield) off
     action (skip) off
     action (stunned) off
     action (switch) off
     action (TF) off
##### END OF DEFAULT TRIGGERS SETUP
#######################################################################
### BEGINNING CHECKS
     action (combat) on
     delay 0.00001
     put exp 0
     wait
     pause 0.0001
     gosub GUILD_CHECK
#######################################################################
#### SET ALL BASE LOCAL VARIABLES
#######################################################################
#### DON'T FUCK WITH THESE!!! YOU BREAK THIS I BREAK YO FACE!~
BASE_VARS:
     var LAST BASE_VARS
     var TOTAL.MAXRANKS 1750
     var LOCALMAX 1750
     var MinLearnRate 4
     var LEARNING.INCREASE 3
     var MAX.LEARNINGRATE 34
     var RangedWeapons 1
     var Collect.Combat 1
     var melee 1
     var Dump.Combat 1
     var XP.RESET ON
     #########
     var BoxActive 0
     var AutoLooted 0
     var Teleport 0
     var combatadd 0
     var loading 0
     var precheck 0
     var town 0
     var wealth 0
     var debt 0
     var fine 0
     var kills 0
     var skins 0
     var shield 0
     var ranged 0
     var invcount 0
     var GemsFull 0
     var InCombat 0
     var indoors 0
     var High.Switch 0
     var nozills 0
     var LOGOFF 0
     var TIMEOUT 0
     var Ranks 0
     var TotalProfit 0
     var Playing 0
     var Moving 0
     var NoHands 0
     var Foci.Active 0
     var townRun 0
     var Tipping 0
     var GemsFull 0
     var swapped 0
     var newdead 0
     var Skip.Repair 0
     var sheathed 0
     var skinned 0
     var Teaching 0
     var Listening 0
     var TeachingLoop 0
     var spelltimer
     var summoning 0
     var total.armor 0
     var TicketCheck 0
     var ClericCheck 0
     var almanac.count 0
     var Bundle.Wear 0
     var spider.start 0
     var burgling 0
     var burgleheal 0
     var Observe 0
     var dissectcount 0
     var dissectloop 0
     var dissectfail 0
     var skinningcount 0
     var pouchsold 0
     var NecroHealing 0
     var BundleCount 0
     var BundleTied 0
     var AmmoRestock 0
     var BuyRocks 0
     var BuyArrows 0
     var BuyBolts 0
     var tiedPouch 0
     var TotalKills 0
     var TotalSkins 0
     var TotalBoxes 0
     var GemTotal 0
     var SETUP 0
     var healrun 0
     var weaponload 0
     var Germish.Alert 0
     var assesscheck 0
     var ammolodged 0
     var COMBAT.ROOM 0
     var COMBAT.ZONE 0
     var NoCombat 0
     var NoCambTM 0
     var NOCAST 0
     var XBOW.OFF 0
     var SLING.OFF 0
     var BOW.OFF 0
     var brocketcount 3
     var Melee.Range 0
     var Pole.Range 0
     var Removed.Armor 0
     var SNAP.FIRE 0
     var AUTO.PROGRESS OFF
     var PROGRESS.TYPE NORMAL
     var BACKTRAIN.AUTOPROGRESS OFF
     var BACKTRAIN.PROGRESS.TYPE NORMAL
     var CRITTER.GUI OFF
     var WEAPON.GUI OFF
     var WEAPON.LEARN OFF
     var Blacklist NULL
     var Custom.Script NULL
     var hometown NULL
     var kill.target NULL
     var LEARNING LOADING
     var NextSkill NULL
     var MAINARROW NULL
     var WM.Weapon NULL
     var LeucroAction NULL
     var facing NULL
     var ALLWEAPONS NULL
     var ALTWEAPON NULL
     var TiePouch OFF
     var Gempouch.Worn OFF
     var TrainStealth OFF
     var Dissect ON
     var Skin ON
     var Bundle OFF
     var TieBundle OFF
     var BundleLocation over shoulder
     var ArrangeTarget skin
     var ArrangeAll OFF
     var ArrangeAlways OFF
     var Max.Boxes 12
     var MaxBundle 200
     var Retreat OFF
     var APPRAISE OFF
     var HUNT OFF
     var APP.ITEMS OFF
     var BACKTRAIN.STEALTH OFF
     var BACKTRAIN.TM OFF
     var combatsToTrain
     var COMBAT.CRITTER NULL
     var ALTERNATE.CRITTER NULL
     var HEAL.CITY NULL
     var CurrentDW NULL
     var escaping OFF
     var expertise OFF
     var lastmoved NULL
     var SAFE.ROOM NULL
     var SAVED NULL
     var MANEUVER NULL
     var PRIORITY.ROOMS NULL
     var CRITTER.ROOMS NULL
     var BACKTRAIN.PRIORITY.ROOMS NULL
     var Wear.Weapons NULL
     var Priority.Weapons NULL
     var FlintKnife NULL
     var IGNITE.WEAPON NULL
     var Sheath.1 NULL
     var Sheath.1.Weapons NULL
     var Sheath.2 NULL
     var Sheath.2.Weapons NULL
     var Sheath.3 NULL
     var Sheath.3.Weapons NULL
     var Sheath.4 NULL
     var Sheath.4.Weapons NULL
     var Sheath.5 NULL
     var Sheath.5.Weapons NULL
     var Sheath.6 NULL
     var Sheath.6.Weapons NULL
     var Sheath.Weapons NULL
     var Juggernaut.Orb OFF
     var WEAPON NULL
     var WEAPON2 NULL
     var WeaponSet 0
     var lastTrained NULL
     var tenthTrained NULL
     var ninthTrained NULL
     var eighthTrained NULL
     var seventhTrained NULL
     var sixthTrained NULL
     var fifthTrained NULL
     var fourthTrained NULL
     var thirdTrained NULL
     var secondTrained NULL
     var firstTrained NULL
     var allTrained NULL
     var CHEST.ARMOR NULL
     var FACE.ARMOR NULL
     var HEAD.ARMOR NULL
     var ABDOMEN.ARMOR NULL
     var BACK.ARMOR NULL
     var ARM.ARMOR NULL
     var HAND.ARMOR NULL
     var LEG.ARMOR NULL
     var KNUCKLE hand claws
     var PARRYSTICK NULL
     var B.CHEST.ARMOR NULL
     var B.FACE.ARMOR NULL
     var B.HEAD.ARMOR NULL
     var B.ABDOMEN.ARMOR NULL
     var B.BACK.ARMOR NULL
     var B.ARM.ARMOR NULL
     var B.HAND.ARMOR NULL
     var B.LEG.ARMOR NULL
     var B.KNUCKLE NULL
     var armor1 NULL
     var armor2 NULL
     var armor3 NULL
     var armor4 NULL
     var armor5 NULL
     var armor6 NULL
     var armor7 NULL
     var ARMOR.ABDOMEN NULL
     var ARMOR.CHEST NULL
     var ARMOR.ARMS NULL
     var ARMOR.HANDS NULL
     var ARMOR.HEAD NULL
     var ARMOR.BACK NULL
     var ARMOR.FACE NULL
     var ARMOR.LEGS NULL
     var ARMOR.KNUCKLE NULL
     var ARMORSWAP OFF
     var orbtype
     var BundleLocation NULL
     var Container NULL
     var Container.Boxes NULL
     var Container.Backup NULL
     var Container.Crafting NULL
     var Container.Ammo NULL
     var Container.Ammo.Backup NULL
     var Container.GemPouch NULL
     var Container.EmptyPouch NULL
     var Container.Sheath NULL
     var Container.Dirt NULL
     var Rope.Container NULL
     var Almanac.Container NULL
     var Lockpick.Container NULL
     var Textbook.Container NULL
     var Wand1.Container NULL
     var Wand2.Container NULL
     var Wand1.Use 0
     var Wand2.Use 0
     var Ritual.Container NULL
     var TMFoci.Container NULL
     var Ingot.Container NULL
     var IngotContainer NULL
     var Container.Herb NULL
     var Telescope.Container NULL
     var WandWeapon NULL
     var REPAIR.KIT NULL
     var REPAIR.KIT.CONTAINER NULL
     var REPAIR.KIT.2 NULL
     var REPAIR.KIT.2.CONTAINER NULL
     var REPAIR.KIT.WEAPON NULL
     var REPAIR.KIT.ARMOR NULL
     var REPAIR.KIT.3.CONTAINER NULL
     var SKINTRAINER OFF
     var SKINTRAIN.NOUN crocodile
     var SKINTRAIN.CONTAINER NULL
     var Skinning.Knife $UC_Skinner
     var nocheck NULL
     var DISSECTING ON
     var Loot.Monsters ON
     var Loot.Option goods
     var Loot.Gems ON
     var Loot.Boxes ON
     var Loot.Metals ON
     var Loot.Scrolls ON
     var Loot.Collectibles OFF
     var Loot.SpiderParts OFF
     var B.Loot.Gems ON
     var B.Loot.Boxes OFF
     var B.Loot.Metals ON
     var B.Loot.Scrolls ON
     var B.Loot.Collectibles OFF
     var B.Loot.SpiderParts OFF
     var B.Loot.Option goods
     var Orb.Rub OFF
     #########################
     var HOME.CITY NULL
     var REPAIR.KIT NULL
     var REPAIR.KIT.WEAPON NULL
     var REPAIR.KIT.ARMOR NULL
     var RESEARCH.TYPE NULL
     var JewerlyVerb NULL
     var PocketEmpath NULL
     var CRAFTING.BAG NULL
     var PirpList NULL
     var TMFoci.Container NULL
     var TypeAmbush NULL
     var RETURN.TO.COMBAT ON
     var AUTOHEAL ON
     var HEAL.ALL ON
     var SELLSKINS ON
     var SELLGEMS ON
     var BANKRUN ON
     var ROAMING ON
     var INVCHECK ON
     var TRASH.DUMP OFF
     var POUCH.DUMP OFF
     var GET.FAVORS ON
     var BURGLE OFF
     var BURGLE.PAWN OFF
     var BURGLE.DUMP OFF
     var STEAL OFF
     var HERBS OFF
     var CLIMBING OFF
     var COLLECTING OFF
     var BRAIDING OFF
     var RAVEN OFF
     var TEXTBOOK OFF
     var MAGICAL.RESEARCH ON
     var FAVOR.GOD meraud
     var MAGIC.ROPE OFF
     var LOG.ON.DEATH ON
     var LOG.ON.STUN OFF
     var NO.CONTACT OFF
     var FANGCOVE OFF
     var POWERWALK OFF
     var JumpJewelry OFF
     var CLAN OFF
     var GOSUBBING OFF
     var ALCHEMY OFF
     var ENGINEERING OFF
     var OUTFITTING OFF
     var FORGING OFF
     var ENCHANTING OFF
     var VAULT.SWAP OFF
     var VAULT.CITY cross
     var Shard.Citizen OFF
     var TEACH OFF
     var ALCHEMY OFF
     var ENGINEERING OFF
     var FORGING OFF
     var OUTFITTING OFF
     var ENCHANTING OFF
     var WINDBOARD OFF
     var PERFORMANCE OFF
     var RPA OFF
     var Tarantula OFF
     var Tarantula.Name tarantula
     var TEACH.SKILL evasion
     var Zill.Name zills
     var person NULL
     var Bonded OFF
     var Ambush OFF
     var PLEAD guilty
     #############
     var TotalRope 0
     var TotalPouches 0
     var AltPouches 0
     var TotalLead 0
     var HaveTorch 0
     var HaveFlint 0
     var HaveCandle 0
     var HaveIncense 0
     var HaveWine 0
     var HaveSage 0
     var HaveFlint 0
     var HaveLavender 0
     var HaveChamomile 0
     var HaveDirt 0
     var HaveOil 0
     var NeedOil 0
     var HaveSkates 0
     var HaveFragment 0
     var HaveFragSack 0
     var HaveTicket 0
     var HaveAnloral 0
     var HaveSmallSack 0
     var HaveLargeSack 0
     var HaveLighter 0
     var HaveGaethzen 0
     var HaveGoggles 0
     var HaveLantern 0
     var HaveStarglass 0
     var Necro.Material 0
     var Necro.Parts 0
     ###################
     var have_aevaes 0
     var have_aloe 0
     var have_dioica 0
     var have_belradi 0
     var have_junliar 0
     var have_blocil 0
     var have_cebi 0
     var have_eghmok 0
     var have_georin 0
     var have_hisan 0
     var have_hulnik 0
     var have_ithor 0
     var have_jadice 0
     var have_lujeakave 0
     var have_muljin 0
     var have_nemoih 0
     var have_nilos 0
     var have_plovik 0
     var have_riolur 0
     var have_sufil 0
     var have_yelith 0
#########################################################
     ## WEAPON DEFAULT VARS
     var Light_Thrown Light_Thrown
     var Bow Bow
     var Crossbow Crossbow
     var Small_Edged Small_Edged
     var Large_Edged Large_Edged
     var Twohanded_Edged Twohanded_Edged
     var Large_Blunt Large_Blunt
     var Twohanded_Blunt Twohanded_Blunt
     var Polearm Polearms
     var Heavy_Thrown Heavy_Thrown
     var Slings Slings
     var Offhand_Weapon Offhand_Weapon
     var Backstab Backstab
     var Stave Staves
     var Brawling Brawling
     var Small_Blunt Small_Blunt
     ###################
     var BACKTRAIN.SE NULL
     var BACKTRAIN.LE NULL
     var BACKTRAIN.THE NULL
     var BACKTRAIN.SB NULL
     var BACKTRAIN.LB NULL
     var BACKTRAIN.THB kertig NULL
     var BACKTRAIN.STAVES NULL
     var BACKTRAIN.POLEARMS NULL
     var BACKTRAIN.BOW NULL
     var BACKTRAIN.CROSSBOW NULL
     var BACKTRAIN.SLING NULL
     var BACKTRAIN.LT NULL
     var BACKTRAIN.HT NULL
     var BACKTRAIN.BRAWL $charactername
     var BACKTRAIN.OH NULL
     var BACKTRAIN.BS NULL
     ###################
     var SE.STANCE NULL
     var LE.STANCE NULL
     var THE.STANCE NULL
     var SB.STANCE NULL
     var LB.STANCE NULL
     var THB.STANCE NULL
     var POLEARMS.STANCE NULL
     var STAVES.STANCE NULL
     var BOW.STANCE NULL
     var CROSSBOW.STANCE NULL
     var SLINGS.STANCE NULL
     var LT.STANCE NULL
     var HT.STANCE NULL
     var OH.STANCE NULL
     var BRAWL.STANCE NULL
     ####################
     var Khri.Town ON
     var khriSTEADY ON
     var khriSTRIKE ON
     var khriFOCUS ON
     var khriHASTEN ON
     var khriELUSION ON
     var khriENDURE OFF
     var khriELIMINATE OFF
     var khriINTIMIDATE OFF
     var khriAVOIDANCE OFF
     var khriADAPTATION OFF
     var khriPROWESS OFF
     var khriPLUNDER OFF
     var khriTERRIFY OFF
     var khriSIGHT OFF
     var khriFLIGHT OFF
     var khriSAGACITY OFF
     var khriHARRIER OFF
     var khriDARKEN OFF
     var khriDAMPEN OFF
     var khriSHADOWSTEP OFF
     var khriEVANESCENCE OFF
     var khriGUILE OFF
     var khriCREDENCE OFF
     var khriCALM OFF
     var khriSERENITY OFF
     var khriFRIGHT OFF
     var khriCUNNING OFF
     var khriSAFE OFF
##### Default Tarantula Skills to check
     var Magic.skills Primary_Magic|Augmentation|Utility|Warding|Debilitation|Targeted_Magic
     var Armor.skills Defending|Shield_Usage|Plate_Armor|Brigandine|Chain_Armor|Light_Armor
     var Survival.skills Evasion|Skinning|Perception|Stealth|Athletics|First_Aid|Locksmithing
     var Weapons.skills Parry_Ability|Melee_Mastery|Missile_Mastery|Brawling|Twohanded_Edged|Small_Edged|Large_Edged|Twohanded_Blunt|Large_Blunt|Small_Blunt|Polearms|Staves|Bow
     var Lore.skills Appraisal|Tactics|Performance
#########################################################################################################################
##### HARDCODED MONSTERS / ITEM / MISC VARIABLES
#########################################################################################################################
     var ALLSWAPPABLE (((thin|thick|diacan|bronze|steel|kertig|icesteel|glaes|golden|silversteel)\-?bladed |dreamweave |golden |silk |aeromancer's|avia ))fan|bastard sword|war sword|war icon|leather-wrapped war axe|broadaxe|bar mace|boarding axe|double-headed battle axe|splitting maul|riste|tekkan|(?<!telothian )katana|partisan with a fiery|partisan with a broad|throwing spike|icy-blue blade|calcified leaf|ox-tongue spear with a stout iron-studded haft|hunter's spear|glaive|steel-tipped staff|leaf-blade spear|(?<!thick |barbed |grooved )predator's spear|segmented club|large wooden crutch|barbed trident|impalement spike|faldenblade|pahapo|ironwood-hafted scorpion|iron-capped war club|(((heavy |blackened |slender )steel |petite bodice ))dagger(?! with a gladiolus-shaped hilt)|(giant |light |blackened |steel )war mallet|staecklumba|short (bone|iron|steel) spear|threefold staff|marlingspike|sharpened icon
     #############
     var gemlist topaz| star-stone|\bamber(?! andalusite)| agate| alexandrite| ambergris| amethyst| aquamarine| bead| beryl|(?<!spiraling oak staff topped with a large uncut) bloodgem| bloodstone| carnelian| chakrel| chalcedony| chrysoberyl| chrysoprase| citrine| coral|(?<!sanowret) crystal| diamond| diopside| egg| eggcase| emerald| garnet| gem| glowstone| glossy malachite| goldstone|(chunk of|some|tiny amber(?! andalusite)|piece of)\s(silver|gold|platinum|quartz)-laced\sgranite| hematite| iolite| ivory| ivory tooth| jade| jasper| kunzite| lapis lazuli| malachite stone| minerals| moonstone| morganite| onyx| opal| pearl| pebble| peridot| ruby| sapphire| spinel| sunstone|(?<!draconian) talon| tanzanite| topaz| tourmaline| tsavorite| thealstone| turquoise(?! andalusite)| zircon| andalusite| crystal shard| waermodi stone
     var bitch.gems quartz|andalusite|amber
     var badGems (tukai|jadeite) (stone)
     ## UNDEAD MONSTERS
     var UndeadMonsters [Aa]sketian harbinger|[Aa]sketian Herald|black zephyr|blue ghast|blood wraith|bone golem|dark spirit|death spirit|drowned \S+|deadwood dryad|fell hog|fiend|emaciated umbramagus|faenrae assassin|ghoul raven|maelshyvean heirophant|blightwater nyad|olensari mihmanan|plague wraith|snaer hafwa|shylvic|skorik nadhar|spectral pirate|skeletal peon|spectral sailor|skeletal sailor|skeleton|telga orek|ur hhrki'izh|misenseor resuscitant|revenant conscript|revenant zombie|revivified mutt|tortured soul|wir dinego|xala'shar vindicator|xala'shar slayer|yeehar|zombie goblin|zombie kobold headhunter|zombie stomper|zombie mauler|zombie head-splitter|zombie nomad|undead gerbil|frostcrone
     var SkinnableUndead eidolon steed|enraged tusky|ghoul|ghoul crow|grendel|lach|mastiff|misshapen germish'din|bone wyvern|ice adder|mutant togball|reaver|squirrel|death squirrel|kobold headhunter|shadow hound|shadow beast|sinister maelshyvean heirophant|kobold savage|blight bat|\bgrub\b|wight|red leucro
     ## CONSTRUCTS
     var SkinnableConstructs granite gargoyle|lava drake|black marble gargoyle|quartz gargoyle|onyx gargoyle|[Ee]ndrus serpent|shadowfrost moth
     var Constructs [Aa]shu hhinvi|boggle|bone amalgam|clay archer|clay mage|clay soldier|clockwork assistant|gam chaga|glass construct|granite gargoyle|lachmate|lava drake|marble gargoyle|quartz gargoyle|(marble|obsidian|quartzite|rock) guardian|rough-hewn doll|ice archon|mechanical mouse|beltunumshi|guardian|origami bird|gargoyle|origami cow|origami dragon|origami duck|origami goblin|origami grasshopper|origami hat|origami mouse|origami sprite|origami yak|origami paper|small sand dune|miniscule bowl|miniscule knife|miniscule knife|miniscule fork|miniscule griddle|miniscule lid|miniscule pan|miniscule plate|miniscule pot|miniscule spoon|miniscule teapot
     ## EMPATH SPECIAL NO ATTACK (Mostly Cursed)
     var NoAttackMonsters wind hound|[Uu]rhhrki'izh|forest geni|[Xx]ala'shar (thrall|magus|vanquisher|archer|archimage|shredder|overseer)|lesser sluagh|moss mey|scythewing moth|spirit dancer|blood warrior|[Xx]ala'shar conjurer|umbral moth|sorcerer|blademaster|banyakea
     ## CURSED MONSTERS
     var CursedMonsters boggle|ice archon|wind hound|[Uu]rhhrki'izh|forest geni|[Xx]ala'shar (thrall|magus|vanquisher|archer|archimage|shredder|overseer)|wind hag|wind wretch|banyakea
     var SkinnableCursed lesser sluagh|moss mey|scythewing moth|marble gargoyle|cinder beast|gremlin|spirit dancer|blood warrior|[Xx]ala'shar conjurer|umbral moth|blight ogre|sorcerer|blademaster
     ## ALL SKINNABLE
     var SkinnableMonsters adult wyvern|angiswaerd hatchling|antelope|adder skeleton|arbelog|armadillo|armored warklin|arzumos|asaren celpeze|badger|barghest|basilisk|\bbear\b|beisswurm|\bbison\b|birdcatcher spider|black ape|blight ogre|blood warrior|bloodfish|\bboa\b|(wild|razortusk|heggarangi|damaska|zombie) boar|bobcat|boobrie|brocket deer|burrower|caiman|caracal|carcal|cave troll|cinder beast|cougar|\bcrab\b|crayfish|belly crocodile|\bdeer\b|dobek moruryn|faenrae stalker|firecat|\bfrog\b|gargoyle|(?<!origami) goblin|grass eel|gryphon|\bhawk\b|isundjen conjurer|jackal|juvenile wyvern|kartais|kobold|la'heke|larva|la'tami|leucro|\blizard\b|malchata|marbled angiswaerd|merrows|\bmoda\b|\bmoth\b|mottled westanuryn|musk hog|murky puddle|\bpard\b|peccary|pivuh|poloh'izh|pothanit|prereni|\bram\b|retan dolomar|rock troll|scaly seordmaor|scavenger troll|serpent|shadow beast|shadow mage|shalswar|shark|\brat\b|silverfish|sinuous elsralael|skunk|S'lai scout|sleek hele'la|sluagh|snowbeast|snow hawk|\bsow\b|spider|spirit dancer|storm bull|suw bizar|treehopper toad|tree snake|trollkin|\bunyn\b|viper|vulture|vykathi harvester|vykathi soldier|warcat|\bwasp\b|\bwolf\b|\bworm\b|warklin mauler|Xala'shar conjurer|young wyvern|snow goblin|moth|sorcerer|blademaster|cloud rat
     ## INVASION
     var InvasionCritters bone amalgam|bone warrior|[Ee]lpalzi (bowyer|deadeye|dissident|fomenter|hunter|incendiary|instigator|malcontent|malcontent|partisan|rebel|sharpshooter|toxophilite)|flea-ridden beast|putrefying shambler|revivified mutt|shambling horror|skeletal peon|transmogrified oaf
     ## ALL NON-SKINNABLE
     var NoSkinMonsters [Aa]shu hhinvi|atik'et|banshee|bloodvine|bucca|cabalist|charred husk|clay archer|clay mage|clay soldier|\bcrag\b|creeper|cutthroat|black slime|fanatic|[Dd]ragon priest|[Dd]ragon priest crone|[Dd]ragon priest assassin|[Dd]ragon priest intercessor|deadwood dryad|dummy|dusk ogre|dyrachis|eviscerator|faenrae assassin|fendryad|fire maiden|folsi immola|footpad|frostweaver|gander|geese|gam chaga|forest geni|gidii|goblin shaman|graverobber|guardian|gypsy marauder|\bimp\b|juggernaut|kelpie|kra'hei|kra'hei hatchling|lipopod|lun'shele hunter|madman|nipoh oshu|\bnyad\b|orc bandit|orc clan chief|orc raider|orc reiver|orc scout|pile of rubble|pirate|river sprite|ruffian|scout ogre|screamer|sentinel|shadow master|shadoweaver|(mountain|sky|scavenger) giant|sleazy lout|sprite|swain|swamp troll|telga moradu|\bthug\b|trekhalo|tress|umbramagii|velver|\bvine\b|vykathi builder|vykathi excavator|wood troll|young ogre|zealot|boggle|emaciated umbramagus|fiend|gargantuan bone golem|olensari mihmanan|plague wraith|revivified mutt|shylvic|skeletal peon|skeletal sailor|skeleton|skeleton kobold headhunter|skeleton kobold savage|snaer hafwa|(?<!watch)soul|spectral pirate|spectral sailor|death spirit|dark spirit|ur hhrki'izh|wind hound|wir dinego|zombie|zombie nomad|ashu hhinvi|boggle|bone amalgam|clay archer|clay mage|clay soldier|clockwork assistant|gam chaga|glass Construct|lachmate|ice archon|(alabaster|andesite|breccia|dolomite|marble|obsidian|quartzite|rock) guardian|rough-hewn doll|pile of broken ice|nyad|moneygrubber|skinflint|tightwad|pinchfist|voidspawn|xala'shar magus|xala'shar thrall|xala'shar vanquisher|xala'shar archer|xala'shar archimage|xala'shar vindicator|xala'shar overseer|xala'shar shredder|clan-chief|teardrinker|origami bird|origami cow|origami dragon|origami duck|origami goblin|origami grasshopper|origami hat|origami mouse|origami sprite|origami yak|origami paper|nimbus|fine ash|dryad|dryad priestess|jeol moradu|origami \w+|wind hag|wind wretch|smoldering bones|forest bandit
     ## RITUAL MONSTERS
     var RitualMonsters [Aa]shu hhinvi|atik'et|bloodfish|bloodvine|bucca|clay archer|clay mage|clay soldier|\bcrag\b|creeper|piruati serpent|kashika serpent|cutthroat|fanatic|[Dd]ragon priest|blood dryad|twisted dryad|nyad|toad|crab|dummy|dusk ogre|dyrachis|eviscerator|fendryad|fire maiden|folsi immola|footpad|frostweaver|gam chaga|forest geni|gidii|goblin shaman|graverobber|gremlin|guardian|gypsy marauder|\bimp\b|juggernaut|kelpie|kra'hei|kra'hei hatchling|lipopod|lun'shele hunter|madman|malchata|giant|nipoh oshu|\bnyad\b|orc bandit|clan-chief|orc raider|orc reiver|orc scout|pile of rubble|pirate|river sprite|ruffian|thug|scavenger troll|scout ogre|screamer|sentinel|shadow master|shadoweaver|sky giant|sleazy lout|sprite|swain|swamp troll|telga moradu|\bthug\b|trekhalo|tress|umbramagii|velver|\bvine\b|vykathi builder|vykathi excavator|wood troll|young ogre|zealot|angiswaerd hatchling|antelope|arbelog|armadillo|armored warklin|arzumo|asaren celpeze|badger|barghest|basilisk|\bbear\b|beisswurm|black ape|blight ogre|blood warrior|\bboa\b|(wild|razortusk|heggarangi|damaska|zombie) boar|bobcat|boobrie|brocket deer|burrower|caiman|caracal|carcal|cave troll|cinder beast|cougar|\bcrab\b|crayfish|belly crocodile|\bdeer\b|dobek moruryn|faenrae stalker|firecat|\bfrog\b|giant blight bat|(?<!origami) goblin|grass eel|\bgrub\b|gryphon|Isundjen conjurer|jackal|kartais|kobold|la'heke|larva|la'tami|leucro|marbled angiswaerd|merrows|\bmoda\b|\bmoth\b|mottled westanuryn|musk hog|\bpard\b|peccary|pivuh|poloh'izh|pothanit|\bram\b|\brat\b|retan dolomar|rock troll|scaly seordmaor|serpent|shadow beast|shadow mage|shalswar|silverfish|grub|wasp|wolf|caimen|razortusk sow|bison|sinuous elsralael|skunk|S'lai scout|sleek hele'la|sluagh|suw bizar|murky puddle|snowbeast|\bsow\b|spider|spirit dancer|steed|trollkin|\bunyn\b|viper|vulture|vykathi harvester|vykathi soldier|warcat|\bwasp\b|\bwolf\b|\bworm\b|prereni|pile of broken ice|moneygrubber|skinflint|tightwad|pinchfist|inkhorne|meadow ram|thunder ram|shark|selkie|slaver|reaper|river boa|lizard|morah vine|unyn|merrow|priestess|golden pard|ochre la'heke|jeol moradu|seordmaor|rhoat moda|nimbus|[Dd]arvager|piranha|crone|purifier|storm bull|warlkin mauler|snake|snow hawk|wyvern|intercessor|cabalist|moth|[Xx]ala'shar magus|[Xx]ala'shar thrall|[Xx]ala'shar vanquisher|[Xx]ala'shar archer|[Xx]ala'shar archimage|[Xx]ala'shar overseer|[Xx]ala'shar shredder|moss mey|[Uu]rhhrki'izh|sorcerer|blademaster|forest bandit
     ## LIVING MONSTERS
     var LivingMonsters toad|frog|\brat\b|lout|burrower|antelope|blood dryad|blood nyad|twisted dryad|deer|grub|wasp|wolf|caimen|caiman|razortusk sow|bison|musk hog|silverfish|gidii|madman|(?<!origami) goblin|crayfish|skunk|badger|crab|water sprite|trollkin|inkhorne|\beel\b|lipopod|kelpie|jackal|kobold(?! savage|headhunter)|spider|s'lai scout|wood troll|meadow ram|thunder ram|bucca|sand sprite|\bimp\b|caiman|rock troll|bobcat|vulture|suw bizar|murky puddle|snowbeast|gander|geese|forest geni|gremlin|shadow mage|sluagh|sand spider|young ogre|\bbear\b|cave troll|shark|moneygrubber|skinflint|tightwad|pinchfist|dyrachis|harvester|la'tami|swamp troll|selkie|slaver|hele'la|reaper|river boa|lizard|elsralael|fanatic|dusk ogre|fire sprite|wolf spider|creeper|morah vine|fire maiden|grave worm|firecat|graverobber|marauder|unyn|(?>[Kk]ashika |[Pp]iruati )serpent|pinchfist|footpad|ruffian|thug|cutthroat|fenrae stalker|dire bear|atik'et|lun'shele hunter|westanuryn|merrow|viper|hatchling|brocket deer|pirate|boar|nipoh oshu|leucro|priestess|frostweyr bear|frostweaver|golden pard|ochre la'heke|orc bandit|orc scout|bloodfish|moradu|seordmaor|fendryad|rhoat moda|barghest|warcat|peccary|prereni|gryphon|nimbus|[Dd]arvager|angiswaerd|dolomar|piranha|reiver|[Dd]ragon priest|crone|purifier|sentinel|warlkin mauler|malchata|storm bull|kra'hei|lun'shele trekhalo|giant|celpeze|orc raider|juggernaut|zealot|clan-chief|snow hawk|poloh'izh|armadillo|wyvern|[Dd]ragon priest assassin|intercessor|cabalist|moth|sorcerer|blademaster|tree snake|forest bandit|cloud rat
     ## ALL SKINS
     var Skinables \b(antenna|ashu'a|barb|beak|(?<!divination )bones?|bristle|carapace|catgut|pelt|claw|collarbone|ear|(?<!golden )eye|eyeball|(?<!curving )fang|feather|foreclaw|foreleg|(?<!iron |Iron )fragment|gland|hair|(?<!verdant )heart|(?<!wrapped in lava-drake )hide|hoof|horn(?! (crossbow|bow|latchbow|sling))|(?<!capped with a viciously sharp warklin )impaler|mandible|milk-tooth|mosshair|paw|pseudopod|quill|rib|sac|scale|scalp|shell|skin|sliver|(?<!book |along the )spine|spinneret|stinger|tail(?!brush|band)|talon|tentacle|toenail|tongue|(?<!angiswaerd |ivory )tooth|tusk|tusks|vertebra|wing|(?<!farmer's )hand)\b
     ## SET ALL CREATURES
     var cursedcritters %CursedMonsters|%SkinnableCursed
     var Undead %UndeadMonsters|%SkinnableUndead
     var Construct %Constructs|%SkinnableConstructs
     var nomanipulate %Construct|%Undead
     var skinnablecritters %SkinnableMonsters|%SkinnableUndead|%SkinnableConstructs|%SkinnableCursed
     var nonskinnablecritters %NoSkinMonsters|%UndeadMonsters|%Constructs|%CursedMonsters
     var critters %skinnablecritters|%InvasionCritters|%nonskinnablecritters|%nomanipulate
     var noUndead %LivingMonsters|%NoAttackMonsters|%Construct
     ## gosub RemoveDuplicatesFromArray %critters %critters
     eval critters tolower("%critters")
     #echo CRITTER LIST: %critters
     put #config monstercountignorelist appears dead|(dead)|shadowling|black squirrel|despondent Elothean|Riverhaven Warden|Shadow Servant|shadowling|the bartender Masul|alfar|shadow servent|human-sized construct|dirt construct|arisen|the Bacon Man|a cheerful Elven peddler|Estate Holder representative|town guard|domesticated gelapod|massive great horned owl with a disfigured beak|chubby bear|hazy phantom thrall|Shalvard|Elys|Quentin|Atladene|Yrisa|Tanalae|Onsuwayo|Yolesi|Amrillora|Srela|Fraethis|Gaktrhn|Dokt|Arthianna|Kaiva|Martyr Saedelthorp|Brokk|stony spawn|forest spawn|water spawn|plague spawn|grass spawn|harvest spawn|slimy spawn|thorny spawn|sandy spawn|glum watchsoul
     ### MAGIC STUFF
     var MAGICUSER Warrior Mage|Moon Mage|Bard|Ranger|Paladin|Empath|Cleric|Trader|Necromancer
     var SNIPEUSER Thief|Ranger
     var Hostile.Spell.List ABAN|ACS|AE|AETHROLYSIS|ALA|ARS|BLB|BTN|BOS|BG|BURN|CAC|CL|CHS|CRD|DEVI|DB|DO|EC|FB|FF|FLS|FOU|FR|FS|FST|GZ|GEYSER|HOT|HE|HF|HH|HORN|IZ|LB|MAB|PD|PW|PYRE|REB|RIM|ROS|SA|SV|STRA|SMH|SHOCKWAVE|STAMPEDE|STS|STAR|TKS|TKT|TOTRS|USOL|VIVISECTION|AEWO|ANC|AL|ALB|AVA|BURDEN|COMPEL|COTW|COZ|DALU|DAZZLE|DE|DEMA|DF|DMRS|EE|FLU|FROSTBITE|GRIZ|HALO|HALT|HB|HULP|HP|HYH|IP|IT|MALEDICTION|MB|MC|MIS|MOA|MS|NB|PS|PV|REND|SB|SHATTER|SICK|SPIT|SET|SLEEP|SF|SOD|SWARM|TC|TI|TREM|TF|TV|VERTIGO|VOD|VS|WB|ABAN|AD|AC|AEWO|ALB|ARS|AF|BES|BOTF|CARE|CS|DALU|EE|EYE|FAE|FR|GHS|GJ|GS|HODI|HOW|HYH|IZ|MOM|MG|PYRE|REV|RIM|ROS|ROC|ROG|SANCTUARY|SA|SLS|SOV|TR|USO|ECHO|SOUL|WILL|WORD|ALL|MF|POM|COS|POP|BC|DC|IOTS|RTR|SEC|AG|MON|ELI|AEG|MOF
     #### SPELL LISTS - (SLS is intentionally NOT in TM.Spell.List due to special handling (no need to target)
     var TM.Spell.List \b(ABAN|ABANDONED\s?HEART|ACS|ACID\s?SPLASH|AE|AESRELA\s?EVERILD|AETHROLYSIS|ALA|AIR\s?LASH|ARS|ARBITERS\s?STYLUS|BLB|BLOOD\s?BURST|BTN|BECKON\s?THE\s?NAGA|BOS|BREATH\s?OF\s?STORMS|BG|BLUFMOR\s?GARAEN|BURN|CAC|CARRION\s?CALL|CL|CHAIN\s?LIGHTNING|CHS|CHILL\s?SPIRIT|CRD|CRYSTAL\s?DART|DEVI|DEVITALIZE|DB|DRAGONS\s?BREATH|DO|DINAZEN\s?OLKAR|EC|EAGLES\s?CRY|FB|FIREBALL|FF|FISTS\s?OF\s?FAENELLA|FLS|FLAME\s?SHOCKWAVE|FOU|FIRE\s?OF\s?USHNISH|FR|FIRE\s?RAIN|FRS|FROST\s?SCYTHE|FS|FIRE\s?SHARDS|FST|FOOTMANS\s?STRIKE|GZ|GAR\s?ZENG|GEYSER|HOT|HAND\s?OF\s?TENEMLOR|HE|HARM\s?EVIL|HF|HEAVENLY\s?FIRES|HH|HARM\s?HORDE|HORN|IZ|ICUTU\s?ZAHARENELA|LB|LIGHTNING\s?BOLT|MAB|MAGNETIC\s?BALLISTA|PARALYSIS|PD|PARTIAL\s?DISPLACEMENT|PW|PAELDRYTHS\s?WRATH|PYRE|PHOENIXS\s?PYRE|REB|REBUKE|RIM|RIMEFANG|ROS|RING\s?OF\s?SPEARS|SA|SOUL\s?ATTRITION|SV|SIPOHN\s?VITALITY|STRA|STRANGE\s?ARROW|SMH|SMITE\s?HORDE|SHOCKWAVE|STAMPEDE|STS|STONE\s?STRIKE|STAR|STARCRASH|TKS|TELEKINETIC\s?STORM|TKT|TELEKINETIC\s?THROW|TOTRS|TIME\s?OF\s?THE\s?RED\s?SPIRAL|USOL|UNIVERSAL\s?SOLVENT|VIVISECTION)\b
     var Debil.Spell.List \b(AEWO|ANC|AL|ALB|AVA|BURDEN|CALM|COMPEL|COTW|COZ|DALU|DAZZLE|DE|DEMA|DF|DMRS|EE|FLU|FROSTBITE|GRIZ|HALO|HALT|HB|HULP|HP|HYH|IP|IT|LETHARGY|MALEDICTION|MB|MC|MIS|MOA|MS|NB|PS|PV|REND|SB|SHATTER|SICK|SPIT|SET|SHW|SLEEP|SF|SOD|SWARM|TC|TI|TREM|TF|TV|VERTIGO|VOD|VS|WB)\b
     var Ritual.Spell.List \b(BLOODTHORNS|ECHO|SOUL|WILL|WORD|ALL|MF|POM|ABSOLUTION|COS|POP|BC|DC|IOTS|RTR|SEC|AG|MON|ELI|AEG|MOF)\b
     var Cyclic.Spell.List \b(ABAN|AD|AC|AEWO|ALB|ARS|AF|BES|BOTF|CARE|CS|DALU|EE|EYE|FAE|FR|GHS|GJ|GS|HODI|HOW|HYH|IZ|MOM|MG|PYRE|REGEN|REGENERATE|REZZ|REV|RIM|ROS|ROC|ROG|SANCTUARY|SA|SHW|SLS|SOV|TR|USOL)\b
     var AugmentationCyclic \b(CS|BOTF|FAE|AD|BES|TR)\b
     var DebilitationCyclic \b(AEWO|DALU|EE|HYH|ALB)\b
     var Targeted_MagicCyclic \b(IZ|SLS|ABAN|PYRE|USOL|FR|ROS|RIM|SA)\b
     var UtilityCyclic \b(AF|EYE|GS|HODI|MG|REG|REZZ|ROC|ROG|SANCTUARY|REV|CARE|SOV)\b
     var WardingCyclic \b(AC|GHS|MOM|GJ|HOW)\b
     var Outdoor.Spell.List \b(FR|TREM|LB|BURN|DAZZLE|COL)\b
     ### Long Wearable? Weapons
     var Long.Weapons \b(quarterstaff|partisan|shield|buckler|bundle|halberd|staff(?! sling)|longbow|khuj|spear|pilum|naginata|tower shield|glaive)\b
     ### Default Metals for script to sell (variables file should overwrite this if you have that set in there)
     var metalstosell brass|bronze|coal|copper|covellite|iron|lead|nickel|oravir|pewter|silver|tin|zinc|gold|electrum|platinum|steel
     ### DEFAULT METAL LIST ( ALL Metal types for reference lists )
     var metal.list acenite|agonite|aldamdin|animite|anlora-avtoma|asharsh'dai|asini|audrualm|black gold|blighted gold|blue gold|brass|bronze|cambrinth|coal|copper|coralite|covellite|diacan|darkstone|damite|electrum|elven silver|elven gold|gais|glaes|gold|green gold|hafaltu|highsteel|haralun|haledroth|hiromin|icesteel|ilmenite|indurium|iron|ithridu|kiralan|kadepa|ka'hurst|keismin|kelpzyte|kertig|lead|loimic|lumium|mithril|moonsilver|muracite|mistglass|moen takibena|negnetha|niello|nickel|niniam|oravir|orichalcum|palladium|pewter|platinum|purple gold|razaksel|red gold|rencate|rose gold|silver|steel|silversteel|sungold|tel'athi|telothian|tin|tomiek|tursa|tyrium|uthamar|vardite|velakan starsteel|watered steel|white gold|windsteel|wrought iron|yellow gold|zinc
     ### RARE METAL LIST - WILL NOT SELL THESE METAL TYPES
     var RareMetalKeepList acenite|agonite|aldamdin|animite|asini|audrualm|brass|bronze|cambrinth|copper|covellite|damite|darkstone|dawnfire|dwarven iron|diacan|electrum|elven gold|glaes|gold|haralun|haledroth|highsteel|icesteel|iron|kertig|kiralan|lead|loimic|lumium|mithril|moonsilver|muracite|nickel|niello|niniam|oravir|orichalcum|palladium|pewter|platinum|pyrite|quelium|rencate|razaksel|silver|silversteel|(?<!jagged )steel|sungold|telothian|tin|tomiek|tyrium|uthamar|vardite|velakan starsteel|windsteel|watered steel|white gold|yellow gold|zinc
#####################################
##### SETUP BASE GUILD VARIABLES
#####################################
     if ("$guild" = "Empath") then gosub EMPATH_VARS
     if ("$guild" = "Cleric") then gosub CLERIC_VARS
     if ("$guild" = "Warrior Mage") then gosub WM_VARS
     if ("$guild" = "Bard") then gosub BARD_VARS
     if ("$guild" = "Barbarian") then gosub BARB_VARS
     if ("$guild" = "Moon Mage") then gosub MM_VARS
     if ("$guild" = "Thief") then gosub THIEF_VARS
     if ("$guild" = "Trader") then gosub TRADER_VARS
     if ("$guild" = "Paladin") then gosub PALADIN_VARS
     if ("$guild" = "Necromancer") then gosub NECRO_VARS
     if ("$guild" = "Ranger") then gosub RANGER_VARS
##### WM NON-SUMMONABLE WEAPON SKILLS
     var nonSummonSkills Bow|Crossbow|Slings|Offhand_Weapon|Backstab|Brawling
##### ALL MAGIC USER DEFAULTS
     var SpellArray Target|Debilitation|Utility|Warding|Augmentation|Sorcery
     var %GuildType.Cyclics NULL
     var BUFFING OFF
     var Backfired 0
     var backfirecount 0
     var cambCharged 0
     var camdrop 0
     var currentMANA 0
     var CurrentSchool NULL
     var CurrentSpell NULL
     var CurrentBuff NULL
     var CurrentBackfire NULL
     var CurrentBuffMana 0
     var CurrentSpellMana 0
     var CambrinthCharge 1
     var DedicatedCamb 0
     var Foci.Active 0
     var LastSpell NULL
     var mana.drop 0
     var magicLocked 0
     var Magic.Tattoo NULL
     var TargetLoops 0
     var DebTargetLoop 0
     var SorceryLoops 0
     var SorcerySpecial 0
     var TM.Target NULL
     var RawChanneling 0
     var spellID NULL
     var singlebuff 0
     var Slow.Cast OFF
     var spellPrepped 0
     var spellCheck 0
     var spellMax 0
     var UtilityON 0
     var DebilitationON 0
     var TargetON 0
     var WardingON 0
     var AugmentationON 0
     var SorceryON 0
     var lowarray
     var temparray
     var cyclic.casting 0
     var CyclicStartTime 0
     var Use.Cambrinth ON
     var Use.Cambrinth.Buffs OFF
     var Symbiosis OFF
     var Target.Symbiosis OFF
     var Uility.Symbiosis OFF
     var Augmentation.Symbiosis OFF
     var Warding.Symbiosis OFF
     var Sorcery.Symbiosis OFF
     var Debilitation.Symbiosis OFF
     var TrainLowest OFF
     var Runic.Tattoo OFF
     var Magic.Tattoo OFF
     var AugmentationMastery 0
     var Targeted_MagicMastery 0
     var UtilityMastery 0
     var WardingMastery 0
     var DebilitationMastery 0
     var SorceryMastery 0
     var BurningTouch 0
     var Target.Mana 20
     var Debilitation.Mana 20
     var Utility.Mana 30
     var Augmentation.Mana 30
     var Warding.Mana 30
     var Sorcery.Mana 30
     var Target.Camb 15
     var Debilitation.Camb 15
     var Utility.Camb 15
     var Augmentation.Camb 15
     var Warding.Camb 15
     var Camb.Heavy OFF
     var Sorcery.Focus NULL
     var SCHOOL TARGET
     var spellcount 0
     var noCharge 0
     var EF.Ready 1
     var noTarget 0
     var spellExpired 0
     var Research.Active 0
     var Research.Inactive 0
     var Warding.Learn 0
     var Augment.Learn 0
     var Utility.Learn 0
     var Sorcery.Learn 0
     var MagicTM 0
     var orb 0
     var OrbFull 0
     var OMChecked 0
     var Know.Butchery 0
     var healthwalk 1
     delay 0.00001
#### BLACKLISTED
     var Blacklisted NULL
     eval Blacklisted replacere("%Blacklisted", "\|+", "|")
     eval Blacklisted replacere("%Blacklisted", "\|$", "")
     eval Blacklisted replacere("%Blacklisted", "^\|", "")
#### BASE DEFAULT GLOBALS THAT ~MUST~ BE RESET EVERY SCRIPT LAUNCH OR LOOP
#### MAGIC USER DEFAULT GLOBALS
     put #var UC_Target.Symbiosis 0
     put #var UC_Utility.Symbiosis 0
     put #var UC_Augmentation.Symbiosis 0
     put #var UC_Warding.Symbiosis 0
     put #var UC_Sorcery.Symbiosis 0
     put #var UC_Debilitation.Symbiosis 0
     put #var UC_Symbiosis 0
     put #var UC_NoCambTM 0
     put #var Symbiosis.Buffs 0
##### REST OF DEFAULT GLOBAL TO RESET
     put #var UC_swappable-state NULL
     put #var UC_Combat.Time $gametime
     put #var UC_Combat.Last 0
     put #var UC_DualWield 0
     put #var UC_OffhandThrow 0
     put #var pirps 0
######### START GLOBAL TIMERS
     if !def(UC_Combat.Time) then put #var UC_Combat.Time $gametime
     if !def(UC_Combat.Last) then put #var UC_Combat.Last 0
     if !def(UC_Journal.Time) then put #var UC_Journal.Time $gametime
     if !def(UC_Journal.Last) then put #var UC_Journal.Last 86400
     if !def(UC_Setup.Time) then put #var UC_Setup.Time $gametime
     if !def(UC_Setup.Last) then put #var UC_Setup.Time {#evalmath ($gametime - 907500)}
########## GUILD-SPECIFIC STARTUP TIMERS ###########################################
     if ("$guild" = "Empath") then
          {
               put #var SpellTimer.Absolution.active 0
               put #var SpellTimer.Absolution.duration 0
          }
     if ("$guild" = "Necromancer") then
          {
               var JusticeTime $gametime
               var OutrageTime $gametime
               var ButcheryTime $gametime
               put #var UC_QuickenEarth 0
               evalmath NecroHealTime ($gametime - 300)
               evalmath ButcheryTime ($gametime - 300)
               evalmath OutrageTime ($gametime - 300)
          }
     if ("$guild" = "Moon Mage") then
          {
               evalmath observeTime ($gametime - 180)
          }
########## SPECIAL STARTUP TIMERS ###########################################
### THESE SHOULD BE SET ABOVE THEIR MAX TIME SO IT TRIGGERS THE ACTION EARLY / FIRST THING
### THIS IS MOSTLY FOR TIMERS ON FAIRLY LONG COOLDOWNS
     evalmath RunicTime ($gametime - 3600)
     evalmath RecallTime ($gametime - 1000)
     evalmath WandTime ($gametime - 1550)
     evalmath BOSTime ($gametime - 300)
     evalmath maneuverTime ($gametime - 300)
     evalmath doubleStrikeTime ($gametime - 300)
     evalmath CyclicTime ($gametime - 300)
     evalmath portalTime ($gametime - 200)
     ## evalmath AstrolabeTime ($gametime - 1500)
     ## evalmath TarantulaTime ($gametime - 1000)
     ## evalmath AlmanacTime ($gametime - 610)
######### END OF TIMER SETUP SECTION ##################################################
#######################################################################################
#######################################################################################
######### LOAD HARD DEFAULT GLOBALS IF THEY DO NOT EXIST IN GENIE ##############
     if !def($charactername.MAXRANKS) then put #var $charactername.MAXRANKS 1750
     if !def(BurgleItem1) then put #var BurgleItem1 NULL
     if !def(BurgleItem2) then put #var BurgleItem2 NULL
     if !def(BurgleItem3) then put #var BurgleItem3 NULL
     if !def(BurgleItem4) then put #var BurgleItem4 NULL
     if !def(UC_Almanac) then put #var UC_Almanac 0
     if !def(UC_AlternateWeapon) then put #var UC_AlternateWeapon 0
     if !def(UC_Ambush) then put #var UC_Ambush 0
     if !def(AMMOSWAP) then put #var AMMOSWAP 0
     if !def(UC_WeaponType) then put #var UC_WeaponType NULL
     if !def(UC_MyShield) then put #var UC_MyShield NULL
     if !def(UC_ArmorCheck) then put #var UC_ArmorCheck 1
     if !def(UC_Armor.Backtrain.Abdomen) then put #var UC_Armor.Backtrain.Abdomen NULL
     if !def(UC_Armor.Backtrain.Arms) then put #var UC_Armor.Backtrain.Arms NULL
     if !def(UC_Armor.Backtrain.Back) then put #var UC_Armor.Backtrain.Back NULL
     if !def(UC_Armor.Backtrain.Chest) then put #var UC_Armor.Backtrain.Chest NULL
     if !def(UC_Armor.Backtrain.Face) then put #var UC_Armor.Backtrain.Face NULL
     if !def(UC_Armor.Backtrain.Hands) then put #var UC_Armor.Backtrain.Hands NULL
     if !def(UC_Armor.Backtrain.Head) then put #var UC_Armor.Backtrain.Head NULL
     if !def(UC_Armor.Backtrain.Knuckle) then put #var UC_Armor.Backtrain.Knuckle NULL
     if !def(UC_Armor.Backtrain.Legs) then put #var UC_Armor.Backtrain.Legs NULL
     if !def(UC_Armor.Abdomen) then put #var UC_Armor.Abdomen NULL
     if !def(UC_Armor.Arms) then put #var UC_Armor.Arms NULL
     if !def(UC_Armor.Back) then put #var UC_Armor.Back NULL
     if !def(UC_Armor.Chest) then put #var UC_Armor.Chest NULL
     if !def(UC_Armor.Face) then put #var UC_Armor.Face NULL
     if !def(UC_Armor.Hands) then put #var UC_Armor.Hands NULL
     if !def(UC_Armor.Head) then put #var UC_Armor.Head NULL
     if !def(UC_Armor.Knuckle) then put #var UC_Armor.Knuckle NULL
     if !def(UC_Armor.Legs) then put #var UC_Armor.Legs NULL
     if !def(UC_ParryStick) then put #var UC_ParryStick NULL
     if !def(UC_Armor.Noob) then put #var UC_Armor.Noob 0
     if !def(UC_ArmorSwap) then put #var UC_ArmorSwap 0
     if !def(UC_ArmWorn) then put #var UC_ArmWorn 0
     if !def(UC_Arrange) then put #var UC_Arrange 0
     if !def(UC_ArrangeAll) then put #var UC_ArrangeAll 0
     if !def(UC_ArrangeAlways) then put #var UC_ArrangeAlways 0
     if !def(UC_ArrangeMax) then put #var UC_ArrangeMax 0
     if !def(UC_ArrangeTarget) then put #var UC_ArrangeTarget skin
     if !def(UC_Astrolabe) then put #var UC_Astrolabe 0
     if !def(UC_AutoProgress) then put #var UC_AutoProgress 0
     if !def(UC_Autoheal) then put #var UC_Autoheal 0
     if !def(UC_Backtrain) then put #var UC_Backtrain 0
     if !def(UC_Backtrain.Stealth) then put #var UC_Backtrain.Stealth 0
     if !def(UC_AutoProgress.Backtrain) then put #var UC_AutoProgress.Backtrain 0
     if !def(UC_backtrainCritter) then put #var UC_backtrainCritter NULL
     if !def(UC_BacktrainMagic) then put #var UC_BacktrainMagic 0
     if !def(UC_BacktrainTM) then put #var UC_BacktrainTM 0
     if !def(UC_bagsFull) then put #var UC_bagsFull 0
     if !def(UC_balance) then put #var UC_balance 5
     if !def(UC_BankBot) then put #var UC_BankBot NULL
     if !def(UC_BeltKnife) then put #var UC_BeltKnife 0
     if !def(UC_Bonded) then put #var UC_Bonded 0
     if !def(UC_Box.Max) then put #var UC_Box.Max 15
     if !def(UC_Bonded) then put #var UC_Bonded 0
     if !def(UC_Braiding) then put #var UC_Braiding 0
     if !def(UC_Bundle) then put #var UC_Bundle 0
     if !def(UC_bundleCount) then put #var UC_bundleCount 0
     if !def(UC_bundleFull) then put #var UC_bundleFull 0
     if !def(UC_bundleMax) then put #var UC_bundleMax 50
     if !def(UC_Burden) then put #var UC_Burden 0
     if !def(UC_Burgle) then put #var UC_Burgle 0
     if !def(UC_Burgle.Pawn) then put #var UC_BurglePawn 0
     if !def(UC_Burgle.Dump) then put #var UC_BurgleDump 0
     if !def(UC_InvCheck) then put #var UC_InvCheck 0
     if !def(UC_PouchDump) then put #var UC_PouchDump 0
     if !def(UC_ClericRituals) then put #var UC_ClericRituals 0
     if !def(UC_Climbing) then put #var UC_Climbing 0
     if !def(UC_MagicRope) then put #var UC_MagicRope 0
     if !def(UC_combatCritter) then put #var UC_combatCritter NULL
     if !def(UC_alternateCritter) then put #var UC_alternateCritter NULL
     if !def(UC_Container) then put #var UC_Container NULL
     if !def(UC_Container.Ammo) then put #var UC_Container.Ammo NULL
     if !def(UC_Container.Backup) then put #var UC_Container.Backup NULL
     if !def(UC_Container.Box) then put #var UC_Container.Box NULL
     if !def(UC_Container.Crafting) then put #var UC_Container.Crafting NULL
     if !def(UC_Container.EmptyPouch) then put #var UC_Container.EmptyPouch NULL
     if !def(UC_Container.GemPouch) then put #var UC_Container.GemPouch NULL
     if !def(UC_Container.LockpickItem) then put #var UC_Container.LockpickItem NULL
     if !def(UC_Container.Sheath) then put #var UC_Container.Sheath NULL
     if !def(UC_Container.Almanac) then put #var UC_Container.Almanac NULL
     if !def(UC_Container.Ritual) then put #var UC_Container.Ritual NULL
     if !def(UC_Container.Wand1) then put #var UC_Container.Wand1 NULL
     if !def(UC_Container.Wand2) then put #var UC_Container.Wand2 NULL
     if !def(UC_CRITTER.ROOMS) then put #var UC_CRITTER.ROOMS NULL
     if !def(UC_Crystal) then put #var UC_Crystal 0
     if !def(UC_CrystalCombat) then put #var UC_CrystalCombat 0
     if !def(UC_CambMana) then put #var UC_CambMana 1
     if !def(UC_CambHeavy) then put #var UC_CambHeavy 1
     if !def(UC_Cambrinth) then put #var UC_Cambrinth NULL
     if !def(UC_Cambrinth.Use) then put #var UC_Cambrinth.Use NULL
     if !def(UC_Cambrinth.Use.Buffs) then put #var UC_Cambrinth.Use.Buffs NULL
     if !def(UC_Cyclic.Cambrinth) then put #var UC_Cyclic.Cambrinth NULL
     if !def(UC_Symbiosis) then put #var UC_Symbiosis 0
     if !def(UC_Symbiosis.Buffs) then put #var UC_Symbiosis.Buffs 0
     if !def(UC_Augmentation.Symbiosis) then put #var UC_Augmentation.Symbiosis 0
     if !def(UC_Debilitation.Symbiosis) then put #var UC_Debilitation.Symbiosis 0
     if !def(UC_Sorcery.Symbiosis) then put #var UC_Sorcery.Symbiosis 0
     if !def(UC_Target.Symbiosis) then put #var UC_Target.Symbiosis 0
     if !def(UC_Utility.Symbiosis) then put #var UC_Utility.Symbiosis 0
     if !def(UC_Warding.Symbiosis) then put #var UC_Warding.Symbiosis 0
     if !def(UC_DefenseSkill) then put #var UC_DefenseSkill NULL
     if !def(UC_Dissect) then put #var UC_Dissect 0
     if !def(UC_DualWield) then put #var UC_DualWield 0
     if !def(UC_Egg) then put #var UC_Egg 0
     if !def(UC_element) then put #var UC_element fire
     if !def(UC_F2P) then put #var UC_F2P 0
     if !def(UC_favorGod) then put #var UC_favorGod damaris
     if !def(UC_friends) then put #var UC_friends NULL
     if !def(UC_GetAmmo) then put #var UC_GetAmmo 1
     if !def(UC_getFavors) then put #var UC_getFavors 1
     if !def(UC_GetAmmo) then put #var UC_GetAmmo 1
     if !def(UC_GuardianSpirit) then put #var UC_GuardianSpirit 0
     if !def(UC_GuardianCustom) then put #var UC_GuardianCustom 0
     if !def(UC_HealAll) then put #var UC_HealAll 0
     if !def(UC_Herbs) then put #var UC_Herbs 0
     if !def(UC_lightArmor1) then put #var UC_lightArmor1 NULL
     if !def(UC_lightArmor2) then put #var UC_lightArmor2 NULL
     if !def(UC_Lighter) then put #var UC_Lighter NULL
     if !def(UC_Log.on.Death) then put #var UC_Log.on.Death 0
     if !def(UC_Logouts) then put #var UC_Logouts 0
     if !def(UC_Looting) then put #var UC_Looting 0
     if !def(UC_Loop) then put #var UC_Loop 0
     if !def(UC_LootMonsters) then put #var UC_LootMonsters 0
     if !def(UC_LootGems) then put #var UC_LootGems 0
     if !def(UC_LootBoxes) then put #var UC_LootBoxes 0
     if !def(UC_LootMetals) then put #var UC_LootMetals 0
     if !def(UC_LootScrolls) then put #var UC_LootScrolls 0
     if !def(UC_LootCollectibles) then put #var UC_LootCollectibles 0
     if !def(UC_LootSpiderParts) then put #var UC_LootSpiderParts 0
     if !def(UC_LootOption) then put #var UC_LootOption goods
     if !def(UC_MagicalResearch) then put #var UC_MagicalResearch 0
     if !def(UC_Manipulate) then put #var UC_Manipulate 0
     if !def(UC_MaxMonsters) then put #var UC_MaxMonsters 0
     if !def(UC_MaxTrain) then put #var UC_MaxTrain 4000
     if !def(UC_NecroHeal) then put #var UC_NecroHeal 0
     if !def(UC_needHealing) then put #var UC_needHealing 0
     if !def(UC_NoCombat) then put #var UC_NoCombat 0
     if !def(UC_No.Contact) then put #var UC_No.Contact 0
     if !def(UC_NoCambTM) then put #var UC_NoCambTM 0
     if !def(UC_OffhandThrow) then put #var UC_OffhandThrow 0
     if !def(UC_OrbRub) then put #var UC_OrbRub 0
     if !def(UC_Performance) then put #var UC_Performance 0
     if !def(UC_Pilgrim) then put #var UC_Pilgrim 0
     if !def(UC_plateArmor1) then put #var UC_plateArmor1 NULL
     if !def(UC_plateArmor2) then put #var UC_plateArmor2 NULL
     if !def(UC_Poach) then put #var UC_Poach 0
     if !def(UC_PowerWalk) then put #var UC_PowerWalk 0
     if !def(UC_Premium) then put #var UC_Premium 0
     if !def(UC_priorityRooms) then put #var UC_priorityRooms NULL
     if !def(UC_QuickenEarth) then put #var UC_QuickenEarth 0
     if !def(UC_ConstructOnly) then put #var UC_ConstructOnly 0
     if !def(UC_Repair) then put #var UC_Repair 1
     if !def(UC_Profit) then put #var UC_Profit 0
     if !def(UC_repairCost) then put #var UC_repairCost 0
     if !def(UC_repairCurrency) then put #var UC_repairCurrency kronars
     if !def(UC_RestockAmmo) then put #var UC_RestockAmmo 0
     if !def(RestockLockpicks) then put #var RestockLockpicks 0
     if !def(UC_Retreat) then put #var UC_Retreat 0
     if !def(UC_Risen) then put #var UC_Risen 0
     if !def(UC_Risen) then put #var UC_Risen 0
     if !def(UC_RTR) then put #var UC_RTR 0
     if !def(UC_Scream) then put #var UC_Scream 0
     if !def(UC_SellGems) then put #var UC_SellGems 0
     if !def(UC_SellMetals) then put #var UC_SellMetals 0
     if !def(UC_SellSkins) then put #var UC_SellSkins 0
     if !def(UC_shardCitizen) then put #var UC_shardCitizen 0
     if !def(UC_Shield) then put #var UC_Shield 1
     if !def(UC_ShieldUse) then put #var UC_ShieldUse 1
     if !def(UC_Scream) then put #var UC_Scream 0
     if !def(UC_Skin) then put #var UC_Skin 0
     if !def(UC_Skinner) then put #var UC_Skinner NULL
     if !def(UC_SkinTrain) then put #var UC_SkinTrain 0
     if !def(UC_SlowCast) then put #var UC_SlowCast 0
     if !def(UC_SmartSpells) then put #var UC_SmartSpells 0
     if !def(UC_SmartWeapons) then put #var UC_SmartWeapons 0
     if !def(UC_Smite) then put #var UC_Smite 0
     if !def(UC_Snap.Fire) then put #var UC_Snap.Fire 0
     if !def(UC_Snipe) then put #var UC_Snipe 0
     if !def(SONG) then put #var SONG NULL
     if !def(UC_Stealing) then put #var UC_Stealing 0
     if !def(UC_Summoning) then put #var UC_Summoning 0
     if !def(UC_SummonWeapons) then put #var UC_SummonWeapons 0
     if !def(UC_Tactics) then put #var UC_Tactics 0
     if !def(UC_tamsine) then put #var UC_tamsine 0
     if !def(UC_Tarantula) then put #var UC_Tarantula 0
     if !def(UC_Teach) then put #var UC_Teach 0
     if !def(UC_Textbook) then put #var UC_Textbook 0
     if !def(UC_TieBundle) then put #var UC_TieBundle 0
     if !def(UC_TiePouch) then put #var UC_TiePouch 0
     if !def(UC_Tipping) then put #var UC_Tipping 0
     if !def(UC_TrainStealth) then put #var UC_TrainStealth 0
     if !def(UC_TrashDump) then put #var UC_TrashDump 0
     if !def(UC_Wand) then put #var UC_Wand 0
     if !def(UC_WarHorn) then put #var UC_WarHorn 0
     if !def(UC_WeakAttack) then put #var UC_WeakAttack 0
     if !def(UC_WarHorn) then put #var UC_WarHorn 0
     if !def(UC_Whirlwind) then put #var UC_Whirlwind 0
     if !def(UC_Whistle) then put #var UC_Whistle 0
     if !def(UC_WindBoard) then put #var UC_WindBoard 0
     if !def(UC_WornPouch) then put #var UC_WornPouch 0
     if !def(UC_Zills) then put #var UC_Zills 0
     if !def(UC_Roaming) then put #var UC_Roaming 0
     if !def(UC_HomeCity) then put #var UC_HomeCity NULL
     if !def(UC_RPA) then put #var UC_RPA 0
     if !def(UC_totalTime) then put #var UC_totalTime 0
     if !def(UC_VaultSwap) then put #var UC_VaultSwap 0
     if !def(UC_VaultBag) then put #var UC_VaultBag NULL
     if !def(UC_VaultCity) then put #var UC_VaultCity NULL
     ######################################################
     ### HIDDEN TEST START COMMAND - Used to restart script and retain total time/kills/etc info
     ### .uc start 2=starttime in seconds, 3=Kills, 4=Profit, 5=TotalRanks
     ### ex .uc start 346000 300 34500 74
     if matchre("start", "(?i)%command") then
          {
               evalmath startTime ($gametime - %alternate)
               if_3 then var TotalKills %3
               if_4 then
                    {
                         var TempProfit $UC_Profit
                         math TempProfit add %4
                         put #var UC_Profit %TempProfit
                    }
               if_5 then
                    {
                         var tempRanks $UC_TOTALRANKS
                         math tempRanks add %5
                         put #var UC_TOTALRANKS %tempRanks
                    }
          }
     delay 0.00001
#############################################################
     if matchre("$guild", "%MAGICUSER") then
          {
               action (magic) on
               put spell briefmsg off
               delay 0.001
          }
     if ("$game" = "DRF") then action (TF) on
##### UNLOAD UNECESSARY TRIGGERS
     if ("$guild" != "Moon Mage") then
          {
               action remove ^That was the last of your orbiting slivers\.
               action remove ^You have not pondered your last observation sufficiently
               action remove ^You feel you have sufficiently pondered your latest observation
          }
     if ("$guild" != "Empath") then
          {
               action remove ^Pain blossoms within you\,\syour delicate empathic senses singing with agony\.
          }
     if ("$guild" != "Warrior Mage") then
          {
               action remove ^A strange sense passes through you
               action remove ^Discharging a burst of elemental power in the esoteric|^You sense the physics of the local area are being modified by|^Suddenly the area feels somehow more|^The air around you feels somehow thicker|^Strangely.*everything feels a tiny bit heavier|^A barely felt zap of static electricity accompanies your meditation|^You feel a sudden tingle of heat in your palms|^The humidity in the area noticeably increases
               action remove ^You focus on (?:manipulating|stretching) an aethereal pathway|^You are already manipulating the aether to your benefit
               action remove ^You gently relax your mind and release your hold on the aethereal pathways|^You aren't focusing on any of the aethereal pathways|^You find it impossible to manipulate the aether while stunned.  The complex web of manipulations collapse, allowing the aether to fall back into its natural contours
          }
     goto VAR_LOAD
###############################################################################
################# LOAD USER VARIABLES AND BUFFS ###############################
VAR_LOAD:
     echo
     echo *** Triggers/Actions Loaded!
     delay 0.00001
     var loading 1
     gosub LOAD_VARS
     echo
     var loading 0
     action (buffs) on
     ### RUN THESE ACTIONS ONLY ON FIRST SETUP
     if (%firstlaunch = 1) then
          {
          put #var Camb.Sorcery %Sorcery.Camb
          if matchre("%XP.RESET", "\b(?i)(ON|1|YES)\b") then
               {
                    put #layout load default
                    ##put /track clear
                    delay 0.0001
               }
          }
     delay 0.0001
###############################################################################
####### SETUP ALL GLOBALS ACCORDING TO USER VARIABLES
     var ORIGINAL.LEARNINGRATE %MAX.LEARNINGRATE
     var Wear.Weapons %Wear.Weapons|parry stick
     eval HOME.CITY toupper("%HOME.CITY")
     eval Custom.Script replacere("%Custom.Script", "\.cmd", "")
     #### STRIP UNNECESSARY |
     eval trash replacere("%trash", "\|+", "|")
     eval trash replacere("%trash", "\|$", "")
     eval trash replacere("%trash", "^\|", "")
     var Trash %trash
     var B.KNUCKLE %KNUCKLE
     eval Wear.Weapons replacere("%Wear.Weapons", "\|+", "|")
     eval Wear.Weapons replacere("%Wear.Weapons", "\|$", "")
     eval Wear.Weapons replacere("%Wear.Weapons", "^\|", "")
     eval Sheath.1.Weapons replacere("%Sheath.1.Weapons", "\|+", "|")
     eval Sheath.1.Weapons replacere("%Sheath.1.Weapons", "\|$", "")
     eval Sheath.2.Weapons replacere("%Sheath.2.Weapons", "\|+", "|")
     eval Sheath.2.Weapons replacere("%Sheath.2.Weapons", "\|$", "")
     eval Sheath.3.Weapons replacere("%Sheath.3.Weapons", "\|+", "|")
     eval Sheath.3.Weapons replacere("%Sheath.3.Weapons", "\|$", "")
     eval Sheath.4.Weapons replacere("%Sheath.4.Weapons", "\|+", "|")
     eval Sheath.4.Weapons replacere("%Sheath.4.Weapons", "\|$", "")
     eval Sheath.1.Weapons replacere("%Sheath.1.Weapons", "^\|", "")
     eval Sheath.2.Weapons replacere("%Sheath.2.Weapons", "^\|", "")
     eval Sheath.3.Weapons replacere("%Sheath.3.Weapons", "^\|", "")
     eval Sheath.4.Weapons replacere("%Sheath.4.Weapons", "^\|", "")
     var Sheath.Weapons %Sheath.1.Weapons|%Sheath.2.Weapons|%Sheath.3.Weapons|%Sheath.4.Weapons
     eval Sheath.Weapons replacere("%Sheath.Weapons", "[Nn][Uu][Ll][Ll]", "")
     eval Sheath.Weapons replacere("%Sheath.Weapons", "\|+", "|")
     eval Sheath.Weapons replacere("%Sheath.Weapons", "\|$", "")
     var LootOptions %Loot.Boxes|%Loot.Gems|%Loot.Metals|%Loot.Scrolls|%Loot.Collectibles
     ####### SETUP USER-SPECIFIC DEFAULTS & CONVERT ALL LOCALS TO GLOBALS
     if !def($charactername.MAXRANKS) then put #var $charactername.MAXRANKS 1750
     put #var $charactername.MAXRANKS 1750
     if matchre("%Container", "(?i)\beddy\b") then var Container watery portal
     if matchre("%Container.Boxes", "(?i)\beddy\b") then var Container.Boxes watery portal
     if matchre("%Container.Backup", "(?i)\beddy\b") then var Container.Backup watery portal
     if matchre("%Container.Sheath", "(?i)\beddy\b") then var Container.Sheath watery portal
     if matchre("%Container.GemPouch", "(?i)\beddy\b") then var Container.GemPouch watery portal
     if matchre("%Container.Crafting", "(?i)\beddy\b") then var Container.Crafting watery portal
     if matchre("%Container.Herb", "(?i)\beddy\b") then var Container.Herb watery portal
     if matchre("%Container.Ammo", "(?i)\beddy\b") then var Container.Ammo watery portal
     if matchre("%Wand1.Container", "(?i)\beddy\b") then var Wand1.Container watery portal
     if matchre("%Wand2.Container", "(?i)\beddy\b") then var Wand2.Container watery portal
     if matchre("%Container.Dirt", "(?i)\beddy\b") then var Container.Dirt watery portal
     if matchre("%Container.EmptyPouch", "(?i)\beddy\b") then var Container.EmptyPouch watery portal
     if matchre("%Textbook.Container", "(?i)\beddy\b") then var Textbook.Container watery portal
     if matchre("%Ritual.Container", "(?i)\beddy\b") then var Ritual.Container watery portal
     if matchre("%Almanac.Container", "(?i)\beddy\b") then var Almanac.Container watery portal
     if matchre("%Rope.Container", "(?i)\beddy\b") then var Rope.Container watery portal
     if matchre("%Lockpick.Container", "(?i)\beddy\b") then var Lockpick.Container watery portal
     if matchre("%TMFoci.Container", "(?i)\beddy\b") then var TMFoci.Container watery portal
     if matchre("%SKINTRAIN.CONTAINER", "(?i)\beddy\b") then var SKINTRAIN.CONTAINER watery portal
     if matchre("%REPAIR.KIT.CONTAINER", "(?i)\beddy\b") then var REPAIR.KIT.CONTAINER watery portal
     if matchre("%REPAIR.KIT.2.CONTAINER", "(?i)\beddy\b") then var REPAIR.KIT.2.CONTAINER watery portal
     if matchre("%REPAIR.KIT.3.CONTAINER", "(?i)\beddy\b") then var REPAIR.KIT.3.CONTAINER watery portal
     put #var UC_Container %Container
     put #var UC_Container.Box %Container.Boxes
     put #var UC_Container.Sheath %Container.Sheath
     put #var UC_Container.Backup %Container.Backup
     put #var UC_Container.GemPouch %Container.GemPouch
     put #var UC_Container.Crafting %Container.Crafting
     put #var UC_Container.Ammo %Container.Ammo
     put #var UC_Container.Ammo.Backup %Container.Ammo.Backup
     put #var UC_Container.Dirt %Container.Dirt
     put #var UC_Container.Herb %Container.Herb
     put #var UC_Container.EmptyPouch %Container.EmptyPouch
     put #var UC_Container.LockpickItem %Lockpick.Container
     put #var UC_Container.Wand1 %Wand1.Container
     put #var UC_Container.Wand2 %Wand2.Container
     put #var UC_Container.Textbook %Textbook.Container
     put #var UC_Container.Ritual %Ritual.Container
     put #var UC_Container.Almanac %Almanac.Container
     put #var UC_Container.Ritual %Ritual.Container
     put #var UC_Container.RepairKit %REPAIR.KIT.CONTAINER
     put #var UC_Container.RepairKit2 %REPAIR.KIT.2.CONTAINER
     put #var UC_Container.RepairKit3 %REPAIR.KIT.3.CONTAINER
     put #var UC_Box.Max %Max.Boxes
     put #var UC_AlternateWeapon 0
     var TMFoci.Container %Container
     var ALLCHARACTERS %CHARACTER1|%CHARACTER2|%CHARACTER3|%CHARACTER4|%CHARACTER5|%CHARACTER6|%CHARACTER7|%CHARACTER8|%CHARACTER9|%CHARACTER10|%CHARACTER11|%CHARACTER12
     if (%TMFociContainer) then var TMFoci.Container %TMFociContainer
     if (%RitualContainer) then var Ritual.Container %RitualContainer
     if (%IngotContainer) then var Ingot.Container %IngotContainer
     var ALLCONTAINERS $UC_Container|$UC_Container.Box|$UC_Container.Sheath|$UC_Container.Crafting|$UC_Container.Backup|$UC_Container.GemPouch|$UC_Container.EmptyPouch|$UC_Container.Ammo|$UC_Container.Ammo.Backup|$UC_Container.Almanac|$UC_Container.LockpickItem|$UC_Container.RepairKit|$UC_Container.RepairKit2|$UC_Container.RepairKit3|$UC_Container.Ritual|$UC_Container.Textbook|$UC_Container.Wand1|$UC_Container.Wand2|$UC_Container.Dirt|$UC_Container.Herb
     if (matchre("%PocketEmpath", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$game", "DRF")) then
          {
               action send 7 smile $1 when ^(\S+) lays (.+) hand on your arm
               action send 6 praise $1 when Small tendrils of curious silvery light slither from (\S+)'s fingertips toward you
               action send 2 nod $1 when (\S+) (whispers|asks)\, (.+) (heals?|healing|healed|scuffs|scars|touch|wounds)\??
          }
     if ($roomid = 0) then gosub RANDOMMOVE
     if matchre("$charactername", "(Alucios|Valgrind|Hvinir|Idavoll|Aerithius|Drunvalo|Akios|Teothius)") then put .scriptcheck
     if !matchre("%FAVOR.GOD", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_favorGod %FAVOR.GOD
     if matchre("%FAVOR.GOD", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_favorGod meraud
     if ((%Ritual) && !matchre("%Ritual", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var Ritual %Ritual
     #### LOAD CRITTER GUI HERE
     if ((%link = 0) && matchre("%CRITTER.GUI", "(?i)(ON|1|YES)")) then gosub LINKLOAD
     if ((%link = 1) && matchre("%CRITTER.GUI", "(?i)(ON|1|YES)")) then
          {
               var COMBAT.CRITTER %linkCOMBAT.CRITTER
               var BACKTRAIN.CRITTER %linkBACKTRAIN.CRITTER
          }
     eval COMBAT.CRITTER toupper("%COMBAT.CRITTER")
     eval BACKTRAIN.CRITTER toupper("%BACKTRAIN.CRITTER")
     # if matchre("$UC_Container.GemPouch", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Container.GemPouch $UC_Container
     if !matchre("%COMBAT.CRITTER", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_combatCritter %COMBAT.CRITTER
     if !matchre("%BACKTRAIN.CRITTER", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_backtrainCritter %BACKTRAIN.CRITTER
     if !matchre("%ALTERNATE.CRITTER", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_alternateCritter %ALTERNATE.CRITTER
     eval PRIORITY.ROOMS replacere("%PRIORITY.ROOMS", "\|+", "|")
     eval PRIORITY.ROOMS replacere("%PRIORITY.ROOMS", "\|$", "")
     eval PRIORITY.ROOMS replacere("%PRIORITY.ROOMS", "^\|", "")
     eval BACKTRAIN.PRIORITY.ROOMS replacere("%BACKTRAIN.PRIORITY.ROOMS", "\|+", "|")
     eval BACKTRAIN.PRIORITY.ROOMS replacere("%BACKTRAIN.PRIORITY.ROOMS", "\|$", "|")
     eval BACKTRAIN.PRIORITY.ROOMS replacere("%BACKTRAIN.PRIORITY.ROOMS", "^\|", "")
     ############ CONVERT ALL LOCAL ON/OFF VARIABLES TO BINARY GLOBALS
     if matchre("%ARMOR.CHECK", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_ArmorCheck 0
     if matchre("%ARMOR.CHECK", "\b(?i)(ON|1|YES)\b") then put #var UC_ArmorCheck 1
     if matchre("%WEAPON.LEARN", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_WeaponLearn 0
     if matchre("%WEAPON.LEARN", "\b(?i)(ON|1|YES)\b") then put #var UC_WeaponLearn 1
     if matchre("%HOME.CITY", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_HomeCity NULL
     if !matchre("%HOME.CITY", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_HomeCity %HOME.CITY
     if !matchre("%SAFE.ROOM", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_HomeRoom %SAFE.ROOM
     if matchre("%SAFE.ROOM", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_HomeRoom NULL
     if !matchre("%SAFE.ROOM", "\b(\d+)\b") then put #var UC_HomeRoom NULL
     if matchre("%AUTO.PROGRESS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_AutoProgress 0
     if matchre("%AUTO.PROGRESS", "(?i)(ON|1|YES)") then put #var UC_AutoProgress 1
     if matchre("%MyShield", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_ShieldUse 0
     if !matchre("%MyShield", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Shield 1
     if !matchre("%MyShield", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_ShieldUse 1
     if matchre("%Shard.Citizen", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_shardCitizen 0
     if matchre("%Shard.Citizen", "(?i)(ON|1|YES)") then put #var UC_shardCitizen 1
     if matchre("%GET.FAVORS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_getFavors 0
     if matchre("%GET.FAVORS", "(?i)(ON|1|YES)") then put #var UC_getFavors 1
     if matchre("%BACKTRAIN", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Backtrain 0
     if matchre("%BACKTRAIN", "(?i)(ON|1|YES)") then put #var UC_Backtrain 1
     if matchre("%BACKTRAIN.AUTOPROGRESS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_AutoProgress.Backtrain 0
     if matchre("%BACKTRAIN.AUTOPROGRESS", "(?i)(ON|1|YES)") then put #var UC_AutoProgress.Backtrain 1
     if matchre("%BURGLE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Burgle 0
     if matchre("%BURGLE", "(?i)(ON|1|YES)") then put #var UC_Burgle 1
     if matchre("%BURGLE.PAWN", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_BurglePawn 0
     if matchre("%BURGLE.PAWN", "(?i)(ON|1|YES)") then put #var UC_BurglePawn 1
     if matchre("%BURGLE.DUMP", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_BurgleDump 0
     if matchre("%BURGLE.DUMP", "(?i)(ON|1|YES)") then put #var UC_BurgleDump 1
     if matchre("%STEAL", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Stealing 0
     if matchre("%STEAL", "(?i)(ON|1|YES)") then put #var UC_Stealing 1
     if matchre("%Gempouch.Worn", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_WornPouch 0
     if matchre("%Gempouch.Worn", "(?i)(ON|1|YES)") then put #var UC_WornPouch 1
     if matchre("%LootOptions", "(?i)(ON|1|YES)") then put #var UC_Looting 1
     if matchre("%Armor.Noob", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Armor.Noob 0
     if matchre("%Armor.Noob", "(?i)(ON|1|YES)") then put #var UC_Armor.Noob 1
     if matchre("%PARRYSTICK", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_ParryStick 0
     if !matchre("%PARRYSTICK", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_ParryStick 1
     delay 0.00001
     if matchre("%BeltKnife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_BeltKnife 0
     if matchre("%BeltKnife", "(?i)(ON|1|YES)") then put #var UC_BeltKnife 1
     if matchre("%INVCHECK", "(?i)(NULL|OFF|0)") then put #var UC_InvCheck 0
     if matchre("%INVCHECK", "(?i)(ON|1|YES)") then put #var UC_InvCheck 1
     if matchre("%TRASH.DUMP", "(?i)(NULL|OFF|0)") then put #var UC_TrashDump 0
     if matchre("%TRASH.DUMP", "(?i)(ON|1|YES)") then put #var UC_TrashDump 1
     if matchre("%POUCH.DUMP", "(?i)(NULL|OFF|0)") then put #var UC_PouchDump 0
     if matchre("%POUCH.DUMP", "(?i)(ON|1|YES)") then put #var UC_PouchDump 1
     if matchre("%Loot.Monsters", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootMonsters 0
     if matchre("%Loot.Monsters", "(?i)(ON|1|YES)") then put #var UC_LootMonsters 1
     if matchre("%PERFORMANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Performance 0
     if matchre("%PERFORMANCE", "(?i)(ON|1|YES)") then put #var UC_Performance 1
     if matchre("%OffhandThrow", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_OffhandThrow 0
     if matchre("%OffhandThrow", "(?i)(ON|1|YES)") then put #var UC_OffhandThrow 1
     if matchre("%Tactics", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Tactics 0
     if matchre("%Tactics", "(?i)(ON|1|YES)") then put #var UC_Tactics 1
     if matchre("%ArmWorn", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_ArmWorn 0
     if matchre("%ArmWorn", "(?i)(ON|1|YES)") then put #var UC_ArmWorn 1
     if matchre("%WeakAttack", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_WeakAttack 0
     if matchre("%WeakAttack", "(?i)(ON|1|YES)") then put #var UC_WeakAttack 1
     if matchre("%Tipping", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Tipping 0
     if matchre("%Tipping", "(?i)(ON|1|YES)") then put #var UC_Tipping 1
     if matchre("%Retreat", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Retreat 0
     if matchre("%Retreat", "(?i)(ON|1|YES)") then put #var UC_Retreat 1
     if matchre("%Skin", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Skin 0
     if matchre("%Skin", "(?i)(ON|1|YES)") then put #var UC_Skin 1
     if matchre("%Dissect", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Dissect 0
     if matchre("%Dissect", "(?i)(ON|1|YES)") then put #var UC_Dissect 1
     if matchre("%Bundle", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Bundle 0
     if matchre("%Bundle", "(?i)(ON|1|YES)") then put #var UC_Bundle 1
     if matchre("%TieBundle", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_TieBundle 0
     if matchre("%TieBundle", "(?i)(ON|1|YES)") then put #var UC_TieBundle 1
     if matchre("%Bundle", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Bundle.Wear 0
     if matchre("%Bundle", "(?i)(ON|1|YES)") then var Bundle.Wear 1
     if matchre("%Bonded", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Bonded 0
     if matchre("%Bonded", "(?i)(ON|1|YES)") then put #var UC_Bonded 1
     if matchre("%Crystal", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Crystal 0
     if matchre("%Crystal", "(?i)(ON|1|YES)") then put #var UC_Crystal 1
     if matchre("%SanowretCombat", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_CrystalCombat 0
     if matchre("%SanowretCombat", "(?i)(ON|1|YES)") then put #var UC_CrystalCombat 1
     if matchre("%Roaming", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Roaming 0
     if matchre("%Roaming", "(?i)(ON|1|YES)") then put #var UC_Roaming 1
     if matchre("%Zills", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Zills 0
     if matchre("%Zills", "(?i)(ON|1|YES)") then put #var UC_Zills 1
     if matchre("%Tessera", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Tessera 0
     if matchre("%Tessera", "(?i)(ON|1|YES)") then put #var UC_Tessera 1
     if matchre("%TEACH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Teach 0
     if matchre("%TEACH", "(?i)(ON|1|YES)") then put #var UC_Teach 1
     if matchre("%Ambush", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Ambush 0
     if matchre("%Ambush", "(?i)(ON|1|YES)") then put #var UC_Ambush 1
     if matchre("%BRAIDING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Braiding 0
     if matchre("%BRAIDING", "(?i)(ON|1|YES)") then put #var UC_Braiding 1
     if ($Engineering.Ranks > 75) then put #var UC_Braiding 0
     if matchre("%MAGICAL.RESEARCH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_MagicalResearch 0
     if matchre("%MAGICAL.RESEARCH", "(?i)(ON|1|YES)") then put #var UC_MagicalResearch 1
     if matchre("%SMART.SPELLS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_SmartSpells 0
     if matchre("%SMART.SPELLS", "(?i)(ON|1|YES)") then put #var UC_SmartSpells 1
     if matchre("%SMART.WEAPONS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_SmartWeapons 0
     if matchre("%SMART.WEAPONS", "(?i)(ON|1|YES)") then put #var UC_SmartWeapons 1
     if matchre("%BACKTRAIN.STEALTH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Backtrain.Stealth 0
     if matchre("%BACKTRAIN.STEALTH", "(?i)(ON|1|YES)") then put #var UC_Backtrain.Stealth 1
     if matchre("%BACKTRAIN.MAGIC", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_BacktrainMagic 0
     if matchre("%BACKTRAIN.MAGIC", "(?i)(ON|1|YES)") then put #var UC_BacktrainMagic 1
     if matchre("%BACKTRAIN.TM", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_BacktrainTM 0
     if matchre("%BACKTRAIN.TM", "(?i)(ON|1|YES)") then put #var UC_BacktrainTM 1
     if matchre("%ArrangeTarget", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Arrange 0
     if matchre("%ArrangeTarget", "(?i)(PART|SKIN|BONE)") then put #var UC_Arrange 1
     if matchre("%ArrangeAll", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_ArrangeAll 0
     if matchre("%ArrangeAll", "(?i)(ON|1|YES)") then put #var UC_ArrangeAll 1
     if matchre("%ArrangeAlways", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_ArrangeAlways 0
     if matchre("%ArrangeAlways", "(?i)(ON|1|YES)") then put #var UC_ArrangeAlways 1
     if matchre("%Slow.Cast", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_SlowCast 0
     if matchre("%Slow.Cast", "(?i)(ON|1|YES)") then put #var UC_SlowCast 1
     if matchre("%Camb.Heavy", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_CambHeavy 0
     if matchre("%Camb.Heavy", "(?i)(ON|1|YES)") then put #var UC_CambHeavy 1
     if matchre("%CambrinthCharge", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var CambrinthCharge 1
     if matchre("%Use.Cambrinth", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Cambrinth.Use 0
     if matchre("%Use.Cambrinth", "(?i)(ON|1|YES)") then put #var UC_Cambrinth.Use 1
     if matchre("%Use.Cambrinth.Buffs", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Cambrinth.Use.Buffs 0
     if matchre("%Use.Cambrinth.Buffs", "(?i)(ON|1|YES)") then put #var UC_Cambrinth.Use.Buffs 1
     if matchre("%Target.Symbiosis", "(?i)(ON|1|YES)") then put #var UC_Target.Symbiosis 1
     if matchre("%Utility.Symbiosis", "(?i)(ON|1|YES)") then put #var UC_Utility.Symbiosis 1
     if matchre("%Augmentation.Symbiosis", "(?i)(ON|1|YES)") then put #var UC_Augmentation.Symbiosis 1
     if matchre("%Warding.Symbiosis", "(?i)(ON|1|YES)") then put #var UC_Warding.Symbiosis 1
     if matchre("%Sorcery.Symbiosis", "(?i)(ON|1|YES)") then put #var UC_Sorcery.Symbiosis 1
     if matchre("%Debilitation.Symbiosis", "(?i)(ON|1|YES)") then put #var UC_Debilitation.Symbiosis 1
     if matchre("%Symbiosis", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Symbiosis 0
     if matchre("%Symbiosis", "(?i)(ON|1|YES)") then put #var UC_Symbiosis 1
     if matchre("%Symbiosis.Buffs", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var Symbiosis.Buffs 0
     if matchre("%Symbiosis.Buffs", "(?i)(ON|1|YES)") then put #var Symbiosis.Buffs 1
     if matchre("%NoCambTM", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_NoCambTM 0
     if matchre("%NoCambTM", "(?i)(ON|1|YES)") then put #var UC_NoCambTM 1
     if matchre("%Runic.Tattoo", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_RunicTattoo 0
     if matchre("%Runic.Tattoo", "(?i)(ON|1|YES)") then put #var UC_RunicTattoo 1
     if matchre("%TrainStealth", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_TrainStealth 0
     if matchre("%TrainStealth", "(?i)(ON|1|YES)")  then put #var UC_TrainStealth 1
     if matchre("%ClericRituals", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_ClericRituals 0
     if matchre("%ClericRituals", "(?i)(ON|1|YES)")  then put #var UC_ClericRituals 1
     if matchre("%Construct.Only", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_ConstructOnly 0
     if matchre("%Construct.Only", "(?i)(ON|1|YES)")  then put #var UC_ConstructOnly 1
     if matchre("%Guardian.Spirit", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_GuardianSpirit 0
     if matchre("%Guardian.Spirit", "(?i)(ON|1|YES)") then put #var UC_GuardianSpirit 1
     if matchre("%Guardian.Custom", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_GuardianCustom 0
     if matchre("%Guardian.Custom", "(?i)(ON|1|YES)") then put #var UC_GuardianCustom 1
     if matchre("%Manipulate", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Manipulate 0
     if matchre("%Manipulate", "(?i)(ON|1|YES)") then put #var UC_Manipulate 1
     if matchre("%WarHorn", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_WarHorn 0
     if matchre("%WarHorn", "(?i)(ON|1|YES)") then
          {
               put #var UC_WarHorn 1
               var WarhornTime $gametime
          }
     if matchre("%RTR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_RTR 0
     if matchre("%RTR", "(?i)(ON|1|YES)") then put #var UC_RTR 1
     if matchre("%TiePouch", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_TiePouch 0
     if matchre("%TiePouch", "(?i)(ON|1|YES)") then put #var UC_TiePouch 1
     if matchre("%F2P", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_F2P 0
     if matchre("%F2P", "(?i)(ON|1|YES)") then put #var UC_F2P 1
     if matchre("%RPA", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_RPA 0
     if matchre("%RPA", "(?i)(ON|1|YES)") then put #var UC_RPA 1
     if matchre("%TieBundle", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_TieBundle 0
     if matchre("%TieBundle", "(?i)(ON|1|YES)") then put #var UC_TieBundle 1
     if matchre("%Tarantula", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Tarantula 0
     if matchre("%Tarantula", "(?i)(ON|1|YES)") then put #var UC_Tarantula 1
     if matchre("%PILGRIM", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Pilgrim 0
     if matchre("%PILGRIM", "(?i)(ON|1|YES)") then put #var UC_Pilgrim 1
     if matchre("%Risen", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Risen 0
     if matchre("%Risen", "(?i)(ON|1|YES)") then put #var UC_Risen 1
     if matchre("%Necro.Heal", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_NecroHeal 0
     if matchre("%Necro.Heal", "(?i)(ON|1|YES)") then put #var UC_NecroHeal 1
     if matchre("%Forsaken", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Forsaken 0
     if matchre("%Forsaken", "(?i)(ON|1|YES)") then put #var UC_Forsaken 1
     if matchre("%JOURNAL.TYPE", "(?i)(NULL|OFF|0)") then put #var UC_Journal 0
     if !matchre("%JOURNAL.TYPE", "(?i)(NULL|OFF|0)") then put #var UC_Journal 1
     if matchre("%WINDBOARD", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_WindBoard 0
     if matchre("%WINDBOARD", "(?i)(ON|1|YES)") then put #var UC_WindBoard 1
     if matchre("%Bard.Scream", "(?i)(NULL|OFF|0)") then put #var UC_Scream 0
     if matchre("%Bard.Scream", "(?i)(ON|1|YES)") then put #var UC_Scream 1
     if matchre("%Bard.Whistle", "(?i)(NULL|OFF|0)") then put #var UC_Whistle 0
     if matchre("%Bard.Whistle", "(?i)(ON|1|YES)") then put #var UC_Whistle 1
     if matchre("%Orb.Rub", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_OrbRub 0
     if matchre("%Orb.Rub", "(?i)(ON|1|YES)") then put #var UC_OrbRub 1
     if matchre("%Lighter", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Lighter 0
     if matchre("%Lighter", "(?i)(ON|1|YES)") then put #var UC_Lighter 1
     if matchre("%CLIMBING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Climbing 0
     if matchre("%CLIMBING", "(?i)(ON|1|YES)") then put #var UC_Climbing 1
     if matchre("%MAGIC.ROPE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_MagicRope 0
     if matchre("%MAGIC.ROPE", "(?i)(ON|1|YES)") then put #var UC_MagicRope 1
     if matchre("%HERBS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Herbs 0
     if matchre("%HERBS", "(?i)(ON|1|YES)") then put #var UC_Herbs 1
     if matchre("%REPAIR.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Repair 0
     if matchre("%REPAIR.ARMOR", "(?i)(ON|1|YES)") then put #var UC_Repair 1
     if matchre("%SELLGEMS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_SellGems 0
     if matchre("%SELLGEMS", "(?i)(ON|1|YES)") then put #var UC_SellGems 1
     if matchre("%SELLMETALS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_SellMetals 0
     if matchre("%SELLMETALS", "(?i)(ON|1|YES)") then put #var UC_SellMetals 1
     if matchre("%SELLSKINS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_SellSkins 0
     if matchre("%SELLSKINS", "(?i)(ON|1|YES)") then put #var UC_SellSkins 1
     if matchre("%SKINTRAINER", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_SkinTrain 0
     if matchre("%SKINTRAINER", "(?i)(ON|1|YES)") then put #var UC_SkinTrain 1
     if matchre("%AUTOHEAL", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Autoheal 0
     if matchre("%AUTOHEAL", "(?i)(ON|1|YES)") then put #var UC_Autoheal 1
     if matchre("%HEAL.ALL", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_HealAll 0
     if matchre("%HEAL.ALL", "(?i)(ON|1|YES)") then put #var UC_HealAll 1
     if matchre("%RETURN.TO.COMBAT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Loop 0
     if matchre("%RETURN.TO.COMBAT", "(?i)(ON|1|YES)") then put #var UC_Loop 1
     if matchre("%ALMANAC", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Almanac 0
     if matchre("%ALMANAC", "(?i)(ON|1|YES)") then put #var UC_Almanac 1
     if matchre("%TEXTBOOK", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Textbook 0
     if matchre("%TEXTBOOK", "(?i)(ON|1|YES)") then put #var UC_Textbook 1
     if matchre("%POWERWALK", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_PowerWalk 0
     if matchre("%POWERWALK", "(?i)(ON|1|YES)") then put #var UC_PowerWalk 1
     if matchre("%EGG", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Egg 0
     if matchre("%EGG", "(?i)(ON|1|YES)") then
          {
               put #var UC_Egg 1
               var EggTime $gametime
               var EggLast 500
          }
     if matchre("%ASTROLABE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Astrolabe 0
     if matchre("%ASTROLABE", "(?i)(ON|1|YES)") then
          {
               put #var UC_Astrolabe 1
               var AstrolabeTime $gametime
               var AstrolabeLast $gametime
               var Astro1.Used 0
               var Astro2.Used 0
          }
     if matchre("%AmmoStock", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_RestockAmmo 0
     if matchre("%AmmoStock", "(?i)(ON|1|YES)") then put #var UC_RestockAmmo 1
     if matchre("%VAULT.SWAP", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_VaultSwap 0
     if matchre("%VAULT.SWAP", "(?i)(ON|1|YES)") then
          {
               put #var UC_VaultSwap 1
               put #var UC_VaultCity %VAULT.CITY
               put #var UC_VaultBag %CRAFTING.BAG
          }
     delay 0.00001
     ######### THIS CONVERTS SOME LOCAL VARIABLES TO BINARY 0 OR 1
     if matchre("%medContemplation", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var medContemplation 0
     if matchre("%medTenacity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var medTenacity 0
     if matchre("%medSerenity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var medSerenity 0
     if matchre("%medContemplation", "(?i)(ON|1|YES)") then var medContemplation 1
     if matchre("%medTenacity", "(?i)(ON|1|YES)") then var medTenacity 1
     if matchre("%medSerenity", "(?i)(ON|1|YES)") then var medSerenity 1
     if matchre("%Whirlwind", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var UC_Whirlwind 0
     if matchre("%Whirlwind", "(?i)(ON|1|YES)") then var UC_Whirlwind 1
     if matchre("%zerkCyclone", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var zerkCyclone 0
     if matchre("%zerkLandslide", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var zerkLandslide 0
     if matchre("%zerkDrought", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var zerkDrought 0
     if matchre("%zerkAvalanche", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var zerkAvalanche 0
     if matchre("%zerkTsunami", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var zerkTsunami 0
     if matchre("%zerkWildfire", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var zerkWildfire 0
     if matchre("%zerkEarthquake", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var zerkEarthquake 0
     if matchre("%zerkTornado", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var zerkTornado 0
     if matchre("%zerkFlashflood", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var zerkFlashflood 0
     if matchre("%zerkFamine", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var zerkFamine 0
     if matchre("%barbEagle", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbEagle 0
     if matchre("%barbBadger", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbBadger 0
     if matchre("%barbDragon", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbDragon 0
     if matchre("%barbPiranha", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbPiranha 0
     if matchre("%barbMonkey", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbMonkey 0
     if matchre("%barbTurtle", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbTurtle 0
     if matchre("%barbOwl", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbOwl 0
     if matchre("%barbBear", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbBear 0
     if matchre("%barbBuffalo", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbBuffalo 0
     if matchre("%barbPython", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbPython 0
     if matchre("%barbSwan", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbSwan 0
     if matchre("%barbToad", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbToad 0
     if matchre("%barbWolverine", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var barbWolverine 0
     if matchre("%roarEmbrace", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var roarEmbrace 0
     if matchre("%roarEverild", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var roarEverild 0
     if matchre("%roarWail", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var roarWail 0
     if matchre("%roarAnger", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var roarAnger 0
     if matchre("%roarScreech", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var roarScreech 0
     if matchre("%roarShriek", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var roarShriek 0
     if matchre("%roarKuniyo", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var roarKuniyo 0
     if matchre("%barbEagle", "(?i)(ON|1|YES)") then var barbEagle 1
     if matchre("%barbBadger", "(?i)(ON|1|YES)") then var barbBadger 1
     if matchre("%barbPiranha", "(?i)(ON|1|YES)") then var barbPiranha 1
     if matchre("%barbPiranha", "(?i)(ON|1|YES)") then var barbPiranha 1
     if matchre("%barbMonkey", "(?i)(ON|1|YES)") then var barbMonkey 1
     if matchre("%barbTurtle", "(?i)(ON|1|YES)") then var barbTurtle 1
     if matchre("%barbOwl", "(?i)(ON|1|YES)") then var barbOwl 1
     if matchre("%barbBear", "(?i)(ON|1|YES)") then var barbBear 1
     if matchre("%barbBuffalo", "(?i)(ON|1|YES)") then var barbBuffalo 1
     if matchre("%barbDragon", "(?i)(ON|1|YES)") then var barbDragon 1
     if matchre("%barbPython", "(?i)(ON|1|YES)") then var barbPython 1
     if matchre("%barbSwan", "(?i)(ON|1|YES)") then var barbSwan 1
     if matchre("%barbToad", "(?i)(ON|1|YES)") then var barbToad 1
     if matchre("%barbWolverine", "(?i)(ON|1|YES)") then var barbWolverine 1
     if matchre("%roarAnger", "(?i)(ON|1|YES)") then var roarAnger 1
     if matchre("%roarEmbrace", "(?i)(ON|1|YES)") then var roarEmbrace 1
     if matchre("%roarEverild", "(?i)(ON|1|YES)") then var roarEverild 1
     if matchre("%roarWail", "(?i)(ON|1|YES)") then var roarWail 1
     if matchre("%roarScreech", "(?i)(ON|1|YES)") then var roarScreech 1
     if matchre("%roarShriek", "(?i)(ON|1|YES)") then var roarShriek 1
     if matchre("%roarKuniyo", "(?i)(ON|1|YES)") then var roarKuniyo 1
     if matchre("%zerkFamine", "(?i)(ON|1|YES)") then var zerkFamine 1
     if matchre("%zerkCyclone", "(?i)(ON|1|YES)") then var zerkCyclone 1
     if matchre("%zerkAvalanche", "(?i)(ON|1|YES)") then var zerkAvalanche 1
     if matchre("%zerkTsunami", "(?i)(ON|1|YES)") then var zerkTsunami 1
     if matchre("%zerkWildfire", "(?i)(ON|1|YES)") then var zerkWildfire 1
     if matchre("%zerkEarthquake", "(?i)(ON|1|YES)") then var zerkEarthquake 1
     if matchre("%zerkTornado", "(?i)(ON|1|YES)") then var zerkTornado 1
     if matchre("%zerkFlashflood", "(?i)(ON|1|YES)") then var zerkFlashflood 1
     if matchre("%zerkLandslide", "(?i)(ON|1|YES)") then var zerkLandslide 1
     if matchre("%zerkDrought", "(?i)(ON|1|YES)") then var zerkDrought 1
     if matchre("%khriSTEADY", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriSTEADY 0
     if matchre("%khriSTRIKE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriSTRIKE 0
     if matchre("%khriFOCUS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriFOCUS 0
     if matchre("%khriHASTEN", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriHASTEN 0
     if matchre("%khriELUSION", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriELUSION 0
     if matchre("%khriENDURE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriENDURE 0
     if matchre("%khriINTIMIDATE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriINTIMIDATE 0
     if matchre("%khriAVOIDANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriAVOIDANCE 0
     if matchre("%khriADAPTATION", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriADAPTATION 0
     if matchre("%khriPROWESS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriPROWESS 0
     if matchre("%khriPLUNDER", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriPLUNDER 0
     if matchre("%khriTERRIFY", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriTERRIFY 0
     if matchre("%khriFLIGHT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriFLIGHT 0
     if matchre("%khriSAGACITY", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriSAGACITY 0
     if matchre("%khriHARRIER", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriHARRIER 0
     if matchre("%khriDARKEN", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriDARKEN 0
     if matchre("%khriDAMPEN", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriDAMPEN 0
     if matchre("%khriSHADOWSTEP", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriSHADOWSTEP 0
     if matchre("%khriEVANESCENCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriEVANESCENCE 0
     if matchre("%khriGUILE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriGUILE 0
     if matchre("%khriCREDENCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriCREDENCE 0
     if matchre("%khriCALM", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriCALM 0
     if matchre("%khriSERENITY", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriSERENITY 0
     if matchre("%khriFRIGHT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriFRIGHT 0
     if matchre("%khriCUNNING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriCUNNING 0
     if matchre("%khriELIMINATE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriELIMINATE 0
     if matchre("%khriSAFE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var khriSAFE 0
     if matchre("%khriSTEADY", "(?i)(ON|1|YES)") then var khriSTEADY 1
     if matchre("%khriSTRIKE", "(?i)(ON|1|YES)") then var khriSTRIKE 1
     if matchre("%khriFOCUS", "(?i)(ON|1|YES)") then var khriFOCUS 1
     if matchre("%khriHASTEN", "(?i)(ON|1|YES)") then var khriHASTEN 1
     if matchre("%khriELUSION", "(?i)(ON|1|YES)") then var khriELUSION 1
     if matchre("%khriENDURE", "(?i)(ON|1|YES)") then var khriENDURE 1
     if matchre("%khriINTIMIDATE", "(?i)(ON|1|YES)") then var khriINTIMIDATE 1
     if matchre("%khriAVOIDANCE", "(?i)(ON|1|YES)") then var khriAVOIDANCE 1
     if matchre("%khriADAPTATION", "(?i)(ON|1|YES)") then var khriADAPTATION 1
     if matchre("%khriPROWESS", "(?i)(ON|1|YES)") then var khriPROWESS 1
     if matchre("%khriPLUNDER", "(?i)(ON|1|YES)") then var khriPLUNDER 1
     if matchre("%khriTERRIFY", "(?i)(ON|1|YES)") then var khriTERRIFY 1
     if matchre("%khriFLIGHT", "(?i)(ON|1|YES)") then var khriFLIGHT 1
     if matchre("%khriSAGACITY", "(?i)(ON|1|YES)") then var khriSAGACITY 1
     if matchre("%khriHARRIER", "(?i)(ON|1|YES)") then var khriHARRIER 1
     if matchre("%khriDARKEN", "(?i)(ON|1|YES)") then var khriDARKEN 1
     if matchre("%khriDAMPEN", "(?i)(ON|1|YES)") then var khriDAMPEN 1
     if matchre("%khriSHADOWSTEP", "(?i)(ON|1|YES)") then var khriSHADOWSTEP 1
     if matchre("%khriEVANESCENCE", "(?i)(ON|1|YES)") then var khriEVANESCENCE 1
     if matchre("%khriELIMINATE", "(?i)(ON|1|YES)") then var khriELIMINATE 1
     if matchre("%khriGUILE", "(?i)(ON|1|YES)") then var khriGUILE 1
     if matchre("%khriCREDENCE", "(?i)(ON|1|YES)") then var khriCREDENCE 1
     if matchre("%khriCALM", "(?i)(ON|1|YES)") then var khriCALM 1
     if matchre("%khriSERENITY", "(?i)(ON|1|YES)") then var khriSERENITY 1
     if matchre("%khriFRIGHT", "(?i)(ON|1|YES)") then var khriFRIGHT 1
     if matchre("%khriCUNNING", "(?i)(ON|1|YES)") then var khriCUNNING 1
     if matchre("%khriSAFE", "(?i)(ON|1|YES)") then var khriSAFE 1
#######################################################################################
     if matchre("%Khri.Town", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var Khri.Town 0
     if matchre("%Khri.Town", "(?i)\b(ON|1|YES)\b") then put #var Khri.Town 1
     if matchre("%Snipe", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Snipe 0
     if (matchre("%Poach", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") || ($UC_Snipe = 1)) then put #var UC_Poach 0
     if (matchre("%Poach", "(?i)(ON|1|YES)") && ($UC_Snipe = 0)) then put #var UC_Poach 1
     if matchre("%Tipping", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Tipping 0
     if matchre("%Tipping", "(?i)(ON|1|YES)") then put #var UC_Tipping 1
     if matchre("%Wand1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Wand 0
     if !matchre("%Wand1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Wand 1
     if !matchre("%Wand2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Wand 1
     if matchre("%NO.CONTACT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_No.Contact 0
     if matchre("%NO.CONTACT", "(?i)(ON|1|YES)") then put #var UC_No.Contact 1
     if matchre("%LOG.ON.STUN", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Log.on.Stun 0
     if matchre("%LOG.ON.STUN", "(?i)(ON|1|YES)")) then put #var UC_Log.on.Stun 1
     if matchre("%LOG.ON.DEATH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Log.on.Death 0
     if matchre("%LOG.ON.DEATH", "(?i)(ON|1|YES)") then put #var UC_Log.on.Death 1
     if matchre("%Sheath.1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath1 NULL
     if matchre("%Sheath.1.Weapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath.1.Weapons NULL
     if matchre("%Sheath.2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath2 NULL
     if matchre("%Sheath.2.Weapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath.2.Weapons NULL
     if matchre("%Sheath.3", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath3 NULL
     if matchre("%Sheath.3.Weapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath.3.Weapons NULL
     if matchre("%Sheath.4", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath4 NULL
     if matchre("%Sheath.4.Weapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath.4.Weapons NULL
     if matchre("%Sheath.5", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath5 NULL
     if matchre("%Sheath.5.Weapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath.5.Weapons NULL
     if matchre("%Sheath.6", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath6 NULL
     if matchre("%Sheath.6.Weapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath.6.Weapons NULL
     #
     if !matchre("%Sheath.1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath1 %Sheath.1
     if !matchre("%Sheath.1.Weapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath.1.Weapons %Sheath.1.Weapons
     if !matchre("%Sheath.2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath2 %Sheath.2
     if !matchre("%Sheath.2.Weapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath.2.Weapons %Sheath.2.Weapons
     if !matchre("%Sheath.3", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath3 %Sheath.3
     if !matchre("%Sheath.3.Weapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath.3.Weapons %Sheath.3.Weapons
     if !matchre("%Sheath.4", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath4 %Sheath.4
     if !matchre("%Sheath.4.Weapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath.4.Weapons %Sheath.4.Weapons
     if !matchre("%Sheath.5", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath5 %Sheath.5
     if !matchre("%Sheath.5.Weapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath.5.Weapons %Sheath.5.Weapons
     if !matchre("%Sheath.6", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath6 %Sheath.6
     if !matchre("%Sheath.6.Weapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Sheath.6.Weapons %Sheath.6.Weapons
     ### SET ARMOR
     put #var UC_MyShield %MyShield
     put #var UC_Armor.Chest %CHEST.ARMOR
     put #var UC_Armor.Head %HEAD.ARMOR
     put #var UC_Armor.Abdomen %ABDOMEN.ARMOR
     put #var UC_Armor.Back %BACK.ARMOR
     put #var UC_Armor.Arms %ARM.ARMOR
     put #var UC_Armor.Hands %HAND.ARMOR
     put #var UC_Armor.Legs %LEG.ARMOR
     put #var UC_Armor.Face %FACE.ARMOR
     put #var UC_Armor.Knuckle %KNUCKLE
     put #var UC_Armor.ParryStick %PARRYSTICK
     var ARMOR.HEAD $UC_Armor.Head
     if matchre("%B.CHEST.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var B.CHEST.ARMOR $UC_Armor.Chest
     if matchre("%B.HEAD.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var B.HEAD.ARMOR $UC_Armor.Head
     if matchre("%B.ABDOMEN.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var B.ABDOMEN.ARMOR $UC_Armor.Abdomen
     if matchre("%B.BACK.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var B.BACK.ARMOR $UC_Armor.Back
     if matchre("%B.ARM.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var B.ARM.ARMOR $UC_Armor.Arms
     if matchre("%B.HAND.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var B.HAND.ARMOR $UC_Armor.Hands
     if matchre("%B.FACE.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var B.FACE.ARMOR $UC_Armor.Face
     if matchre("%B.LEG.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var B.LEG.ARMOR $UC_Armor.Legs
     if matchre("%B.KNUCKLE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var B.KNUCKLE $UC_Armor.Knuckle
     if matchre("%Armor.Swap", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_ArmorSwap 0
     if matchre("%Armor.Swap", "(?i)(ON|1|YES)") then put #var UC_ArmorSwap 1
     put #var Light_Armor.Helm %Light_Armor.Helm
     put #var Chain_Armor.Helm %Chain_Armor.Helm
     put #var Brigandine.Helm %Brigandine.Helm
     put #var Plate_Armor.Helm %Plate_Armor.Helm
     put #var UC_Armor.Backtrain.Chest %B.CHEST.ARMOR
     put #var UC_Armor.Backtrain.Head %B.HEAD.ARMOR
     put #var UC_Armor.Backtrain.Abdomen %B.ABDOMEN.ARMOR
     put #var UC_Armor.Backtrain.Back %B.BACK.ARMOR
     put #var UC_Armor.Backtrain.Arms %B.ARM.ARMOR
     put #var UC_Armor.Backtrain.Hands %B.HAND.ARMOR
     put #var UC_Armor.Backtrain.Face %B.FACE.ARMOR
     put #var UC_Armor.Backtrain.Legs %B.LEG.ARMOR
     put #var UC_Armor.Backtrain.Knuckle %B.KNUCKLE
     put #var UC_plateArmor1 %PLATE1
     put #var UC_plateArmor2 %PLATE2
     put #var UC_plateArmor3 %PLATE3
     put #var UC_plateArmor4 %PLATE4
     put #var UC_lightArmor1 %LIGHTARMOR1
     put #var UC_lightArmor2 %LIGHTARMOR2
     put #var UC_lightArmor3 %LIGHTARMOR3
     put #var UC_lightArmor4 %LIGHTARMOR4
     # pause 0.0001
     ### CLERIC COMMUNE VARIABLES
     if ("$guild" = "Cleric") then
          {
               action (communes) on
               var FlintBlade NULL
               if !def(UC_meraud) then put #var UC_meraud 0
               if !def(UC_truffenyi) then put #var UC_truffenyi 0
               if !def(UC_eluned) then put #var UC_eluned 0
               if !def(UC_tamsine) then put #var UC_tamsine 0
               if matchre("%Commune.Meraud", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Commune.Meraud 0
               if matchre("%Commune.Meraud", "(?i)(ON|1|YES)") then put #var UC_Commune.Meraud 1
               if matchre("%Commune.Truffenyi", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Commune.Truffenyi 0
               if matchre("%Commune.Truffenyi", "(?i)(ON|1|YES)") then put #var UC_Commune.Truffenyi 1
               if matchre("%Commune.Tamsine", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_Commune.Tamsine 0
               if matchre("%Commune.Tamsine", "(?i)ON") then put #var UC_Commune.Tamsine 1
               if !matchre("%THEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %THEWEAPON
               if !matchre("%OHWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %OHWEAPON
               if !matchre("%BSWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %BSWEAPON
               if !matchre("%LEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %LEWEAPON
               if !matchre("%SEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %SEWEAPON
               if !matchre("%Skinning.Knife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %Skinning.Knife
               if !matchre("%FlintKnife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %FlintKnife
               if ($UC_Zills = 1) then var Instrument %Zill.Name
               if ($UC_Zills = 0) then var Instrument lyre
               var InstrumentCont $UC_Container
               var PlaySongStyle $SONG
               var PrayTo %FAVOR.GOD
          }
     ### SETUP MISC VARS
     if ($UC_Journal = 1) then put #var UC_Journal.Time {#evalmath ($gametime - 87000)}
     if !matchre("%ThrowType", "(?i)(LOB|HURL|THROW)") then var ThrowType lob
     if !matchre("%element", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_element %element
     if matchre("%element", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_element fire
     if ($Outdoorsmanship.Ranks < 200) then var Collect grass
     if (($Outdoorsmanship.Ranks >= 200) && ($Outdoorsmanship.Ranks < 1200)) then var Collect rock
     if ($Outdoorsmanship.Ranks >= 1200) then var Collect coin
     # if ($UC_TiePouch = 1) then put #var UC_SellGems 0
     if matchre("$guild", "%MAGICUSER") then
          {
               action (magic) on
               put #var UC_Cambrinth %Cambrinth
               put #var UC_Cyclic.Cambrinth %Cyclic.Cambrinth
               put #var UC_CambMana %CambrinthMana
               put #var UC_CyclicCharge %CyclicCharge
               put #var Mana.Target %Target.Mana
               put #var Mana.Debilitation %Debilitation.Mana
               put #var Mana.Warding %Warding.Mana
               put #var Mana.Utility %Utility.Mana
               put #var Mana.Augmentation %Augmentation.Mana
               put #var Mana.Sorcery %Sorcery.Mana
               put #var Camb.Target %Target.Camb
               put #var Camb.Debilitation %Debilitation.Camb
               put #var Camb.Warding %Warding.Camb
               put #var Camb.Utility %Utility.Camb
               put #var Camb.Augmentation %Augmentation.Camb
               if (%firstlaunch = 1) then put #var Camb.Sorcery %Sorcery.Camb
          }
     put #var UC_BankBot %BankBot
     put #var UC_TipRoom %TipRoom
     put #var UC_LootOption %Loot.Option
     put #var UC_bundleMax %MaxBundle
     put #var UC_MaxTrain %MAX.TRAIN
     put #var UC_Skinner %Skinning.Knife
     put #var UC_ALLSWAPPABLE %ALLSWAPPABLE
     put #var UC_ArrangeTarget %ArrangeTarget
     put #var UC_MaxMonsters %Dance.Count
     put #var UC_CRITTER.ROOMS %CRITTER.ROOMS
     put #var UC_friends %FRIENDS
     put #var UC_Ammo 1
     put #var UC_CambMana %CambrinthMana
     put #var UC_Snap.Fire %SNAP.FIRE
     ##################################################################
     if ("$guild" = "Necromancer") then
          {
               action (necro) on
               if matchre("%QuickenEarth", "(?i)(ON|1|YES)") then put #tvar UC_QuickenEarth 1
          }
     if ("$guild" = "Warrior Mage") then
          {
               if matchre("%Telescope.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Telescope.Container $UC_Container
          }
     if ("$guild" = "Empath") then
          {
               if matchre("%Unity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UNITY 0
               if matchre("%Unity", "(?i)(ON|1|YES)") then put #var UNITY 1
          }
     if (("$guild" != "Warrior Mage") || matchre("%SummonWeapons", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then put #tvar UC_SummonWeapons 0
     if ("$guild" = "Warrior Mage") then
          {
               if matchre("%SummonWeapons", "(?i)(ON|1|YES)") then put #var UC_SummonWeapons 1
               if matchre("%Summoning", "(?i)(ON|1|YES)") then put #var UC_Summoning 1
          }
     if ("$guild" = "Moon Mage") then var Observe 1
     if (("$guild" = "Barbarian") && matchre("%DualWield", "(?i)(ON|1|YES)")) then put #var UC_DualWield 1
     if !matchre("$guild", "Cleric") then put #var SpellTimer.OsrelMeraud.active 0
     if matchre("$game", "(DRF|DRX)") then put #var UC_Premium 1
     if ($UC_F2P = 1) then put #var UC_TieBundle 1
     if (%XBOW.OFF = 1) then
          {
               var RANGED.CROSSBOW NULL
               var BACKTRAIN.CROSSBOW NULL
          }
     if (%BOW.OFF = 1) then
          {
               var RANGED.BOW NULL
               var BACKTRAIN.BOW NULL
          }
     if (%SLING.OFF = 1) then
          {
               var RANGED.SLING NULL
               var BACKTRAIN.SLING NULL
          }
####################################################################################
# SETUP INITIAL SCRIPT COMMANDS
     if matchre("$charactername", "%Blacklisted") then gosub CHECKIN
     if matchre("%command", "(?i)MAIN") then
     {
          echo
          echo ########################
          echo ** "MAIN" Command Used!
          echo ** Skipping to Main Combat first
          echo ########################
          echo
          var Backtrained 1
          var Backtraining 0
     }
     if matchre("%command", "(?i)FIGHT") then
     {
          echo
          echo ########################
          echo ** "FIGHT" Command Used!
          echo ** STARTING COMBAT WHERE WE STAND!
          echo ** USING ~MAIN~ COMBAT WEAPONS
          echo ########################
          echo
          var Backtrained 1
          var Backtraining 0
     }
### CHECK FOR FIRST TIMER STARTUP OR NOT RUN SETUP IN ~2 WEEKS
     if (matchre("$guild", "%MAGICUSER") && ($UC_SmartSpells = 1) && !matchre("%command", "(?i)(HEALBOT|NOCOMBAT)")) then
          {
               gosub SETUP_TIMER
               if ($UC_Setup.Last > 950400) then
                    {
                         var command SETUP
                         echo
                         echo ######################################
                         echo # *** FIRST TIME SCRIPT SETUP DETECTED!
                         echo # *** OR HAVE NOT RUN ~SETUP~ COMMAND IN OVER 2 WEEKS
                         echo # *** RUNNING AUTOMATIC ~SETUP~ MODE TO SET MAGIC VARS
                         echo ######################################
                         echo
                         pause
                    }
          }
     if matchre("%command", "(?i)SETUP") then
          {
               var SMART.SPELLS ON
               put #var UC_Setup.Time $gametime
               put #var UC_SmartSpells 1
               put #echo >Log #FF0495 ** *SETUP* command used - Resetting Spell Smart Mana
               echo
               echo ############################
               echo **   ~SETUP~ COMMAND USED!
               echo ** RESETTING ALL SPELL MANA VARIABLES
               echo ** RE-DISCERNING ALL SPELLS & BUFFS
               echo ############################
               echo
               pause 0.4
          }
     if matchre("%command", "(?i)NoCombat") then
          {
               echo
               echo ########################
               echo ** NO COMBAT COMMAND USED!
               echo ** PERMANENT TOWN RUN
               echo ** TURNING OFF COMBAT
               echo ########################
               echo
               put #echo >Log #00ffff ** "NOCOMBAT" COMMAND USED - Town Run ONLY
               pause 0.5
               put #var UC_NoCombat 1
               var AUTOHEAL ON
               var Backtraining 0
          }
     if matchre("%command", "(?i)(death|died|dead)") then
          {
               if ($health < 70) then
                    {
                         put #echo >Log #00ffff ** *DEATH* COMMAND USED! - Waiting for health to recover
                         echo
                         echo ####################
                         echo *** DEATH COMMAND USED -
                         echo *** WAITING FOR HEALTH TO REGEN
                         echo *** BEFORE CONTINUING
                         echo ####################
                         echo
                         waiteval ($health > 85)
                    }
          }
     if matchre("%command", "(?i)noob") then
          {
               put #echo >Log #00ffff ** *NOOB* COMMAND USED - Running Noob Routine
               echo
               echo #####################
               echo ** NOOB COMMAND INITIATED!
               echo ** TRAINING IN ONE ROOM
               echo #####################
               echo
               pause 0.5
               goto NOOB_LOOP
          }
     if matchre("%command", "(?i)invasion") then
          {
               put #echo >Log #00ffff ** *INVASION* COMMAND USED! - STARTING COMBAT WITH TOP WEAPON!
               echo
               echo ####################
               echo *** INVASION COMMAND USED -
               echo *** STARTING COMBAT IN CURRENT ROOM
               echo *** USING TOP WEAPON
               echo ####################
               echo
          }
### AIM ACTIONS REPLACEMENTS
NOCOMBAT_CHECK:
     if !matchre("$guild", "Cleric") then
          {
               if !matchre("%AimActions", "(?i)pray truffenyi") then
                    {
                         eval AimActions replacere("%AimActions", "pray truffenyi", "attack")
                    }
          }
### REPLACE ANY PHYSICAL ATTACK ACTIONS IN EMPATH AIMACTION TO NOT ACCIDENTALLY ATTACK LIVE CREATURES
     if (("$guild" = "Empath") && ($UC_ConstructOnly = 1)) then
          {
               delay 0.00001
               if !matchre("%AimActions", "(?i)\b(attack left|attack|bash|bite|butt|chop|claw|draw|elbow|feint|kick|knee|lunge|pummel|punch|slam|slap|slice|sweep|swing|thrust|throw .*)\b") then goto INIT
               echo ###################################
               echo ** EMPATH DETECTED - Hostile Attacks Found in AimActions!
               echo ** Converting hostile attacks with non-damaging moves for safety
               echo ** OLD AimActions %AimActions
               eval AimActions replacere("%AimActions", "(bash|bite|butt|chop|claw|draw)", "weave")
               eval AimActions replacere("%AimActions", "(draw|elbow|feint|kick|knee)", "circle")
               eval AimActions replacere("%AimActions", "(attack|elbow|feint|kick)", "bob")
               eval AimActions replacere("%AimActions", "(lunge|pummel|punch|slam|slap)", "weave")
               eval AimActions replacere("%AimActions", "(slice|sweep|swing|thrust)", "shove")
               eval AimActions replacere("%AimActions", "(attack left|throw .*)", "circle")
               echo ** NEW AimActions: %AimActions
               echo ###################################
               pause 0.4
          }
     eval AimActions replacere("%AimActions", "\|+", "|")
     eval AimActions replacere("%AimActions", "^\|", "")
     eval AimActions replacere("%AimActions", "\|$", "")
########################################################################
#### END OF SETTING ALL BASE VARIABLES
########################################################################
# if ("$guild" = "Ranger") then gosub RANGER_STRIP
# if ("$guild" = "Necromancer") then gosub NECRO_STRIP
# if ("$guild" = "Thief") then gosub THIEF_STRIP
# if ("$guild" = "Paladin") then gosub PALADIN_STRIP
# if ("$guild" = "Empath") then gosub EMPATH_STRIP
# if ("$guild" = "Cleric") then gosub CLERIC_STRIP
# if ("$guild" = "Bard") then gosub BARD_STRIP
# if ("$guild" = "Moon Mage") then gosub MM_STRIP
# if ("$guild" = "Warrior Mage") then gosub WM_STRIP
# if ("$guild" = "Trader") then gosub TRADER_STRIP
# if ("$guild" = "Barbarian") then gosub BARB_STRIP
# if ("$guild" != "Barbarian") then gosub NON_BARB_STRIP
# if ("$guild" != "Thief") then gosub NON_THIEF_STRIP
# if ("$guild" != "Warrior Mage") then gosub NON_WM_STRIP

########################################################
## PRIMARY INIT / WEAPON SETUP
###########################################################
### SCRIPT RESTARTS HERE AFTER A FULL LOOP
INIT:
     # debug 10
     delay 0.00001
     gosub clear
     gosub stowing
     if ($standing = 0) then gosub STAND
     var MAX.LEARNINGRATE %MAX.LEARNINGRATE
     if matchre("$scriptlist" , "disarm\.cmd") then put #script abort disarm
     if matchre("$scriptlist" , "braid\.cmd") then put #script abort braid
     if matchre("$scriptlist" , "climbcross\.cmd") then put #script abort climbcross
     if matchre("$scriptlist" , "steal\.cmd") then put #script abort steal
     if matchre("$scriptlist" , "climb\.cmd") then put #script abort climb
     if matchre("$scriptlist" , "automapper\.cmd") then put #script abort automapper
     if matchre("$scriptlist" , "burgle\.cmd") then put #script abort burgle
     if matchre("$scriptlist" , "travel\.cmd") then put #script abort travel
     if matchre("$scriptlist" , "mastercraft\.cmd") then put #script abort mastercraft
     if matchre("$scriptlist" , "MC_Carve\.cmd") then put #script abort MC_Carve
     if matchre("$scriptlist" , "MC_Enchant\.cmd") then put #script abort MC_Enchant
     if matchre("$scriptlist" , "MC_Grind\.cmd") then put #script abort MC_Grind
     if matchre("$scriptlist" , "MC_Knit\.cmd") then put #script abort MC_Knit
     if matchre("$scriptlist" , "MC_Mix\.cmd") then put #script abort MC_Mix
     if matchre("$scriptlist" , "MC_Pound\.cmd") then put #script abort MC_Pound
     if matchre("$scriptlist" , "MC_Setup\.cmd") then put #script abort MC_Setup
     if matchre("$scriptlist" , "MC_Sew\.cmd") then put #script abort MC_Sew
     if matchre("$scriptlist" , "MC_Shape\.cmd") then put #script abort MC_Shape
     if matchre("$scriptlist" , "MC_Smelt\.cmd") then put #script abort MC_Smelt
     if matchre("$scriptlist" , "MC_Spin\.cmd") then put #script abort MC_Spin
     if matchre("$scriptlist" , "MC_Tinker\.cmd") then put #script abort MC_Tinker
     if matchre("$scriptlist" , "MC_Weave\.cmd") then put #script abort MC_Weave
     if matchre("%command", "(?i)heal") then
          {
               action (stunned) off
               action (combat) off
               action (escape) off
               action (dead) off
               goto SETUP
          }
     ### RESET ALL VARIABLES THAT NEED TO RESET AFTER LOOP
     var Collect.Combat 1
     put #var UC_Ammo 1
     put #var needHealing 0
     put #var UC_bagsFull 0
     put #var UC_bundleFull 0
     var HuntTime $gametime
     var DumpTime $gametime
     var AppraiseTime $gametime
     var PerceiveTime $gametime
     var CastTime $gametime
     var CastLast $gametime
     var BuffTime $gametime
     if (%RangedWeapons = 0) then put #var UC_Ammo 1
     if matchre("%Bundle", "(?i)(ON|1|YES)") then put #var UC_Bundle 1
     if matchre("%Snipe", "(?i)(ON|1|YES)") then
          {
               if matchre("$guild", "%SNIPEUSER") then put #var UC_Snipe 1
               if !matchre("$guild", "%SNIPEUSER") then
                    {
                         put #var UC_Snipe 0
                         put #var UC_Poach 1
                    }
          }
     ### AMMO FIX - FIX AMMO VARIABLES
     eval TempAmmo tolower("%BowAmmo")
     eval TempAmmo2 tolower("%XbowAmmo")
     eval TempAmmo3 tolower("%SlingAmmo")
     if matchre("%TempAmmo", "(?i)blood red arrow") then var BowAmmo blood arrow
     if matchre("%TempAmmo", "(?i)drake head arrow") then var BowAmmo drake arrow
     if matchre("%TempAmmo", "(?i)basilisk head arrow") then var BowAmmo basilisk arrow
     if matchre("%TempAmmo", "(?i)blunt tip arrow") then var BowAmmo blunt arrow
     if matchre("%TempAmmo", "(?i)long mistwood arrow") then var BowAmmo mistwood arrow
     if matchre("%TempAmmo", "(?i)long silver arrow") then var BowAmmo silver arrow
     if matchre("%TempAmmo", "(?i)slender tip arrow") then var BowAmmo slender arrow
     if matchre("%TempAmmo", "(?i)broad-barbed arrow") then var BowAmmo broad arrow
     if matchre("%TempAmmo", "(?i)slim cane arrow") then var BowAmmo cane arrow
     if matchre("%TempAmmo", "(?i)pyramid head arrow") then var BowAmmo pyramid arrow
     if matchre("%TempAmmo", "(?i)serrated bone arrow") then var BowAmmo bone arrow
     if matchre("%TempAmmo", "(?i)bone-tipped arrow") then var BowAmmo bone arrow
     if matchre("%TempAmmo", "(?i)serrated bone arrow") then var BowAmmo bone arrow
     if matchre("%TempAmmo2", "(?i)blunt-tip oak bolt") then var XbowAmmo oak bolt
     if matchre("%TempAmmo2", "(?i)blunt tip bolt") then var XbowAmmo blunt bolt
     if matchre("%TempAmmo2", "(?i)blunt flint-tip bolt") then var XbowAmmo blunt bolt
     if matchre("%TempAmmo2", "(?i)broad barbed bolt") then var XbowAmmo barbed bolt
     if matchre("%TempAmmo2", "(?i)slender tip bolt") then var XbowAmmo slender bolt
     if matchre("%TempAmmo2", "(?i)thin steel-tip bolt") then var XbowAmmo thin bolt
     if matchre("%TempAmmo", "(?i)tumbled river rock") then var SlingAmmo tumbled rock
     if (matchre("%BowAmmo", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SlingAmmo", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%XbowAmmo", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then put #var UC_Ammo 0
     eval BowAmmo replacere("%BowAmmo", "s$", "")
     eval XbowAmmo replacere("%XbowAmmo", "s$", "")
     eval SlingAmmo replacere("%SlingAmmo", "s$", "")
     # pause 0.00001
     #### NEW STRIP LEADING/TRAILING/DUPLICATES FROM SPELL VARS
     eval %GuildType.Buffs replacere("%%GuildType.Buffs", "\|+", "|")
     eval %GuildType.Buffs replacere("%%GuildType.Buffs", "\|$", "")
     eval %GuildType.Buffs replacere("%%GuildType.Buffs", "^\|", "")
     eval %GuildType.Cyclics replacere("%%GuildType.Cyclics", "\|+", "|")
     eval %GuildType.Cyclics replacere("%%GuildType.Cyclics", "\|$", "")
     eval %GuildType.Cyclics replacere("%%GuildType.Cyclics", "^\|", "")
     eval %GuildType.Cyclics.mana replacere("%%GuildType.Cyclics.mana", "\|+", "|")
     eval %GuildType.Cyclics.mana replacere("%%GuildType.Cyclics.mana", "\|$", "")
     eval %GuildType.Cyclics.mana replacere("%%GuildType.Cyclics.mana", "^\|", "")
     eval OM.Buffs replacere("%OM.Buffs", "\|+", "|")
     eval OM.Buffs replacere("%OM.Buffs", "\|$", "")
     eval OM.Buffs replacere("%OM.Buffs", "^\|", "")
     # WAND FIX
     var Wand3 %Wand2
     if matchre("%Wand3", "(?i)second") then
          {
               eval Wand3 replace("%Wand3", "second" "")
          }
WEAPON_SETUP:
     ### SETUP WEAPONS
     var CURRENT WEAPON SETUP
     gosub STATUSBAR
     var skillcount 0
     var combatcount 0
     var combatsToCheck
     var combatsToTrain
     if ("$guild" != "Thief") then
          {
               var Backstab NULL
               var BSWEAPON NULL
          }
     ## SET SUMMONED WEAPONS FOR WM
     if (("$guild" = "Warrior Mage") && ($UC_SummonWeapons = 1)) then
          {
               put #var UC_SummonWeapons 1
               if (!matchre("%SummonHT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 0)) then var HTWEAPON javelin
               if (!matchre("%SummonLT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 0)) then var LTWEAPON bola
               if (!matchre("%SummonSE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 0)) then var SEWEAPON scimitar
               if (!matchre("%SummonLE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 0)) then var LEWEAPON broadsword
               if (!matchre("%SummonTHE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 0)) then var THEWEAPON marauder blade
               if (!matchre("%SummonSB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 0)) then var SBWEAPON mallet
               if (!matchre("%SummonLB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 0)) then var LBWEAPON hara
               if (!matchre("%SummonTHB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 0)) then var THBWEAPON maul
               if (!matchre("%SummonStaves", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 0)) then var STAVES quarterstaff
               if (!matchre("%SummonPolearms", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 0)) then var POLEARMS lance
               if (!matchre("%SummonHT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 1)) then var HTWEAPON spear
               if (!matchre("%SummonLT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 1)) then var LTWEAPON boomerang
               if (!matchre("%SummonSE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 1)) then var SEWEAPON short sword
               if (!matchre("%SummonLE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 1)) then var LEWEAPON nimsha
               if (!matchre("%SummonTHE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 1)) then var THEWEAPON periperiu sword
               if (!matchre("%SummonSB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 1)) then var SBWEAPON cudgel
               if (!matchre("%SummonLB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 1)) then var LBWEAPON heavy mace
               if (!matchre("%SummonTHB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 1)) then var THBWEAPON vilks kodur
               if (!matchre("%SummonStaves", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 1)) then var STAVES nightstick
               if (!matchre("%SummonPolearms", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%SummonTemplate = 1)) then var POLEARMS bardiche
               var LongSummonWeapons bardiche|lance|quarterstaff|spear
               delay 0.00001
               echo *** SUMMONED WEAPONS:
               if !matchre("%SummonHT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** HTWEAPON %HTWEAPON
               if !matchre("%SummonLT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** LTWEAPON %LTWEAPON
               if !matchre("%SummonSE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** SEWEAPON %SEWEAPON
               if !matchre("%SummonLE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** LEWEAPON %LEWEAPON
               if !matchre("%SummonTHE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** THEWEAPON %THEWEAPON
               if !matchre("%SummonSB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** SBWEAPON %SBWEAPON
               if !matchre("%SummonLB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** LBWEAPON %LBWEAPON
               if !matchre("%SummonTHB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** THBWEAPON %THBWEAPON
               if !matchre("%SummonStaves", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** STAVES %STAVES
               if !matchre("%SummonPolearms", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** POLEARMS %POLEARMS
               delay 0.00001
          }
     if ("$guild" = "Empath") then
          {
               var ParalysisLast 100
               var NissaLast 100
          }
     ## SET BACKTRAIN WEAPONS TO MAIN WEAPONS IF BACKTRAINING
     if ($UC_Backtrain = 1) then
          {
               if (((%Backtrained = 0) && !matchre("%command", "(?i)(FIGHT|INVASION)")) || ((%Backtraining = 1) && !matchre("%command", "(?i)(FIGHT|INVASION)"))) then
                    {
                         var Backtraining 1
                         put #var UC_WEAPON_SE %BACKTRAIN.SE
                         put #var UC_WEAPON_LE %BACKTRAIN.LE
                         put #var UC_WEAPON_THE %BACKTRAIN.THE
                         put #var UC_WEAPON_SB %BACKTRAIN.SB
                         put #var UC_WEAPON_LB %BACKTRAIN.LB
                         put #var UC_WEAPON_THB %BACKTRAIN.THB
                         put #var UC_WEAPON_BOW %BACKTRAIN.BOW
                         put #var UC_WEAPON_CROSSBOW %BACKTRAIN.CROSSBOW
                         put #var UC_WEAPON_SLING %BACKTRAIN.SLING
                         put #var UC_WEAPON_POLEARMS %BACKTRAIN.POLEARMS
                         put #var UC_WEAPON_STAVES %BACKTRAIN.STAVES
                         put #var UC_WEAPON_LT %BACKTRAIN.LT
                         put #var UC_WEAPON_HT %BACKTRAIN.HT
                         put #var UC_WEAPON_BRAWL %BACKTRAIN.BRAWL
                         put #var UC_WEAPON_OH %BACKTRAIN.OH
                         put #var UC_WEAPON_BS %BACKTRAIN.BS
                         if matchre("%B.Loot.Boxes", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootBoxes 0
                         if matchre("%B.Loot.Gems", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootGems 0
                         if matchre("%B.Loot.Metals", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootMetals 0
                         if matchre("%B.Loot.Scrolls", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootScrolls 0
                         if matchre("%B.Loot.Collectibles", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootCollectibles 0
                         if matchre("%B.Loot.SpiderParts", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootSpiderParts 0
                         if matchre("%B.Loot.Boxes", "(?i)(ON|1|YES)") then put #var UC_LootBoxes 1
                         if matchre("%B.Loot.Gems", "(?i)(ON|1|YES)") then put #var UC_LootGems 1
                         if matchre("%B.Loot.Metals", "(?i)(ON|1|YES)") then put #var UC_LootMetals 1
                         if matchre("%B.Loot.Scrolls", "(?i)(ON|1|YES)") then put #var UC_LootScrolls 1
                         if matchre("%B.Loot.Collectibles", "(?i)(ON|1|YES)") then put #var UC_LootCollectibles 1
                         if matchre("%B.Loot.SpiderParts", "(?i)(ON|1|YES)") then put #var UC_LootSpiderParts 1
                         if (($UC_LootBoxes = 1) || ($UC_LootGems = 1) || ($UC_LootMetals = 1) || ($UC_LootScrolls = 1) || ($UC_LootCollectibles = 1) || ($UC_LootSpiderParts = 1)) then
                              {
                                   put #var UC_Looting 1
                                   put #var UC_LootMonsters 1
                                   put #var UC_LootOption %B.Loot.Option
                              }
                         goto WEAPON_SETUP_2
                    }
          }
     var Backtrained 1
     ### SET MAIN WEAPONS IF NOT BACKTRAINING
     if (($UC_Backtrain = 0) || (%Backtrained = 1) || (%Backtraining = 0) || (%NecroHealing = 1)) then
          {
               var Backtraining 0
               put #var UC_WEAPON_STAVES %STAVES
               put #var UC_WEAPON_POLEARMS %POLEARMS
               put #var UC_WEAPON_BOW %RANGED.BOW
               put #var UC_WEAPON_CROSSBOW %RANGED.CROSSBOW
               put #var UC_WEAPON_SLING %RANGED.SLING
               put #var UC_WEAPON_LT %LTWEAPON
               put #var UC_WEAPON_HT %HTWEAPON
               put #var UC_WEAPON_SE %SEWEAPON
               put #var UC_WEAPON_LE %LEWEAPON
               put #var UC_WEAPON_THE %THEWEAPON
               put #var UC_WEAPON_SB %SBWEAPON
               put #var UC_WEAPON_LB %LBWEAPON
               put #var UC_WEAPON_THB %THBWEAPON
               put #var UC_WEAPON_BRAWL %BRAWLWEAPON
               put #var UC_WEAPON_OH %OHWEAPON
               put #var UC_WEAPON_BS %BSWEAPON
               if matchre("%Loot.Boxes", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootBoxes 0
               if matchre("%Loot.Gems", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootGems 0
               if matchre("%Loot.Metals", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootMetals 0
               if matchre("%Loot.Scrolls", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootScrolls 0
               if matchre("%Loot.Collectibles", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootCollectibles 0
               if matchre("%Loot.SpiderParts", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put #var UC_LootSpiderParts 0
               if matchre("%Loot.Boxes", "(?i)(ON|1|YES)") then put #var UC_LootBoxes 1
               if matchre("%Loot.Gems", "(?i)(ON|1|YES)") then put #var UC_LootGems 1
               if matchre("%Loot.Metals", "(?i)(ON|1|YES)") then put #var UC_LootMetals 1
               if matchre("%Loot.Scrolls", "(?i)(ON|1|YES)") then put #var UC_LootScrolls 1
               if matchre("%Loot.Collectibles", "(?i)(ON|1|YES)") then put #var UC_LootCollectibles 1
               if matchre("%Loot.SpiderParts", "(?i)(ON|1|YES)") then put #var UC_LootSpiderParts 1
               if (($UC_LootBoxes = 1) || ($UC_LootGems = 1) || ($UC_LootMetals = 1) || ($UC_LootScrolls = 1) || ($UC_LootCollectibles = 1) || ($UC_LootSpiderParts = 1)) then
                    {
                         put #var UC_Looting 1
                         put #var UC_LootMonsters 1
                         put #var UC_LootOption %Loot.Option
                    }
          }
WEAPON_SETUP_2:
     if matchre("%command", "\b(?i)RANGED\b") then
          {
               echo ########################
               echo ** "RANGED" Command Used!
               echo ** TURNING OFF ALL WEAPONS EXCEPT RANGED
               echo ########################
               put #var UC_WEAPON_BOW %RANGED.BOW
               put #var UC_WEAPON_CROSSBOW %RANGED.CROSSBOW
               put #var UC_WEAPON_SLING %RANGED.SLING
               put #var UC_WEAPON_LT %LTWEAPON
               put #var UC_WEAPON_HT %HTWEAPON
               put #var UC_WEAPON_STAVES NULL
               put #var UC_WEAPON_POLEARMS NULL
               put #var UC_WEAPON_SE NULL
               put #var UC_WEAPON_LE NULL
               put #var UC_WEAPON_THE NULL
               put #var UC_WEAPON_SB NULL
               put #var UC_WEAPON_LB NULL
               put #var UC_WEAPON_THB NULL
               put #var UC_WEAPON_BRAWL NULL
               put #var UC_WEAPON_OH NULL
               put #var UC_WEAPON_BS NULL
          }
     ### LOAD WEAPON GUI TO MANUALLY CHOOSE WEAPONS FOR THIS RUN IF WEAPON.GUI IS ON
     if ((%weaponload = 0) && matchre("%WEAPON.GUI", "(?i)(ON|1|YES)")) then gosub WEAPONLOAD
     ### PARSE OUT AND CHOOSE A RANDOM WEAPON TO SET ~IF AN ARRAY IS SET FOR THAT PARTICULAR WEAPON~
     gosub WEAPON_COUNT
     if (%allweaponarrays > 0) then gosub WEAPON_PARSE
     ########################################
     var ALLARMOR %MyShield|%CHEST.ARMOR|%HEAD.ARMOR|%ABDOMEN.ARMOR|%BACK.ARMOR|%ARM.ARMOR|%HAND.ARMOR|%LEG.ARMOR|%FACE.ARMOR|%KNUCKLE|%PARRYSTICK
     var ALLWEAPONS $UC_WEAPON_SE|$UC_WEAPON_BS|$UC_WEAPON_LE|$UC_WEAPON_THE|$UC_WEAPON_SB|$UC_WEAPON_LB|$UC_WEAPON_THB|$UC_WEAPON_STAVES|$UC_WEAPON_POLEARMS|$UC_WEAPON_BOW|$UC_WEAPON_CROSSBOW|$UC_WEAPON_SLING|$UC_WEAPON_LT|$UC_WEAPON_HT|$UC_WEAPON_OH|$UC_WEAPON_BRAWL
     eval ALLWEAPONS tolower("%ALLWEAPONS")
     eval ALLWEAPONS replacere("%ALLWEAPONS", "[Nn][Uu][Ll][Ll]", "")
     eval ALLWEAPONS replacere("%ALLWEAPONS", "\|+", "|")
     eval ALLWEAPONS replacere("%ALLWEAPONS", "^\|", "")
     eval ALLWEAPONS replacere("%ALLWEAPONS", "\|$", "")
     eval ALLARMOR replacere("%ALLARMOR", "[Nn][Uu][Ll][Ll]", "")
     eval ALLARMOR replacere("%ALLARMOR", "\|+", "|")
     eval ALLARMOR replacere("%ALLARMOR", "^\|", "")
     eval ALLARMOR replacere("%ALLARMOR", "\|$", "")
     var MYWEAPONS %ALLWEAPONS
     eval MYWEAPONS replacere("%MYWEAPONS", "\|$", "")
     ########################################
     # SET THE NOUN FOR EVERY WEAPON
     eval SE.NOUN replacere("$UC_WEAPON_SE", "([\w'-]+\s){0,5}", "")
     eval LE.NOUN replacere("$UC_WEAPON_LE", "([\w'-]+\s){0,5}", "")
     eval THE.NOUN replacere("$UC_WEAPON_THE", "([\w'-]+\s){0,5}", "")
     eval SB.NOUN replacere("$UC_WEAPON_SB", "([\w'-]+\s){0,5}", "")
     eval LB.NOUN replacere("$UC_WEAPON_LB", "([\w'-]+\s){0,5}", "")
     eval THB.NOUN replacere("$UC_WEAPON_THB", "([\w'-]+\s){0,5}", "")
     eval STAVE.NOUN replacere("$UC_WEAPON_STAVES", "([\w'-]+\s){0,5}", "")
     eval POLEARM.NOUN replacere("$UC_WEAPON_POLEARMS", "([\w'-]+\s){0,5}", "")
     eval BOW.NOUN replacere("$UC_WEAPON_BOW", "([\w'-]+\s){0,5}", "")
     eval CROSSBOW.NOUN replacere("$UC_WEAPON_CROSSBOW", "([\w'-]+\s){0,5}", "")
     eval SLING.NOUN replacere("$UC_WEAPON_SLING", "([\w'-]+\s){0,5}", "")
     eval LT.NOUN replacere("$UC_WEAPON_LT", "([\w'-]+\s){0,5}", "")
     eval HT.NOUN replacere("$UC_WEAPON_HT", "([\w'-]+\s){0,5}", "")
     eval OH.NOUN replacere("$UC_WEAPON_OH", "([\w'-]+\s){0,5}", "")
     eval BS.NOUN replacere("$UC_WEAPON_BS", "([\w'-]+\s){0,5}", "")
     eval BRAWL.NOUN replacere("$UC_WEAPON_BRAWL", "([\w'-]+\s){0,5}", "")
     ########################################
     ### SET SOME RANDOM MELEE WEAPON (FOR RESONANCE/RUTILORS EDGE)
     var Melee.Weapon NULL
     if !matchre("$UC_WEAPON_SE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Melee.Weapon $UC_WEAPON_SE
     if !matchre("$UC_WEAPON_LE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Melee.Weapon $UC_WEAPON_LE
     if !matchre("$UC_WEAPON_SB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Melee.Weapon $UC_WEAPON_SB
     if !matchre("$UC_WEAPON_LB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Melee.Weapon $UC_WEAPON_LB
     if !matchre("$UC_WEAPON_THB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Melee.Weapon $UC_WEAPON_THB
     if !matchre("$UC_WEAPON_STAVES", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Melee.Weapon $UC_WEAPON_STAVES
     if !matchre("$UC_WEAPON_POLEARMS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Melee.Weapon $UC_WEAPON_POLEARMS
     if !matchre("$UC_WEAPON_LT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Melee.Weapon $UC_WEAPON_LT
     if !matchre("$UC_WEAPON_HT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Melee.Weapon $UC_WEAPON_HT
     if !matchre("$UC_WEAPON_THE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Melee.Weapon $UC_WEAPON_THE
     if !matchre("$UC_WEAPON_LE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Melee.Weapon $UC_WEAPON_LE
     if !matchre("$UC_WEAPON_SE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Melee.Weapon $UC_WEAPON_SE
     ##############################################################
     if !matchre("%ALTWEAPON1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               put #var UC_AlternateWeapon 1
               var ALTWEAPON %ALTWEAPON1
          }
     ## gosub WEAPONLOAD
     if (%RangedWeapons = 0) then
          {
               var Crossbow NULL
               var Slings NULL
               var Bow NULL
          }
     var Light_Thrown Light_Thrown
     var Bow Bow
     var Crossbow Crossbow
     var Small_Edged Small_Edged
     var Large_Edged Large_Edged
     var Twohanded_Edged Twohanded_Edged
     var Large_Blunt Large_Blunt
     var Twohanded_Blunt Twohanded_Blunt
     var Polearm Polearms
     var Heavy_Thrown Heavy_Thrown
     var Slings Slings
     var Offhand_Weapon Offhand_Weapon
     var Backstab Backstab
     var Stave Staves
     var Brawling Brawling
     var Small_Blunt Small_Blunt
     ### SET SKILLS TO REMOVE BASED ON SET WEAPONS
     if matchre("$UC_WEAPON_SE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Small_Edged NULL
     if matchre("$UC_WEAPON_LE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Large_Edged NULL
     if matchre("$UC_WEAPON_THE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Twohanded_Edged NULL
     if matchre("$UC_WEAPON_SB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Small_Blunt NULL
     if matchre("$UC_WEAPON_LB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Large_Blunt NULL
     if matchre("$UC_WEAPON_THB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Twohanded_Blunt NULL
     if matchre("$UC_WEAPON_STAVES", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Stave NULL
     if matchre("$UC_WEAPON_POLEARMS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Polearm NULL
     if matchre("$UC_WEAPON_BOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Bow NULL
     if matchre("$UC_WEAPON_CROSSBOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Crossbow NULL
     if matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Slings NULL
     if matchre("$UC_WEAPON_LT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Light_Thrown NULL
     if matchre("$UC_WEAPON_HT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Heavy_Thrown NULL
     if matchre("$UC_WEAPON_BRAWL", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Brawling NULL
     if matchre("$UC_WEAPON_OH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Offhand_Weapon NULL
     if matchre("$UC_WEAPON_BS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Backstab NULL
     delay 0.00001
     ##### SETUP COMBAT SKILLS TO CHECK
     var skills %Large_Edged|%Twohanded_Edged|%Large_Blunt|%Twohanded_Blunt|%Polearm|%Heavy_Thrown|%Slings|%Offhand_Weapon|%Backstab|%Stave|%Small_Blunt|%Brawling|%Light_Thrown|%Bow|%Crossbow|%Small_Edged|
     eval skills replacere("%skills", "[Nn][Uu][Ll][Ll]", "")
     eval skills replacere("%skills", "\|+", "|")
     eval skills replacere("%skills", "^\|", "")
     # eval skills replacere("%skills", "\|$", "")
     eval skillcount count("%skills", "|")
     var combatsToCheck %Slings|%Stave|%Polearm|%Large_Edged|%Twohanded_Edged|%Large_Blunt|%Twohanded_Blunt|%Heavy_Thrown|%Offhand_Weapon|%Backstab|%Small_Blunt|%Brawling|%Light_Thrown|%Bow|%Crossbow|%Small_Edged|
     eval combatsToCheck replacere("%combatsToCheck", "[Nn][Uu][Ll][Ll]", "")
     eval combatsToCheck replacere("%combatsToCheck", "\|+", "|")
     eval combatsToCheck replacere("%combatsToCheck", "^\|", "")
     var lowarray
     eval temparray replacere("%combatsToCheck", "_", " ")
     var allCombats %combatsToCheck
     var combats %combatsToCheck
     ### SET ALL WEAPONS TO SKILLSETS
     var weapon.Backstab $UC_WEAPON_BS
     var weapon.Small_Blunt $UC_WEAPON_SB
     var weapon.Large_Blunt $UC_WEAPON_LB
     var weapon.Twohanded_Blunt $UC_WEAPON_THB
     var weapon.Small_Edged $UC_WEAPON_SE
     var weapon.Large_Edged $UC_WEAPON_LE
     var weapon.Twohanded_Edged $UC_WEAPON_THE
     var weapon.Staves $UC_WEAPON_STAVES
     var weapon.Polearms $UC_WEAPON_POLEARMS
     var weapon.Bow $UC_WEAPON_BOW
     var weapon.Crossbow $UC_WEAPON_CROSSBOW
     var weapon.Slings $UC_WEAPON_SLING
     var weapon.Light_Thrown $UC_WEAPON_LT
     var weapon.Heavy_Thrown $UC_WEAPON_HT
     var weapon.Offhand_Weapon $UC_WEAPON_OH
     if (%skillcount < 2) then
          {
               var SMART.WEAPONS OFF
               var MAX.LEARNINGRATE 36
          }
#### SET DEFAULT WEAPON TRAINING ORDER
     gosub WEAPON.SET
     if (%WeaponSet = 1) then return
     goto SETUP
##################################################
WEAPON_COUNT:
     var allweaponarrays 0
     var weapon1count 0
     var weapon2count 0
     var weapon3count 0
     var weapon4count 0
     var weapon5count 0
     var weapon6count 0
     var weapon7count 0
     var weapon8count 0
     var weapon9count 0
     var weapon10count 0
     var weapon11count 0
     var weapon12count 0
     var weapon13count 0
     var weapon14count 0
     var weapon15count 0
     var weapon16count 0
     eval weapon1count count("$UC_WEAPON_BS", "|")
     eval weapon2count count("$UC_WEAPON_SE", "|")
     eval weapon3count count("$UC_WEAPON_LE", "|")
     eval weapon4count count("$UC_WEAPON_THE", "|")
     eval weapon5count count("$UC_WEAPON_STAVES", "|")
     eval weapon6count count("$UC_WEAPON_POLEARMS", "|")
     eval weapon7count count("$UC_WEAPON_BOW", "|")
     eval weapon8count count("$UC_WEAPON_CROSSBOW", "|")
     eval weapon9count count("$UC_WEAPON_SLING", "|")
     eval weapon10count count("$UC_WEAPON_LT", "|")
     eval weapon11count count("$UC_WEAPON_HT", "|")
     eval weapon12count count("$UC_WEAPON_OH", "|")
     eval weapon13count count("$UC_WEAPON_BRAWL", "|")
     eval weapon14count count("$UC_WEAPON_SB", "|")
     eval weapon15count count("$UC_WEAPON_LB", "|")
     eval weapon16count count("$UC_WEAPON_THB", "|")
     evalmath allweaponarrays (%weapon1count + %weapon2count + %weapon3count + %weapon4count + %weapon5count + %weapon6count + %weapon7count + %weapon8count + %weapon9count + %weapon10count + %weapon11count + %weapon12count + %weapon13count + %weapon14count + %weapon15count + %weapon16count)
     unvar weapon1count
     unvar weapon2count
     unvar weapon3count
     unvar weapon4count
     unvar weapon5count
     unvar weapon6count
     unvar weapon7count
     unvar weapon8count
     unvar weapon9count
     unvar weapon10count
     unvar weapon11count
     unvar weapon12count
     unvar weapon13count
     unvar weapon14count
     unvar weapon15count
     unvar weapon16count
     return
#### WEAPON PARSING (Choose random weapon if an array is set for that weapon)
WEAPON_PARSE:
     var number 0
     echo ###########################
     echo *** Parsing Multi-Weapon Options..
     echo *** Weapons to parse: $UC_WEAPON_SE|$UC_WEAPON_BS|$UC_WEAPON_LE|$UC_WEAPON_THE|$UC_WEAPON_SB|$UC_WEAPON_LB|$UC_WEAPON_THB|$UC_WEAPON_STAVES|$UC_WEAPON_POLEARMS|$UC_WEAPON_BOW|$UC_WEAPON_CROSSBOW|$UC_WEAPON_SLING|$UC_WEAPON_LT|$UC_WEAPON_HT|$UC_WEAPON_OH|$UC_WEAPON_BRAWL
     echo ###########################
     delay 0.00001
     if !matchre("$UC_WEAPON_SE", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_SE
     if !matchre("$UC_WEAPON_LE", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_LE
     if !matchre("$UC_WEAPON_THE", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_THE
     if !matchre("$UC_WEAPON_SB", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_SB
     if !matchre("$UC_WEAPON_LB", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_LB
     if !matchre("$UC_WEAPON_THB", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_THB
     if !matchre("$UC_WEAPON_STAVES", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_STAVES
     if !matchre("$UC_WEAPON_POLEARMS", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_POLEARMS
     if !matchre("$UC_WEAPON_BOW", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_BOW
     if !matchre("$UC_WEAPON_CROSSBOW", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_CROSSBOW
     if !matchre("$UC_WEAPON_SLING", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_SLING
     if !matchre("$UC_WEAPON_LT", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_LT
     if !matchre("$UC_WEAPON_HT", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_HT
     if !matchre("$UC_WEAPON_OH", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_OH
     if !matchre("$UC_WEAPON_BS", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_BS
     if !matchre("$UC_WEAPON_BRAWL", "(?i)(NULL|OFF|^%|^\s*$)") then gosub WEAPON_PARSE_1 UC_WEAPON_BRAWL
     unvar chosenWeapon
     unvar SetWeapon
     unvar weaponCheck
     unvar weaponCount
     unvar number
     return
WEAPON_PARSE_1:
     var weaponCheck $0
     var chosenWeapon NULL
     var chosenWeapon $%weaponCheck
     math number add 1
     pause 0.0001
WEAPON_PARSE_2:
     var weaponCount 0
     delay 0.0001
     if (%number > 16) then return
     eval weaponCount count("%chosenWeapon", "|")
     if matchre("%chosenWeapon", "(""|NULL)") || (%weaponCount < 1) then return
     random 1 %weaponCount
     if (%r = 1) then var SetWeapon %chosenWeapon(0)
     if (%r = 2) then var SetWeapon %chosenWeapon(1)
     if (%r = 3) then var SetWeapon %chosenWeapon(2)
     if (%r = 4) then var SetWeapon %chosenWeapon(3)
     if (%r = 5) then var SetWeapon %chosenWeapon(4)
     if (%r = 6) then var SetWeapon %chosenWeapon(5)
     if (%r = 7) then var SetWeapon %chosenWeapon(6)
     if (%r = 8) then var SetWeapon %chosenWeapon(7)
     if (%r = 9) then var SetWeapon %chosenWeapon(8)
     if (%r = 10) then var SetWeapon %chosenWeapon(9)
     if (%r > 10) then var SetWeapon %chosenWeapon(10)
WEAPON_PARSE_3:
     echo #######################
     echo *** %weaponCheck OPTIONS: %chosenWeapon
     echo *** SETTING %weaponCheck WEAPON TO: %SetWeapon
     echo #######################
     pause 0.1
     put #var %weaponCheck %SetWeapon
     pause 0.0001
     pause 0.0001
     # var %weaponCheck %SetWeapon
     return
##############################################################################################################################
### MANDATORY SETUP AND CHECKS
SETUP:
     delay 0.00001
     var LAST SETUP
     var CURRENT SETUP
     gosub clear
     action (inventory) on
     action (jail) on
     action (retreat) on
     action (sorcery) on
     ## if (($zoneid = 150) && (%Teleport = 0)) then gosub LEAVE_SEACAVES
     gosub STATUSBAR
     put #window close shopWindow
     put #window add Log
     put #window show Log
     put #window add ExpMods
     put #window show ExpMods
     if matchre("%command", "(?i)(skip|jump)") then goto TOP
     if (($UC_Almanac = 1) || ($UC_Tarantula = 1)) then
          {
               put #window add ItemLog
               put #window show ItemLog
               delay 0.00001
          }
     if ($standing = 0) then gosub STAND
     if ($ExpTracker.Sleeping = 1) then
          {
               send awake
               pause 0.0001
               send awake
               wait
               pause 0.0001
          }
     if matchre("$roomname", "The Marsh, In The Water") && !matchre("%command", "(?i)(FIGHT)") then gosub CROC_ESCAPE
     if (matchre("$roomname", "(Forging Society|Engineering Society|Alchemy Society|Outfitting Society)") && ($UC_VaultSwap = 1)) then goto VAULT_RETURN
     gosub PREMIUM_CHECK
     gosub TIME_CHECK
     if matchre("%command", "(?i)\bheal\b") then
          {
               action (stunned) off
               action (combat) off
               action (escape) off
               action (dead) off
               goto TOP
          }
     if ($standing = 0) then gosub STAND
     if matchre("%command", "(?i)(quick|fast|fight|invasion|cleric|ritual)") then goto SETUP2
     if !matchre("%command", "(?i)SETUP") then goto SETUP2
##############################################################
### SPECIAL SETUP ONLY NEEDED ON FIRST LAUNCH OR ONCE IN A WHILE
### SKIP THIS SECTION UNLESS RUNNING SETUP / FIRST TIME COMMAND
     echo
     echo ####################
     echo # SPECIAL CONFIG SETUP
     echo # FOR FIRST LAUNCH / SETUP COMMAND
     echo # SETTING UP GENIE SETTINGS
     echo ####################
     echo
     put #layout load default
     pause 0.1
     pause 0.1
     send /expecho on
     send /expecho pulse off
     pause 0.01
     delay 0.00001
     put #config maxgosubdepth 50000
     put #config scripttimeout 50000
     put #config maxrowbuffer 100000
     put #config roundtimeoffset 0.2
     pause 0.01
     put #config usertimeout 5000
     put #config usertimeoutcommand look
     put #config ignorescriptwarnings true
     pause 0.01
     delay 0.0001
     delay 0.0001
     if !matchre("$guild", "(Necromancer|Empath)") then
          {
               put avoid touch
               pause 0.01
               pause 0.1
          }
     if ("$guild" = "Empath") then gosub BRAWL_TOGGLE
     put #config
     pause 0.1
     pause 0.1
     put #save all
     pause 0.00001
     pause 0.0001
##################################################################
### ALL MANDATORY SETUP CHECKS START HERE
SETUP2:
     ### HARD SET CONTAINER DEFAULTS
     delay 0.00001
     echo
     echo *** Setting Default Containers
     echo
     pause 0.1
     put STORE DEFAULT $UC_Container
     pause 0.2
     pause 0.1
     pause 0.1
     send STORE AMMO $UC_Container.Ammo
     pause 0.2
     pause 0.1
     pause 0.1
     send STORE BOXES $UC_Container.Box
     pause 0.2
     pause 0.2
     pause 0.1
     if matchre("%command", "(?i)(quick|fast|fight|invasion|cleric|ritual)") then goto SETUP3
     pause 0.00001
     if !matchre("$UC_Container.Herb", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               send STORE HERBS $UC_Container.Herb
               pause 0.2
               pause 0.2
               pause 0.1
          }
     pause 0.00001
     if ($UC_WornPouch = 1) then send store gems %gemPouch
     if ($UC_WornPouch = 0) then send store gems $UC_Container
     pause 0.1
     pause 0.1
     if ($hidden = 1) then
          {
               put unhide
               pause 0.1
               pause 0.001
          }
     gosub SHOW_VARIABLES
     gosub CRAFTING_SACK_CHECK
     gosub JAILED_CHECK
SETUP3:
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if matchre("$charactername", "(Alucios|Valgrind|Hvinir|Idavoll|Aerithius|Drunvalo|Akios|Teothius)") then put .scriptcheck
     if ("$charactername" = "Shroom") then
          {
               gosub CLAN.ITEM
               put #var VaultAmmo 1
          }
     if ("$guild" = "Paladin") then
          {
               if (!matchre("%HolyIcon", "(?i)(NULL|OFF|^%|^\s*$)") && !matchre("%command", "(?i)fight")) then gosub HOLY_WEAPON
          }
     if ("$guild" = "Necromancer") then gosub PERFORM_CHECK
     if ("$guild" = "Trader") then put #var UC_Tessera 1
     if ("$guild" = "Barbarian") then gosub MEDITATE_CHECK
     if ("$guild" = "Cleric") then
          {
               var ClericCheck 1
               gosub COMMUNE_SET
          }
     if matchre("%command", "(?i)(spell|\bheal\b|quick|fight|invasion|noob|jump|skip|town)") then goto SETUP_NEXT
     #### WM PRE-COMBAT BUILD ELEMENTAL CHARGE
     if ("$guild" = "Warrior Mage") then
          {
               send path stop
               pause 0.01
               pause 0.01
               gosub PREP_ADM
          }
SETUP_NEXT:
##### SETUP BASICS / INITIAL SCRIPT CHECKS
     if matchre("%command", "\bhuntnewbs\b") then goto HUNTNOOBS
     var CURRENT BAG/INVENTORY CHECK
     gosub STATUSBAR
     echo
     echo ################
     echo *** Checking Containers
     echo ################
     echo
     gosub OPEN_CONTAINERS
     if matchre("%command", "(?i)(spell|quick|fight|invasion|town)") then goto SETUP_PRECHECK
     if matchre("%command", "(?i)\bheal\b") then goto TOP
     gosub FEET_CHECK
SETUP_PRECHECK:
     if ($UC_Zills = 1) then
          {
               if matchre("%Zill.Name", "(?i)cowbells?") then gosub PERFORMANCE_COWBELL
               if !matchre("%Zill.Name", "(?i)cowbells?") then gosub PERFORMANCE
          }
     action (combat) on
     gosub INVENTORY_PRECHECK
     if ("$guild" = "Cleric") then gosub SOUL_CHECK
     if matchre("%command", "(?i)(spell|heal|quick|fight|invasion|noob|town|sell|cleric|ritual)") then goto TOP
     gosub BUNDLE_COUNT
     gosub STANCE_SETUP
     if ($UC_getFavors = 1) then gosub ORB_CHECK
#### SETUP WEAPONS AND SPELLS HERE
TOP:
     var LAST TOP
     var WeaponSet 0
     var ComatLoops 0
     var CURRENT SCRIPT SETUP
     gosub STATUSBAR
     if ($UC_NoCombat = 1) then goto TOP_INIT
     if matchre("%command", "(?i)(heal|noob)") then goto TOP_INIT
     if ($standing = 0) then gosub STAND
     gosub stowing
TOP_INIT:
     var LAST TOP_INIT
     var CURRENT SPELL SETUP
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if matchre("%command", "(?i)\bheal\b") then
          {
               action (stunned) off
               action (combat) off
               action (escape) off
               action (dead) off
               var healrun 1
               echo #########################
               echo ** HEAL RUN COMMAND INITIATED
               echo ** Skipping to Town Run w/ HEALING
               echo #########################
               put #echo >Log #00ffff ** "HEAL" COMMAND USED - Skipping straight to heal run
               put #var UC_Combat.Time {#evalmath ($gametime - 1500)}
               evalmath CombatTime ($gametime - 1500)
               put #var UC_Combat.Last %CombatTime
               #### ESCAPE TO NEAREST CITY
               var GOSUBBING ON
               var escaping ON
               gosub ESCAPE_NOW
               var GOSUBBING OFF
               #### DONE ESCAPING TO CITY
               goto ESCAPE_NOW_CONTINUED
          }
     if matchre("%command", "\b(?i)jump\b") then
          {
               if_2 then
                    {
                         action (inventory) off
                         action (PVPPLAYER) off
                         eval jumplabel replacere("%2", "\s", "_")
                         echo *** JUMPING TO: %jumplabel LABEL
                         put #echo >Log #00ffff ** *JUMP* COMMAND! Jumping to %jumplabel w/ debug
                         goto %jumplabel
                    }
          }
     if matchre("%command", "\b(?i)skip\b") then
          {
               if_2 then
                    {
                         action (inventory) off
                         action (PVPPLAYER) off
                         eval jumplabel replacere("%2", "\s", "_")
                         echo *** SKIPPING TO: %jumplabel LABEL
                         put #echo >Log #00ffff ** *SKIP* COMMAND! Skipping to %jumplabel label
                         goto %jumplabel
                    }
          }
     if matchre("%command", "(?i)(heal|quick|fight|invasion|town|nocombat|jump|skip|sell)") then goto SPELL_INIT
     if matchre("$guild", "Ranger") then
          {
               echo **** MOVING OUT OF TOWN TO BUFF
               var NecroMoved 0
               if (("$zoneid" = "1") && !matchre("$roomname", "(?i)(sewer|cavity|warehouse|mudflat)")) then
                    {
                         var NecroMoved 1
                         gosub AUTOMOVE e gate
                    }
               if (("$zoneid" = "30") && !matchre("$roomname", "(?i)salt yard")) then
                    {
                         var NecroMoved 1
                         gosub AUTOMOVE w gate
                    }
               if matchre("$zoneid", "\b(8|33|34a|42|47|61|67|90|99|116)\b") then var NecroMoved 1
               if ("$zoneid" = "8") then gosub AUTOMOVE 50
               if ("$zoneid" = "33") then gosub AUTOMOVE 9
               if ("$zoneid" = "34a") then gosub AUTOMOVE forest
               if ("$zoneid" = "42") then gosub AUTOMOVE gate
               if ("$zoneid" = "47") then gosub AUTOMOVE 109
               if ("$zoneid" = "61") then gosub AUTOMOVE shard
               if ("$zoneid" = "67") then
                    {
                         gosub AUTOMOVE east
                         gosub AUTOMOVE 638
                    }
               if ("$zoneid" = "90") then gosub AUTOMOVE sprite
               if ("$zoneid" = "99") then gosub AUTOMOVE west
               if ("$zoneid" = "116") then gosub AUTOMOVE raven
          }
SPELL_INIT:
###############################################################
### MAGIC SETUP - CHECK ALL KNOWN SPELLS AND FEATS
     if matchre("$guild", "%MAGICUSER") then
          {
               action (sorcery) on
               action (magic) on
               var CURRENT SPELL CHECK
               gosub STATUSBAR
               put spell stance 130 100 70
               pause 0.00001
               gosub SPELL_CHECK
               gosub CYCLIC_SETUP
          }
###############################################################
### LOAD BUFF VARS AND ALL GUILD BUFF TRIGGERS
     if ("$guild" = "Barbarian") then gosub BARB_BUFF
     if ("$guild" = "Thief") then
          {
               gosub AMBUSH_SETUP
               gosub THIEF_BUFF
          }
     if !matchre("$guild", "%MAGICUSER") then
          {
               action (magic) off
               goto PRETRAININGLOOP
          }
     if matchre("$guild", "%MAGICUSER") then
          {
               var CURRENT BUFF CHECK
               gosub STATUSBAR
               gosub WARMAGE_BUFF
               if !matchre("%command", "(?i)(heal|quick)") then gosub PERCEIVE
          }
     if matchre("%command", "(?i)(heal|quick|fight|invasion|noob|town|jump|skip|sell|cleric|ritual)") then goto SPELL_INIT_3
###############################################################
#### SPECIAL SETUP FOR WEAPON BUFFS / MISC
     if (("$guild" = "Warrior Mage") && matchre("%WM.Utility.Spell|%ChargeSpell|%WM.Buffs", "(?i)IGNITE")) then
          {
               gosub IGNITE_PREP
               gosub GET my %IGNITE.WEAPON
          }
     if (("$guild" = "Bard") && matchre ("%Bard.Buffs", "(?i)RESONANCE")) then
          {
               gosub RESONANCE_PREP
               gosub GET my %RESONANCE.WEAPON
               var WEAPON %RESONANCE.WEAPON
          }
     if (("$guild" = "Paladin") && matchre ("%Paladin.Buffs", "(?i)RUE")) then
          {
               gosub RUE_PREP
               gosub GET my %RUE.WEAPON
               var WEAPON %RUE.WEAPON
          }
###############################################################
### PRIMARY INITIAL BUFF ROUTINE
SPELL_INIT_2:
     if (("$guild" = "Necromancer") && (%NecroHealing = 1)) then
          {
               if ($spellEOTB = 0) then gosub NECRO_PREP
          }
###############################################################
### SETUP AND CHECK ALL COMBAT / OFFENSE SPELLS
SPELL_INIT_3:
     var buff.tracker 0
     gosub SPELL_SETUP_START
     if (matchre("$guild", "%MAGICUSER") && ("$guild" != "Necromancer")) then gosub BUFF_UP
     if matchre("%command", "(?i)(heal|jump|skip|cleric|ritual)") then goto PRETRAININGLOOP
     if ("$guild" = "Empath") then
          {
               if ((matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) || (matchre("$UC_combatCritter", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1))) then
                    {
                         echo ##################################
                         echo *** UNDEAD DETECTED IN VARIABLES OR MONSTERLIST!
                         echo *** PUTTING UP ABSOLUTION
                         echo ##################################
                         gosub BUFF ABSOLUTION $Mana.ABSOLUTION
                    }
               if (matchre("$UC_combatCritter", "(?i)%Undead") && (%ABSOLUTION = 0)) then goto ABSOLUTION_ERROR
          }
     if ("$guild" = "Moon Mage") then
          {
               if matchre("(%MM.Target.Spell|%MM.Target.Spell(0)|%MM.Target.Spell(1)|%MM.Target.Spell(2))", "(?i)(TKT|TKS)") then
                    {
                         gosub SHARD_CHECK
                         if (%shardnumber < 45) then gosub MOONBLADE_PREP
                         if (%shardnumber < 60) then gosub MOONBLADE_PREP
                         if (%shardnumber < 60) then gosub MOONBLADE_PREP
                    }
          }
### TURN OFF TARGET AND DEBILITATION IF BACKTRAINING
###############################################################
     if ((%Backtraining = 1) && ($UC_BacktrainTM = 0)) then
          {
               var TargetON 0
               var DebilitationON 0
          }
     if (%Backtraining = 0) then
          {
               if !matchre("$%GuildType.Target.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then var TargetON 1
               if !matchre("$%GuildType.Debilitation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then var DebilitationON 1
          }
     if ($SpellTimer.ShieldofLight.active = 1) then gosub RELEASE SOL
###############################################################
###### END OF ALL SPELL VARIABLES LOADING
###############################################################
###### BEGIN COMBAT CHECKS AND LAUNCH COMMANDS
PRETRAININGLOOP:
     var LAST PRETRAININGLOOP
     # put #var save
     if (("$guild" = "Empath") && matchre("$roomobjs", "alfar warrior")) then send command warrior to behavior passive
     if ($UC_ArrangeAll = 1) then gosub ARRANGE_ALL_CHECK
     if (($UC_No.Contact = 1) && !matchre("%command", "(?i)(fight|invasion)")) then
          {
               action (PVPPLAYER) on
          }
     if matchre("%command", "(?i)(heal|quick|fight|invasion|noob|town|jump|skip|sell)") then
          {
               var l 0
               var buffabbrevs
               var buffs
               eval totalspells count("%spelltimer", "|")
               gosub SPELL_CHECK_4
               unvar l
               delay 0.00001
               ## var buffs %%GuildType.Buffs
               #### CONVERT BUFFS TO ALL CAPS
               eval buffs replacere("%buffs", "\|\w+\[", "|[")
               eval buffs replacere("%buffs", "\[|\]", "")
               #eval buffs replacere("%buffs", "^\||\|$", "")
               #eval buffs toupper("%buffs")
               #### REMOVE NULL AND EXTRA PIPES
               eval buffs replacere("%buffs", "[Nn][Uu][Ll][Ll]", "")
               var buffs |%buffs
               eval buffs replacere("%buffs", "\|+", "|")
               eval buffs replacere("%buffs", "\|$", "")
               if matchre("%%GuildType.Buffs", "\b(?i)%Magic.Tattoo\b") then
                    {
                         var buffs %buffs|%Magic.Tattoo
                         var buffabbrevs %buffabbrevs|%Magic.Tattoo
                    }
               echo
               echo *** BUFFS: %buffs
               echo
          }
     if matchre("%command", "(?i)(fight|invasion)") then
          {
               put #var UC_Log.on.Stun 0
               put #var UC_No.Contact 0
               action (PVPPLAYER) off
          }
     if matchre("%command", "(?i)(cleric|ritual)") then
          {
               put #echo >Log #00ffff ** "RITUAL" COMMAND USED - Skipping straight to Cleric Rituals!
               goto CLERIC_RITUAL
          }
     if matchre("%command", "(?i)\bhealbot\b") then goto HEALBOT
     if ($UC_NoCombat = 1) then goto PRETRAININGLOOP_2
     if matchre("%command", "(?i)(nocombat|jump|skip)") then goto PRETRAININGLOOP_2
#### CHECK SHIELD
SHIELD_SET:
     var CURRENT ARMOR CHECK
     gosub STATUSBAR
     action (shield) on
     echo
     echo ~~~~~~~~~~~~~~~~~~~~~
     echo *** Checking Shield Location
     echo ~~~~~~~~~~~~~~~~~~~~~
     echo
     send thump my $UC_MyShield
     wait
     pause 0.0001
     pause 0.00001
     pause 0.00001
     if (%shield = 1) then echo *** Shield Worn
     if (%shield = 0) then echo *** Shield NOT WORN!
     if ($UC_ArmorCheck = 0) then goto SHIELD_CHECKED
     if (($UC_ShieldUse = 1) && (%shield = 0)) then gosub SHIELD_CHECK
     action (shield) off
SHIELD_CHECKED:
     send toggle bundle c
     matchre ARMOR_SET ^Clearing your toggle
     matchwait 3
#### ARMOR CHECKING / WEARING
ARMOR_SET:
     if matchre("%command", "(?i)(heal|quick|fight|invasion|noob|town|jump|skip|sell|burgle|superjump|nocombat)") then goto PRETRAININGLOOP_2
     if !matchre("%command", "(?i)(quick|fight|invasion)") then goto ARMOR_SET_2
     pause 0.001
     echo ** MAKING SURE WE HAVE ARMOR ON..
     pause 0.001
     matchre PRETRAININGLOOP_2 ^All of your armor
     matchre ARMOR_SET_2 You aren't wearing anything like that\.
     put inv armor
     matchwait 4
ARMOR_SET_2:
     gosub ARMOR_INIT
##### CATCH ALL STARTUP COMMANDS HERE IF NOT ALREADY INITIATED
PRETRAININGLOOP_2:
     if matchre("%command", "(?i)NoCombat") then
          {
               var AUTOHEAL ON
               var Backtraining 0
               #### ESCAPE TO NEAREST CITY
               var GOSUBBING ON
               var escaping ON
               gosub ESCAPE_NOW
               var GOSUBBING OFF
               #### DONE ESCAPING TO CITY
               goto ESCAPE_NOW_CONTINUED
          }
     if matchre("%command", "(?i)sell") then
          {
               action (inventory) off
               action (PVPPLAYER) off
               echo ###################
               echo ** "SELL" COMMAND USED!
               echo ** SELLING SKINS/GEMS
               echo ###################
               put #echo >Log #00ffff ** *SELL* COMMAND USED - Jumping to Town Run selling
               goto ESCAPE_SEARCH_3
          }
     if matchre("%command", "\b(?i)%superjump\b")) then
          {
               action (inventory) off
               action (PVPPLAYER) off
               eval jumplabel replacere("%2", "\s", "_")
               echo *** JUMPING TO: %jumplabel LABEL
               put #echo >Log #00ffff ** *SUPERJUMP* COMMAND! Jumping to %jumplabel label
               goto %2
          }
     if matchre("%command", "(?i)debug") then
          {
               # var command PRETRAININGLOOP
               if_2 then
                    {
                         action (inventory) off
                         action (PVPPLAYER) off
                         eval jumplabel replacere("%2", "\s", "_")
                         echo JUMPING TO: %jumplabel LABEL
                         put #echo >Log #00ffff ** *DEBUG* COMMAND! Jumping to %jumplabel label
                         goto %jumplabel
                    }
          }
     if matchre("%command", "(?i)town") then
          {
               if (%town = 0) then
                    {
                         var townRun 1
                         echo ############################
                         echo ** TOWN COMMAND USED
                         echo ** Skipping to Town Run!
                         echo *** SKIPPING OVER HEALING!!
                         echo *** USE 'HEAL' COMMAND TO GO TO HEALING
                         echo ############################
                         put #echo >Log #00ffff ** *TOWN* COMMAND! Town Run - Skipping Healing
                         evalmath CombatTime ($gametime - 1500)
                         pause 0.7
                         put #var UC_Combat.Last %CombatTime
                         #### ESCAPE TO NEAREST CITY
                         var GOSUBBING ON
                         var escaping ON
                         gosub ESCAPE_NOW
                         var GOSUBBING OFF
                         #### DONE ESCAPING TO CITY
                         goto HEALTH_RUN_DONE
                    }
          }
     if matchre("%command", "(?i)burgle") then
               {
                    action (PVPPLAYER) off
                    echo ###################
                    echo ** "BURGLE" COMMAND USED!
                    echo ** Skipping to Burgle 2!
                    echo ###################
                    put #echo >Log #00ffff ** *BURGLE* COMMAND - Starting w/ Burgle 2 Run!
                    goto BURGLE2
               }
#############################################################################################
## END OF STARTUP CHECKS
#############################################################################################
#### PRE TRAINING LOOP CHECKS
PRETRAININGLOOP_3:
     if matchre("%command", "(?i)(quick|fight|invasion)") then goto QUICK_CHECK
     #### STOCK UP ON AMMO FOR TKT HERE
     if (matchre("($%GuildType.Target.Spell|%%GuildType.Target.Spell(0)|%%GuildType.Target.Spell(1)|%%GuildType.Target.Spell(2)|%%GuildType.Utility.Spell|%%GuildType.Warding.Spell|%%GuildType.Sorcery.Spell|%%GuildType.Augmentation.Spell)", "(?i)(TKT|TKS)") then gosub TKT_AMMO
     ####################################
     pause 0.00001
PRETRAININGLOOP_4:
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     # if ($UC_Wand = 1) then gosub WAND_TIMER
     if ($UC_Tarantula = 1) then gosub TARANTULA_TIMER
QUICK_CHECK:
     put #var UC_combatCritter %COMBAT.CRITTER
     if ($UC_NoCombat = 1) then goto ESCAPE_NOW
     if matchre("%command", "(?i)(fight|invasion)") then
          {
               echo
               echo #####################
               echo * USED COMMAND %command!
               echo * SKIPPING MOVING TO CRITTER
               echo * FIGHTING IN CURRENT ROOM!
               echo #####################
               echo
               goto TrainLoop
          }
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
BACKTRAIN_CHECK:
     if (($UC_Backtrain = 1) && (%Backtrained = 0)) then
          {
               if ($UC_AutoProgress.Backtrain = 1) then gosub AUTO_PROGRESSION_BACKTRAIN
               goto FIND_CRITTER_BACKTRAIN
          }
CRITTER_CHECK:
     gosub AUTO_PROGRESSION
     put #var UC_combatCritter %COMBAT.CRITTER
     # if matchre("%FIND.CRITTER", "(?i)(ON|1|YES)") then goto FIND_CRITTER
FINDING_CRITTER:
     goto FIND_CRITTER
###############################
## BEGIN OF COMBAT LOOP
###############################
TrainLoop:
     # debuglevel 0
     put #var UC_Combat.Time $gametime
### HERE AFTER EVERY COMPLETE WEAPON LOOP - DO NOT RESET COMBAT TIME
TrainLoop2:
     delay 0.0001
     gosub clear
     unvar c
     var burgling 0
     var TrainerLoopTime $gametime
     put #tvar spellETF 0
     if matchre("$righthand $lefthand", "(lantern|torch|gnome)") then put drop $1
     if (($UC_NoCombat = 1) && (%NecroHealing = 0)) then goto ESCAPE_NOW
     put #class combat on
     put #class app on
     var CURRENT COMBAT!
     if ("$guild" = "Thief") then
          {
               put khri stop hasten slight safe plunder sight flight harrier
               pause 0.5
          }
     put #parse COMBAT!
     put #parse OUT OF TOWN!
     gosub STATUSBAR
     gosub stowing
     math ComatLoops add 1
     var InCombat 1
     var TotalBoxes 0
     action (buffs) on
     action (stunned) on
     action (combat) on
     action (escape) on
     action (dead) on
     action (switch) on
     action (inventory) on
     action (sorcery) on
     if ($ExpTracker.Sleeping = 1) then
          {
               send awake
               pause 0.2
               send awake
               pause 0.2
               pause 0.0001
          }
     if ("$guild" = "Necromancer") then
          {
               if (%NecroBuffed = 0) then
                    {
                         var NecroMoved 0
                         gosub BUFF_UP
                    }
               gosub DO_CHECK
               if (%NecroHealing = 1) then
                    {
                         action (stunned) off
                         action (escape) off
                    }
          }
     if (("$guild" = "Necromancer") && (%NecroMoved = 1) && ($UC_Backtrain = 1) && (%Backtrained = 0) && (%NecroHealing = 0)) then goto FIND_CRITTER_BACKTRAIN
     if (("$guild" = "Necromancer") && (%NecroMoved = 1) && (%NecroHealing = 0)) then goto FIND_CRITTER
     if ($invisible = 1) then gosub STOP_INVIS
     if (%ComatLoops > 16) then goto RESET
     if ($stamina < 50) then gosub STAMINA_WAIT
     if (matchre("$righthand $lefthand", "torch") && ("$UC_combatCritter", "\b(?i)(Crypt Fiend|Ghoul Raven|Snaer|Hafwa|Resuscitants?|Moths?)\b")) then
          {
               put drop torch
               pause 0.4
          }
     if ($UC_Ammo = 1) then gosub stowammo
     var COMBAT.ROOM $roomid
     var COMBAT.ZONE $zoneid
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then gosub CLEARHANDS
     # if ($UC_bundleFull = 1) then goto DONE_TRAINING
     # if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if ("$guild" = "Empath") then
          {
               if ((matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) || (matchre("$UC_combatCritter", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1))) then
                    {
                         echo ###################################
                         echo *** UNDEAD DETECTED IN VARIABLES OR MONSTERLIST!
                         echo *** PUTTING UP ABSOLUTION
                         echo ###################################
                         gosub BUFF ABSOLUTION $Mana.ABSOLUTION
                         if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION 250
                         if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION 150
                    }
               if (matchre("$UC_combatCritter", "(?i)%Undead") && (%ABSOLUTION = 0)) then goto ABSOLUTION_ERROR
          }
###############################################################################
## CHECK IF ALL WEAPONS ARE CLOSE TO LOCKED (NEW)
LOCKED_CHECK:
     echo
     echo ** Checking Current Weapon Learning Rates..
     echo
     if (%numberOfAllCombats < 2) then goto LOCKED_CONTINUE
     var locked 0
     var lockedloop 0
     if (!matchre("$UC_WEAPON_SE", "(?i)(NULL|OFF|^%|^\s*$)") && ($Small_Edged.Ranks < 1750)) then
          {
               if ($Small_Edged.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_LE", "(?i)(NULL|OFF|^%|^\s*$)") && ($Large_Edged.Ranks < 1750)) then
          {
               if ($Large_Edged.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_THE", "(?i)(NULL|OFF|^%|^\s*$)") && ($Twohanded_Edged.Ranks < 1750)) then
          {
               if ($Twohanded_Edged.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_SB", "(?i)(NULL|OFF|^%|^\s*$)") && ($Small_Blunt.Ranks < 1750)) then
          {
               if ($Small_Blunt.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_LB", "(?i)(NULL|OFF|^%|^\s*$)") && ($Large_Blunt.Ranks < 1750)) then
          {
               if ($Large_Blunt.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_THB", "(?i)(NULL|OFF|^%|^\s*$)") && ($Twohanded_Blunt.Ranks < 1750)) then
          {
               if ($Twohanded_Blunt.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_STAVES", "(?i)(NULL|OFF|^%|^\s*$)") && ($Staves.Ranks < 1750)) then
          {
               if ($Staves.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_POLEARMS", "(?i)(NULL|OFF|^%|^\s*$)") && ($Polearms.Ranks < 1750)) then
          {
               if ($Polearms.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_BOW", "(?i)(NULL|OFF|^%|^\s*$)") && ($Bow.Ranks < 1750)) then
          {
               if ($Bow.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_CROSSBOW", "(?i)(NULL|OFF|^%|^\s*$)") && ($Crossbow.Ranks < 1750)) then
          {
               if ($Crossbow.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_SLING", "(?i)(NULL|OFF|^%|^\s*$)") && ($Slings.Ranks < 1750)) then
          {
               if ($Slings.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_LT", "(?i)(NULL|OFF|^%|^\s*$)") && ($Light_Thrown.Ranks < 1750)) then
          {
               if ($Light_Thrown.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_HT", "(?i)(NULL|OFF|^%|^\s*$)") && ($Heavy_Thrown.Ranks < 1750)) then
          {
               if ($Heavy_Thrown.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_OH", "(?i)(NULL|OFF|^%|^\s*$)") && ($Offhand_Weapon.Ranks < 1750)) then
          {
               if ($Offhand_Weapon.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_BS", "(?i)(NULL|OFF|^%|^\s*$)") && ($Backstab.Ranks < 1750)) then
          {
               if ($Backstab.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     if (!matchre("$UC_WEAPON_BRAWL", "(?i)(NULL|OFF|^%|^\s*$)") && ($Brawling.Ranks < 1750)) then
          {
               if ($Brawling.LearningRate >= %MAX.LEARNINGRATE) then math locked add 1
          }
     delay 0.00001
     if (%locked = %numberOfAllCombats) then
          {
               math lockedloop add 1
               if (%lockedloop > 5) then goto LOCKED_CONTINUE
               echo
               echo #####################################
               echo * WEAPON SKILLS ALREADY OVER MAX LEARNINGRATE
               echo * BUMPING UP MAX LEARNINGRATE
               echo #####################################
               echo
               if (%LEARNING.INCREASE > 0) then gosub LEARNING_INCREASE
               var locked 0
               pause 0.0001
               pause 0.0001
               goto LOCKED_CHECK
          }
###############################################################################
LOCKED_CONTINUE:
     var lockedloop 0
     if (def($UC_WeaponType) && !matchre("$UC_WeaponType", "(NULL|^$)")) then
          {
               echo #############################
               echo *** STARTING FROM LAST WEAPON TRAINED:
               echo *** $UC_WeaponType
               echo #############################
               goto $UC_WeaponType
          }
     if (("$guild" = "Warrior Mage") && !matchre("%command", "(?i)(fight|quick)")) then
          {
               put path sense
               pause
               if ($charge < 6) then gosub CHARGE_SPAM
          }
     if ($UC_SmartWeapons = 0) then goto COMBAT.1
     goto SWITCH
RESET:
     var ComatLoops 0
     var combatcount 0
     var switchloop 0
     var skinTime $gametime
     put #echo >Log #99ff99 * ~ Weapon Loop Reset ~
     if (%LEARNING.INCREASE > 0) then gosub LEARNING_INCREASE
#################################################
# SMART WEAPON SWAP
SWITCH:
     # debug 5
     var LAST SWITCH
     var CURRENT WEAPON SWAP
     var blessloop 0
     var Resonance.Check 0
     var High.Switch 0
     var pretrainloop 0
     var Empath.Brawl 0
     var InCombat 1
     action (buffs) on
     action (offhand) off
     action (retreat) off
     action (combat) on
     evalmath maneuverTime ($gametime - 300)
     gosub STATUSBAR
     if ($ExpTracker.Sleeping = 1) then
          {
               send awake
               pause 0.1
               send awake
               pause 0.1
               pause 0.0001
          }
     echo
     echo ######################
     echo ######################
     echo #   **** WEAPON SWAP! ****  #
     echo ######################
     echo ######################
     echo
     delay 0.0001
     put info
     delay 0.001
     pause 0.001
     gosub stowing
     gosub BLEEDERCHECK
     gosub FEET_CHECK
     gosub EXP_MODS
     gosub CLEARHANDS
     # echo **** Switchloop - %switchloop
     if matchre("%command", "(?i)INVASION") then goto HIGHRATE
     if !matchre("%TempMax", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var MAX.LEARNINGRATE %TempMax
               var TempMax NULL
          }
     if (%combatadd > 0) then
          {
               math combatcount add %combatadd
               math combatcount subtract 1
               var combatadd 0
          }
     if (%NecroHealing = 0) then
          {
               action (stunned) on
               action (escape) on
          }
     if (("$guild" = "Necromancer") && (%NecroHealing = 1)) then
          {
               action (stunned) off
               action (escape) off
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto DONE_NECROHEALING
          }
     if (($health < 80) && ($bleeding = 1) && (%NecroHealing = 0)) then goto ESCAPE
     if (($UC_Herbs = 1) && ($health < 100)) then
          {
               gosub HERBHEAL_TIMER
               if (%herbLast > 300) then gosub HEALTH_CHECK_ALL
               if ((%herbLast > 300) && ($needHealing = 1)) then gosub HERB_HEALING
          }
     if (%invcount > 7) then goto F2P_ESCAPE
     if ($UC_Teach = 1) then gosub TEACH_TIMER
     if (("$guild" = "Empath") then
          {
               gosub ASSESS
               if (($UC_ConstructOnly = 1) && !matchre("$monsterlist", "(%Undead|%Construct)") && ("$monsterlist" != "")) then goto PREEMPATHBRAWLING
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (matchre("%Empathy.Escape", "ON") && ($Empathy.LearningRate < 1)) then goto ESCAPE_EMPATH
          }
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if (("$guild" = "Barbarian") && matchre("%DualWield", "ON")) then
          {
               evalmath DualWieldTime ($gametime - 280)
               put #var UC_DualWield 1
          }
     if matchre("%TrainStealth", "(?i)(ON|1|YES)")  then put #var UC_TrainStealth 1
     if ($UC_Ammo = 1) then gosub stowammo
     if (%GemsFull = 1) then gosub GEM_DUMP
     if (%Removed.Armor = 1) then gosub WEAR_PLATE
     if ($UC_ArmorSwap = 1) then gosub ARMORSWAP
     if ($UC_Tarantula = 1) then gosub TARANTULA_TIMER
     if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
     if ($UC_Burden >= 8) then goto BURDEN_HIGH
     ###################################################
     if matchre("$roomobjs", "tusky") then goto HIGHRATE
     if (%NecroHealing = 1) then
          {
               goto HIGHRATE
          }
     if ($UC_SmartWeapons = 0) then goto %NextSkill
     # gosub CLEARHANDS
     if matchre("%Priority.Weapons", "(?i)(NULL|OFF|^%|^\s*$)") then goto PRIORITYLOOPEND
## PRIORITY WEAPON CHECK
     eval Priority.Weapons replacere("%Priority.Weapons", "^\||\|$", "")
     eval totalPriority count("|%combatsToTrain", "|")
     eval priorityCount count("|%Priority.Weapons", "|")
     # eval totalPriority count("%combatsToTrain", "|")
     var p 0
     var ploop 0
PRIORITYLOOP:
     if ((%p >= %totalPriority) || ("%Priority.Weapons" = "NULL")) then goto PRIORITYLOOPEND
     if (matchre("%Priority.Weapons", "\b%combatsToTrain(%p)") && ($%combatsToTrain(%p).LearningRate < 1) && (!matchre("%%combatsToTrain(%p)", "(?i)(NULL|OFF|^%|^\s*$)")) && !matchre("%combatsToTrain(%p)", "%allTrained")) then
                    {
                         ### This block saves the last trained weapons so it doesn't loop on the same weapons if they aren't learning
                         # if (%numberOfAllCombats = 9) then var tenthTrained %ninthTrained
                         # if (%numberOfAllCombats = 8) then var ninthTrained %eighthTrained
                         # if (%numberOfAllCombats = 7) then var eighthTrained %seventhTrained
                         # if (%numberOfAllCombats = 6) then var seventhTrained %sixthTrained
                         # if (%numberOfAllCombats = 5) then var sixthTrained %fifthTrained
                         if (%numberOfAllCombats = 4) then var fifthTrained %fourthTrained
                         if (%numberOfAllCombats = 3) then var fourthTrained %thirdTrained
                         if (%numberOfAllCombats = 2) then var thirdTrained %secondTrained
                         if (%numberOfAllCombats = 1) then var secondTrained %firstTrained
                         ####
                         # if (%numberOfAllCombats > 9) then var tenthTrained %ninthTrained
                         # if (%numberOfAllCombats > 8) then var ninthTrained %eighthTrained
                         # if (%numberOfAllCombats > 7) then var eighthTrained %seventhTrained
                         # if (%numberOfAllCombats > 6) then var seventhTrained %sixthTrained
                         # if (%numberOfAllCombats > 5) then var sixthTrained %fifthTrained
                         if (%numberOfAllCombats > 4) then var fifthTrained %fourthTrained
                         if (%numberOfAllCombats > 3) then var fourthTrained %thirdTrained
                         if (%numberOfAllCombats > 2) then var thirdTrained %secondTrained
                         if (%numberOfAllCombats > 1) then var secondTrained %firstTrained
                         var firstTrained %lastTrained
                         var lastTrained %combatsToTrain(%p)
                         var allTrained %lastTrained|%firstTrained|%secondTrained|%thirdTrained|%fourthTrained
                         eval allTrained replacere("%allTrained", "[Nn][Uu][Ll][Ll]", "")
                         eval allTrained replacere("%allTrained", "\|+", "|")
                         eval allTrained replacere("%allTrained", "^\|", "")
                         eval allTrained replacere("%allTrained", "\|$", "")
                         gosub PRIORITY_TRAIN %combatsToTrain(%p)
                    }
     if (%ploop > %totalPriority) then goto PRIORITYLOOPEND
     math p add 1
     math ploop add 1
     goto PRIORITYLOOP
     # pause 0.001
PRIORITYLOOPEND:
     # if (%numberOfAllCombats = 0) then gosub WEAPON.SET
     if (%numberOfAllCombats = 1) then
          {
               var MAX.LEARNINGRATE 35
               goto COMBAT.1
          }
     if ((%combatcount > %numberOfAllCombats) || (%numberOfAllCombats = 0) || (%combatsToCheck = "") || (%combatsToCheck(0) = ""))  then
          {
               # debug 10
               put #echo >Log #99ff99 * ~ Weapon Loop Reset ~
               echo
               echo ##############
               echo *** Weapon Loop Reset
               echo ##############
               echo
               var combatcount 0
               var switchloop 0
               ### RESET WEAPONS HERE
               var WeaponSet 1
               gosub WEAPON_SETUP
               var WeaponSet 0
               if (%LEARNING.INCREASE > 0) then gosub LEARNING_INCREASE
               #####################
               # gosub WEAPON.SET
               goto SWITCH
          }
     # math combatcount add 1
     math switchloop add 1
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("%TrainLowest", "(?i)(ON|1|YES)") then gosub LOWRATE
LOWRATE_NO:
     ## echo **** Training %combats(%combatcount)
     if (%numberOfAllCombats = 1) then
          {
               var MAX.LEARNINGRATE 35
               goto COMBAT.1
          }
     if ((%combatcount > %numberOfAllCombats) || (%switchloop > 20) || (%numberOfAllCombats = 0) || ("%combats(%combatcount)" = "")) then
          {
               # debug 5
               put #echo >Log #99ff99 * ~ Weapon Loop Reset ~
               echo
               echo ##############
               echo *** Weapon Loop Reset
               echo ##############
               echo
               var combatcount 0
               var switchloop 0
               ### RESET WEAPONS HERE
               var WeaponSet 1
               gosub WEAPON_SETUP
               var WeaponSet 0
               if (%LEARNING.INCREASE > 0) then gosub LEARNING_INCREASE
               if ("%combats(%combatcount)" = "") then
                    {
                         math combatcount add 1
                         if ("%combats(%combatcount)" = "") then goto COMBAT.1
                    }
               #####################
               goto SWITCH
          }
     # if (%numberOfAllCombats = 9) then var tenthTrained %ninthTrained
     # if (%numberOfAllCombats = 8) then var ninthTrained %eighthTrained
     # if (%numberOfAllCombats = 7) then var eighthTrained %seventhTrained
     # if (%numberOfAllCombats = 6) then var seventhTrained %sixthTrained
     # if (%numberOfAllCombats = 5) then var sixthTrained %fifthTrained
     if (%numberOfAllCombats = 4) then var fifthTrained %fourthTrained
     if (%numberOfAllCombats = 3) then var fourthTrained %thirdTrained
     if (%numberOfAllCombats = 2) then var thirdTrained %secondTrained
     if (%numberOfAllCombats = 1) then var secondTrained %firstTrained
     ### This block saves the last trained weapons so it doesn't loop on the same weapons if they aren't learning
     ### After each weapon switches it saves the previous weapons one number up to store the new array
     # if (%numberOfAllCombats > 9) then var tenthTrained %ninthTrained
     # if (%numberOfAllCombats > 8) then var ninthTrained %eighthTrained
     # if (%numberOfAllCombats > 7) then var eighthTrained %seventhTrained
     # if (%numberOfAllCombats > 6) then var seventhTrained %sixthTrained
     # if (%numberOfAllCombats > 5) then var sixthTrained %fifthTrained
     if (%numberOfAllCombats > 4) then var fifthTrained %fourthTrained
     if (%numberOfAllCombats > 3) then var fourthTrained %thirdTrained
     if (%numberOfAllCombats > 2) then var thirdTrained %secondTrained
     if (%numberOfAllCombats > 1) then var secondTrained %firstTrained
     var firstTrained %lastTrained
     var lastTrained %combats(%combatcount)
     var allTrained %lastTrained|%firstTrained|%secondTrained|%thirdTrained|%fourthTrained
     eval allTrained replacere("%allTrained", "[Nn][Uu][Ll][Ll]", "")
     eval allTrained replacere("%allTrained", "\|+", "|")
     eval allTrained replacere("%allTrained", "^\|", "")
     eval allTrained replacere("%allTrained", "\|$", "")
     echo LastTrained: %allTrained
##### HERE GO TO NEXT COMBAT SKILL AFTER PASSING TRAINLOWEST AND PRIORITY WEAPONS
COMBAT_GO:
     goto %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then goto COMBAT.%combatcount
     # debug 0
     goto %combats(%combatcount)

UBERSWITCH:
     var Empath.Brawl 0
     var InCombat 1
     action (offhand) off
     action (retreat) off
     action (combat) on
     action (escape) on
     action (stunned) on
     var CURRENT SWITCHING WEAPON FOR UBER MONSTER!
     gosub STATUSBAR
     gosub CLEARHANDS
     gosub FEET_CHECK
     gosub EXP_MODS
     gosub stowammo
     goto HIGHRATE

PRIORITY_TRAIN:
     var ploop 0
     var supertrain $1
     delay 0.00001
     if ("%supertrain" = "%lasttrained") then
          {
               if (%priorityCount > 1) then return
          }
     if ($%supertrain.LearningRate > 32) then return
     math combatcount subtract 1
     echo
     echo ############################
     echo *** TRAINING PRIORITY WEAPON: %supertrain
     echo ############################
     echo
     delay 0.00001
     var lasttrained %supertrain
     # debug 0
     goto %supertrain

LEARNING_INCREASE:
     if (%MAX.LEARNINGRATE > 35) then return
     math MAX.LEARNINGRATE add %LEARNING.INCREASE
     if (%MAX.LEARNINGRATE > 35) then var MAX.LEARNINGRATE 35
     echo *** NEW MAX.LEARNINGRATE = %MAX.LEARNINGRATE
     put #echo >Log #99ff99 * Increasing Weapon Max Learningrate - %MAX.LEARNINGRATE/34
     return
##################################################################################################################################
### WEAPON SETUP/SWAP LOGIC
WEAPON.SET:
     put #var CircleCalc.Parse 1
     var temparray %combatsToCheck
     var lowarray
     var combatsToTrain
     eval numberOfAllCombats count("%combatsToCheck", "|")
     eval numberOfTotalCombats count("%combatsToCheck", "|")
     gosub LowRanks %combatsToCheck all
     gosub HighRanks %combatsToCheck weapons
     gosub NORANKCHECK
     gosub MAXCHECK
     eval numberOfAllCombats count("%lowarray", "|")
     eval numberOfTotalCombats count("%lowarray", "|")
     delay 0.00001
     eval lowarray replacere("%lowarray", "Targeted Magic", "")
     eval lowarray replacere("%lowarray", "Sorcery", "")
     eval lowarray replacere("%lowarray", "Debilitation", "")
     eval lowarray replacere("%lowarray", "Augmentation", "")
     eval lowarray replacere("%lowarray", "Warding", "")
     eval lowarray replacere("%lowarray", "Utility", "")
     eval lowarray replacere("%lowarray", "Target", "")
     eval lowarray replacere("%lowarray", "\|+", "|")
     eval lowarray replacere("%lowarray", "\|$", "")
     action (backtraining) off
     action (main) off
     action (magic) off
     action (array) off
     put #var ExpTracker.GagExp 0
     goto SETHUNT.SetHunt
NORANKCHECK:
     var i 0
NORANKCHECK_1:
     delay 0.00001
     if (%i >= %numberOfTotalCombats) then return
     if ($%combatsToCheck(%i).Ranks = 0) then var lowarray %combatsToCheck(%i)|%lowarray
     math i add 1
     goto NORANKCHECK_1
MAXCHECK:
     var i 0
MAXCHECK_1:
     delay 0.00001
     if (%i >= %numberOfTotalCombats) then return
     if ($%combatsToCheck(%i).Ranks = 1750) then
          {
               eval lowarray replacere("%lowarray" , "%combatsToCheck(%i)" , "")
               eval lowarray replacere("%lowarray", "\|+", "|")
               echo *** LOWARRAY: %lowarray
          }
     math i add 1
     goto MAXCHECK_1
# Use Lowest Learning Rate to TRAIN
LowRate:
     eval numberOfAllCombats count("%combatsToCheck", "|")
     var lowrate 0
     var maxedout 0
     var LowSkill %combatsToCheck(%lowrate)
LowRate_1:
     delay 0.00001
#### CHOOSE THE LOWEST LEARNING RATE WITH THE LOWEST SKILL (THAT WE HAVEN'T TRAINED RECENTLY)
     if (%lowrate < %numberOfAllCombats) then
          {
               if (($%combatsToCheck(%lowrate).LearningRate <= 2) && ($%combatsToCheck(%lowrate).Ranks < $%LowSkill.Ranks) && !matchre("%allTrained", "%combatsToCheck(%lowrate)") && ($%combatsToCheck(%lowrate).Ranks < 1750)) then var LowSkill %combatsToCheck(%lowrate)
               math lowrate add 1
               pause 0.0001
               delay 0.00001
               goto LowRate_1
          }
     if ((%lowrate >= %numberOfAllCombats) && !matchre("%allTrained", "%LowSkill")) then
          {
               echo ####################################
               echo *** ~~ TrainLowest OVERRIDE ~~~
               echo *** Switching to lowest learning rate, lowest skill weapon
               echo ####################################
               goto LowRate_Train
          }
     if (%lowrate >= %numberOfAllCombats) then return
LowRate_Train:
     echo
     echo ########################
     echo **** TRAINING LOWEST WEAPON: %LowSkill
     echo ########################
     echo
     ### This block saves the last trained weapons so it doesn't loop on the same weapons if they aren't learning
     # if (%numberOfAllCombats = 9) then var tenthTrained %ninthTrained
     # if (%numberOfAllCombats = 8) then var ninthTrained %eighthTrained
     # if (%numberOfAllCombats = 7) then var eighthTrained %seventhTrained
     # if (%numberOfAllCombats = 6) then var seventhTrained %sixthTrained
     # if (%numberOfAllCombats = 5) then var sixthTrained %fifthTrained
     if (%numberOfAllCombats = 4) then var fifthTrained %fourthTrained
     if (%numberOfAllCombats = 3) then var fourthTrained %thirdTrained
     if (%numberOfAllCombats = 2) then var thirdTrained %secondTrained
     if (%numberOfAllCombats = 1) then var secondTrained %firstTrained
     ####
     # if (%numberOfAllCombats > 9) then var tenthTrained %ninthTrained
     # if (%numberOfAllCombats > 8) then var ninthTrained %eighthTrained
     # if (%numberOfAllCombats > 7) then var eighthTrained %seventhTrained
     # if (%numberOfAllCombats > 6) then var seventhTrained %sixthTrained
     # if (%numberOfAllCombats > 5) then var sixthTrained %fifthTrained
     if (%numberOfAllCombats > 4) then var fifthTrained %fourthTrained
     if (%numberOfAllCombats > 3) then var fourthTrained %thirdTrained
     if (%numberOfAllCombats > 2) then var thirdTrained %secondTrained
     if (%numberOfAllCombats > 1) then var secondTrained %firstTrained
     var firstTrained %lastTrained
     var lastTrained %LowSkill
     math combatcount subtract 1
     echo LastTrained - %allTrained
     var allTrained %lastTrained|%firstTrained|%secondTrained|%thirdTrained|%fourthTrained
     eval allTrained replacere("%allTrained", "[Nn][Uu][Ll][Ll]", "")
     eval allTrained replacere("%allTrained", "\|+", "|")
     eval allTrained replacere("%allTrained", "^\|", "")
     eval allTrained replacere("%allTrained", "\|$", "")
     # debug 0
     goto %LowSkill
# Find the Highest Ranked Weapon for UBERMONSTER
HighRate:
     eval numberOfAllCombats count("%combatsToCheck", "|")
     var highrate 0
     var HighSkill %combatsToCheck(%highrate)
HighRate_1:
     delay 0.00001
     if (%highrate <= %numberOfAllCombats) then
          {
               if ($%combatsToCheck(%highrate).Ranks > $%HighSkill.Ranks) then var HighSkill %combatsToCheck(%highrate)
               math highrate add 1
               goto HighRate_1
          }
     echo ######################################
     if (%NecroHealing = 0) then echo **** SWITCHING TO HIGHEST WEAPON FOR UBERMONSTER: %HighSkill
     if (%NecroHealing = 1) then echo **** SWITCHING TO HIGHEST WEAPON FOR NECRO HEALING: %HighSkill
     echo ######################################
     var High.Switch 1
     var TempMax %MAX.LEARNINGRATE
     delay 0.00001
     delay 0.00001
     gosub RETREAT
     put adv %ubermonster
     pause 0.5
     var MAX.LEARNINGRATE 35
     goto %HighSkill
### FIND THE FOUR HIGHEST WEAPONS ( %HighSkill and %SecondHigh )
HighRate_Check:
     var highrate 0
     var combatsToUse %combatsToCheck
     eval combatsToUse replace("%combatsToUse" , "|Backstab" , "")
     eval combatsToUse replace("%combatsToUse" , "Backstab|" , "")
     eval combatsToUse replace("%combatsToUse" , "|Offhand_Weapon" , "")
     eval combatsToUse replace("%combatsToUse" , "Offhand_Weapon|" , "")
     delay 0.00001
     eval numberOfAllCombats count("%combatsToUse", "|")
     var loopnumber %numberOfAllCombats
     if (%numberOfAllCombats = 1) then
          {
               var HighSkill %combatsToCheck(0)
               var SecondHigh NULL
               var ThirdHigh NULL
               var FourthHigh NULL
               return
          }
     if (%numberOfAllCombats = 2) then
          {
               var HighSkill %combatsToCheck(0)
               var SecondHigh %combatsToCheck(1)
               var ThirdHigh NULL
               var FourthHigh NULL
               goto HighRate_Check_1
          }
     if (%numberOfAllCombats = 3) then
          {
               var HighSkill %combatsToCheck(0)
               var SecondHigh %combatsToCheck(1)
               var ThirdHigh %combatsToCheck(2)
               var FourthHigh NULL
               goto HighRate_Check_1
          }
     delay 0.00001
     var HighSkill %combatsToCheck(1)
     var SecondHigh %combatsToCheck(2)
     var ThirdHigh %combatsToCheck(3)
     var FourthHigh %combatsToCheck(4)
HighRate_Check_1:
     delay 0.00001
     if (%highrate <= %numberOfAllCombats) then
          {
               if ($%combatsToUse(%highrate).Ranks >= $%HighSkill.Ranks) then
                    {
                         var FourthHigh %ThirdHigh
                         var ThirdHigh %SecondHigh
                         var SecondHigh %HighSkill
                         var HighSkill %combatsToUse(%highrate)
                         math highrate add 1
                         goto HighRate_Check_1
                    }
               if ($%combatsToUse(%highrate).Ranks >= $%SecondHigh.Ranks) then
                    {
                         var FourthHigh %ThirdHigh
                         var ThirdHigh %SecondHigh
                         var SecondHigh %combatsToUse(%highrate)
                         math highrate add 1
                         goto HighRate_Check_1
                    }
               if ($%combatsToUse(%highrate).Ranks >= $%ThirdHigh.Ranks) then
                    {
                         var FourthHigh %ThirdHigh
                         var ThirdHigh %combatsToUse(%highrate)
                         math highrate add 1
                         goto HighRate_Check_1
                    }
               if ($%combatsToUse(%highrate).Ranks >= $%FourthHigh.Ranks) then
                    {
                         var FourthHigh %combatsToUse(%highrate)
                         math highrate add 1
                         goto HighRate_Check_1
                    }
               math highrate add 1
          }
     if (%highrate > %numberOfAllCombats) then
          {
               echo ##############
               echo ** HIGHRATE CHECK PARSE:
               echo ** TOP WEAPONS (BS/OH ignored):
               echo ** 1st: %HighSkill
               echo ** 2nd: %SecondHigh
               if (%numberOfAllCombats > 2) then echo ** 3rd: %ThirdHigh
               if (%numberOfAllCombats > 3) then echo ** 4th: %FourthHigh
               echo ##############
               echo
               pause 0.3
               return
          }
     goto HighRate_Check_1
# Set Array of Combat LearningRates
CombatLearning:
     var i 0
     var LearningArray
     eval allCombats replacere("%combatsToTrain", "^\||\|$", "")
     eval j count("%allCombats", "|")
     if (%j = 0) then
          {
               var LowestRate $%allCombats(%i).LearningRate
               return
          }
CombatLearning1:
     delay 0.00001
     if (%i <= %j) then
          {
               if ("%LearningArray" = "") then var LearningArray $%allCombats(%i).LearningRate
               else var LearningArray %LearningArray, $%allCombats(%i).LearningRate
               math i add 1
               goto CombatLearning1
          }
     evalmath LowestRate min(%LearningArray)
     return
# Shows our hunter the training order.
SETHUNT.SetHunt:
     # debug 5
     eval lowarray replacere("%lowarray", "\|+", "|")
     eval lowarray replacere("%lowarray", "^\|", "")
     eval lowarray replacere("%lowarray", "\|$", "")
     var combatsToTrain %lowarray
     eval combatsToDisplay replace("%combatsToTrain", "|", "-> ")
     if (%WeaponSet = 0) then
          {
               if (%Backtraining = 1) then
                    {
                         put #echo >Log #00ffbf Backtrain Training Order: %combatsToDisplay
                         # echo *** Backtrain Training Order: %combatsToDisplay
                    }
               if (%Backtraining = 0) then
                    {
                         put #echo >Log #00ffbf Main Combat Training Order: %combatsToDisplay
                         # echo *** Main Combat Training Order: %combatsToDisplay
                    }
          }
     echo
     echo ############################################################################
     echo ############################################################################
     if (%Backtraining = 1) then echo * ~~~~~ BACKTRAINING ACTIVE ~~~~~
     if (%Backtraining = 0) then echo * ~~~~~ MAIN COMBAT ACTIVE ~~~~~~
     echo ** Training: %numberOfAllCombats Weapon Skills
     echo
     echo ** Weapons to Train: %ALLWEAPONS
     echo
     echo ** Training Order: %combatsToDisplay
     echo
     if !matchre("%TrainLowest", "(?i)(NULL|OFF|^%|^\s*$)") then echo *** TrainLowest ~ON~ - Training Order WILL be dynamically modified!
     if !matchre("%Priority.Weapons", "(?i)(NULL|OFF|^%|^\s*$)") then echo *** Priority.Weapons ~ON~ - Training Order WILL be dynamically modified!
     echo ############################################################################
     echo ############################################################################
     echo
     var combats %combatsToTrain
     var combatcount 0
     return
     ### TEMP WORKAROUND TO TEST
     # goto SWITCH
### RANK SORTING
LowRanks:
     var temparray $1
     var sorttype $2
     # if "%sorttype" = "weapons" then var sorttype
     var lowarray
     echo
     echo ###################
     echo * SORTING %sorttype RANKS
     echo * FROM LOWEST TO HIGHEST
     echo ###################
     echo
     var ExpTracker.GagExpCurrent $ExpTracker.GagExp
     var CircleCalc.ParseCurrent $CircleCalc.Parse
     put #var CircleCalc.Parse 1
     put #var ExpTracker.GagExp 1
     eval temparray replacere("%temparray", "Target", "Targeted_Magic")
     eval temparray replacere("%temparray", "_", " ")
     action (array) var lowarray $1|%lowarray when ^(%temparray)\s+-
     action (array) on
     delay 0.00001
     put /sort %sorttype
     waitfor EXP HELP for
     eval lowarray replacere("%lowarray", "Targeted_Magic", "Target")
     eval lowarray replacere("%lowarray", "Targeted Magic", "Target")
     ### REMOVE ANY DUPLICATE SPELL NAMES
     eval lowarray replacere("%lowarray", "Target(?=.*Target)", "")
     eval lowarray replacere("%lowarray", "Debilitation(?=.*Debilitation)", "")
     eval lowarray replacere("%lowarray", "Warding(?=.*Warding)", "")
     eval lowarray replacere("%lowarray", "Utility(?=.*Utility)", "")
     eval lowarray replacere("%lowarray", "Augmentation(?=.*Augmentation)", "")
     eval lowarray replacere("%lowarray", "Sorcery(?=.*Sorcery)", "")
     #####################################################
     eval lowarray replacere("%lowarray", "\|+", "|")
     eval lowarray replacere("%lowarray", "\|$", "")
     eval lowarray replacere("%lowarray", "^\|", "")
     eval lowarray replacere("%lowarray", " ", "_")
     action (array) off
     put #var CircleCalc.Parse %CircleCalc.ParseCurrent
     # put #var ExpTracker.GagExp %ExpTracker.GagExpCurrent
     put #var ExpTracker.GagExp 0
     return
HighRanks:
     var temparray $1
     var sorttype $2
     var higharray
     var ExpTracker.GagExpCurrent $ExpTracker.GagExp
     var CircleCalc.ParseCurrent $CircleCalc.Parse
     put #var CircleCalc.Parse 1
     put #var ExpTracker.GagExp 1
     eval temparray replacere("%temparray", "_", " ")
     action (array) var higharray %higharray|$1 when ^(%temparray)\s+-
     action (array) on
     delay 0.00001
     put /sort %sorttype
     waitfor EXP HELP for
     eval higharray replacere("%higharray", "Target(?=.*Target)", "")
     eval higharray replacere("%higharray", "Debilitation(?=.*Debilitation)", "")
     eval higharray replacere("%higharray", "Warding(?=.*Warding)", "")
     eval higharray replacere("%higharray", "Utility(?=.*Utility)", "")
     eval higharray replacere("%higharray", "Augmentation(?=.*Augmentation)", "")
     eval higharray replacere("%higharray", "Sorcery(?=.*Sorcery)", "")
     eval higharray replacere("%higharray", "\|+", "|")
     eval higharray replacere("%higharray", "\|$", "")
     eval higharray replacere("%higharray", "^\|", "")
     eval higharray replacere("%higharray", " ", "_")
     action (array) off
     put #var CircleCalc.Parse %CircleCalc.ParseCurrent
     # put #var ExpTracker.GagExp %ExpTracker.GagExpCurrent
     put #var ExpTracker.GagExp 0
     return
#################################################
### WEAPON SPECIFIC MODULES INIT
COMBAT.0:
     math combatcount add 1
     delay 0.00001
COMBAT.1:
BACKSTAB:
     math combatcount add 1
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill SMALL_EDGED
     if matchre("$UC_WEAPON_BS","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto SE
     if ("$guild" != "Thief") || ("%Backstab" = "NULL") then goto SMALL_EDGED
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType BACKSTAB
     echo ** Checking BACKSTAB
     var Type BS
     var WEAPON_NOUN %BS.NOUN
     var WEAPON_EXP Backstab
     var MANEUVER CLEAVE
     put #parse BACKSTAB!
     gosub CLEARHANDS
     if (!matchre("$UC_WEAPON_BS","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Backstab.Ranks <= $$charactername.MAXRANKS) && ($Backstab.LearningRate < %MAX.LEARNINGRATE) && ($Backstab.Ranks != %TOTAL.MAXRANKS)) then gosub PREBACKSTABTRAIN "Backstab" "$UC_WEAPON_BS" "BACKSTAB"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.2:
SE:
SMALL_EDGED:
     math combatcount add 1
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill SMALL_BLUNT
     if matchre("$UC_WEAPON_SE","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto SMALL_BLUNT
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType SE
     echo ** Checking SMALL_EDGED
     var Type SE
     var WEAPON_NOUN %SE.NOUN
     var WEAPON_EXP Small_Edged
     var WEAPON $UC_WEAPON_SE
     var MANEUVER CLEAVE
     put #parse SMALL_EDGED!
     gosub CLEARHANDS
     if ("$guild" = "Warrior Mage") then
          {
               if (($UC_SummonWeapons = 1) && matchre("%SummonSE", "(?i)(ON|1|YES)")) then
                    {
                         gosub SUMMON_WEAPON SE
                         put #var UC_WEAPON_SE %WEAPON
                    }
               if (!matchre("%SummonSE", "(?i)(ON|1|YES)") && matchre("$righthand", "(?i)%WM.Weapon")) then gosub EMPTY_RIGHT
               if (!matchre("%SummonSE", "(?i)(ON|1|YES)") && matchre("$lefthand", "(?i)%WM.Weapon")) then gosub EMPTY_LEFT
          }
     if (!matchre("$UC_WEAPON_SE","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Small_Edged.Ranks <= $$charactername.MAXRANKS) && ($Small_Edged.LearningRate < %MAX.LEARNINGRATE) && ($Small_Edged.Ranks != %TOTAL.MAXRANKS)) then gosub PRETRAIN "Small_Edged" "$UC_WEAPON_SE" "SE"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.3:
SB:
SMALL_BLUNT:
     math combatcount add 1
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill LARGE_BLUNT
     if matchre("$UC_WEAPON_SB","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto LARGE_BLUNT
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType SB
     echo ** Checking SMALL_BLUNT
     var Type SB
     var WEAPON_NOUN %SB.NOUN
     var WEAPON_EXP Small_Blunt
     var WEAPON $UC_WEAPON_SB
     var MANEUVER CRASH
     put #parse SMALL_BLUNT!
     gosub CLEARHANDS
     if ("$guild" = "Warrior Mage") then
          {
               if (($UC_SummonWeapons = 1) && matchre("%SummonSB", "(?i)(ON|1|YES)")) then
                    {
                         gosub SUMMON_WEAPON SB
                         put #var UC_WEAPON_SB %WEAPON
                    }
               if (!matchre("%SummonSB", "(?i)(ON|1|YES)") && matchre("$righthand", "(?i)%WM.Weapon")) then gosub EMPTY_RIGHT
               if (!matchre("%SummonSB", "(?i)(ON|1|YES)") && matchre("$lefthand", "(?i)%WM.Weapon")) then gosub EMPTY_LEFT
          }
     if (!matchre("$UC_WEAPON_SB","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Small_Blunt.Ranks <= $$charactername.MAXRANKS) && ($Small_Blunt.LearningRate < %MAX.LEARNINGRATE) && ($Small_Blunt.Ranks != %TOTAL.MAXRANKS)) then gosub PRETRAIN "Small_Blunt" "$UC_WEAPON_SB" "SB"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.4:
LB:
LARGE_BLUNT:
     math combatcount add 1
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill TWOHANDED_BLUNT
     if matchre("$UC_WEAPON_LB","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto TWOHANDED_BLUNT
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType LB
     echo ** Checking LARGE_BLUNT
     var Type LB
     var WEAPON_NOUN %LB.NOUN
     var WEAPON_EXP Large_Blunt
     var WEAPON $UC_WEAPON_LB
     var MANEUVER CRASH
     put #parse LARGE_BLUNT!
     gosub CLEARHANDS
     if ("$guild" = "Warrior Mage") then
          {
               if (($UC_SummonWeapons = 1) && matchre("%SummonLB", "(?i)(ON|1|YES)")) then
                    {
                         gosub SUMMON_WEAPON LB
                         put #var UC_WEAPON_LB %WEAPON
                    }
               if (!matchre("%SummonLB", "(?i)(ON|1|YES)") && matchre("$righthand", "(?i)%WM.Weapon")) then gosub EMPTY_RIGHT
               if (!matchre("%SummonLB", "(?i)(ON|1|YES)") && matchre("$lefthand", "(?i)%WM.Weapon")) then gosub EMPTY_LEFT
          }
     if (!matchre("$UC_WEAPON_LB","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Large_Blunt.Ranks <= $$charactername.MAXRANKS) && ($Large_Blunt.LearningRate < %MAX.LEARNINGRATE) && ($Large_Blunt.Ranks != %TOTAL.MAXRANKS)) then gosub PRETRAIN "Large_Blunt" "$UC_WEAPON_LB" "LB"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.5:
THB:
TWOHANDED_BLUNT:
     math combatcount add 1
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill HEAVY_THROWN
     if matchre("$UC_WEAPON_THB","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto HEAVY_THROWN
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType THB
     echo ** Checking TWOHANDED_BLUNT
     var Type 2HB
     var WEAPON_NOUN %THB.NOUN
     var WEAPON_EXP Twohanded_Blunt
     var WEAPON $UC_WEAPON_THB
     var MANEUVER CRASH
     put #parse TWOHANDED_BLUNT!
     gosub CLEARHANDS
     if ("$guild" = "Warrior Mage") then
          {
               if (($UC_SummonWeapons = 1) && matchre("%SummonTHB", "(?i)(ON|1|YES)")) then
                    {
                         gosub SUMMON_WEAPON 2HB
                         put #var UC_WEAPON_THB %WEAPON
                    }
               if (!matchre("%SummonTHB", "(?i)(ON|1|YES)") && matchre("$righthand", "(?i)%WM.Weapon")) then gosub EMPTY_RIGHT
               if (!matchre("%SummonTHB", "(?i)(ON|1|YES)") && matchre("$lefthand", "(?i)%WM.Weapon")) then gosub EMPTY_LEFT
          }
     if (!matchre("$UC_WEAPON_THB","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Twohanded_Blunt.Ranks <= $$charactername.MAXRANKS) && ($Twohanded_Blunt.LearningRate < %MAX.LEARNINGRATE) && ($Twohanded_Blunt.Ranks != %TOTAL.MAXRANKS)) then gosub PRETRAIN "Twohanded_Blunt" "$UC_WEAPON_THB" "THB"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.6:
HT:
HEAVY_THROWN:
     # debug 5
     math combatcount add 1
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill LIGHT_THROWN
     if matchre("$UC_WEAPON_HT","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto LIGHT_THROWN
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType HT
     echo ** Checking HEAVY_THROWN
     var Type HT
     var WEAPON_NOUN %HT.NOUN
     var WEAPON_EXP Heavy_Thrown
     var WEAPON $UC_WEAPON_HT
     var MANEUVER NULL
     put #parse HEAVY_THROWN!
     gosub CLEARHANDS
     if ("$guild" = "Warrior Mage") then
          {
               if (($UC_SummonWeapons = 1) && matchre("%SummonHT", "(?i)(ON|1|YES)")) then
                    {
                         gosub SUMMON_WEAPON HT
                         put #var UC_WEAPON_HT %WEAPON
                    }
               if (!matchre("%SummonHT", "(?i)(ON|1|YES)") && matchre("$righthand", "(?i)%WM.Weapon")) then gosub EMPTY_RIGHT
               if (!matchre("%SummonHT", "(?i)(ON|1|YES)") && matchre("$lefthand", "(?i)%WM.Weapon")) then gosub EMPTY_LEFT
          }
     if (!matchre("$UC_WEAPON_HT","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Heavy_Thrown.Ranks <= $$charactername.MAXRANKS) && ($Heavy_Thrown.LearningRate < %MAX.LEARNINGRATE) && ($Heavy_Thrown.Ranks != %TOTAL.MAXRANKS)) then gosub SINGLEPRETHROWNTRAIN "Heavy_Thrown" "$UC_WEAPON_HT"  "HT"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     gosub STOW $UC_WEAPON_HT
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.7:
LT:
LIGHT_THROWN:
     math combatcount add 1
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill BOWS
     var ranged 1
     if matchre("$UC_WEAPON_LT","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto BOWS
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType LT
     echo ** Checking LIGHT_THROWN
     var Type LT
     var WEAPON_NOUN %LT.NOUN
     var WEAPON_EXP Light_Thrown
     var WEAPON $UC_WEAPON_LT
     var MANEUVER NULL
     put #parse LIGHT_THROWN!
     gosub CLEARHANDS
     if ("$guild" = "Warrior Mage") then
          {
               if (($UC_SummonWeapons = 1) && matchre("%SummonLT", "(?i)(ON|1|YES)")) then
                    {
                         gosub SUMMON_WEAPON LT
                         put #var UC_WEAPON_LT %WEAPON
                    }
               if (!matchre("%SummonLT", "(?i)(ON|1|YES)") && matchre("$righthand", "(?i)%WM.Weapon")) then gosub EMPTY_RIGHT
               if (!matchre("%SummonLT", "(?i)(ON|1|YES)") && matchre("$lefthand", "(?i)%WM.Weapon")) then gosub EMPTY_LEFT
          }
     if (!matchre("$UC_WEAPON_LT","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Light_Thrown.Ranks <= $$charactername.MAXRANKS) && ($Light_Thrown.LearningRate < %MAX.LEARNINGRATE) && ($Light_Thrown.Ranks != %TOTAL.MAXRANKS)) then gosub SINGLEPRETHROWNTRAIN "Light_Thrown" "$UC_WEAPON_LT" "LT"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     gosub STOW $UC_WEAPON_LT
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.8:
LE:
LARGE_EDGED:
     math combatcount add 1
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill TWOHANDED_EDGED
     if matchre("$UC_WEAPON_LE","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto TWOHANDED_EDGED
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType LE
     echo ** Checking LARGE_EDGED
     var Type LE
     var WEAPON_NOUN %LE.NOUN
     var WEAPON_EXP Large_Edged
     var WEAPON $UC_WEAPON_LE
     var MANEUVER CLEAVE
     put #parse LARGE_EDGED!
     gosub CLEARHANDS
     if ("$guild" = "Warrior Mage") then
          {
               if (($UC_SummonWeapons = 1) && matchre("%SummonLE", "(?i)(ON|1|YES)")) then
                    {
                         gosub SUMMON_WEAPON LE
                         put #var UC_WEAPON_LE %WEAPON
                    }
               if (!matchre("%SummonLE", "(?i)(ON|1|YES)") && matchre("$righthand", "(?i)%WM.Weapon")) then gosub EMPTY_RIGHT
               if (!matchre("%SummonLE", "(?i)(ON|1|YES)") && matchre("$lefthand", "(?i)%WM.Weapon")) then gosub EMPTY_LEFT
          }
     if (!matchre("$UC_WEAPON_LE","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Large_Edged.Ranks <= $$charactername.MAXRANKS) && ($Large_Edged.LearningRate < %MAX.LEARNINGRATE) && ($Large_Edged.Ranks != %TOTAL.MAXRANKS)) then gosub PRETRAIN "Large_Edged" "$UC_WEAPON_LE" "LE"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.9:
THE:
TWOHANDED_EDGED:
     math combatcount add 1
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill STAVES
     if matchre("$UC_WEAPON_THE","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto STAVES
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType THE
     echo ** Checking TWOHANDED_EDGED
     var Type 2HE
     var WEAPON_EXP Twohanded_Edged
     var WEAPON_NOUN %THE.NOUN
     var WEAPON $UC_WEAPON_THE
     var MANEUVER CLEAVE
     put #parse TWOHANDED_EDGED!
     gosub CLEARHANDS
     if ("$guild" = "Warrior Mage") then
          {
               if (($UC_SummonWeapons = 1) && matchre("%SummonTHE", "(?i)(ON|1|YES)")) then
                    {
                         gosub SUMMON_WEAPON 2HE
                         put #var UC_WEAPON_THE %WEAPON
                    }
               if (!matchre("%SummonTHE", "(?i)(ON|1|YES)") && matchre("$righthand", "(?i)%WM.Weapon")) then gosub EMPTY_RIGHT
               if (!matchre("%SummonTHE", "(?i)(ON|1|YES)") && matchre("$lefthand", "(?i)%WM.Weapon")) then gosub EMPTY_LEFT
          }
     if (!matchre("$UC_WEAPON_THE","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Twohanded_Edged.Ranks <= $$charactername.MAXRANKS) && ($Twohanded_Edged.LearningRate < %MAX.LEARNINGRATE) && ($Twohanded_Edged.Ranks != %TOTAL.MAXRANKS)) then gosub PRETRAIN "Twohanded_Edged" "$UC_WEAPON_THE" "THE"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.10:
STAVE:
STAVES:
     math combatcount add 1
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill POLEARMS
     if matchre("$UC_WEAPON_STAVES","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto POLEARMS
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType STAVES
     echo ** Checking STAVES
     var Type Stave
     var WEAPON_NOUN %STAVE.NOUN
     var WEAPON_EXP Staves
     var WEAPON $UC_WEAPON_STAVES
     var MANEUVER TWIRL
     put #parse STAVES!
     gosub CLEARHANDS
     if ("$guild" = "Warrior Mage") then
          {
               if (($UC_SummonWeapons = 1) && matchre("%SummonStaves", "(?i)(ON|1|YES)")) then
                    {
                         gosub SUMMON_WEAPON Stave
                         put #var UC_WEAPON_STAVES %WEAPON
                    }
               if (!matchre("%SummonStaves", "(?i)(ON|1|YES)") && matchre("$righthand", "(?i)%WM.Weapon")) then gosub EMPTY_RIGHT
               if (!matchre("%SummonStaves", "(?i)(ON|1|YES)") && matchre("$lefthand", "(?i)%WM.Weapon")) then gosub EMPTY_LEFT
          }
     if (!matchre("$UC_WEAPON_STAVES","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Staves.Ranks <= $$charactername.MAXRANKS) && ($Staves.LearningRate < %MAX.LEARNINGRATE) && ($Staves.Ranks != %TOTAL.MAXRANKS)) then gosub PRETRAIN "Staves" "$UC_WEAPON_STAVES" "STAVES"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.11:
POLEARMS:
     math combatcount add 1
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill BRAWL
     if matchre("$UC_WEAPON_POLEARMS","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto BRAWLING
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType POLEARMS
     echo ** Checking POLEARMS
     var Type Polearm
     var WEAPON_NOUN %POLEARM.NOUN
     var WEAPON_EXP Polearms
     var WEAPON $UC_WEAPON_POLEARMS
     var MANEUVER IMPALE
     put #parse POLEARMS!
     gosub CLEARHANDS
     if ("$guild" = "Warrior Mage") then
          {
               if (($UC_SummonWeapons = 1) && matchre("%SummonPolearms", "(?i)(ON|1|YES)")) then
                    {
                         gosub SUMMON_WEAPON Polearm
                         put #var UC_WEAPON_POLEARMS %WEAPON
                    }
               if (!matchre("%SummonPolearms", "(?i)(ON|1|YES)") && matchre("$righthand", "(?i)%WM.Weapon")) then gosub EMPTY_RIGHT
               if (!matchre("%SummonPolearms", "(?i)(ON|1|YES)") && matchre("$lefthand", "(?i)%WM.Weapon")) then gosub EMPTY_LEFT
          }
     if (!matchre("$UC_WEAPON_POLEARMS","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Polearms.Ranks <= $$charactername.MAXRANKS) && ($Polearms.LearningRate < %MAX.LEARNINGRATE) && ($Polearms.Ranks != %TOTAL.MAXRANKS)) then gosub PRETRAIN "Polearms" "$UC_WEAPON_POLEARMS" "POLEARMS"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.12:
BOW:
BOWS:
     math combatcount add 1
     var summoning 0
     action (retreat) on
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill CROSSBOW
     var ranged 1
     if matchre("$UC_WEAPON_BOW","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto CROSSBOW
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType BOW
     echo ** Checking BOW
     var WEAPON_NOUN %BOW.NOUN
     var WEAPON_EXP Bow
     var WEAPON $UC_WEAPON_BOW
     var CurrentAmmo %BowAmmo
     var MANEUVER POWERSHOT
     put #parse BOW!
     gosub CLEARHANDS
     if (!matchre("$UC_WEAPON_BOW","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Bow.Ranks <= $$charactername.MAXRANKS) && ($Bow.LearningRate < %MAX.LEARNINGRATE) && ($Bow.Ranks != %TOTAL.MAXRANKS)) then gosub PRERANGEDTRAIN "Bow" "$UC_WEAPON_BOW" "%BowAmmo" "BOW"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.13:
CROSSBOW:
     math combatcount add 1
     var summoning 0
     action (retreat) on
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill SLINGS
     if matchre("$UC_WEAPON_CROSSBOW","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto SLINGS
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType CROSSBOW
     echo ** Checking CROSSBOW
     var WEAPON_NOUN %CROSSBOW.NOUN
     var WEAPON_EXP Crossbow
     var CurrentAmmo %XbowAmmo
     var MANEUVER POWERSHOT
     put #parse CROSSBOW!
     gosub CLEARHANDS
     if (!matchre("$UC_WEAPON_CROSSBOW","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Crossbow.Ranks <= $$charactername.MAXRANKS) && ($Crossbow.LearningRate < %MAX.LEARNINGRATE) && ($Crossbow.Ranks != %TOTAL.MAXRANKS)) then gosub PRERANGEDTRAIN "Crossbow" "$UC_WEAPON_CROSSBOW" "%XbowAmmo" "CROSSBOW"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.14:
SLINGS:
     math combatcount add 1
     var summoning 0
     action (retreat) on
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill LARGE_EDGED
     if matchre("$UC_WEAPON_SLING","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto LARGE_EDGED
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType SLINGS
     echo ** Checking SLINGS
     var WEAPON_NOUN %SLING.NOUN
     var WEAPON_EXP Slings
     var CurrentAmmo %SlingAmmo
     var MANEUVER POWERSHOT
     put #parse SLINGS!
     gosub CLEARHANDS
     if (!matchre("$UC_WEAPON_SLING","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Slings.Ranks <= $$charactername.MAXRANKS) && ($Slings.LearningRate < %MAX.LEARNINGRATE) && ($Slings.Ranks != %TOTAL.MAXRANKS)) then gosub PRERANGEDTRAIN "Slings" "$UC_WEAPON_SLING" "%SlingAmmo" "SLINGS"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.15:
BRAWL:
BRAWLING:
     math combatcount add 1
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill OFFHAND
     if (matchre("$UC_WEAPON_BRAWL","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%NecroHealing = 0)) then goto OFFHAND
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType BRAWL
     echo ** Checking BRAWL
     var WEAPON_NOUN %BRAWL.NOUN
     var WEAPON_EXP Brawling
     var MANEUVER PALMSTRIKE
     put #parse BRAWLING!
     gosub CLEARHANDS
     if matchre("%BRAWLWEAPON", "(?i)BLOWGUN")  then
          {
               var CurrentAmmo dart
               var MANEUVER POWERSHOT
               gosub PRERANGEDTRAIN "Brawling" "$UC_WEAPON_BRAWL" "dart" "BRAWL"
               goto BRAWLING_NEXT
          }
     if (!matchre("$UC_WEAPON_BRAWL","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Brawling.Ranks <= $$charactername.MAXRANKS) && ($Brawling.Ranks != %TOTAL.MAXRANKS)) then gosub PREBRAWLING "Brawling" "BRAWL"
BRAWLING_NEXT:
     # if !contains("$UC_WEAPON_BRAWL","NULL") && ($Brawling.Ranks < $$charactername.MAXRANKS) && ("$guild" = "Empath") then gosub PREEMPATHBRAWLING "Brawling" "BRAWL"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
COMBAT.16:
OFFHAND:
OFFHAND_WEAPON:
     action (offhand) on
     math combatcount add 1
     var errorloop 0
     var summoning 0
     if ($UC_SmartWeapons = 1) then var NextSkill %combats(%combatcount)
     if ($UC_SmartWeapons = 0) then var NextSkill WEAPON_LIST_END
     if matchre("$UC_WEAPON_OH","(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto OFFHAND_END
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     put #var UC_WeaponType OFFHAND
     echo ** Checking OFFHAND_WEAPON
     var WEAPON_NOUN %OH.NOUN
     var WEAPON_EXP Offhand_Weapon
     put #parse OFFHAND!
     gosub CLEARHANDS
     if (!matchre("$UC_WEAPON_OH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ($Offhand_Weapon.Ranks <= $$charactername.MAXRANKS) && ($Offhand_Weapon.Ranks != %TOTAL.MAXRANKS)) then gosub PRETRAIN "Offhand_Weapon" "$UC_WEAPON_OH" "OFFHAND"
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($UC_bundleFull = 1) then goto DONE_TRAINING
     if ($UC_bagsFull = 1) then goto DONE_TRAINING
     if !matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty") then gosub CLEARHANDS
     if ($UC_Ammo = 1) then gosub stowammo
     gosub stowing
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
OFFHAND_END:
     action (offhand) off
     gosub RESET_RANGE
     if ($UC_SmartWeapons = 1) then goto SWITCH
WEAPON_LIST_END:
     # debuglevel 10
     gosub COMBAT_TIMER
     gosub TRAINERLOOP_TIMER
     gosub CombatLearning
     # if (%LowestRate > %MAX.LEARNINGRATE) then goto DONE_TRAINING
     if (%TrainerLoop.Last < 30) then var MAX.LEARNINGRATE 35
     if ($Combat.Last < 30) then var MAX.LEARNINGRATE 35
     if ((%ComatLoops > 2) && ($Combat.Last < 60)) then var MAX.LEARNINGRATE 35
     put #echo >Log #99ff99 * ~ Weapon Loop Reset ~
     if (%LEARNING.INCREASE > 0) then gosub LEARNING_INCREASE
     pause
     goto TrainLoop2
DONE_TRAINING:
     delay 0.0001
     gosub stowing
     if ($UC_bundleFull = 1) then put #echo >Log Orange FULL BUNDLE ESCAPE
     if ($UC_bagsFull = 1) then put #echo >Log Orange FULL BAGS ESCAPE
     put #tvar UC_bagsFull 0
     put #tvar UC_bundleFull 0
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (($UC_Armor.Noob = 1) && (%Removed.Armor = 1)) then gosub WEAR_PLATE
     # if ("$UC_WeaponType" = "OFFHAND") then put #var UC_WeaponType SWITCH
     if ((matchre("$UC_WeaponType","(SLINGS|BOW|CROSSBOW)") && (%NecroHealing = 0)) || ((%ammolodged) && (%NecroHealing = 0))) then gosub AMMO_CLEANUP
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then gosub CLEARHANDS
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     # if !matchre("$scriptlist", "ubercombat") then goto Top
     if ($UC_bundleFull = 1) then goto ESCAPE_SKINS
     if ($UC_bagsFull = 1) then goto ESCAPE_BAGS
     put #parse COMBAT DONE
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     goto ESCAPE.TIMER

PRETRAINCHECK:
     timer stop
     if (("$guild" = "Empath") && ($UC_GuardianSpirit = 1)) then
          {
               gosub GS_TIMER
               if (%GSLast < 450) then goto PRETRAINCHECK_2
               echo **** GS CHECK ****
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if !matchre("$roomobjs", "(alfar|dastardly|senile|gracile|ethereal|tall|lean|slim|graceful|trim|alert|serene|delicate|slender|stoic|athletic|lithe|lissome|solemn|sedate|tranquil|wiry|svelte|imposing|savage) warrior")) then gosub GUARDIAN_SPIRIT
               var GSTime $gametime
          }
PRETRAINCHECK_2:
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("%HUNT", "(?i)(ON|1|YES)") then gosub HUNT_TIMER
     if matchre("%POWERP", "(?i)(ON|1|YES)") then gosub PERCEIVE_TIMER
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("%APPRAISE", "(?i)(ON|1|YES)") then gosub APPRAISE_TIMER
     if ($UC_Wand = 1) then gosub WAND_TIMER
     if ($UC_Tarantula = 1) then gosub TARANTULA_TIMER
     if ($UC_Astrolabe = 1) then gosub ASTROLABE_TIMER
     if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
	if matchre("$guild", "%MAGICUSER") then gosub CYCLIC_TIMER
     if ("$guild" = "Bard") then gosub BARD_CHECK
     if ("$guild" = "Barbarian") then gosub BARB_TIMER
     if (("$guild" = "Necromancer") && (%NecroHealing = 1)) then
          {
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto DONE_NECROHEALING
          }
     if ("$guild" = "Moon Mage") then
          {
               if (($Astrology.LearningRate < 34) && (%Observe = 1)) then gosub OBSERVE_CHECK
          }
     timer start
     return

PRETRAIN_TIMERS:
COMBAT_TIMERS:
     math pretrainloop add 1
     action (buffs) on
     if ("$guild" = "Warrior") then put #var guild Warrior Mage
     if ("$guild" = "Moon") then put #var guild Moon Mage
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (($UC_Herbs = 1) && ($health < 100)) then
          {
               gosub HERBHEAL_TIMER
               if (%herbLast > 300) then gosub HEALTH_CHECK_ALL
               if ((%herbLast > 300) && ($needHealing = 1)) then gosub HERB_HEALING
          }
     if ($bleeding = 1) && !matchre("$guild", "(Necromancer|Empath)") then goto ESCAPE
     if (($health < 94) && ($bleeding = 1)) then goto ESCAPE
     if ("$guild" = "Empath") then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then gosub ASSESS
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (matchre("$monsterlist", "(?i)%Undead") && ($SpellTimer.Absolution.duration < 2) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (($health < 90) && ($circle > 5)) then gosub VH_HEAL
          }
     if (%Foci.Active = 1) then goto COMBAT_TIMERS_DONE
     if ($UC_Egg = 1) then gosub EGG_TIMER
     if ($UC_Wand = 1) then gosub WAND_TIMER
     if ($UC_Tarantula = 1) then gosub TARANTULA_TIMER
     if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
     if ($UC_Astrolabe = 1) then gosub ASTROLABE_TIMER
     if matchre("%HUNT", "(?i)(ON|1|YES)") then gosub HUNT_TIMER
     if matchre("%POWERP", "(?i)(ON|1|YES)") then gosub PERCEIVE_TIMER
     if ($UC_WarHorn = 1) then gosub WARHORN_TIMER
     if ($UC_RunicTattoo = 1) then gosub RUNIC_TIMER
     if ("$guild" = "Moon Mage") then
          {
               gosub WEATHER_TIMER
               gosub OBSERVE_TIMER
               if (($Astrology.LearningRate < 33) && (%Observe = 1)) then gosub OBSERVE_CHECK
          }
     if ("$guild" = "Trader") then
          {
               gosub TESSERA_TIMER
               if matchre("$roomobjs", "apparatus") then gosub APPARATUS_TIMER
          }
     if ("$guild" = "Cleric") then gosub COMMUNE_CHECK
     if (("$guild" = "Paladin") && ($circle > 19)) then gosub GLYPHMANA_TIMER
     if (%HaveAnloral = 1) then gosub ANLORAL_TIMER
     if ("$guild" = "Bard") then gosub BARD_CHECK
     if ("$guild" = "Barbarian") then
          {
               gosub BARB_TIMER
               gosub ROAR_TIMER
          }
     if ($UC_QuickenEarth = 1) then gosub QUICKEN_TIMER
     if matchre("$guild", "%MAGICUSER") then gosub CYCLIC_TIMER
     if ((%Germish.Alert = 1) && ("$roomplayers" != "")) then gosub MOVE_ROOMS
     if ("$guild" = "Necromancer") then
          {
               gosub DO_TIMER
               if (%NecroHealing = 1) then
                    {
                         gosub HEALTH_CHECK_ALL
                         if ($needHealing = 0) then goto DONE_NECROHEALING
                    }
          }
     if (($UC_Crystal = 1) && ($concentration > 95) && ($UC_CrystalCombat = 1)) then gosub CRYSTAL_TIMER
     if ($UC_OrbRub = 1) then gosub ORB_RUB_TIMER
     if ((%Foci.Active = 1) && ($Targeted_Magic.LearningRate < 1) && (%pretrainloop > 1)) then gosub TM_FOCI_END
     gosub MANEUVER_TIMER
     gosub DOUBLESTRIKE_TIMER
COMBAT_TIMERS_DONE:
     action (retreat) on
     action (combat) on
     return
TOWNRUN_TIMER:
TOWNRUN_TIMERS:
     if ("$guild" = "Warrior") then put #var guild Warrior Mage
     if ("$guild" = "Moon") then put #var guild Moon Mage
     if ($UC_Wand = 1) then gosub WAND_TIMER
     if ($UC_Teach = 1) then gosub TEACH_TIMER
     if ($UC_Teach = 1) then gosub TEACH_TIMER
     if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
     if ($UC_Tarantula = 1) then gosub TARANTULA_TIMER
     if ($UC_Astrolabe = 1) then gosub ASTROLABE_TIMER
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     if ("$guild" = "Moon Mage") then gosub WEATHER_TIMER
     if ("$guild" = "Ranger") then gosub HUNT_TIMER
     if ("$guild" = "Trader") then gosub TESSERA_TIMER
     if (!matchre("$guild", "(Ranger|Necromancer|Barbarian)") && (%Research.Active = 0)) then gosub BUFF_TIMER
     if matchre("$guild", "%MAGICUSER") then gosub PERCEIVE_TIMER
     if (($UC_Crystal = 1) && ($concentration > 95)) then gosub CRYSTAL_TIMER
     if (%HaveAnloral = 1) then gosub ANLORAL_TIMER
     if ($UC_Textbook = 1) then gosub TEXTBOOK_TIMER
     if ($UC_RunicTattoo = 1) then gosub RUNIC_TIMER
     if (($UC_Textbook = 1) && (%TextbookLast > 160) && (%Research.Active = 0) && ($Scholarship.LearningRate < 34)) then
          {
               pause 0.2
               if (!matchre("$righthand $lefthand", "(?i)%TEXTBOOK.TYPE") && (%NecroHealing = 0)) then gosub GET my %TEXTBOOK.TYPE
               if matchre("$righthand $lefthand", "(?i)%TEXTBOOK.TYPE") then gosub TEXTBOOK_READ once
               pause 0.5
               if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub PUT put %TEXTBOOK.TYPE in my $UC_Container.Textbook
               if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub STOW my %TEXTBOOK.TYPE
          }
     action (buffs) on
     gosub CLEAR_MATCHTABLE
     return
     ####
################################################################################################################################################
#### Melee Weapons
####
PRETRAIN:
     var LAST TRAIN_MONSTERCOUNT
     var LOCATION TRAIN_MONSTERCOUNT
     var CURRENT MELEE
     delay 0.0001
     var LEARNING $1
     var WEAPON $2
     # put #var UC_WeaponType $3
     eval WEAPON toupper("%WEAPON")
     var Empath.Brawl 0
     var switchloop 0
     timer stop
     timer clear
     var ATTACKNUMBER 0
     var ranged 0
     var melee 1
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then gosub STAND
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if (!matchre("$righthand", "Empty") && !matchre("$righthand", "(?i)(%WM.Weapon|%WEAPON)")) then gosub STOWIT $righthandnoun
     if (!matchre("$lefthand", "Empty") && !contains("$lefthand", "(?i)%WM.Weapon")) then gosub STOWIT $lefthandnoun
     put #echo >Log LightSeaGreen *** Switched Training to %LEARNING
     echo
     echo ########################
     echo ########################
     echo *** Training: %WEAPON_EXP
     echo *** Weapon: %WEAPON
     echo ########################
     echo ########################
     echo
     pause 0.00001
     gosub STATUSBAR
     timer start
     if (($UC_Armor.Noob = 1) && ($UC_TrainStealth = 1)) then gosub REMOVE_PLATE
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     # debuglevel 10
     if (!matchre("$righthand", "Empty") && !matchre("$righthand", "(?i)(%WM.Weapon|%WEAPON)")) then gosub STOWIT $righthandnoun
     if (!matchre("$lefthand", "Empty") && !matchre("$lefthand", "(?i)(%WM.Weapon|%ALTWEAPON)")) then gosub STOWIT $lefthandnoun
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub STOW my %TEXTBOOK.TYPE
     # debuglevel 0
     if ($UC_Shield = 0) then
          {
               gosub GET my $UC_MyShield
               gosub WEAR $UC_MyShield
          }
     if (($UC_SummonWeapons = 1) && (%summoning = 1)) then
          {
               if (!contains("$righthand $lefthand", "%WM.Weapon") && (%Foci.Active = 0)) then gosub SUMMON_WEAPON %Type
          }
     if (!matchre("%WEAPON", "($charactername|NULL|null)") && !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0)) then gosub WIELD %WEAPON
     pause 0.0001
     pause 0.0001
     ### SWAPPABLE WEAPON CHECK
     if !matchre("%WEAPON", "$charactername|NULL|null") then
          {
               gosub GLANCE
               pause 0.1
               if (matchre("%hand.1", "(?i)$UC_ALLSWAPPABLE") || matchre("$righthand", "(?i)$UC_ALLSWAPPABLE")) then
                    {
                         if !matchre("$UC_swappable-state", "%LEARNING") then gosub SWAPPABLE
                    }
          }
     gosub STANCE_SETUP
     gosub PRETRAINCHECK
     gosub DARK_CHECK
TRAIN_MONSTERCOUNT:
     delay 0.0001
     action (retreat) on
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then gosub BORED
     if ($monstercount < $UC_MaxMonsters) then gosub PREBRAWLDANCE
     if ("$guild" = "Empath") then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then gosub ASSESS
               if (matchre("$monsterlist", "(?i)%Undead") && ($SpellTimer.Absolution.duration < 2) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (matchre("%facing", "%Undead") && (%ABSOLUTION = 0) && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) then goto PREEMPATHBRAWLING
          }
     if !matchre("%TMFoci", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub TM_FOCI_CHECK
     pause 0.00001
     if matchre("$roomobjs", "bronze leucro") then
          {
               action var LeucroAction $1 when You believe you could (.*) out of the way of the leucro, if you act quickly enough.
          }
     if ($UC_DualWield = 1) then gosub DW_CHECK
TRAIN:
     pause 0.00001
     var CURRENT MELEE
     gosub STATUSBAR
     action (retreat) on
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then gosub STAND
     gosub PRETRAIN_TIMERS
     if (("$guild" = "Necromancer") && (%NecroHealing = 1)) then
          {
               gosub BLEEDERCHECK
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto DONE_NECROHEALING
          }
     # if (!contains("%CRITTER.ROOMS", "$roomid") && !matchre(%FIGHTING.CRITTER, "(?i)brocket deer|Supple Firecats|Atik'ets T2|Blue Belly Crocodiles|Golden Scaled Atik'ets|Tan Westanuryn")) then gosub AUTOMOVE %COMBAT.ROOM
     # if !contains("$righthand $lefthand", "(?i)%WEAPON") && (%Foci.Active = 0) && !matchre("%WEAPON", "(?i)($charactername|NULL)") then gosub WIELD %WEAPON
     if (!matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0) && !matchre("%WEAPON", "(?i)($charactername|NULL)")) then
          {
               gosub WIELD %WEAPON
               if !matchre("%WEAPON", "$charactername|NULL|null") then
               {
                    gosub GLANCE
                    pause 0.01
                    if (matchre("%hand.1", "(?i)$UC_ALLSWAPPABLE") || matchre("$righthand", "(?i)$UC_ALLSWAPPABLE")) then
                         {
                              if !matchre("$UC_swappable-state", "%LEARNING") then gosub SWAPPABLE
                         }
               }
          }
     pause 0.0001
     if (!matchre("$UC_WeaponType","(OFFHAND|THE|THB|POLEARMS|STAVES|CROSSBOW|SLINGS|BOW)") && ($UC_AlternateWeapon = 1) && ("$lefthand" = "Empty") && ("%ALTWEAPON" != "%WEAPON") && (%Foci.Active = 0)) then
          {
               gosub ALTWEAPON_TIMER
               gosub WIELD_LEFT %ALTWEAPON
          }
     if (($UC_AlternateWeapon = 1) && ("$righthand" = "Empty") && ("$UC_WeaponType" = "OFFHAND") && ("%ALTWEAPON" != "%WEAPON") && (%Foci.Active = 0) && !matchre("$UC_WeaponType","(?i)^(OFFHAND|THE|THB|POLEARMS|STAVES|CROSSBOW|SLINGS|BOW)")) then
          {
               gosub ALTWEAPON_TIMER
               gosub WIELD %ALTWEAPON
          }
     if (("$guild" = "Barbarian") && ($UC_DualWield = 1) && ("$lefthand" = "Empty") && !matchre("$UC_WeaponType","(OFFHAND|THE|THB|POLEARMS|STAVES|CROSSBOW|SLINGS|BOW|POLEARMS)")) then gosub WIELD_LEFT %CurrentDW
     pause 0.00001
     if (($UC_ArmWorn = 0) && !contains("$righthand $lefthand", "$UC_MyShield") && !matchre("$UC_WeaponType","(OFFHAND|THE|THB|POLEARMS|CROSSBOW|SLINGS|BOW)")) then gosub SHIELD_CHECK
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if ("$guild" = "Moon Mage") then
          {
               if (($Astrology.LearningRate < 34) && (%Observe = 1)) then gosub OBSERVE_CHECK
          }
     if (!matchre("$righthand", "(?i)%WEAPON") && matchre("$righthand", "%RANGED.BOW") && (%Foci.Active = 0)) then gosub STOWIT %righthand
     if (!matchre("$righthand", "(?i)%WEAPON") && matchre("$righthand", "%RANGED.CROSSBOW") && (%Foci.Active = 0)) then gosub STOWIT %righthand
     if (!matchre("$righthand", "(?i)%WEAPON") && matchre("$righthand", "%RANGED.SLING") && (%Foci.Active = 0)) then gosub STOWIT %righthand
     pause 0.00001
     if ($standing = 0) then gosub STAND
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub BUFF_TIMER
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (%GemsFull = 1) then gosub GEM_DUMP
     pause 0.00001
     if ((("$guild" = "Empath") && ($UC_ConstructOnly = 1)) || (%newdead)) then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
          }
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto TRAINXP
     if (("$guild" = "Empath") && !matchre("$monsterlist", "%nomanipulate") && ($monstercount > 1)) then gosub MANIP_TIMER
TRAIN_2:
     var CURRENT MELEE
     gosub STATUSBAR
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (%newdead) then gosub FACE_NEXT
     if (matchre("$monsterlist", "%ubermonster") && ("$guild" != "Empath")) then put face %ubermonster
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if (%Melee.Range) then gosub ADVANCE
     action (retreat) off
     if ($standing = 0) then gosub STAND
     gosub PRETRAIN_TIMERS
     if ("$guild" = "Barbarian") then
     {
          if ($Expertise.LearningRate < 30) then gosub BARB_EXPERTISE
          if ($UC_DualWield = 1) then gosub DW_CHECK
     }
     if (($UC_Tactics = 1) && ($Tactics.LearningRate < 33)) then gosub TACTICS-START
     if ($standing = 0) then gosub STAND
     if ("$guild" = "Empath") then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then gosub ASSESS
               if (matchre("$monsterlist", "(?i)%Undead") && ($SpellTimer.Absolution.duration < 2) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (!matchre("$monsterlist", "(%Undead|%Construct)") && ("$monsterlist" != "") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("%facing", "%Undead") && (%ABSOLUTION = 0) && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) then goto PREEMPATHBRAWLING
          }
     if (("$guild" = "Paladin") && (%ATTACKNUMBER > 2)) then gosub SMITE_CHECK
     if matchre("%APPRAISE", "(?i)(ON|1|YES)") then gosub APPRAISE_TIMER
     if ("$guild" = "Thief") then gosub DEBILITATE
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then gosub TRAINXP
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub STOW my %TEXTBOOK.TYPE
     # if !contains("$righthand $lefthand", "%WEAPON") && (%Foci.Active = 0) && !matchre("%WEAPON", "(?i)($charactername|NULL)") then gosub WIELD %WEAPON
     if (!matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0) && !matchre("%WEAPON", "(?i)($charactername|NULL)")) then gosub WIELD %WEAPON
     if (!matchre("$lefthand", "(?i)%WEAPON_NOUN") && matchre("$righthand", "(?i)%WEAPON_NOUN") && ("$UC_WeaponType" = "OFFHAND")) then gosub SWAP
     if (!matchre("$righthand", "(?i)%WEAPON_NOUN") && ("$righthand" = "Empty") && !matchre("$UC_WeaponType","(?i)(OFFHAND|THE|THB|POLEARMS|STAVES)") && (%Foci.Active = 0)) then gosub SWAP
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then goto TRAIN_MONSTERCOUNT
     if ($standing = 0) then gosub STAND
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto TRAINXP
     if (!matchre("$UC_WeaponType","(OFFHAND|THE|THB|POLEARMS|STAVES|CROSSBOW|SLINGS|BOW)") && ($UC_AlternateWeapon = 1) && ("$lefthand" = "Empty") && (%Foci.Active = 0) && !matchre("%ALTWEAPON", "(?i)%WEAPON_NOUN")) then gosub WIELD_LEFT %ALTWEAPON
     if (!matchre("$UC_WeaponType","(OFFHAND|THE|THB|POLEARMS|STAVES|CROSSBOW|SLINGS|BOW)") && ($UC_AlternateWeapon = 1) && ("$righthand" = "Empty") && ("$UC_WeaponType" = "OFFHAND") && (%Foci.Active = 0) && !matchre("%ALTWEAPON", "(?i)%WEAPON_NOUN")) then gosub WIELD %ALTWEAPON
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if (contains("$lefthand", "(?i)%WEAPON_NOUN") && ("$UC_WeaponType" != "OFFHAND")) then gosub SWAP
     if ((($Stealth.LearningRate < 29) && ($UC_TrainStealth = 1) && (%Backtraining = 0)) || (($Stealth.LearningRate < 29) && ($UC_Backtrain.Stealth = 1) && (%Backtraining = 1))) then gosub STEALTH-HIDECHECK
     if (%maneuverLast > 300) then gosub MANEUVER_GO
     if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty") && (%doubleStrikeLast > 300)) then gosub DOUBLESTRIKE_GO
     if (("$UC_WeaponType" = "OFFHAND") || (!matchre("%ALTWEAPON1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%Foci.Active = 0) && (%Backtraining = 0)) then gosub PUT attack left
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto TRAINXP
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if (!matchre("$righthand", "Empty") && (%Foci.Active = 0)) then gosub ATTACK
     math ATTACKNUMBER add 1
     pause 0.0001
     gosub STATUSBAR
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto TRAINXP
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto TRAINXP
     if ("$UC_WeaponType" = "OFFHAND") then gosub PUT attack left
     if (!matchre("$righthand", "Empty") && (%Foci.Active = 0)) then gosub ATTACK
     math ATTACKNUMBER add 1
     pause 0.0001
     if ($standing = 0) then gosub STAND
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto TRAINXP
     if ((%Germish.Alert = 1) && ("$roomplayers" != "")) then gosub MOVE_ROOMS
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if ("$UC_WeaponType" = "OFFHAND") then gosub PUT attack left
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto TRAINXP
     if (!matchre("$righthand", "Empty") && (%Foci.Active = 0)) then gosub ATTACK
     math ATTACKNUMBER add 1
     pause 0.0001
     if (("$guild" = "Paladin") && (%ATTACKNUMBER > 2)) then gosub SMITE_CHECK
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto TRAINXP
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if (("$UC_WeaponType" = "OFFHAND") || (!matchre("%ALTWEAPON1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%Foci.Active = 0) && (%Backtraining = 0)) then gosub PUT attack left
     if (!matchre("$righthand", "Empty") && (%Foci.Active = 0)) then gosub ATTACK
     math ATTACKNUMBER add 1
     pause 0.0001
     gosub STATUSBAR
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto TRAINXP
     if ("$UC_WeaponType" = "OFFHAND") then gosub PUT attack left
     if (!matchre("$righthand", "Empty") && (%Foci.Active = 0)) then gosub ATTACK
     math ATTACKNUMBER add 1
     pause 0.0001
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto TRAINXP
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto TRAINXP
     if ("$UC_WeaponType" = "OFFHAND") then gosub PUT attack left
     if (!matchre("$righthand", "Empty") && (%Foci.Active = 0)) then gosub ATTACK
     math ATTACKNUMBER add 1
     pause 0.0001
     gosub STATUSBAR
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto TRAINXP
     if (%Foci.Active = 1) then
          {
               evalmath FociTime ($gametime - %FociStart)
               if (%FociTime > 250) then gosub TM_FOCI_END
          }
TRAINXP:
     delay 0.0001
     gosub STATUSBAR
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (%ATTACKNUMBER > 8) then var ATTACKNUMBER 0
     gosub EMPATH_CONSTRUCT_CHECK
     gosub COMBAT_TIMER
     if ($UC_Ammo = 1) then gosub stowammo
     if ($UC_bundleFull = 1) then goto COMBAT_RETURN
     if ($UC_bagsFull = 1) then goto COMBAT_RETURN
     if (($%LEARNING.LearningRate < 1) && (%t > 420) && (%Foci.Active = 0) && (%Backtraining = 0) && ($UC_WeaponLearn = 1)) then goto NOT_LEARNING_WEAPON
     if ($%LEARNING.LearningRate > %MAX.LEARNINGRATE) then goto COMBAT_RETURN
     if (%t > %MAX.TIME) then goto COMBAT_RETURN
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if ((%High.Switch = 1) && (%NecroHealing = 0) && !matchre("$monsterlist", "%ubermonster")) then goto COMBAT_RETURN
     if (("$guild" = "Necromancer") && (%NecroHealing = 1)) then
          {
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto DONE_NECROHEALING
          }
     goto TRAIN_MONSTERCOUNT
##########################################################################
#### Single Thrown Weapons
##########################################################################
SINGLEPRETHROWNTRAIN:
     action goto BLESS_IT when ^Your ((?!frigid |blast |electric |flaming ).+)passes through the .+ with no effect
     var LAST SINGLETHROWTRAIN_MONSTERCOUNT
     var LOCATION SINGLETHROWTRAIN_MONSTERCOUNT
     var CURRENT THROWN
     delay 0.0001
     timer stop
     timer clear
     var Empath.Brawl 0
     var switchloop 0
     var LEARNING $1
     var WEAPON $2
     eval WEAPON toupper("%WEAPON")
     # put #var UC_WeaponType $3
     var ATTACKNUMBER 0
     var ranged 1
     var melee 0
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then gosub STAND
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (!matchre("$righthand", "Empty") && !contains("$righthand", "%WM.Weapon")) then gosub STOW $righthandnoun
     if (!matchre("$lefthand", "Empty") && !contains("$lefthand", "%WM.Weapon")) then gosub STOW $lefthandnoun
     gosub stowing
     put #echo >Log LightSeaGreen *** Switched Training to %LEARNING
     echo
     echo ######################
     echo ######################
     echo *** Training: %WEAPON_EXP
     echo *** Weapon: %WEAPON
     echo ######################
     echo ######################
     echo
     pause 0.1
     var CURRENT THROWN
     gosub STATUSBAR
     if (!matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0) && !matchre("%WEAPON", "(?i)($charactername|NULL)")) then gosub WIELD %WEAPON
     gosub STANCE_SETUP
     gosub PRETRAINCHECK
     gosub DARK_CHECK
     timer start
     if (($UC_Armor.Noob = 1) && ($UC_TrainStealth = 1)) then gosub REMOVE_PLATE
     # if !contains("$righthand $lefthand", "(?i)%WEAPON") && (%Foci.Active = 0) && !matchre("%WEAPON", "(?i)($charactername|NULL)") then gosub WIELD %WEAPON
     # if ("$guild" = "Thief") then gosub KHRI
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     goto SINGLETHROWTRAIN
SINGLETHROWTRAIN_MONSTERCOUNT:
     delay 0.0001
     pause 0.001
     gosub ASSESS
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then gosub BORED
     if ($monstercount < $UC_MaxMonsters) then gosub PREBRAWLDANCE
     pause 0.0001
     if matchre("$lefthand", "Empty") then gosub STOWIT left
     if !matchre("$righthand", "(?i)(Empty|%WEAPON)") then gosub STOWIT right
     pause 0.0001
     if matchre("$roomobjs", "\b(?<!pike |pitted bronze |[Rr]usted |rusty |spindly short |dull iron |battered |beaten )(%MYWEAPONS)(?!(\-toothed| bolt| arrow| shard| stuck in the ground))\b") then
          {
               gosub STOWIT $1
          }
     if (!matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0) && !matchre("%WEAPON", "(?i)($charactername|NULL)")) then gosub WIELD %WEAPON
     if !matchre("%WEAPON", "$charactername|NULL|null") then
          {
               gosub GLANCE
               if matchre("%hand.1", "(?i)$UC_ALLSWAPPABLE") then
                    {
                         if !matchre("$UC_swappable-state", "%LEARNING") then gosub SWAPPABLE
                    }
          }
     if (($UC_ArmWorn = 0) && !contains("$righthand $lefthand", "$UC_MyShield") && !matchre("$UC_WeaponType","(OFFHAND|THE|THB|POLEARMS|CROSSBOW|SLINGS|BOW)")) then gosub SHIELD_CHECK
     if matchre("$roomobjs", "bronze leucro") then
          {
               action var LeucroAction $1 when You believe you could (.*) out of the way of the leucro, if you act quickly enough.
          }
SINGLETHROWTRAIN:
     delay 0.0001
     gosub STATUSBAR
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then gosub STAND
     gosub PRETRAIN_TIMERS
     if ("$guild" = "Empath") then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then gosub ASSESS
               if (matchre("$monsterlist", "(?i)%Undead") && ($SpellTimer.Absolution.duration < 2) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (!matchre("$monsterlist", "(%Undead|%Construct)") && ("$monsterlist" != "") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("%facing", "%Undead") && (%ABSOLUTION = 0) && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) then goto PREEMPATHBRAWLING
          }
SINGLETHROWTRAIN_1:
     if (("$guild" = "Necromancer") && (%NecroHealing = 1)) then
          {
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto DONE_NECROHEALING
          }
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub BUFF_TIMER
     if ("$guild" = "Moon Mage") then
          {
               if (($Astrology.LearningRate < 34) && (%Observe = 1)) then gosub OBSERVE_CHECK
          }
     if (%GemsFull = 1) then gosub GEM_DUMP
     # if (!contains("%CRITTER.ROOMS", "$roomid") && !matchre(%FIGHTING.CRITTER, "(?i)brocket deer|Supple Firecats|Atik'ets T2|Blue Belly Crocodiles|Golden Scaled Atik'ets|Tan Westanuryn")) then gosub AUTOMOVE %COMBAT.ROOM
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then goto SINGLETHROWTRAIN_MONSTERCOUNT
     if ((("$guild" = "Empath") && ($UC_ConstructOnly = 1)) || (%newdead)) then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
          }
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto SINGLETHROWTRAINXP
     if (("$guild" = "Empath") && !matchre("$monsterlist", "%nomanipulate") && ($monstercount > 1)) then gosub MANIP_TIMER
     # if (($UC_Tactics = 1) && ($Tactics.LearningRate < 33)) then gosub TACTICS-START
SINGLETHROWTRAIN_2:
     pause 0.0001
     gosub STATUSBAR
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then gosub STAND
     if matchre("$guild", "%MAGICUSER") then gosub CAST_TIMER
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub STOW my %TEXTBOOK.TYPE
     if ("$guild" = "Empath") then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then gosub ASSESS
               if (matchre("$monsterlist", "(?i)%Undead") && ($SpellTimer.Absolution.duration < 2) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (!matchre("$monsterlist", "(%Undead|%Construct)") && ("$monsterlist" != "") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("%facing", "%Undead") && (%ABSOLUTION = 0) && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) then goto PREEMPATHBRAWLING
          }
     # if matchre("$roomobjs", "(?i)%WEAPON") then gosub GET %WEAPON
     # if !contains("(?i)%WEAPON", "$righthandnoun $lefthandnoun") then gosub GET_IT my %WEAPON
     if (!matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0)) then gosub WIELD %WEAPON
     # if (%newdead) then gosub FACE_NEXT
     gosub PRETRAIN_TIMERS
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (matchre("$monsterlist", "%ubermonster") && ("$guild" != "Empath")) then put face %ubermonster
     if (("$guild" = "Paladin") && (%ATTACKNUMBER > 2)) then gosub SMITE_CHECK
     if ((($Stealth.LearningRate < 30) && ($UC_TrainStealth = 1) && (%Backtraining = 0)) || (($Stealth.LearningRate < 30) && ($UC_Backtrain.Stealth = 1) && (%Backtraining = 1))) then gosub STEALTH-HIDECHECK
     if ("$guild" = "Thief") then gosub DEBILITATE
     # if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub GET_IT my %WEAPON
     if (!matchre("%WEAPON", "($charactername|NULL|null)") && !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0)) then gosub GET_IT my %WEAPON
     if (("$guild" = "Necromancer") && (%NoHands = 1)) then goto PREBRAWLING
     pause 0.0001
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if (matchre("$righthand", "(?i)%WEAPON") && ($UC_OffhandThrow = 1) && ($Offhand_Weapon.LearningRate <= 30) && !matchre("%WEAPON", "(?i)$UC_ALLSWAPPABLE")) then gosub SWAP
     if ((matchre("$lefthand", "(?i)%WEAPON") && ($UC_OffhandThrow = 0)) || (matchre("$lefthand", "(?i)%WEAPON") && ($Offhand_Weapon.LearningRate > 30))) then gosub SWAP
     if matchre("$righthand", "(?i)%WEAPON_NOUN") then gosub PUT %ThrowType
     if (!matchre("$righthand", "(?i)%WEAPON_NOUN") && matchre("$lefthand", "(?i)%WEAPON_NOUN")) then gosub PUT %ThrowType left
     # if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub GET_IT my %WEAPON
     if (!matchre("%WEAPON", "($charactername|NULL|null)") && !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0)) then gosub GET_IT my %WEAPON
     math ATTACKNUMBER add 1
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto SINGLETHROWTRAINXP
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     # if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub GET_IT my %WEAPON
     if (!matchre("%WEAPON", "($charactername|NULL|null)") && !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0)) then gosub GET_IT my %WEAPON
     if matchre("$lefthand", "(?i)%WEAPON_NOUN") then gosub SWAP
     if ("$guild" = "Empath") then
          {
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
          }
     if matchre("$righthand", "(?i)%WEAPON_NOUN") then gosub PUT %ThrowType
     if (!matchre("$righthand", "(?i)%WEAPON_NOUN") && matchre("$lefthand", "(?i)%WEAPON_NOUN")) then gosub PUT %ThrowType left
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto SINGLETHROWTRAINXP
     math ATTACKNUMBER add 1
     gosub STATUSBAR
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ((%Germish.Alert = 1) && ("$roomplayers" != "")) then gosub MOVE_ROOMS
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     # if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub GET_IT my %WEAPON
     if (!matchre("%WEAPON", "($charactername|NULL|null)") && !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0)) then gosub GET_IT my %WEAPON
     if (("$guild" = "Empath") then
          {
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
          }
     if matchre("$lefthand", "(?i)%WEAPON") then gosub SWAP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto SINGLETHROWTRAINXP
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto SINGLETHROWTRAINXP
     pause 0.0001
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if matchre("$righthand", "(?i)%WEAPON_NOUN") then gosub PUT %ThrowType
     elseif (!matchre("$righthand", "(?i)%WEAPON_NOUN") && matchre("$lefthand", "(?i)%WEAPON_NOUN")) then gosub PUT %ThrowType left
     # if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub GET_IT my %WEAPON
     if (!matchre("%WEAPON", "($charactername|NULL|null)") && !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0)) then gosub GET_IT my %WEAPON
     if (("$guild" = "Necromancer") && (%NoHands = 1)) then goto PREBRAWLING
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto SINGLETHROWTRAINXP
     math ATTACKNUMBER add 1
     gosub STATUSBAR
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$roomobjs", "(?i)%WEAPON_NOUN") then gosub GET_IT my %WEAPON
     if (matchre("$righthand", "(?i)%WEAPON") && ($UC_OffhandThrow = 1) && ($Offhand_Weapon.LearningRate <= 30) && !matchre("%WEAPON", "(?i)$UC_ALLSWAPPABLE")) then gosub SWAP
     if ((matchre("$lefthand", "(?i)%WEAPON") && ($UC_OffhandThrow = 0)) || (matchre("$lefthand", "(?i)%WEAPON") && ($Offhand_Weapon.LearningRate > 30))) then gosub SWAP
     if ("$guild" = "Empath") then
          {
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
          }
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto SINGLETHROWTRAINXP
     if matchre("$righthand", "(?i)%WEAPON_NOUN") then gosub PUT %ThrowType
     if (!matchre("$righthand", "(?i)%WEAPON_NOUN") && matchre("$lefthand", "(?i)%WEAPON")) then gosub PUT %ThrowType left
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto SINGLETHROWTRAINXP
     math ATTACKNUMBER add 1
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     # if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub GET_IT my %WEAPON
     if (!matchre("%WEAPON", "($charactername|NULL|null)") && !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0)) then gosub GET_IT my %WEAPON
     if (("$guild" = "Necromancer") && (%NoHands = 1)) then goto PREBRAWLING
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto SINGLETHROWTRAINXP
     # if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub GET_IT my %WEAPON
     if (!matchre("%WEAPON", "($charactername|NULL|null)") && !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0)) then gosub GET_IT my %WEAPON
     if (("$guild" = "Necromancer") && (%NoHands = 1)) then goto PREBRAWLING
     if matchre("$lefthand", "(?i)%WEAPON") then gosub SWAP
     if ("$guild" = "Empath") then
          {
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
          }
     if matchre("$righthand", "(?i)%WEAPON_NOUN") then gosub PUT %ThrowType
     if (!matchre("$righthand", "(?i)%WEAPON_NOUN") && matchre("$lefthand", "(?i)%WEAPON_NOUN")) then gosub PUT %ThrowType left
     math ATTACKNUMBER add 1
     gosub STATUSBAR
     # if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub GET_IT my %WEAPON
     if (!matchre("%WEAPON", "($charactername|NULL|null)") && !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0)) then gosub GET_IT my %WEAPON
     if (("$guild" = "Necromancer") && (%NoHands = 1)) then goto PREBRAWLING
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if ($UC_Ammo = 1) then gosub stowammo
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto SINGLETHROWTRAINXP
     if (%ATTACKNUMBER > 3) then goto SINGLETHROWTRAINXP
     if (%Foci.Active = 1) then
          {
               evalmath FociTime ($gametime - %FociStart)
               if (%FociTime > 250) then gosub TM_FOCI_END
          }
SINGLETHROWTRAINXP:
     delay 0.0001
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (%ATTACKNUMBER > 8) then var ATTACKNUMBER 0
     if (%Foci.Active = 1) then
          {
               evalmath FociTime ($gametime - %FociStart)
               if (%FociTime > 250) then gosub TM_FOCI_END
          }
     gosub EMPATH_CONSTRUCT_CHECK
     gosub COMBAT_TIMER
     gosub STATUSBAR
     if ($UC_Ammo = 1) then gosub stowammo
     if ($UC_bagsFull = 1) then goto COMBAT_RETURN
     if ($UC_bundleFull = 1) then goto COMBAT_RETURN
     if (($%LEARNING.LearningRate < 1) && (%t > 420) && (%Foci.Active = 0) && (%Backtraining = 0) && ($UC_WeaponLearn = 1)) then goto NOT_LEARNING_WEAPON
     if ($%LEARNING.LearningRate > %MAX.LEARNINGRATE) then goto COMBAT_RETURN
     if (%t > %MAX.TIME) then goto COMBAT_RETURN
     if ((%High.Switch = 1) && (%NecroHealing = 0) && !matchre("$monsterlist", "%ubermonster")) then goto COMBAT_RETURN
     goto SINGLETHROWTRAIN_MONSTERCOUNT
##########################################################################
#### Ambush Routine
##########################################################################
PREAMBUSHTRAIN:
     var LAST AMBUSHTRAIN_MONSTERCOUNT
     var LOCATION AMBUSHTRAIN_MONSTERCOUNT
     var CURRENT AMBUSH
     delay 0.0001
     timer stop
     timer clear
     var Empath.Brawl 0
     var switchloop 0
     var LEARNING $1
     var WEAPON $2
     eval WEAPON toupper("%WEAPON")
     # put #var UC_WeaponType $3
     var ATTACKNUMBER 0
     var melee 1
     var ranged 0
     gosub stowing
     put #echo >Log LightSeaGreen *** Switched Training to %LEARNING
     echo
     echo ########################
     echo ########################
     echo *** Training: %WEAPON_EXP
     echo *** Weapon: %WEAPON
     echo ########################
     echo ########################
     echo
     pause 0.1
     if !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") then gosub WIELD %WEAPON
     gosub STANCE_SETUP
     var CURRENT AMBUSH
     gosub STATUSBAR
     gosub PRETRAINCHECK
     gosub DARK_CHECK
     timer start
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then gosub stowing
     if ($UC_Armor.Noob = 1) then gosub REMOVE_PLATE
     if !matchre("%WEAPON", "(?i)($charactername|NULL)") then gosub WIELD %WEAPON
     if ($UC_Shield = 0) then send get my $UC_MyShield
     if ($UC_Shield = 0) then gosub WEAR $UC_MyShield
AMBUSHTRAIN_MONSTERCOUNT:
     delay 0.0001
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then gosub BORED
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub BUFF_TIMER
     if ($monstercount < $UC_MaxMonsters) then gosub PREBRAWLDANCE
     if matchre("$roomobjs", "bronze leucro") then
          {
               action var LeucroAction $1 when You believe you could (.*) out of the way of the leucro, if you act quickly enough.
          }
AMBUSHTRAIN:
     delay 0.0001
     action (retreat) on
     if ($standing = 0) then gosub STAND
     if (%GemsFull = 1) then gosub GEM_DUMP
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then goto AMBUSHTRAIN_MONSTERCOUNT
     if ($stamina < 65) then gosub STAMINA_WAIT
     if !contains("$righthand $lefthand", "(?i)%WEAPON_NOUN") then
          {
               gosub stowing
               if !matchre("%WEAPON", "(?i)($charactername|NULL)") then gosub WIELD %WEAPON
          }
     if !matchre("$UC_WeaponType","^(OFFHAND|THE|THB|POLEARMS|STAVES|CROSSBOW|SLINGS|BOW)") && ($UC_AlternateWeapon = 1) && ("$lefthand" = "Empty") && ("%ALTWEAPON" != "%WEAPON") && (%Foci.Active = 0) then
          {
               gosub ALTWEAPON_TIMER
               gosub WIELD_LEFT %ALTWEAPON
          }
     if (($UC_ArmWorn = 0) && !contains("$righthand $lefthand", "$UC_MyShield") && !matchre("$UC_WeaponType","(OFFHAND|THE|THB|POLEARMS|CROSSBOW|SLINGS|BOW)")) then gosub SHIELD_CHECK
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub BUFF_TIMER
     if ((("$guild" = "Empath") && ($UC_ConstructOnly = 1)) || (%newdead)) then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
          }
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto AMBUSHTRAINXP
     if (("$guild" = "Empath") && !matchre("$monsterlist", "%nomanipulate") && ($monstercount > 1)) then gosub MANIP_TIMER
     if ("$guild" = "Empath") then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then gosub ASSESS
               if (matchre("$monsterlist", "(?i)%Undead") && ($SpellTimer.Absolution.duration < 2) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (!matchre("$monsterlist", "(%Undead|%Construct)") && ("$monsterlist" != "") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("%facing", "%Undead") && (%ABSOLUTION = 0) && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) then goto PREEMPATHBRAWLING
          }
AMBUSHTRAIN_2:
     gosub STATUSBAR
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (%newdead) then gosub FACE_NEXT
     if (matchre("$monsterlist", "%ubermonster") && ("$guild" != "Empath")) then put face %ubermonster
     if (!%Melee.Range) then gosub ADVANCE
     action (retreat) off
     gosub PRETRAIN_TIMERS
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if ("$guild" = "Barbarian") then
          {
               if ($Expertise.LearningRate < 29) then gosub BARB_EXPERTISE
          }
     if ("$guild" = "Thief") then gosub DEBILITATE
     if (("$guild" = "Paladin") && (%ATTACKNUMBER > 2)) then gosub SMITE_CHECK
     if (($UC_Tactics = 1) && ($Tactics.LearningRate < 33)) then gosub TACTICS-START
     if ($hidden = 0) then gosub STEALTH-HIDECHECK
     gosub FEINTLEFTEYE
     math ATTACKNUMBER add 1
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if ($hidden = 0) then gosub STEALTH-HIDECHECK
     gosub FEINTLEFTEYE
     math ATTACKNUMBER add 1
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub STATUSBAR
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto AMBUSHTRAINXP
     if (%ATTACKNUMBER > 3) then goto AMBUSHTRAINXP
     else goto AMBUSHTRAIN
AMBUSHTRAINXP:
     delay 0.0001
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (("$guild" = "Barbarian") && (%ATTACKNUMBER > 3)) then gosub ROAR_TIMER
     if (%ATTACKNUMBER > 8) then var ATTACKNUMBER 0
     gosub COMBAT_TIMER
     gosub STATUSBAR
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if ($UC_bagsFull = 1) then goto COMBAT_RETURN
     if ($UC_bundleFull = 1) then goto COMBAT_RETURN
     if ($%LEARNING.LearningRate > %MAX.LEARNINGRATE) then goto COMBAT_RETURN
     if (%t > %MAX.TIME) then goto COMBAT_RETURN
     if ((%High.Switch = 1) && (%NecroHealing = 0) && !matchre("$monsterlist", "%ubermonster")) then goto COMBAT_RETURN
     goto AMBUSHTRAIN_MONSTERCOUNT
##########################################################################
#### Backstab Routine
##########################################################################
PREBACKSTABTRAIN:
     var LAST BACKSTABTRAIN_MONSTERCOUNT
     var LOCATION BACKSTABTRAIN_MONSTERCOUNT
     var CURRENT BACKSTAB
     delay 0.0001
     timer stop
     timer clear
     var Empath.Brawl 0
     var switchloop 0
     var LEARNING $1
     var WEAPON $2
     eval WEAPON toupper("%WEAPON")
     # put #var UC_WeaponType $3
     var ATTACKNUMBER 0
     var melee 1
     var ranged 0
     put #echo >Log LightSeaGreen *** Switched Training to %LEARNING
     echo
     echo ########################
     echo ########################
     echo *** Training: %WEAPON_EXP
     echo *** Weapon: %WEAPON
     echo ########################
     echo ########################
     echo
     pause 0.1
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then gosub stowing
     if (!matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && (%Foci.Active = 0) && !matchre("%WEAPON", "(?i)($charactername|NULL)")) then gosub WIELD %WEAPON
     gosub STANCE_SETUP
     var CURRENT BACKSTAB
     gosub STATUSBAR
     gosub PRETRAINCHECK
     gosub DARK_CHECK
     timer start
     if ($UC_Armor.Noob = 1) then gosub REMOVE_PLATE
     if ($UC_Shield = 0) then send get my $UC_MyShield
     if ($UC_Shield = 0) then gosub WEAR $UC_MyShield
BACKSTABTRAIN_MONSTERCOUNT:
     delay 0.0001
     action (retreat) on
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then gosub BORED
     if (matchre("$guild", "%MAGICUSER") && ("$preparedspell" != "None")) then gosub CAST_TIMER
     if matchre("$roomobjs", "bronze leucro") then
          {
               action var LeucroAction $1 when You believe you could (.*) out of the way of the leucro, if you act quickly enough.
          }
     gosub BUFF_TIMER
BACKSTABTRAIN:
     delay 0.0001
     gosub STATUSBAR
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then gosub BORED
     if ($monstercount < $UC_MaxMonsters) then gosub PREBRAWLDANCE
     if ($standing = 0) then gosub STAND
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then goto BACKSTABTRAIN_MONSTERCOUNT
     if ($stamina < 65) then gosub STAMINA_WAIT
     if (!%Melee.Range) then gosub ADVANCE
     action (retreat) off
     gosub PRETRAIN_TIMERS
     if !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") then
          {
               gosub stowing
               gosub WIELD %WEAPON
          }
     # if !matchre("$UC_WeaponType","^(OFFHAND|THE|THB|POLEARMS|STAVES|CROSSBOW|SLINGS|BOW)") && ($UC_AlternateWeapon = 1) && ("$lefthand" = "Empty") && ("%ALTWEAPON" != "%WEAPON") && (%Foci.Active = 0) then
          # {
               # gosub ALTWEAPON_TIMER
               # gosub WIELD_LEFT %ALTWEAPON
          # }
     if matchre("$lefthand", "(?i)%WEAPON") then gosub SWAP
     if (($hidden = 0) && ($circle < 50) && ($UC_TrainStealth = 1)) then gosub STEALTH-HIDECHECK
     if ("$guild" = "Thief") && (%ATTACKNUMBER > 2) then gosub DEBILITATE
     # if ($Tactics.LearningRate < 29) then gosub TACTICS-START
     if ($hidden = 0) then gosub STEALTH-HIDECHECK
     gosub STATUSBAR
     gosub BACKSTABING
     math ATTACKNUMBER add 1
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto BACKSTABTRAINXP
     if ($hidden = 0) then gosub STEALTH-HIDECHECK
     gosub STATUSBAR
     if !matchre("$lefthand", "Empty") then gosub BACKSTABING_LEFT
     else gosub BACKSTABING
     math ATTACKNUMBER add 1
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto BACKSTABTRAINXP
     if (%ATTACKNUMBER > 3) then goto BACKSTABTRAINXP
     else goto BACKSTABTRAIN
BACKSTABTRAINXP:
     delay 0.0001
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (%ATTACKNUMBER > 8) then var ATTACKNUMBER 0
     gosub COMBAT_TIMER
     gosub STATUSBAR
     if ($UC_bagsFull = 1) then goto COMBAT_RETURN
     if ($UC_bundleFull = 1) then goto COMBAT_RETURN
     if (($%LEARNING.LearningRate < 1) && (%t > 420) && (%Foci.Active = 0) && (%Backtraining = 0) && ($UC_WeaponLearn = 1)) then goto NOT_LEARNING_WEAPON
     if ($%LEARNING.LearningRate > %MAX.LEARNINGRATE) then goto COMBAT_RETURN
     if (%t > %MAX.TIME) then goto COMBAT_RETURN
     if ((%High.Switch = 1) && (%NecroHealing = 0) && !matchre("$monsterlist", "%ubermonster")) then goto COMBAT_RETURN
     goto BACKSTABTRAIN_MONSTERCOUNT
##########################################################################
#### Ranged Weapons
##########################################################################
PRERANGEDTRAIN:
     action goto BLESS_IT when ^Your ((?!frigid |blast |electric |flaming ).+)passes through the .+ with no effect
     var LAST RANGEDTRAIN_MONSTERCOUNT
     var LOCATION RANGEDTRAIN_MONSTERCOUNT
     var CURRENT RANGED
     delay 0.0001
     action (retreat) on
     timer stop
     timer clear
     var Empath.Brawl 0
     var switchloop 0
     var ATTACKNUMBER 0
     var LEARNING $1
     var WEAPON $2
     var MAINARROW $3
     eval WEAPON toupper("%WEAPON")
     # put #var UC_WeaponType $4
     var ranged 1
     var melee 0
     # if !matchre("$righthand", "Empty") && !contains ("$righthand" , "(?i)%WEAPON") then gosub stowing
     if !matchre("$lefthand", "Empty") then gosub STOWIT left
     if (!matchre("$righthand", "Empty") && !contains("$righthand", "(?i)%WEAPON")) then gosub STOWIT right
     put #echo >Log LightSeaGreen *** Switched Training to %LEARNING
     echo
     echo ########################
     echo ########################
     echo *** Training: %WEAPON_EXP
     echo *** Weapon: %WEAPON
     echo ########################
     echo ########################
     echo
     pause 0.1
     gosub STANCE_SETUP
     if !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") then gosub WIELD %WEAPON
     gosub PRETRAINCHECK
     gosub STATUSBAR
     gosub DARK_CHECK
     timer start
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then gosub STAND
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (($UC_Armor.Noob = 1) && matchre("%WEAPON_EXP", "(?i)(CROSSBOW|BOW|SLING)") && matchre("($UC_Snipe|$UC_Poach)", "1")) then gosub REMOVE_PLATE
     if contains("$lefthand", "$UC_MyShield") then gosub STOW $UC_MyShield
     if !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") then
          {
               gosub stowing
               gosub WIELD %WEAPON
          }
RANGEDTRAIN_MONSTERCOUNT:
     delay 0.0001
     if ($UC_Retreat = 1) then
          {
               action (retreat) on
          }
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then gosub BORED
     if matchre("$roomobjs", "bronze leucro") then
          {
               action var LeucroAction $1 when You believe you could (.*) out of the way of the leucro, if you act quickly enough.
          }
RANGEDTRAIN:
     delay 0.0001
     # debuglevel 10
     action (retreat) on
     var CURRENT RANGED
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then gosub STAND
     gosub PRETRAIN_TIMERS
     if (("$guild" = "Necromancer") && (%NecroHealing = 1)) then
          {
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto DONE_NECROHEALING
          }
     if ($monstercount < $UC_MaxMonsters) then gosub PREBRAWLDANCE
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub BUFF_TIMER
     gosub RETRIEVE_CHECK
     if ("$guild" = "Barbarian") then
     {
          if (matchre("%barbEagle", "(ON|1|YES)") && ($barbEagle = 0) && ($mana > 2)) then
               {
                    put form eagle
                    pause 0.5
                    put #var barbEagle 1
               }
     }
     if (%GemsFull = 1) then gosub GEM_DUMP
     if ("$guild" = "Moon Mage") then
          {
               if (($Astrology.LearningRate < 34) && (%Observe = 1)) then gosub OBSERVE_CHECK
          }
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then goto RANGEDTRAIN_MONSTERCOUNT
     if ($stamina < 65) then gosub STAMINA_WAIT
     if ((("$guild" = "Empath") && ($UC_ConstructOnly = 1)) || (%newdead)) then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
          }
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto RANGEDTRAINXP
     if (("$guild" = "Empath") && !matchre("$monsterlist", "%nomanipulate") && ($monstercount > 1)) then gosub MANIP_TIMER
RANGEDTRAIN_2:
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then gosub STAND
     if !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") then gosub WIELD %WEAPON
     if matchre("$lefthand", "(?i)%WEAPON_NOUN") then gosub SWAP
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if ("$guild" = "Empath") then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then gosub ASSESS
               if (matchre("$monsterlist", "(?i)%Undead") && ($SpellTimer.Absolution.duration < 2) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (!matchre("$monsterlist", "(%Undead|%Construct)") && ("$monsterlist" != "") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("%facing", "%Undead") && (%ABSOLUTION = 0) && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) then goto PREEMPATHBRAWLING
          }
     if (matchre("$monsterlist", "%ubermonster") && ("$guild" != "Empath")) then put face %ubermonster
     gosub LOAD
     math ATTACKNUMBER add 1
     # if !matchre("$lefthand", "Empty") then gosub STOWIT $lefthandnoun
     gosub STATUSBAR
     gosub PRETRAIN_TIMERS
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (("$guild" = "Paladin") && (%ATTACKNUMBER > 3)) then gosub SMITE_CHECK
     if ("$guild" = "Thief") then gosub DEBILITATE
     if !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") then gosub WIELD %WEAPON
     gosub LOAD
     math ATTACKNUMBER add 1
     gosub RETRIEVE_CHECK
     if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if ((%Melee.Range = 1) && ($UC_Retreat = 1)) then gosub RETREAT
     if matchre("$lefthand", "(?i)%WEAPON") then gosub SWAP
     if (("$guild" = "Empath") then
          {
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
          }
     if !matchre("$righthand", "(?i)%WEAPON_NOUN") then gosub WIELD %WEAPON
     gosub LOAD
     math ATTACKNUMBER add 1
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto RANGEDTRAINXP
     if !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") then gosub WIELD %WEAPON
     gosub LOAD
     math ATTACKNUMBER add 1
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if (%ATTACKNUMBER > 2) then goto RANGEDTRAINXP
     if (%Foci.Active = 1) then
          {
               evalmath FociTime ($gametime - %FociStart)
               if (%FociTime > 250) then gosub TM_FOCI_END
          }
RANGEDTRAINXP:
     delay 0.0001
     # debuglevel 0
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (%ATTACKNUMBER > 8) then var ATTACKNUMBER 0
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub RETRIEVE_CHECK
     if ($UC_Ammo = 1) then gosub stowammo
     gosub COMBAT_TIMER
     gosub STATUSBAR
     if (%Foci.Active = 1) then
          {
               evalmath FociTime ($gametime - %FociStart)
               if (%FociTime > 250) then gosub TM_FOCI_END
          }
     if ($UC_bagsFull = 1) then goto COMBAT_RETURN
     if ($UC_bundleFull = 1) then goto COMBAT_RETURN
     if (($%LEARNING.LearningRate < 1) && (%t > 420) && (%Foci.Active = 0) && (%Backtraining = 0) && ($UC_WeaponLearn = 1)) then goto NOT_LEARNING_WEAPON
     if ($%LEARNING.LearningRate > %MAX.LEARNINGRATE) then goto COMBAT_RETURN
     if (%t > %MAX.TIME) then goto COMBAT_RETURN
     if (("$guild" = "Necromancer") && (%NecroHealing = 1)) then
          {
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto DONE_NECROHEALING
          }
     if (("$guild" = "Empath") then
          {
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
          }
     if ((%High.Switch = 1) && (%NecroHealing = 0) && !matchre("$monsterlist", "%ubermonster")) then goto COMBAT_RETURN
     goto RANGEDTRAIN_MONSTERCOUNT
##########################################################################
#### Brawling
##########################################################################
PREBRAWLING:
     var LAST BRAWLING_MONSTERCOUNT
     delay 0.0001
     var Empath.Brawl 0
     var switchloop 0
     var LEARNING $1
     put #var UC_WeaponType $2
     var WEAPON $UC_WEAPON_BRAWL
     eval WEAPON toupper("%WEAPON")
     var ATTACKNUMBER 0
     var melee 1
     var ranged 0
     # if ($%LEARNING.LearningRate > %MinLearnRate) then return
     put #echo >Log LightSeaGreen *** Switched Training to %LEARNING
     echo
     echo ########################
     echo ########################
     echo *** Training: %WEAPON_EXP
     echo *** Weapon: %WEAPON
     echo ########################
     echo ########################
     echo
     pause 0.1
     gosub STANCE_SETUP
     var CURRENT BRAWL
     gosub STATUSBAR
     gosub PRETRAINCHECK
     gosub DARK_CHECK
     timer stop
     timer clear
     timer start
     if ($UC_Shield = 0) then
          {
               gosub GET my $UC_MyShield
               gosub WEAR $UC_MyShield
          }
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then gosub STAND
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (($UC_Armor.Noob = 1) && ($UC_TrainStealth = 1)) then gosub REMOVE_PLATE
BRAWLING_MONSTERCOUNT:
     delay 0.0001
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then gosub BORED
     if (($UC_ArmWorn = 0) && !contains("$righthand $lefthand", "$UC_MyShield")) then gosub SHIELD_CHECK
     if matchre("$roomobjs", "bronze leucro") then
          {
               action var LeucroAction $1 when You believe you could (.*) out of the way of the leucro, if you act quickly enough.
          }
BRAWLING_1:
     delay 0.0001
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then gosub STAND
     if (("$guild" = "Necromancer") && (%NecroHealing = 1)) then
          {
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto DONE_NECROHEALING
          }
     if ($monstercount < $UC_MaxMonsters) then gosub PREBRAWLDANCE
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub BUFF_TIMER
     if (%GemsFull = 1) then gosub GEM_DUMP
     if ("$guild" = "Moon Mage") then
          {
               if (($Astrology.LearningRate < 34) && (%Observe = 1)) then gosub OBSERVE_CHECK
          }
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then goto BRAWLING_MONSTERCOUNT
     if ($stamina < 65) then gosub STAMINA_WAIT
     if ((("$guild" = "Empath") && ($UC_ConstructOnly = 1)) || (%newdead)) then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
          }
     # if ((("$guild" = "Empath") && ($UC_ConstructOnly = 1) && ("%Empath.Critter" = "NULL")) || (%newdead = 1)) then gosub ASSESS_LOOP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto BRAWLINGXP
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub STATUSBAR
     if (("$guild" = "Empath") && !matchre("$monsterlist", "%nomanipulate") && ($monstercount > 1)) then gosub MANIP_TIMER
BRAWLING_2:
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then gosub STAND
     gosub PRETRAIN_TIMERS
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if (%newdead) then gosub FACE_NEXT
     if (matchre("$monsterlist", "%ubermonster") && ("$guild" != "Empath")) then put face %ubermonster
     if (("$guild" = "Barbarian") && (%ATTACKNUMBER > 3)) then gosub ROAR_TIMER
     if ("$guild" = "Barbarian") then
          {
               if ($Expertise.LearningRate < 29) then gosub BARB_EXPERTISE
          }
     if ("$guild" = "Empath") then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then gosub ASSESS
               if (matchre("$monsterlist", "(?i)%Undead") && ($SpellTimer.Absolution.duration < 2) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (!matchre("$monsterlist", "(%Undead|%Construct)") && ("$monsterlist" != "") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("%facing", "%Undead") && (%ABSOLUTION = 0) && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) then goto PREEMPATHBRAWLING
          }
     if ("$guild" = "Thief") then gosub DEBILITATE
     if (("$guild" = "Paladin") && (%ATTACKNUMBER > 2)) then gosub SMITE_CHECK
     if ((($Stealth.LearningRate < 29) && ($UC_TrainStealth = 1) && (%Backtraining = 0)) || (($Stealth.LearningRate < 29) && ($UC_Backtrain.Stealth = 1) && (%Backtraining = 1))) then gosub STEALTH-HIDECHECK
     if ((%maneuverLast > 300) && !matchre("%MANEUVER", "(?i)(NULL|OFF)")) then gosub MANEUVER_GO
     gosub ATTACK
     math ATTACKNUMBER add 1
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub ATTACK
     math ATTACKNUMBER add 1
     if (($UC_Tactics = 1) && ($Tactics.LearningRate < 33)) then gosub TACTICS-START
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto BRAWLINGXP
     gosub ATTACK
     math ATTACKNUMBER add 1
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto BRAWLINGXP
     gosub ATTACK
     math ATTACKNUMBER add 1
     if (("$guild" = "Paladin") && (%ATTACKNUMBER > 2)) then gosub SMITE_CHECK
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     gosub ATTACK
     math ATTACKNUMBER add 1
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if (matchre("$guild", "%MAGICUSER") && ("$preparedspell" != "None")) then gosub CAST_TIMER
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto BRAWLINGXP
     if (%ATTACKNUMBER > 3) then goto BRAWLINGXP
     if (%Foci.Active = 1) then
          {
               evalmath FociTime ($gametime - %FociStart)
               if (%FociTime > 250) then gosub TM_FOCI_END
          }
BRAWLINGXP:
     delay 0.0001
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (%ATTACKNUMBER > 8) then var ATTACKNUMBER 0
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if ($%LEARNING.LearningRate > %MAX.LEARNINGRATE) then goto COMBAT_RETURN
     gosub COMBAT_TIMER
     gosub STATUSBAR
     if (matchre("$guild", "%MAGICUSER") && ("$preparedspell" != "None")) then gosub CAST_TIMER
     if (%Foci.Active = 1) then
          {
               evalmath FociTime ($gametime - %FociStart)
               if (%FociTime > 250) then gosub TM_FOCI_END
          }
     if ($UC_bagsFull = 1) then goto COMBAT_RETURN
     if ($UC_bundleFull = 1) then goto COMBAT_RETURN
     if ($%LEARNING.LearningRate > %MAX.LEARNINGRATE) then goto COMBAT_RETURN
     if (%t > %MAX.TIME) then goto COMBAT_RETURN
     if ((%High.Switch = 1) && (%NecroHealing = 0) && !matchre("$monsterlist", "%ubermonster")) then goto COMBAT_RETURN
     goto BRAWLING_MONSTERCOUNT
##########################################################################
#### Empath Brawling
##########################################################################
EMPATHIC_SHOCK:
     pause 0.0001
     put #echo >Log #ffff66 *** EMPATHIC SHOCK DETECTED! Non-damaging routine initiated
     echo #############################
     echo *** ABORT! EMPATHIC SHOCK DETECTED!!!!
     echo *** SWITCHING TO NON-DAMAGING ROUTINE!
     echo #############################
     pause 0.5
     pause 0.0001
PREEMPATHBRAWLING:
     delay 0.0001
     var switchloop 0
     var WEAPON NULL
     var ATTACKNUMBER 0
     var melee 1
     var Empath.Brawl 1
     put #echo >Log LightSeaGreen *** Swapped to Empath Brawling
     echo
     echo ######################
     echo ######################
     echo *** Training: EMPATH BRAWLING
     echo *** Weapon: %WEAPON
     echo ######################
     echo ######################
     echo
     pause 0.1
     if matchre("$righthand $lefthand", "(%RANGED.CROSSBOW|%RANGED.BOW|%RANGED.SLING)") then gosub stowing
     gosub STANCE_SETUP
     var CURRENT EMPATH BRAWL
     gosub STATUSBAR
     gosub DARK_CHECK
     timer stop
     timer clear
     timer start
     echo
     echo ###################
     echo * No Constructs/Undead Detected!
     echo * Initiating Non-Damaging
     echo * Empath Brawling Routine
     echo ###################
     echo
     if ($UC_Shield = 0) then
          {
               gosub GET my $UC_MyShield
               gosub WEAR $UC_MyShield
          }
     if (($UC_Armor.Noob = 1) && ($UC_TrainStealth = 1)) then gosub REMOVE_PLATE
EMPATH_BRAWLING_MONSTERCOUNT:
     delay 0.0001
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then gosub BORED
     ## if ($monstercount < $UC_MaxMonsters) then gosub PREBRAWLDANCE
     if (($UC_ArmWorn = 0) && !contains("$righthand $lefthand", "$UC_MyShield")) then gosub SHIELD_CHECK
     gosub PRETRAINCHECK
EMPATH_BRAWLING_1:
     delay 0.0001
     if ($standing = 0) then gosub STAND
     gosub STATUSBAR
     if (matchre("%facing", "(?i)(NULL|OFF|^%|^\s*$)") || (%newdead = 1) || matchre("%Empath.Critter", "NULL")) then gosub ASSESS_LOOP
     if (matchre("%critterList", "%Undead") && matchre("%spelltimer", "Absolution")) then goto SWITCH
     if matchre("%critterList", "%Construct") then goto SWITCH
     if ($UC_Egg = 1) then gosub EGG_TIMER
     if ($UC_Tarantula = 1) then gosub TARANTULA_TIMER
     if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
     if (($UC_Crystal = 1) && ($concentration > 95) && ($UC_CrystalCombat = 1)) then gosub CRYSTAL_TIMER
     if matchre("%HUNT", "(?i)(ON|1|YES)") then gosub HUNT_TIMER
     if matchre("%POWERP", "(?i)(ON|1|YES)") then gosub PERCEIVE_TIMER
     if matchre("%APPRAISE", "(?i)(ON|1|YES)") then gosub APPRAISE_TIMER
     if (%newdead) then gosub FACE_NEXT
     if matchre("$monsterlist", "%ubermonster") then put face %ubermonster
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub BUFF_TIMER
     if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF absolution $Mana.ABSOLUTION
     if matchre("$monsterlist", "%Construct") then goto SWITCH
     pause 0.0001
     if (matchre("$monsterlist", "%Undead") && ($SpellTimer.Absolution.active)) then goto SWITCH
     if (!matchre("$monsterlist", "%nomanipulate") && ($monstercount > 2)) then gosub MANIP_TIMER
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then goto EMPATH_BRAWLING_MONSTERCOUNT
     if ($stamina < 65) then gosub STAMINA_WAIT
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if ((($Stealth.LearningRate < 29) && ($UC_TrainStealth = 1) && (%Backtraining = 0)) || (($Stealth.LearningRate < 29) && ($UC_Backtrain.Stealth = 1) && (%Backtraining = 1))) then gosub STEALTH-HIDECHECK
     gosub PUT shove
     math ATTACKNUMBER add 1
     if (matchre("%critterList", "%Undead") && matchre("%spelltimer", "Absolution")) then goto SWITCH
     if matchre("%critterList", "%Construct") then goto SWITCH
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if (($Stealth.LearningRate < 29) && ($UC_TrainStealth = 1)) then gosub STEALTH-HIDECHECK
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto EMPATHBRAWLINGXP
     gosub PUT bob
     math ATTACKNUMBER add 1
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto EMPATHBRAWLINGXP
     gosub put circle
     math ATTACKNUMBER add 1
     if matchre("%critterList", "%Construct") then goto SWITCH
     if (matchre("$guild", "%MAGICUSER") && ("$preparedspell" != "None")) then gosub CAST_TIMER
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto EMPATHBRAWLINGXP
     gosub put weave
     math ATTACKNUMBER add 1
     if (matchre("$guild", "%MAGICUSER") && ($UC_SlowCast = 0)) then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto EMPATHBRAWLINGXP
     if (%ATTACKNUMBER > 3) then goto EMPATHBRAWLINGXP
     if (matchre("%critterList", "%Undead") && matchre("%spelltimer", "Absolution")) then goto SWITCH
     else goto EMPATH_BRAWLING_1
EMPATHBRAWLINGXP:
     delay 0.0001
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (matchre("$monsterlist", "%Undead") && ($SpellTimer.Absolution.active)) then goto SWITCH
     if matchre("$monsterlist", "%Construct") then goto SWITCH
     if (%ATTACKNUMBER > 3) then var ATTACKNUMBER 0
     if ($%LEARNING.LearningRate > %MAX.LEARNINGRATE) then goto SWITCH
     gosub COMBAT_TIMER
     gosub STATUSBAR
     if ($UC_bagsFull = 1) then goto COMBAT_RETURN
     if ($UC_bundleFull = 1) then goto COMBAT_RETURN
     if ($%LEARNING.LearningRate > %MAX.LEARNINGRATE) then goto COMBAT_RETURN
     if (%t > %MAX.TIME) then goto COMBAT_RETURN
     goto EMPATH_BRAWLING_MONSTERCOUNT
##########################################################################
#### NECRO HEALING MODULE
##########################################################################
PRENECROHEALING:
     delay 0.0001
     var switchloop 0
     var WEAPON $charactername
     var ATTACKNUMBER 0
     var melee 1
     put #echo >Log LightSeaGreen *** Swapped to Necro Healing Module
     echo
     echo ########################
     echo ########################
     echo *** Training: %WEAPON_EXP
     echo *** Weapon: %WEAPON
     echo ########################
     echo ########################
     echo
     pause 0.1
     gosub STANCE_SETUP
     var CURRENT NECRO HEALING
     gosub STATUSBAR
     gosub DARK_CHECK
     timer stop
     timer clear
     timer start
     echo
     echo ###################
     echo *** NECRO HEALING ROUTINE
     echo ###################
     echo
     if ($UC_Shield = 0) then
          {
               gosub GET my $UC_MyShield
               gosub WEAR $UC_MyShield
          }
     if (($UC_Armor.Noob = 1) && ($UC_TrainStealth = 1)) then gosub REMOVE_PLATE
NECRO_HEALING_MONSTERCOUNT:
     delay 0.0001
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then gosub BORED
     gosub BLEEDERCHECK
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then goto DONE_NECROHEALING
NECRO_HEALING_ROUTINE:
     delay 0.0001
     if ($standing = 0) then gosub STAND
     if matchre("$monsterlist", "%ubermonster") then put face %ubermonster
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     pause 0.0001
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then goto NECRO_HEALING_MONSTERCOUNT
     if ($stamina < 65) then gosub STAMINA_WAIT
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (!matchre("$righthand", "Empty") && (%Foci.Active = 0)) then gosub ATTACK
     math ATTACKNUMBER add 1
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto NECRO_HEALING_XP
     if (!matchre("$righthand", "Empty") && (%Foci.Active = 0)) then gosub ATTACK
     math ATTACKNUMBER add 1
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto NECRO_HEALING_XP
     if (!matchre("$righthand", "Empty") && (%Foci.Active = 0)) then gosub ATTACK
     math ATTACKNUMBER add 1
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto NECRO_HEALING_XP
     if (!matchre("$righthand", "Empty") && (%Foci.Active = 0)) then gosub ATTACK
     math ATTACKNUMBER add 1
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto NECRO_HEALING_XP
     else goto NECRO_HEALING_ROUTINE
NECRO_HEALING_XP:
     delay 0.0001
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (%ATTACKNUMBER > 3) then var ATTACKNUMBER 0
     gosub STATUSBAR
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then goto DONE_NECROHEALING
     if (%t > %MAX.TIME) then goto COMBAT_RETURN
     goto NECRO_HEALING_MONSTERCOUNT
#############################################################################
#### BRAWL DANCE WHILE WAITING FOR CRITTERS
PREBRAWLDANCE:
     delay 0.0001
     if ($monstercount < 1) then goto BORED
     timer stop
     echo #####################
     echo ** BRAWL / DANCE ROUTINE
     echo ** Waiting for more critters..
     echo #####################
     if !matchre("%WEAPON", "(?i)($charactername|NULL)") then gosub SHEATH %WEAPON
     if !matchre("%WEAPON2", "$charactername|NULL") then gosub SHEATH %WEAPON2
     # gosub WEAR %WEAPON
     gosub STANCE_SETUP
     var CURRENT BRAWL DANCING
BRAWLDANCE:
     delay 0.0001
     if ($monstercount < 1) then goto BORED
     gosub STATUSBAR
     echo ################################
     echo * Waiting for monstercount to be > $UC_MaxMonsters
     echo ################################
     gosub PUT bob
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$monsterlist", "%ubermonster") then put face %ubermonster
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (($Stealth.LearningRate < 29) && ($UC_TrainStealth = 1)) then gosub STEALTH-HIDECHECK
     if ($monstercount > $UC_MaxMonsters) then goto BRAWLDANCE_RETURN
     gosub PUT circle
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($monstercount > $UC_MaxMonsters) then goto BRAWLDANCE_RETURN
     gosub PUT weave
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($monstercount > $UC_MaxMonsters) then goto BRAWLDANCE_RETURN
     gosub PUT shove
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($monstercount > $UC_MaxMonsters) then goto BRAWLDANCE_RETURN
     goto BRAWLDANCE
BRAWLDANCE_RETURN:
     delay 0.0001
     if !matchre("%WEAPON", "(?i)($charactername|NULL)") && ("%WEAPON_EXP" != "Brawling") then gosub WIELD %WEAPON
     if ("%WEAPON2" != "NULL") then if !matchre("%WEAPON", "(?i)($charactername|NULL)") && ("%WEAPON_EXP" != "Brawling") then gosub WIELD %WEAPON2
     timer start
     return
#### BRAWL DANCE WHILE WAITING FOR MANA
PREMANADANCE:
     delay 0.0001
     timer stop
MANADANCE:
     delay 0.0001
     var CURRENT MANA BRAWL
     gosub STATUSBAR
     echo **** BRAWLING WHILE WAITING FOR MANA
     if ((($Stealth.LearningRate < 29) && ($UC_TrainStealth = 1) && (%Backtraining = 0)) || (($Stealth.LearningRate < 29) && ($UC_Backtrain.Stealth = 1) && (%Backtraining = 1))) then gosub STEALTH-HIDECHECK
     if ($monstercount > 0) then gosub PUT bob
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($mana > 75) then goto MANADANCERETURN
     if ($monstercount > 0) then gosub PUT circle
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($mana > 75) then goto MANADANCERETURN
     if ($monstercount > 0 then gosub PUT weave
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($mana > 75) then goto MANADANCERETURN
     if ($monstercount > 0) then gosub PUT shove
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($mana > 75) then goto MANADANCERETURN
     goto MANADANCE
MANADANCERETURN:
     delay 0.0001
     timer start
     return
##########################################################################
# AMMO CLEANUP MODULE - KILL REMAINING MONSTERS TO GET ANY STRAY AMMO
##########################################################################
AMMO_CLEANUP:
     if ($health < 83) || ($bleeding) then return
     echo ####################################
     echo *** NOT TOO HURT! AMMO CLEANUP INITIATED!
     echo *** KILLING A FEW MONSTERS BEFORE ESCAPING
     echo *** TO RETRIEVE ANY AMMO LOGDED IN THEM!
     echo #####################################
     pause 0.2
     pause 0.0001
     pause 0.0001
     var ammolodged 0
     var CURRENT AMMO CLEANUP
     gosub STATUSBAR
     gosub stowing
AMMO_CLEANUP_PRE:
     var CLEANUP.LOOP 0
     var LAST AMMO_CLEANUP_PRE
     delay 0.0001
     var WEAPON NULL
     if !matchre("$UC_WEAPON_SB", "(?i)(NULL|OFF|^%|^\s*$)") then var WEAPON $UC_WEAPON_SB
     if !matchre("$UC_WEAPON_LB", "(?i)(NULL|OFF|^%|^\s*$)") then var WEAPON $UC_WEAPON_LB
     if !matchre("$UC_WEAPON_STAVES", "(?i)(NULL|OFF|^%|^\s*$)") then var WEAPON $UC_WEAPON_STAVES
     if !matchre("$UC_WEAPON_POLEARMS", "(?i)(NULL|OFF|^%|^\s*$)") then var WEAPON $UC_WEAPON_POLEARMS
     if !matchre("$UC_WEAPON_LT", "(?i)(NULL|OFF|^%|^\s*$)") then var WEAPON $UC_WEAPON_LT
     if !matchre("$UC_WEAPON_HT", "(?i)(NULL|OFF|^%|^\s*$)") then var WEAPON $UC_WEAPON_HT
     if !matchre("$UC_WEAPON_LE", "(?i)(NULL|OFF|^%|^\s*$)") then var WEAPON $UC_WEAPON_LE
     if !matchre("$UC_WEAPON_SE", "(?i)(NULL|OFF|^%|^\s*$)") then var WEAPON $UC_WEAPON_SE
     if !matchre("$UC_WEAPON_THB", "(?i)(NULL|OFF|^%|^\s*$)") then var WEAPON $UC_WEAPON_THB
     if !matchre("$UC_WEAPON_THE", "(?i)(NULL|OFF|^%|^\s*$)") then var WEAPON $UC_WEAPON_THE
     if matchre("%WEAPON", "(?i)(NULL|OFF|^%|^\s*$)") then var WEAPON $charactername
     timer stop
     timer clear
     var ATTACKNUMBER 0
     var melee 1
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then gosub stowing
     # put #echo >Log LightSeaGreen *** Switched Training to %LEARNING
     timer start
     # debuglevel 10
     if ($UC_Shield = 0) then
          {
               gosub GET my $UC_MyShield
               gosub WEAR $UC_MyShield
          }
     if !matchre("$UC_DefenseSkill" , "Custom") then gosub STANCE_SETUP
     if ($UC_DualWield = 1) then gosub DW_CHECK
AMMO_CLEANUP_MONSTERCOUNT:
     delay 0.0001
     action (retreat) on
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then gosub BORED
     if ($monstercount < $UC_MaxMonsters) then gosub PREBRAWLDANCE
     gosub PRETRAINCHECK
     if !matchre("%WEAPON", "(?i)($charactername|NULL)") && ("%WEAPON_EXP" != "Brawling") then gosub WIELD %WEAPON
AMMO_CLEANUP_TRAIN:
     var LAST AMMO_CLEANUP_TRAIN
     if ($health < 80) || ($health < 90) && ($bleeding) then return
     if ($UC_DualWield = 1) && ("$lefthand" = "Empty") then send wield left %CurrentDW
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if !matchre ("$righthand" , "(?i)%WEAPON") then if matchre("$righthand", "%RANGED.BOW") then send wear %righthand
     if !matchre ("$righthand" , "(?i)%WEAPON") then if matchre("$righthand", "%RANGED.CROSSBOW") then send wear %righthand
     if !matchre ("$righthand" , "(?i)%WEAPON") then if matchre("$righthand", "%RANGED.SLING") then send wear %righthand
     delay 0.0001
     if ($standing = 0) then gosub STAND
     if (matchre("$guild", "%MAGICUSER") && ("$preparedspell" != "None")) then gosub CAST_TIMER
     pause 0.0001
     if matchre("%facing", "(?i)(NULL|OFF|^%|^\s*$)") then gosub ASSESS
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto AMMO_CLEANUP_XP
AMMO_CLEANUP_TRAINING:
     action (retreat) off
     math CLEANUP.LOOP add 1
     if (%CLEANUP.LOOP > 2) then return
     if ($health < 80) || (($health < 90) && ($bleeding)) then return
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (("$guild" = "Empath") && ($UC_ConstructOnly = 1)) then
          {
               if matchre("%facing", "%noUndead") then return
               if !matchre("$monsterlist", "(%Undead|%Construct)") then return
               if (matchre("$monsterlist", "%Undead") && ($spellABSOLUTION = 0)) then return
          }
     if (%Melee.Range) then gosub ADVANCE
     if ("$guild" = "Barbarian") then gosub ROAR_TIMER
     if (("$guild" = "Paladin") && (%ATTACKNUMBER > 2)) then gosub SMITE_CHECK
     if ($health < 80) || ($health < 90) && ($bleeding) then return
     if ("$guild" = "Thief") then gosub DEBILITATE
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then gosub AMMO_CLEANUP_XP
     if !contains("$lefthand", "(?i)%WEAPON") && ("$UC_WeaponType" = "OFFHAND") then gosub SWAP
     if !contains("$righthand", "(?i)%WEAPON") && ("$UC_WeaponType" != "OFFHAND") then gosub SWAP
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then goto TRAIN_MONSTERCOUNT
     gosub ATTACK
     math ATTACKNUMBER add 1
     if ($health < 80) || (($health < 90) && ($bleeding)) then return
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub ATTACK
     math ATTACKNUMBER add 1
     if ($health < 80) || (($health < 90) && ($bleeding)) then return
     if (matchre("%facing", "(?i)(NULL|OFF|^%|^\s*$)") && (%newdead = 1)) then gosub ASSESS_LOOP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto AMMO_CLEANUP_XP
     if (matchre("$guild", "%MAGICUSER") && ("$preparedspell" != "None")) then gosub CAST_TIMER
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto AMMO_CLEANUP_XP
     gosub ATTACK
     math ATTACKNUMBER add 1
     if ($health < 80) || (($health < 90) && ($bleeding)) then return
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto AMMO_CLEANUP_XP
     gosub ATTACK
     math ATTACKNUMBER add 1
     if ($health < 80) || (($health < 90) && ($bleeding)) then return
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then goto AMMO_CLEANUP_XP
     if (matchre("$guild", "%MAGICUSER") && ("$preparedspell" != "None")) then gosub CAST_TIMER
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (%CLEANUP.LOOP > 2) then goto AMMO_CLEANUP_XP
     goto AMMO_CLEANUP_TRAINING
AMMO_CLEANUP_XP:
     delay 0.0001
     var ammolodged 0
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (%ATTACKNUMBER > 15) then return
     if ($UC_Ammo = 1) then gosub stowammo
     if (%CLEANUP.LOOP < 2) then goto AMMO_CLEANUP_TRAINING
     return
##########################################################################
### MISC
RETURNTOSTART:
     delay 0.0001
     if ($hidden = 1) then
          {
               gosub PUT stop stalk
               gosub PUT unhide
          }
     return

NOT_LEARNING_WEAPON:
     pause 0.0001
     if (%Backtraining = 1) then goto COMBAT_RETURN
     put #echo >Log Orange *** Not Learning %LEARNING from $UC_combatCritter @ $%LEARNING.Ranks Ranks - Turning OFF
     # put #echo >Log Orange *** Time to move up the critter ladder?
     if ("%LEARNING" = "Small_Edged") then var SEWEAPON NULL
     if ("%LEARNING" = "Large_Edged") then var LEWEAPON NULL
     if ("%LEARNING" = "Twohanded_Edged") then var 2HEWEAPON NULL
     if ("%LEARNING" = "Small_Blunt") then var SBWEAPON NULL
     if ("%LEARNING" = "Large_Blunt") then var LBWEAPON NULL
     if ("%LEARNING" = "Light_Thrown") then var LTWEAPON NULL
     if ("%LEARNING" = "Heavy_Thrown") then var HTWEAPON NULL
     if ("%LEARNING" = "Twohanded_Blunt") then var 2HBWEAPON NULL
     if ("%LEARNING" = "Staves") then var STAVES NULL
     if ("%LEARNING" = "Polearms") then var POLEARMS NULL
     if ("%LEARNING" = "Bow") then var RANGED.BOW NULL
     if ("%LEARNING" = "Crossbow") then var RANGED.CROSSBOW NULL
     if ("%LEARNING" = "Slings") then var RANGED.SLING NULL
     if ("%LEARNING" = "Offhand_Weapon") then var OHWEAPON NULL
     if ("%LEARNING" = "Backstab") then var BSWEAPON NULL
     gosub STRIP_IT LEARNING combatsToTrain
     var LEARNING NULL
     put #var UC_WEAPON_SE %SEWEAPON
     put #var UC_WEAPON_LE %LEWEAPON
     put #var UC_WEAPON_THE %THEWEAPON
     put #var UC_WEAPON_SB %SBWEAPON
     put #var UC_WEAPON_LB %LBWEAPON
     put #var UC_WEAPON_THB %THBWEAPON
     put #var UC_WEAPON_BOW %RANGED.BOW
     put #var UC_WEAPON_CROSSBOW %RANGED.CROSSBOW
     put #var UC_WEAPON_SLING %RANGED.SLING
     put #var UC_WEAPON_POLEARMS %POLEARMS
     put #var UC_WEAPON_STAVES %STAVES
     put #var UC_WEAPON_LT %LTWEAPON
     put #var UC_WEAPON_HT %HTWEAPON
     put #var UC_WEAPON_BRAWL %BRAWLWEAPON
     put #var UC_WEAPON_OH %OHWEAPON
     put #var UC_WEAPON_BS %BSWEAPON
COMBAT_RETURN:
     pause 0.0001
     var High.Switch 0
     put #tvar UC_DualWield 0
     # var Empath.Brawl 0
     action (retreat) off
     if ($standing = 0) then gosub STAND
     if (($UC_Armor.Noob = 1) && (%Removed.Armor = 1)) then gosub WEAR_PLATE
     gosub CLEARHANDS
     gosub stowammo
     if (("$guild" = "Necromancer") && (%NecroHealing = 1)) then
          {
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto DONE_NECROHEALING
          }
     if ($UC_SmartWeapons = 0) then goto %NextSkill
     if ($UC_SmartWeapons = 1) then goto SWITCH
     return
### RESET MELEE/RANGED SETTINGS BETWEEN WEAPONS
RESET_RANGE:
     var melee 0
     var ranged 0
     var Empath.Brawl 0
     if !matchre("%TempMax", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var MAX.LEARNINGRATE %TempMax
               pause 0.1
               var TempMax NULL
          }
     return
####### BARB EXPERTISE TRAINING
BARB_EXPERTISE:
     var expertise ON
     var CCM flame
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then return
     if ($Expertise.LearningRate >= 33) then return
     if ($Expertise.Ranks < 70) || ($mana < 9) || ($innerFire < 3) then goto CCM1
     if ($Expertise.Ranks > 70) && ($Expertise.Ranks < 130) then goto CCM2
     if ($Expertise.Ranks > 130) && ($Expertise.Ranks < 220) then goto CCM3
     if ($Expertise.Ranks > 220) && ($Expertise.Ranks < 360) then goto CCM4
     if ($Expertise.Ranks > 360) && ($Expertise.Ranks < 620) then goto CCM5
     if ($Expertise.Ranks > 620) && ($Expertise.Ranks < 920) then goto CCM6
     if ($Expertise.Ranks > 920) && ($Expertise.Ranks < 1200) then goto CCM7
     if ($Expertise.Ranks > 1200) && ($Expertise.Ranks < 1600) then goto CCM8
     if ($Expertise.Ranks > 1600) then goto CCM9
CCM1:
     random 1 1
     goto CCM_CHOOSE
CCM2:
     random 1 2
     goto CCM_CHOOSE
CCM3:
     random 1 4
     goto CCM_CHOOSE
CCM4:
     random 1 5
     goto CCM_CHOOSE
CCM5:
     random 1 7
     goto CCM_CHOOSE
CCM6:
     random 1 9
     goto CCM_CHOOSE
CCM7:
     random 1 10
     goto CCM_CHOOSE
CCM8:
     random 1 11
     goto CCM_CHOOSE
CCM9:
     random 1 12
CCM_CHOOSE:
     pause 0.001
     if (%r = 1) then var CCM flame
     if (%r = 2) then var CCM accuracy
     if (%r = 3) then var CCM flame
     if (%r = 4) then var CCM damage
     if (%r = 5) then var CCM intimidation
     if (%r = 6) then var CCM flame
     if (%r = 7) then var CCM fatigue
     if (%r = 8) then var CCM balance
     if (%r = 9) then var CCM flame
     if (%r = 10) then var CCM vitality
     if (%r = 11) then var CCM rage
     if (%r = 12) then var CCM calm
     goto TACTICS_BEGIN
##########################################################################
### ADVANCED MANEUVERS
MANEUVERS:
MANEUVER_GO:
     if matchre("%MANEUVER", "(?i)NULL") then return
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then return
     if ($hidden = 0) then gosub UNHIDE
     if ($standing = 0) then gosub STAND
     if (%Melee.Range = 0) then
          {
               put adv
               pause 2
          }
     if (%Melee.Range = 0) then pause 2
     if matchre("$righthand", "(?i)Empty") then var MANEUVER PALMSTRIKE
     pause 0.0001
     echo
     echo ################
     echo # ADVANCED MANEUVER:
     echo #     %MANEUVER
     echo ################
     echo
     pause 0.0001
     pause 0.01
     pause 0.01
     send MANEUVER %MANEUVER
     pause 0.5
     pause 0.2
     pause 0.0001
     var maneuverTime $gametime
     return
DOUBLESTRIKE_GO:
     if matchre("%MANEUVER", "(?i)NULL") then return
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then return
     if (%Melee.Range = 0) then
          {
               put adv
               pause 2
          }
     if (%Melee.Range = 0) then goto DOUBLESTRIKE_GO
     pause 0.0001
     echo
     echo ################
     echo # ADVANCED MANEUVER:
     echo #   DOUBLESTRIKE
     echo ################
     echo
     pause 0.0001
     pause 0.01
     pause 0.01
     send MANEUVER DOUBLESTRIKE
     pause 0.5
     pause 0.2
     var doubleStrikeTime $gametime
     return
##########################################################################
### TACTICS LOGIC
TACTICS-START:
     # Analyze variables
     var moveone none
     var movetwo none
     var movethree none
     var movefour none
     var movefive none
     var monsterto
     var NEXT.MOB none
     var ordinals |first|second|third|fourth|fifth|sixth|seventh
     if ("$UC_WeaponType" = "OFFHAND") then return
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then goto TACTICSDONE
     if ($standing = 0) then gosub STAND
TACTICS:
     pause 0.0001
     if (("$guild" = "Empath") && ($UC_ConstructOnly = 1)) then
          {
               if !matchre("%facing", "(%Undead|%Construct)") then gosub ASSESS
               if (!matchre("$monsterlist", "(%Undead|%Construct)") && ("$monsterlist" != "")) then goto PREEMPATHBRAWLING
               if (($spellABSOLUTION = 0) && matchre("%facing", "%Undead")) then gosub EMPATH_FACE
               if (($spellABSOLUTION = 0) && !matchre("%facing", "%noUndead") then gosub EMPATH_FACE
               if !matchre("%facing", "(%Undead|%Construct)") then goto PREEMPATHBRAWLING
          }
TACTICS_BEGIN:
     if ($standing = 0) then gosub STAND
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then goto TACTICSDONE
     if matchre("$UC_WeaponType","(THE|THB|POLEARMS)") && !matchre("$lefthand", "Empty") then gosub STOW $lefthandnoun
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if (("$guild" = "Barbarian") && ("%expertise" = "ON")) then gosub PUT analyze %CCM
     if (("$guild" != "Barbarian") && ($Tactics.LearningRate > 32)) then return
     if (("$guild" = "Barbarian") && ("%expertise" = "OFF") && ($Tactics.LearningRate > 33)) then return
     if (("$guild" = "Barbarian") && ("%expertise" = "ON") && ($Expertise.LearningRate > 33)) then return
     if (("$guild" != "Barbarian") || (("$guild" = "Barbarian") && ("%expertise" = "OFF"))) then gosub PUT analyze
TACTICSYES:
     pause 0.0001
     pause 0.0001
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if ("%moveone" != "none") then gosub ATTACKMOVE %moveone
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then return
     if ("%movetwo" != "none") then gosub ATTACKMOVE %movetwo
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then return
     if ("%movethree" != "none") then gosub ATTACKMOVE %movethree
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then return
     if ("%movefour" != "none") then gosub ATTACKMOVE %movefour
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if matchre("$roomobjs", "((?:which|that) appears dead|\(dead\))") then return
     if ("%movefive" != "none") then gosub ATTACKMOVE %movefive
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     var moveone none
     var movetwo none
     var movethree none
     var movefour none
     var movefive none
     if (("$guild" = "Barbarian") && ("%expertise" = "ON")) then var expertise OFF
     goto TACTICSDONE
#### TACTICS ATTACK SUB
ATTACKMOVE_SWAP:
     put swap
     pause 0.0001
     pause 0.0001
     pause 0.0001
     goto ATTACKMOVE_1
ATTACKMOVE:
     var attackmove $0
     pause 0.0001
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if ($stamina < 65) then gosub STAMINA_WAIT
     if ($standing = 0) then gosub STAND
     var LOCATION ATTACKMOVE_1
     pause 0.0001
     ATTACKMOVE_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre RETURN (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RETURN ^You can not slam with .*\!
     matchre RETURN ^There is nothing else to face
     matchre RETURN ^You aren't close enough to attack
     matchre RETURN ^You turn to face
     matchre RETURN ^You spin around to face
     matchre RETURN ^You need two hands
     matchre RETURN ^You stop advancing because
     matchre RETURN ^At what are you trying to .*\?
     matchre ATTACKMOVE_SWAP ^Wouldn't it be better
     matchre RETURN flying too high for you to attack|flying far too high to hit
     send %attackmove
     matchwait 10
     echo *** MISSING MATCH IN ATTACKMOVE! ***
     # put #echo >Log Crimson  *** MISSING MATCH IN ATTACKMOVE! (ubercombat.cms) ***
     # put #log $datetime MISSING MATCH IN ATTACKMOVE (ubercombat.cms)
     goto ATTACK
TACTICSDONE:
     unvar monsterto
     unvar NEXT.MOB
     unvar ordinal
     unvar attackmove
     put #parse TACTICS DONE
     return
############################################################################################################
#### MAGIC PREPPER CHECK
#######################################
MAGIC_PREP:
     if ($spelltime > 22) then gosub SPELL_CAST
     if (%spellPrepped = 1) then gosub SPELL_CAST
     if ((%Backtraining = 1) && ($UC_BacktrainMagic = 0)) then return
     if (("$preparedspell" = "None") && ($mana > 40)) then gosub PREP
     if (%spellExpired = 1) then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
               return
          }
     if (%spellPrepped = 1) then gosub SPELL_CAST
     if ($spelltime > 22) then gosub SPELL_CAST
     return
############################################################################################################
#### LOCAL TIMERS
LOOKPORTAL_TIMER:
     if matchre("%portalTime", "$^") then var portalTime $gametime
     evalmath portalLast ($gametime - %portalTime)
     # echo *** Last portal look time: %portalLast seconds
     return
WEATHER_TIMER:
     evalmath WeatherTime ($gametime - %WeatherTime)
     if (%WeatherTime > 320) then
          {
                    put weather
                    pause 0.1
                    pause 0.2
                    var WeatherTime $gametime
          }
     if ($standing = 0) then gosub STAND
     return
HERBHEAL_TIMER:
     if matchre("%herbTime", "$^") then var herbTime $gametime
     evalmath herbLast ($gametime - %herbTime)
     # echo *** Last Herb Heal: %herbLast seconds
     return
DARKCHECK_TIMER:
     if matchre("%darkTime", "$^") then var darkTime $gametime
     evalmath darkLast ($gametime - %darkTime)
     return
BOS_TIMER:
     if matchre("%BOSTime", "$^") then var BOSTime $gametime
     evalmath BOSLast ($gametime - %BOSTime)
     return
NECROHEAL_TIMER:
     evalmath NecroHealLast ($gametime - %NecroHealTime)
     return
BUTCHERY_TIMER:
     if matchre("%ButcheryTime", "$^") then var ButcheryTime $gametime
     evalmath ButcheryLast ($gametime - %ButcheryTime)
     return
OBSERVE_TIMER:
     var Observe 0
     evalmath observeLast ($gametime - %observeTime)
     if (%observeLast > 180) then var Observe 1
     return
SKIN_TIMER:
     evalmath skinLastTime ($gametime - %skinTime)
     return
DEAD_TIMER:
     evalmath deadCheckTime ($gametime - %DeadTime)
     return
DOUBLESTRIKE_TIMER:
     evalmath doubleStrikeLast ($gametime - %doubleStrikeTime)
     return
MANEUVER_TIMER:
     evalmath maneuverLast ($gametime - %maneuverTime)
     return
DO_TIMER:
     evalmath OutrageCheckTime ($gametime - %OutrageTime)
     if (%OutrageCheckTime > 1000) then
          {
                    if ((%InCombat = 1) && (%OutrageCheckTime < 1800)) then return
                    gosub DO_CHECK
                    var OutrageTime $gametime
          }
     if ($standing = 0) then gosub STAND
     return
JUSTICE_TIMER:
     evalmath justiceCheckTime ($gametime - %JusticeTime)
     if (%justiceCheckTime > 80) then
          {
                    gosub JUSTICE_CHECK
                    var JusticeTime $gametime
          }
     return
ORB_RUB_TIMER:
     if matchre("%OrbTime", "$^") then var OrbTime $gametime
     evalmath OrbLast ($gametime - %OrbTime)
     if (%OrbLast < 2400) then return
     echo ###############
     echo *** Rubbing Favor Orb
     echo ###############
     put rub my %FAVOR.GOD orb
     pause 0.2
     var OrbTime $gametime
     return
COMMUNE_TIMER:
     if matchre("%CommuneCheckTime", "$^") then var CommuneCheckTime $gametime
     evalmath CommuneCheckLast ($gametime - %CommuneCheckTime)
     if (%CommuneCheckLast > 300) then
          {
               pause 0.1
               send commune
               pause 0.2
               send commune sense
               wait
               var CommuneCheckTime $gametime
          }
     return
RUNIC_TIMER:
     if matchre("%RunicTime", "$^") then var RunicTime $gametime
     evalmath RunicLast ($gametime - %RunicTime)
     if (%RunicLast > 3600) then
          {
               pause 0.01
               var RunicTime $gametime
               send invoke tattoo
               pause 5
               pause
               send cast
               pause 0.2
          }
     return
TEXTBOOK_TIMER:
     if matchre("%TextbookTime", "$^") then var TextbookTime $gametime
     evalmath TextbookLast ($gametime - %TextbookTime)
     return
ANLORAL_TIMER:
     if matchre("%AnloralTime", "$^") then var AnloralTime $gametime
     evalmath AnloralLast ($gametime - %AnloralTime)
     if (%AnloralLast > 250) then goto ANLORAL_CHECK
     return
ANLORAL_CHECK:
     var AnloralTime $gametime
     matchre RETURN is clean|unblemished soft blue hue
     matchre ANLORAL_CLEAN dust|grime|dirty?|filthy|fingers of dirt
     put look at %Anloral pin
     matchwait 3
     return
ANLORAL_CLEAN:
     pause 0.0001
     if !matchre("$lefthand", "Empty") then gosub STOWIT left
     pause 0.0001
     if matchre("%Anloral", "(?i)Goshawk") then var God.Anloral Botolf
     if matchre("%Anloral", "(?i)Heron") then var God.Anloral Idon
     if matchre("%Anloral", "(?i)Owl") then var God.Anloral Firulf
     if matchre("%Anloral", "(?i)Jackal") then var God.Anloral Eylhaar
     if matchre("%Anloral", "(?i)Kingsnake") then var God.Anloral Periel
     if matchre("%Anloral", "(?i)Lion") then var God.Anloral Chadatru
     if matchre("%Anloral", "(?i)Magpie") then var God.Anloral Alamhif
     if matchre("%Anloral", "(?i)Mongoose") then var God.Anloral Rutilor
     if matchre("%Anloral", "(?i)Nightingale") then var God.Anloral Phelim
     if matchre("%Anloral", "(?i)Vulture") then var God.Anloral Aldauth
     if matchre("%Anloral", "(?i)Spider") then var God.Anloral Harawep
     if matchre("%Anloral", "(?i)Coyote") then var God.Anloral Beort
     if matchre("%Anloral", "(?i)Shark") then var God.Anloral Drogor
     if matchre("%Anloral", "(?i)Viper") then var God.Anloral Ushnish
     if matchre("%Anloral", "(?i)Weasel") then var God.Anloral Huldah
     if matchre("%Anloral", "(?i)Shrew") then var God.Anloral Kerenhappuch
     if matchre("%Anloral", "(?i)Shrike") then var God.Anloral Dergati
     if matchre("%Anloral", "(?i)Racoon") then var God.Anloral Zachriedek
     if matchre("%Anloral", "(?i)Adder") then var God.Anloral Asketi
     if matchre("%Anloral", "(?i)Centaur") then var God.Anloral Trothfang
     if matchre("%Anloral", "(?i)Jackal") then var God.Anloral Elyhaar
     if matchre("%Anloral", "(?i)Phoenix") then var God.Anloral Murrula
     if matchre("%Anloral", "(?i)Dove") then var God.Anloral Albreda
     if matchre("%Anloral", "(?i)Donkey") then var God.Anloral Saemaus
     if matchre("%Anloral", "(?i)Albatross") then var God.Anloral Lemicus
     if matchre("%Anloral", "(?i)Wolverine") then var God.Anloral Kuniyo
     if matchre("%Anloral", "(?i)Cow") then var God.Anloral Berengaria
     if matchre("%Anloral", "(?i)Welkin") then var God.Anloral Divyaush
     if matchre("%Anloral", "(?i)Boar") then var God.Anloral Everild
     if matchre("%Anloral", "(?i)Raven") then var God.Anloral Kertigen
     if matchre("%Anloral", "(?i)Panther") then var God.Anloral Damaris
     if matchre("%Anloral", "(?i)Cat") then var God.Anloral Tamsine
     if matchre("%Anloral", "(?i)Wolf") then var God.Anloral Meraud
     if matchre("%Anloral", "(?i)Ox") then var God.Anloral Truffenyi
     if matchre("%Anloral", "(?i)Ram") then var God.Anloral Glythtide
     if matchre("%Anloral", "(?i)Wren") then var God.Anloral Faenella
     if matchre("%Anloral", "(?i)Unicorn") then var God.Anloral Hodierna
     if matchre("%Anloral", "(?i)Dolphin") then var God.Anloral Eluned
     if matchre("%Anloral", "(?i)Cobra") then var God.Anloral Havroth
     if matchre("%Anloral", "(?i)Scorpion") then var God.Anloral Urremtier
     pause 0.0001
     pause 0.0001
     if !matchre("%FAVOR.GOD", "(?i)%God.Anloral") then goto ANLORAL_ERROR
     echo ##################
     echo ** CLEANING ANLORAL PIN!
     echo ##################
     pause 0.1
     gosub GET my %HolyWater
     pause 0.3
     pause 0.0001
     send clean my pin with holy water
     wait
     pause 0.0001
     pause 0.0001
     gosub STOWIT %HolyWater
     pause 0.0001
     var AnloralTime $gametime
     return
ANLORAL_ERROR:
     echo ##########################################
     echo ** ANLORAL GOD DOES NOT MATCH OUR FAVOR GOD
     echo ** Anloral = %Anloral /  Anloral God = %God.Anloral / Favor God = %FAVOR.GOD
     echo ** SKIPPING CLEANING = MAKE SURE FAVORORB MATCHES THE ANLORAL GOD TYPE!
     echo ##########################################
     echo Types:
     echo Goshawk = Botolf
     echo Heron = Idon
     echo Horned Owl = Firulf
     echo Jackal = Eylhaar
     echo Kingsnake = Periel
     echo Lion = Chadatru
     echo Magpie = Alamhif
     echo Mongoose = Rutilor
     echo Nightingale = Phelim
     echo Vulture = Aldauth
     echo Spider = Harawep
     echo Coyote = Beort
     echo Shark = Drogor
     echo Viper = Ushnish
     echo Weasel = Huldah
     echo Shrew = Kerenhappuch
     echo Shrike = Dergati
     echo Racoon = Zachriedek
     echo Adder = Asketi
     echo Centaur = Trothfang
     pause 0.0001
     echo Jackal = Elyhaar
     echo Phoenix = Murrula
     echo Dove = Albreda
     echo Donkey = Saemus
     echo Albatross = Lemicus
     echo Wolverine = Kuniyo
     echo Cow = Berengaria
     echo Welkin = Divyaush
     echo Boar = Everild
     echo Raven = Kertigen
     echo Panther = Damaris
     echo Cat = Tamsine
     echo Wolf = Meraud
     echo Ox = Truffenyi
     echo Ram = Glythtide
     echo Wren = Faenella
     echo Unicorn = Hodierna
     echo Dolphin = Eluned
     echo Cobra = Havroth
     echo Scorpion = Urremtier
     pause 0.0001
     return
TRUFFENYI_TIMER:
     if matchre("%CommuneTruffenyiTime", "$^") then var CommuneTruffenyiTime $gametime
     evalmath CommuneTruffenyiLast ($gametime - %CommuneTruffenyiTime)
     return
TAMSINE_TIMER:
     if matchre("%CommuneTamsineTime", "$^") then var CommuneTamsineTime $gametime
     evalmath CommuneTamsineLast ($gametime - %CommuneTamsineTime)
     return
TARANTULA_TIMER:
     if matchre("%TarantulaTime", "$^") then var TarantulaTime $gametime
     evalmath TarantulaLast ($gametime - %TarantulaTime)
     if (%TarantulaLast < 610) then return
     gosub TARANTULA
     var TarantulaTime $gametime
     return
TEACH_TIMER:
     if matchre("%TeachTime", "$^") then var TeachTime $gametime
     evalmath TeachLast ($gametime - %TeachTime)
     if ((%TeachLast < 500) && (%Teaching = 1)) then return
     gosub TEACHING
     var TeachTime $gametime
     return
GLYPHMANA_TIMER:
     if matchre("%GlyphTime", "$^") then var GlyphTime $gametime
     evalmath GlyphLast ($gametime - %GlyphTime)
     if (%GlyphLast < 800) then return
     gosub GLYPH_MANA
     var GlyphTime $gametime
     return
FOCI_TIMER:
     if (%Foci.Active = 1) then return
     if matchre("%FociTime", "$^") then var FociTime $gametime
     evalmath FociLast ($gametime - %FociTime)
     if (%FociLast < 3600) then return
     if ($Targeted_Magic.LearningRate > 31) then return
     gosub TM_FOCI
     var FociTime $gametime
     return
ALMANAC_TIMER:
     if matchre("%AlmanacTime", "$^") then var AlmanacTime $gametime
     evalmath AlmanacLast ($gametime - %AlmanacTime)
     if (%AlmanacLast < 610) then return
     gosub ALMANAC_STUDY
     var AlmanacTime $gametime
     pause 0.1
     return
NISSA_TIMER:
     if matchre("%NissaTime", "$^") then var NissaTime $gametime
     evalmath NissaLast ($gametime - %NissaTime)
     if (%NissaLast < 190) then return
     var NissaTime $gametime
     return
PARALYSIS_TIMER:
     if matchre("%ParalysisTime", "$^") then var ParalysisTime $gametime
     evalmath ParalysisLast ($gametime - %ParalysisTime)
     if (%ParalysisLast < 220) then return
     var ParalysisTime $gametime
     return
MANIP_TIMER:
MANIPULATE_TIMER:
     if ("$guild" != "Empath") then return
     if ($UC_Manipulate = 0) then return
     if matchre("%ManipulateTime", "$^") then var ManipulateTime $gametime
     evalmath ManipulateLast ($gametime - %ManipulateTime)
     if (%ManipulateLast < 160) then return
     if ($Empathy.LearningRate < 34) then gosub MANIPULATE
     var ManipulateTime $gametime
     return
GS_TIMER:
     if matchre("%GSTime", "$^") then var GSTime $gametime
     evalmath GSLast ($gametime - %GSTime)
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     return
DUMP_CHECK:
     if matchre("%DumpTime", "$^") then var DumpTime $gametime
     evalmath DumpLast ($gametime - %DumpTime)
     if (%DumpLast < 300) then return
     if ((%Dump.Combat = 0) && (%InCombat = 1)) then return
     gosub DUMP_JUNK
     var DumpTime $gametime
     return
HUNT_TIMER:
     if (%NecroHealing = 1) then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if matchre("%HuntTime", "$^") then var HuntTime $gametime
     evalmath HuntLast ($gametime - %HuntTime)
     if (%HuntLast < 180) then return
     if ("$guild" = "Ranger") then
          {
               if (($Scouting.Ranks >= 1750) && ($Perception.Ranks >= 1750)) then return
               if (($Scouting.LearningRate < 33) || ($Perception.LearningRate < 33)) then gosub HUNT
               goto HUNT_TIMER_2
          }
     if ($Perception.Ranks >= 1750) then return
     if ($Perception.LearningRate < 33) then gosub HUNT
HUNT_TIMER_2:
     var HuntTime $gametime
     return
APPRAISE_TIMER:
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if matchre("%AppraiseTime", "$^") then var AppraiseTime $gametime
     evalmath AppraiseLast ($gametime - %AppraiseTime)
     if (%AppraiseLast < 140) then return
     if (%NecroHealing = 1) then return
     if ($Appraisal.LearningRate < 33) then gosub APPRAISE_CRITTER
     var AppraiseTime $gametime
     return
PERCEIVE_TIMER:
     if ("$guild" = "Warrior") then put #var guild Warrior Mage
     if ("$guild" = "Moon") then put #var guild Moon Mage
     if ("$guild" = "Empath") then goto PERCEIVE_HEALTH_TIMER
     if (%NecroHealing = 1) then return
     if matchre("$guild", "(Thief|Commoner|Barbarian)") then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if matchre("%PerceiveTime", "$^") then var PerceiveTime $gametime
     evalmath PerceiveLast ($gametime - %PerceiveTime)
     if (%PerceiveLast < 160) then return
     if ($Attunement.LearningRate < 34) then gosub PERCEIVE
     if (("$guild" = "Cleric") && (%Research.Active = 0)) then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 60)) then gosub CHARGE_ORB %OM.Mana
          }
     var PerceiveTime $gametime
     return
PERCEIVE_HEALTH_TIMER:
     if matchre("%PHealthTime", "$^") then var PHealthTime $gametime
     evalmath PHealthLast ($gametime - %PHealthTime)
     if (%PHealthLast < 280) then return
     if ($Empathy.LearningRate < 34) then gosub PERCEIVE_HEALTH
     var PHealthTime $gametime
     return
BACKSTAB_TIMER:
     if matchre("%BackstabTime", "$^") then var BackstabTime $gametime
     evalmath BackstabLast ($gametime - %BackstabTime)
     if (%BackstabLast < 800) then return
     var BackstabTime $gametime
     var Switch 1
     return
SCREAM_TIMER:
     if ($UC_Scream = 0) then return
     if !matchre("$guild", "Bard") then return
     if matchre("%ScreamTime", "$^") then var ScreamTime $gametime
     evalmath ScreamLast ($gametime - %ScreamTime)
     if (%ScreamLast < 150) then return
     gosub SCREAM
     var ScreamTime $gametime
     return
WHISTLE_TIMER:
     if ($UC_Whistle = 0) then return
     if !matchre("$guild", "Bard") then return
     if matchre("%WhistleTime", "$^") then var WhistleTime $gametime
     evalmath WhistleLast ($gametime - %WhistleTime)
     if (%WhistleLast < 180) then return
     gosub WHISTLE
     var WhistleTime $gametime
     return
CYCLIC_TIMER:
     if !matchre("$guild", "%MAGICUSER") then return
     if matchre("%%GuildType.Cyclics", "(?i)(NULL|OFF|^%|^\s*$)") then return
     if matchre("%CyclicTime", "$^") then var CyclicTime $gametime
     evalmath CyclicLast ($gametime - %CyclicTime)
     if (%CyclicLast < 300) then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then gosub SPELL_WAIT
     gosub CYCLIC
     if !matchre("$guild", "Barbarian") then return
     var CyclicTime $gametime
     return
WARHORN_TIMER:
     if !matchre("$guild", "Barbarian|Bard") then return
     if (matchre("$guild", "Bard") && (%Backtraining = 1)) then return
     if matchre("%WarhornTime", "$^") then var WarhornTime $gametime
     evalmath WarhornLast ($gametime - %WarhornTime)
     if (%WarhornLast < 900) then return
     gosub WARHORN
     var WarhornTime $gametime
     return
ROAR_TIMER:
     if !matchre("$guild", "Barbarian") then return
     if matchre("%RoarTime", "$^") then var RoarTime $gametime
     evalmath RoarLast ($gametime - %RoarTime)
     if (%RoarLast < 400) then return
     gosub ROAR
     var RoarTime $gametime
     return
BARB_TIMER:
     if matchre("%BarbBuffTime", "$^") then var BarbBuffTime $gametime
     evalmath BarbBuffLast ($gametime - %BarbBuffTime)
     if (%BarbBuffLast < 230) then return
     gosub BARB_CHECK
     var BarbBuffTime $gametime
     return
SUMMONDROP_TIMER:
     if matchre("%SummonDropTime", "$^") then var SummonDropTime $gametime
     evalmath SummonDropLast ($gametime - %SummonDropTime)
     return
SUMMON_TIMER:
     if !matchre("$guild", "Warrior Mage") then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if matchre("%SummonTime", "$^") then var SummonTime $gametime
     evalmath SummonLast ($gametime - %SummonTime)
     if (%SummonLast < 280) then return
     gosub SUMMON_CHECK
     var SummonTime $gametime
     return
PRAY_TIMER:
     if ("$guild" != "Cleric") then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if matchre("%PrayTime", "$^") then var PrayTime $gametime
     evalmath PrayLast ($gametime - %PrayTime)
     if (%PrayLast < 240) then return
     if ($Theurgy.LearningRate < 34) then gosub PRAY
     var PrayTime $gametime
     return
PRAYBADGE_TIMER:
     if !matchre("$guild", "Paladin|Cleric") then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if matchre("%PrayBadgeTime", "$^") then var PrayBadgeTime $gametime
     evalmath PrayBadgeLast ($gametime - %PrayBadgeTime)
     if (("$guild" = "Cleric") && (%PrayBadgeLast < 4800)) then return
     if (("$guild" = "Paladin") && (%PrayBadgeLast < 1860)) then return
     gosub PRAY_BADGE
     var PrayBadgeTime $gametime
     return
TESSERA_TIMER:
     if matchre("%TesseraTime", "$^") then var TesseraTime $gametime
     evalmath TesseraLast ($gametime - %TesseraTime)
     if (%TesseraLast < 250) then return
     if ($Trading.LearningRate > 10) then return
     gosub TRADER_AURA
     if (%aurafull = 1) then goto TESSERA_GO
     if (($circle <= 15) && (%aura < 2) && (%aurafull = 0)) then
          {
               echo *** AURA TOO LOW (%aura) - SKIPPING TESSERA
               return
          }
     if (($circle > 15) && ($circle <= 30) && (%aura < 4) && (%aurafull = 0)) then
          {
               echo *** AURA TOO LOW (%aura) - SKIPPING TESSERA
               return
          }
     if (($circle > 30) && ($circle <= 50) && (%aura < 6) && (%aurafull = 0)) then
          {
               echo *** AURA TOO LOW (%aura) - SKIPPING TESSERA
               return
          }
     if (($circle > 50) && ($circle < 90) && (%aura < 7) && (%aurafull = 0)) then
          {
               echo *** AURA TOO LOW (%aura) - SKIPPING TESSERA
               return
          }
     if ((%aura < 8) && (%aurafull = 0)) then
          {
               echo *** AURA TOO LOW (%aura) - SKIPPING TESSERA
               return
          }
TESSERA_GO:
     if !matchre("$lefthand", "Empty") then gosub STOWIT left
     gosub GET tessera
     pause 0.2
     pause 0.1
     gosub GLANCE
     pause 0.0001
     pause 0.0001
     if !matchre("$righthand $lefthand", "(?i)tessera") then
          {
               put #var UC_Tessera 0
               return
          }
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     send ask tessera about invest
     wait
     pause 0.0001
     gosub STOWIT tessera
     var TesseraTime $gametime
     return
APPARATUS_TIMER:
     if !matchre("$roomobjs", "apparatus") then return
     if matchre("%ApparatusTime", "$^") then var ApparatusTime $gametime
     evalmath ApparatusLast ($gametime - %ApparatusTime)
     if (%ApparatusLast < 240) then return
     put invoke apparatus
     pause 0.5
     var ApparatusTime $gametime
     return
CRYSTAL_TIMER:
     if matchre("%CrystalTime", "$^") then var CrystalTime $gametime
     evalmath CrystalLast ($gametime - %CrystalTime)
     if ($concentration < 100) then return
     if (%CrystalLast < 250) then return
     if ($Arcana.LearningRate > 32) then return
     if (%NecroHealing = 1) then return
     if ($invisible = 1) then gosub STOP_INVIS
     gosub GET san crystal
     pause 0.2
     var CrystalTime $gametime
     send exhale my crystal
     pause 0.1
     pause 0.0001
     pause 0.0001
     gosub WEAR crystal
     if matchre("$righthand $lefthand", "(?i)crystal") then gosub STOWIT crystal
     return
EGG_TIMER:
     if matchre("%EggTime", "$^") then var EggTime $gametime
     evalmath EggLast ($gametime - %EggTime)
     if (%EggLast < 900) then return
     send invoke my egg
     pause 0.3
     pause 0.0001
     var EggTime $gametime
     return
WAND_TIMER:
     #debug 5
     if matchre("%WandTime", "$^") then var WandTime $gametime
     evalmath WandLast ($gametime - %WandTime)
     if (%WandLast < 1800) then return
     ## if ((%WandLast < 3600) && matchre("%Wand2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then return
     if (%WandLast > 3600) then
          {
               var Wand1.Use 0
               var Wand2.Use 0
          }
     gosub WAND_IT
WAND_RESET:
     #debug 0
     return
ASTROLABE_TIMER:
     if matchre("%AstrolabeTime", "$^") then var AstrolabeTime $gametime
     evalmath AstrolabeLast ($gametime - %AstrolabeTime)
     if ((%AstrolabeLast < 1750) && (%Astro1.Used = 1)) then return
     if ((%AstrolabeLast < 3600) && (%Astro2.Used = 1)) then return
     gosub ASTROLABE_GO
     if (%AstrolabeLast > 3680) then
          {
               var AstrolabeTime $gametime
               var Astro1.Used 0
               var Astro2.Used 0
          }
     return
QUICKEN_TIMER:
     if !matchre("$guild", "Necromancer") then return
     if (%Backtraining = 1) then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if matchre("%QuickenEarthTime", "$^") then var QuickenEarthTime $gametime
     evalmath QuickenEarthLast ($gametime - %QuickenEarthTime)
     if (%QuickenEarthLast < 350) then return
     gosub QUICKEN_EARTH_CHECK
     var QuickenEarthTime $gametime
     return
DUALWIELD_TIMER:
     if matchre("%DualWieldTime", "$^") then var DualWieldTime $gametime
     evalmath DualWieldLast ($gametime - %DualWieldTime)
     if (%DualWieldLast < 280) then return
     gosub DW_SWITCH
     var DualWieldTime $gametime
     return
RECALL_TIMER:
     if matchre("%RecallTime", "$^") then var RecallTime $gametime
     evalmath RecallLast ($gametime - %RecallTime)
     if (%RecallLast < 220) then return
     gosub RECALL
     var RecallTime $gametime
     return
ALTWEAPON_TIMER:
     if matchre("%AltWeaponTime", "$^") then var AltWeaponTime $gametime
     evalmath AltWeaponLast ($gametime - %AltWeaponTime)
     if (!matchre("%ALTWEAPON1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("%ALTWEAPON" != "%ALTWEAPON1") && !matchre("%ALTWEAPON1", "%WEAPON")) then var ALTWEAPON %ALTWEAPON1
     if (!matchre("%ALTWEAPON2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("%ALTWEAPON" != "%ALTWEAPON2") && !matchre("%ALTWEAPON2", "%WEAPON")) then var ALTWEAPON %ALTWEAPON2
     if (!matchre("%ALTWEAPON3", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("%ALTWEAPON" != "%ALTWEAPON3") && !matchre("%ALTWEAPON2", "%WEAPON")) then var ALTWEAPON %ALTWEAPON3
     if (matchre("%ALTWEAPON2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%ALTWEAPON3", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%ALTWEAPON1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ALTWEAPON %ALTWEAPON1
     if (matchre("%ALTWEAPON1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%ALTWEAPON2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%ALTWEAPON3", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ALTWEAPON NULL
     if (%AltWeaponLast < 220) then return
     var AltWeaponTime $gametime
     return
BUFF_TIMER:
     if matchre("%BuffTime", "$^") then var BuffTime $gametime
     evalmath BuffLast ($gametime - %BuffTime)
     if ("$guild" = "Thief") then goto THIEF_CHECK
     if ("$guild" = "Barbarian") then goto BARB_CHECK
     if (%Research.Active = 1) then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if (%BuffLast < 160) then return
     gosub BUFF_CHECK
     if ("$guild" = "Warrior Mage") then gosub SUMMON_TIMER
     var BuffTime $gametime
     return
THIEF_CHECK:
     if ("$guild" != "Thief") then return
     if matchre("%BuffTime", "$^") then var BuffTime $gametime
     evalmath BuffLast ($gametime - %BuffTime)
     if (%BuffLast < 90) then return
     if ($Khri.Town = 0) then
          {
               if (%InCombat = 0) then return
          }
     gosub KHRI
     var BuffTime $gametime
     return
BARB_CHECK:
     if ("$guild" != "Barbarian") then return
     if matchre("%BuffTime", "$^") then var BuffTime $gametime
     evalmath BuffLast ($gametime - %BuffTime)
     if (%BuffLast < 70) then return
     gosub BARB_START
     var BuffTime $gametime
     return
AIM_TIMER:
     delay 0.0001
     var AimTime $gametime
     return
CAST_TIMER:
     if matchre("%CastTime", "$^") then var CastTime $gametime
     evalmath CastLast ($gametime - %CastTime)
     if ((%CastLast < 10) && ("%BUFFING" != "ON")) then return
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if (%MAGIC.SNAP != 0) then
          {
               if (%CastLast >= %MAGIC.SNAP) then var spellPrepped 1
          }
     if (%spellExpired = 1) then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
               var spellExpired 0
          }
     if ($spelltime >= 25) then var spellPrepped 1
     if (%spellPrepped = 1) then gosub SPELL_CAST
     return
TRAINERLOOP_TIMER:
     if matchre("%TrainerLoopTime", "$^") then var TrainerLoopTime $gametime
     evalmath TrainerLoopLast ($gametime - %TrainerLoopTime)
     return
EMPATHWAIT_TIMER:
     if matchre("%WaitTime", "$^") then var WaitTime $gametime
     evalmath EmpathWaitTime ($gametime - %WaitTime)
     return
TOWN_TIMER:
     if matchre("%TownTime", "$^") then var TownTime $gametime
     evalmath TownTimeLast ($gametime - %TownTime)
     return
#############################################################################
#### GLOBAL TIMERS
SETUP_TIMER:
     if !def(UC_Setup.Time) then put #var UC_Setup.Time $gametime
     put #var UC_Setup.Last {#evalmath ($gametime - $UC_Setup.Time)}
     return
JOURNAL_TIMER:
     if !def(UC_Journal.Time) then put #var UC_Journal.Time $gametime
     put #var UC_Journal.Last {#evalmath ($gametime - $UC_Journal.Time)}
     if ($UC_Journal.Last >= 86399) then return
     return
LOCKPICK_TIMER:
     if !def(UC_Lockpick.Time) then put #var UC_Lockpick.Time $gametime
     put #var UC_Lockpick.Last {#evalmath ($gametime - $UC_Lockpick.Time)}
     if ($UC_Lockpick.Last >= 86399) then return
     return
ALIGN_TIMER:
     if !def(UC_Align.Time) then put #var UC_Align.Time $gametime
     put #var UC_Align.Last {#evalmath ($gametime - $UC_Align.Time)}
     return
COMBAT_TIMER:
     if !def(UC_Combat.Time) then put #tvar UC_Combat.Time $gametime
     put #tvar UC_Combat.Last {#evalmath ($gametime - $UC_Combat.Time)}
     if ((%Backtraining = 0) && ($UC_MaxTrain != 0)) then
          {
               if ($UC_Combat.Last > $UC_MaxTrain) then goto ESCAPE.TIMER
          }
     if ((%Backtraining = 1) && (%BACKTRAIN.TIME != 0)) then
          {
               if ($UC_Combat.Last > %BACKTRAIN.TIME) then goto ESCAPE.TIMER
          }
     if (("$guild" = "Necromancer") && (%NecroHealing = 1)) then
          {
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto DONE_NECROHEALING
          }
     return
############################################################################################################
BARD_CHECK:
     gosub SCREAM_TIMER
     gosub WHISTLE_TIMER
     return
###################################################################
### BORED ROUTINE (NO MONSTERS DETECTED)
###################################################################
BORED:
     delay 0.0001
     timer stop
     var BoredCount 0
     var CURRENT BORED ROUTINE
     action var Collect.Combat 0 when ^You survey the area and realize that any collecting efforts would be futile\.
     # action put #queue clear;goto NOT_BORED when .* begins to advance on you\!|.* closes to (melee|pole) range
STILL_BORED:
     delay 0.0001
     pause 0.0001
     math BoredCount add 1
     gosub STATUSBAR
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     gosub DARK_CHECK
     echo
     echo #######################
     echo * NO MONSTERS DETECTED!
     echo * (Room Objects: $roomobjs )
     echo * BORED ROUTINE INITIATED
     echo #######################
     echo
     pause 0.2
     ##if ((%BoredCount > 1) && ($UC_Roaming = 1) && ("%CRITTER.ROOMS" != "NULL")) then gosub MOVE_ROOMS
     if ((%BoredCount > 5) && ($UC_Roaming = 1)) then gosub MOVE_ROOMS
     if (%BoredCount > 25) then
          {
               echo
               echo #####################
               echo *** AUTOMOVE ERROR??
               echo *** 25+ Bored Loops and no monsters
               echo *** Reverting back to travel to Combat
               echo #############$#######
               echo
               pause 0.7
               put #queue clear
               gosub clear
               goto FIND_CRITTER
          }
     if ($spellEOTB = 1) then gosub RELEASE eotb
     pause 0.0001
     if !matchre("$lefthand", "Empty") then gosub STOWIT left
     if (%Playing = 0) then gosub PLAY
     gosub RETRIEVE_CHECK
     gosub BUFF_TIMER
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then goto NOT_BORED
     # if ($UC_Tarantula = 1) then gosub TARANTULA_TIMER
     # if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then goto NOT_BORED
     if ($pathway = 1) then send path stop
     pause 0.0001
     pause 0.0001
     # if contains("$roomobjs", "%Critter") then goto NOT_BORED
     if matchre("$guild", "%MAGICUSER") then gosub PERCEIVE_TIMER
     if (($UC_Crystal = 1) && ($UC_CrystalCombat = 1)) then gosub CRYSTAL_TIMER
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then goto NOT_BORED
     if ("$guild" = "Moon Mage") then
          {
               if (($Astrology.LearningRate < 34) && (%Observe = 1)) then gosub OBSERVE_CHECK
          }
     if (contains("$monsterlist", "%critters") || ($monstercount)) then goto NOT_BORED
     if ("$guild" = "Warrior Mage") then
          {
               if (%Playing = 1) then gosub STOP_PLAY
               put summon admit
               delay 1
               put summon imp
               pause 2
               pause
          }
     if (contains("$monsterlist", "%critters") || ($monstercount)) then goto NOT_BORED
     if ("$guild" = "Paladin") then
          {
               gosub PRAYBADGE_TIMER
               pause 0.5
          }
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then goto NOT_BORED
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 90)) then gosub CHARGE_ORB %OM.Mana
               gosub PRAY_TIMER
               pause 0.5
               if ($standing = 0) then gosub STAND
               gosub PRAYBADGE_TIMER
          }
     if ($standing = 0) then gosub STAND
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then goto NOT_BORED
     if ($UC_Textbook = 1) then gosub TEXTBOOK_TIMER
     if (($UC_Textbook = 1) && (%TextbookLast > 90)) then
          {
               pause 0.0001
               if !matchre("$righthand $lefthand", "(?i)%TEXTBOOK.TYPE") then gosub GET my %TEXTBOOK.TYPE
               if matchre("$righthand $lefthand", "(?i)%TEXTBOOK.TYPE") then gosub TEXTBOOK_READ once
               pause 0.0001
               if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub PUT put %TEXTBOOK.TYPE in my $UC_Container.Textbook
               if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub STOW my %TEXTBOOK.TYPE
          }
     pause 0.0001
     pause 0.1
     if (contains("$monsterlist", "%critters") || ($monstercount)) then goto NOT_BORED
BORED_CONTINUE:
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if ($standing = 0) then gosub STAND
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if (%Playing = 0) then gosub PLAY
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then goto NOT_BORED
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     pause 0.0001
     if matchre("%APP.ITEMS", "(?i)(ON|1|YES)") then
          {
               if !matchre("%app1", "(?i)(NULL|OFF|^%|^\s*$)") then put app my %app1
               pause
               pause 0.2
               if ($monstercount) then goto NOT_BORED
               if !matchre("%app2", "(?i)(NULL|OFF|^%|^\s*$)") then put app my %app2
               pause
               pause 0.5
               if ($monstercount) then goto NOT_BORED
               if !matchre("%app3", "(?i)(NULL|OFF|^%|^\s*$)") then put app my %app3
               pause
               pause 0.5
          }
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then goto NOT_BORED
     if matchre("$righthand $lefthand", "(?i)%TEXTBOOK.TYPE") then gosub STOW my %TEXTBOOK.TYPE
     if (%Playing = 1) then
          {
               put stop play
               var Playing 0
               pause 0.2
          }
     pause 0.0001
     pause 0.0001
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     pause 0.0001
     pause 0.0001
     if (%Collect.Combat = 1) then
          {
               gosub COLLECT %Collect
               gosub KICKEM
          }
     if ($standing = 0) then gosub STAND
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then goto NOT_BORED
     pause
     if (($monstercount = 0) || !matchre("$roomobjs", "(?i)%critters")) then goto STILL_BORED
NOT_BORED:
     delay 0.001
     action remove .* begins to advance on you\!|.* closes to (melee|pole) range
     action remove ^You survey the area and realize that any collecting efforts would be futile\.
     if matchre("$righthand $lefthand", "(?i)%TEXTBOOK.TYPE") then gosub STOW my %TEXTBOOK.TYPE
     if (%Playing = 1) then
          {
               put stop play
               var Playing 0
               pause 0.2
          }
     timer start
     # debug 0
     unvar BoredCount
     return
##################################################################################################
MOVE_ROOMS:
     var rooms.moved 0
     gosub FEET_CHECK
     gosub stowammo
MOVE_ROOMS_1:
     echo
     echo ############
     echo *** MOVING ROOMS!
     echo ############
     echo
     pause 0.1
     pause 0.0001
     pause 0.0001
     if matchre("$roomobjs","(?i)apparatus") && ("$guild" = "Trader") then gosub GET apparatus
     if (($roomid = 0) || matchre("%CRITTER.ROOMS", "(?i)(NULL|OFF|^%|^\s*$)")) then
          {
               echo **** CRITTER ROOMS NOT DEFINED OR IN A ROOMID 0 ROOM
               echo **** MOVING AROUND RANDOMLY
               gosub RANDOMMOVE
               pause 0.1
               send search
               wait
               pause 0.7
               pause 0.1
               if ("$roomplayers" != "") then gosub RANDOMMOVE
               send search
               wait
               pause 0.7
               pause 0.1
               if ("$roomplayers" != "") then goto MOVE_ROOMS_1
               echo #############
               echo ** FOUND NEW ROOM!
               echo ** ROOMID = $roomid
               echo #############
               var BoredCount 0
               put #tvar spellETF 0
               return
          }
     eval totalrooms count("%CRITTER.ROOMS", "|")
MOVE_ROOMS_2:
     pause 0.1
     if (%rooms.moved > %totalrooms) then
          {
               echo *** NO MORE ROOMS TO CHECK
               return
          }
     if (%CRITTER.ROOMS(%rooms.moved) = $roomid) then
          {
               math rooms.moved add 1
               goto MOVE_ROOMS_1
          }
     if ("%CRITTER.ROOMS(%rooms.moved)" = "") then
          {
               math rooms.moved add 1
               goto MOVE_ROOMS_1
          }
     gosub AUTOMOVE %CRITTER.ROOMS(%rooms.moved)
     pause 0.2
     send search
     wait
     pause 0.7
     pause 0.1
     if ("$roomplayers" != "") then
          {
               math rooms.moved add 1
               goto MOVE_ROOMS_1
          }
     send search
     wait
     pause 0.7
     pause 0.1
     if ("$roomplayers" != "") then
          {
               math rooms.moved add 1
               goto MOVE_ROOMS_1
          }
     echo
     echo ###############
     echo ** FOUND NEW HUNTING ROOM
     echo ** ROOMID = $roomid
     echo ###############
     echo
     var BoredCount 0
     put #tvar spellETF 0
     if matchre("$righthand $lefthand", "(?i)apparatus") then
          {
               put drop apparatus
               pause 0.4
          }
     unvar rooms.moved
     unvar BoredCount
     unvar totalrooms
     return
#################################################################################
### CHECK DEAD MONSTERS / SKINNING / RITUALS / LOOTING
####################################
PARSE_DEAD:
     var i 0
     var TotalDeads 0
     var Objects $roomobjs
     var ObjectsCount 0
     pause 0.0001
     eval Objects replacere("%Objects", ",", "|")
     eval Objects replace("%Objects", " and ", "|")
     eval Objects replace("%Objects", ".$", "|")
     eval ObjectsCount count("%Objects", "|")
     if (%ObjectsCount = 0) then return
PARSE_DEAD_1:
     pause 0.0001
     var mob %Objects(%i)
     if (%i <= %ObjectsCount) then
          {
               if (matchre("%mob", "(?i)((?:which|that) appears dead|\(dead\)|pile of rubble|pile of broken ice|icy blue crystal|small sand dune|smoldering bones)") then
                    {
                         math TotalDeads add 1
                    }
               math i add 1
               goto PARSE_DEAD_1
          }
     unvar i
     unvar mob
     unvar Objects
     unvar ObjectsCount
     return

CHECKDEAD:
     # debuglevel 10
     gosub DEAD_TIMER
     gosub PARSE_DEAD
     if ((%deadCheckTime < 12) && (%TotalDeads < 2)) then return
     echo *** Dead Found: %TotalDeads
     var skinned 0
     var newdead 1
     var facing NULL
     if (%TotalDeads > 1) then
          {
               math TotalKills add %TotalDeads
          }
     else
          {
               math TotalKills add 1
          }
     if (($UC_DualWield = 1) && !matchre("$lefthand", "Empty")) then gosub STOWIT left
LAST_RITES:
     if ("$guild" = "Cleric") then
          {
               if (($UC_meraud = 1) && !matchre("%Critter", "(%Undead|%CursedMonsters)")) then
                    {
                    math prayloop add 1
                         if (%prayloop > 2) then
                              {
                                   var prayloop 0
                                   send pray %Critter
                                   pause 0.5
                                   pause 0.2
                              }
                    }
          }
     if (!matchre("$roomobjs", "(?i)(%critters) ((?:which|that) appears dead|\(dead\))") && !matchre("$roomobjs", "(pile of rubble|pile of broken ice)")) then
          {
               # if ("$preparedspell" != "None") then gosub RELEASE spell
               pause 0.01
               pause 0.01
               if ($UC_LootMonsters = 1) then put loot
               pause 0.01
               if (($UC_Looting = 1) && (%Foci.Active = 0)) then gosub AUTOLOOT
               if (%Foci.Active = 0) then gosub RETRIEVE_CHECK
               gosub STATUSBAR
               var DeadTime $gametime
               var newdead 0
               return
          }
CHECKSKINS:
     if (%Foci.Active = 1) then goto CHECKING_LOOT
     # if ("$preparedspell" != "None") then gosub CAST_TIMER
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if (matchre("$roomobjs", "(?i)(%critters) ((?:which|that) appears dead|\(dead\))") || matchre("$roomobjs", "(pile of rubble|pile of broken ice)")) then
          {
               # if contains("$lefthand $righthand", "(?i)%WEAPON") then gosub stowing
               if ("$guild" = "Necromancer") then
                    {
                         gosub NECROHEAL_TIMER
                         if ((!matchre("$roomobjs", "(?i)(%Constructs|%Undead) ((?:which|that) appears dead|\(dead\))") && ($UC_NecroHeal = 1) && (%Divine.Outrage < 4) && (%NecroHealLast > 160) && ($SpellTimer.Devour.active = 0)) || ((!matchre("$roomobjs", "(?i)(%Constructs|%Undead) ((?:which|that) appears dead|\(dead\))") && (%NecroHealing = 1) && ($SpellTimer.Devour.active = 0))) then gosub NECROHEAL
                         if matchre("%NecroRitual","(?i)ON") then
                              {
                                   if matchre("$roomobjs", "(?i)(%RitualMonsters) ((which|that) appears dead|\(dead\))") then gosub NECRO_RITUALS
                              }
                         if (%skinned = 1) then goto CHECKING_LOOT
                    }
               # if matchre("$roomobjs", "(?i)(%Construct|%Undead) ((which|that) appears dead|\(dead\))") then goto CHECKING_LOOT
               if (($UC_Skin = 1) || ($UC_Dissect = 1)) then
                    {
                         gosub SKIN_TIMER
                         echo ** Last Skin: %skinLastTime seconds
                         if (%skinLastTime < 15) then goto CHECKING_LOOT
                         if (matchre("$roomobjs", "(?i)(%skinnablecritters) ((which|that) appears dead|\(dead\))") || (matchre("$roomobjs", "(?i)(%critters) ((?:which|that) appears dead|\(dead\))"))) then gosub SKIN_SUB
                    }
          }
CHECKING_LOOT:
     if ($UC_Looting = 0) then
          {
               echo
               echo *** LOOTING IS ~OFF~ - NOT PICKING UP LOOT
               echo
               put loot
               pause 0.2
               if (%Foci.Active = 0) then gosub RETRIEVE_CHECK
               goto END_DEAD
          }
     #if (toupper("%SKIN") != "OFF") then gosub SKIN_SUB
     var autoloot 0
     if ($UC_LootMonsters = 1) then gosub MONSTER_SEARCH
     if (%Foci.Active = 0) then gosub RETRIEVE_CHECK
     if (%Foci.Active = 0) then gosub AUTOLOOT
     if (%TotalDeads > 1) then
          {
               math TotalDeads subtract 1
               goto CHECKSKINS
          }
END_DEAD:
     var DeadTime $gametime
     var newdead 0
     var Empath.Critter NULL
     ### GET / CHECK WEAPONS
     #if !contains("$righthand" , "(?i)%WEAPON") && !contains("$lefthand" , "(?i)%WEAPON") then gosub CLEARHANDS
     if (("$preparedspell" != "None") && ($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then
                    {
                         math spellcount subtract 1
                         gosub RELEASE spell
                         gosub RELEASE_CAMB
                    }
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (!matchre("$righthand" , "(?i)%WEAPON") && !matchre("%WEAPON", "(?i)($charactername|NULL)") && ("%WEAPON_EXP" != "Brawling")) then
          {
          if (($UC_Bonded = 1) && (%ammolodged = 1)) then
               {
                    pause 0.0001
                    send invoke
                    pause 0.2
                    pause 0.1
                    if matchre("$righthand", "Empty") then send invoke
                    pause 0.2
                    pause 0.1
                    if matchre("$righthand $lefthand", "(?i)%WEAPON") then var ammolodged 0
               }
          if (!matchre("($righthand|$lefthand)", "(?i)%WEAPON") && !matchre("$UC_WeaponType","BRAWL") && (%Foci.Active = 0)) then gosub WIELD %WEAPON
          }
     if (("$guild" = "Barbarian") && ($UC_DualWield = 1) && ("$lefthand" = "Empty") && !matchre("$UC_WeaponType","(OFFHAND|THE|THB|CROSSBOW|XBOW|SLINGS|BOW|POLEARMS)")) then gosub WIELD_LEFT %CurrentDW
     gosub STATUSBAR
     if (%deadCheckTime > 10) then gosub RECALL_TIMER
     # debuglevel 0
     var ammolodged 0
     var skinned 0
     if ("$guild" = "Empath") then
          {
               if matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub ASSESS
               if (!matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then gosub ASSESS
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (matchre("$monsterlist", "(?i)%Undead") && ($SpellTimer.Absolution.duration < 2) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
          }
     return
#### SKINNING PREP / SKIN PREP
SKIN_SUB:
     delay 0.0001
     var arrangecount 0
     if (!matchre("$righthand", "Empty")  && !matchre("$lefthand", "Empty") && ("$UC_WeaponType" != "OFFHAND") && !contains("$lefthand", "%WM.Weapon")) then gosub SHEATH_LEFT $lefthandnoun
     if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty")  && ("$UC_WeaponType" = "OFFHAND") && !contains("$righthand", "%WM.Weapon") && (%Foci.Active = 0)) then gosub SHEATH $righthandnoun
     if ($UC_BeltKnife = 0) then
          {
               # if contains("$lefthand $righthand", "(?i)%WEAPON") then gosub CLEARHANDS
               gosub CLEARHANDS
               gosub WIELD_SKINNER
               gosub SWAP
          }
     if ("$guild" = "Necromancer") then goto NECRO_RITUALS
#######################################################################
#### REAL SKINNING SECTION
SKIN_REAL:
     var skinned 0
     var dissected 0
     if (("$guild" != "Ranger") && ($UC_Arrange = 1)) then
          {
               if (($UC_ArrangeAlways = 0) && ($Skinning.LearningRate < 33) && ($Skinning.Ranks < 1750)) then gosub ARRANGE
               if ($UC_ArrangeAlways = 1) then gosub ARRANGE
          }
     if (("$guild" = "Ranger") && ($UC_Arrange = 1)) then gosub ARRANGE
     # if ($UC_Bundle = 1) then gosub CLEARHANDS

     ### EMPTY LEFT HAND FOR COLLECTING SKIN
     if (("$UC_WeaponType" != "OFFHAND") && !matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty") && !contains("$lefthand", "%WM.Weapon") && !matchre("$lefthand", "$UC_Skinner")) then gosub STOWIT $lefthand
     ### EMPTY RIGHT HAND FOR COLLECTING SKIN IF TRAINING OFFHAND
     if (("$UC_WeaponType" = "OFFHAND") && !matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty") && !contains("$righthand", "%WM.Weapon") && (%Foci.Active = 0) && !matchre("$righthand", "$UC_Skinner")) then gosub STOWIT $righthand
     ### EMPTY LEFT HAND IF NOT EMPTY AND NO SKINNER IN LEFT HAND
     if (!matchre("$lefthand", "Empty") && !matchre("$lefthand", "$UC_Skinner")) then gosub STOWIT $lefthand
     ### EMPTY BOTH HANDS IF BELT KNIFE IS OFF
     if (($UC_BeltKnife = 0) then gosub STOWING
     ### WIELD SKINNER IF BELT KNIFE IS OFF
     if (($UC_BeltKnife = 0) && !matchre("$righthand $lefthand", "$UC_Skinner")) then gosub WIELD_SKINNER
##### HERE WE CHOOSE WHETHER TO USE DISSECT OR SKINNING - DEPENDING ON THE CURRENT LEARNINGRATE OF FIRST AID / SKINNING
##### WILL IGNORE THIS SECTION IF DISSECT IS TURNED OFF OR FA RANKS MAXED
     if (($First_Aid.Ranks < 1750) && ($circle > 9) && matchre("%DISSECTING", "(?i)ON") && ($UC_Dissect = 1)) then
          {
               if matchre("$roomobjs", "(?i)(%Construct) ((which|that) appears dead|\(dead\))") then
                    {
                         echo ** Dead Construct - No Dissect
                         goto SKIN_REAL_1
                    }
               if ((($First_Aid.Ranks <= $Skinning.Ranks) && (%dissectloop < 6)) || (($Skinning.Ranks > 1749) && (%dissectloop < 8) && ($First_Aid.LearningRate < 34)) || !matchre("$roomobjs", "(?i)(%skinnablecritters) ((which|that) appears dead|\(dead\))")) then
                    {
                         if ($First_Aid.LearningRate > 33) then goto SKIN_REAL_2
                         echo *** Choosing Dissect
                         gosub DISSECT_MONSTER
                         if (%dissected = 1) then goto SKIN_REAL_2
                    }
               if ((($Skinning.Ranks <= $First_Aid.Ranks) && ($Skinning.LearningRate < $First_Aid.LearningRate)) || ($First_Aid.LearningRate > 33)) then
                    {
                         echo *** Choosing Skinning
                         gosub SKIN_MONSTER
                         goto SKIN_REAL_2
                    }
               if (($First_Aid.LearningRate < $Skinning.LearningRate) && (%dissected = 0) && (%dissectloop < 8) && ($First_Aid.LearningRate < 34)) then
                    {
                         echo *** Choosing Dissect 2
                         gosub DISSECT_MONSTER
                         if (%dissected = 1) then goto SKIN_REAL_2
                    }
               if ((($First_Aid.LearningRate > $Skinning.LearningRate) && ($Skinning.LearningRate < 34)) || ($Skinning.LearningRate < 34)) then
                    {
                         echo *** Choosing Skinning 2
                         gosub SKIN_MONSTER
                         goto SKIN_REAL_2
                    }
          }
##### HERE IS THE ACTUAL SKIN SECTION - SKIPS THIS SECTION IF WE ALREADY DISSECTED
##### HERE WE CHECK IF THE MONSTER IS A SKINNABLE CREATURE - AND SKIPS SKINNING IF NOT
SKIN_REAL_1:
     if !matchre("$roomobjs", "(?i)(%skinnablecritters) ((which|that) appears dead|\(dead\))") then goto SKIN_REAL_2
     if (%dissected = 0) then gosub SKIN_MONSTER
##### FINISHED WITH SKINNING / DISSECTING SECTION
SKIN_REAL_2:
##### RESET COUNT TO CYCLE SKIN/DISSECT IF COUNT OVER 9
     if (%skinningcount > 8) then
          {
               var dissectcount 0
               var skinningcount 0
               var dissectloop 0
          }
     gosub SKIN_CHECK
     if matchre("$lefthand $righthand", "$UC_Skinner") then gosub SHEATH_SKINNER
     goto SKIN_RETURN
SKIN_CHECK:
     if matchre("$lefthand $righthand", "$UC_Skinner") then gosub SHEATH_SKINNER
     if !matchre("$lefthand", "%Skinables") then
          {
               if !matchre("$righthand", "%Skinables") then goto SKIN_RETURN
          }
     var skinned 1
     if matchre("($righthand $lefthand)", "material") then
               {
                    put drop material
                    pause 0.4
                    gosub GLANCE
               }
     if ($UC_Bundle = 0) then
          {
               echo ** Bundling is OFF - Dropping skin
               if matchre("$righthandnoun", "(%Skinables)") then gosub EMPTY $1
               if matchre("$lefthandnoun", "(%Skinables)") then gosub EMPTY $1
               goto BUNDLE_OFF
          }
     # if (($UC_SummonWeapons = 1) && (%summoning = 1) && contains("$lefthand", "%WM.Weapon")) then gosub STOWIT $lefthand
     # if (($UC_SummonWeapons = 1) && (%summoning = 1) && contains("$righthand", "%WM.Weapon")) then gosub STOWIT $lefthand
     pause 0.00001
     if matchre("$righthand $lefthand", "%Skinables") then gosub BUNDLE_ON
     if matchre("$lefthandnoun $righthandnoun", "%Skinables") then gosub BUNDLE_ON
     # if !matchre("$righthand", "Empty") && !matchre("$righthand", "(?i)%WEAPON") && (%Foci.Active = 0) then gosub STOWIT right
     # if !matchre("$lefthand", "Empty") && !matchre("$lefthand", "(?i)%WEAPON") then gosub STOWIT left
     # if matchre("$roomobjs" , "(lumpy|tight) bundle") then put get bundle
     #########
     if matchre("$righthandnoun", "(%Skinables)") then gosub STOWIT right
     if matchre("$lefthandnoun", "(%Skinables)") then gosub STOWIT left
     return
############################################################################
#### NECRO RITUAL LOGIC - SET RITUAL CRITTER AND DECIDE WHICH RITUAL TO USE
NECRORITUAL:
NECRO_RITUALS:
     echo
     echo ############
     echo # NECRO RITUALS
     echo # Choosing Ritual...
     echo # Current DO: %Divine.Outrage/4
     echo ############
     echo
     if matchre("$roomobjs", "(?i)(%RitualMonsters) ((which|that) appears dead|\(dead\))") then
          {
               var Ritual.critter $1
               ### STRIP TO ROOT NAME
               eval Ritual.critter replacere("%Ritual.critter", "([\w'-]+\s){0,5}", "")
               if matchre("%Ritual.critter", "(suw bizar|bizar)") then var Ritual.critter puddle
               if matchre("%Ritual.critter", "belly crocodile") then var Ritual.critter crocodile
               echo *** Ritual.critter: %Ritual.critter
          }
     # var Ritual.critter %Critter
     # eval Ritual.critter tolower("%Ritual.critter")
     if matchre("%NecroRitual", "(?i)(OFF|NULL|NIL)") then goto SKIN_REAL
     if (($Skinning.LearningRate = 34) && ($First_Aid.LearningRate = 34) && ($Thanatology.LearningRate = 34)) then
          {
               echo ** Skipping Necro Ritual - All relevant skills are locked!
               goto SKIN_REAL
          }
     if !matchre("%Critter", "(%Construct|%Undead)") then
          {
               if (($UC_Arrange = 1) && ($Skinning.LearningRate < 32) && matchre("$roomobjs", "(?i)(%skinnablecritters) ((which|that) appears dead|\(dead\))")) then gosub ARRANGE
               gosub NECRO_ANALYZE
               if (($UC_Risen) && (%zombie = 1)) then
                    {
                         if (($Shield_Usage.LearningRate < 30) || ($Parry_Ability.LearningRate < 30) || (%necro.weapon_average < 27)) then gosub LEAVE_COMMAND
                    }
               if ((($UC_Risen) && !contains("$roomobjs", "arisen")) || (($UC_Risen) && (%zombie = 0))) then
                    {
                         if (($Shield_Usage.LearningRate >= 32) && ($Parry_Ability.LearningRate >= 32) && (%necro.weapon_average > 27)) then gosub COME_COMMAND
                    }
               gosub TARGET_RITUAL
			if (($UC_Risen) && ($circle > 25) && !matchre("$roomobjs", "arisen") && (%zombie = 0) && (%activezombie = 0) && (%Divine.Outrage < 3) && (%NecroHealing = 0)) then
                    {
                         gosub PRESERVE
                         goto NECRO_ARISE
                    }
               # if matchre(tolower("$roomobjs", "(%skinnablecritters) ((which|that) appears dead|\(dead\))") && ($Skinning.LearningRate < $Thanatology.LearningRate) && ($Skinning.LearningRate < $First_Aid.LearningRate) then goto SKIN_REAL
               if (matchre("$roomobjs", "(?i)(%skinnablecritters) ((which|that) appears dead|\(dead\))") && ($UC_Arrange = 1) && ($Skinning.LearningRate < 30) && ($Skinning.LearningRate <= $First_Aid.LearningRate)) then gosub ARRANGE
               if (($circle = 1) || (%NecroHealing = 1)) then
                    {
                         gosub PRESERVE
                         goto SKIN_REAL
                    }
               if ($circle = 1) then goto SKIN_REAL
               if (!matchre("$roomobjs", "(?i)(%skinnablecritters) ((which|that) appears dead|\(dead\))") && ($circle < 10) && (%Divine.Outrage > 2)) then goto SKIN_RETURN
               ####################################################
               if (%Know.Butchery = 1) then gosub BUTCHERY_TIMER
               if ((%Know.Butchery = 1) && (%ButcheryLast > 600) && (%Divine.Outrage < 3)) then
                    {
                         gosub PRESERVE
                         goto NECRO_BUTCHERY
                    }
               if (($First_Aid.LearningRate <= $Skinning.LearningRate) && ($circle > 9) && (%NecroHealing = 0)) then goto NECRO_DISSECT
               if (($Skinning.LearningRate <= $First_Aid.LearningRate) && ($Skinning.LearningRate <= $Thanatology.LearningRate) && (%Divine.Outrage < 3)) then
                    {
                         gosub PRESERVE
                         if (%NecroHealing = 0) then goto NECRO_HARVEST
                    }
               if (($First_Aid.LearningRate < 34) && ($circle > 9) && ($Skinning.LearningRate > 6) && (%NecroHealing = 0)) then goto NECRO_DISSECT
               if (($Thanatology.LearningRate > $Skinning.LearningRate) && ($First_Aid.LearningRate > $Skinning.LearningRate)) then goto SKIN_REAL
               if (($Skinning.LearningRate < 34) && (%Divine.Outrage < 3) && (%NecroHealing = 0)) then
                    {
                         gosub PRESERVE
                         goto NECRO_HARVEST
                    }
          }
     goto SKIN_REAL

NECRO_ANALYZE:
     evalmath necro.weapon_average ($Light_Thrown.LearningRate + $Small_Edged.LearningRate + $Large_Edged.LearningRate + $Twohanded_Edged.LearningRate + $Small_Blunt.LearningRate + $Large_Blunt.LearningRate + $Twohanded_Blunt.LearningRate + $Staves.LearningRate + $Polearms.LearningRate + $Bow.LearningRate + $Crossbow.LearningRate + $Slings.LearningRate + $Heavy_Thrown.LearningRate + $Brawling.LearningRate) / 14
     if ($Targeted_Magic.LearningRate < 30) then var necro.weapon_average 34
     return
NECRO_DISSECT:
     var Nec.Ritual dissect
     var skinned 1
     gosub NECRO_RITUAL
     goto SKIN_CHECK
NECRO_HARVEST:
     var Nec.Ritual harvest
     var skinned 1
     if !matchre("$lefthand", "%Empty") then gosub STOWIT left
     gosub NECRO_RITUAL
     pause 0.2
     if matchre("($righthand $lefthand)", "material") then
          {
               if ((%Necro.Material > 5) || !matchre("%spelltimer", "(?i)Devour")) then
                    {
                         put drop material
                         pause 0.5
                         goto SKIN_CHECK
                    }
               math Necro.Material add 1
               gosub STOWIT material
          }
     pause 0.3
     goto SKIN_CHECK
NECRO_BUTCHERY:
     var skinned 1
     var Nec.Ritual butchery
     gosub STOWING
     gosub NECRO_RITUAL
     var ButcheryTime $gametime
     if matchre("($righthand $lefthand)", "(arm|leg|head|torso|eye|wing|brain)") then
          {
               gosub STOWIT $1
               math Necro.Parts add 1
          }
     goto SKIN_CHECK
NECRO_ARISE:
     var Nec.Ritual arise
     var skinned 1
     gosub NECRO_RITUAL
     gosub ARISE
     goto SKIN_CHECK
TARGET_RITUAL:
     var number.critter
     var necroordinal first|second|third|fourth|fifth|sixth|seventh|eighth|nineth|tenth|eleventh
	var tempobjs $roomobjs
     eval tempobjs replacere("%tempobjs", "^You also see", "")
     eval tempobjs replace("%tempobjs", ", ", "|")
     eval totalobjs count("%tempobjs", "|")
     var objcount 0
     var crittercount 0
TARGET_RITUAL_1:
     if (%objcount > %totalobjs) then goto TARGET_RITUAL_NONE
     if matchre("%tempobjs(%objcount)", "%RitualMonsters (?:that|which) appears dead|%RitualMonsters \(dead\)" then
          {
               var number.critter %necroordinal(%crittercount)
               return
          }
     if matchre("%tempobjs(%objcount)", "%RitualMonsters") then
          {
               math objcount add 1
               math crittercount add 1
               goto TARGET_RITUAL_1
          }
     math objcount add 1
     goto TARGET_RITUAL_1
TARGET_RITUAL_NONE:
     var number.critter
     return
PRESERVE_BUMP:
     math crittercount add 1
     if (%crittercount > $monstercount) then return
     if (%crittercount > 5) then return
     var number.critter %necroordinal(%crittercount)
PRESERVE:
     delay 0.0001
     if matchre("%Ritual.critter", "(suw bizar|bizar)") then var Ritual.critter puddle
     if matchre("%Ritual.critter", "belly crocodile") then var Ritual.critter crocodile
     if matchre("%number.critter", "first") then var number.critter
     var LOCATION PRESERVE_1
     PRESERVE_1:
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre PRESERVE_BUMP ^This ritual may only be performed on a corpse\.|^This ritual may only be performed on a creature's corpse\.
     matchre RETURN ^A failed or completed ritual has rendered this corpse unusable for your purposes\.
     matchre RETURN ^You bend over .* corpse to make a few quick\, precise motions with your ritual knife\, focusing your thanatological insight intently in order to preserve it from the natural decay of the elements for a time\.
     matchre RETURN ^You bend over .* corpse to make one long\, continuous cut with your ritual knife that just barely pierces into it\.\s+Unseen energies seep into the creature's fluids\, suspending the corpse in unnatural stasis for a time\.
     matchre RETURN ^This corpse has already been preserved\.
     matchre RETURN ^The \w+ ritual.+performed on this corpse prevents
     matchre RETURN ^Roundtime
     matchre RETURN ^Rituals do not work
     matchre RETURN ^You need a hand free
     matchre RETURN ^You cannot
     if ("%number.critter" = "") then send perform preserve on %Ritual.critter
     else send perform preserve on %number.critter %Ritual.critter
     matchwait 9
     put #echo Gold *** MISSING MATCH IN PRESERVE! ***
     put #log *** MISSING MATCH IN PRESERVE! ***
     return
RITUAL_BUMP:
     math crittercount add 1
     if (%crittercount > $monstercount) then return
     if (%crittercount > 3) then var number.critter
     if (%crittercount > 4) then return
     var number.critter %necroordinal(%crittercount)
NECRO_RITUAL:
     var LOCATION NECRO_RITUAL
     pause 0.0001
     math RitualLoop add 1
     matchre NECRO_RITUAL ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RITUAL_BUMP ^This ritual may only be performed on a corpse\.
     matchre RITUAL_BUMP ^This ritual may only be performed on a creature's corpse\.
     matchre RETURN ^The \w+ ritual.+performed on this corpse prevents
     matchre RETURN ^A failed or completed ritual has rendered this corpse unusable for your purposes\.
     matchre RETURN ^You bend over .* corpse to make a few quick\, precise motions with your ritual knife\, focusing your thanatological insight intently in order to preserve it from the natural decay of the elements for a time\.
     matchre RETURN ^You bend over .* corpse to make one long\, continuous cut with your ritual knife that just barely pierces into it\.\s+Unseen energies seep into the creature's fluids\, suspending the corpse in unnatural stasis for a time\.
     matchre RETURN ^This corpse has already been preserved\.
     matchre RETURN ^Roundtime
     matchre RETURN ^Rituals do not work
     matchre RETURN ^You need a hand free
     matchre RETURN ^Making several
     matchre RETURN ^You begin to dismember
     matchre RETURN ^You cannot
     put perform %Nec.Ritual on %number.critter %Ritual.critter
     matchwait 9
     put #echo Gold *** MISSING MATCH IN NECRO_RITUAL! ***
     put #log *** MISSING MATCH IN NECRO_RITUAL! ***
     return
ARRANGE:
     delay 0.0001
     var LOCATION ARRANGE_1
     var arrangecount 0
     ARRANGE_1:
     math arrangecount add 1
     if (($UC_ArrangeAlways = 0) && ($Skinning.Ranks < 1750)) then return
     if ((%arrangecount = 2) && ($UC_ArrangeAll = 0)) then return
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if ((%arrangecount > 1) && ("%Nec.Ritual" = "dissect")) then var Nec.Ritual harvest
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre ARRANGE_1 ^You continue arranging .* in a manner that\, while making the process of obtaining .* more difficult\, guarantees a greater reward\.
     matchre ARRANGE_1 ^You begin to arrange .* in a manner that\, while making the process of obtaining .* more difficult\, guarantees a greater reward\.
     matchre ARRANGE_1 ^You make a mistake in the arranging process\, but manage not to damage the corpse\.
     matchre ARRANGE_PART ^That creature cannot produce skins\.
     matchre ARRANGE_SKIN That creature cannot produce a skinnable part\.
     matchre RETURN ^You complete arranging .* in a manner that\, while making the process of obtaining .* more difficult\, guarantees a greater reward\.
     matchre RETURN ^You make a .*mistake in the arranging process\, damaging the very trophy you were hoping to get\!  The corpse is worthless now\.
     matchre RETURN ^.* has already been arranged as much as you can manage\.
     matchre RETURN ^Try killing .* before you arrange it\.
     matchre RETURN ^Arrange what\?
     matchre RETURN ^The .* cannot be skinned\, so you can't arrange it either\.
     if !matchre("$UC_ArrangeTarget", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               if (($UC_ArrangeAll = 1) && ($UC_ArrangeMax = 1)) then send arrange all for $UC_ArrangeTarget
               else send arrange for $UC_ArrangeTarget
          }
     else send arrange for $UC_ArrangeTarget
     matchwait 9
     return
ARRANGE_PART:
     delay 0.0001
     var LOCATION ARRANGE_PART_1
     var arrangecount 0
     ARRANGE_PART_1:
     if ((%arrangecount = 2) && ($UC_ArrangeAll = 0)) then return
     math arrangecount add 1
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre ARRANGE_SKIN That creature cannot produce a skinnable part\.
     matchre ARRANGE_PART_1 ^You continue arranging .* in a manner that\, while making the process of obtaining .* more difficult\, guarantees a greater reward\.
     matchre ARRANGE_PART_1 ^You begin to arrange .* in a manner that\, while making the process of obtaining .* more difficult\, guarantees a greater reward\.
     matchre ARRANGE_PART_1 ^You make a mistake in the arranging process\, but manage not to damage the corpse\.
     matchre RETURN ^You complete arranging .* in a manner that\, while making the process of obtaining .* more difficult\, guarantees a greater reward\.
     matchre RETURN ^You make a .*mistake in the arranging process\, damaging the very trophy you were hoping to get\!  The corpse is worthless now\.
     matchre RETURN ^.* has already been arranged as much as you can manage\.
     matchre RETURN ^Try killing .* before you arrange it\.
     matchre RETURN ^Arrange what\?
     matchre RETURN ^The .* cannot be skinned\, so you can't arrange it either\.
     if (($UC_ArrangeAll = 1) && ($UC_ArrangeMax = 1)) then send arrange all for part
     else send arrange for part
     matchwait 9
     return
ARRANGE_SKIN:
     delay 0.0001
     var LOCATION ARRANGE_SKIN
     var arrangecount 0
     ARRANGE_SKIN_1:
     if ((%arrangecount = 2) && ($UC_ArrangeAll = 0)) then return
     math arrangecount add 1
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre ARRANGE_SKIN_1 ^You continue arranging .* in a manner that\, while making the process of obtaining .* more difficult\, guarantees a greater reward\.
     matchre ARRANGE_SKIN_1 ^You begin to arrange .* in a manner that\, while making the process of obtaining .* more difficult\, guarantees a greater reward\.
     matchre ARRANGE_SKIN_1 ^You make a mistake in the arranging process\, but manage not to damage the corpse\.
     matchre RETURN ^You complete arranging .* in a manner that\, while making the process of obtaining .* more difficult\, guarantees a greater reward\.
     matchre RETURN ^You make a .*mistake in the arranging process\, damaging the very trophy you were hoping to get\!  The corpse is worthless now\.
     matchre RETURN ^.* has already been arranged as much as you can manage\.
     matchre RETURN ^Try killing .* before you arrange it\.
     matchre RETURN ^Arrange what\?
     matchre RETURN ^The .* cannot be skinned\, so you can't arrange it either\.
     if (($UC_ArrangeAll = 1) && ($UC_ArrangeMax = 1)) then send arrange all for skin
     else send arrange for skin
     matchwait 9
     return
SKIN_MONSTER:
     delay 0.0001
     var LOCATION SKIN_MONSTER_1
     SKIN_MONSTER_1:
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SKIN_SUCCESS ^You skillfully peel .* off .*\.
     matchre SKIN_SUCCESS ^You manage
     matchre SKIN_SUCCESS ^You skin .* fairly well, getting a decent quality .* only slightly tainted with gore and fluids from the carcass\.
     matchre SKIN_SUCCESS ^You struggle with
     matchre SKIN_SUCCESS ^You work hard at peeling
     matchre SKIN_SUCCESS ^You work diligently at skinning
     matchre SKIN_SUCCESS ^You carefully fit .* into your bundle\.
     matchre SKIN_SUCCESS ^With preternatural poise
     matchre SKIN_SUCCESS ^Working deftly, you skillfully
     matchre SKIN_SUCCESS ^You slice away a bloody trophy
     matchre SKIN_FAIL ^The .* already been skinned\, there's no point\.
     matchre SKIN_FAIL ^You will need a more appropriate tool for skinning\.
     matchre SKIN_FAIL ^You fumble and make an improper cut
     matchre SKIN_FAIL ^You make a series of cuts
     matchre SKIN_FAIL ^A heartbreaking slip at the last moment
     matchre SKIN_FAIL ^You bumble the attempt, destroying .* corpse\.
     matchre SKIN_FAIL ^You'll need to have
     matchre SKIN_FAIL ^You claw at .* in a futile attempt to skin it, mangling it beyond recognition\.
     matchre SKIN_FAIL ^You work at .*, but end up destroying the .*\.
     matchre SKIN_FAIL ^Despite your best efforts, skinning .* just isn't going to happen this time\.
     matchre SKIN_FAIL ^Some days it just doesn't pay to wake up\.
     matchre SKIN_FAIL ^Your .* twists and slips in your grip, causing a catastrophic loss of control at a vital juncture in your skinning attempt\.
     matchre SKIN_FAIL ^Somehow managing to do EVERYTHING wrong, you bungle your pitiful attempt to gain a trophy from the .*\.
     matchre SKIN_FAIL ^What were you referring to\?
     matchre SKIN_FAIL ^I could not find what you were referring to\.
     matchre SKIN_FAIL ^Living creatures often object to being flayed alive\.  Why not wait until .* is dead\?
     matchre SKIN_FAIL ^You approach .*'s kill.*and prepare to skin it\!
     matchre SKIN_FAIL ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre SKIN_FAIL ^A.* cannot be skinned\.
     matchre SKIN_FAIL ^The.* cannot be skinned\.
     matchre SKIN_FAIL ^A.* can't be skinned\.
     matchre SKIN_FAIL ^The.* can't be skinned\.
     matchre SKIN_FAIL ^There isn't another .* to skin\.
     matchre SKIN_FAIL ^Skin what\?
     send skin
     matchwait 12
     return
SKIN_FAIL:
     echo ** Skin Fail!
     math skinningcount add 1
     var skinTime $gametime
     pause 0.0001
     return
SKIN_SUCCESS:
     math TotalSkins add 1
     math skinningcount add 1
     var skinned 1
     var skinTime $gametime
     echo ** Skin Success!
     echo ** (Total Skins: %TotalSkins)
     return
DISSECT_MONSTER:
     delay 0.0001
     var dissectcount 0
     var LOCATION DISSECT_MONSTER_1
DISSECT_MONSTER_1:
     math dissectloop add 1
     pause 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre DISSECT_SUCCESS ^You .*\bdissect
     matchre DISSECT_SUCCESS ^You .*You succeed in dissecting the corpse\.
     matchre DISSECT_SUCCESS ^With .*You succeed in dissecting the corpse\.
     matchre DISSECT_SUCCESS ^You carefully position the corpse and make a cut across its length
     matchre DISSECT_SUCCESS ^You smoothly open the corpse
     matchre DISSECT_SUCCESS ^Expertly adapting to the ravages of combat, you work around the
     matchre DISSECT_SUCCESS You succeed in dissecting the corps
     matchre DISSECT_SUCCESS ^With skill and no small amount of luck, you manage to dissect the corpse
     matchre DISSECT_FAIL You'll gain no insights from this attempt\.
     matchre DISSECT_FAIL ^With less concern than you'd give a fresh corpse
     matchre DISSECT_FAIL_2 ^While likely a fascinating study, .* would not be useful to your understanding of First Aid\.
     matchre DISSECT_FAIL_2 ^What exactly are you trying to dissect\?
     matchre DISSECT_FAIL_2 ^That'd be a waste of time\.|^You believe the .* would probably object to you trying to do that
     matchre DISSECT_FAIL_2 ^You'll learn nothing further of value from the .* mutilated remains\.
     matchre DISSECT_FAIL_2 ^[\[ \(]?Roundtime.*[\] \)]?
     send dissect
     matchwait 5
     return
DISSECT_SUCCESS:
     math dissectcount add 1
     var dissected 1
     var skinTime $gametime
     echo *** Dissect Success!
     return
DISSECT_FAIL:
     var dissected 0
     math dissectfail add 1
     echo ** Dissect Fail
     var skinTime $gametime
     pause 0.1
     if (%dissectfail = 2) then
          {
               echo
               echo ################
               echo *** 2 Dissect Fails
               echo *** Skipping to Skinning
               echo ################
               echo
               return
          }
     if (%dissectfail > 30) then
          {
               echo
               echo #############################
               echo *** 30 Total Dissect Fails - Monster too hard??
               echo *** Turning DISSECT OFF THIS RUN***
               echo #############################
               echo
               var DISSECTING OFF
               return
          }
     goto DISSECT_MONSTER_1
DISSECT_FAIL_2:
     echo ** No Dissect Target
     var dissected 0
     return
#### NEW BUNDLE CREATION SUB
BUNDLE_ON:
     var LOCATION BUNDLE_ON
LUMPY_BUNDLE:
     var LOCATION LUMPY_BUNDLE
     pause 0.0001
     if !matchre("$righthand $lefthand", "%Skinables") then return
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre HAVE_ONE ^You tap a lumpy bundle that you are wearing|^You tap a tight bundle that you are wearing
     matchre HAVE_ONE ^You tap a lumpy bundle|^You tap a tight bundle
     matchre LUMPY_BUNDLE_2 I could not find what you were|tight bundle inside
     put tap lump bundle
     matchwait 20
     goto CHECK_ROPE
LUMPY_BUNDLE_2:
     if !matchre("%ALLCONTAINERS", "(?i)(eddy|portal)") then goto TIGHTBUNDLE
     var LOCATION LUMPY_BUNDLE_2
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre HAVE_ONE ^You tap a lumpy bundle that you are wearing|^You tap a tight bundle that you are wearing
     matchre HAVE_ONE ^You tap a lumpy bundle|^You tap a tight bundle
     matchre TIGHTBUNDLE I could not find what you were|tight bundle inside
     put tap lump bundle in my watery portal
     matchwait 20
     goto CHECK_ROPE
TIGHTBUNDLE:
     var LOCATION TIGHTBUNDLE
     if (($righthand != "Empty") && !matchre("$righthandnoun", "%Skinables")) then gosub STOWIT right
     if (($lefthand != "Empty") && !matchre("$lefthandnoun", "%Skinables")) then gosub STOWIT left
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre HAVE_ONE_2 ^You tap a lumpy bundle that you are wearing|^You tap a tight bundle that you are wearing
     matchre HAVE_ONE_2 ^You tap a lumpy bundle|^You tap a tight bundle
     matchre TIGHTBUNDLE_2 I could not find what you were|^Please rephrase|^What were
     put tap tight bundle
     matchwait 20
     goto CHECK_ROPE
TIGHTBUNDLE_2:
     if !matchre("%ALLCONTAINERS", "(?i)(eddy|portal)") then goto CHECK_ROPE
     var LOCATION TIGHTBUNDLE
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre HAVE_ONE_2 ^You tap a lumpy bundle that you are wearing|^You tap a tight bundle that you are wearing
     matchre HAVE_ONE ^You tap a lumpy bundle|^You tap a tight bundle
     matchre CHECK_ROPE I could not find what you were|^Please rephrase|^What were
     put tap tight bundle in my watery portal
     matchwait 20
     goto CHECK_ROPE
CHECK_ROPE:
     pause 0.0001
     var LOCATION CHECK_ROPE
     if !matchre("$righthand $lefthand", "%Skinables") then return
     if (($righthand != "Empty") && !matchre("$righthandnoun", "%Skinables")) then gosub STOWIT right
     if (($lefthand != "Empty") && !matchre("$lefthandnoun", "%Skinables")) then gosub STOWIT left
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre GET_ROPE ^You tap
     matchre ROPE_DOUBLECHECK ^I could not find|^What were you|^Please rephrase|^What were
     put tap bund rope
     matchwait 20
     goto BUNDLE_OFF
ROPE_DOUBLECHECK:
     if !matchre("%ALLCONTAINERS", "(?i)(eddy|portal)") then goto NO_MORE_ROPE
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre GET_ROPE ^You tap
     matchre NO_MORE_ROPE ^I could not find|^What were you|^Please rephrase|^What were
     put tap bund rope in my watery portal
     matchwait 20
     goto BUNDLE_OFF
NO_MORE_ROPE:
     put #echo >Log #EDC64E *** Ran out of bundling rope!
     echo
     echo ################
     echo *** Out of bundling rope!
     echo *** Turning ON Rope Restock!
     echo ################
     echo
     put #parse GO SELL SKINS!
     put #parse OUT.OF.ROPE!
     var NeedRope 1
     var Bundle OFF
     put #tvar UC_Bundle 0
     var BUNDLE OFF
     goto BUNDLE_OFF
GET_ROPE:
     var LOCATION GET_ROPE
     pause 0.0001
     if matchre("$righthandnoun", "%Skinables") then gosub SWAP
     if (!matchre("$righthand", "Empty") && !matchre("$righthandnoun", "%Skinables")) then gosub STOW $righthandnoun
     if (!matchre("$lefthand", "Empty") && !matchre("$lefthandnoun", "%Skinables")) then gosub STOW $lefthandnoun
     pause 0.001
GET_ROPE_CONT:
     pause 0.0001
     var BundleTied 0
     put get my bundling rope
     pause 0.3
     pause 0.0001
     pause 0.0001
     if !matchre("$lefthand $righthand", "rope") then
          {
               put get bundling rope from my watery portal
               pause 0.3
          }
     put bundle
     wait
     pause 0.1
     pause 0.0001
     gosub GLANCE
     pause 0.0001
TIE_CHECK:
     pause 0.0001
     put #echo >Log #22FFAB ** New bundle started
     if (($UC_TieBundle = 1) || ($UC_F2P = 1)) then
          {
               if (%BundleTied = 0) then
                    {
                         var BundleTied 1
                         put tie my bundle
                         pause 0.0001
                         pause 0.0001
                         put tie my bundle
                         wait
                         pause 0.0001
                    }
               if ((%Bundle.Wear = 1) && matchre("$lefthand $righthand", "bundle")) then put adjust my bundle
               pause 0.1
          }
     pause 0.0001
     if contains("%WM.Weapon", "$roomobjs") then gosub GET %WM.Weapon
HAVE_ONE:
     if ("$righthandnoun" != "Empty") then gosub STOWIT right
     if (!matchre("$lefthandnoun $righthandnoun", "bundle") || (%Bundle.Wear = 0)) then gosub GET my bundle
     if (!matchre("$lefthandnoun $righthandnoun", "bundle") || (%Bundle.Wear = 0)) then gosub GET my lumpy bundle
     pause 0.0001
     # if !matchre("$lefthandnoun $righthandnoun", "bundle") then put remove bundle
HAVE_ONE_2:
     if matchre("$lefthand", "Empty") then goto BUNDLE_OFF
     if matchre("$righthand", "%Skinables") then
          {
               send swap
               wait
               pause 0.0001
          }
     pause 0.0001
     pause 0.0001
     if (!matchre("$lefthand $righthand", "%Skinables") && matchre("$lefthand $righthand", "bundle") && (%Bundle.Wear = 1)) then goto WEAR_BUNDLE
     matchre HAVE_ONE_2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre TIE_BUNDLE Time to start a new bundle|not going to work
     matchre TOO_HEAVY ^You try to stuff your
     matchre BUNDLE_OFF You stuff|You carefully
     matchre HAVE_ONE_3 ^What were you referring to\?|^I could not|^Please rephrase|^What were
     put put my $lefthandnoun in my bundle
     # put put my $lefthandnoun in bundle
     matchwait 20
     goto BUNDLE_OFF
HAVE_ONE_3:
     if matchre("$righthand", "%Skinables") then
          {
               send swap
               wait
               pause 0.0001
          }
     pause 0.0001
     pause 0.0001
     if (!matchre("$lefthand $righthand", "%Skinables") && matchre("$lefthand $righthand", "bundle") && (%Bundle.Wear = 1)) then goto WEAR_BUNDLE
     matchre HAVE_ONE_3 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre TIE_BUNDLE Time to start a new bundle|not going to work
     matchre TOO_HEAVY ^You try to stuff your
     matchre BUNDLE_OFF You stuff|You carefully
     matchre CHECK_ROPE ^I could not|^Please rephrase|^What were
     put put my $lefthandnoun in my bundle in my watery portal
     # put put my $lefthandnoun in bundle
     matchwait 20
     goto BUNDLE_OFF
TIE_BUNDLE:
     pause 0.0001
     pause 0.0001
     # if ($UC_TieBundle = 0) then
          # {
               # echo
               # echo ########################
               # echo *** TIE BUNDLE IS OFF!
               # echo *** NO MORE ROOM IN BUNDLE!
               # echo #########################
               # echo
               # if matchre("$lefthand", "%Skinables") then send drop %lefthand
               # if matchre("$righthand", "%Skinables") then send drop %righthand
               # pause 0.1
               # gosub REMOVE bundle
               # pause 0.1
               # gosub STOWIT bundle
               # pause 0.1
               # goto CHECK_ROPE
          # }
     if (%TotalSkins > 200) then goto TOO_HEAVY
     if matchre("$lefthand $righthand", "bundle") then
          {
               if ($UC_TieBundle = 1) then
                    {
                         if (%BundleTied = 0) then
                              {
                                   put tie my bundle
                                   pause 0.2
                                   put tie my bundle
                                   var BundleTied 1
                                   wait
                                   pause 0.1
                              }
                         # if (%Bundle.Wear = 1) then put adjust my bundle
                         pause 0.1
                    }
          }
     pause 0.0001
     if matchre("$lefthand $righthand", "bundle") then gosub WEAR_BUNDLE
     if matchre("$lefthand $righthand", "bundle") then gosub STOWIT bundle
     goto HAVE_ONE_2
TOO_HEAVY:
     var LOCATION TOO_HEAVY
     pause 0.0001
     echo
     echo #############
     echo *** BUNDLE FULL!
     echo *** STOWING BUNDLE
     echo #############
     echo
     pause 0.1
     gosub REMOVE bundle
     pause 0.1
     if (%BundleTied = 0) then
          {
               put tie my bundle
               pause 0.2
               put tie my bundle
               wait
               pause 0.2
               var BundleTied 1
          }
     pause 0.0001
     pause 0.0001
     gosub STOWIT bundle
     math BundleCount add 1
     pause 0.0001
     pause 0.0001
     if (matchre("$lefthand $righthand", "bundle") && (%Bundle.Wear != 0)) then gosub WEAR_BUNDLE
     goto CHECK_ROPE
######################################
WEAR_BUNDLE:
     var bundleloop 0
PULL_BUNDLE:
     math bundleloop add 1
     if (%bundleloop > 11) then goto WEAR_BUNDLE_OFF
     matchre BUNDLE_LOC ^You adjust .+ draped (.*)\.
     matchre BUNDLE_LOC ^You adjust .+ slung (.*)\.
     matchre BUNDLE_LOC (?:on|attached to|around) your (.*)\.
     matchre BUNDLE_RETURN ^I'm afraid that you can't pull that\.
     put pull my bundle
     matchwait 20
     goto BUNDLE_OFF
#####################
BUNDLE_LOC:
     var bundleloc $1
     pause 0.00001
     if ((%bundleloop > 5) && !matchre("%BundleLocation", "(?i)NULL")) then
          {
               echo *** CANNOT FIND OUR LOCATION TO WEAR BUNDLE!
               echo *** SETTING BUNDLELOCATION to NULL
               var BundleLocation NULL
          }
     if (%bundleloop > 10) then goto WEAR_BUNDLE_OFF
     if (matchre("%BundleLocation", "(?i)(overshoulder|oshoulder|over shoulder|over the shoulder)") && !matchre("%bundleloc", "over your shoulder")) then goto PULL_BUNDLE
     if (matchre("%BundleLocation", "(?i)(aroundhoulder|ashoulder|around shoulder|around the shoulder)") && !matchre("%bundleloc", "around your shoulders")) then goto PULL_BUNDLE
     if (matchre("%BundleLocation", "(?i)\bshoulder\b") && !matchre("%bundleloc", "shoulder")) then goto PULL_BUNDLE
     if (matchre("%BundleLocation", "(?i)waist") && !matchre("%bundleloc", "waist")) then goto PULL_BUNDLE
     if (matchre("%BundleLocation", "(?i)belt") && !matchre("%bundleloc", "belt")) then goto PULL_BUNDLE
     if (matchre("%BundleLocation", "(?i)back") && !matchre("%bundleloc", "back")) then goto PULL_BUNDLE
WEAR_BUNDLE_1:
     pause 0.00001
     matchre PULL_BUNDLE ^You can't wear
     matchre BUNDLE_RETURN ^You put|^You attach|^You sling|^You drape|^You are already wearing|Wear what\?
     put wear my bundle
     matchwait 20
     goto BUNDLE_OFF
BUNDLE_RETURN:
     pause 0.00001
     return
#################################
WEAR_BUNDLE_OFF:
     var Bundle.Wear 0
     echo
     echo ############################
     echo *** CANNOT FIND LOCATION TO WEAR BUNDLE!
     echo *** TURNING OFF BUNDLE WEARING!!
     echo ############################
     echo
     put #echo >Log *** NO LOCATION TO WEAR BUNDLE!
     # put #tvar UC_Bundle 0
     put #parse GO.SELL.SKINS!
     if matchre("$lefthand $righthand", "bundle") then
          {
          if ($UC_TieBundle = 1) then
               {
                    if (%BundleTied = 0) then
                         {
                              put tie my bundle
                              pause 0.2
                              put tie my bundle
                              var BundleTied 1
                              wait
                              pause 0.1
                         }
                    if (%Bundle.Wear = 1) then put adjust my bundle
                    pause 0.1
               }
          gosub STOWIT bundle
          }
     if matchre("$lefthandnoun $righthandnoun", "bundle") then send drop bundle
BUNDLE_OFF:
     if matchre("$lefthand $righthand", "bundle") then gosub WEAR_BUNDLE
     #if !matchre("$lefthand", "Empty") then put empty left
     delay 0.0001
SKIN_KNIFE_SHEATH:
     var LOCATION SKIN_KNIFE_SHEATH
     if matchre("$righthand", "belt knife") then put wear knife
     if ("$righthandnoun" = "knife") then send SHEATHE knife
     if ("$lefthandnoun" = "knife") then send SHEATHE knife
SKIN_RETURN:
     delay 0.00001
     # if matchre("$righthand", "(%Skinables)") then gosub EMPTY $1
     # if matchre("$lefthand", "(%Skinables)") then gosub EMPTY $1
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (matchre("$lefthand $righthand", "bundle") && !matchre("%BundleLocation", "(?i)(NULL|NIL|NO)")) then gosub WEAR_BUNDLE
     if matchre("$lefthand $righthand", "bundle") then gosub STOWIT bundle
     if (($UC_BeltKnife = 0) && ("$righthand" != "(?i)%WEAPON")) then gosub stowing
     if contains("$lefthand", "%WM.Weapon") then gosub SWAP
     if (($UC_Bundle = 1) && (%skinned = 1)) then gosub BUNDLE_COUNT
     var skinned 0
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if matchre("$lefthandnoun $righthandnoun", "bundle") then gosub STOWIT bundle
     return
###################################################################
#### BUNDLING SUBS
BUNDLE_COUNT:
     delay 0.00001
     var LOCATION BUNDLE_COUNT_1
     BUNDLE_COUNT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre BUNDLE_SET ^You flip through .* and find (\d+) skins? in it\.
     matchre BUNDLE_COUNT_ALT ^What were you referring to\?
     matchre BUNDLE_COUNT_ALT ^I could not|^Please rephrase|^What were
     matchre BUNDLE_COUNT_ALT ^You count up
     send count my bundle
     matchwait 20
     goto BUNDLE_SET_ZERO
BUNDLE_COUNT_ALT:
     delay 0.00001
     var LOCATION BUNDLE_COUNT_2
     BUNDLE_COUNT_2:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre BUNDLE_SET_ZERO ^What were you referring to\?
     matchre BUNDLE_SET_ZERO ^I could not find what you were referring to\.
     matchre BUNDLE_SET_ZERO ^I could not|^Please rephrase|^What were
     matchre BUNDLE_SET ^You flip through .* and find (\d+) skins? in it\.
     send count my bundle in my watery portal
     matchwait 20
     goto BUNDLE_SET_ZERO
BUNDLE_SET:
     put #tvar UC_bundleFull 0
     put #tvar UC_bundleCount $1
     var TotalSkins $1
     if (($UC_bundleCount > 6) && ($UC_TieBundle = 1) && (%BundleTied = 0)) then
          {
               put tie my bundle
               pause 0.1
               pause 0.001
               put tie my bundle
               pause 0.1
               pause 0.001
               var BundleTied 1
          }
     if (%BundleCount = 1) then
          {
               evalmath TotalSkins ($UC_bundleCount + 200)
          }
     if (%BundleCount = 2) then
          {
               evalmath TotalSkins ($UC_bundleCount + 400)
          }
     if (%BundleCount = 3) then
          {
               evalmath TotalSkins ($UC_bundleCount + 600)
          }
     if (%BundleCount = 4) then
          {
               evalmath TotalSkins ($UC_bundleCount + 800)
          }
     if ($UC_bundleCount >= $UC_bundleMax) then
          {
               if matchre("$UC_bundleMax", "(?i)(NULL|200)") then goto BUNDLE_STORE
               put #tvar UC_bundleFull 1
               gosub BUNDLE_STORE
          }
     gosub STATUSBAR
     return
BUNDLE_STORE:
     delay 0.0001
     gosub REMOVE bundle
     echo #############
     echo *** BUNDLE FULL!
     echo *** STOWING BUNDLE
     echo #############
     pause 0.1
     if (($UC_TieBundle = 1) && (%BundleTied = 0)) then
     {
          put tie my bundle
          pause 0.1
          pause 0.0001
          put tie my bundle
          wait
          pause 0.0001
          pause 0.0001
          var BundleTied 1
     }
     gosub STOWIT bundle
     pause 0.0001
     math BundleCount add 1
     return
###################################################################
### STANDALONE BUNDLE CHECK
BUNDLE_CHECK:
     var skinned 0
     var bundlecheck 0
     var todo bundle
     if (matchre("$lefthandnoun $righthandnoun", "bundle") && (%Bundle.Wear != 0)) then goto BUNDLE_WEAR
     gosub STOWIT bundle
     return
BUNDLE_WEAR:
     math bundlecheck add 1
     if (%bundlecheck > 7) then goto WEAR_BUNDLE_OFF
     delay 0.0001
     pause 0.0001
     var todo bundle
     put pull my bundle
     pause 0.1
     pause 0.0001
     pause 0.0001
     put wear my bundle
     wait
     pause 0.0001
     pause 0.0001
     if !matchre("$lefthand $righthand", "bundle") then return
     goto BUNDLE_WEAR
BUNDLE_SET_ZERO:
     delay 0.0001
     var BundleTied 0
     put #tvar UC_bundleFull 0
     put #tvar UC_bundleCount 0
     return
###################################################################
#### CRITTER SEARCH SECTION
LOOT_MONSTER:
SEARCH_MONSTER:
MONSTER_SEARCH:
     delay 0.0001
     var BoxActive 0
     var Autolooted 0
     action var BoxActive 1 when was carrying.+(skippet|coffer|trunk|chest|strongbox|crate|box|casket|caddy)\!
     action var AutoLooted 1 when You gather up the loot you're interested in and stuff it in your .+\.
     echo
     echo ###############
     echo * LOOTING MONSTER
     echo ###############
     echo
     var looted 0
     var LOCATION MONSTER_SEARCH_1
     MONSTER_SEARCH_1:
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre AUTOLOOT ^It's already been picked clean of anything it might have had\.
     matchre AUTOLOOT ^You should probably wait until .* is dead first\.
     matchre AUTOLOOT ^The .* has already been searched for that\!
     matchre AUTOLOOT ^I could not find what you were referring to\.
     matchre AUTOLOOT ^What were you referring to\?
     matchre AUTOLOOT ^Sheesh, it's still alive\!
     matchre AUTOLOOT ^It's not dead yet\!
     matchre AUTOLOOT ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre MONSTER_SEARCH_2 ^You search|^You find|^Please rephrase|^What were
     matchre AUTOLOOT ^Stow what\?
     send loot $UC_LootOption
     matchwait 20
     goto AUTOLOOT
MONSTER_SEARCH_2:
     if (%TotalDeads < 2) then goto AUTOLOOT
     pause 0.2
     pause 0.1
     send loot $UC_LootOption
     pause 0.4
     pause 0.1
     if (%TotalDeads < 3) then goto AUTOLOOT
     pause 0.1
     send loot $UC_LootOption
     pause 0.4
     pause 0.1
     goto AUTOLOOT
DRAWWEAPON:
     if !matchre("%WEAPON", "(?i)($charactername|NULL)") then gosub WIELD %WEAPON
     return
###############################################################################################################
###############################################################################################################
##### AUTOLOOTING SECTION #####
AUTOLOOT:
     delay 0.00001
     var Loot NULL
     var coinloop 0
     var LOCATION AUTOLOOT
     action remove was carrying.+(skippet|coffer|trunk|chest|strongbox|crate|box|casket|caddy)\!
     action remove You gather up the loot you're interested in and stuff it in your .+\.
     math autoloot add 1
     if ((%BoxActive = 1) && (%AutoLooted = 1)) then
          {
               math TotalBoxes add 1
               echo
               echo ######################
               echo * DETECTED BOX AUTOLOOT!
               echo * Boxcount = %TotalBoxes
               echo ######################
               echo
               var AutoLooted 0
               var BoxActive 0
               pause 0.1
          }
     if (!matchre("$lefthand", "Empty") && !matchre("$righthand", "Empty") && !contains("$lefthand", "%WM.Weapon")) then gosub STOWIT left
     ### WHAT TO DO
     if (%autoloot = 1) then put look
     # if (%autoloot = 6) then put look
     if (%autoloot > 15) then goto LOOT_DONE
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if (!matchre("$lefthand", "Empty") && !matchre("$righthand", "Empty")) then gosub STOWIT left
     # Coins
     if matchre("$roomobjs", "\b(?<!pile of )coins?\b") then gosub GET_COIN
     # Gwethdesuans and Stones
     if matchre("$roomobjs", "\ba.*\sgwethdesuan(\,|\.|\sand)") then var Loot GWETHDESUAN
     if matchre("$roomobjs", "\bsome\s(kyanite|jadeite|waermodi)\sstones(\,|\.|\sand)") then var Loot STONES
     # Gems
     if ($UC_LootGems = 1) then
          {
               math gemLoop add 1
               if matchre("$roomobjs", "\b(%gemlist)\b(,|\.| and)") then goto GET_GEMS
               if matchre("$roomobjs", "\b(%bitch.gems)\b") then send stow gem
               if matchre("$roomobjs", "brilliant icy blue crystal") then var Loot icy crystal
               if matchre("$roomobjs", "crystal shard") then var Loot blue shard
               delay 0.0001
          }
AUTOLOOT2:
     ## PASSES / SUPER RARE STUFF
     if matchre("$roomobjs", "\bpass?\b") then var Loot pass
     if matchre("$roomobjs", "\bfeatherstone\b") then var Loot featherstone
     if matchre("$roomobjs", "iron fragment") then var Loot fragment
     if matchre("$roomobjs", "worn and tattered map") then var Loot map
     if matchre("$roomobjs", "khor'vela branch") then var Loot branch
     if matchre("$roomobjs", "khor'vela chip") then var Loot chip
     if matchre("$roomobjs", "khor'vela limb") then var Loot limb
     if matchre("$roomobjs", "khor'vela shaving") then var Loot shaving
     if matchre("$roomobjs", "khor'vela sprig") then var Loot sprig
     if matchre("$roomobjs", "khor'vela stick") then var Loot stick
     if matchre("$roomobjs", "khor'vela switch") then var Loot switch
     if matchre("$roomobjs", "khor'vela twig") then var Loot twig
     # GORBESH WAR STUFF
     # if matchre("$roomobjs", "crumpled page") then var Loot page
     # if matchre("$roomobjs", "singed page") then var Loot page
     # if matchre("$roomobjs", "broken book spine") then var Loot spine
     # if matchre("$roomobjs", "bloodlock") then var Loot bloodlock
     # if matchre("$roomobjs", "front cover") then var Loot cover
     if ($UC_Looting = 0) then goto LOOT_DONE
     if (%autoloot > 15) then goto LOOT_DONE
     # CHECK FOR METALS
     if ($UC_LootMetals = 1) then
          {
               if matchre("$roomobjs", "\b((?:%RareMetalKeepList)\s(?:bar|tear|lump|hunk|fist|shard|nugget))(?:\,|\.|\sand)") then var Loot $1
               # if matchre("$roomobjs", "\b%RareMetalKeepList\sfragment(\,|\.|\sand)") then var Loot FRAGMENT
          }
     if matchre("$roomname", "Baearholt's Brewery") then
          {
               if matchre("$roomobjs", "\b((?:%metal.list)\s(armband|broom|cup|fork|griddle|knife|lid|pan|plate|pot|spoon|teapot|bowl))(?:\,|\.|\sand)") then var Loot $2
          }
     # Spell Scrolls
     if ($UC_LootScrolls = 1)  then
          {
               if matchre("$roomobjs", "\broll\b") then var Loot roll
               if matchre("$roomobjs", "\btablet\b") then var Loot tablet
               if matchre("$roomobjs", "\bscroll\b") then var Loot scroll
               if matchre("$roomobjs", "\bvellum\b") then var Loot vellum
               if matchre("$roomobjs", "\bostracon\b") then var Loot ostracon
               if matchre("$roomobjs", "(?<!page of )parchment\b") then var Loot parchment
               if matchre("$roomobjs", "\bseishaka leaf\b") then var Loot seishaka leaf
               if matchre("$roomobjs", "\bhhr\'lav\'geluhh bark\b") then var Loot bark
               #####  Magical Devices - RUNESTONES TO KEEP
               if matchre("$roomobjs", "\ba.*asketine\srunestone(\,|\.|\sand)") then var Loot asketine runestone
               if matchre("$roomobjs", "\ba.*avaes\srunestone(\,|\.|\sand)") then var Loot avaes runestone
               if matchre("$roomobjs", "\ba.*axinite\srunestone(\,|\.|\sand)") then var Loot axinite runestone
               if matchre("$roomobjs", "\ba.*azurite\srunestone(\,|\.|\sand)") then var Loot azurite runestone
               if matchre("$roomobjs", "\ba.*calavarite\srunestone(\,|\.|\sand)") then var Loot calavarite runestone
               if matchre("$roomobjs", "\ba.*celestite\srunestone(\,|\.|\sand)") then var Loot celestite runestone
               if matchre("$roomobjs", "\ba.*elbaite\srunestone(\,|\.|\sand)") then var Loot elbaite runestone
               if matchre("$roomobjs", "\ba.*electrum\srunestone(\,|\.|\sand)") then var Loot electrum runestone
               if matchre("$roomobjs", "\ba.*erythrite\srunestone(\,|\.|\sand)") then var Loot erythrite runestone
               if matchre("$roomobjs", "\ba.*hafaltu\srunestone(\,|\.|\sand)") then var Loot hafaltu runestone
               if matchre("$roomobjs", "\ba.*iheaneu'a\srunestone(\,|\.|\sand)") then var Loot iheaneu'a runestone
               if matchre("$roomobjs", "\ba.*ilmenite\srunestone(\,|\.|\sand)") then var Loot ilmenite runestone
               if matchre("$roomobjs", "\ba.*indakar\srunestone(\,|\.|\sand)") then var Loot indakar runestone
               if matchre("$roomobjs", "\ba.*imnera\srunestone(\,|\.|\sand)") then var Loot imnera runestone
               if matchre("$roomobjs", "\ba.*lemicule\srunestone(\,|\.|\sand)") then var Loot lemicule runestone
               if matchre("$roomobjs", "\ba.*malachite\srunestone(\,|\.|\sand)") then var Loot malachite runestone
               if matchre("$roomobjs", "\ba.*quartz\srunestone(\,|\.|\sand)") then var Loot quartz runestone
               if matchre("$roomobjs", "\ba.*rhodonite\srunestone(\,|\.|\sand)") then var Loot rhodonite runestone
               if matchre("$roomobjs", "\ba.*scheelite\srunestone(\,|\.|\sand)") then var Loot scheelite runestone
               if matchre("$roomobjs", "\ba.*selenite\srunestone(\,|\.|\sand)") then var Loot selenite runestone
               if matchre("$roomobjs", "\ba.*sraeth\srunestone(\,|\.|\sand)") then var Loot sraeth runestone
               if matchre("$roomobjs", "\ba.*sunstone\srunestone(\,|\.|\sand)") then var Loot sunstone runestone
               if matchre("$roomobjs", "\ba.*topaz\srunestone(\,|\.|\sand)") then var Loot topaz runestone
               if matchre("$roomobjs", "\ba.*xibaryl\srunestone(\,|\.|\sand)") then var Loot xibaryl runestone
               if matchre("$roomobjs", "\ba.*zengalmi\srunestone(\,|\.|\sand)") then var Loot zengalmi runestone
          }
     # Collectibles
     if ($UC_LootCollectibles = 1) then
          {
               if matchre("$roomobjs", "\ba.*\scard(\,|\.|\sand)") then var Loot CARD
               if matchre("$roomobjs", "\ba.*\sdira(\,|\.|\sand)") then var Loot DIRA
          }
     # Spider Parts
     if ($UC_LootSpiderParts = 1) then
          {
               if matchre("$roomobjs", "\ba.*\snut(\,|\.|\sand)") then var Loot NUT
               if matchre("$roomobjs", "\ba.*\sbolt(\,|\.|\sand)") then var Loot BOLT
               if matchre("$roomobjs", "\ba.*\sgear(\,|\.|\sand)") then var Loot GEAR
               if matchre("$roomobjs", "\ba.*\sflarmencrank(\,|\.|\sand)") then var Loot FLARMENCRANK
               if matchre("$roomobjs", "\ba.*\sspangleflange(\,|\.|\sand)") then var Loot SPANGLEFLANGE
               if matchre("$roomobjs", "\ba.*\sglarmencoupler(\,|\.|\sand)") then var Loot GLARMENCOUPLER
               if matchre("$roomobjs", "\ba.*\srackensprocket(\,|\.|\sand)") then var Loot RACKENSPROCKET
          }
     # if matchre("$roomobjs", "\ba.*\ssoulstone(\,|\.|\sand)") then var Loot soulstone
     # Various other items
     # if matchre("$roomobjs", "\ba\swax\slabel(\,|\.|\sand)") then var Loot label
     # if matchre("$roomobjs", "\ba.*\slockpick(\,|\.|\sand)") then var Loot LOCKPICK
     # if matchre("$roomobjs", "\ba\spouch\sof\slead\spellets(\,|\.|\sand)") then var Loot POUCH
     if matchre("%Loot", "(?i)NULL") then goto LOOT_DONE
     goto GET_LOOT
##### GET COINS #####
GET_COIN:
     pause 0.00001
     math coinloop add 1
     if (%coinloop > 6) then return
     pause 0.00001
     pause 0.00001
     matchre GET_COIN ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre GET_COIN ^You can't do that while entangled in a web\.
     matchre GET_COIN ^You get
     matchre GET_COIN ^You pick up
     matchre RETURN ^What were you referring to\?
     matchre RETURN ^I could not find what were you referring to\.
     matchre RETURN ^There doesn't seem|^Please rephrase|^What were
     send get coin
     matchwait 3
     goto GET_COIN
#### GET & DROP GEMS
LOOT_GEM_ALT:
     if matchre("$lefthand", "(?! topped with)\b(%gemlist)\b") then gosub STOWIT left
     if matchre("$righthand", "(?! topped with)\b(%gemlist)\b") then gosub STOWIT right
     math looted add 1
     pause 0.2
     if (%looted > 1) then goto PUT_GEM_2
     goto GET_GEMS_1
GET_GEM:
GET_GEMS:
     var looted 0
     var pouchFull 0
     var pouchTie 0
     var gemLoop 0
     var GEM NULL
     action var pouchFull 1 when ^You think .* is too full to fit another gem into\.
     action var pouchTie 1 when ^You've already got a wealth of gems
GET_GEMS_1:
     delay 0.0001
     math gemLoop add 1
     if matchre("$roomobjs", "\b(%gemlist)\b(,|\.| and)")) then var GEM $1
     pause 0.0001
     if matchre("%GEM", "icy blue crystal") then var GEM icy crystal
     if matchre("%GEM", "crystal shard") then var GEM blue shard
     if !matchre("$roomobjs", "\b(%gemlist)\b(,|\.| and)")) then goto LOOT_GEM_DONE
     if (%gemLoop > 2) then goto GET_GEMS_3
GET_GEMS_2:
     if (%gemLoop > 5) then goto LOOT_GEM_DONE
     if (($UC_WornPouch = 0) && (%looted = 0)) then goto PUT_GEM
GET_GEMS_3:
     pause 0.0001
     matchre GET_GEMS_3 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre LOOT_GEM_SUCCESS ^You put your|^What were you referring to\?
     matchre LOOT_GEM_SUCCESS ^You open your pouch and put .* inside, closing it once more\.
     matchre PUT_GEM ^Stow what\?  Type 'STOW HELP' for details\.
     matchre NEW_GEM_POUCH ^You think the .+ is too full to fit another gem into\.
     matchre TIE_POUCH ^You've already got a wealth of gems in there\!
     matchre TIE_POUCH ^Picking up .+ would push you over the item limit of 500 items\.
     matchre TIE_POUCH ^You're carrying far too many items already\.
     matchre TIE_POUCH You'd better tie it up before putting more gems inside
     matchre NEW_GEM_POUCH ^You need a free hand to pick that up\.
     matchre PUT_GEM_1 ^There isn't any more room in the
     matchre PUT_GEM_1 even after stuffing it
     matchre PUT_GEM_1 ^You stop
     matchre PUT_GEM_1 ^That's too heavy to go in there
     matchre PUT_GEM_1 no matter how you arrange it
     matchre PUT_GEM_1 ^That's too heavy to go in there
     matchre PUT_GEM_1 ^You're carrying far too many items already\.
     matchre PUT_GEM_1 ^Picking up .* would push you over the item limit of 500 items\.\s*Please reduce your inventory count before you try again\.
     send stow gem
     matchwait 20
     goto DROP_LOOT
STOW_GEM_EMPTY:
     gosub stowing
PUT_GEM:
     pause 0.0001
     if !matchre("$roomobjs", "\b(%gemlist)\b(,|\.| and)")) then goto LOOT_GEM_DONE
     if ("%GEM" = "NULL") then goto GET_GEMS_3
     gosub GET %GEM
     pause 0.0001
     pause 0.0001
PUT_GEM_1:
     pause 0.0001
     if matchre("$lefthand", "sanowret") then gosub STOWIT left
     if matchre("$righthand", "sanowret") then gosub STOWIT left
     if !matchre("$righthand $lefthand", "\b(?i)(%gemlist|%bitch.gems)\b") then goto LOOT_GEM_DONE
     matchre PUT_GEM_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_GEM_EMPTY ^You'll need to be holding
     matchre LOOT_GEM_SUCCESS ^You put your|^You open your|closing it once more|^But that is already
     matchre NEW_GEM_POUCH ^You think the .* is too full to fit another gem into\.
     matchre TIE_POUCH ^You've already got a wealth of gems in there\!|You'd better tie it up before putting more gems inside\.
     matchre TIE_POUCH ^Picking up .* would push you over the item limit of 500 items\.
     matchre TIE_POUCH ^You're carrying far too many items already\.
     matchre LOOT_GEM_DONE Perhaps you should be holding|^What were you|^I could not
     matchre PUT_GEM_2 ^There isn't any more room in the
     matchre PUT_GEM_2 even after stuffing it
     matchre PUT_GEM_2 ^That's too heavy to go in there
     matchre PUT_GEM_2 no matter how you arrange it
     matchre PUT_GEM_2 ^That's too heavy to go in there
     matchre PUT_GEM_2 ^You're carrying far too many items already\.
     matchre PUT_GEM_2 ^What were you|^I could not
     put put %GEM in my %gemPouch
     matchwait 10
     goto PUT_GEM_2
PUT_GEM_2:
     pause 0.0001
     if !matchre("$righthand $lefthand", "\b(?i)(%gemlist|%bitch.gems)\b") then goto LOOT_GEM_DONE
     matchre PUT_GEM_2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_GEM_EMPTY ^You'll need to be holding
     matchre LOOT_GEM_DONE ^What were you|^I could not|^Please rephrase|^What were
     matchre LOOT_GEM_SUCCESS ^You put your|^You open your|closing it once more|^But that is already
     matchre NEW_GEM_POUCH ^You think the .* is too full to fit another gem into\.
     matchre TIE_POUCH ^You've already got a wealth of gems in there\!|You'd better tie it up before putting more gems inside\.
     matchre TIE_POUCH ^Picking up .* would push you over the item limit of 500 items\.
     matchre TIE_POUCH ^You're carrying far too many items already\.
     matchre LOOT_GEM_DONE Perhaps you should be holding|^What were you|^I could not
     matchre PUT_GEM_3 ^There isn't any more room in the
     matchre PUT_GEM_3 even after stuffing it
     matchre PUT_GEM_3 ^That's too heavy to go in there
     matchre PUT_GEM_3 no matter how you arrange it
     matchre PUT_GEM_3 ^That's too heavy to go in there
     matchre PUT_GEM_3 ^You're carrying far too many items already\.
     put put %GEM in %gemPouch in my watery portal
     matchwait 10
     goto PUT_GEM_3
PUT_GEM_3:
     pause 0.0001
     if !matchre("$righthand $lefthand", "\b(?i)(%gemlist|%bitch.gems)\b") then goto LOOT_GEM_DONE
     matchre PUT_GEM_3 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_GEM_EMPTY ^You'll need to be holding
     matchre LOOT_GEM_DONE ^What were you|^I could not|^Please rephrase|^What were
     matchre LOOT_GEM_SUCCESS ^You put your|^You open your|closing it once more|^But that is already
     matchre LOOT_GEM_ALT That can't be picked up|Perhaps you should be holding
     matchre NEW_GEM_POUCH ^You think the .* is too full to fit another gem into\.
     matchre TIE_POUCH ^You've already got a wealth of gems in there\!|You'd better tie it up before putting more gems inside\.
     matchre TIE_POUCH ^Picking up .* would push you over the item limit of 500 items\.
     matchre TIE_POUCH ^You're carrying far too many items already\.
     matchre PUT_GEM_4 ^What were you|^I could not
     matchre PUT_GEM_4 ^There isn't any more room in the
     matchre PUT_GEM_4 even after stuffing it
     matchre PUT_GEM_4 ^That's too heavy to go in there
     matchre PUT_GEM_4 no matter how you arrange it
     matchre PUT_GEM_4 ^That's too heavy to go in there
     matchre DROP_LOOT ^You're carrying far too many items already\.
     put put %GEM in my second %gemPouch
     matchwait 10
     goto PUT_GEM_4
PUT_GEM_4:
     pause 0.0001
     if !matchre("$righthand $lefthand", "\b(%gemlist|%bitch.gems)\b") then goto LOOT_GEM_DONE
     matchre PUT_GEM_4 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_GEM_EMPTY ^You'll need to be holding
     matchre LOOT_GEM_SUCCESS ^You put your|^You open your|closing it once more|^But that is already
     matchre LOOT_GEM_DONE ^What were you|^I could not|^Please rephrase|^What were
     matchre LOOT_GEM_ALT That can't be picked up|Perhaps you should be holding
     matchre NEW_GEM_POUCH ^You think the .* is too full to fit another gem into\.
     matchre TIE_POUCH ^You've already got a wealth of gems in there\!|You'd better tie it up before putting more gems inside\.
     matchre TIE_POUCH ^Picking up .* would push you over the item limit of 500 items\.
     matchre TIE_POUCH ^You're carrying far too many items already\.
     matchre PUT_GEM_5 ^There isn't any more room in the
     matchre PUT_GEM_5 even after stuffing it
     matchre PUT_GEM_5 ^That's too heavy to go in there
     matchre PUT_GEM_5 no matter how you arrange it
     matchre PUT_GEM_5 ^That's too heavy to go in there
     matchre DROP_LOOT ^You're carrying far too many items already\.
     matchre PUT_GEM_5 ^What were you|^I could not
     put put %GEM in second %gemPouch in my watery portal
     matchwait 10
     goto PUT_GEM_5
PUT_GEM_5:
     pause 0.0001
     if !matchre("$righthand $lefthand", "\b(%gemlist|%bitch.gems)\b") then goto LOOT_GEM_DONE
     matchre PUT_GEM_5 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_GEM_EMPTY ^You'll need to be holding
     matchre LOOT_GEM_SUCCESS ^You put your|^You open your|closing it once more|^But that is already
     matchre LOOT_GEM_DONE ^What were you|^I could not|^Please rephrase|^What were
     matchre LOOT_GEM_ALT That can't be picked up|Perhaps you should be holding
     matchre NEW_GEM_POUCH ^You think the .* is too full to fit another gem into\.
     matchre TIE_POUCH ^You've already got a wealth of gems in there\!|You'd better tie it up before putting more gems inside\.
     matchre TIE_POUCH ^Picking up .* would push you over the item limit of 500 items\.
     matchre TIE_POUCH ^You're carrying far too many items already\.
     matchre PUT_GEM_6 ^There isn't any more room in the
     matchre PUT_GEM_6 even after stuffing it
     matchre PUT_GEM_6 ^That's too heavy to go in there
     matchre PUT_GEM_6 no matter how you arrange it
     matchre PUT_GEM_6 ^That's too heavy to go in there
     matchre DROP_LOOT ^You're carrying far too many items already\.
     put put %GEM in my third %gemPouch
     matchwait 10
     goto PUT_GEM_6
PUT_GEM_6:
     pause 0.0001
     if !matchre("$righthand $lefthand", "\b(%gemlist|%bitch.gems)\b") then goto LOOT_GEM_DONE
     matchre PUT_GEM_6 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_GEM_EMPTY ^You'll need to be holding
     matchre LOOT_GEM_SUCCESS ^You put your|^You open your|closing it once more|^But that is already
     matchre LOOT_GEM_DONE ^What were you|^I could not|^Please rephrase|^What were
     matchre LOOT_GEM_ALT That can't be picked up|Perhaps you should be holding
     matchre NEW_GEM_POUCH ^You think the .* is too full to fit another gem into\.
     matchre TIE_POUCH ^You've already got a wealth of gems in there\!|You'd better tie it up before putting more gems inside\.
     matchre TIE_POUCH ^Picking up .* would push you over the item limit of 500 items\.
     matchre TIE_POUCH ^You're carrying far too many items already\.
     matchre PUT_GEM_7 ^There isn't any more room in the
     matchre PUT_GEM_7 even after stuffing it
     matchre PUT_GEM_7 ^That's too heavy to go in there
     matchre PUT_GEM_7 no matter how you arrange it
     matchre PUT_GEM_7 ^That's too heavy to go in there
     matchre PUT_GEM_7 ^You're carrying far too many items already\.
     put put %GEM in my third %gemPouch in my watery portal
     matchwait 10
     goto PUT_GEM_7
PUT_GEM_7:
     pause 0.0001
     if !matchre("$righthand $lefthand", "\b(%gemlist|%bitch.gems)\b") then goto LOOT_GEM_DONE
     matchre PUT_GEM_7 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_GEM_EMPTY ^You'll need to be holding
     matchre LOOT_GEM_SUCCESS ^You put your|^You open your|closing it once more|^But that is already
     matchre LOOT_GEM_DONE ^What were you|^I could not|^Please rephrase|^What were
     matchre LOOT_GEM_ALT That can't be picked up|Perhaps you should be holding
     matchre NEW_GEM_POUCH ^You think the .* is too full to fit another gem into\.
     matchre TIE_POUCH ^You've already got a wealth of gems in there\!|You'd better tie it up before putting more gems inside\.
     matchre TIE_POUCH ^Picking up .* would push you over the item limit of 500 items\.
     matchre TIE_POUCH ^You're carrying far too many items already\.
     matchre DROP_LOOT ^There isn't any more room in the
     matchre DROP_LOOT even after stuffing it
     matchre DROP_LOOT ^That's too heavy to go in there
     matchre DROP_LOOT no matter how you arrange it
     matchre DROP_LOOT ^That's too heavy to go in there
     matchre DROP_LOOT ^You're carrying far too many items already\.
     put put %GEM in my $UC_Container.Backup
     matchwait 10
     goto DROP_LOOT
LOOT_GEM_STOW:
     delay 0.0001
     if matchre("$righthand", "\b(%gemlist|%bitch.gems)\b") then gosub STOWIT right
     if matchre("$lefthand", "\b(%gemlist|%bitch.gems)\b") then gosub STOWIT left
     delay 0.0001
     if matchre("$righthand", "\b(%gemlist|%bitch.gems)\b") then put drop $righthandnoun
     if matchre("$lefthand", "\b(%gemlist|%bitch.gems)\b") then put drop $lefthandnoun
     pause 0.0001
     if (!matchre("$lefthand", "Empty") && ("$UC_WEAPON_EXP" != "Offhand")) then gosub STOWIT left
     if (!matchre("$righthand", "Empty") && ("$UC_WEAPON_EXP" = "Offhand")) then gosub STOWIT right
     goto LOOT_GEM_DONE
TIE_POUCH:
     # debug 5
     delay 0.0001
     if ($UC_TiePouch = 1) then
          {
               echo
               echo ############
               echo ** GEM POUCH FULL
               echo ** TYING GEM POUCH
               echo ############
               echo
               if matchre("$righthand", "\b(%gemlist|%bitch.gems)\b") then gosub STOWIT right
               if matchre("$lefthand", "\b(%gemlist|%bitch.gems)\b") then gosub STOWIT left
               pause 0.0001
               if (!matchre("$lefthand", "Empty") && ("$UC_WEAPON_EXP" != "Offhand")) then gosub STOWIT left
               if (!matchre("$righthand", "Empty") && ("$UC_WEAPON_EXP" = "Offhand")) then gosub STOWIT right
               if ($UC_WornPouch = 1) then gosub PUT remove my %gemPouch
               pause 0.0001
               if !matchre("$righthand $lefthand", "pouch") then gosub GET my %gemPouch
               pause 0.0001
               pause 0.0001
               if !matchre("$righthand $lefthand", "pouch") then gosub GET my gem pouch
               pause 0.0001
               pause 0.0001
               put tie my gem pouch
               pause 0.0001
               pause 0.0001
               put tie my %gemPouch
               wait
               pause 0.0001
               pause 0.0001
               put #echo >Log #22FFAB ** Tied gempouch!
               var tiedPouch 1
               var pouchTie 0
               if ($UC_WornPouch = 1) then gosub WEAR pouch
               if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container
               if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container.Box
               if matchre("$righthand $lefthand", "pouch") then gosub STOWIT %gemPouch
               if matchre("$righthand $lefthand", "pouch") then gosub STOWIT pouch
               gosub GET my %GEM
          }
     delay 0.0001
     if ($UC_TiePouch = 0) then
          {
               echo #######################
               echo ** FULL GEM POUCH!
               echo ** TIE POUCH IS OFF! NOT TYING!
               echo ** STASHING GEM POUCH AND STARTING NEW ONE
               echo ######################
               pause 0.01
               goto NEW_GEM_POUCH
          }
     goto PUT_GEM_1
###### CREATING NEW GEM POUCHES
NEW_GEM_POUCH:
     var tiedPouch 0
     if matchre("$righthand", "\b(%gemlist|%bitch.gems)\b") then gosub STOWIT right
     if matchre("$lefthand", "\b(%gemlist|%bitch.gems)\b") then gosub STOWIT left
     if (matchre("$righthand", "\b(%gemlist|%bitch.gems)\b") && !matchre("$righthand", "pouch")) then put drop $righthandnoun
     if (matchre("$lefthand", "\b(%gemlist|%bitch.gems)\b") && !matchre("$lefthand", "pouch")) then put drop $lefthandnoun
     pause 0.0001
     if (!matchre("$lefthand", "Empty") && !matchre("$lefthand", "pouch")) then gosub STOWIT left
     if (!matchre("$righthand", "Empty") && !matchre("$righthand", "pouch")) then gosub STOWIT right
     # gosub EMPTY_HANDS
     # pause 0.2
REMOVE_GEM_POUCH:
     if matchre("$righthand $lefthand", "pouch") then goto STOW_GEM_POUCH
     pause 0.0001
     matchre REMOVE_GEM_POUCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.|^Please rephrase|^What were
     matchre GET_POUCH ^Remove what\?
     matchre STOW_GEM_POUCH ^You remove a.*gem pouch
     send remove my %gemPouch
     matchwait 20
GET_POUCH:
     pause 0.0001
     if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
     if (!matchre("$righthand $lefthand", "pouch") && matchre("%ALLCONTAINERS", "(?i)(eddy|portal)")) then gosub PUT GET my %gemPouch from my watery portal
     pause 0.0001
     if !matchre("$righthand $lefthand", "pouch") then gosub GET my %gemPouch
     pause 0.1
     pause 0.0001
     pause 0.0001
     if !matchre("$righthand $lefthand", "pouch") then gosub GET my gem pouch
STOW_GEM_POUCH:
     pause 0.0001
     gosub GLANCE
     if !matchre("$righthand $lefthand", "pouch") then gosub GET my %gemPouch
     pause 0.0001
     pause 0.001
     if !matchre("$righthand $lefthand", "pouch") then goto NO_MORE_POUCHES
     pause 0.0001
     gosub OPEN $UC_Container.GemPouch
     pause 0.0001
     pause 0.0001
     matchre STOW_GEM_POUCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre GET_GEM_POUCH ^You put|^But that is
     matchre GET_GEM_POUCH ^Stow what\?  Type 'STOW HELP' for details\.
     matchre GET_GEM_POUCH ^Please rephrase|^What were
     matchre FULL_GEMS even after stuffing it
     matchre FULL_GEMS no matter how you arrange it
     matchre FULL_GEMS ^That's too heavy
     matchre FULL_GEMS ^There isn't any more room
     put put my %gemPouch in my $UC_Container.GemPouch
     matchwait 20
     echo
     echo *** OUT OF ROOM IN GEMPOUCH CONTAINER: $UC_Container.GemPouch??? USE A BIGGER BAG!
     echo *** ITS JUST A COUPLE GEM POUCHES JEEZ!
     echo
     put #echo >Log #FC8C15 *** NO ROOM FOR GEM POUCHES IN GEMPOUCH CONTAINER: $UC_Container.GemPouch ??? USE BIGGER BAG!!
     put put my %gemPouch in my $UC_Container
     wait
     pause 0.0001
     if matchre("$righthand $lefthand", "pouch") then gosub PUT put my %gemPouch in my $UC_Container.Box
     pause 0.01
     if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container.Backup
     pause 0.01
     if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container.Almanac
     pause 0.01
     if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container.Crafting
     pause 0.01
     if matchre("$righthand $lefthand", "pouch") then gosub stowing
     goto GET_GEM_POUCH
STOW_GEM_POUCH_ALT:
     pause 0.0001
     matchre STOW_GEM_POUCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre GET_GEM_POUCH ^You put|^But that is
     matchre GET_GEM_POUCH ^Stow what\?  Type 'STOW HELP' for details\.
     matchre GET_GEM_POUCH ^Please rephrase|^What were
     matchre FULL_GEMS even after stuffing it
     matchre FULL_GEMS no matter how you arrange it
     matchre FULL_GEMS ^That's too heavy
     matchre FULL_GEMS ^There isn't any more room
     put put my pouch in my $UC_Container.GemPouch;-0.02 put my $righthandnoun in my $UC_Container.GemPouch
     matchwait 20
     echo
     echo *** OUT OF ROOM IN GEMPOUCH CONTAINER: $UC_Container.GemPouch??? USE A BIGGER BAG!
     echo *** ITS JUST A COUPLE GEM POUCHES JEEZ!
     echo
     put #echo >Log #FC8C15  *** NO ROOM FOR GEM POUCHES IN GEMPOUCH CONTAINER: $UC_Container.GemPouch ??? USE BIGGER BAG!!
     put put my %gemPouch in my $UC_Container
     wait
     pause 0.0001
     if matchre("$righthand $lefthand", "pouch") then gosub PUT put my %gemPouch in my $UC_Container.Box
     pause 0.01
     if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container.Backup
     pause 0.01
     if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container.Crafting
     pause 0.01
#### START NEW GEM POUCH HERE
GET_GEM_POUCH:
     var pouchFull 0
     var tiedPouch 0
     pause 0.0001
     if matchre("$righthand $lefthand", "pouch") then gosub stowing
     GET_GEM_POUCH_1:
     pause 0.0001
     pause 0.01
     pause 0.01
     send close my $UC_Container.GemPouch
     wait
     pause 0.2
     pause 0.1
     pause 0.0001
     matchre GET_GEM_POUCH_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre GET_GEM_POUCH_ALT ^What were you|^I could not
     matchre WEAR_GEM_POUCH ^You get a.*gem pouch.* from inside your .*\.|^You (get|slip)
     send get my %gemPouch from $UC_Container.EmptyPouch
     matchwait 12
GET_GEM_POUCH_ALT:
     pause 0.0001
     pause 0.0001
     pause 0.1
     if matchre("$righthand $lefthand", "pouch") then goto WEAR_GEM_POUCH
     pause 0.2
     matchre GET_GEM_POUCH_ALT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre GET_GEM_POUCH_ALT2 ^What were you|^I could not
     matchre WEAR_GEM_POUCH ^You get a.*gem pouch.* from inside your .*\.|^You (get|slip)
     send get my %gemPouch from my watery portal
     matchwait 12
GET_GEM_POUCH_ALT2:
     pause 0.0001
     pause 0.0001
     pause 0.2
     if matchre("$righthand $lefthand", "pouch") then goto WEAR_GEM_POUCH
     pause 0.3
     matchre GET_GEM_POUCH_ALT2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre NO_MORE_POUCHES ^What were you|^I could not
     matchre WEAR_GEM_POUCH ^You get a.*gem pouch|^You (get|slip)
     send get my %gemPouch
     matchwait 12
GET_GEM_POUCH_ALT3:
     pause 0.0001
     pause 0.0001
     pause 0.2
     if matchre("$righthand $lefthand", "pouch") then goto WEAR_GEM_POUCH
     pause 0.3
     matchre GET_GEM_POUCH_ALT2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre NO_MORE_POUCHES ^What were you|^I could not
     matchre WEAR_GEM_POUCH ^You get a.*gem pouch|^You (get|slip)
     send get my gem pouch
     matchwait 20
     goto LOOT_GEM_DONE
WEAR_GEM_POUCH:
     pause 0.0001
     pause 0.1
     if matchre("$lefthand", "pouch") then gosub SWAP
     math pouchesFull add 1
     put #echo >Log #02D995 *** New Gem Pouch Started!
     pause 0.0001
     pause 0.2
     pause 0.2
     if ($UC_WornPouch = 0) then goto STOW_NEW_POUCH
     matchre WEAR_GEM_POUCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEAR_GEM_POUCH_2 ^Wear what\?
     matchre DONE_NEW_POUCH ^You attach a.*gem pouch.* to your belt\.
     matchre DONE_NEW_POUCH ^You are already wearing that\.
     matchre STOW_NEW_POUCH ^You can't wear any more items like that\.
     send wear my pouch
     matchwait 9
WEAR_GEM_POUCH_2:
     pause 0.0001
     pause 0.0001
     if ($UC_WornPouch = 0) then goto STOW_NEW_POUCH
     matchre WEAR_GEM_POUCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEAR_GEM_POUCH_ALT ^Wear what\?
     matchre DONE_NEW_POUCH ^You attach a.*gem pouch.* to your belt\.
     matchre DONE_NEW_POUCH ^You are already wearing that\.
     matchre STOW_NEW_POUCH ^You can't wear any more items like that\.
     send wear my %gemPouch
     matchwait 9
WEAR_GEM_POUCH_ALT:
     pause 0.0001
     pause 0.0001
     matchre WEAR_GEM_POUCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_NEW_POUCH ^Wear what\?
     matchre DONE_NEW_POUCH ^You attach a.*gem pouch.* to your belt\.
     matchre DONE_NEW_POUCH ^You are already wearing that\.
     matchre STOW_NEW_POUCH ^You can't wear any more items like that\.
     send wear my pouch
     matchwait 9
STOW_NEW_POUCH:
     pause 0.0001
     matchre STOW_NEW_POUCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre DONE_NEW_POUCH ^You put your
     matchre DONE_NEW_POUCH ^What were you referring to\?
     matchre DONE_NEW_POUCH ^Stow what\?  Type 'STOW HELP' for details\.
     matchre STOW_NEW_POUCH_2 even after stuffing it
     matchre STOW_NEW_POUCH_2 no matter how you arrange it
     matchre STOW_NEW_POUCH_2 ^That's too heavy to go in there
     matchre STOW_NEW_POUCH_2 ^There isn't any more room in the
     matchre STOW_NEW_POUCH_2 ^You're carrying far too many items already\.
     send put my pouch in my $UC_Container
     matchwait 9
STOW_NEW_POUCH_2:
     var LOOT $righthand
     pause 0.0001
     matchre STOW_NEW_POUCH_2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre DONE_NEW_POUCH ^You put your
     matchre DONE_NEW_POUCH ^What were you referring to\?
     matchre DONE_NEW_POUCH ^Stow what\?  Type 'STOW HELP' for details\.
     matchre STOW_NEW_POUCH_3 even after stuffing it
     matchre STOW_NEW_POUCH_3 no matter how you arrange it
     matchre STOW_NEW_POUCH_3 ^That's too heavy to go in there
     matchre STOW_NEW_POUCH_3 ^There isn't any more room in the
     matchre STOW_NEW_POUCH_3 ^You're carrying far too many items already\.
     send put my pouch in my $UC_Container.Box
     matchwait 9
STOW_NEW_POUCH_3:
     pause 0.0001
     matchre STOW_NEW_POUCH_2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre DONE_NEW_POUCH ^You put your
     matchre DONE_NEW_POUCH ^What were you referring to\?
     matchre DONE_NEW_POUCH ^Stow what\?  Type 'STOW HELP' for details\.
     matchre DROP_LOOT even after stuffing it
     matchre DROP_LOOT no matter how you arrange it
     matchre DROP_LOOT ^That's too heavy to go in there
     matchre DROP_LOOT ^There isn't any more room in the
     matchre DROP_LOOT ^You're carrying far too many items already\.
     send put my pouch in my $UC_Container.Backup
     matchwait 9
     gosub stowing
DONE_NEW_POUCH:
     var looted 0
     var pouchFull 0
     var pouchTie 0
     put #echo >Log #FF3AF0 ** New gem pouch started
     if ($UC_WornPouch = 1) then put store gems in %gemPouch
     pause 0.0001
     pause 0.0001
     gosub GET my %GEM
     goto GET_GEMS_2
###############################
NO_MORE_POUCHES:
     if matchre("$righthand $lefthand", "pouch") then goto WEAR_GEM_POUCH
     put #echo >Log GoldenRod *** Ran out of gem pouches! Sell pouches/Get more!
     var Loot.Gems OFF
     goto DROP_LOOT
LOOT_GEM_SUCCESS:
     math GemTotal add 1
LOOT_GEM_DONE:
     if matchre("$righthand", "\b(?i)%gemlist\b") then gosub PUT_IT $righthandnoun in my %gemPouch
     if matchre("$lefthand", "\b(?i)%gemlist\b") then gosub PUT_IT $lefthandnoun in my %gemPouch
     pause 0.0001
     if matchre("$righthand", "\b(?i)%bitch.gems\b") then gosub PUT_IT $righthandnoun in my $UC_Container
     if matchre("$lefthand", "\b(?i)%bitch.gems\b") then gosub PUT_IT $lefthandnoun in my $UC_Container
     if matchre("$righthand", "\b(?i)(%bitch.gems)\b") then gosub STOWIT $righthand
     if matchre("$lefthand", "\b(?i)(%bitch.gems)\b") then gosub STOWIT $lefthand
     pause 0.0001
     if (!matchre("$lefthand", "Empty") && ("$UC_WEAPON_EXP" != "Offhand")) then gosub STOWIT left
     if (!matchre("$righthand", "Empty") && ("$UC_WEAPON_EXP" = "Offhand")) then gosub STOWIT right
     if (%pouchFull = 1) then gosub GET my %gemPouch
     if ((%pouchTie = 1) && !matchre("$righthand $lefthand", "pouch") && (%tiedPouch = 0)) then
          {
               if ($UC_WornPouch = 1) then gosub PUT remove my %gemPouch
               pause 0.1
               if !matchre("$righthand $lefthand", "pouch") then gosub GET my %gemPouch
               pause 0.2
               pause 0.1
               if !matchre("$righthand $lefthand", "pouch") then gosub GET my gem pouch
               pause 0.0001
               put tie my %gemPouch
               pause 0.1
               pause 0.0001
               put tie my %gemPouch
               wait
               put #echo >Log #22FFAB ** Tied gempouch!
               var tiedPouch 1
               var pouchTie 0
               if ($UC_WornPouch = 1) then gosub WEAR pouch
               if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container
               if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container.Box
               if matchre("$righthand $lefthand", "pouch") then gosub STOWIT %gemPouch
               if matchre("$righthand $lefthand", "pouch") then gosub STOWIT pouch
          }
     if (%pouchFull = 1) then
          {
               if !matchre("$righthand $lefthand", "pouch") then gosub GET my %gemPouch
               pause 0.2
               pause 0.1
               if !matchre("$righthand $lefthand", "pouch") then gosub GET my gem pouch
               pause 0.001
               gosub OPEN $UC_Container.GemPouch
               gosub PUT put %gemPouch in my $UC_Container.GemPouch
               pause 0.1
               if matchre("$righthand $lefthand", "pouch") then gosub PUT put my %gemPouch in my $UC_Container.Box
               pause 0.01
               if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container.Backup
               pause 0.01
               if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container.Almanac
               pause 0.01
               if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container.Crafting
               pause 0.01
               gosub PUT close my $UC_Container.GemPouch
               pause 0.01
               gosub GET my %gemPouch
               var tiedPouch 0
          }
     if ($UC_WornPouch = 1) then
          {
               put wear my %gemPouch
               pause 0.2
          }
     pause 0.0001
     if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container
     if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container.Box
LOOT_GEM_DONE_2:
     var pouchFull 0
     var pouchTie 0
     var GEM NULL
     if matchre("$righthand", "\b(?i)(%bitch.gems)\b") then gosub STOWIT right
     if matchre("$lefthand", "\b(?i)(%bitch.gems)\b") then gosub STOWIT left
     if (($UC_TiePouch = 1) && (%tiedPouch = 0)) then
          {
               pause 0.0001
               if (!matchre("$lefthand", "Empty") && ("$UC_WEAPON_EXP" != "Offhand")) then gosub STOWIT left
               if (!matchre("$righthand", "Empty") && ("$UC_WEAPON_EXP" = "Offhand")) then gosub STOWIT right
               if ($UC_WornPouch = 1) then gosub PUT remove my %gemPouch
               pause 0.01
               if !matchre("$righthand $lefthand", "pouch") then gosub GET my %gemPouch
               pause 0.2
               pause 0.1
               if !matchre("$righthand $lefthand", "pouch") then gosub GET my gem pouch
               pause 0.0001
               put tie my %gemPouch
               pause 0.1
               pause 0.0001
               put tie my %gemPouch
               wait
               pause 0.0001
               pause 0.0001
               var tiedPouch 1
               var pouchTie 0
               put #echo >Log #22FFAB ** Tied gempouch!
               if ($UC_WornPouch = 1) then gosub WEAR pouch
               if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container
               if matchre("$righthand $lefthand", "pouch") then gosub PUT put my pouch in my $UC_Container.Box
               if matchre("$righthand $lefthand", "pouch") then gosub STOWIT %gemPouch
          }
     if matchre("$righthand $lefthand", "pouch") then gosub STOWIT pouch
     if (%gemLoop > 4) then goto AUTOLOOT2
     goto AUTOLOOT
##### GET & DROP LOOT #####
GET_STOW_LOOT:
     pause 0.0001
     send get %Loot
     pause 0.1
     pause 0.0001
GET_LOOT:
     delay 0.0001
     if matchre("%Loot", "(?i)NULL") then goto LOOT_DONE
     if (matchre("%Loot", "(?i)fragment") && (%HaveFragSack = 1)) then
          {
               gosub GET iron fragment
               pause 0.2
               gosub PUT put fragment in my black sack
               pause 0.2
          }
     if (("$guild" = "Barbarian") && (%Templar = 1)) then
          {
               pause 0.1
               if matchre("$righthand $lefthand", "(?i)runestone") then
                    {
                         echo
                         echo *** EATING RUNESTONE!
                         echo
                         put meditate runestone eat
                         pause 0.5
                         pause 0.2
                    }
          }
     ## if (("$lefthand" = "Empty") && ("$righthand" = "Empty")) then goto AUTOLOOT
     matchre GET_LOOT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre AUTOLOOT ^You put your
     matchre AUTOLOOT ^What were you referring to\?
     matchre AUTOLOOT ^Stow what\?  Type 'STOW HELP' for details\.
     matchre AUTOLOOT ^Stow what\?
     matchre AUTOLOOT ^Please rephrase|^What were
     matchre GET_STOW_LOOT ^But that is already in your inventory\.
     matchre GET_LOOT_2 even after stuffing it
     matchre GET_LOOT_2 no matter how you arrange it
     matchre GET_LOOT_2 ^That's too heavy to go in there
     matchre GET_LOOT_2 ^There isn't any more room in the
     matchre GET_LOOT_2 ^You're carrying far too many items already\.
     send stow %Loot
     matchwait 9
     goto AUTOLOOT
GET_LOOT_2:
     if matchre("%Loot", "(?i)NULL") then goto LOOT_DONE
     pause 0.0001
     matchre GET_LOOT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre GET_STOW_LOOT ^But that is already in your inventory\.
     matchre AUTOLOOT ^You put your
     matchre AUTOLOOT ^What were you referring to\?
     matchre AUTOLOOT ^Stow what\?  Type 'STOW HELP' for details\.
     matchre AUTOLOOT ^Stow what\?
     matchre AUTOLOOT ^Please rephrase|^What were
     matchre GET_LOOT_3 even after stuffing it
     matchre GET_LOOT_3 no matter how you arrange it
     matchre GET_LOOT_3 ^That's too heavy to go in there
     matchre GET_LOOT_3 ^There isn't any more room in the
     matchre GET_LOOT_3 ^You're carrying far too many items already\.
     if matchre("$righthand $lefthand", "%Loot") then
          {
               gosub GET %Loot
               pause 0.5
          }
     send put %Loot in my $UC_Container.Box
     matchwait 9
     goto AUTOLOOT
GET_LOOT_3:
     pause 0.0001
     if matchre("%Loot", "(?i)NULL") then goto LOOT_DONE
     matchre GET_LOOT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre AUTOLOOT ^You put your
     matchre AUTOLOOT ^What were you referring to\?
     matchre AUTOLOOT ^Stow what\?  Type 'STOW HELP' for details\.
     matchre AUTOLOOT ^Stow what\?
     matchre AUTOLOOT ^Please rephrase|^What were
     matchre DROP_LOOT even after stuffing it
     matchre DROP_LOOT no matter how you arrange it
     matchre DROP_LOOT ^That's too heavy to go in there
     matchre DROP_LOOT ^There isn't any more room in the
     matchre DROP_LOOT ^You're carrying far too many items already\.
     matchre GET_STOW_LOOT ^But that is already in your inventory\.
     send put %Loot in my $UC_Container.Backup
     matchwait 9
     goto AUTOLOOT
DROP_LOOT:
     if matchre("%Loot", "(?i)NULL") then goto LOOT_DONE
     put #echo >Log RED *** NO ROOM FOUND FOR %Loot IN OUR BAGS - TURNING LOOTING OFF!
     put #tvar UC_Looting 0
     put #tvar UC_bagsFull 0
     gosub SHEATH_CHECK
     if !matchre("$lefthand", "Empty") then gosub PUT put $lefthandnoun in my $UC_Container
     if !matchre("$righthand", "Empty") then gosub PUT put $righthandnoun in my $UC_Container
     if !matchre("$lefthand", "Empty") then gosub PUT put $lefthandnoun in my $UC_Container.Box
     if !matchre("$righthand", "Empty") then gosub PUT put $righthandnoun in my $UC_Container.Box
     if !matchre("$lefthand", "Empty") then gosub PUT put $lefthandnoun in my $UC_Container.Sheath
     if !matchre("$lefthand", "Empty") then gosub PUT put $lefthandnoun in my $UC_Container.Backup
     if !matchre("$righthand", "Empty") then gosub PUT put $righthandnoun in my $UC_Container.Backup
##### LOOT DONE #####
LOOT_DONE:
     var autoloot 0
     var looted 0
     var gemLoop 0
     gosub LOOT_BOXES
     gosub RETRIEVE_CHECK
     gosub DUMP_CHECK
     gosub STATUSBAR
     unvar gemLoop
     unvar GEM NULL
     action remove ^You think .* is too full to fit another gem into\.
     action remove ^You've already got a wealth of gems
     if ($UC_bagsFull = 1) then goto ESCAPE.BAGS
     return
##### GET & DROP BOXES #####
LOOT_BOXES:
     if (!$UC_LootBoxes) then goto BOXES_DONE
BOXES:
     if (%TotalBoxes >= $UC_Box.Max) then
          {
               put #var UC_LootBoxes 0
               echo
               echo #########################
               echo *** MAX BOX LIMIT REACHED: $UC_Box.Max
               echo *** TURNING BOX LOOTING OFF FOR REST OF RUN
               echo #########################
               echo
               goto BOXES_DONE
          }
     if matchre("$roomobjs", "\b(skippet|coffer|trunk|chest|strongbox|crate|box|casket|caddy)\b") then goto GET_BOXES
     goto BOXES_DONE
GET_BOXES:
     var BOX $0
     math TotalBoxes add 1
     pause 0.0001
     matchre GET_BOXES ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre BOXES ^You put your
     matchre BOXES ^What were you referring to\?
     matchre BOXES ^Stow what\?  Type 'STOW HELP' for details\.
     matchre GET_BOXES_2 ^But that is already
     matchre GET_BOXES_2 even after stuffing it
     matchre GET_BOXES_2 ^That's too heavy to go in there\!
     matchre GET_BOXES_2 ^There isn't any more room in .* for that\.
     matchre GET_BOXES_2 ^You just can't get .* to fit in .*, no matter how you arrange it\.
     put stow %BOX
     matchwait 9
GET_BOXES_2:
     pause 0.1
     var LAST GET_BOXES_2
     if !matchre("$lefthand $righthand", "\b(skippet|coffer|trunk|chest|strongbox|crate|box|casket|caddy)\b") then
          {
               put get %BOX
               pause 0.3
               pause 0.2
          }
     matchre BOXES ^Stow what\?
     matchre BOXES ^What were you referring to\?
     matchre BOXES ^You put your
     matchre OPEN_CONT ^But that's closed
     matchre DROP_BOX .* even after stuffing it
     matchre DROP_BOX ^There isn't any more room in .*
     matchre DROP_BOX ^You just can't get .* to fit
     matchre DROP_BOX ^That's too heavy to go in there\!
     matchre LOOT_BOX_CHECK ^You put your|^Stow what|I could
     matchre BOXES_DONE ^That can't be picked up
     put put %BOX in my $UC_Container
     matchwait 6
LOOT_BOX_CHECK:
     pause 0.001
     if matchre("$lefthand $righthand", "\b(skippet|coffer|trunk|chest|strongbox|crate|box|casket|caddy)\b") then
          {
               put put my $1 in my $UC_Container.Backup
               pause 0.4
               pause 0.3
          }
     pause 0.001
     pause 0.001
     if matchre("$lefthand $righthand", "\b(skippet|coffer|trunk|chest|strongbox|crate|box|casket|caddy)\b") then goto DROP_BOX
     goto LOOT_BOXES
###################################################################
DROP_BOX:
     echo ################################
     echo ** OUT OF ROOM FOR BOXES IN BOX CONTAINER
     echo ** TURNING BOX LOOTING OFF FOR REST OF RUN
     echo ################################
     put #echo >Log #ffcc00 *** OUT OF ROOM IN BOX CONTAINER: $UC_Container.Box - Turning OFF Box Looting
     put #var UC_LootBoxes 0
     put #var UC_bagsFull 0
     if matchre("$lefthand $righthand", "\b(skippet|coffer|trunk|chest|strongbox|crate|box|casket|caddy)\b") then gosub PUT drop my $1
     goto BOXES_DONE
BOXES_DONE:
     gosub STATUSBAR
     return

OPEN_CONT:
     pause 0.0001
     gosub OPEN $UC_Container.Box
     gosub OPEN $UC_Container
     gosub OPEN $UC_Container.Backup
     gosub OPEN $UC_Container.Crafting
     goto GET_BOXES
################################################################################
#### REMOVE AND WEAR PLATE ROUTINE ####
REMOVE_PLATE:
     action (retreat) on
     echo ###############
     echo  REMOVING HEAVY ARMOR!
     echo ###############
     pause 0.1
     gosub stowing
     pause 0.0001
     pause 0.0001
     if !matchre("$UC_plateArmor1", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var PlateType $UC_plateArmor1
               gosub REMOVE_PLATE1
          }
     if !matchre("$UC_plateArmor2", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var PlateType $UC_plateArmor2
               gosub REMOVE_PLATE1
          }
     if !matchre("$UC_plateArmor3", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var PlateType $UC_plateArmor3
               gosub REMOVE_PLATE1
          }
     if !matchre("$UC_plateArmor4", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var PlateType $UC_plateArmor4
               gosub REMOVE_PLATE1
          }
     gosub stowing
     pause 0.0001
     pause 0.0001
     if (%Melee.Range = 1) then gosub RETREAT
     if !matchre("$UC_lightArmor1", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub get my $UC_lightArmor1
               gosub wear $UC_lightArmor1
          }
     if (%Melee.Range = 1) then gosub RETREAT
     if !matchre("$UC_lightArmor2", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub get my $UC_lightArmor2
               gosub wear $UC_lightArmor2
          }
     if !matchre("$UC_lightArmor3", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub get my $UC_lightArmor3
               gosub wear $UC_lightArmor3
          }
     if !matchre("$UC_lightArmor4", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub get my $UC_lightArmor4
               gosub wear $UC_lightArmor4
          }
     echo #################
     echo  SWAPPED TO LIGHT ARMOR!
     echo #################
     action (retreat) off
     return
REMOVE_PLATE1:
     var Removed.Armor 1
     action (retreat) on
     pause 0.0001
     echo *** REMOVING PLATE ARMOR: %PlateType
     pause 0.1
     if (%Melee.Range = 1) then gosub RETREAT
     pause 0.0001
     pause 0.0001
REMOVE_PLATE2:
     var LOCATION REMOVE_PLATE2
     pause 0.0001
     matchre DONE_PLATE_REMOVE Remove what\?
     matchre REMOVE_PLATE2 ^\.\.\.wait|^Sorry, you may only type|Roundtime
     matchre STOW_PLATE1 You'?r?e? (?:hand|slip|put|get|.* to|can't|quickly|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|can't|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|aren't|kneel|don't|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|unload|remain|release|shield|tower) .*(?:\.|\!|\?)?
     matchre STOW_PLATE1 ^Without any effort|the .* slide off|tug the .* free|Shaking your head|^Wiggling
     put remove %PlateType
     matchwait 8
     put #echo >Log #ff0000 *** MISSING MATCH IN REMOVE_PLATE2!
     put #parse MISSING MATCH IN REMOVE_PLATE2
     goto STOW_PLATE1
STOW_PLATE1:
     var LOCATION STOW_PLATE1
     pause 0.0001
          matchre STOW_PLATE1 ^\.\.\.wait|^Sorry, you may only type|Roundtime
          matchre DONE_PLATE_REMOVE You put your|Stow what\?
          matchre STOW_PLATE2 any more room in|closed|no matter how you arrange|too heavy
     put put %PlateType in my $UC_Container
     matchwait 9
STOW_PLATE2:
     var LOCATION STOW_PLATE2
     pause 0.0001
          matchre STOW_PLATE2 ^\.\.\.wait|^Sorry, you may only type|Roundtime
          matchre DONE_PLATE_REMOVE You put your|What were you
          matchre STOW_PLATE3 any more room in|closed|no matter how you arrange|too heavy
     put put %PlateType in my $UC_Container.Box
     matchwait 9
STOW_PLATE3:
     var LOCATION STOW_PLATE2
     pause 0.0001
          matchre STOW_PLATE2 ^\.\.\.wait|^Sorry, you may only type|Roundtime
          matchre DONE_PLATE_REMOVE You put your|What were you
          matchre NO_MORE_ROOM any more room in|closed|no matter how you arrange|too heavy
     put put %PlateType in my $UC_Container.Backup
     matchwait 10
NO_MORE_ROOM:
     echo **   No more room for stowing; gonna just go for it   **
     put wear %PlateType
     pause 0.3
     return
DONE_PLATE_REMOVE:
     pause 0.1
     echo ###############
     echo  REMOVED %PlateType ARMOR!
     echo ###############
     return
WEAR_PLATE:
     var Removed.Armor 0
     pause 0.1
     gosub stowing
     pause 0.0001
     if (%Melee.Range = 1) then gosub RETREAT
     if !matchre("%LIGHTARMOR1", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub remove my %LIGHTARMOR1
               gosub stow my %LIGHTARMOR1
          }
     pause 0.1
     pause 0.0001
     if (%Melee.Range = 1) then gosub RETREAT
     if !matchre("%LIGHTARMOR2", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub remove my %LIGHTARMOR2
               gosub stow my %LIGHTARMOR2
          }
     pause 0.0001
     if (%Melee.Range = 1) then gosub RETREAT
     if !matchre("%LIGHTARMOR3", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub remove my %LIGHTARMOR3
               gosub stow my %LIGHTARMOR3
          }
     if (%Melee.Range = 1) then gosub RETREAT
     if !matchre("%LIGHTARMOR4", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub remove my %LIGHTARMOR4
               gosub stow my %LIGHTARMOR4
          }
     if (%Melee.Range = 1) then gosub RETREAT
     if !matchre("$UC_plateArmor1", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub get my $UC_plateArmor1
               gosub wear $UC_plateArmor1
          }
     if (%Melee.Range = 1) then gosub RETREAT
     if !matchre("$UC_plateArmor2", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub get my $UC_plateArmor2
               gosub wear $UC_plateArmor2
          }
     if !matchre("$UC_plateArmor3", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub get my $UC_plateArmor3
               gosub wear $UC_plateArmor3
          }
     if (%Melee.Range = 1) then gosub RETREAT
     if !matchre("$UC_plateArmor4", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub get my $UC_plateArmor4
               gosub wear $UC_plateArmor4
          }
     if (%Melee.Range = 1) then gosub RETREAT
     echo ##############
     echo *** DONE SWAPPING!
     echo *** NOW WEARING HEAVY ARMOR!
     echo ##############
     action (retreat) off
     return
#####################################################
# Das Armor Swapping Logic Tweaked
#####################################################
ARMORSWAP:
     # debug 5
     put #var armors Plate_Armor|Brigandine|Chain_Armor|Light_Armor
     var armors $armors
     delay 0.0001
     if matchre("%Light_Armor.Helm", "(?i)(NULL|OFF|^%|^\s*$)") then eval armors replacere("%armors", "Light_Armor", "")
     if matchre("%Chain_Armor.Helm", "(?i)(NULL|OFF|^%|^\s*$)") then  eval armors replacere("%armors", "Chain_Armor", "")
     if matchre("%Brigandine.Helm", "(?i)(NULL|OFF|^%|^\s*$)") then  eval armors replacere("%armors", "Brigandine", "")
     if matchre("%Plate_Armor.Helm", "(?i)(NULL|OFF|^%|^\s*$)") then  eval armors replacere("%armors", "Plate_Armor", "")
     eval armors replacere("%armors", "\|+", "|")
     eval armors replacere("%armors", "^\|", "")
     eval armors replacere("%armors", "\|$", "")
     pause 0.0001
     put #var armors %armors
     var armorcount.number 0
     eval armor.number count("$armors","|")
     var low.armor $armors(0)
     evalmath timeSinceLastSwap $gametime - $lastSwap
     if (%timeSinceLastSwap < 250) then goto ARMORSWAP_RETURN
     echo #########################
     echo *** Checking Armor XP for Helm Swap
     echo #########################
     pause 0.2
     gosub HEAD_SET
     pause 0.0001
ARMORCHECK:
     pause 0.0001
     pause 0.0001
     if (%armorcount.number <= %armor.number) then
          {
               if matchre("$$armors(%armorcount.number).Helm", "(?i)%ARMOR.HEAD") then
                    {
                         echo *** Worn Helm: $armors(%armorcount.number)
                         put #var worn.helm $armors(%armorcount.number)
                         pause 0.1
                    }
               if matchre("$$armors(%armorcount.number).Helm", "(?i)(NULL|OFF|^%|^\s*$)") then
                    {
                         math armorcount.number add 1
                         goto ARMORCHECK
                    }
               if (($$armors(%armorcount.number).LearningRate < $%low.armor.LearningRate) && ($$armors(%armorcount.number).Ranks < 1750)) then var low.armor $armors(%armorcount.number)
               math armorcount.number add 1
               goto ARMORCHECK
          }
ARMORCHECK_SWAP:
     pause 0.0001
     if (("$worn.helm" = "%low.armor") || ($%low.armor.LearningRate > 30)) then
          {
               echo *** NO SWAP NEEDED
               goto ARMORSWAP_RETURN
          }
     if !matchre("$lefthand", "Empty") then gosub STOWIT $lefthand
     # if ("$$worn.helm.Helm" != "$NULL.Helm") then gosub hold $$worn.helm.Helm
     # if ("$$worn.helm.Helm" != "$NULL.Helm") then gosub stow $$worn.helm.Helm
     gosub HEAD_CHECK
     pause 0.0001
     put #var worn.helm %low.armor
     put #var lastSwap $gametime
     gosub get $%low.armor.Helm
     gosub wear $%low.armor.Helm
     var ARMOR.HEAD $%low.armor.Helm
     pause 0.0001
     pause 0.0001
     echo ###############
     echo ** SWAPPED HELMS!
     echo ** NOW WEARING: $%low.armor.Helm
     echo ###############
ARMORSWAP_RETURN:
     pause 0.0001
     unvar low.armor
     unvar armor.number
     unvar armors
     # debug 0
     return
HEAD_SET:
     pause 0.0001
     matchre HEAD_SET ^\.\.\.wait|^Sorry\,|^You are still stunned\.|You can\'t do that\.|^I could|^(You|I) can't|^What
     matchre SET_HEAD %Light_Armor.Helm|%Chain_Armor.Helm|%Brigandine.Helm|%Plate_Armor.Helm|%HEAD.ARMOR|%B.HEAD.ARMOR
     matchre SET_HEAD \bhelmet\b|helm\b|mask|armet(?! helm)|odaj|casque|\bhat\b|goggle|\bhood\b|\bcowl\b|balaclava|barbute|bascinet|basinet|\bcap\b|\bcowl|fauld|\bhood\b|leathers|lorica|mantle|(?<!crimson leather )\bmask\b|morion|sallet|ticivara|tasset|thorakes|\blid\b|coif|chanfron|varare
     matchre RETURN ^Please rephrase|^What were
     matchre RETURN You have nothing of that sort|You are wearing nothing of that sort|You aren't wearing anything|INVENTORY HELP
     put inv head
     matchwait 15
     put #echo >Log #ff0000 *** MISSING MATCH IN HEAD_SET!
     echo *** MISSING MATCH IN HEAD_SET!
     put #parse MISSING MATCH IN HEAD_SET
     return
SET_HEAD:
     var ARMOR.HEAD $0
     pause 0.2
     echo *** CURRENT HEAD ARMOR: %ARMOR.HEAD
     return
HEAD_CHECK:
     pause 0.0001
     matchre HEAD_CHECK ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre REMOVE_HEAD %Light_Armor.Helm|%Chain_Armor.Helm|%Brigandine.Helm|%Plate_Armor.Helm|%HEAD.ARMOR|%B.HEAD.ARMOR
     matchre REMOVE_HEAD \bhelmet\b|helm\b|mask|armet(?! helm)|odaj|casque|\bhat\b|goggle|\bhood\b|\bcowl\b|balaclava|barbute|bascinet|basinet|\bcap\b|\bcowl|fauld|\bhood\b|leathers|lorica|mantle|(?<!crimson leather )\bmask\b|morion|sallet|ticivara|tasset|thorakes|\blid\b|coif|chanfron|varare
     matchre RETURN ^Please rephrase|^What were
     matchre RETURN You have nothing of that sort|You are wearing nothing of that sort|You aren't wearing anything|INVENTORY HELP
     matchre HEAD_CHECK You can\'t do that\.|^You put|^I could|^(You|I) can't|^What
     put inv head
     matchwait 15
     put #echo >Log #ff0000 *** MISSING MATCH IN HEAD_CHECK!
     echo *** MISSING MATCH IN HEAD_CHECK!
     put #parse MISSING MATCH IN HEAD_CHECK
     goto HEAD_CHECK
REMOVE_HEAD:
     var armor $0
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     pause 0.0001
     matchre REMOVE_HEAD ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_HEAD You'?r?e? (?:hand|slip|put|get|.* to|can't|quickly|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|can\'t|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|unload|remain|release|shield|tower) .*(?:\.|\!|\?)?
     matchre STOW_HEAD ^Without any effort|the .* slide off|tug the .* free|Shaking your head|^Wiggling
     matchre STOW_HEAD ^You have nothing of that|^Remove what|^What
     matchre RETURN ^Please rephrase|^What were
     put remove my %armor
     matchwait 15
     put #echo >Log #ff0000 *** MISSING MATCH IN REMOVE_HEAD!
     echo *** MISSING MATCH IN REMOVE_HEAD!
     put #parse MISSING MATCH IN REMOVE_HEAD
     goto STOW_HEAD
STOW_HEAD:
     gosub STOWIT %armor
     return
#####################################################
# ALMANAC
#####################################################
ALMANAC_STUDY:
     var almanac.skill null
     var lefthanditem null
     eval ALMANAC.LEARN replacere("%ALMANAC.LEARN", "^\||\|$", "")
     eval ALMANAC.LEARN replacere("%ALMANAC.LEARN", "\|+", "|")
     eval ALMANAC.LEARN replacere("%ALMANAC.LEARN", "\|$", "")
     eval ALMANAC.LEARN replacere("%ALMANAC.LEARN", "^\|", "")
     delay 0.0001
     eval almanac.total count("%ALMANAC.LEARN", "|")
     evalmath almanac.total (%almanac.total + 1)
     if (%Research.Active = 1) then return
     echo ############
     echo *** ALMANAC STUDY
     echo ############
     delay 0.0001
     if ($invisible) then gosub STOP_INVIS
     if (%Playing = 1) then gosub STOP_PLAY
     if !matchre("$lefthand", "Empty") then
          {
               var lefthanditem #$lefthandid
               gosub STOWIT left
          }
ALMANAC_GET:
     delay 0.0001
     if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty") && (!matchre("$righthandnoun $lefthandnoun", "almanac"))) then return
     if (matchre("$righthandnoun $lefthandnoun", "almanac")) then goto ALMANAC_OPEN
     matchre ALMANAC_GET \.\.\.wait|^Sorry\,|^You are still
     matchre ALMANAC_OPEN ^You get|^You are already holding|^You untie
     matchre ALMANAC_UNTIE ^(?:What were you|I could not find what you were) referring to|^You need a free hand|^Please rephrase|^You can't|^You should untie
     put get %ALMANAC.TYPE from my %Almanac.Container
     matchwait 20
ALMANAC_UNTIE:
     delay 0.0001
     if (matchre("$righthandnoun $lefthandnoun", "almanac")) then goto ALMANAC_OPEN
     matchre ALMANAC_GET \.\.\.wait|^Sorry\,|^You are still
     matchre ALMANAC_OPEN ^You get|^You are already holding|^You untie
     matchre ALMANAC_ALT ^(?:What were you|I could not find what you were) referring to|^You need a free hand|^Please rephrase
     put untie %ALMANAC.TYPE from my %Almanac.Container
     matchwait 4
ALMANAC_ALT:
     delay 0.0001
     if (matchre("$righthandnoun $lefthandnoun", "almanac")) then goto ALMANAC_OPEN
     matchre ALMANAC_GET \.\.\.wait|^Sorry\,|^You are still
     matchre ALMANAC_OPEN ^You get|^You are already holding|^You untie
     matchre ALMANAC_GET_ALT ^(?:What were you|I could not find what you were) referring to|^You need a free hand|^Please rephrase|^You can't|^You should untie
     put get my %ALMANAC.TYPE
     matchwait 10
ALMANAC_GET_ALT:
     delay 0.0001
     if (matchre("$righthandnoun $lefthandnoun", "almanac")) then goto ALMANAC_OPEN
     matchre ALMANAC_GET \.\.\.wait|^Sorry\,|^You are still
     matchre ALMANAC_OPEN ^You get|^You are already holding|^You untie
     matchre ALMANAC_ERROR ^(?:What were you|I could not find what you were) referring to|^You need a free hand|^Please rephrase|^You can't
     put get %ALMANAC.TYPE from my watery portal
     matchwait 10
ALMANAC_ERROR:
     echo
     echo **** ERROR! ALMANAC NOT FOUND!
     echo
     return
ALMANAC_ADD:
     math almanac.count add 1
ALMANAC_OPEN:
     action var almanac.skill $1 when You believe you've learned something significant about (.*)\!
     gosub PUT open my %ALMANAC.TYPE
     if matchre("%ALMANAC.TYPE", "(?i)encyclopedic almanac") then
          {
               if (%almanac.count > %almanac.total) then var almanac.count 0
               if ("%ALMANAC.LEARN(%almanac.count)" = "") then goto ALMANAC_ADD
               if matchre("$%ALMANAC.LEARN(%almanac.count).Ranks" >= 1750) then
                    {
                         echo *** %ALMANAC.LEARN(%almanac.count) skill is 1750 - Choosing another Skill!
                         pause 0.0001
                         goto ALMANAC_ADD
                    }
               gosub PUT turn my %ALMANAC.TYPE to %ALMANAC.LEARN(%almanac.count)
               math almanac.count add 1
               if (%almanac.count > %almanac.total) then var almanac.count 0
          }
     delay 0.0001
     matchre ALMANAC_OPEN ^\s*\.\.\.wait|^You are still stunned
     matchre ALMANAC_OPEN ^You believe you would learn something significant about a random skill
     matchre ALMANAC_CD ^You've gleaned all the insight you can from the (.+) almanac\, for now\.
     matchre ALMANAC_SUCCESS ^You set about studying your .+ intently.  You believe you've learned something significant about (.*)\!
     matchre ALMANAC_OPEN2 ^You will need to hold|^You really should
     # matchre ALMANAC_SUCCESS ^You set about studying your (.+) almanac intently
     put study my %ALMANAC.TYPE
     matchwait 20
ALMANAC_OPEN2:
     delay 0.0001
     matchre ALMANAC_OPEN2 ^\s*\.\.\.wait|^You are still stunned
     matchre ALMANAC_OPEN ^You believe you would learn something significant about a random skill
     matchre ALMANAC_CD ^You've gleaned all the insight you can from the (.+) almanac\, for now\.
     matchre ALMANAC_SUCCESS ^You set about studying your .+ intently.  You believe you've learned something significant about (.*)\!
     # matchre ALMANAC_SUCCESS ^You set about studying your (.+) almanac intently
     put study %ALMANAC.TYPE
     matchwait 10
ALMANAC_CD:
     echo #################
     echo *** ALMANAC ON COOLDOWN...
     echo #################
     pause 0.0001
     gosub PUT put my %ALMANAC.TYPE in my %Almanac.Container
     if (matchre("$righthandnoun $lefthandnoun", "almanac") then gosub PUT tie my %ALMANAC.TYPE to my %Almanac.Container
     if (matchre("$righthandnoun $lefthandnoun", "almanac") then gosub STOWIT %ALMANAC.TYPE
     if ("%lefthanditem" != "null") then gosub GET_LEFT
     action (buffs) on
     action (retreat) on
     action remove You believe you've learned something significant about (.*)\!
     return
ALMANAC_SUCCESS:
     pause 0.0001
     pause 0.0001
     echo
     echo  * Almanac Skill - %almanac.skill
     echo
     pause 0.0001
     gosub PUT put my %ALMANAC.TYPE in my %Almanac.Container
     if (matchre("$righthandnoun $lefthandnoun", "almanac") then gosub PUT tie my %ALMANAC.TYPE to my %Almanac.Container
     if (matchre("$righthandnoun $lefthandnoun", "almanac") then gosub STOWIT %ALMANAC.TYPE
     put #echo >ItemLog #ffff66 * Almanac - %almanac.skill
     if ("%lefthanditem" != "null") then gosub GET_LEFT
     action (buffs) on
     action (retreat) on
     action remove You believe you've learned something significant about (.*)\!
     return
GET_LEFT:
     var getleftloop 0
GET_LEFT_2:
     math getleftloop add 1
     if (%getleftloop > 2) then return
     if !matchre("$lefthand", "Empty") then gosub STOWIT left
     pause 0.0001
     matchre GET_LEFT_2 ^\s*\.\.\.wait|^You are still stunned
     matchre GET_LEFT_ALT ^What were you|I could not find|^Please rephrase that command
     matchre RETURN ^You get|^You need a free hand|^You are already holding
     put get %lefthanditem
     matchwait 6
     goto GET_LEFT_2
GET_LEFT_ALT:
     math getleftloop add 1
     if (%getleftloop > 2) then return
     matchre GET_LEFT ^\s*\.\.\.wait|^You are still stunned
     matchre RETURN ^You get|^(?:What were you|I could not find what you were) referring to|^You need a free hand|^You are already holding|^Please rephrase that command
     put get %lefthanditem from my watery portal
     matchwait 6
     RETURN
####################################################
# WAND SUB
####################################################
WAND_IT:
     var WandLoop 0
     var LastWand NULL
     var Wandcount 0
     var Wand1count 0
     var Wand2count 0
     var WandCD 0
     if ($invisible = 1) then gosub STOP_INVIS
     if !matchre("$lefthand", "Empty") then gosub STOWIT left
     delay 0.00001
     eval Wand1count count("%Wand1", "|")
     eval Wand2count count("%Wand2", "|")
     if (%Wand1count >= 1) then var Wand.1 %Wand1(0)
     if (%Wand2count >= 1) then var Wand.2 %Wand2(0)
     if (%Wand1count = 0) then var Wand.1 %Wand1
     if (%Wand2count = 0) then var Wand.2 %Wand2
     # echo *** Bag 1 Wand Choices: %Wand1
     # echo *** Bag 2 Wand Choices: %Wand2
     # echo *** Wand 1: %Wand.1
     # echo *** Wand 2: %Wand.2
     if (%Wand1.Use = 1) then goto WAND_SECOND
WAND_FIRST:
     math WandLoop add 1
     if !matchre("$lefthand", "Empty") then gosub STOWIT left
     if matchre("%Wand.1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto WAND_SECOND
     var Wand.1 %Wand1(%Wandcount)
     gosub WAND_1
     if matchre("$righthand $lefthand", "(?i)%Wand") then gosub PUT put %Wand in my %Current.WandCont
     if ((%WandCD = 0) && (%Wandcount = 0)) then
          {
               echo *** WAND 1 still on cooldown
               var Wand1.Use 0
               goto WAND_SECOND
          }
     math Wandcount add 1
     if (%Wandcount <= %Wand1count) then goto WAND_FIRST
     if ((%WandCD = 0) && (%Wand1.Use = 0)) then
          {
               var Wand2.Use 0
               goto WAND_SECOND
          }
     if (%WandCD = 1) then
          {
               var Wand1.Use 1
               var Wand2.Use 0
               return
          }
     if (%Wand1.Use = 1) then return
     var Wandcount 0
     var WandCD 0
WAND_SECOND:
     if (%WandLoop > 1) then return
     if matchre("%Wand.2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then return
     var Wand.2 %Wand2(%Wandcount)
     if ((%Wand2count >= 0) && !matchre("%Wand.2", "NULL")) then gosub WAND_2
     if matchre("$righthand $lefthand", "(?i)%Wand") then gosub PUT put %Wand in my %Current.WandCont
     if ((%WandCD = 0) && (%Wandcount = 0)) then
          {
               var Wand2.Use 0
               var Wand1.Use 0
               var WandCD 0
               evalmath WandTime ($gametime - 500)
               return
          }
     math Wandcount add 1
     if (%Wandcount <= %Wand2count) then goto WAND_SECOND
     if ((%WandCD = 0) && (%Wand2.Use = 0)) then
          {
               var Wand1.Use 0
               goto WAND_FIRST
          }
     if (%WandCD = 1) then
          {
               var Wand2.Use 1
               var Wand1.Use 0
               return
          }
     if (%Wand2.Use = 1) then
          {
               var Wand1.Use 0
               return
          }
     var Wand1.Use 0
     var Wandcount 0
     var WandCD 0
     return

WAND_1:
     var Wand %Wand.1
     var WandBag 1
     var Current.WandCont %Wand1.Container
     if matchre("icy crystal", "\b(?i)%Wand.1\b") then var Wand crystal
     if matchre("statuette", "\b(?i)%Wand.1\b") then var Wand statuette
     if matchre("eighth note", "\b(?i)%Wand.1\b") then var Wand note
     goto WAND_GO
WAND_2:
     var Wand %Wand.2
     var WandBag 2
     var Current.WandCont %Wand2.Container
     if matchre("%Wand2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then return
     if matchre("icy crystal", "\b(?i)%Wand.2\b") then var Wand crystal
     if matchre("statuette", "\b(?i)%Wand.2\b") then var Wand statuette
     if matchre("eighth note", "\b(?i)%Wand.2\b") then var Wand note
WAND_GO:
     echo
     echo ###############
     echo *** USING WAND %WandBag:%Wandcount
     echo *** %Wand
     echo ###############
     echo
     delay 0.0001
     gosub GET %Wand from my %Current.WandCont
     delay 0.0001
     pause 0.0001
     if !matchre("$righthand $lefthand", "(?i)%Wand") then
          {
               send GET my %Wand from my $UC_Container
               wait
               pause 0.1
               pause 0.1
          }
     if !matchre("$righthand $lefthand", "(?i)%Wand") then
          {
               echo
               echo #################
               echo ** WAND %Wand NOT FOUND!
               echo #################
               echo
               gosub PUT put %Wand in my %Current.WandCont
               return
          }
     if matchre("$righthand $lefthand", "(statuette|note|silversteel scepter)") then
          {
               if (!matchre("$lefthand", "Empty") && !matchre("$lefthand", "(?i)%Wand") && !matchre("$lefthand", "(?i)%WEAPON")) then gosub STOWIT left
               if (!matchre("$righthand", "Empty") && !matchre("$righthand", "(?i)%Wand") && !matchre("$righthand", "(?i)%WEAPON")) then gosub STOWIT right
               pause 0.1
               if (!matchre("$lefthand $righthand", "%Melee.Weapon") && matchre("%WandWeapon", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub GET my %Melee.Weapon
               if (!matchre("$lefthand $righthand", "%WandWeapon") && !matchre("%WandWeapon", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub GET my %WandWeapon
               pause 0.3
               if (("$righthand" = "Empty") && ("$lefthand" = "Empty") && !matchre("$UC_WeaponType","BRAWL")) then gosub GET my %WEAPON
               pause 0.01
               pause 0.1
          }
     gosub WAND_USE
     if matchre("$righthand", "(?i)%Wand") then
          {
               gosub SWAP
               pause 0.1
          }
     if matchre("$righthand $lefthand", "(?i)%Wand") then gosub PUT put %Wand in my %Current.WandCont
     delay 0.001
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
     if matchre("$righthand $lefthand", "(?i)%Wand") then gosub PUT put %Wand in my %Current.WandCont
     if matchre("$righthand $lefthand", "(?i)%Wand") then
          {
               gosub PUT put %Wand in my %Current.WandCont
               pause 0.0001
          }
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
     if matchre("$righthand $lefthand", "(?i)%Wand") then gosub PUT put %Wand in my %Current.WandCont
     if matchre("$lefthand", "(%Melee.Weapon|%WandWeapon)") then gosub STOWIT left
     if matchre("$righthand", "(%Melee.Weapon|%WandWeapon)") then gosub STOWIT right
     return

WAND_USE:
     delay 0.00001
     matchre WAND_USE ^\s*\.\.\.wait|^Sorry\,|^Please wait\.|^You are still stunned
     matchre WAND_CD ^The .+ remains inert\.|You should probably be|You are unable to sufficiently focus
     matchre WAND_GOOD ^You notice the shadows about you briefly lightening\, then they quickly darken once more\.
     matchre WAND_GOOD ^Your blood (rises|begins|boils)|A sudden sensation of warmth
     matchre WAND_GOOD ^Mentally steeling yourself|The overwhelming sense|There is a subtle change
     matchre WAND_GOOD ^You feel more clear-headed
     matchre WAND_GOOD ^You (focus your magical|feel yourself|close your eyes|sense your magic|weave the spell)
     matchre WAND_GOOD ^A soft silver|The force of your spell|Sparkling crystals of ice
     matchre WAND_GOOD ^A sheet of slippery ice|^With a flash of green light
     matchre WAND_GOOD ^The world around you seems to slow
     matchre WAND_GOOD ^Your body feels weird|Your flesh tingles
     matchre WAND_GOOD ^Your tactile sense|^The shimmering globe|^A globe of shimmering blue
     matchre WAND_GOOD ^A sense of heightened muscle
     matchre WAND_GOOD ^You are bathed in a soft white glow|^A soft silver glow envelops
     matchre WAND_GOOD ^A single tendril of pearlescent grey
     matchre WAND_GOOD ^Whorls of crimson fury|^Slippery as an eel
     matchre WAND_GOOD ^The spell pulses through your soul
     matchre WAND_GOOD ^A newfound fluidity of your mind imparts you with enhanced awareness of every nerve in your body\.
     matchre WAND_GOOD ^You close your eyes briefly, focusing on the dull thumping
     matchre WAND_GOOD Extending that focus to a .+\, you feel it resonate with you\.
     matchre WAND_GOOD ^You feel yourself swaying to an internal beat that hums with the natural rhythm
     matchre WAND_GOOD ^There is a subtle change in the lighting around you
     matchre WAND_GOOD ^A globe of shimmering blue fire flickers into being around you
     matchre WAND_GOOD ^Flames dance along the surface|^You weave the spell pattern
     matchre WAND_GOOD ^A sudden sensation of warmth spreads through your body
     matchre WAND_GOOD ^Your flesh tingles as your somatic senses are amplified
     matchre WAND_GOOD ^You feel somehow more alive and vigorous due to the spell
     matchre WAND_GOOD ^Soft waves of a gentle
     matchre WAND_GOOD ^A glistening net of coiling tendrils
     matchre WAND_GOOD a spiritual tendril creeps|Your skin crawls at the clammy
     matchre WAND_GOOD ^A pair of immense ghostly hands
     matchre WAND_GOOD ^The overwhelming sense of unity
     matchre WAND_GOOD ^With a flash of green light
     matchre WAND_GOOD ^Your sense of a renewed unity with your hidden brothers and sisters\.
     matchre WAND_GOOD ^After a brief moment of cloudy thinking
     matchre WAND_GOOD ^Sharpened beneath the spell pattern's lens
     matchre WAND_GOOD ^You harness the currents of air and channel them
     matchre WAND_GOOD ^Soft waves of a gentle\, warm peach color flicker around you\.
     matchre WAND_GOOD ^You feel the strange aliveness in your limbs renew itself\.
     matchre WAND_USE_ALT ^You will need to hold|^You really should
     if matchre("$righthand $lefthand", "(statuette|note|silversteel scepter)") then
          {
               if matchre("$righthand", "silversteel scepter") then
                    {
                         put invoke %Wand at my $lefthandnoun
                    }
               if matchre("$righthand", "(statuette|note)") then
                    {
                         put point %Wand at my $lefthandnoun
                    }
               if matchre("$lefthand", "silversteel scepter") then
                    {
                         put invoke %Wand at my $righthandnoun
                    }
               if matchre("$lefthand", "(statuette|note)") then
                    {
                         put point %Wand at my $righthandnoun
                    }
               matchwait 12
               goto WAND_CD
          }
     else send invoke my %Wand
     matchwait 15
     echo **** MISSING MATCH IN WAND_USE
     goto WAND_CD
WAND_USE_ALT:
     pause 0.0001
     matchre WAND_USE_ALT ^\s*\.\.\.wait|^Sorry\,|^Please wait\.|^You are still stunned
     matchre WAND_GOOD ^You notice the shadows about you briefly lightening\, then they quickly darken once more\.
     matchre WAND_GOOD ^Your blood (rises|begins|boils)|A sudden sensation of warmth
     matchre WAND_GOOD ^Mentally steeling yourself|The overwhelming sense|There is a subtle change
     matchre WAND_GOOD ^You feel more clear-headed
     matchre WAND_GOOD ^You (focus your magical|feel yourself|close your eyes|sense your magic|weave the spell)
     matchre WAND_GOOD ^A soft silver|The force of your spell|Sparkling crystals of ice
     matchre WAND_GOOD ^A sheet of slippery ice|^With a flash of green light
     matchre WAND_GOOD ^The world around you seems to slow
     matchre WAND_GOOD ^Your body feels weird|Your flesh tingles
     matchre WAND_GOOD ^Your tactile sense|^The shimmering globe|^A globe of shimmering blue
     matchre WAND_GOOD ^A sense of heightened muscle
     matchre WAND_GOOD ^You are bathed in a soft white glow|^A soft silver glow envelops
     matchre WAND_GOOD ^A single tendril of pearlescent grey
     matchre WAND_GOOD ^Whorls of crimson fury|^Slippery as an eel
     matchre WAND_GOOD ^The spell pulses through your soul
     matchre WAND_GOOD ^A newfound fluidity of your mind imparts you with enhanced awareness of every nerve in your body\.
     matchre WAND_GOOD ^You close your eyes briefly, focusing on the dull thumping
     matchre WAND_GOOD Extending that focus to a .+\, you feel it resonate with you\.
     matchre WAND_GOOD ^You feel yourself swaying to an internal beat that hums with the natural rhythm
     matchre WAND_GOOD ^There is a subtle change in the lighting around you
     matchre WAND_GOOD ^A globe of shimmering blue fire flickers into being around you
     matchre WAND_GOOD ^Flames dance along the surface|^You weave the spell pattern
     matchre WAND_GOOD ^A sudden sensation of warmth spreads through your body
     matchre WAND_GOOD ^Your flesh tingles as your somatic senses are amplified
     matchre WAND_GOOD ^You feel somehow more alive and vigorous due to the spell
     matchre WAND_GOOD ^Soft waves of a gentle
     matchre WAND_GOOD ^A glistening net of coiling tendrils
     matchre WAND_GOOD a spiritual tendril creeps|Your skin crawls at the clammy
     matchre WAND_GOOD ^A pair of immense ghostly hands
     matchre WAND_GOOD ^The overwhelming sense of unity
     matchre WAND_GOOD ^With a flash of green light
     matchre WAND_GOOD ^Your sense of a renewed unity with your hidden brothers and sisters\.
     matchre WAND_GOOD ^After a brief moment of cloudy thinking
     matchre WAND_GOOD ^Sharpened beneath the spell pattern's lens
     matchre WAND_GOOD ^You harness the currents of air and channel them
     matchre WAND_GOOD ^Soft waves of a gentle\, warm peach color flicker around you\.
     matchre WAND_GOOD ^You feel the strange aliveness in your limbs renew itself\.
     if matchre("$righthand $lefthand", "(statuette|note|silversteel scepter)") then
          {
               if matchre("$righthand", "silversteel scepter") then
                    {
                         put invoke %Wand at my $lefthandnoun
                    }
               if matchre("$righthand", "(statuette|note)") then
                    {
                         put point %Wand at my $lefthandnoun
                    }
               if matchre("$lefthand", "silversteel scepter") then
                    {
                         put invoke %Wand at my $righthandnoun
                    }
               if matchre("$lefthand", "(statuette|note)") then
                    {
                         put point %Wand at my $righthandnoun
                    }
               matchwait 12
               goto WAND_CD
          }
     else send invoke %Wand
     matchwait 10
     echo **** MISSING MATCH IN WAND_USE
     goto WAND_CD
WAND_CD:
     if matchre("$righthand", "%Wand") then
          {
               gosub SWAP
               pause 0.4
          }
     echo
     echo ####################
     echo * %Wand WAND ON COOLDOWN!
     echo ####################
     echo
     # evalmath WandTime ($gametime - 500)
     pause 0.0001
     var WandCD 0
     gosub PUT put %Wand in my %Current.WandCont
     pause 0.0001
     gosub GLANCE
     if matchre("$righthand $lefthand", "%Wand") then gosub PUT put %Wand in my %Current.WandCont
     return
WAND_GOOD:
     if matchre("$righthand", "%Wand") then
          {
               gosub SWAP
               pause 0.4
          }
     echo
     echo #################
     echo * %Wand WAND USED!
     echo #################
     echo
     pause 0.0001
     pause 0.0001
     if (%WandBag = 1) then var Wand1.Use 1
     if (%WandBag = 2) then var Wand2.Use 1
     var WandCD 1
     var WandNum %Wandcount
     math WandNum add 1
     var LastWand %Wand
     put #echo >ItemLog #A166FF * Wand %WandBag-%WandNum! - %Wand
     put #log ** Wand Used %WandBag-%WandNum! - %Wand
     var WandTime $gametime
     gosub PUT put %Wand in my %Current.WandCont
     pause 0.0001
     gosub GLANCE
     if matchre("$righthand $lefthand", "%Wand") then gosub PUT put %Wand in my %Current.WandCont
     return
###########################################################
### BIOMECHANICAL TARANTULA
###########################################################
TARANTULA:
     var turnloop 0
     var taraloop 0
     echo
     echo ###############
     echo * USING TARANTULA~
     echo * LAST SKILLSET: $lastskillset
     echo ###############
     echo
     ## Pools to use
     var skillset Armor|Magic|Weapons|Survival|Lore
     eval TotalPools count("%skillset", "|")
TARANTULA_START:
     if ("%x" = "") then var x 0
     if (%spider.start = 0) then
          {
               var x 0
          }
TARANTULA_GO:
     var y 0
TARANTULA_GO_1:
     math taraloop add 1
     if matchre("$lastskillset", "%skillset(%x)") then math x add 1
     if (%x >= %skillset.length) then
          {
               var x 0
               goto TARANTULA_GO
          }
     if (%taraloop > 9) then
          {
               var spider.start 0
               var taraloop 0
               goto TARANTULA_DONE
          }
TARANTULA_LOOP:
     var spider.start 1
     delay 0.0001
     var activeskill %%skillset(%x).skills(%y)
     if (("%activeskill" = "$lastskillset") || matchre("%activeskill", "(?i)\b(NULL|^%|^\s*$)\b")) then
          {
               math x add 1
               goto TARANTULA_GO
          }
     if ($%activeskill.LearningRate >= 19) then goto TURN_TARANTULA
     math y add 1
     if (%y >= %%skillset(%x).skills.length) then
          {
               math x add 1
               goto TARANTULA_GO
          }
     goto TARANTULA_LOOP

TARANTULA_SWITCH:
     put #var lastskillset %skillset(%x)
     math x add 1
     goto TARANTULA_GO

TURN_TARANTULA:
     math turnloop add 1
     if (%turnloop > 5) then goto TARANTULA_DONE
     delay 0.0001
     var tempskill %activeskill
     eval tempskill replacere("%activeskill", "_", " ")
     matchre TURN_TARANTULA ^\s*\.\.\.wait|^Sorry\,|^Please wait\.|^You are still stunned
     matchre TARANTULA_DONE ^Turn what\?
     matchre TURN_TARANTULA ^You can't do that while entangled in a web
     matchre TURN_TARANTULA ^You don't seem to be able to move to do that
     matchre TARANTULA_SWITCH ^\[You need to vary which skillset you select with every use\.  .* was your last used skillset\.\]
     matchre TARANTULA_CD ^You attempt to turn a .*\, but that doesn\'t seem to do much\.|^What skill did you
     matchre RUB_TARANTULA ^With a \*click\*\, your changes snap into place\.\s+The .* will now consume .* knowledge
     put turn %Tarantula.Name to %tempskill
     matchwait 3
     goto TURN_TARANTULA
RUB_TARANTULA:
     pause 0.0001
     matchre RUB_TARANTULA ^\s*\.\.\.wait|^Sorry\,|^Please wait\.|^You are still stunned
     matchre RUB_TARANTULA ^You can't do that while entangled in a web
     matchre RUB_TARANTULA ^You don't seem to be able to move to do that
     matchre TARANTULA_GO However\, your changes fail to lock into place\.
     matchre TARANTULA_SWITCH ^\[You need to vary which skillset you select with every use\.  .* was your last used skillset\.\]
     matchre TARANTULA_GO_1 ^But you currently aren't learning any .+\.
     matchre TARANTULA_CD ^You try\, but the .* is unresponsive
     matchre TARANTULA_SETLAST ^The .* comes alive in your hand!
     matchre RUB_TARANTULA_ALT ^You will need to hold
     put rub my %Tarantula.Name
     matchwait 3
     goto RUB_TARANTULA
RUB_TARANTULA_ALT:
     pause 0.0001
     matchre RUB_TARANTULA ^\s*\.\.\.wait|^Sorry\,|^Please wait\.|^You are still stunned
     matchre RUB_TARANTULA ^You can't do that while entangled in a web
     matchre RUB_TARANTULA ^You don't seem to be able to move to do that
     matchre TARANTULA_GO However\, your changes fail to lock into place\.
     matchre TARANTULA_SWITCH ^\[You need to vary which skillset you select with every use\.  .* was your last used skillset\.\]
     matchre TARANTULA_GO_1 ^But you currently aren't learning any .+\.
     matchre TARANTULA_CD ^You try\, but the .* is unresponsive
     matchre TARANTULA_SETLAST ^The .* comes alive in your hand!
     put rub %Tarantula.Name
     matchwait 5
     return
TARANTULA_SETLAST:
     put exp all
     waitforre Total Ranks|EXP HELP|Rested|I could|Overall|Showing|SKILL|Circle|What|The|Fuck
     pause 0.0001
     put #var lastskillset %skillset(%x)
     put #echo >ItemLog #7CFC00 * Tarantula - %tempskill
     echo ######################
     echo * LAST TARANTULA SKILLSET: $lastskillset
     echo ######################
     echo
     var x 0
     return
TARANTULA_CD:
     echo ####################
     echo *** Tarantula still on Cooldown!
     echo ####################
     return
TARANTULA_DONE:
     echo #######################
     echo *** No Available Skills to Drain!
     echo #######################
     return
####################################################
# ASTROLABE MODULE
####################################################
ASTROLABE_GO:
     pause 0.0001
     if !matchre("$lefthand", "Empty") then gosub STOWIT left
     pause 0.0001
     if (($UC_Astrolabe.Last > 2100) && (%Astro1.Used = 1)) then goto ASTROLABE_2
     if ((%Astro1.Used = 1) && (%Astro2.Used = 0)) then goto ASTROLABE_2
     if ($UC_Astrolabe.Last > 2450) then goto ASTROLABE_2
     echo #################
     echo *** USING ASTROLABE 1!
     echo #################
     if !matchre("%Astro1.Container", "NULL") then gosub GET my %ASTROLABE1 from my %Astro1.Container
     pause 0.0001
     if !matchre("$righthand $lefthand", "astrolabe") then gosub GET my %ASTROLABE1
     pause 0.0001
     put invoke astrolabe
     pause 0.1
     pause 0.1
     pause 0.0001
     gosub PUT put astro in my %Astro1.Container
     pause 0.0001
     pause 0.0001
     if matchre("$righthand $lefthand", "astrolabe") then gosub STOWIT astro
     var Astro1.Used 1
     put #echo >ItemLog #DB75FF *** Used Astrolabe1!
     goto ASTROLABE_RETURN
ASTROLABE_2:
     if matchre("%ASTROLABE2", "NULL") then goto ASTROLABE_RETURN
     echo #################
     echo *** USING ASTROLABE 2!
     echo #################
     if !matchre("%Astro2.Container", "NULL") then gosub GET my %ASTROLABE2 from my %Astro2.Container
     pause 0.0001
     if !matchre("$righthand $lefthand", "astrolabe") then gosub GET my %ASTROLABE2
     pause 0.0001
     put invoke astrolabe
     pause 0.1
     pause 0.0001
     gosub PUT put astro in my %Astro2.Container
     if matchre("$righthand $lefthand", "astrolabe") then gosub STOWIT astro
     var Astro2.Used 1
     put #echo >ItemLog #DB75FF *** Used Astrolabe2!
ASTROLABE_RETURN:
     if ($UC_Astrolabe.Last < 3680) then return
     return
####################################################################################################################################################################################################################
####################################################################################################################################################################################################################
#### GUILD SUBS - GUILD GOSUBS - GUILD ROUTINES - GUILD ENGINE
####################################################################################################################################################################################################################
####################################################################################################################################################################################################################
STOPINVIS:
STOP_INVIS:
     delay 0.0001
     echo *** Removing Invis..
     if ("$guild" = "Necromancer") then
          {
               gosub PUT release eotb
               pause 0.0001
          }
     if ("$guild" = "Thief") then
          {
               gosub PUT khri stop silence vanish
               pause 0.0001
          }
     if ("$guild" = "Moon Mage") then
          {
               gosub PUT release rf
               pause 0.0001
          }
     pause 0.0001
     return
########################################
# DARK VISION / LIGHT SOURCE HANDLING
########################################
DARK_CHECK:
     delay 0.0001
     gosub DARKCHECK_TIMER
     if (%darkLast < 500) then return
DARK_CHECK_1:
     var darkroom 1
     matchre DARK_YES pitch dark|pitch black
     matchre LIGHT_YES Obvious|I|What|You
     put look
     matchwait 5
     return
DARK_YES:
     var darkroom 1
     var darkTime $gametime
     gosub LIGHT_SOURCE
     return
LIGHT_YES:
     var darkroom 0
     var darkTime $gametime
     return
##################################
DARK_DOUBLECHECK:
     delay 0.0001
     matchre DARK_NOPE pitch dark
     matchre LIGHT_ROOM Obvious|I|What|You
     put look
     matchwait 5
     return
DARK_NOPE:
     var darkroom 1
     var darkTime $gametime
     return
LIGHT_ROOM:
     var darkroom 0
     var darkTime $gametime
     return
 ################################
LIGHT_SOURCE:
     delay 0.0001
     echo ####################
     echo *** Checking for DARKVISION
     echo *** NEED A LIGHT SOURCE
     echo ####################
     pause 0.0001
     pause 0.0001
     if (("$guild" = "Ranger") && ($circle > 34)) then
          {
               gosub stowing
               gosub PUT align 30
               pause 0.5
               pause
               gosub PUT beseech dark to sing
               pause 0.5
               pause 0.5
               gosub DARK_DOUBLECHECK
               if (%darkroom = 0) then goto YES_DARKVISION
          }
     if ("$guild" = "Thief") then
          {
               gosub PUT khri sight
               pause 0.5
               pause 0.5
               gosub DARK_DOUBLECHECK
               if (%darkroom = 0) then goto YES_DARKVISION
          }
LIGHT_SOURCE_1:
     if (("$guild" = "Cleric") && matchre("%abbrevs", "(?i)DR")) then
          {
               if ("$preparedspell" != "None") then
                    {
                         gosub RELEASE spell
                         gosub RELEASE_CAMB
                    }
               if ($Utility.Ranks < 120) then gosub PUT prep DR 2
               if (($Utility.Ranks >= 120) && ($Utility.Ranks < 200)) then gosub PUT prep DR 5
               if (($Utility.Ranks >= 200) && ($Utility.Ranks < 300)) then gosub PUT prep DR 9
               if (($Utility.Ranks >= 300) && ($Utility.Ranks < 500)) then gosub PUT prep DR 12
               if (($Utility.Ranks >= 500) && ($Utility.Ranks < 600)) then gosub PUT prep DR 15
               if ($Utility.Ranks >= 600) then gosub PUT prep DR 15
               pause 19
               send cast
               pause 0.5
               pause 0.5
               pause 0.3
               if ($SpellTimer.DivineRadiance.active = 0) then goto LIGHT_SOURCE_2
               gosub DARK_DOUBLECHECK
               if (%darkroom = 0) then goto YES_DARKVISION
          }
LIGHT_SOURCE_2:
     if (("$guild" = "Moon Mage") && matchre("%abbrevs", "(?i)TS")) then
          {
               if ("$preparedspell" != "None") then
                    {
                         gosub RELEASE spell
                         gosub RELEASE_CAMB
                    }
               if ($Augmentation.Ranks < 120) then gosub PUT prep TS 5
               if (($Augmentation.Ranks >= 120) && ($Augmentation.Ranks < 200)) then gosub PUT prep TS 7
               if (($Augmentation.Ranks >= 200) && ($Augmentation.Ranks < 300)) then gosub PUT prep TS 12
               if (($Augmentation.Ranks >= 300) && ($Augmentation.Ranks < 500)) then gosub PUT prep TS 15
               if (($Augmentation.Ranks >= 500) && ($Augmentation.Ranks < 600)) then gosub PUT prep TS 20
               if ($Augmentation.Ranks >= 600) then gosub PUT prep TS 33
               pause 20
               put cast
               pause 0.5
               pause 0.5
               pause 0.2
               if ($SpellTimer.TenebrousSense.active = 0) then goto LIGHT_SOURCE_3
               gosub DARK_DOUBLECHECK
               if (%darkroom = 0) then goto YES_DARKVISION
          }
LIGHT_SOURCE_3:
     if ("$guild" = "Paladin") then goto GLYPH_LIGHT
     goto GOGGLE_CHECK
GLYPH_LIGHT:
     pause 0.0001
     matchre GOGGLE_CHECK ^You try
     matchre YES_DARKVISION The tiny balls of light swirl|A brief burst of pain
     put glyph light
     matchwait 7
     goto GOGGLE_CHECK
###########################################
GOGGLE_CHECK:
GOGGLE_YES:
     if (%HaveGoggles = 0) then goto STARGLASS_YES
     pause 0.0001
     gosub GET my goggle
     pause 0.0001
     pause 0.0001
     matchre GOGGLE_2 remains inert
     matchre GOGGLE_STOW ^Your tactile sense
     put rub my goggle
     matchwait 9
GOGGLE_2:
     pause 0.0001
     if matchre("$righthand $lefthand", "goggle") then gosub PUT put goggle in my %Wand1.Container
     pause 0.1
     if matchre("$righthand $lefthand", "goggle") then gosub STOWIT goggle
     gosub GET my other goggle
     pause 0.1
     if !matchre("$righthand $lefthand", "goggle") then goto STARGLASS_YES
     matchre GOGGLE_NONE remains inert
     matchre GOGGLE_STOW ^Your tactile sense
     put rub my goggle
     matchwait 10
     goto STARGLASS_YES
GOGGLE_NONE:
     pause 0.0001
     gosub PUT put goggle in my %Wand1.Container
     pause 0.0001
     if matchre("$righthand $lefthand", "goggle") then gosub STOWIT goggle
     goto STARGLASS_YES
GOGGLE_STOW:
     pause 0.0001
     gosub PUT put goggle in my %Wand1.Container
     pause 0.0001
     if matchre("$righthand $lefthand", "goggle") then gosub STOWIT goggle
     gosub DARK_DOUBLECHECK
     if (%darkroom = 0) then goto YES_DARKVISION
#########
STARGLASS_YES:
     gosub stowing
     if (%HaveStarglass = 0) then goto LANTERN_YES
     pause 0.0001
     gosub GET starglass
     pause 0.0001
     pause 0.1
     if !matchre("$righthand $lefthand", "(?i)starglass") then goto LANTERN_YES
     if matchre("$guild", "%MAGICUSER") then
          {
               gosub CHARGE starglass 20
               pause 0.4
               gosub CHARGE starglass 20
               pause 0.4
          }
     put rub my starglass
     pause 0.2
     pause 0.0001
     gosub WEAR starglass
     pause 0.3
     gosub stowing
     gosub DARK_DOUBLECHECK
     if (%darkroom = 0) then goto YES_DARKVISION
############
LANTERN_YES:
     var TriedOil 0
     if (%HaveLantern = 0) then goto GAETHZEN_YES
     if ((%HaveFlint = 0) && (%HaveLighter = 0)) then goto GAETHZEN_YES
     gosub stowing
     pause 0.0001
     gosub GET my lantern
LANTERN_DROP:
     gosub PUT drop my lantern
     pause 0.0001
     gosub GET my flint
     gosub GET my %Melee.Weapon
     pause 0.1
     if (!matchre("$righthand $lefthand", "flint") && !matchre("$righthand $lefthand", "%Melee.Weapon")) then
          {
               echo **** FLINT/WEAPON ERROR IN LIGHT SOURCE - Righthand: $righthand / Lefthand: $lefthand
               put #echo >Log #FF3E00 **** FLINT/WEAPON ERROR IN LIGHT SOURCE - Righthand: $righthand / Lefthand: $lefthand
               gosub SHEATH_CHECK
               gosub stowing
               gosub STOWIT lantern
               goto GAETHZEN_YES
          }
LANTERN_LIGHT:
     pause 0.0001
     pause 0.0001
     pause 0.0001
     matchre LIT_LANTERN manage to get a flame going
     matchre REFUEL_IT But the flames fail to catch hold and they sputter out immediately\.
     put light lantern with my flint
     matchwait 5
     goto LANTERN_LIGHT
REFUEL_IT:
     if ((%HaveOil = 0) || (%TriedOil = 1)) then
          {
               echo ##################
               echo *** NO LAMP OIL FOR LANTERN!!
               echo *** RESTOCK ON LAMP OIL!!
               echo ##################
               gosub stowing
               goto GAETHZEN_YES
          }
     pause 0.1
     gosub stowing
     pause 0.0001
     gosub GET lantern
     gosub GET lamp oil
     pause 0.0001
     put pour oil in lantern
     pause 0.3
     pause 0.0001
     var TriedOil 1
     gosub STOWIT oil
     goto LANTERN_DROP
LIT_LANTERN:
     pause 0.0001
     echo *** LANTERN LIT!
     pause 0.0001
     pause 0.0001
     gosub SHEATH_CHECK
     gosub STOWIT flint
     gosub stowing
     gosub GET lantern
     pause 0.0001
     put wear lantern
     pause 0.2
     pause 0.0001
     gosub DARK_DOUBLECHECK
     if (%darkroom = 0) then goto YES_DARKVISION
#############
GAETHZEN_YES:
     if (%HaveGaethzen = 0) then goto TORCH_YES
     echo ####################
     echo # CHARGING GAETHZEN
     echo ####################
     gosub stowing
     pause 0.0001
     gosub GET gaethzen gnome	
     pause 0.0001
     gosub CHARGE gnome 20
     pause 2
     gosub CHARGE gnome 20
     pause 2
     gosub CHARGE gnome 20
     pause 2
     gosub PUT rub my gnome
     pause 0.5
     put wear gnome
     pause 0.2
     pause 0.0001
     gosub DARK_DOUBLECHECK
     if (%darkroom = 0) then goto YES_DARKVISION
###############
TORCH_YES:
     if ((%HaveLighter = 0) && (%HaveFlint = 0)) then goto NO_DARKVISION
     if (%HaveTorch = 0) then goto NO_DARKVISION
     gosub stowing
     pause 0.0001
     if (%HaveLighter = 1) then
          {
               gosub GET my %Lighter.Name
               pause 0.1
               pause 0.0001
               if !matchre("$righthand", "(?i)%Lighter.Name") then
                    {
                         echo *** LIGHTER NOT FOUND! - TURNING LIGHTER OFF
                         put #var UC_Lighter 0
                         var HaveLighter 0
                         goto TORCH_YES_FLINT
                    }
               gosub GET my torch
               pause 0.0001
               pause 0.0001
               if !matchre("$righthand $lefthand", "(?i)torch") then goto NO_DARKVISION
               gosub PUT point %Lighter.Name at torch
               pause 0.0001
               pause 0.0001
               gosub STOWIT %Lighter.Name
               gosub DARK_DOUBLECHECK
               if (%darkroom = 0) then goto YES_DARKVISION
          }
TORCH_YES_FLINT:
     if (%HaveFlint = 0) then goto NO_DARKVISION
     pause 0.0001
     if !matchre("$righthand $lefthand", "(?i)torch") then gosub GET my torch
     pause 0.0001
     gosub PUT drop my torch
     pause 0.0001
     gosub GET my flint
     gosub GET my %Melee.Weapon
     pause 0.0001
     if (!matchre("$righthand $lefthand", "flint") && !matchre("$righthand $lefthand", "%Melee.Weapon")) then
          {
               echo **** FLINT/WEAPON ERROR IN LIGHT SOURCE - Righthand: $righthand / Lefthand: $lefthand
               put #echo >Log #FF3E00 **** FLINT/WEAPON ERROR IN LIGHT SOURCE - Righthand: $righthand / Lefthand: $lefthand
               gosub SHEATH_CHECK
               gosub stowing
               gosub STOW torch
               goto NO_DARKVISION
          }
     pause 0.0001
     gosub PUT light torch with my flint
     pause 0.0001
     gosub SHEATH_CHECK
     gosub STOWIT flint
     gosub stowing
     gosub GET torch
     pause 0.1
     gosub DARK_DOUBLECHECK
     if (%darkroom = 0) then goto YES_DARKVISION
     goto NO_DARKVISION

YES_DARKVISION:
     echo ##################
     echo *** DARK VISION ACTIVATED!
     echo ##################
     var darkroom 1
     pause 0.0001
     gosub stowing
     gosub RETREAT
     return
NO_DARKVISION:
     echo ###################
     echo *** NO DARK VISION SKILL
     echo *** OR MISSING TORCH/FLINT!!
     echo *** STUCK IN THE DARK! HAHA..
     echo *** Get a torch and flint
     echo ###################
     var darkroom 0
     pause 0.0001
     gosub stowing
     return
####################################
### TRADER SUBS / TRADER GOSUBS
###################################
TRADER_VARS:
     var Tessera 0
     var aura 0
     var aurafull 0
     var AnloralTime $gametime
     return
TRADER_STRIP:
     unvar Cleric.Cyclics
     unvar Cleric.Cyclics.mana
     unvar Cleric.Buffs
     unvar Cleric.Augmentation.Spell
     unvar Cleric.Debilitation.Spell
     unvar Cleric.Target.Spell
     unvar Cleric.Utility.Spell
     unvar Cleric.Warding.Spell
     unvar Cleric.Sorcery.Spell
     unvar WM.Cyclics
     unvar WM.Cyclics.mana
     unvar WM.Buffs
     unvar WM.Augmentation.Spell
     unvar WM.Debilitation.Spell
     unvar WM.Target.Spell
     unvar WM.Utility.Spell
     unvar WM.Warding.Spell
     unvar WM.Sorcery.Spell
     unvar Empath.Cyclics
     unvar Empath.Cyclics.mana
     unvar Empath.Buffs
     unvar Empath.Augmentation.Spell
     unvar Empath.Debilitation.Spell
     unvar Empath.Target.Spell
     unvar Empath.Utility.Spell
     unvar Empath.Warding.Spell
     unvar Empath.Sorcery.Spell
     unvar Bard.Cyclics
     unvar Bard.Cyclics.mana
     unvar Bard.Buffs
     unvar Bard.Augmentation.Spell
     unvar Bard.Debilitation.Spell
     unvar Bard.Target.Spell
     unvar Bard.Utility.Spell
     unvar Bard.Warding.Spell
     unvar Bard.Sorcery.Spell
     unvar Paladin.Cyclics
     unvar Paladin.Cyclics.mana
     unvar Paladin.Buffs
     unvar Paladin.Augmentation.Spell
     unvar Paladin.Debilitation.Spell
     unvar Paladin.Target.Spell
     unvar Paladin.Utility.Spell
     unvar Paladin.Warding.Spell
     unvar Paladin.Sorcery.Spell
     unvar Necro.Cyclics
     unvar Necro.Cyclics.mana
     unvar Necro.Buffs
     unvar Necro.Augmentation.Spell
     unvar Necro.Debilitation.Spell
     unvar Necro.Target.Spell
     unvar Necro.Utility.Spell
     unvar Necro.Warding.Spell
     unvar Necro.Sorcery.Spell
     unvar Ranger.Cyclics
     unvar Ranger.Cyclics.mana
     unvar Ranger.Buffs
     unvar Ranger.Augmentation.Spell
     unvar Ranger.Debilitation.Spell
     unvar Ranger.Target.Spell
     unvar Ranger.Utility.Spell
     unvar Ranger.Warding.Spell
     unvar Ranger.Sorcery.Spell
     unvar MM.Cyclics
     unvar MM.Cyclics.mana
     unvar MM.Buffs
     unvar MM.Augmentation.Spell
     unvar MM.Debilitation.Spell
     unvar MM.Target.Spell
     unvar MM.Utility.Spell
     unvar MM.Warding.Spell
     unvar MM.Sorcery.Spell
     unvar CFB.Mana
     unvar QE.Mana
     return
TRADER_AURA:
     var aura 1
     var aurafull 0
     action var aurafull 1 when ^Your aura contains as much starlight as you can safely handle\.
     pause 0.0001
     pause 0.0001
     matchre AURA_1 The smallest hint of starlight flickers within your aura\.
     matchre AURA_2 A bare flicker of starlight plays within your aura\.
     matchre AURA_3 A faint amount of starlight illuminates your aura\.
     matchre AURA_4 Your aura pulses slowly with starlight\.
     matchre AURA_5 A steady pulse of starlight runs through your aura\.
     matchre AURA_6 Starlight dances vividly across the confines of your aura\.
     matchre AURA_7 Strong pulses of starlight flare within your aura\.
     matchre AURA_8 Your aura seethes with brilliant starlight\.
     matchre AURA_9 Your aura is blinding\!
     matchre AURA_10 The power contained in your aura defies visual metaphor\.
     put perceive aura
     matchwait 9
     return
AURA_1:
     var aura 1
     goto AURA_RETURN
AURA_2:
     var aura 2
     goto AURA_RETURN
AURA_3:
     var aura 3
     goto AURA_RETURN
AURA_4:
     var aura 4
     goto AURA_RETURN
AURA_5:
     var aura 5
     goto AURA_RETURN
AURA_6:
     var aura 6
     goto AURA_RETURN
AURA_7:
     var aura 7
     goto AURA_RETURN
AURA_8:
     var aura 8
     goto AURA_RETURN
AURA_9:
     var aura 9
     goto AURA_RETURN
AURA_10:
     var aura 10
     goto AURA_RETURN
AURA_11:
     var aura 11
AURA_RETURN:
     echo
     echo #################
     echo ** Trader Aura Level: %aura
     echo #################
     echo
     pause 0.1
     if ((%aura < 2) && (%HaveFragment = 1) && (%aurafull = 0)) then
          {
               echo
               echo ###########################
               echo ** Aura Low - Checking for Iron Fragment
               echo ##########################
               echo
               gosub stowing
               gosub GET iron fragment
               if matchre("$righthand $lefthand", "(?i)fragment") then put get fragment from my black sack
               pause 0.4
               pause 0.2
               if !matchre("$righthand $lefthand", "(?i)fragment") then
                    {
                         echo ** No Iron Fragment Found
                         goto AURA_RETURN_2
                    }
               send invoke my fragment
               pause 0.5
               pause 0.2
               if matchre("$righthand $lefthand", "(?i)fragment") then put drop my fragment
               pause 0.2
          }
AURA_RETURN_2:
     action remove ^Your aura contains as much starlight as you can safely handle\.
     return
#####################################################
### MOONIE SUBS / MOON MAGE SUBS
#####################################################
MM_VARS:
     var Pool.Magic no
     var Pool.Lore no
     var Pool.Offense no
     var Pool.Defense no
     var Pool.Survival no
     var IOTSloop 0
     var lastIOTS NULL
     var shardcount 0
     var shardnumber 0
     var RTR OFF
     var COL 0
     var SLS NULL
     var Combat.Observe ON
     var indoor.check 0
     var Telescope.Container NULL
     var NoTele 0
     var NeedTele 0
     var TeleOpen 0
     var Observe 1
     var Predict.Tool NULL
     var observeTime $gametime
     return
MM_STRIP:
     unvar Cleric.Cyclics
     unvar Cleric.Cyclics.mana
     unvar Cleric.Buffs
     unvar Cleric.Augmentation.Spell
     unvar Cleric.Debilitation.Spell
     unvar Cleric.Target.Spell
     unvar Cleric.Utility.Spell
     unvar Cleric.Warding.Spell
     unvar Cleric.Sorcery.Spell
     unvar WM.Cyclics
     unvar WM.Cyclics.mana
     unvar WM.Buffs
     unvar WM.Augmentation.Spell
     unvar WM.Debilitation.Spell
     unvar WM.Target.Spell
     unvar WM.Utility.Spell
     unvar WM.Warding.Spell
     unvar WM.Sorcery.Spell
     unvar Empath.Cyclics
     unvar Empath.Cyclics.mana
     unvar Empath.Buffs
     unvar Empath.Augmentation.Spell
     unvar Empath.Debilitation.Spell
     unvar Empath.Target.Spell
     unvar Empath.Utility.Spell
     unvar Empath.Warding.Spell
     unvar Empath.Sorcery.Spell
     unvar Bard.Cyclics
     unvar Bard.Cyclics.mana
     unvar Bard.Buffs
     unvar Bard.Augmentation.Spell
     unvar Bard.Debilitation.Spell
     unvar Bard.Target.Spell
     unvar Bard.Utility.Spell
     unvar Bard.Warding.Spell
     unvar Bard.Sorcery.Spell
     unvar Paladin.Cyclics
     unvar Paladin.Cyclics.mana
     unvar Paladin.Buffs
     unvar Paladin.Augmentation.Spell
     unvar Paladin.Debilitation.Spell
     unvar Paladin.Target.Spell
     unvar Paladin.Utility.Spell
     unvar Paladin.Warding.Spell
     unvar Paladin.Sorcery.Spell
     unvar Necro.Cyclics
     unvar Necro.Cyclics.mana
     unvar Necro.Buffs
     unvar Necro.Augmentation.Spell
     unvar Necro.Debilitation.Spell
     unvar Necro.Target.Spell
     unvar Necro.Utility.Spell
     unvar Necro.Warding.Spell
     unvar Necro.Sorcery.Spell
     unvar Ranger.Cyclics
     unvar Ranger.Cyclics.mana
     unvar Ranger.Buffs
     unvar Ranger.Augmentation.Spell
     unvar Ranger.Debilitation.Spell
     unvar Ranger.Target.Spell
     unvar Ranger.Utility.Spell
     unvar Ranger.Warding.Spell
     unvar Ranger.Sorcery.Spell
     unvar Trader.Cyclics
     unvar Trader.Cyclics.mana
     unvar Trader.Buffs
     unvar Trader.Augmentation.Spell
     unvar Trader.Debilitation.Spell
     unvar Trader.Target.Spell
     unvar Trader.Utility.Spell
     unvar Trader.Warding.Spell
     unvar Trader.Sorcery.Spell
     unvar CFB.Mana
     unvar QE.Mana
     return
PLANET_RESET:
     var MM.Heart 0
     var MM.Giant 0
     var MM.Toad 0
     var MM.Scales 0
     var MM.Ox 0
     var MM.Wolf 0
     var MM.Cat 0
     var MM.Spider 0
     var MM.Boar 0
     var MM.Jackal 0
     var MM.Triquetra 0
     var MM.Magpie 0
     var MM.Heron 0
     var MM.Cow 0
     var MM.Ram 0
     var MM.Wren 0
     var MM.KingSnake 0
     var MM.Raven 0
     var MM.Hare 0
     var MM.Lion 0
     var MM.Panther 0
     var MM.Cobra 0
     var MM.Dolphin 0
     var MM.Unicorn 0
     var MM.Vulture 0
     var MM.Nightingale 0
     var MM.Wolverine 0
     var MM.Mongoose 0
     var MM.Goshawk 0
     var MM.Welkin 0
     var MM.Phoenix 0
     var MM.Dove 0
     var MM.Coyote 0
     var MM.Donkey 0
     var MM.Shark 0
     var MM.Viper 0
     var MM.Weasel 0
     var MM.Albatross 0
     var MM.Centaur 0
     var MM.Kertigen 0
     var MM.Dergati 0
     var MM.Brigantine 0
     var MM.Scales 0
     var MM.Archer 0
     var MM.Verena 0
     var MM.Estrilda 0
     var MM.Yoakena 0
     var MM.Penhetia 0
     var MM.Szeldia 0
     var MM.Merewalda 0
     var MM.Ismenia 0
     var MM.Morleena 0
     var MM.Amlothi 0
     var MM.Dawgolesh 0
     var MM.Erqutra 0
     var MM.Durgaulda 0
     return
PLANETS_RESET:
     var MM.Verena 0
     var MM.Estrilda 0
     var MM.Yoakena 0
     var MM.Penhetia 0
     var MM.Szeldia 0
     var MM.Merewalda 0
     var MM.Ismenia 0
     var MM.Morleena 0
     var MM.Amlothi 0
     var MM.Dawgolesh 0
     var MM.Erqutra 0
     var MM.Durgaulda 0
     return
#############################################
PLANET_CHECK:
     var planet NULL
     pause 0.0001
     gosub PLANETS_RESET
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then gosub RETREAT
     action (observe) on
     pause 0.0001
     pause 0.0001
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     if (%IOTSloop < 2) then
          {
               put observe sky
               wait
               pause 0.1
               pause 0.1
               pause 0.0001
               pause 0.0001

          }
     action (observe) off
     if ((%MM.Verena = 1) && !matchre("%lastIOTS", "(?i)(durgaulda|yoakena|ismenia|erqutra|amlothi|morleena|penhetia|estrilda)")) then
          {
               var planet verena
               var bufftype agility
               return
          }
     if ((%MM.Szeldia = 1) && !matchre("%lastIOTS", "(?i)(durgaulda|yoakena|ismenia|erqutra|amlothi|morleena|penhetia|estrilda)")) then
          {
               var planet szeldia
               var bufftype agility
               return
          }
     if ((%MM.Merewalda = 1) && !matchre("%lastIOTS", "(?i)(durgaulda|yoakena|ismenia|erqutra|amlothi|morleena|penhetia|estrilda)")) then
          {
               var planet merewalda
               var bufftype agility
               return
          }
     if ((%MM.Dawgolesh = 1) && !matchre("%lastIOTS", "(?i)(durgaulda|yoakena|ismenia|erqutra|amlothi|morleena|penhetia|estrilda)")) then
          {
               var planet dawgolesh
               var bufftype agility
               return
          }

     if ((%MM.Durgaulda = 1) && !matchre("%lastIOTS", "(?i)(amlothi|morleena|penhetia|estrilda|verena|szeldia|merwalda|dawgolesh)")) then
          {
               var planet Durgaulda
               var bufftype wisdom
               return
          }
     if ((%MM.Yoakena = 1) && !matchre("%lastIOTS", "(?i)(amlothi|morleena|penhetia|estrilda|verena|szeldia|merwalda|dawgolesh)")) then
          {
               var planet yoakena
               var bufftype wisdom
               return
          }
     if ((%MM.Ismenia = 1) && !matchre("%lastIOTS", "(?i)(amlothi|morleena|penhetia|estrilda|verena|szeldia|merwalda|dawgolesh)")) then
          {
               var planet ismenia
               var bufftype wisdom
               return
          }
     if ((%MM.Erqutra = 1) && !matchre("%lastIOTS", "(?i)(amlothi|morleena|penhetia|estrilda|verena|szeldia|merwalda|dawgolesh)")) then
          {
               var planet erqutra
               var bufftype wisdom
               return
          }
     if ((%MM.Penhetia = 1) && !matchre("%lastIOTS", "(?i)(durgaulda|yoakena|ismenia|erqutra|verena|szeldia|merwalda|dawgolesh)")) then
          {
               var planet penhetia
               var bufftype discipline
               return
          }
     if ((%MM.Estrilda = 1) && !matchre("%lastIOTS", "(?i)(durgaulda|yoakena|ismenia|erqutra|verena|szeldia|merwalda|dawgolesh)")) then
          {
               var planet estrilda
               var bufftype discipline
               return
          }
     if ((%MM.Morleena = 1) && !matchre("%lastIOTS", "(?i)(durgaulda|yoakena|ismenia|erqutra|verena|szeldia|merwalda|dawgolesh)")) then
          {
               var planet morleena
               var bufftype discipline
               return
          }
     if ((%MM.Amlothi = 1) && !matchre("%lastIOTS", "(?i)(durgaulda|yoakena|ismenia|erqutra|verena|szeldia|merwalda|dawgolesh)")) then
          {
               var planet amlothi
               var bufftype discipline
               return
          }
     echo ***** NO VISIBLE OR VALID PLANETS FOR IOTS!
     return
IOTS_CHECK:
     var IOTSloop 0
     var lastIOTS NULL
     pause 0.0001
     echo ###########
     echo *** IOTS CHECK ***
     echo ###########
     gosub PERCEIVE_PLANET
     eval lastIOTS replacere("%lastIOTS", "\'", "")
IOTS_CHECK_1:
     pause 0.0001
     math IOTSloop add 1
     if (%IOTSloop > 4) then goto IOTS_RETURN
     gosub PLANET_CHECK
     if matchre("%planet", "(?i)NULL") then goto IOTS_RETURN
     if (matchre("%planet", "(amlothi|morleena|penhetia|estrilda)") && matchre("%lastIOTS", "(?i)(durgaulda|yoakena|ismenia|erqutra|verena|szeldia|merwalda|dawgolesh)")) then goto IOTS_CHECK_1
     if (matchre("%planet", "(durgaulda|yoakena|ismenia|erqutra)") && matchre("%lastIOTS", "(?i)(amlothi|morleena|penhetia|estrilda|verena|szeldia|merwalda|dawgolesh)")) then goto IOTS_CHECK_1
     if (matchre("%planet", "(verena|szeldia|merwalda|dawgolesh)") && matchre("%lastIOTS", "(?i)(durgaulda|yoakena|ismenia|erqutra|amlothi|morleena|penhetia|estrilda)")) then goto IOTS_CHECK_1
IOTS_RETURN:
     return
MM_SHARDS:
SHARD_CHECK:
     var shardcount 0
     var shardnumber 0
     pause 0.0001
     if ("$guild" != "Moon Mage") then
          {
               if (!matchre("$roomobjs", "\bcoins?\b") && (%InCombat = 1)) then put drop 2 copper kron
               pause 0.2
               return
          }
     if (($Time.isKatambaUp = 0) && ($Time.isXibarUp = 0) && ($Time.isYavashUp = 0)) then return
     var shards Zero
     var i 0
     var countarray Zero|One|Two|Three|Four|Five|Six|Seven|Eight|Nine|Ten|Eleven|Twelve|Thirteen|Fourteen|Fifteen|Sixteen|Seventeen|Eighteen|Nineteen|Twenty|Twenty-one|Twenty-two|Twenty-three|Twenty-four|Twenty-five|Twenty-six|Twenty-seven|Twenty-eight|Twenty-nine|Thirty|Thirty-one|Thirty-two|Thirty-three|Thirty-four|Thirty-five|Thirty-six|Thirty-seven|Thirty-eight|Thirty-nine|Forty|Forty-one|Forty-two|Forty-three|Forty-four|Forty-five|Forty-six|Forty-seven|Forty-eight|Forty-nine|Fifty|Fifty-one|Fifty-two|Fifty-three|Fifty-four|Fifty-five|Fifty-six|Fifty-seven|Fifty-eight|Fifty-nine|Sixty|Sixty-one|Sixty-two|Sixty-three|Sixty-four|Sixty-five|Sixty-six|Sixty-seven|Sixty-eight|Sixty-nine|Seventy|Seventy-one|Seventy-two|Seventy-three|Seventy-four|Seventy-five|Seventy-six|Seventy-seven|Seventy-eight|Seventy-nine|Eighty|Eighty-one|Eighty-two|Eighty-three|Eighty-four|Eighty-five|Eighty-six|Eighty-seven|Eighty-eight|Eighty-nine|Ninety|Ninety-one|Ninety-two|Ninety-three|Ninety-four|Ninety-five|Ninety-six|Ninety-seven|Ninety-eight|Ninety-nine|One hundred
     action var shards $1 when (\S+(?: hundred)?) (!?.+) slivers orbit your head\.
     eval shardcount count("%countarray", "|")
     pause 0.0001
     matchre SHARDCHECK_DONE ^Encumbrance|What|Sorry
     send look $charactername;-0.5 enc
     matchwait 2
SHARDCHECK_DONE:
     pause 0.0001
SHARDCOUNT:
     if (%i > %shardcount) then
          {
               if (!matchre("$roomobjs", "\bcoins?\b") && (%InCombat = 1)) then put drop 2 copper kron
               pause 0.1
               return
          }
     if ("%countarray(%i)" = "%shards") then
          {
               var shardnumber %i
               goto FOUNDIT
          }
     math i add 1
     pause 0.0001
     goto SHARDCOUNT
FOUNDIT:
     echo
     echo #################
     echo * ORBITING SHARDS: %shardnumber
     echo #################
     echo
     unvar shards
     unvar countarray
     unvar i
     return

MOONBLADE_PREP:
     # debug 10
     var MG.prep 15
     var savedWeapon NULL
     echo
     echo ##############
     echo ** Breaking Moonblade
     echo ** For TKT ammo
     echo ##############
     echo
     pause 0.0001
     pause 0.0001
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if !matchre("$lefthand", "Empty") then
          {
               var savedWeapon #$lefthandid
               gosub STOWIT left
          }
     pause 0.0001
     if (($Time.isKatambaUp = 0) && ($Time.isXibarUp = 0) && ($Time.isYavashUp = 0)) then
          {
               echo *** NO MOONS ARE UP! DAMNIT! SKIPPING
               gosub SHARD_CHECK
               return
          }
     # put release slivers
     # pause 0.4
     pause 0.0001
     if ($Utility.Ranks < 100) then var MG.prep 15
     if (($Utility.Ranks > 100) && ($Utility.Ranks >= 200)) then var MG.prep 22
     if (($Utility.Ranks > 200) && ($Utility.Ranks >= 350)) then var MG.prep 28
     if (($Utility.Ranks > 350) && ($Utility.Ranks >= 500)) then var MG.prep 38
     if (($Utility.Ranks > 500) && ($Utility.Ranks >= 600)) then var MG.prep 47
     if (($Utility.Ranks > 600) && ($Utility.Ranks >= 700)) then var MG.prep 55
     if (($Utility.Ranks > 700) && ($Utility.Ranks >= 800)) then var MG.prep 62
     if ($Utility.Ranks >= 800) then var MG.prep 70
     pause 0.0001
     send prep moonblade %MG.prep
     pause 0.1
     if ($Time.isYavashUp) then var moon Yavash
     if ($Time.isXibarUp) then var moon Xibar
     if ($Time.isKatambaUp) then var moon Katamba
     pause 12
     if ($Time.isYavashUp) then var moon Yavash
     if ($Time.isXibarUp) then var moon Xibar
     if ($Time.isKatambaUp) then var moon Katamba
     pause 0.01
     send cast %moon
     wait
     pause 0.0001
     pause 0.0001
     pause 0.0001
     if ("$preparedspell" = "Moonblade") then
          {
               if ($Time.isKatambaUp) then var moon Katamba
               if ($Time.isXibarUp) then var moon Xibar
               if ($Time.isYavashUp) then var moon Yavash
               pause 0.0001
               send cast %moon
               pause 0.5
          }
     if ("$preparedspell" = "Moonblade") then
          {
               if ($Time.isYavashUp) then var moon Yavash
               if ($Time.isKatambaUp) then var moon Katamba
               if ($Time.isXibarUp) then var moon Xibar
               pause 0.0001
               send cast %moon
               pause 0.5
          }
     pause 0.0001
     put break my moonblade
     pause 0.1
     pause 0.001
     pause 0.0001
     gosub SHARD_CHECK
     if ("%savedWeapon" != "NULL") then
          {
               send get %savedWeapon
               pause 0.4
          }
     pause 0.0001
     #debug 0
     return

MOONIE_PREP:
     pause 0.0001
     echo
     echo #################
     echo *** MM PREP **
     echo *** Casting Shadows ***
     echo #################
     echo
     pause 0.0001
     pause 0.0001
     send prep shadows 25
     pause 18
     send cast
     pause 0.5
     pause 0.1
     pause 0.1
     echo *** Casting RF ***
     pause 0.5
     pause 0.0001
     pause 0.0001
     send prep RF 25
     pause 17
     pause 0.1
     send cast
     pause 0.5
     pause 0.0001
     pause 0.0001
     gosub SHARD_CHECK
     if matchre("%MM.Target.Spell", "(?i)(TKT|TKS)") && (%shardnumber < 50) then gosub MOONBLADE_PREP
     if matchre("%MM.Target.Spell(0)", "(?i)(TKT|TKS)") && (%shardnumber < 50) then gosub MOONBLADE_PREP
     if matchre("%MM.Target.Spell(1)", "(?i)(TKT|TKS)") && (%shardnumber < 50) then gosub MOONBLADE_PREP
     if matchre("%MM.Target.Spell(2)", "(?i)(TKT|TKS)") && (%shardnumber < 50) then gosub MOONBLADE_PREP
     return
OBSERVE_CHECK:
     var indoors 0
     var Predicting 0
     action (observe) on
     if (matchre("%Combat.Observe", "(?i)(OFF|NULL|0)") && (%InCombat = 1)) then return
     gosub OBSERVE_TIMER
     if (%observeLast < 180) then return
     if ((%Observe = 0) || ($Astrology.LearningRate > 32)) then return
     if ((%InCombat = 1) && (%indoor.check = 0)) then gosub INDOOR_CHECK
     if (%InCombat = 0) then gosub INDOOR_CHECK
     if (%indoors = 1) then
          {
               echo ###############
               echo *** We are indoors!
               echo *** Skipping Astrology
               echo ###############
               return
          }
     delay 0.0001
     gosub OBSERVE
     var observeTime $gametime
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     put predict state all
     pause 3
     pause 0.2
     echo * Pool.Magic %Pool.Magic
     echo * Pool.Lore %Pool.Lore
     echo * Pool.Offense %Pool.Offense
     echo * Pool.Defense %Pool.Defense
     echo * Pool.Survival %Pool.Survival
     pause 0.1
     if ((%Predictions = 1) || matchre("%Pool.Magic|%Pool.Lore|%Pool.Offense|%Pool.Defense|%Pool.Survival", "(?i)complete")) then
          {
               echo
               echo *** Pool Full - Predicting
               echo
               var Predictions 0
               var Predicting 1
               pause 0.1
               if ($invisible = 1) then gosub STOP_INVIS
               if matchre("%Pool.Magic", "(?i)complete") then
                    {
                         gosub ALIGN_MAGIC
                         if !matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT
                         if matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT_TOOL
                         goto OBSERVE_CHECK_2
                    }
               if matchre("%Pool.Lore", "(?i)complete") then
                    {
                         gosub ALIGN_LORE
                         if !matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT
                         if matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT_TOOL
                         goto OBSERVE_CHECK_2
                    }
               if matchre("%Pool.Survival", "(?i)complete") then
                    {
                         gosub ALIGN_SURVIVAL
                         if !matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT
                         if matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT_TOOL
                         goto OBSERVE_CHECK_2
                    }
               if matchre("%Pool.Offense", "(?i)complete") then
                    {
                         gosub ALIGN_OFFENSE
                         if !matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT
                         if matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT_TOOL
                         goto OBSERVE_CHECK_2
                    }
               if matchre("%Pool.Defense", "(?i)complete") then
                    {
                         gosub ALIGN_DEFENSE
                         if !matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT
                         if matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT_TOOL
                         goto OBSERVE_CHECK_2
                    }
          }
OBSERVE_CHECK_2:
     if (%Predicting = 1) then gosub PREDICT_ANALYZE
     if matchre("$righthand $lefthand", "(?i)telescope") then gosub STOWIT telescope
     if ($standing = 0) then gosub STAND
     return
OBSERVE:
     delay 0.0001
     action (retreat) on
     action (observe) on
     # put #plugin load TimeTracker.dll
     # if ($Astrology.LearningRate > 33) then return
     var observe.count 0
     var Predictions 0
     var object sun
     if (%Observe = 0) then goto OBS_RETURN
     if (%spellPrepped = 1) then gosub SPELL_CAST
     gosub PERCEIVE_TIMER
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then gosub SPELL_WAIT
     if (($spellCV = 0) && matchre("%abbrevs", "(?i)CV")) then gosub BUFF CV $Mana.CV
     if (($spellPG = 0) && matchre("%abbrevs", "(?i)PG")) then gosub BUFF PG $Mana.PG
     pause 0.0001
     if (($spellCV = 0) && matchre("%abbrevs", "(?i)CV")) then gosub CV
     if (($spellPG = 0) && matchre("%abbrevs", "(?i)PG")) then gosub PG
     if ($spellCV = 0) then return
     var predict1 ALIGN_OFFENSE
     var predict2 ALIGN_SURVIVAL
OBJECT_CHECK:
     if (%Observe = 0) then goto OBS_RETURN
     if (%observe.count > 5) then goto OBS_RETURN
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then gosub RETREAT
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     gosub PLANET_RESET
     var object sun
     pause 0.0001
     if (%spellPrepped = 1) then gosub SPELL_CAST
     action (observe) on
     pause 0.01
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     put observe sky
     wait
     pause 0.8
     pause 0.2
     pause 0.0001
     pause 0.0001
     echo *** KATAMBA UP = $Time.isKatambaUp
     echo *** XIBAR UP = $Time.isXibarUp
     echo *** YAVASH UP = $Time.isYavashUp
     if ((%observe.count = 0) && ($Time.isDay = 1)) then var object sun
     if ($Time.isKatambaUp = 1) then var object katamba
     if ($Time.isXibarUp = 1) then var object xibar
     if ($Time.isYavashUp = 1) then var object yavash
     if ((%observe.count <= 1) then
          {
               if (($Time.isDay = 0) && ($circle < 18)) then var object heart
               if (($Time.isDay = 0) && ($circle >= 18)) then var object magpie
               if (($circle > 1) && (%MM.Wolf = 1)) then var object wolf
               if (($circle > 15) && (%MM.Wolverine = 1)) then var object wolverine
               if (($circle > 21) && (%MM.Albatross = 1)) then var object albatross
               if (($circle > 22) && (%MM.Shark = 1)) then var object shark
               if (($circle > 24) && (%MM.Coyote = 1)) then var object coyote
               if (($circle > 25) && (%MM.Dove = 1)) then var object dove
               if (($circle > 38) && (%MM.Jackal = 1)) then var object jackal
               if (($circle > 39) && (%MM.Spider = 1)) then var object spider
               if (($circle > 48) && (%MM.Durgaulda = 1)) then var object durgaulda
               if (($circle > 49) && (%MM.Triquetra = 1)) then var object triquetra
               if (($circle > 84) && (%MM.Dawgolesh = 1)) then var object dawgolesh
          }
     # if (%InCombat = 1) then goto OBS_RETURN
     if (%observe.count = 2) then
          {
               if (($Time.isKatambaUp = 0) && ($Time.isXibarUp = 0) && ($Time.isYavashUp = 0)) then var object heart
               if (($circle > 3) && (%MM.Raven = 1)) then var object raven
               if (($circle > 10) && (%MM.Wren = 1)) then var object wren
               if (($circle > 11) && (%MM.Cat = 1)) then var object cat
               if (($circle > 12) && (%MM.Ram = 1)) then var object ram
               if (($circle > 13) && (%MM.Dolphin = 1)) then var object dolphin
               if (($circle > 19) && (%MM.KingSnake = 1)) then var object snake
               if (($circle > 20) && (%MM.Viper = 1)) then var object viper
               if (($circle > 33) && (%MM.Cow = 1)) then var object cow
               if (($circle > 44) && (%MM.Archer = 1)) then var object archer
               if (($circle > 45) && (%MM.Estrilda = 1)) then var object estrilda
               if (($circle > 54) && (%MM.Penhetia = 1)) then var object penhetia
               if (($circle > 59) && (%MM.Szeldia = 1)) then var object szeldia
          }
     if (%observe.count = 3) then
          {
               if (($Time.isKatambaUp = 0) && ($Time.isXibarUp = 0) && ($Time.isYavashUp = 0)) then var object magpie
               if (($circle > 2) && (%MM.Lion = 1)) then var object lion
               if (($circle > 8) && (%MM.Ox = 1)) then var object ox
               if (($circle > 9) && (%MM.Scorpion = 1)) then var object scorpion
               if (($circle > 23) && (%MM.Donkey = 1)) then var object donkey
               if (($circle > 26) && (%MM.Phoenix = 1)) then var object phoenix
               if (($circle > 29) && (%MM.Goshawk = 1)) then var object goshawk
               if (($circle > 35) && (%MM.Vulture = 1)) then var object vulture
               if (($circle > 49) && (%MM.Triquetra = 1)) then var object triquetra
               if (($circle > 4) && (%MM.Unicorn = 1)) then var object unicorn
               if (($circle > 5) && (%MM.Boar = 1)) then var object boar
          }
     if (%observe.count = 4) then
          {
               if (($Time.isKatambaUp = 0) && ($Time.isXibarUp = 0) && ($Time.isYavashUp = 0) && ($Time.isDay = 1)) then var object sun
               if (($circle > 1) && (%MM.Wolf = 1)) then var object wolf
               if (($circle > 2) && (%MM.Lion = 1)) then var object lion
               if (($circle > 3) && (%MM.Raven = 1)) then var object raven
               if (($circle > 12) && (%MM.Ram = 1)) then var object ram
               if (($circle > 14) && (%MM.Shardstar = 1)) then var object shardstar
               if (($circle > 14) && (%MM.Nightingale = 1)) then var object nightingale
               if (($circle > 27) && (%MM.Heron = 1)) then var object heron
               if (($circle > 34) && (%MM.Adder = 1)) then var object adder
               if (($circle > 46) && (%MM.Brigantine = 1)) then var object brigantine
               if (($circle > 51) && (%MM.Yoakena = 1)) then var object yoakena
          }
     if ((%observe.count = 5) then
          {
               if (($circle > 1) && (%MM.Wolf = 1)) then var object wolf
               if (($circle > 4) && (%MM.Unicorn = 1)) then var object unicorn
               if (($circle > 5) && (%MM.Boar = 1)) then var object boar
               if (($circle > 6) && (%MM.Panther = 1)) then var object panther
               if (($circle > 7) && (%MM.Cobra = 1)) then var object cobra
               if (($circle > 31) && (%MM.Welkin = 1)) then var object welkin
               if (($circle > 36) && (%MM.Shrew = 1)) then var object shrew
               if (($circle > 37) && (%MM.Shrike = 1)) then var object shrike
               if (($circle > 41) && (%MM.Hare = 1)) then var object hare
               if (($circle >= 43) && (%MM.Verena = 1)) then var object verena
          }
     if ((%observe.count = 6) then
          {
               if (($circle > 1) && (%MM.Wolf = 1)) then var object wolf
               if (($circle > 3) && (%MM.Raven = 1)) then var object raven
               if (($circle > 10) && (%MM.Wren = 1)) then var object wren
               if (($circle > 11) && (%MM.Cat = 1)) then var object cat
               if (($circle > 15) && (%MM.Wolverine = 1)) then var object wolverine
               if (($circle > 16) && (%MM.Centaur = 1)) then var object centaur
               if (($circle > 20) && (%MM.Viper = 1)) then var object viper
               if (($circle > 26) && (%MM.Phoenix = 1)) then var object phoenix
               if (($circle > 33) && (%MM.Cow = 1)) then var object cow
               if (($circle > 40) && (%MM.Giant = 1)) then var object giant
               if (($circle > 48) && (%MM.Durgaulda = 1)) then var object durgaulda
               if (($circle > 49) && (%MM.Triquetra = 1)) then var object triquetra
          }
     if ((%observe.count = 7) then
          {
               if (($circle > 12) && (%MM.Ram = 1)) then var object ram
               if (($circle > 21) && (%MM.Albatross = 1)) then var object albatross
               if (($circle > 22) && (%MM.Shark = 1)) then var object shark
               if (($circle > 23) && (%MM.Mongoose = 1)) then var object mongoose
               if (($circle > 32) && (%MM.Raccoon = 1)) then var object raccoon
               if (($circle > 39) && (%MM.Spider = 1)) then var object spider
               if (($circle > 42) && (%MM.Verena = 1)) then var object verena
               if (($circle > 43) && (%MM.Toad = 1)) then var object toad
               if (($circle > 59) && (%MM.Szeldia = 1)) then var object szeldia
               if (($circle > 69) && (%MM.Ismenia = 1)) then var object ismenia
               if (($circle > 74) && (%MM.Morleena = 1)) then var object morleena
          }
     if (("%object" = "sun") && ($Time.isDay = 0)) then var object heart
     pause 0.0001
     gosub OBJECT_ALIGN
OBJECT_CHECK_2:
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then gosub RETREAT
     pause 0.0001
     pause 0.0001
     matchre OBJECT_CHECK_2 ^You are a bit too distracted
     matchre OBJECT_CHECK ^\.\.\.wait|^Sorry\,|You see nothing regarding the future\.
     matchre GET_TELE is too faint for you to pick out with your naked eye\.
     matchre OBS_FULL ^Too many futures cloud your mind \- you learn nothing\.
     matchre OBS_RETURN you still learned from your observation
     matchre OBS_RETURN ^Although you were nearly overwhelmed by some aspects of your observation
     matchre OBS_RETURN ^Although you don't gain a complete view of the future
     matchre OBS_RETURN predict from your observation
     matchre OBS_RETURN ^You learned something useful from your observation\.
     matchre OBSERVE_CONT You see nothing
     matchre OBSERVE_CONT ^Your search for .* is foiled by the darkness\.
     matchre OBSERVE_CONT ^Your search for .* is foiled by the daylight\.
     matchre OBSERVE_CONT You are unable to make use
     matchre OBSERVE_CONT fruitless|no telescope|too close to the sun
     matchre OBSERVE_CONT ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?
     matchre OBSERVE_CONT ^You have not pondered
     matchre OBSERVE_CONT ^You learn nothing of the future
     matchre OBSERVE_INDOORS ^That\'s a bit hard to do while inside\.|^That\'s a bit hard to do here|cannot see the sky
     if contains("$lefthand" "$righthand" , "telescope") then var NeedTele 1
     if (%NeedTele = 1) then
          {
          if (%NoTele = 1) then
               {
                    echo **** You have no telescope!!! Skipping...
                    goto OBS_RETURN
               }
          else
               {
               action (tele.stow) off
               gosub RETREAT
               if (!%TeleOpen) then
                    {
                         send open my tele
                         pause 0.4
                         pause 0.0001
                    }
               var TeleOpen 1
               pause 0.0001
               pause 0.0001
               send center my tele on %object
               wait
               pause 0.1
               pause 0.0001
               pause 0.0001
               send peer my tele
               }
          }
     if (%NeedTele = 0) then send observe %object in sky
     matchwait 20
OBSERVE_RETURN:
     return
INDOOR_CHECK:
     pause 0.0001
     if (%InCombat = 1) then var indoor.check 1
     pause 0.0001
     matchre INDOOR_CHECK ^\.\.\.wait|^Sorry\,|^What were you
     matchre OBSERVE_INDOORS ^That\'s a bit hard to do|cannot see the sky|^You glance outside|^You are a bit too distracted
     matchre OBSERVE_OUTDOORS ^You glance up at the sky
     put weather
     matchwait 7
OBSERVE_INDOORS:
     pause 0.0001
     var indoors 1
     echo
     echo *** INDOORS!
     if ("$guild" != "Moon Mage") then return
     echo *** SKIPPING OBSERVATIONS FOR NOW
     echo
     pause 0.0001
     pause 0.0001
     put predict weather
     pause
     pause
     pause 0.0001
     pause 0.0001
     return
OBSERVE_OUTDOORS:
     pause 0.0001
     var indoors 0
     echo
     echo *** OUTDOORS!
     echo
     pause 0.0001
     return
OBSERVE_CONT:
     math observe.count add 1
     goto OBJECT_CHECK
OBS_FULL:
     var Predictions 1
OBS_RETURN:
     var Observe 0
     math observe.count add 1
     if matchre("$righthand $lefthand", "(?i)telescope") then
          {
               send close my tele
               pause 0.5
               send put tele in my %Telescope.Container
               wait
               pause 0.0001
               pause 0.0001
               var NeedTele 0
               var TeleOpen 0
          }
     pause 0.0001
     action (retreat) off
     if matchre("$righthand $lefthand", "(?i)telescope") then gosub STOWIT telescope
     action remove ^Yavash is below the horizon\.
     action remove ^Katamba is below the horizon\.
     action remove ^Xibar is below the horizon\.
     return
GET_TELE:
     var NeedTele 1
     if (%NoTele = 0) then
          {
               pause 0.0001
               var TeleOpen 0
               if !matchre("$righthand", "Empty") then gosub STOWIT $righthand
               gosub OPEN %Telescope.Container
               pause 0.0001
               pause 0.0001
               action (tele.stow) on
               action (tele.stow) var telestow $1 when from inside your (\S+|\S+\s+\w+)\.
               pause 0.0001
               pause 0.0001
               match OBJECT_CHECK telescope
               match MISSINGTELE ^What were you referring
               send get my telescope
               matchwait 20
          }
     if (%NoTele = 1) then return
MISSINGTELE:
     var NoTele 1
     math observe.count add 1
     goto OBJECT_CHECK
OBJECT_ALIGN:
     var predict1 ALIGN_SURVIVAL
     var predict2 ALIGN_SURVIVAL
     if matchre("%Pool.Magic", "(?i)(complete|powerful)") then
          {
               var predict1 ALIGN_MAGIC
               var predict2 ALIGN_MAGIC
               return
          }
     if matchre("%Pool.Defense", "(?i)(complete|powerful)") then
          {
               var predict1 ALIGN_DEFENSE
               var predict2 ALIGN_DEFENSE
               return
          }
     if matchre("%Pool.Offense", "(?i)(complete|powerful)") then
          {
               var predict1 ALIGN_OFFENSE
               var predict2 ALIGN_OFFENSE
               return
          }
     if matchre("%Pool.Lore", "(?i)(complete|powerful)") then
          {
               var predict1 ALIGN_LORE
               var predict2 ALIGN_LORE
               return
          }
     if matchre("%Pool.Survival", "(?i)(complete|powerful)") then
          {
               var predict1 ALIGN_SURVIVAL
               var predict2 ALIGN_SURVIVAL
               return
          }
     return
#### OLD METHOD
     # if matchre("%object", "(?i)(sun|panther|wolverine|szeldia|erqutra|boar|shark|archer|triquetra)") then
          # {
          # var predict1 ALIGN_SURVIVAL
          # var predict2 ALIGN_OFFENSE
          # return
          # }
     # if matchre("%object", "\b(?i)(heart|yoakena|ram|unicorn)\b") then
          # {
          # var predict1 ALIGN_SURVIVAL
          # var predict2 ALIGN_SURVIVAL
          # return
          # }
     # if matchre("%object", "\b(?i)(magpie|dawgolesh|jackal|nightingale|dove)\b") then
          # {
          # var predict1 ALIGN_DEFENSE
          # var predict2 ALIGN_MAGIC
          # return
          # }
     # if matchre("%object", "\b(?i)(katamba|vulture|lion|goshawk|raccoon|morleena)\b") then
          # {
          # var predict1 ALIGN_DEFENSE
          # var predict2 ALIGN_SURVIVAL
          # return
          # }
     # if matchre("%object", "\b(?i)(yavash|durgaulda|toad|wolf)\b") then
          # {
          # var predict1 ALIGN_MAGIC
          # var predict2 ALIGN_MAGIC
          # return
          # }
     # if matchre("%object", "\b(?i)(coyote|owl|adder|shrew)\b") then
          # {
          # var predict1 ALIGN_MAGIC
          # var predict2 ALIGN_OFFENSE
          # return
          # }
     # if matchre("%object", "\b(?i)(ox|shrike|cow|scales|durgaulda)\b") then
          # {
          # var predict1 ALIGN_MAGIC
          # var predict2 ALIGN_SURVIVAL
          # return
          # }
     # if matchre("%object", "\b(?i)(dolphin|heron|brigantine)") then
          # {
          # var predict1 ALIGN_LORE
          # var predict2 ALIGN_SURVIVAL
          # return
          # }
     # if matchre("%object", "\b(?i)(cobra|wren|ismenia|donkey|phoenix|amlothi)") then
          # {
          # var predict1 ALIGN_LORE
          # var predict2 ALIGN_MAGIC
          # return
          # }
     # if matchre("%object", "\b(?i)(shardstar|snake|king snake|albatross|welkin|hare)") then
          # {
          # var predict1 ALIGN_LORE
          # var predict2 ALIGN_DEFENSE
          # return
          # }
     # if matchre("%object", "\b(?i)(weasel)") then
          # {
          # var predict1 ALIGN_LORE
          # var predict2 ALIGN_OFFENSE
          # }
     # if matchre("%object", "\b(?i)(xibar|verena|raven)") then
          # {
          # var predict1 ALIGN_LORE
          # var predict2 ALIGN_LORE
          # return
          # }
     # if matchre("%object", "\b(?i)(unicorn|ram|yoakena)") then
          # {
          # var predict1 ALIGN_SURVIVAL
          # var predict2 ALIGN_SURVIVAL
          # return
          # }
     # if matchre("%object", "\b(?i)(scorpion|centaur|mongoose|merewalda)") then
          # {
          # var predict1 ALIGN_DEFENSE
          # var predict2 ALIGN_OFFENSE
          # return
          # }
     # if matchre("%object", "\b(?i)(cat|estrilda|viper|spider)") then
          # {
          # var predict1 ALIGN_OFFENSE
          # var predict2 ALIGN_OFFENSE
          # return
          # }
     # if matchre("%object", "\b(?i)(giant|penhetia)") then
          # {
          # var predict1 ALIGN_DEFENSE
          # var predict2 ALIGN_DEFENSE
          # return
          # }
     # var predict1 ALIGN_SURVIVAL
     # var predict2 ALIGN_DEFENSE
     return
PG:
     var CurrentSpell PG
     delay 0.0001
     if (%Research.Active = 1) then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     gosub PREPARE PG 15
     gosub SPELL_WAIT
     return
CV:
     var CurrentSpell CV
     delay 0.0001
     if (%Research.Active = 1) then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     gosub PREPARE CV 15
     gosub SPELL_WAIT
     return
#### PREDICT STUFF
ALIGN_SURVIVAL:
     delay 0.0001
     pause 0.0001
     matchre ALIGN_SURVIVAL ^\.\.\.wait|^Sorry\,
     matchre RETURN You focus your thoughts|You focus internally|align yourself
     matchre RETURN You look inside yourself
     matchre RETURN You become distracted and forget what you were thinking about\.
     send align survival
     matchwait 7
     return
ALIGN_OFFENSE:
     delay 0.0001
     pause 0.0001
     matchre ALIGN_OFFENSE ^\.\.\.wait|^Sorry\,
     matchre RETURN You focus your thoughts|You focus internally|align yourself
     matchre RETURN You look inside yourself
     matchre RETURN You become distracted and forget what you were thinking about\.
     send align offense
     matchwait 7
     return
ALIGN_DEFENSE:
     delay 0.0001
     pause 0.0001
     matchre ALIGN_DEFENSE ^\.\.\.wait|^Sorry\,
     matchre RETURN You focus your thoughts|You focus internally|align yourself
     matchre RETURN You look inside yourself
     matchre RETURN You become distracted and forget what you were thinking about\.
     send align defense
     matchwait 7
     return
ALIGN_MAGIC:
     delay 0.0001
     pause 0.1
     matchre ALIGN_MAGIC ^\.\.\.wait|^Sorry\,
     matchre RETURN You focus your thoughts|You focus internally|align yourself
     matchre RETURN You look inside yourself
     matchre RETURN You become distracted and forget what you were thinking about\.
     send align magic
     matchwait 7
     return
ALIGN_LORE:
     delay 0.0001
     pause 0.0001
     matchre ALIGN_LORE ^\.\.\.wait|^Sorry\,
     matchre RETURN You focus your thoughts|You focus internally|align yourself
     matchre RETURN You look inside yourself
     matchre RETURN You become distracted and forget what you were thinking about\.
     send align lore
     matchwait 7
     return
PREDICT:
     pause 0.0001
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     matchre PREDICT ^\.\.\.wait|^Sorry\,
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?
     matchre RETURN A sudden feeling|You look inside|You realize you have not yet properly aligned yourself
     matchre RETURN would risk revealing you\.
     matchre RETURN ^You are far too occupied
     send predict future
     matchwait 20
     return
PREDICT_ANALYZE:
     if ($Astrology.LearningRate > 32) then return
     pause 0.0001
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     matchre PREDICT_ANALYZE ^\.\.\.wait|^Sorry\,
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?
     matchre RETURN You close your eyes\, mentally seeking the threads of fate\.
     matchre RETURN You become distracted and forget what you were thinking about\.
     matchre RETURN ^You are far too occupied
     send predict analyze
     matchwait 20
     return
PREDICT_TOOL:
     if matchre("%Predict.Tool", "(?i)PRISM") then goto PREDICT_PRISM
     if matchre("%Predict.Tool", "(?i)CHART") then goto PREDICT_CHART
     if matchre("%Predict.Tool", "(?i)BONE") then goto PREDICT_BONES
     if matchre("%Predict.Tool", "(?i)MIRROR") then goto PREDICT_MIRROR
     if matchre("%Predict.Tool", "(?i)DECK") then goto PREDICT_DECK
     if matchre("%Predict.Tool", "(?i)BOWL") then goto PREDICT_BOWL
     return
PREDICT_DECK:
     var Cards 0
     pause 0.0001
     gosub stowing
     if ($invisible = 1) then gosub STOP_INVIS
     gosub GET my deck
     pause 0.0001
     if !matchre("$righthand $lefthand", "(?i)deck") then gosub PUT remove my deck
     pause 0.0001
     gosub PUT shuffle deck
     pause 0.0001
     gosub PUT cut deck
     pause 0.0001
     gosub %predict1
     pause 0.0001
DECK_RETREAT:
     action var Cards 1 when ^You collect the cards
     gosub RETREAT
     random 3 6
     matchre DECK_RETREAT ^You're too distracted to do that\!
     send deal deck %r
     matchwait 2
     pause 3
     if (%Cards = 1) then goto DECK_DONE
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if (%Cards = 1) then goto DECK_DONE
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if (%Cards = 1) then goto DECK_DONE
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if (%Cards = 1) then goto DECK_DONE
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if (%Cards = 1) then goto DECK_DONE
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if (%Cards = 1) then goto DECK_DONE
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if (%Cards = 1) then goto DECK_DONE
     if ($monstercount > 0) then gosub RETREAT
DECK_DONE:
     action remove ^You collect the cards
     gosub stowing
     return
PREDICT_PRISM:
     pause 0.0001
     pause 0.0001
     gosub stowing
     gosub GET my prism
     pause 0.0001
     if !matchre("$righthand $lefthand", "(?i)prism") then gosub PUT remove my prism
     pause 0.2
     pause 0.0001
     gosub %predict1
     pause 0.2
     pause 0.1
PRISM_RETREAT:
     gosub RETREAT
     matchre PRISM_RETREAT ^You're too distracted to do that\!
     send raise my prism
     matchwait 2
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 2
     if ($monstercount > 0) then gosub RETREAT
     send wear my prism
     pause 0.2
     gosub stowing
     return
PREDICT_MIRROR:
     gosub stowing
     gosub GET my mirror
     pause 0.0001
     if !matchre("$righthand $lefthand", "(?i)mirror") then gosub PUT remove my mirror
     pause 0.2
     pause 0.1
     gosub %predict1
     pause 0.2
     pause 0.1
MIRROR_RETREAT:
     gosub RETREAT
     matchre MIRROR_RETREAT ^You're too distracted to do that\!
     send gaze my mirror
     matchwait 2
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 2
     if ($monstercount > 0) then gosub RETREAT
     gosub stowing
     return
PREDICT_CHART:
     gosub stowing
     gosub GET my vellum chart
     pause 0.0001
     if !matchre("$righthand $lefthand", "(?i)chart") then gosub GET my celestial chart
     pause 0.3
     pause 0.1
     gosub %predict1
     pause 0.2
     pause 0.1
CHART_RETREAT:
     gosub RETREAT
     matchre CHART_RETREAT ^You're too distracted to do that\!
     send review my chart
     matchwait 2
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 2
     if ($monstercount > 0) then gosub RETREAT
     gosub stowing
     return
PREDICT_BOWL:
     gosub stowing
     gosub GET my sandstone bowl
     pause 0.0001
     if !matchre("$righthand $lefthand", "(?i)bowl") then gosub GET my bowl
     gosub %predict1
     pause 0.2
     pause 0.1
BOWL_RETREAT:
     gosub RETREAT
     matchre BOWL_RETREAT ^You're too distracted to do that\!
     send gaze my bowl
     matchwait 2
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 2
     if ($monstercount > 0) then gosub RETREAT
     gosub stowing
     return
PREDICT_BONES:
     gosub stowing
     gosub GET my bones
     pause 0.0001
     if !matchre("$righthand $lefthand", "(?i)bones") then gosub GET my bones
     gosub get my bones
     gosub %predict1
     pause 0.2
BONES_RETREAT:
     gosub RETREAT
     send kneel
     pause 0.2
     matchre BONES_RETREAT ^You're too distracted to do that\!
     send roll bone at $charactername
     matchwait 2
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 3
     if ($monstercount > 0) then gosub RETREAT
     pause 2
     if ($monstercount > 0) then gosub RETREAT
     gosub stand
     gosub stowing
     return
SLS_SET:
     var SLS spider
     if ($Time.isDay) then
          {
               echo ###################
               echo * DAY TIME! Skipping SLS
               echo ###################
               var SLS NULL
               return
          }
     if ((!$Time.isXibarUp) && (!$Time.isKatambaUp) && (!$Time.isYavashUp)) then var SLS heart
     if (%MM.Heart = 1) then var SLS heart
     if (%MM.Toad = 1) then var SLS toad
     if (%MM.Wolf = 1) then var SLS wolf
     if (%MM.Cat = 1) then var SLS cat
     if (%MM.Cow = 1) then var SLS cow
     if (%MM.Ram = 1) then var SLS ram
     if (%MM.Raven = 1) then var SLS raven
     if (%MM.Hare = 1) then var SLS hare
     if (%MM.Lion = 1) then var SLS lion
     if (%MM.Dolphin = 1) then var SLS dolphin
     if (%MM.Unicorn = 1) then var SLS unicorn
     if (%MM.Cobra = 1) then var SLS cobra
     if (%MM.Spider = 1) then var SLS spider
     return
#####################################################
### CLERIC SUBS - CLERIC GOSUBS
#####################################################
####################################################################
#### CLERIC SUBS
####################################################################
CLERIC_VARS:
     ## SET ALL DEFAULT CLERIC VARS HERE
     var OM.Active 0
     var OMBuffshort
     var OMBuff
     var OrbFull 0
     var PrayTime 300
     var OM.Mana 20
     var FavorOrb meraud
     var ClericRituals ON
     var HolyWater chalice
     var Lighter OFF
     var Lighter.Name NULL
     var Commune.Meraud ON
     var Commune.Truffenyi ON
     var Commune.Tamsine ON
     var Lighter OFF
     var BathFull NO
     var BathTime 0
     var CommuneCount 0
     var DanceComplete NO
     var Anloral NULL
     var HaveAnloral 0
     var HaveChamomile 0
     var HaveIncense 0
     var HaveLavender 0
     var HaveSage 0
     var HaveWine 0
     var HaveFlint 0
     var HerbsUsed 0
     var HaveTorch 0
     var HaveSkates 0
     var Winter NO
     var tamsine 0
     var eluned 0
     var kertigen 0
     var hodierna 0
     var meraud 0
     var glythtide 0
     var truffenyi 0
     var devotion 0
     var infusion 1
     var OrbFull 0
     var prayloop 0
     var SOLcheck 0
     var blessloop 0
     var Commune.Meraud OFF
     var Commune.Truffenyi OFF
     var Commune.Tamsine OFF
     var CommuneTruffenyiTime $gametime
     var CommuneTamsineTime $gametime
     var CommuneCheckTime $gametime
     var PrayTime $gametime
     var PrayBadgeTime $gametime
     if !def(UC_Align.Time) then put #tvar UC_Align.Time $gametime
     if !def(UC_Align.Last) then put #var UC_Align.Last 21600
     return
CLERIC_STRIP:
     unvar MM.Cyclics
     unvar MM.Cyclics.mana
     unvar MM.Buffs
     unvar MM.Augmentation.Spell
     unvar MM.Debilitation.Spell
     unvar MM.Target.Spell
     unvar MM.Utility.Spell
     unvar MM.Warding.Spell
     unvar MM.Sorcery.Spell
     unvar WM.Cyclics
     unvar WM.Cyclics.mana
     unvar WM.Buffs
     unvar WM.Augmentation.Spell
     unvar WM.Debilitation.Spell
     unvar WM.Target.Spell
     unvar WM.Utility.Spell
     unvar WM.Warding.Spell
     unvar WM.Sorcery.Spell
     unvar Empath.Cyclics
     unvar Empath.Cyclics.mana
     unvar Empath.Buffs
     unvar Empath.Augmentation.Spell
     unvar Empath.Debilitation.Spell
     unvar Empath.Target.Spell
     unvar Empath.Utility.Spell
     unvar Empath.Warding.Spell
     unvar Empath.Sorcery.Spell
     unvar Bard.Cyclics
     unvar Bard.Cyclics.mana
     unvar Bard.Buffs
     unvar Bard.Augmentation.Spell
     unvar Bard.Debilitation.Spell
     unvar Bard.Target.Spell
     unvar Bard.Utility.Spell
     unvar Bard.Warding.Spell
     unvar Bard.Sorcery.Spell
     unvar Paladin.Cyclics
     unvar Paladin.Cyclics.mana
     unvar Paladin.Buffs
     unvar Paladin.Augmentation.Spell
     unvar Paladin.Debilitation.Spell
     unvar Paladin.Target.Spell
     unvar Paladin.Utility.Spell
     unvar Paladin.Warding.Spell
     unvar Paladin.Sorcery.Spell
     unvar Necro.Cyclics
     unvar Necro.Cyclics.mana
     unvar Necro.Buffs
     unvar Necro.Augmentation.Spell
     unvar Necro.Debilitation.Spell
     unvar Necro.Target.Spell
     unvar Necro.Utility.Spell
     unvar Necro.Warding.Spell
     unvar Necro.Sorcery.Spell
     unvar Ranger.Cyclics
     unvar Ranger.Cyclics.mana
     unvar Ranger.Buffs
     unvar Ranger.Augmentation.Spell
     unvar Ranger.Debilitation.Spell
     unvar Ranger.Target.Spell
     unvar Ranger.Utility.Spell
     unvar Ranger.Warding.Spell
     unvar Ranger.Sorcery.Spell
     unvar Trader.Cyclics
     unvar Trader.Cyclics.mana
     unvar Trader.Buffs
     unvar Trader.Augmentation.Spell
     unvar Trader.Debilitation.Spell
     unvar Trader.Target.Spell
     unvar Trader.Utility.Spell
     unvar Trader.Warding.Spell
     unvar Trader.Sorcery.Spell
     unvar CFB.Mana
     unvar QE.Mana
     return

DEVOTION_CHECK:
SOUL_CHECK:
     pause 0.001
     echo
     echo #####################
     echo ** CHECKING CLERIC SOUL STATE
     echo #####################
     echo
     pause 0.1
     matchre SOUL_GOOD distinct you see a vision of your god|leaving the feeling that your efforts have been acknowledged\.|you see a crystal-clear vision of your god|you feel a clear presence like a warm blanket|radiating forth with a powerful divine brilliance|god who calls to you by name
     matchre SOUL_GOOD distinct link between you and your god|your god is aware of your devotion|your god knows your name|your god is pleased with your devotion|though the visage is cloudy and impossible to make out clearly
     matchre SOUL_BAD ^You feel unclean and unworthy\.|You call out to your god, but there is no answer\.|you sense that your god is barely aware of you\.|you sense that your efforts have not gone unnoticed
     put commune
     matchwait 10
SOUL_GOOD:
     echo
     echo ###################
     echo ** SOUL STATE OK FOR NOW!
     echo ###################
     echo
     pause 0.1
     return
SOUL_BAD:
     echo
     echo ##############
     echo ** SOUL STATE BAD!!
     echo ##############
     echo
     pause 0.3
     goto UNCLEAN_SOUL
UNCLEAN_SOUL:
     pause 0.001
     put #echo >Log #FF8E06 ** CLERIC SOUL IS TOO UNCLEAN TO CAST!!
     put #echo >Log #FF8E06 ** MOVING TO DO CLERIC RITUALS!
     echo
     echo ##########################
     echo *** SOUL IS TOO UNCLEAN TO CAST!!
     echo *** MOVING TO CLERIC RITUALS!
     echo ##########################
     echo
     pause 0.5
     #### ESCAPE TO NEAREST CITY
     var GOSUBBING ON
     var escaping ON
     gosub ESCAPE_NOW
     var GOSUBBING OFF
     #### DONE ESCAPING TO CITY
     goto CLERICRIT
PRAY:
     pause 0.0001
     put pray %FAVOR.GOD
     pause
     pause 0.0001
     pause 0.0001
     if ($standing = 0) then gosub STAND
     return

COMMUNE_CHECK:
     pause 0.0001
     gosub COMMUNE_TIMER
     if ($spelltime > 18) then gosub SPELL_CAST
     pause 0.0001
     if ($UC_Commune.Meraud = 1) then
          {
               if (($UC_meraud = 0) && (%devotion > 6)) then
                    {
                         gosub COMMUNE_meraud
                         goto COMMUNE_END
                    }
          }
     pause 0.0001
     if (($UC_Commune.Truffenyi = 1) && (%devotion > 9)) then
          {
               gosub TRUFFENYI_TIMER
               if ((($Theurgy.Ranks > 500) && (%CommuneTruffenyiLast > 350)) || (($Theurgy.Ranks < 450) && ($Theurgy.Ranks > 220) && (%CommuneTruffenyiLast > 1000)) || (($Theurgy.Ranks < 220) && (%CommuneTruffenyiLast > 1800))) then
                    {
                         put #var UC_truffenyi 0
                         gosub COMMUNE_truffenyi
                         var CommuneTruffenyiTime $gametime
                         goto COMMUNE_END
                    }
          }
     pause 0.0001
     if ($UC_Commune.Tamsine = 1) then
          {
               gosub TRUFFENYI_TIMER
               if ((%devotion > 9) && (%CommuneTamsineLast > 350)) then
                    {
                         gosub COMMUNE_tamsine
                         var CommuneTamsineTime $gametime
                    }
          }
     gosub ALIGN_CHECK
COMMUNE_END:
return
#####################################################
### PALADIN SUBS - PALADIN GOSUBS
#####################################################
PALADIN_VARS:
     var HolyWeapon NULL
     var HolyIcon NULL
     var Resonance.Check 0
     var Smite 0
     var PrayBadgeTime $gametime
     var GlyphTime $gametime
     return
PALADIN_STRIP:
     unvar MM.Cyclics
     unvar MM.Cyclics.mana
     unvar MM.Buffs
     unvar MM.Augmentation.Spell
     unvar MM.Debilitation.Spell
     unvar MM.Target.Spell
     unvar MM.Utility.Spell
     unvar MM.Warding.Spell
     unvar MM.Sorcery.Spell
     unvar WM.Cyclics
     unvar WM.Cyclics.mana
     unvar WM.Buffs
     unvar WM.Augmentation.Spell
     unvar WM.Debilitation.Spell
     unvar WM.Target.Spell
     unvar WM.Utility.Spell
     unvar WM.Warding.Spell
     unvar WM.Sorcery.Spell
     unvar Empath.Cyclics
     unvar Empath.Cyclics.mana
     unvar Empath.Buffs
     unvar Empath.Augmentation.Spell
     unvar Empath.Debilitation.Spell
     unvar Empath.Target.Spell
     unvar Empath.Utility.Spell
     unvar Empath.Warding.Spell
     unvar Empath.Sorcery.Spell
     unvar Bard.Cyclics
     unvar Bard.Cyclics.mana
     unvar Bard.Buffs
     unvar Bard.Augmentation.Spell
     unvar Bard.Debilitation.Spell
     unvar Bard.Target.Spell
     unvar Bard.Utility.Spell
     unvar Bard.Warding.Spell
     unvar Bard.Sorcery.Spell
     unvar Bard.Cyclics
     unvar Cleric.Cyclics
     unvar Cleric.Cyclics.mana
     unvar Cleric.Buffs
     unvar Cleric.Augmentation.Spell
     unvar Cleric.Debilitation.Spell
     unvar Cleric.Target.Spell
     unvar Cleric.Utility.Spell
     unvar Cleric.Warding.Spell
     unvar Cleric.Sorcery.Spell
     unvar Necro.Cyclics
     unvar Necro.Cyclics.mana
     unvar Necro.Buffs
     unvar Necro.Augmentation.Spell
     unvar Necro.Debilitation.Spell
     unvar Necro.Target.Spell
     unvar Necro.Utility.Spell
     unvar Necro.Warding.Spell
     unvar Necro.Sorcery.Spell
     unvar Ranger.Cyclics
     unvar Ranger.Cyclics.mana
     unvar Ranger.Buffs
     unvar Ranger.Augmentation.Spell
     unvar Ranger.Debilitation.Spell
     unvar Ranger.Target.Spell
     unvar Ranger.Utility.Spell
     unvar Ranger.Warding.Spell
     unvar Ranger.Sorcery.Spell
     unvar Trader.Cyclics
     unvar Trader.Cyclics.mana
     unvar Trader.Buffs
     unvar Trader.Augmentation.Spell
     unvar Trader.Debilitation.Spell
     unvar Trader.Target.Spell
     unvar Trader.Utility.Spell
     unvar Trader.Warding.Spell
     unvar Trader.Sorcery.Spell
     unvar CFB.Mana
     unvar QE.Mana
     return
SMITE_CHECK:
     var Smite 0
     pause 0.0001
     action var Smite 1 when ^Your conviction is enough to deliver (one|two|three|four|five|six|seven|eight|nine|ten|eleven|twelve|thirteen) blows? against your enemies
     matchre SMITE_OK (one|two|three|four|five|six|seven|eight|nine|ten|eleven|twelve|thirteen) blows?
     matchre SMITE_NO ^Your conviction is shaken and spent
     send smite check
     matchwait 4
SMITE_NO:
     echo ** Turning Smite Off
     put #var UC_Smite 0
     action remove ^Your conviction is enough to deliver (one|two|three|four|five|six|seven|eight|nine|ten|eleven|twelve|thirteen) blows? against your enemies
     return
SMITE_OK:
     put #var UC_Smite 1
     action remove ^Your conviction is enough to deliver (one|two|three|four|five|six|seven|eight|nine|ten|eleven|twelve|thirteen) blows? against your enemies
     return
RUE_PREP:
     pause 0.0001
     gosub stowing
     if !matchre("%SBWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var RUE.WEAPON %SBWEAPON
     if !matchre("%LBWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var RUE.WEAPON %LBWEAPON
     if !matchre("%THBWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var RUE.WEAPON %THBWEAPON
     if !matchre("%STAVES", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var RUE.WEAPON %STAVES
     if !matchre("%POLEARMS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var RUE.WEAPON %POLEARMS
     if !matchre("%LTWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var RUE.WEAPON %LTWEAPON
     if !matchre("%HTWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var RUE.WEAPON %HTWEAPON
     if !matchre("%LEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var RUE.WEAPON %LEWEAPON
     if !matchre("%THEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var RUE.WEAPON %THEWEAPON
     if !matchre("%SEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var RUE.WEAPON %SEWEAPON
     if ("%WEAPON" = "NULL") then var WEAPON %RUE.WEAPON
     return
GLYPH_MANA:
     pause 0.0001
     pause 0.0001
     send glyph mana
     pause 0.5
     pause 0.0001
     pause 0.0001
     return
HOLY_WEAPON:
     var cleanloop 0
     pause 0.0001
     if matchre("%HolyWeapon", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto HOLY_WEAPON_ERROR
     if matchre("%HolyIcon", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto HOLY_WEAPON_ERROR
     echo #####################
     echo ** PALADIN HOLY WEAPON RECHARGE
     echo ** USING HOLY ICON!
     echo #####################
     gosub stowing
     pause 0.0001
     gosub GET my %HolyWeapon
     pause 0.2
     pause 0.1
     if !matchre("$righthand $lefthand", "(?i)%HolyWeapon") then gosub PUT untie my %HolyWeapon
     pause 0.2
     pause 0.1
     pause 0.0001
     if !matchre("$righthand $lefthand", "(?i)%HolyWeapon") then goto HOLY_WEAPON_ERROR
     # gosub stowing
     # pause 0.4
     gosub GET my %HolyIcon
     pause 0.0001
     pause 0.0001
     put rub my %HolyIcon
     wait
     pause 0.5
     gosub CLEAN_ICON
     pause 0.3
     gosub PUT hug my %HolyIcon
     pause 0.5
     gosub PUT focus my %HolyIcon
     pause 0.5
     pause 0.5
     gosub PUT pray my %HolyIcon
     pause 0.5
     pause 0.5
     gosub GET my %HolyWeapon
     pause 0.5
     pause 0.4
     if matchre("$lefthand", "(?i)%HolyWeapon") then gosub SWAP
     pause 0.2
     put GLYPH RENEW %HolyWeapon
     wait
     pause 0.5
     pause 0.5
     gosub STAND
     gosub SHEATH_CHECK
     gosub stowing
     return
CLEAN_ICON:
     math cleanloop add 1
     pause 0.1
     pause 0.1
     pause 0.2
     if (%cleanloop > 3) then goto HOLY_WEAPON_RETURN
     matchre RETURN ^You inspect your .+ clean and polished
     matchre CLEAN_ICON ^You carefully|^You turn
     matchre CLEAN_ICON ^\.\.\.wait|^Sorry\,
     send clean my %HolyIcon
     matchwait 5
     goto CLEAN_ICON
HOLY_WEAPON_ERROR:
     echo ############################
     echo ** HOLY WEAPON/ICON NOT FOUND OR SET
     echo ** Check your HolyWeapon/HolyIcon variables!
     echo ############################
HOLY_WEAPON_RETURN:
     unvar cleanloop
     return
###############################################################
### WARRIOR MAGE gosubs - WM SUBS - WM gosubs
##############################################################
WM_VARS:
     ##### ALL WM BASE VARIABLES
     var SummonedWeapon 0
     var SummonWeapons OFF
     var TargetLoops 0
     var DebTargetLoop 0
     var SorceryLoops 0
     var SorcerySpecial 0
     var WM.Weapon NULL
     var WMIngot OFF
     var SummonHT OFF
     var SummonLT OFF
     var SummonSE OFF
     var SummonLE OFF
     var SummonTHE OFF
     var SummonSB OFF
     var SummonLB OFF
     var SummonTHB OFF
     var SummonPolearms OFF
     var SummonStaves OFF
     var ExpansiveInfusions 0
     var QuickInfusions 0
     var ReinforcedInfusions 0
     var ShockingInfusions 0
     var FieryInfusions 0
     var IcyInfusions 0
     var pathsensetime 0
     var SummonTime $gametime
     var pathsensetime $gametime
     return
WM_STRIP:
     unvar MM.Cyclics
     unvar MM.Cyclics.mana
     unvar MM.Buffs
     unvar MM.Augmentation.Spell
     unvar MM.Debilitation.Spell
     unvar MM.Target.Spell
     unvar MM.Utility.Spell
     unvar MM.Warding.Spell
     unvar MM.Sorcery.Spell
     unvar Paladin.Cyclics
     unvar Paladin.Cyclics.mana
     unvar Paladin.Buffs
     unvar Paladin.Augmentation.Spell
     unvar Paladin.Debilitation.Spell
     unvar Paladin.Target.Spell
     unvar Paladin.Utility.Spell
     unvar Paladin.Warding.Spell
     unvar Paladin.Sorcery.Spell
     unvar Empath.Cyclics
     unvar Empath.Cyclics.mana
     unvar Empath.Buffs
     unvar Empath.Augmentation.Spell
     unvar Empath.Debilitation.Spell
     unvar Empath.Target.Spell
     unvar Empath.Utility.Spell
     unvar Empath.Warding.Spell
     unvar Empath.Sorcery.Spell
     unvar Bard.Cyclics
     unvar Bard.Cyclics.mana
     unvar Bard.Buffs
     unvar Bard.Augmentation.Spell
     unvar Bard.Debilitation.Spell
     unvar Bard.Target.Spell
     unvar Bard.Utility.Spell
     unvar Bard.Warding.Spell
     unvar Bard.Sorcery.Spell
     unvar Bard.Cyclics
     unvar Cleric.Cyclics
     unvar Cleric.Cyclics.mana
     unvar Cleric.Buffs
     unvar Cleric.Augmentation.Spell
     unvar Cleric.Debilitation.Spell
     unvar Cleric.Target.Spell
     unvar Cleric.Utility.Spell
     unvar Cleric.Warding.Spell
     unvar Cleric.Sorcery.Spell
     unvar Necro.Cyclics
     unvar Necro.Cyclics.mana
     unvar Necro.Buffs
     unvar Necro.Augmentation.Spell
     unvar Necro.Debilitation.Spell
     unvar Necro.Target.Spell
     unvar Necro.Utility.Spell
     unvar Necro.Warding.Spell
     unvar Necro.Sorcery.Spell
     unvar Ranger.Cyclics
     unvar Ranger.Cyclics.mana
     unvar Ranger.Buffs
     unvar Ranger.Augmentation.Spell
     unvar Ranger.Debilitation.Spell
     unvar Ranger.Target.Spell
     unvar Ranger.Utility.Spell
     unvar Ranger.Warding.Spell
     unvar Ranger.Sorcery.Spell
     unvar Trader.Cyclics
     unvar Trader.Cyclics.mana
     unvar Trader.Buffs
     unvar Trader.Augmentation.Spell
     unvar Trader.Debilitation.Spell
     unvar Trader.Target.Spell
     unvar Trader.Utility.Spell
     unvar Trader.Warding.Spell
     unvar Trader.Sorcery.Spell
     unvar CFB.Mana
     unvar QE.Mana
     return
NON_WM_STRIP:
NOT_WM_STRIP:
     # unvar SummonElement
     # unvar SummonHT
     # unvar Summoning
     # unvar SummonLB
     # unvar SummonLE
     # unvar SummonLT
     # unvar SummonPolearms
     # unvar SummonSB
     # unvar SummonSE
     # unvar SummonStaves
     # unvar SummonTemplate
     # unvar SummonTHB
     # unvar SummonTHE
     # unvar SummonWeapons
     # unvar SummonWeight
     return
SUMMON_CHECK:
     var summonloop 0
     if ($UC_Summoning = 0) then return
     if ($Summoning.LearningRate > 32) then return
     if (%spellPrepped = 1) then gosub SPELL_CAST
     echo #####################
     echo * Warrior Mage Summoning~
     echo #####################
     # debug 10
     if ($Summoning.Ranks < 250) then goto SUMMON_BASIC
     evalmath pathsensetimer ($gametime - %pathsensetime)
     if (%pathsensetimer < 60) then goto SUMMONING
PATHSENSE:
     var pathsensetime $gametime
     matchre PATHSENSE ^\s*\.\.\.wait|^You are still stunned
     matchre SUMMONING ^You turn your perceptions inward
     matchre SUMMONING ^Your body is aligned
     put path sense
     matchwait 20
SUMMONING:
     var LOCATION SUMMONING
     math summonloop add 1
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if (%summonloop > 3) then return
     if ($standing = 0) then gosub stand
     if ($domain != 1) then
          {
               if ($charge > 2) then
                    {
                         goto domain
                    }
               else
                    {
                         goto adm
                    }
          }
PATHWAY:
     if (($charge > 2) && ($Summoning.LearningRate < 34) && ($pathway != 1)) then
          {
               pause 0.0001
               pause 0.0001
               matchre PATHWAY ^\s*\.\.\.wait|^You are still stunned
               matchre ADM ^You lack the|^Try though you may|you realize that you do not have the Elemental Charge
               matchre RETURN ^You focus on|^You are already manipulating the aether to your benefit
               if matchre("$UC_element", "(?i)FIRE") then put path focus damage
               if matchre("$UC_element", "(?i)ELEC") then put path focus accuracy
               if matchre("$UC_element", "(?i)WATER" then put path focus ease
               if matchre("$UC_element", "(?i)AIR") then put path focus quick
               if matchre("$UC_element", "(?i)AETHER") then put path focus damage
               if matchre("$UC_element)", "(?i)EARTH") then put path focus power
               matchwait 20
               goto SUMMONING
          }
     if ($standing = 0) then gosub STAND
     if ($charge < 3) then gosub SUM_ADM
     if (($charge < 5) || (($Summoning.LearningRate = 34) && ($pathway = 1))) then
          {
               pause 0.1
               pause 0.2
               matchre SUMMONING ^\s*\.\.\.wait|^You are still stunned
               matchre RETURN ^You aren't focusing on any of the aethereal pathways|^You gently relax your mind and release your hold on the aethereal pathways
               put path stop
               matchwait 20
               goto SUMMONING
          }
     if ($charge < 3) then goto ADM
     if ($standing = 0) then gosub STAND
     return
DOMAIN:
     var LOCATION DOMAIN
     if ($standing = 0) then gosub STAND
     if (%InCombat = 1) then
     {
          if matchre("%abbrevs", "(?i)TC") then
          {
               pause 0.2
               put prep TC $Mana.Debilitation
               pause 0.5
               pause 7
               pause 7
               gosub RETREAT
               pause 7
               put cast creature
               wait
               pause 0.4
          }
     }
     gosub RETREAT
     pause 0.0001
     pause 0.0001
     matchre DOMAIN ^\s*\.\.\.wait|^You are still stunned
     matchre WM_SEARCH ^You are a bit too distracted to focus on that right now
     matchre ADM ^You lack the Elemental
     matchre ADM you realize that you do not have the Elemental Charge to create a .* domain
     matchre PATHSENSE ^Discharging a burst of elemental power in the esoteric
     put summon $UC_element domain
     matchwait 11
     goto ADM
ADM:
     var LOCATION ADM
     if ($standing = 0) then gosub STAND
     gosub retreat
     if ($monstercount > 0) then
          {
               gosub SUM_ADM
               goto SUMMONING
          }
     pause 0.0001
     pause 0.0001
     matchre ADM ^\s*\.\.\.wait|^You are still stunned
     matchre SUMMONING ^You so heavily embody
     matchre WM_SEARCH ^You are a bit too distracted to focus on that right now
     matchre PATHSENSE ^You make yourself comfortable|^You continue meditating
     put summon adm
     matchwait 20
     goto ADM
SUMMON_ADM:
     pause 0.0001
     if ((%InCombat = 1) && ($monstercount > 0)) then
     {
          if matchre("%abbrevs", "(?i)TC") then
          {
               pause 0.0001
               put prep TC $Mana.Debilitation
               pause 0.5
               pause 7
               pause 7
               gosub RETREAT
               pause 3
               put cast creature
               wait
               pause 0.4
          }
     }
     gosub RETREAT
     if ($monstercount > 0) then
          {
               put summon adm
               pause 2
               pause
               if ($standing = 0) then gosub STAND
               send path sense
               pause 0.4
               if ($standing = 0) then gosub STAND
               return
          }
     put summon adm
     pause 2
     pause
     if ($standing = 0) then gosub STAND
     send path sense
     pause 0.2
     pause 0.1
     if ($standing = 0) then gosub STAND
     return
SUM_ADM:
     var admcount 0
     delay 0.0001
     var CurrentSpell %ChargeSpell
     if matchre("%ChargeSpell", "(?i)%TM.Spell.List") then var CurrentSchool TARGET
     if matchre("%ChargeSpell", "(?i)%Debil.Spell.List") then var CurrentSchool DEBILITATION
     eval temp count("%AimActions", "|")
     if ("$preparedspell" != "None") then
          {
               echo **** pausing....
               if ($spelltime < 10) then pause 4
               if ($spelltime < 10) then pause 3
               if ($spelltime < 15) then pause 2
               if ($spelltime < 15) then pause 2
               gosub SPELL_CAST
          }
     pause 0.1
     if (matchre("%ChargeSpell", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") || (%InCombat = 0)) then
          {
               if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then gosub RETREAT
               put summon adm
               pause 2
               pause
               if ($standing = 0) then gosub STAND
               if ($charge < 4) then gosub SUMMON_ADM
               if ("$preparedspell" != "None") then
                    {
                         gosub RELEASE spell
                         gosub RELEASE_CAMB
                    }
               return
          }
     if ($charge > 6) then
          {
               if ("$preparedspell" != "None") then
                    {
                         gosub RELEASE spell
                         gosub RELEASE_CAMB
                    }
               return
          }
     if (!matchre("%ChargeSpell", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && (%InCombat = 1)) then gosub CHARGE_SPAM
     return

WM_SEARCH:
     pause 0.1
     if ($standing = 0) then gosub STAND
     send search
     pause
     pause
     gosub GET_MONSTER_NAME
     send point %Critter
     pause 0.5
     gosub retreat
     goto %LOCATION
SUMMON_BASIC:
     pause 0.1
     pause 0.2
     if ($standing = 0) then gosub STAND
     if !matchre("$righthand", "Empty") && ("$lefthand" = "Empty") then var summonhand left
     if !matchre("$lefthand", "Empty") && ("$righthand" = "Empty") then var summonhand right
     if !matchre("$lefthand", "Empty") then
          {
               if !matchre("$righthand", "Empty") then return
               else var summonhand right
          }
     if ("$lefthand" = "Empty") && ("$righthand" = "Empty") then var summonhand right
     pause 0.5
     put summon weapon
     pause 3
     pause
     put empty %summonhand
     pause 0.5
     pause 0.5
     return
##########################################################
CHARGE_SPAM:
     var charging 0
     if matchre("%ChargeSpell", "(?i)%TM.Spell.List") then var CurrentSchool TARGET
     if matchre("%ChargeSpell", "(?i)%Debil.Spell.List") then var CurrentSchool DEBILITATION
     echo ###################
     echo * WM ADM / Charge Spell Spam
     echo * Building Elemental Charge
     echo ###################
     pause 0.5
     if ($standing = 0) then gosub STAND
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then
          {
               echo ** NO MONSTERS - SUMMONING ADM
               put summon adm
               pause 4
               pause 0.5
          }
CHARGE_SPAM_1:
     math charging add 1
     if ($standing = 0) then gosub STAND
     if ($charge > 6) then goto CHARGE_SPAM_RETURN
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then
          {
               put summon adm
               pause 4
               goto CHARGE_SPAM_2
          }
     if matchre("%ChargeSpell", "\b(?i)%TM.Spell.List\b") then gosub TM %ChargeSpell
     if !matchre("%ChargeSpell", "\b(?i)%TM.Spell.List\b") then gosub PREPARE %ChargeSpell
     pause 14
     gosub SPELL_CAST
CHARGE_SPAM_2:
     pause 0.2
     put path sense
     pause
     echo *** CHARGE: $charge
     math charging add 1
     if ($standing = 0) then gosub STAND
     if ($charge > 6) then goto CHARGE_SPAM_RETURN
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then
          {
               put summon adm
               pause 4
               goto CHARGE_SPAM_3
          }
     if ($standing = 0) then gosub STAND
     if matchre("%ChargeSpell", "\b(?i)%TM.Spell.List\b") then gosub TM %ChargeSpell
     if !matchre("%ChargeSpell", "\b(?i)%TM.Spell.List\b") then gosub PREPARE %ChargeSpell
     pause 14
     gosub SPELL_CAST
CHARGE_SPAM_3:
     pause 0.2
     put path sense
     pause
     echo *** CHARGE: $charge
     math charging add 1
     if ($standing = 0) then gosub STAND
     if ($charge > 6) then goto CHARGE_SPAM_RETURN
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then
          {
               put summon adm
               pause 3
               goto CHARGE_SPAM_RETURN
          }
     if ($standing = 0) then gosub STAND
     if matchre("%ChargeSpell", "\b(?i)%TM.Spell.List\b") then gosub TM %ChargeSpell
     if !matchre("%ChargeSpell", "\b(?i)%TM.Spell.List\b") then gosub PREPARE %ChargeSpell
     pause 14
     gosub SPELL_CAST
CHARGE_SPAM_RETURN:
     if ($standing = 0) then gosub STAND
     pause 0.1
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
          }
     pause 0.1
     if ($standing = 0) then gosub STAND
     return

PREP_ADM:
     var LOCATION PREP_ADM_1
     pause 0.00001
     pause 0.00001
     put path sense
     pause
     pause 0.00001
     pause 0.00001
     if ($charge > 10) then return
     echo #####################
     echo ** ELEMENTAL CHARGE IS: $charge
     echo ** Pre-Combat WM Charge up
     echo #####################
PREP_ADM_1:
     pause 0.3
     if ($charge > 10) then return
     if ($standing = 0) then gosub STAND
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then gosub RETREAT
     pause 0.1
     matchre PREP_ADM_1 ^\s*\.\.\.wait|^You are still stunned
     matchre RETURN ^You so heavily embody
     matchre RETURN ^You are a bit too distracted to focus on that right now
     matchre PREP_ADM_1 ^You make yourself comfortable|^You continue meditating
     put summon adm
     matchwait 5
     goto PREP_ADM_1
##########################################################
IGNITE_PREP:
     var IGNITE.WEAPON NULL
     pause 0.0001
     if (!matchre("%LTWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SummonLT", "(?i)(NULL|OFF|0)")) then
          {
               var IGNITE.WEAPON %LTWEAPON
               goto IGNITE_DONE
          }
     if (!matchre("%HTWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SummonHT", "(?i)(NULL|OFF|0)")) then
          {
               var IGNITE.WEAPON %HTWEAPON
               goto IGNITE_DONE
          }
     if (!matchre("%SEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SummonSE", "(?i)(NULL|OFF|0)")) then
          {
               var IGNITE.WEAPON %SEWEAPON
               goto IGNITE_DONE
          }
     if (!matchre("%SBWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SummonSB", "(?i)(NULL|OFF|0)")) then
          {
               var IGNITE.WEAPON %SBWEAPON
               goto IGNITE_DONE
          }
     if (!matchre("%LTWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SummonLT", "(?i)(NULL|OFF|0)")) then
          {
               var IGNITE.WEAPON %LTWEAPON
               goto IGNITE_DONE
          }
     if (!matchre("%LBWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SummonLB", "(?i)(NULL|OFF|0)")) then
          {
               var IGNITE.WEAPON %LBWEAPON
               goto IGNITE_DONE
          }
     if (!matchre("%THBWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SummonTHB", "(?i)(NULL|OFF|0)")) then
          {
               var IGNITE.WEAPON %THBWEAPON
               goto IGNITE_DONE
          }
     if (!matchre("%STAVES", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SummonStaves", "(?i)(NULL|OFF|0)")) then
          {
               var IGNITE.WEAPON %STAVES
               goto IGNITE_DONE
          }
     if (!matchre("%POLEARMS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SummonPolearms", "(?i)(NULL|OFF|0)")) then
          {
               var IGNITE.WEAPON %POLEARMS
               goto IGNITE_DONE
          }
     if (!matchre("%HTWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SummonHT", "(?i)(NULL|OFF|0)")) then
          {
               var IGNITE.WEAPON %HTWEAPON
               goto IGNITE_DONE
          }
     if (!matchre("%LEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SummonLE", "(?i)(NULL|OFF|0)")) then
          {
               var IGNITE.WEAPON %LEWEAPON
               goto IGNITE_DONE
          }
     if (!matchre("%THEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%SummonTHE", "(?i)(NULL|OFF|0)")) then
          {
               var IGNITE.WEAPON %THEWEAPON
               goto IGNITE_DONE
          }
     if (($UC_SummonWeapons = 1) && matchre("%SummonSE", "(?i)(ON|1|YES)")) then
          {
               gosub SUMMON_WEAPON SE
               var IGNITE.WEAPON %WM.Weapon
               goto IGNITE_PREP_2
          }
     if (($UC_SummonWeapons = 1) && matchre("%SummonLE", "(?i)(ON|1|YES)")) then
          {
               gosub SUMMON_WEAPON Large Edge
               var IGNITE.WEAPON %WM.Weapon
               goto IGNITE_PREP_2
          }
     if (($UC_SummonWeapons = 1) && matchre("%SummonSB", "(?i)(ON|1|YES)")) then
          {
               gosub SUMMON_WEAPON SB
               var IGNITE.WEAPON %WM.Weapon
               goto IGNITE_PREP_2
          }
     if (($UC_SummonWeapons = 1) && matchre("%SummonLB", "(?i)(ON|1|YES)")) then
          {
               gosub SUMMON_WEAPON LB
               var IGNITE.WEAPON %WM.Weapon
               goto IGNITE_PREP_2
          }
     if (($UC_SummonWeapons = 1) && matchre("%SummonStaves", "(?i)(ON|1|YES)")) then
          {
               gosub SUMMON_WEAPON Stave
               var IGNITE.WEAPON %WM.Weapon
               goto IGNITE_PREP_2
          }
     if (($UC_SummonWeapons = 1) && matchre("%SummonTHE", "(?i)(ON|1|YES)")) then
          {
               gosub SUMMON_WEAPON THE
               var IGNITE.WEAPON %WM.Weapon
               goto IGNITE_PREP_2
          }
     if (($UC_SummonWeapons = 1) && matchre("%SummonLT", "(?i)(ON|1|YES)")) then
          {
               gosub SUMMON_WEAPON LT
               var IGNITE.WEAPON %WM.Weapon
               goto IGNITE_PREP_2
          }
     if (($UC_SummonWeapons = 1) && matchre("%SummonHT", "(?i)(ON|1|YES)")) then
          {
               gosub SUMMON_WEAPON HT
               var IGNITE.WEAPON %WM.Weapon
               goto IGNITE_PREP_2
          }
IGNITE_PREP_2:
     if (("%WEAPON" != "NULL") && ("%IGNITE.WEAPON" = "NULL")) then var IGNITE.WEAPON %WEAPON
     if (("%WM.Weapon" != "NULL") && ("%IGNITE.WEAPON" = "NULL")) then var IGNITE.WEAPON %WM.Weapon
     # if ("%WEAPON" = "NULL") then var WEAPON %IGNITE.WEAPON
IGNITE_DONE:
     echo ######################################
     echo ** Setting Ignite Weapon to: %IGNITE.WEAPON
     echo ######################################
     return
SUMMON_WEAPON:
     var SummonType $0
     var summoning 1
     var summoningloop 0
     pause 0.0001
     pause 0.0001
     pause 0.0001
     action var SummonedWeapon 0 when ^A .* crumbles away into tiny pebbles|^With a puff of black smoke\, .* disappears
     if ($UC_SummonWeapons = 0) then return
     if (%spellPrepped = 1) then gosub SPELL_CAST
     echo
     echo #################
     echo ** SUMMONING WEAPON:
     echo ** %SummonType %SummonElement
     echo #################
     echo
     if (!matchre("$righthand", "Empty") && !contains("$righthand", "%WM.Weapon")) then gosub STOWIT right
     if (!matchre("$lefthand", "Empty") && !contains("$lefthand", "%WM.Weapon")) then gosub STOWIT left
     send pathway sense
     pause 0.2
     pause 0.1
     pause 0.0001
     if matchre("%WMIngot", "(?i)(ON|1|YES)") then
          {
               if matchre("%Ingot.Container", "(?i)ring") then send touch my %Ingot.Container
               if !matchre("%Ingot.Container", "(?i)ring") then gosub GET ingot from my %Ingot.Container
               pause 0.5
               if !matchre("$righthand $lefthand", "(?i)ingot") then send untie my ingot from my %Ingot.Container
               pause 0.3
               pause 0.1
               if !matchre("$righthand $lefthand", "(?i)ingot") then gosub GET my ingot
               if matchre("$righthandnoun", "ingot") then gosub SWAP
          }
     pause 0.0001
     goto SHAPE_WEAPON
RETREAT_SHAPE:
     gosub RETREAT
SHAPE_WEAPON:
     math summoningloop add 1
     if (%summoningloop > 2) then goto SUMMON_RESET
     if (%SummonedWeapon = 1) then
          {
               if ("%WM.Weapon" != "NULL") then gosub GET my %WM.Weapon
               pause 0.0001
               if contains("$lefthand", "%WM.Weapon") then gosub SWAP
               gosub RETREAT
               pause 0.0001
               pause 0.0001
               if !contains("$righthand", "%WM.Weapon") && !contains("$lefthand", "%WM.Weapon") then goto SUMMON_WEAPON_2
               matchre RETREAT_SHAPE ^You cannot do that while engaged\!
               matchre SUMMON_RESET ^You fumble around but
               matchre RESHAPE_FAILURE ^You lack the elemental charge|you realize that you do not have the Elemental Charge
               matchre RESHAPE_SUCCESS ^You reach out with your will and reshape
               send shape my $righthandnoun to %SummonType
               matchwait 20
               goto RESHAPE_SUCCESS
          }
     goto SUMMON_WEAPON_2
RESHAPE_FAILURE:
     gosub SUM_ADM
     goto SHAPE_WEAPON
RESHAPE_SUCCESS:
     pause 0.0001
     if ($charge < 2) then gosub SUM_ADM
     pause 0.0001
     if (%SummonTemplate = 1) then
          {
               pause 0.0001
               send turn my $righthandnoun
               wait
               pause 0.3
          }
     pause 0.0001
     var WM.Weapon $righthand
     var WEAPON %WM.Weapon
     echo ###############################
     echo *** SETTING WM.Weapon to: %WM.Weapon
     echo ###############################
     return
SUMMON_RESET:
     echo *** NOT A SUMMONED WEAPON - Resetting...
     if !matchre("$righthand", "Empty") then gosub STOWIT right
     if !matchre("$lefthand", "Empty") then gosub STOWIT left
     var SummonedWeapon 0
     var summoningloop 0
SUMMON_WEAPON_2:
     pause 0.0001
     pause 0.0001
     pause 0.0001
     match SUMMON_FAILURE You lack the elemental charge to summon a weapon
     match SUMMON_WEAPON_3 Closing your eyes
     send summon weapon %SummonType %SummonElement
     matchwait 3
SUMMON_WEAPON_3:
     send pathway sense
     pause 0.1
     pause 0.1
     pause 0.0001
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then goto SUMMON_FAILURE
     if matchre("$righthand $lefthand", "(?i)ingot") then
          {
               if matchre("%Ingot.Container", "(?i)ring") then send touch my %Ingot.Container
               if !matchre("%Ingot.Container", "(?i)ring") then put tie ingot on my %Ingot.Container
               pause 0.5
               pause 0.2
               if !matchre("$righthand $lefthand", "(?i)ingot") then send put my ingot in my %Ingot.Container
               pause 0.3
               pause 0.3
               if matchre("$righthand $lefthand", "(?i)ingot") then gosub STOWIT ingot
          }
     pause 0.0001
     if contains("$lefthand $righthand", "ingot") then gosub STOWIT ingot
     pause 0.0001
     if ("$righthand" = "Empty") then gosub SWAP
     pause 0.0001
     if (%SummonTemplate = 1) then
          {
               if ($charge < 4) then gosub SUM_ADM
               if ($charge < 3) then gosub SUM_ADM
               send turn my $righthand
               pause 0.5
          }
     pause 0.0001
     pause 0.0001
SUMMON_WEAPON_CHECK:
     pause 0.0001
     pause 0.0001
     if ("$righthand" = "Empty") then gosub SWAP
     pause 0.0001
     if ("$righthand" = "Empty") then goto SUMMON_ABORT
     pause 0.0001
     var SummonedWeapon 1
     var WM.Weapon $righthand
     echo ##############################
     echo *** SETTING WM.Weapon to: %WM.Weapon
     echo ##############################
     var WEAPON %WM.Weapon
     if (%SummonWeight = 1) then goto SUMMON_RETURN
     pause 0.0001
     pause 0.0001
     if ((%SummonWeight = 0) && (%QuickInfusions)) then send push %WEAPON
     if ((%SummonWeight = 2) && (%QuickInfusions)) then send pull %WEAPON
     pause 0.0001
     pause 0.0001
     pause 0.0001
     pause 0.0001
     if ("$righthand" = "Empty") then gosub SWAP
     goto SUMMON_RETURN
SUMMON_FAILURE:
     # debug 5
     if matchre("%ChargeSpell", "(?i)%TM.Spell.List") then var CurrentSchool TARGET
     if matchre("%ChargeSpell", "(?i)%Debil.Spell.List") then var CurrentSchool DEBILITATION
     var CurrentSpell %ChargeSpell
     var summonLoop 0
     echo ##################################
     echo *** NOT ENOUGH ELEMENTAL CHARGE TO SUMMON!
     echo *** ATTEMPTING TO RECOVER WITH ADM
     echo ##################################
     gosub SUM_ADM
     send path sense
     pause 0.2
     pause 0.0001
     if ($charge < 5) then gosub SUM_ADM
     if ($charge < 4) then gosub SUM_ADM
     # debug 0
     goto SUMMON_WEAPON_2
SUMMON_FAILURE_2:
     math summonLoop add 1
     if (%summonLoop > 2) then goto SUMMON_WEAPON_2
     if ($standing = 0) then gosub STAND
     gosub RETREAT
     gosub SUM_ADM
     pause 0.0001
     if ($standing = 0) then gosub STAND
     put path sense
     pause
     pause 0.0001
     pause 0.0001
     gosub RETREAT
     if ($charge < 4) then gosub SUM_ADM
     pause 0.0001
     pause 0.0001
     pause 0.0001
     if ($standing = 0) then gosub STAND
     goto SUMMON_FAILURE_2
SUMMON_ABORT:
     put #echo >Log #ff0000 *** SUMMON WEAPON FAILURE
     echo ##############
     echo *** SUMMON FAILURE!!!
     echo ##############
     goto SUMMON_RETURN
SUMMON_RETURN:
     unvar summonLoop
     return
###########################################################################
#######################################
## THIEF SUBS - THIEF GOSUBS
#######################################
THIEF_VARS:
     var AmbushType.Choke 0
     var AmbushType.Stun 0
     var AmbushType.Slash 0
     var AmbushType.Screen 0
     var AmbushType.Clout 0
     var AmbushType.Ignite 0
     var Khri.Town ON
     return
THIEF_STRIP:
     unvar MM.Cyclics
     unvar MM.Cyclics.mana
     unvar MM.Buffs
     unvar MM.Augmentation.Spell
     unvar MM.Debilitation.Spell
     unvar MM.Target.Spell
     unvar MM.Utility.Spell
     unvar MM.Warding.Spell
     unvar MM.Sorcery.Spell
     unvar Paladin.Cyclics
     unvar Paladin.Cyclics.mana
     unvar Paladin.Buffs
     unvar Paladin.Augmentation.Spell
     unvar Paladin.Debilitation.Spell
     unvar Paladin.Target.Spell
     unvar Paladin.Utility.Spell
     unvar Paladin.Warding.Spell
     unvar Paladin.Sorcery.Spell
     unvar Empath.Cyclics
     unvar Empath.Cyclics.mana
     unvar Empath.Buffs
     unvar Empath.Augmentation.Spell
     unvar Empath.Debilitation.Spell
     unvar Empath.Target.Spell
     unvar Empath.Utility.Spell
     unvar Empath.Warding.Spell
     unvar Empath.Sorcery.Spell
     unvar Bard.Cyclics
     unvar Bard.Cyclics.mana
     unvar Bard.Buffs
     unvar Bard.Augmentation.Spell
     unvar Bard.Debilitation.Spell
     unvar Bard.Target.Spell
     unvar Bard.Utility.Spell
     unvar Bard.Warding.Spell
     unvar Bard.Sorcery.Spell
     unvar Cleric.Cyclics
     unvar Cleric.Cyclics.mana
     unvar Cleric.Buffs
     unvar Cleric.Augmentation.Spell
     unvar Cleric.Debilitation.Spell
     unvar Cleric.Target.Spell
     unvar Cleric.Utility.Spell
     unvar Cleric.Warding.Spell
     unvar Cleric.Sorcery.Spell
     unvar Necro.Cyclics
     unvar Necro.Cyclics.mana
     unvar Necro.Buffs
     unvar Necro.Augmentation.Spell
     unvar Necro.Debilitation.Spell
     unvar Necro.Target.Spell
     unvar Necro.Utility.Spell
     unvar Necro.Warding.Spell
     unvar Necro.Sorcery.Spell
     unvar Ranger.Cyclics
     unvar Ranger.Cyclics.mana
     unvar Ranger.Buffs
     unvar Ranger.Augmentation.Spell
     unvar Ranger.Debilitation.Spell
     unvar Ranger.Target.Spell
     unvar Ranger.Utility.Spell
     unvar Ranger.Warding.Spell
     unvar Ranger.Sorcery.Spell
     unvar WM.Cyclics
     unvar WM.Cyclics.mana
     unvar WM.Buffs
     unvar WM.Augmentation.Spell
     unvar WM.Debilitation.Spell
     unvar WM.Target.Spell
     unvar WM.Utility.Spell
     unvar WM.Warding.Spell
     unvar WM.Sorcery.Spell
     unvar Trader.Cyclics
     unvar Trader.Cyclics.mana
     unvar Trader.Buffs
     unvar Trader.Augmentation.Spell
     unvar Trader.Debilitation.Spell
     unvar Trader.Target.Spell
     unvar Trader.Utility.Spell
     unvar Trader.Warding.Spell
     unvar Trader.Sorcery.Spell
     unvar Sorcery.Camb
     unvar Sorcery.Focus
     unvar Sorcery.Mana
     unvar Sorcery.Symbiosis
     unvar SorceryMastery
     unvar Utility.Camb
     unvar Utility.Focus
     unvar Utility.Mana
     unvar Utility.Symbiosis
     unvar UtilityMastery
     unvar Warding.Camb
     unvar Warding.Focus
     unvar Warding.Mana
     unvar Warding.Symbiosis
     unvar WardingMastery
     unvar Target.Camb
     unvar Target.Focus
     unvar Target.Mana
     unvar Target.Symbiosis
     unvar TargetMastery
     unvar Debilitation.Camb
     unvar Debilitation.Mana
     unvar Debilitation.Symbiosis
     unvar DebilitationMastery
     unvar AugmentationCyclic
     unvar Augmentation.Camb
     unvar Augmentation.Mana
     unvar Augmentation.Symbiosis
     unvar AugmentationMastery
     unvar ChargeSpell
     unvar CFB.Mana
     unvar QE.Mana
     return
NON_THIEF_STRIP:
NOT_THIEF_STRIP:
     unvar khriAVOIDANCE
     unvar khriADAPTATION
     unvar khriCALM
     unvar khriCREDENCE
     unvar khriCUNNING
     unvar khriDAMPEN
     unvar khriDARKEN
     unvar khriELIMINATE
     unvar khriELUSION
     unvar khriENDURE
     unvar khriEVANESCENCE
     unvar khriFLIGHT
     unvar khriFOCUS
     unvar khriFRIGHT
     unvar khriGUILE
     unvar khriHARRIER
     unvar khriHASTEN
     unvar khriINTIMIDATE
     unvar khriPLUNDER
     unvar khriPROWESS
     unvar khriSAFE
     unvar khriSAGACITY
     unvar khriSERENITY
     unvar khriSHADOWSTEP
     unvar khriSIGHT
     unvar khriSTEADY
     unvar khriSTRIKE
     unvar khriTERRIFY
     unvar AmbushType.Choke
     unvar AmbushType.Clout
     unvar AmbushType.Ignite
     unvar AmbushType.Slash
     unvar AmbushType.Stun
     return
##############################################################################################
AMBUSH_SETUP:
     gosub STOP_PLAY
     action var AmbushType.Choke 1 when AMBUSH CHOKE\:
     action var AmbushType.Stun 1 when AMBUSH STUN\:
     action var AmbushType.Screen 1 when AMBUSH SCREEN\:
     action var AmbushType.Slash 1 when AMBUSH SLASH\:
     action var AmbushType.Clout 1 when AMBUSH CLOUT\:
     action var AmbushType.Ignite 1 when AMBUSH IGNITE\:
     delay 0.0001
     matchre AMBUSH_SETUP_2 Guild Options|AMBUSH|Syntax|What|I|Please|^You are
     send ambush help
     matchwait 4
AMBUSH_SETUP_2:
     delay 0.0001
     pause 0.0001
     echo
     echo #################
     echo ** KNOWN AMBUSHES:
     if (%AmbushType.Choke = 1) then echo ** Ambush Choke
     if (%AmbushType.Stun = 1) then echo ** Ambush Stun
     if (%AmbushType.Screen = 1) then echo ** Ambush Screen
     if (%AmbushType.Slash = 1) then echo ** Ambush Slash
     if (%AmbushType.Clout = 1) then echo ** Ambush Clout
     if (%AmbushType.Ignite = 1) then echo ** Ambush Ignite
     echo #################
     echo
AMBUSH_SETUP_RETURN:
     action remove AMBUSH CHOKE\:
     action remove AMBUSH STUN\:
     action remove AMBUSH SCREEN\:
     action remove AMBUSH SLASH\:
     action remove AMBUSH CLOUT\:
     action remove AMBUSH IGNITE\:
     return
AMBUSH_CHECK_2:
     gosub STOWIT left
     delay 0.0001
     goto AMBUSH_MOVE
AMBUSH_CHECK:
     if (!$UC_Ambush) then return
     var hideCounter 0
     gosub stowing
     if !matchre("%WEAPON", "(?i)($charactername|NULL)") then gosub WIELD %WEAPON
DEBILITATE:
     var ambushLoop 0
     if ($concentration < 25) then return
     if ("$guild" = "Barbarian") then goto ROAR
     if ($UC_Ambush = 0) then return
     if (%Backtraining = 1) then return
     if ($circle < 25) then return
     var TypeAmbush stun
DEBILITATE_1:
     if matchre("%WEAPON_EXP","Offhand_Weapon") && ("$righthand" = "Empty") then gosub SWAP
     if ($hidden = 0) then gosub hide
     gosub AMBUSH_DECIDE
     if ("%TypeAmbush" = "NULL") then goto AMBUSH_RETURN
     gosub AMBUSH_MOVE
     goto AMBUSH_RETURN

AMBUSH_DECIDE:
     if (%ambushLoop > 2) then goto AMBUSH_RETURN
     if (matchre("$righthandnoun","(bola|club|hhr'ata|maul|mace|mattock|star|cane|staff|nightstick|khuj|halberd|bludgeon|briquet|flail|quarterstaff)") && (%AmbushType.Stun = 1)) then var TypeAmbush stun
     if (matchre("$righthandnoun","(katana|knife|sabre|briquet|scimitar|dagger|iltesh|broadsword|sword|telo|katar|jambiya|javelin|quarterstaff|spear|flamberge|ngalio|blade)") && (%AmbushType.Slash = 1)) then var TypeAmbush slash
     if (matchre("$righthandnoun","(throwing blade|sling|crossbow|stonebow|bow|arbalest)") && ($circle >= 50) && (%AmbushType.Clout = 1)) then var TypeAmbush clout
     if (("$lefthand" = "Empty") && ($circle >= 50) && (%AmbushType.Clout = 1)) then var TypeAmbush clout
     pause 0.0001
     return
AMBUSH_SWITCH:
     if (%ambushLoop > 3) then goto AMBUSH_RETURN
     if (("%TypeAmbush" = "slash") && (%AmbushType.Stun = 1)) then var TypeAmbush stun
     if (("%TypeAmbush" = "clout")  && (%AmbushType.Slash = 1)) then var TypeAmbush slash
     if (("%TypeAmbush" = "stun") && ($circle >= 50) &&  && (%AmbushType.Clout = 1)) then var TypeAmbush clout
     if (("%TypeAmbush" = "stun") && ($circle < 50)  && (%AmbushType.Slash = 1)) then var TypeAmbush slash
AMBUSH_MOVE:
     math ambushLoop add 1
     delay 0.0001
     if (%ambushLoop > 3) then return
     if ($concentration < 25) then return
     if (("%TypeAmbush" = "clout") && ($circle < 50)) then var TypeAmbush stun
     if (("%TypeAmbush" = "clout") && !matchre("$lefthand", "Empty") && ("$righthand" = "Empty")) then
          {
               gosub SWAP
               gosub HIDE
          }
     if (("%TypeAmbush" = "clout") && !matchre("$lefthand", "Empty") && !matchre("%WEAPON_EXP","Offhand_Weapon")) then gosub STOWIT left
     if ($hidden = 0) then gosub HIDE
     if ($hidden = 0) then gosub RET_STALK
AMBUSH_MOVE_2:
     if matchre("$righthandnoun","(sabre|sword|spear|katar|jambiya|quarterstaff|nightstick|khuj)") then var TypeAmbush stun
     if (("$lefthand" = "Empty") && ("$righthand" = "Empty") && (%AmbushType.Clout = 1)) then var TypeAmbush clout
     if (matchre("$UC_WeaponType","(CROSSBOW|BOW|SLINGS|BRAWL)") && matchre("%TypeAmbush", "(stun|slash)")) then var TypeAmbush clout
     if (matchre("%TypeAmbush", "clout") && (%AmbushType.Clout = 0)) then return
     if (("$lefthand" = "Empty") && ("$righthand" = "Empty") && (%AmbushType.Clout = 0)) then return
     pause 0.0001
     matchre AMBUSH_MOVE ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STALK_FAIL_2 ^You must be hidden or invisible
     matchre AMBUSH_CHECK You need at least one hand
     matchre AMBUSH_CHECK_2 ^You need two hands
     matchre AMBUSH_SWITCH ^Your.*just isn't sharp enough|suited for this type of maneuver|^Wouldn't it be better
     matchre AMBUSH_RETURN Roundtime|it is flying|You aren't close enough to attack|There is nothing else|Stalk|Hamstring a|Coldcock a
     matchre AMBUSH_RETURN debilitated|impaired|out cold|deflect your slashing cut|isn't even standing|You're not exactly sure how
     matchre AMBUSH_RETURN ^Please rephrase|^What were
     put ambush %TypeAmbush
     matchwait 10
     return
RET_STALK:
     pause 0.0001
     put retreat
     pause 0.0001
     pause 0.0001
STALK_FAIL_2:
     delay 0.0001
     math hideCounter add 1
     if (%hideCounter > 2) then return
     if ($hidden = 0) then gosub HIDE
     return
AMBUSH_RETURN:
     pause 0.0001
     unvar ambushLoop
     if (matchre("%WEAPON_EXP","Offhand_Weapon") &&  ("$lefthand" = "Empty") && !matchre("$righthand", "Empty")) then gosub SWAP
     return
###############################################################################################################################################################
### THIEF KHRI
KHRI:
KHRI_CHECK:
     echo
     echo ##########
     echo # KHRI CHECK
     echo ##########
     echo
###### COMBAT ONLY KHRI
     if (%InCombat = 1) then
          {
          if (matchre("$UC_WeaponType","(SB|LB|THB|SE|LE|THE|STAVES|POLEARMS)") && (%khriHASTEN = 1) && ($SpellTimer.KhriHasten.active = 0) && ($concentration > 75)) then gosub KHRI_START HASTEN
          if (matchre("$UC_WeaponType","(SLINGS|BOW|CROSSBOW|HT|LT)") && (%khriSTEADY = 1) && ($SpellTimer.KhriSteady.active = 0) && ($concentration > 60)) then
               {
                    if ((%khriAVOIDANCE = 1) && ($khriAVOIDANCE = 0) && (%khriELUSION = 1) && ($SpellTimer.KhriElusion.active = 0) && ($circle > 80)) then gosub KHRI_START AVOIDANCE ELUSION STEADY
                    if ($SpellTimer.KhriSteady.active = 0) then gosub KHRI_START STEADY
               }
          if (matchre("$UC_WeaponType","(BACKSTAB|SB|LB|THB|SE|LE|THE|STAVES|POLEARMS)") && (%khriSTRIKE = 1) && ($SpellTimer.KhriStrike.active = 0) && ($concentration > 70)) then
               {
                    if ((%khriDAMPEN = 1) && (%khriELUSION = 1) && (%khriFOCUS = 1) && (%khriPROWESS = 1) && ($circle > 110)) then gosub KHRI_START DAMPEN ENDURE FOCUS PROWESS STRIKE
                    if ((%khriPROWESS = 1) && ($SpellTimer.KhriProwess.active = 0) && (%khriELUSION = 1) && ($SpellTimer.KhriElusion.active = 0) && ($circle > 90)) then gosub KHRI_START PROWESS ELUSION STRIKE
                    if ((%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && (%khriELUSION = 1) && ($SpellTimer.KhriElusion.active = 0) && ($circle > 80)) then gosub KHRI_START ENDURE ELUSION STRIKE
                    if ($SpellTimer.KhriStrike.active = 0) then gosub KHRI_START STRIKE
               }
          if (matchre("$UC_WeaponType","BACKSTAB") && (%khriSHADOWSTEP = 1) && ($SpellTimer.KhriShadowstep.active = 0) && ($concentration > 80) then
               {
                    if ((%khriDAMPEN = 1) && (%khriDARKEN = 1) && (%khriSTRIKE = 1) && (%khriHASTEN = 1) && ($circle > 110)) then gosub KHRI_START DAMPEN DARKEN HASTEN STRIKE SHADOWSTEP
                    if ((%khriPROWESS = 1) && ($SpellTimer.KhriProwess.active = 0) && (%khriSTRIKE = 1) && ($SpellTimer.KhriStrike.active = 0) && ($circle > 90)) then gosub KHRI_START PROWESS STRIKE SHADOWSTEP
                    if ((%khriDARKEN = 1) && ($SpellTimer.KhriDarken.active = 0) && (%khriDAMPEN = 1) && (%SpellTimer.KhriDampen.active = 0) && ($circle > 80)) then gosub KHRI_START DAMPEN DARKEN SHADOWSTEP
                    if ((%khriDARKEN = 1) && ($SpellTimer.KhriDarken.active = 0) && ($circle > 60)) then gosub KHRI_START DARKEN SHADOWSTEP
                    if ($SpellTimer.KhriShadowstep.active = 0) then gosub KHRI_START SHADOWSTEP
               }
          if (matchre("$UC_WeaponType","BACKSTAB") && (%khriELIMINATE = 1) && ($SpellTimer.KhriEliminate.active = 0) && ($concentration > 80)) then gosub KHRI_START ELIMINATE
          if (matchre("$UC_WeaponType","BACKSTAB") && (%khriDARKEN = 1) && ($SpellTimer.KhriDarken.active = 0) && ($concentration > 80)) then
               {
                    if ((%khriDAMPEN = 1) && ($SpellTimer.KhriDampen.active = 0) && (%khriDARKEN = 1) && ($SpellTimer.KhriDarken.active = 0) && (%khriSTRIKE = 1) && ($SpellTimer.KhriStrike.active = 0) && ($circle > 90)) then gosub KHRI_START DAMPEN DARKEN STRIKE
                    if ((%khriDAMPEN = 1) && ($SpellTimer.KhriDampen.active = 0) && (%khriELUSION = 1) && (%SpellTimer.KhriElusion.active = 0) && ($circle > 80)) then gosub KHRI_START DAMPEN DARKEN ELUSION
                    if ((%khriDAMPEN = 1) && ($SpellTimer.KhriDampen.active = 0) && ($circle > 60)) then gosub KHRI_START DAMPEN DARKEN
                    if ($SpellTimer.KhriDarken.active = 0) then gosub KHRI_START DARKEN
               }
          if ((%khriPROWESS = 1) && ($khriPROWESS = 0) && ($concentration > 70)) then
               {
                    if ((%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && (%khriELUSION = 1) && ($SpellTimer.KhriElusion.active = 0) && (%khriSAGACITY = 1) && ($SpellTimer.KhriSagacity.active = 0) && ($circle > 120)) then gosub KHRI_START ENDURE ELUSION SAGACITY FOCUS PROWESS
                    if ((%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && (%khriELUSION = 1) && ($SpellTimer.KhriElusion.active = 0) && (%khriFOCUS = 1) && ($SpellTimer.KhriFocus.active = 0) && ($circle > 100)) then gosub KHRI_START ENDURE ELUSION FOCUS PROWESS
                    if ((%khriELUSION = 1) && ($SpellTimer.KhriElusion.active = 0) && (%khriSTRIKE = 1) && ($SpellTimer.KhriStrike.active = 0) && ($circle > 80)) then gosub KHRI_START ELUSION STRIKE PROWESS
                    if ((%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && (%khriELUSION = 1) && ($SpellTimer.KhriElusion.active = 0) && ($circle > 80)) then gosub KHRI_START ENDURE ELUSION PROWESS
                    if ($SpellTimer.KhriProwess.active = 0) then gosub KHRI_START PROWESS
               }
          if ((%khriAVOIDANCE = 1) && ($SpellTimer.KhriAvoidance.active = 0) && ($concentration > 70)) then
               {
                    if ((%khriENDURE = 1) && (%khriELUSION = 1) && (%khriSAGACITY = 1) && (%khriFOCUS = 1) && ($circle > 120)) then gosub KHRI_START ENDURE ELUSION SAGACITY FOCUS AVOIDANCE
                    if ((%khriAVOIDANCE = 1) && ($SpellTimer.KhriAvoidance.active = 0) && (%khriFOCUS = 1) && ($SpellTimer.KhriFocus.active = 0) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 100)) then gosub KHRI_START AVOIDANCE ENDURE FOCUS ELUSION
                    if ((%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && (%khriELUSION = 1) && ($SpellTimer.KhriElusion.active = 0) && ($circle > 80)) then gosub KHRI_START ENDURE ELUSION AVOIDANCE
                    if ($SpellTimer.KhriAvoidance.active = 0) then gosub KHRI_START AVOIDANCE
               }
          if ((%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($concentration > 70)) then
               {
                    if ((%khriELUSION = 1) && (%khriSAGACITY = 1) && (%khriFOCUS = 1) && ($circle > 100)) then gosub KHRI_START ELUSION SAGACITY FOCUS ENDURE
                    if ((%khriFOCUS = 1) && ($SpellTimer.KhriFocus.active = 0) && (%khriELUSION = 1) && ($SpellTimer.KhriElusion.active = 0) && ($circle > 80)) then gosub KHRI_START FOCUS ELUSION ENDURE
                    if ($SpellTimer.KhriEndure.active = 0) then gosub KHRI_START ENDURE
               }
          if ((%khriELUSION = 1) && ($SpellTimer.KhriElusion.active = 0) && ($concentration > 70)) then
               {
                    if ((%khriAVOIDANCE = 1) && ($SpellTimer.KhriAvoidance.active = 0) && (%khriSAGACITY = 1) && ($SpellTimer.KhriSagacity.active = 0) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 100)) then gosub KHRI_START AVOIDANCE ENDURE SAGACITY ELUSION
                    if ((%khriPROWESS = 1) && ($SpellTimer.KhriProwess.active = 0) && (%khriFOCUS = 1) && ($SpellTimer.KhriFocus.active = 0) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 100)) then gosub KHRI_START PROWESS ENDURE FOCUS ELUSION
                    if ((%khriFOCUS = 1) && ($SpellTimer.KhriFocus.active = 0) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 80)) then gosub KHRI_START ENDURE FOCUS ELUSION
                    if ($SpellTimer.KhriElusion.active = 0) then gosub KHRI_START ELUSION
               }
          if ((%khriADAPTATION = 1) && ($SpellTimer.khriAdaptation.active = 0) && ($concentration > 70)) then
               {
                    if ((%khriAVOIDANCE = 1) && ($SpellTimer.KhriAvoidance.active = 0) && (%khriSAGACITY = 1) && ($SpellTimer.KhriSagacity.active = 0) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 100)) then gosub KHRI_START AVOIDANCE ENDURE SAGACITY ADAPTATION
                    if ((%khriPROWESS = 1) && ($SpellTimer.KhriProwess.active = 0) && (%khriFOCUS = 1) && ($SpellTimer.KhriFocus.active = 0) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 100)) then gosub KHRI_START PROWESS ENDURE FOCUS ADAPTATION
                    if ((%khriFOCUS = 1) && ($SpellTimer.KhriFocus.active = 0) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 80)) then gosub KHRI_START ENDURE FOCUS ADAPTATION
                    if ($SpellTimer.khriAdaptation.active = 0) then gosub KHRI_START ADAPTATION
               }
          if ((%khriDAMPEN = 1) && ($SpellTimer.KhriDampen.active = 0) && ($concentration > 70)) then
               {
                    if ((%khriSERENITY = 1) && ($SpellTimer.KhriSerenity.active = 0) && (%khriFOCUS = 1) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 120)) then gosub KHRI_START SERENITY FOCUS ENDURE DAMPEN
                    if ((%khriAVOIDANCE = 1) && ($SpellTimer.KhriAvoidance.active = 0) && (%khriELUSION = 1) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 100)) then gosub KHRI_START AVOIDANCE ELUSION ENDURE DAMPEN
                    if ((%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && (%khriSERENITY = 1) && ($SpellTimer.KhriSerenity.active = 0) && ($circle > 80)) then gosub KHRI_START ENDURE SERENITY DAMPEN
                    if ($SpellTimer.KhriDampen.active = 0) then gosub KHRI_START DAMPEN
               }
          if ((%khriINTIMIDATE = 1) && ($SpellTimer.KhriIntimidate.active = 0) && ($concentration > 70)) then gosub KHRI_START INTIMIDATE
          if ((%khriTERRIFY = 1) && ($SpellTimer.KhriTerrify.active = 0) && ($concentration > 70)) then gosub KHRI_START TERRIFY
          if ((%khriFRIGHT = 1) && ($SpellTimer.KhriFright.active = 0) && ($concentration > 70)) then gosub KHRI_START FRIGHT
          }
###### END COMBAT ONLY KHRI
###############################################################################################################################################################
### THESE KHRI CAN FIRE ALL THE TIME IF ENOUGH CONCENTRATION
KHRI11:
     if ((%khriFOCUS = 1) && ($SpellTimer.KhriFocus.active = 0) && ($concentration > 65)) then
          {
               if ((%khriHARRIER = 1) && ($SpellTimer.KhriHarrier.active = 0) && (%khriSAGACITY = 1) && ($SpellTimer.KhriSagacity.active = 0) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 100)) then gosub KHRI_START HARRIER ENDURE SAGACITY FOCUS
               if ((%khriAVOIDANCE = 1) && ($SpellTimer.KhriAvoidance.active = 0) && (%khriFOCUS = 1) && ($SpellTimer.KhriFocus.active = 0) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 100)) then gosub KHRI_START AVOIDANCE ENDURE FOCUS
               if ((%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && (%khriSERENITY = 1) && ($SpellTimer.KhriSerenity.active = 0) && ($circle > 80)) then gosub KHRI_START SERENITY FOCUS
               if ($SpellTimer.KhriFocus.active = 0) then gosub KHRI_START FOCUS
          }
KHRI12:
     if ((%khriSAGACITY = 1) && ($SpellTimer.KhriSagacity.active = 0) && ($concentration > 65)) then
          {
               if ((%khriSERENITY = 1) && ($SpellTimer.KhriSerenity.active = 0) && (%khriFOCUS = 1) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 100)) then gosub KHRI_START SERENITY FOCUS ENDURE SAGACITY
               if ((%khriAVOIDANCE = 1) && ($SpellTimer.KhriAvoidance.active = 0) && (%khriELUSION = 1) && (%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && ($circle > 100)) then gosub KHRI_START AVOIDANCE ELUSION ENDURE SAGACITY
               if ((%khriENDURE = 1) && ($SpellTimer.KhriEndure.active = 0) && (%khriSERENITY = 1) && ($SpellTimer.KhriSerenity.active = 0) && ($circle > 80)) then gosub KHRI_START ENDURE SERENITY SAGACITY
               if ($khriSAGACITY = 0) then gosub KHRI_START SAGACITY
          }
KHRI13:
#### OUT OF COMBAT - TOWN RUN ONLY KHRI
     if (%InCombat = 0) then
          {
               if ((%khriPLUNDER = 1) && ($SpellTimer.KhriPlunder.active = 0) && ($concentration > 70)) then gosub KHRI_START PLUNDER
               if ((%khriSAFE = 1) && ($SpellTimer.KhriSafe.active = 0) && ($concentration > 70)) then gosub KHRI_START SAFE
          }
KHRI14:
###############################################################################################################################################################
### CONTINUE KHRI THAT CAN RUN AT ANY TIME
     if ((%khriHARRIER = 1) && ($SpellTimer.KhriHarrier.active = 0) && ($concentration > 65)) then gosub KHRI_START HARRIER
     if ((%khriFLIGHT = 1) && ($SpellTimer.KhriFlight.active = 0) && ($concentration > 65)) then gosub KHRI_START FLIGHT
     if ((%khriCUNNING = 1) && ($SpellTimer.KhriCunning.active = 0) && ($concentration > 65)) then gosub KHRI_START CUNNING
     if ((%khriGUILE = 1) && ($SpellTimer.KhriGuile.active = 0) && ($concentration > 65)) then gosub KHRI_START GUILE
     if ((%khriSERENITY = 1) && ($SpellTimer.KhriSerenity.active = 0) && ($concentration > 65)) then gosub KHRI_START SERENITY
     if ((%khriDARKEN = 1) && ($SpellTimer.KhriDarken.active = 0) && ($concentration > 70)) then gosub KHRI_START DARKEN
     if ((%khriCALM = 1) && ($SpellTimer.KhriCalm.active = 0) && ($concentration > 70)) then gosub KHRI_START CALM
     if ((%khriCREDENCE = 1) && ($SpellTimer.KhriCredence.active = 0) && ($concentration > 70)) then gosub KHRI_START CREDENCE
     if ((%khriEVANESCENCE = 1) && ($SpellTimer.KhriEvanescence.active = 0) && ($concentration > 70)) then gosub KHRI_START EVANESCENCE
#################################################################################################################################################################
### DROP KHRI IF CONCENTRATION IS TOO LOW
# if ("$charactername" = "Shroom") && ($concentration < 50) then send touch my grey stone
     if ($concentration < 65) then
          {
               if (($SpellTimer.KhriCredence.active = 1) || ($khriINTIMIDATE = 1) || ($SpellTimer.KhriFright.active = 1) || ($SpellTimer.KhriSafe.active = 1) || ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP intimidate credence fright safe plunder
               if (($SpellTimer.KhriCredence.active = 1) && ($SpellTimer.KhriEvanescence.active = 1) && ($SpellTimer.KhriCalm.active = 1)) then gosub KHRI_STOP evanescence credence calm
               if (($SpellTimer.KhriCredence.active = 1) && ($SpellTimer.KhriFright.active = 1)) then gosub KHRI_STOP credence fright
               if ($SpellTimer.KhriCredence.active = 1) then gosub KHRI_STOP credence
          }
     if ($concentration < 60) then
          {
               if (($SpellTimer.KhriCalm.active = 1) || ($SpellTimer.KhriEvanescence.active = 1) || ($SpellTimer.KhriFright.active = 1) || ($SpellTimer.KhriSafe.active = 1) || ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP intimidate evanescence fright safe plunder
               if (($SpellTimer.KhriCredence.active = 1) && ($SpellTimer.KhriEvanescence.active = 1) && ($SpellTimer.KhriCalm.active = 1)) then gosub KHRI_STOP evanescence credence calm
               if (($SpellTimer.KhriCalm.active = 1) && ($SpellTimer.KhriEvanescence.active = 1)) then gosub KHRI_STOP evanescence calm
               if ($SpellTimer.KhriCalm.active = 1)  then gosub KHRI_STOP calm
          }
     if ($concentration < 55) then
          {
               if (%InCombat = 0) then
                    {
                         if (($SpellTimer.KhriTerrify.active = 1) || ($SpellTimer.KhriIntimidate.active = 1) || ($SpellTimer.KhriFright.active = 1) || ($SpellTimer.KhriSerenity.active = 1) || ($khriCALM = 1)) then gosub KHRI_STOP terrify intimidate fright serenity calm
                         if (($SpellTimer.KhriSagacity.active = 1) || ($SpellTimer.KhriFright.active = 1) || ($SpellTimer.KhriFlight.active = 1) || ($SpellTimer.KhriGuile.active = 1) || ($SpellTimer.KhriEndure.active = 1) || ($SpellTimer.KhriProwess.active = 1)) then gosub KHRI_STOP sagacity fright flight guile endure prowess
                         if ($SpellTimer.KhriProwess.active = 1) then gosub KHRI_STOP prowess
                         if ($SpellTimer.KhriElusion.active = 1) then gosub KHRI_STOP elusion
                         if ($SpellTimer.KhriHarrier.active = 1) then gosub KHRI_STOP harrier
                         if ($SpellTimer.KhriGuile.active = 1) then gosub KHRI_STOP guile
                         if ($SpellTimer.KhriEndure.active = 1) then gosub KHRI_STOP endure
                         if ($SpellTimer.KhriIntimidate.active = 1) then gosub KHRI_STOP intimidate
                         if ($SpellTimer.KhriFright.active = 1) then gosub KHRI_STOP fright
                         if ($SpellTimer.KhriStrike.active = 1) then gosub KHRI_STOP strike
                    }
               if (($SpellTimer.KhriSerenity.active = 1) || ($SpellTimer.KhriFright.active = 1) || ($SpellTimer.KhriCalm.active = 1) || ($SpellTimer.KhriEvanescence.active = 1)) then gosub KHRI_STOP serenity fright calm
               if (($SpellTimer.KhriCalm.active = 1) && ($SpellTimer.KhriEvanescence.active = 1) && ($SpellTimer.KhriFright.active = 1)) then gosub KHRI_STOP intimidate credence fright
               if (($SpellTimer.KhriSerenity.active = 1) && ($SpellTimer.KhriFright.active = 1)) then gosub KHRI_STOP serenity fright
               if (($SpellTimer.KhriFright.active = 1) && ($SpellTimer.KhriIntimidate.active = 1)) then gosub KHRI_STOP fright intimidate
               if ($SpellTimer.KhriIntimidate.active = 1) then gosub KHRI_STOP intimidate
               if ($SpellTimer.KhriMuse.active = 1) then gosub KHRI_STOP muse
               if ($SpellTimer.KhriFright.active = 1) then gosub KHRI_STOP fright
          }
     if ($concentration < 50) then
          {
               if (($SpellTimer.KhriFlight.active = 1) || ($SpellTimer.KhriHarrier.active = 1) || ($SpellTimer.KhriCredence.active = 1)) || ($SpellTimer.KhriEvanescence.active = 1) || ($SpellTimer.KhriCalm.active = 1)) then gosub KHRI_STOP flight harrier credence evanescence calm
               if (%InCombat = 0) then
                    {
                         if (($SpellTimer.KhriEndure.active = 1) || ($SpellTimer.KhriGuile.active = 1) || ($SpellTimer.KhriFright.active = 1)) || ($SpellTimer.KhriSagacity.active = 1) || ($SpellTimer.KhriHarrier.active = 1)) then gosub KHRI_STOP endure guile fright sagacity harrier
                    }
               if (%InCombat = 1) then
                    {
                         if (($SpellTimer.KhriSafe.active = 1) && ($SpellTimer.KhriPlunder.active = 1) && ($SpellTimer.KhriCredence.active = 1)) then gosub KHRI_STOP safe plunder credence
                         if (($SpellTimer.KhriSerenity.active = 1) && ($SpellTimer.KhriFright.active = 1) && ($SpellTimer.KhriSlight.active = 1)) then gosub KHRI_STOP serenity fright slight
                         if (($SpellTimer.KhriSafe.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP safe plunder
                         if (($SpellTimer.KhriCunning.active = 1) && ($SpellTimer.KhriFlight.active = 1)) then gosub KHRI_STOP cunning flight
                         if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriCredence.active = 1)) then gosub KHRI_STOP intimidate credence
                         if ($SpellTimer.KhriPlunder.active = 1) then gosub KHRI_STOP plunder
                         if ($SpellTimer.KhriSerenity.active = 1) then gosub KHRI_STOP serenity
                         if ($SpellTimer.KhriCredence.active = 1) then gosub KHRI_STOP credence
                         if ($SpellTimer.KhriIntimidate.active = 1) then gosub KHRI_STOP intimidate
                         if ($SpellTimer.KhriEvanescence.active = 1) then gosub KHRI_STOP evanescence
                         if ($SpellTimer.KhriFright.active = 1) then gosub KHRI_STOP fright
                         if ($SpellTimer.KhriSafe.active = 1) then gosub KHRI_STOP safe
                         if ($SpellTimer.KhriMuse.active = 1) then gosub KHRI_STOP muse
                         if ($SpellTimer.KhriSlight.active = 1) then gosub KHRI_STOP slight
                         if ($SpellTimer.KhriCunning.active = 1) then gosub KHRI_STOP cunning
                         if ($SpellTimer.khriAdaptation.active = 1) then gosub KHRI_STOP adaptation
                    }
               if (($SpellTimer.KhriSafe.active = 1) || ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP safe plunder
          }
     if ($concentration < 40) then
          {
               if (%InCombat = 0) then
                    {
                         if (($SpellTimer.KhriDarken.active = 1) || ($SpellTimer.KhriDampen.active = 1) || ($SpellTimer.KhriCunning.active = 1)) || ($SpellTimer.KhriShadowstep.active = 1) || ($SpellTimer.KhriHarrier.active = 1) || ($SpellTimer.KhriProwess.active = 1)) then gosub KHRI_STOP darken dampen cunning shadowstep harrier prowess
                         if (($SpellTimer.KhriElusion.active = 1) || ($SpellTimer.KhriSagacity.active = 1) || ($SpellTimer.KhriTerrify.active = 1)) || ($SpellTimer.KhriGuile.active = 1) || ($SpellTimer.KhriHarrier.active = 1) || ($SpellTimer.KhriProwess.active = 1)) then gosub KHRI_STOP elusion sagacity terrify guile harrier prowess
                         if (($SpellTimer.KhriElusion.active = 1) || ($SpellTimer.KhriAvoidance.active = 1) || ($SpellTimer.KhriProwess.active = 1) || ($SpellTimer.KhriIntimidate.active = 1) || ($SpellTimer.KhriHarrier.active = 1)) then gosub KHRI_STOP elusion avoidance prowess intimidate harrier
                         if (($SpellTimer.KhriSagacity.active = 1) || ($SpellTimer.KhriFright.active = 1) || ($SpellTimer.KhriFlight.active = 1) || ($SpellTimer.KhriGuile.active = 1) || ($SpellTimer.KhriEndure.active = 1)) then gosub KHRI_STOP sagacity fright flight guile endure
                         if (($SpellTimer.KhriTerrify.active = 1) && ($SpellTimer.KhriSagacity.active = 1) && ($SpellTimer.KhriProwess.active = 1)) then gosub KHRI_STOP terrify sagacity prowess
                         if (($SpellTimer.KhriElusion.active = 1) && ($SpellTimer.KhriHarrier.active = 1) && ($SpellTimer.KhriGuile.active = 1)) then gosub KHRI_STOP harrier elusion guile
                         if (($SpellTimer.KhriProwess.active = 1) && ($SpellTimer.KhriElusion.active = 1) && ($SpellTimer.KhriEndure.active = 1)) then gosub KHRI_STOP prowess elusion endure
                         if (($SpellTimer.KhriEndure.active = 1) && ($SpellTimer.KhriElusion.active = 1) && ($SpellTimer.KhriFlight.active = 1)) then gosub KHRI_STOP flight elusion endure
                         if (($SpellTimer.KhriFright.active = 1) && ($SpellTimer.KhriDarken.active = 1) && ($SpellTimer.KhriDampen.active = 1)) then gosub KHRI_STOP fright dampen dakren
                         if ($SpellTimer.KhriProwess.active = 1) then gosub KHRI_STOP prowess
                         if ($SpellTimer.KhriElusion.active = 1) then gosub KHRI_STOP elusion
                         if ($SpellTimer.KhriHarrier.active = 1) then gosub KHRI_STOP harrier
                         if ($SpellTimer.KhriGuile.active = 1) then gosub KHRI_STOP guile
                         if ($SpellTimer.KhriEndure.active = 1) then gosub KHRI_STOP endure
                         if ($SpellTimer.KhriIntimidate.active = 1) then gosub KHRI_STOP intimidate
                         if ($SpellTimer.KhriSagacity.active = 1) then gosub KHRI_STOP sagacity
                         if ($SpellTimer.KhriFright.active = 1) then gosub KHRI_STOP fright
                         if ($SpellTimer.KhriFlight.active = 1) then gosub KHRI_STOP flight
                         if ($SpellTimer.KhriStrike.active = 1) then gosub KHRI_STOP strike
                         if ($SpellTimer.khriAdaptation.active = 1) then gosub KHRI_STOP adaptation
                    }
               if (($SpellTimer.KhriDarken.active = 1) || ($SpellTimer.KhriDampen.active = 1) || ($SpellTimer.KhriCunning.active = 1)) || ($SpellTimer.KhriShadowstep.active = 1) || ($SpellTimer.KhriHarrier.active = 1) || ($SpellTimer.KhriProwess.active = 1)) then gosub KHRI_STOP darken dampen cunning shadowstep harrier prowess
               if (($SpellTimer.KhriEndure.active = 1) || ($SpellTimer.KhriGuile.active = 1) || ($SpellTimer.KhriFright.active = 1)) || ($SpellTimer.KhriSagacity.active = 1)) then gosub KHRI_STOP endure guile fright sagacity
               if (($SpellTimer.KhriSafe.active = 1) || ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP safe plunder
               if (%InCombat = 1) then
                    {
                         if (($SpellTimer.KhriDarken.active = 1) && ($SpellTimer.KhriCunning.active = 1) && ($SpellTimer.KhriDampen.active = 1)) then gosub KHRI_STOP cunning darken dampen
                         if (($SpellTimer.KhriFlight.active = 1) && ($SpellTimer.KhriCunning.active = 1) && ($SpellTimer.KhriDarken.active = 1)) then gosub KHRI_STOP flight cunning darken
                         if (($SpellTimer.KhriSafe.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP safe plunder
                         if (($SpellTimer.KhriDampen.active = 1) && ($SpellTimer.KhriGuile.active = 1)) then gosub KHRI_STOP guile dampen
                         if (($SpellTimer.KhriSlight.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP slight plunder
                         if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP intimidate plunder
                         if (($SpellTimer.KhriEvanescence.active = 1) && ($SpellTimer.KhriCredence.active = 1)) then gosub KHRI_STOP evanescence credence
                         if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriCredence.active = 1)) then gosub KHRI_STOP intimidate credence
                         if (($SpellTimer.KhriCunning.active = 1) && ($SpellTimer.KhriCredence.active = 1)) then gosub KHRI_STOP cunning credence
                         if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriCunning.active = 1)) then gosub KHRI_STOP intimidate cunning
                         if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP intimidate plunder
                         if (($SpellTimer.KhriSafe.active = 1) && ($SpellTimer.KhriSlight.active = 1)) then gosub KHRI_STOP safe slight
                         if (($SpellTimer.KhriDarken.active = 1) && ($SpellTimer.KhriDampen.active = 1)) then gosub KHRI_STOP darken dampen
                         if ($SpellTimer.khriAdaptation.active = 1) then gosub KHRI_STOP adaptation
                         if ($SpellTimer.KhriPlunder.active = 1) then gosub KHRI_STOP plunder
                         if ($SpellTimer.KhriCredence.active = 1) then gosub KHRI_STOP credence
                         if ($SpellTimer.KhriIntimidate.active = 1) then gosub KHRI_STOP intimidate
                         if ($SpellTimer.KhriEvanescence.active = 1) then gosub KHRI_STOP evanescence
                         if ($SpellTimer.KhriFright.active = 1) then gosub KHRI_STOP fright
                         if ($SpellTimer.KhriSafe.active = 1) then gosub KHRI_STOP safe
                         if ($SpellTimer.KhriMuse.active = 1) then gosub KHRI_STOP muse
                         if ($SpellTimer.KhriDarken.active = 1) then gosub KHRI_STOP darken
                         if ($SpellTimer.KhriCunning.active = 1) then gosub KHRI_STOP cunning
                         if ($SpellTimer.KhriSlight.active = 1) then gosub KHRI_STOP slight
                         if ($SpellTimer.KhriSensing.active = 1) then gosub KHRI_STOP sensing
                    }
          }
     if ($concentration < 30) then
          {
               if (($SpellTimer.KhriDarken.active = 1) && ($SpellTimer.KhriCunning.active = 1) && ($SpellTimer.KhriDampen.active = 1)) then gosub KHRI_STOP cunning darken dampen
               if (($SpellTimer.KhriFlight.active = 1) && ($SpellTimer.KhriCunning.active = 1) && ($SpellTimer.KhriDarken.active = 1)) then gosub KHRI_STOP flight cunning darken
               if (($SpellTimer.KhriTerrify.active = 1) && ($SpellTimer.KhriSagacity.active = 1) && ($SpellTimer.KhriProwess.active = 1)) then gosub KHRI_STOP terrify sagacity prowess
               if (($SpellTimer.KhriDampen.active = 1) && ($SpellTimer.KhriGuile.active = 1) && ($SpellTimer.KhriDarken.active = 1)) then gosub KHRI_STOP dampen guile darken
               if (($SpellTimer.KhriDampen.active = 1) && ($SpellTimer.KhriGuile.active = 1)) then gosub KHRI_STOP guile dampen
               if (($SpellTimer.KhriSafe.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP safe plunder
               if (($SpellTimer.KhriSlight.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP slight plunder
               if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP intimidate plunder
               if (($SpellTimer.KhriEvanescence.active = 1) && ($SpellTimer.KhriCredence.active = 1)) then gosub KHRI_STOP evanescence credence
               if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriCredence.active = 1)) then gosub KHRI_STOP intimidate credence
               if (($SpellTimer.KhriCunning.active = 1) && ($SpellTimer.KhriCredence.active = 1)) then gosub KHRI_STOP cunning credence
               if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriCunning.active = 1)) then gosub KHRI_STOP intimidate cunning
               if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP intimidate plunder
               if (($SpellTimer.KhriSafe.active = 1) && ($SpellTimer.KhriSlight.active = 1)) then gosub KHRI_STOP safe slight
               if (($SpellTimer.KhriCunning.active = 1) && ($SpellTimer.KhriGuile.active = 1)) then gosub KHRI_STOP cunning guile
               if (($SpellTimer.KhriFlight.active = 1) && ($SpellTimer.KhriDarken.active = 1)) then gosub KHRI_STOP darken flight
               if (($SpellTimer.KhriDampen.active = 1) && ($SpellTimer.KhriDarken.active = 1)) then gosub KHRI_STOP darken dampen
               if ($SpellTimer.khriAdaptation.active = 1) then gosub KHRI_STOP adaptation
               if ($SpellTimer.KhriPlunder.active = 1) then gosub KHRI_STOP plunder
               if ($SpellTimer.KhriCredence.active = 1) then gosub KHRI_STOP credence
               if ($SpellTimer.KhriIntimidate.active = 1) then gosub KHRI_STOP intimidate
               if ($SpellTimer.KhriEvanescence.active = 1) then gosub KHRI_STOP evanescence
               if ($SpellTimer.KhriFright.active = 1) then gosub KHRI_STOP fright
               if ($SpellTimer.KhriSafe.active = 1) then gosub KHRI_STOP safe
               if ($SpellTimer.KhriMuse.active = 1) then gosub KHRI_STOP muse
               if ($SpellTimer.KhriDarken.active = 1) then gosub KHRI_STOP darken
               if ($SpellTimer.KhriCunning.active = 1) then gosub KHRI_STOP cunning
               if ($SpellTimer.KhriSlight.active = 1) then gosub KHRI_STOP slight
               if ($SpellTimer.KhriSensing.active = 1) then gosub KHRI_STOP sensing
               if ($SpellTimer.KhriGuile.active = 1) then gosub KHRI_STOP guile
               if ($SpellTimer.KhriDampen.active = 1) then gosub KHRI_STOP dampen
          if (%InCombat = 0) then
               {
                    if (($SpellTimer.KhriDarken.active = 1) || ($SpellTimer.KhriDampen.active = 1) || ($SpellTimer.KhriCunning.active = 1)) || ($SpellTimer.KhriShadowstep.active = 1) || ($SpellTimer.KhriHarrier.active = 1) || ($SpellTimer.KhriProwess.active = 1)) then gosub KHRI_STOP darken dampen cunning shadowstep harrier prowess
                    if (($SpellTimer.KhriElusion.active = 1) || ($SpellTimer.KhriSagacity.active = 1) || ($SpellTimer.KhriTerrify.active = 1)) || ($SpellTimer.KhriGuile.active = 1) || ($SpellTimer.KhriHarrier.active = 1) || ($SpellTimer.KhriProwess.active = 1)) then gosub KHRI_STOP elusion sagacity terrify guile harrier prowess
                    if (($SpellTimer.KhriElusion.active = 1) || ($SpellTimer.KhriAvoidance.active = 1) || ($SpellTimer.KhriProwess.active = 1) || ($SpellTimer.KhriIntimidate.active = 1)) then gosub KHRI_STOP elusion avoidance prowess intimidate
                    if (($SpellTimer.KhriSagacity.active = 1) || ($SpellTimer.KhriFright.active = 1) || ($SpellTimer.KhriFlight.active = 1) || ($SpellTimer.KhriGuile.active = 1) || ($SpellTimer.KhriEndure.active = 1)) then gosub KHRI_STOP sagacity fright flight guile endure
                    if ($SpellTimer.KhriProwess.active = 1) then gosub KHRI_STOP prowess
                    if ($SpellTimer.KhriSteady.active = 1) then gosub KHRI_STOP steady
                    if ($SpellTimer.KhriHarrier.active = 1) then gosub KHRI_STOP harrier
                    if ($SpellTimer.KhriGuile.active = 1) then gosub KHRI_STOP guile
                    if ($SpellTimer.KhriEndure.active = 1) then gosub KHRI_STOP endure
               }
          }
     if ($concentration < 20) then
          {
               if (($SpellTimer.KhriFlight.active = 1) && ($SpellTimer.KhriCunning.active = 1) && ($SpellTimer.KhriDampen.active = 1)) then gosub KHRI_STOP cunning flight dampen
               if (($SpellTimer.KhriFlight.active = 1) && ($SpellTimer.KhriGuile.active = 1) && ($SpellTimer.KhriDarken.active = 1)) then gosub KHRI_STOP flight darken guile
               if (($SpellTimer.KhriHarrier.active = 1) && ($SpellTimer.KhriGuile.active = 1) && ($SpellTimer.KhriDarken.active = 1)) then gosub KHRI_STOP harrier darken guile
               if (($SpellTimer.KhriElusion.active = 1) || ($SpellTimer.KhriSagacity.active = 1) || ($SpellTimer.KhriTerrify.active = 1)) || ($SpellTimer.KhriGuile.active = 1) || ($SpellTimer.KhriHarrier.active = 1) || ($SpellTimer.KhriProwess.active = 1)) then gosub KHRI_STOP elusion sagacity terrify guile harrier prowess
               if (($SpellTimer.KhriSafe.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP safe plunder
               if (($SpellTimer.KhriFlight.active = 1) && ($SpellTimer.KhriDarken.active = 1)) then gosub KHRI_STOP darken flight
               if (($SpellTimer.KhriSlight.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP slight plunder
               if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP intimidate plunder
               if (($SpellTimer.KhriEvanescence.active = 1) && ($SpellTimer.KhriCredence.active = 1)) then gosub KHRI_STOP evanescence credence
               if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriCredence.active = 1)) then gosub KHRI_STOP intimidate credence
               if (($SpellTimer.KhriCunning.active = 1) && ($SpellTimer.KhriCredence.active = 1)) then gosub KHRI_STOP cunning credence
               if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriCunning.active = 1)) then gosub KHRI_STOP intimidate cunning
               if (($SpellTimer.KhriIntimidate.active = 1) && ($SpellTimer.KhriPlunder.active = 1)) then gosub KHRI_STOP intimidate plunder
               if (($SpellTimer.KhriSafe.active = 1) && ($SpellTimer.KhriSlight.active = 1)) then gosub KHRI_STOP safe slight
               if (($SpellTimer.KhriCunning.active = 1) && ($SpellTimer.KhriGuile.active = 1)) then gosub KHRI_STOP cunning guile
               if (($SpellTimer.KhriEndure.active = 1) && ($SpellTimer.KhriGuile.active = 1)) then gosub KHRI_STOP endure guile
               if (($SpellTimer.KhriFlight.active = 1) && ($SpellTimer.KhriDarken.active = 1)) then gosub KHRI_STOP darken flight
               if (($SpellTimer.KhriDampen.active = 1) && ($SpellTimer.KhriDarken.active = 1)) then gosub KHRI_STOP darken dampen
               if (($SpellTimer.KhriDarken.active = 1) && ($SpellTimer.KhriHarrier.active = 1)) then gosub KHRI_STOP darken harrier
               if (($SpellTimer.KhriDampen.active = 1) && ($SpellTimer.KhriHarrier.active = 1)) then gosub KHRI_STOP dampen harrier
               if ($SpellTimer.khriAdaptation.active = 1) then gosub KHRI_STOP adaptation
               if ($SpellTimer.KhriPlunder.active = 1) then gosub KHRI_STOP plunder
               if ($SpellTimer.KhriCredence.active = 1) then gosub KHRI_STOP credence
               if ($SpellTimer.KhriIntimidate.active = 1) then gosub KHRI_STOP intimidate
               if ($SpellTimer.KhriEvanescence.active = 1) then gosub KHRI_STOP evanescence
               if ($SpellTimer.KhriFright.active = 1) then gosub KHRI_STOP fright
               if ($SpellTimer.KhriSafe.active = 1) then gosub KHRI_STOP safe
               if ($SpellTimer.KhriMuse.active = 1) then gosub KHRI_STOP muse
               if ($SpellTimer.KhriDarken.active = 1) then gosub KHRI_STOP darken
               if ($SpellTimer.KhriCunning.active = 1) then gosub KHRI_STOP cunning
               if ($SpellTimer.KhriSlight.active = 1) then gosub KHRI_STOP slight
               if ($SpellTimer.KhriSensing.active = 1) then gosub KHRI_STOP sensing
               if ($SpellTimer.KhriGuile.active = 1) then gosub KHRI_STOP guile
               if ($SpellTimer.KhriDampen.active = 1) then gosub KHRI_STOP dampen
               if ($SpellTimer.KhriHarrier.active = 1) then gosub KHRI_STOP harrier
          }
     if (("$charactername" = "Shroom") && ($concentration < 20)) then
          {
               send touch my grey stone
               pause 0.2
          }
     return
KHRI_STOP:
     var KhriStop $1
     echo
     echo *** CONCENTRATION LOW ($concentration)- DROPPING %KhriStop
     echo
     pause 0.0001
     put khri stop %KhriStop
     pause 0.2
     pause 0.1
     pause 0.0001
     return
KHRI_START:
     var Khri1 $0
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if (matchre("%Khri1", "(?i)prowess") && ($Debilitation.Ranks < 80)) then goto KHRI_KNEEL
     if (matchre("%Khri1", "(?i)terrify") && ($Debilitation.Ranks < 80)) then goto KHRI_KNEEL
     if (matchre("%Khri1", "(?i)avoidance") && ($Augmentation.Ranks < 80)) then goto KHRI_KNEEL
     if (matchre("%Khri1", "(?i)plunder") && ($Augmentation.Ranks < 80)) then goto KHRI_KNEEL
     if (matchre("%Khri1", "(?i)darken") && ($Augmentation.Ranks < 60)) then goto KHRI_KNEEL
     if (matchre("%Khri1", "(?i)focus") && ($Augmentation.Ranks < 60)) then goto KHRI_KNEEL
     if (matchre("%Khri1", "(?i)sight") && ($Augmentation.Ranks < 60)) then goto KHRI_KNEEL
     if (matchre("%Khri1", "(?i)hasten") && ($Utility.Ranks < 80)) then goto KHRI_KNEEL
     if (matchre("%Khri1", "(?i)dampen") && ($Utility.Ranks < 80)) then goto KHRI_KNEEL
     if !matchre("%Khri1", "NULL") then goto KHRI_START_ALL
     else goto KHRI_START_1
KHRI_KNEEL:
     pause 0.0001
     send kneel
     pause 0.1
     pause 0.1
     if !matchre("%Khri1", "NULL") then goto KHRI_START_ALL
     else goto KHRI_START_1
KHRI_START_ALL:
     pause 0.0001
     matchre KHRI_START_ALL ^\.\.\.wait|^Sorry\,|^You are still stunned\.|^Please rephrase
     matchre KHRI_RETURN ^.*Roundtime\s*\:?|^.*\[Roundtime\s*\:?|^.*\(Roundtime\s*\:?
     matchre KHRI_RETURN ^You\'re already using the
     matchre KHRI_RETURN ^Your mind and body are willing\, but you feel you lack the skill to begin that khri\.
     matchre KHRI_START_ALL ^You attempt to blend a number of meditations to start simultaneously\, but you feel your skill is lacking to complete them all\.
     send khri %Khri1
     matchwait 2
     return
KHRI_START_1:
     delay 0.00001
     matchre KHRI_START_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre KHRI_RETURN ^.*Roundtime\s*\:?|^.*\[Roundtime\s*\:?|^.*\(Roundtime\s*\:?
     matchre KHRI_RETURN ^You\'re already using the
     matchre KHRI_RETURN ^Your mind and body are willing\, but you feel you lack the skill to begin that khri\.
     matchre KHRI_START_1 ^You attempt to blend a number of meditations to start simultaneously\, but you feel your skill is lacking to complete them all\.
     if !matchre("%Khri1", "NULL") then send khri %Khri1
     else goto KHRI_START_2
     matchwait 2
KHRI_START_2:
     delay 0.00001
     matchre KHRI_START_2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre KHRI_RETURN ^.*Roundtime\s*\:?|^.*\[Roundtime\s*\:?|^.*\(Roundtime\s*\:?
     matchre KHRI_RETURN ^You\'re already using the
     matchre KHRI_RETURN ^Your mind and body are willing\, but you feel you lack the skill to begin that khri\.
     matchre KHRI_START_2 ^You attempt to blend a number of meditations to start simultaneously\, but you feel your skill is lacking to complete them all\.
     if !matchre("%Khri2", "NULL") then send khri %Khri2
     matchwait 2
     if ($standing = 0) then gosub STAND
     pause 0.3
     return
KHRI_RETURN:
     pause 0.00001
     if ($standing = 0) then gosub STAND
     return
###############################
## BARB SUBS - BARBARIAN GOSUBS
###############################
BARB_VARS:
     var yogi 0
     var Templar 0
     var BarbBuffTime $gametime
     var DualWieldTime $gametime
     var RoarTime $gametime
     return
BARB_STRIP:
     unvar MM.Cyclics
     unvar MM.Cyclics.mana
     unvar MM.Buffs
     unvar MM.Augmentation.Spell
     unvar MM.Debilitation.Spell
     unvar MM.Target.Spell
     unvar MM.Utility.Spell
     unvar MM.Warding.Spell
     unvar MM.Sorcery.Spell
     unvar Paladin.Cyclics
     unvar Paladin.Cyclics.mana
     unvar Paladin.Buffs
     unvar Paladin.Augmentation.Spell
     unvar Paladin.Debilitation.Spell
     unvar Paladin.Target.Spell
     unvar Paladin.Utility.Spell
     unvar Paladin.Warding.Spell
     unvar Paladin.Sorcery.Spell
     unvar Empath.Cyclics
     unvar Empath.Cyclics.mana
     unvar Empath.Buffs
     unvar Empath.Augmentation.Spell
     unvar Empath.Debilitation.Spell
     unvar Empath.Target.Spell
     unvar Empath.Utility.Spell
     unvar Empath.Warding.Spell
     unvar Empath.Sorcery.Spell
     unvar Bard.Cyclics
     unvar Bard.Cyclics.mana
     unvar Bard.Buffs
     unvar Bard.Augmentation.Spell
     unvar Bard.Debilitation.Spell
     unvar Bard.Target.Spell
     unvar Bard.Utility.Spell
     unvar Bard.Warding.Spell
     unvar Bard.Sorcery.Spell
     unvar Cleric.Cyclics
     unvar Cleric.Cyclics.mana
     unvar Cleric.Buffs
     unvar Cleric.Augmentation.Spell
     unvar Cleric.Debilitation.Spell
     unvar Cleric.Target.Spell
     unvar Cleric.Utility.Spell
     unvar Cleric.Warding.Spell
     unvar Cleric.Sorcery.Spell
     unvar Necro.Cyclics
     unvar Necro.Cyclics.mana
     unvar Necro.Buffs
     unvar Necro.Augmentation.Spell
     unvar Necro.Debilitation.Spell
     unvar Necro.Target.Spell
     unvar Necro.Utility.Spell
     unvar Necro.Warding.Spell
     unvar Necro.Sorcery.Spell
     unvar Ranger.Cyclics
     unvar Ranger.Cyclics.mana
     unvar Ranger.Buffs
     unvar Ranger.Augmentation.Spell
     unvar Ranger.Debilitation.Spell
     unvar Ranger.Target.Spell
     unvar Ranger.Utility.Spell
     unvar Ranger.Warding.Spell
     unvar Ranger.Sorcery.Spell
     unvar WM.Cyclics
     unvar WM.Cyclics.mana
     unvar WM.Buffs
     unvar WM.Augmentation.Spell
     unvar WM.Debilitation.Spell
     unvar WM.Target.Spell
     unvar WM.Utility.Spell
     unvar WM.Warding.Spell
     unvar WM.Sorcery.Spell
     unvar Trader.Cyclics
     unvar Trader.Cyclics.mana
     unvar Trader.Buffs
     unvar Trader.Augmentation.Spell
     unvar Trader.Debilitation.Spell
     unvar Trader.Target.Spell
     unvar Trader.Utility.Spell
     unvar Trader.Warding.Spell
     unvar Trader.Sorcery.Spell
     unvar Sorcery.Camb
     unvar Sorcery.Focus
     unvar Sorcery.Mana
     unvar Sorcery.Symbiosis
     unvar SorceryMastery
     unvar Utility.Camb
     unvar Utility.Focus
     unvar Utility.Mana
     unvar Utility.Symbiosis
     unvar UtilityMastery
     unvar Warding.Camb
     unvar Warding.Focus
     unvar Warding.Mana
     unvar Warding.Symbiosis
     unvar WardingMastery
     unvar Target.Camb
     unvar Target.Focus
     unvar Target.Mana
     unvar Target.Symbiosis
     unvar TargetMastery
     unvar Debilitation.Camb
     unvar Debilitation.Mana
     unvar Debilitation.Symbiosis
     unvar DebilitationMastery
     unvar Augmentation.Camb
     unvar Augmentation.Mana
     unvar Augmentation.Symbiosis
     unvar AugmentationMastery
     unvar ChargeSpell
     unvar CFB.Mana
     unvar QE.Mana
     return
NOT_BARB_STRIP:
NON_BARB_STRIP:
     unvar barbBadger
     unvar barbBear
     unvar barbBuffalo
     unvar barbDragon
     unvar barbEagle
     unvar barbMonkey
     unvar barbOwl
     unvar barbPanther
     unvar barbPiranha
     unvar barbPython
     unvar barbSwan
     unvar barbToad
     unvar barbTurtle
     unvar barbWolverine
     unvar zerkAvalanche
     unvar zerkCyclone
     unvar zerkEarthquake
     unvar zerkFamine
     unvar zerkFlashflood
     unvar zerkLandslide
     unvar zerkTornado
     unvar zerkTsunami
     unvar zerkWildfire
     unvar zerkDrought
     unvar roarAnger
     unvar roarEmbrace
     unvar roarEverild
     unvar roarKuniyo
     unvar roarScreech
     unvar roarShriek
     unvar roarWail
     return
###############################
# BARBARIAN BUFFS
###############################
MEDITATE_CHECK:
     var yogi 0
     var Templar 0
     action var yogi 1 when Yogi
     action var Templar 1 when Templar
     pause 0.0001
     put mastery list
     matchwait 4
     action remove Yogi
     action remove Templar
     return
BARB_START:
     var abilityStarted 0
     action var abilityStarted 1 when ^But you are already practicing that form\!|But you are already enraged with that berserk\.
     pause 0.0001
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.0001
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then gosub STAND
     pause 0.0001
     put meditate power
     pause 0.7
     pause 0.3
     pause 0.0001
     pause 0.0001
     if (%Playing = 1) then gosub STOP_PLAY
     if (($mana > 5) && matchre("%zerkDrought", "(ON|1|YES)") && ($zerkDrought = 0)) then
          {
               var abilityStarted 0
               send berserk drought
               pause 0.5
               if (%abilityStarted = 1) then put #var zerkDrought 1
          }
     if (($mana > 5) && ($circle < 12) && matchre("%zerkAvalanche", "(ON|1|YES)") && ($zerkAvalanche = 0)) then
          {
               var abilityStarted 0
               send berserk avalanche
               pause 0.5
               if (%abilityStarted = 1) then put #var zerkAvalanche 1
          }
     if (($mana > 5) && ($stamina < 95) && matchre("%zerkAvalanche", "(ON|1|YES)") && ($zerkAvalanche = 0)) then
          {
               var abilityStarted 0
               send berserk avalanche
               pause 0.5
               if (%abilityStarted = 1) then put #var zerkAvalanche 1
          }
     if (($mana > 5) && matchre("%zerkCyclone", "(ON|1|YES)") && ($zerkCyclone = 0)) then
          {
               var abilityStarted 0
               send berserk cyclone
               pause 0.5
               if (%abilityStarted = 1) then put #var zerkCyclone 1
          }
     if (($mana > 5) && matchre("%zerkFamine", "(ON|1|YES)") && ($zerkFamine = 0)) then
          {
               var abilityStarted 0
               send berserk famine
               pause 0.5
               if (%abilityStarted = 1) then put #var zerkEarthquake 1
          }
     if (($mana > 5) && matchre("%zerkWildfire", "(ON|1|YES)") && ($zerkWildfire = 0)) then
          {
               var abilityStarted 0
               send berserk wildfire
               pause 0.5
               if (%abilityStarted = 1) then put #var zerkWildfire 1
          }
     if (($mana > 5) && matchre("%zerkLandslide", "(ON|1|YES)") && ($zerkLandslide = 0)) then
          {
               var abilityStarted 0
               send berserk landslide
               pause 0.5
               if (%abilityStarted = 1) then put #var zerkLandslide 1
          }
     if (($mana > 5) && matchre("%zerkTsunami", "(ON|1|YES)") && ($zerkTsunami = 0)) then
          {
               var abilityStarted 0
               send berserk tsunami
               pause 0.5
               if (%abilityStarted = 1) then put #var zerkTsunami 1
          }
     if (($mana > 5) && matchre("%zerkEarthquake", "(ON|1|YES)") && ($zerkEarthquake = 0)) then
          {
               var abilityStarted 0
               send berserk earthquake
               pause 0.5
               if (%abilityStarted = 1) then put #var zerkEarthquake 1
          }
     if (($mana > 5) && matchre("%zerkFlashflood", "(ON|1|YES)") && ($zerkFlashflood = 0)) then
          {
               var abilityStarted 0
               send berserk flash flood
               pause 0.5
               if (%abilityStarted = 1) then put #var zerkFlashflood 1
          }
     if (($mana > 5) && matchre("%zerkTornado", "(ON|1|YES)") && ($zerkTornado = 0)) then
          {
               var abilityStarted 0
               send berserk tornado
               pause 0.5
               if (%abilityStarted = 1) then put #var zerkTornado 1
          }
     if (($stamina > 98) && ($zerkAvalanche = 1)) then put berserk stop avalanche
     # MELEE
     if ((%ranged = 1) && ($barbDragon = 1)) then gosub PUT form stop dragon
     if ((%melee = 1) && ($barbEagle = 1)) then gosub PUT form stop eagle
     if (($barbPanther = 1) && (%melee = 1)) && ($mana < 5)) then gosub PUT form stop panther
     if (($barbBadger = 1) && (%melee = 1)) && ($mana < 5)) then gosub PUT form stop badger
     if (matchre("%barbMonkey", "(ON|1|YES)") && ($barbMonkey = 0) && ($mana > 3)) then
          {
               var abilityStarted 0
               gosub PUT form monkey
               pause 0.5
               if (%abilityStarted = 1) then put #var barbMonkey 1
          }
     if (matchre("%barbPython", "(ON|1|YES)") && ($barbPython = 0) && ($mana > 3)) then
          {
               var abilityStarted 0
               send form python
               pause 0.5
               if (%abilityStarted = 1) then put #var barbPython 1
          }
     if (matchre("%barbBuffalo", "(ON|1|YES)") && ($barbBuffalo = 0) && ($mana > 3)) then
          {
               var abilityStarted 0
               send form buffalo
               pause 0.5
               if (%abilityStarted = 1) then put #var barbBuffalo 1
          }
     if (matchre("%barbDragon", "(ON|1|YES)") && ($barbDragon = 0) && (%melee = 1) && ($mana > 3)) then
          {
               var abilityStarted 0
               gosub PUT form dragon
               pause 0.5
               if (%abilityStarted = 1) then put #var barbDragon 1
          }
     if (matchre("%barbPiranha", "(ON|1|YES)") && ($barbPiranha = 0) && ($circle > 50) && ($mana > 3)) then
          {
               var abilityStarted 0
               gosub PUT form piranha
               pause 0.5
               if (%abilityStarted = 1) then put #var barbPiranha 1
          }
     if ((matchre("%barbTurtle", "(ON|1|YES)") && ($barbTurtle = 0) && (%melee = 1) && ($circle > 50) && ($mana > 3)) then
          {
               var abilityStarted 0
               gosub PUT form turtle
               pause 0.5
               if (%abilityStarted = 1) then put #var barbTurtle 1
          }
     ## RANGED
     if ((($barbDragon = 1) && (%ranged = 1)) || (($barbDragon = 1) && ($mana < 3))) then gosub PUT form stop dragon
     if (matchre("%barbEagle", "(ON|1|YES)") && ($barbEagle = 0) && (%ranged = 1) && ($mana > 2)) then
          {
               var abilityStarted 0
               gosub PUT form eagle
               pause 0.5
               if (%abilityStarted = 1) then put #var barbEagle 1
          }
     if (matchre("%barbPanther", "(ON|1|YES)") && ($barbPanther = 0) && ($mana > 3)) then
          {
               var abilityStarted 0
               gosub PUT form panther
               pause 0.5
               if (%abilityStarted = 1) then put #var barbPanther 1
          }
     if (matchre("%barbBadger", "(ON|1|YES)") && ($barbBadger = 0) && ($circle > 50) && ($mana > 3)) then
          {
               var abilityStarted 0
               gosub PUT form badger
               pause 0.5
               if (%abilityStarted = 1) then put #var barbBadger 1
          }
     if (matchre("%barbSwan", "(ON|1|YES)") && ($barbSwan = 0) && ($innerFire > 1) && ($mana > 3)) then
          {
               var abilityStarted 0
               gosub PUT form swan
               pause 0.5
               if (%abilityStarted = 1) then put #var barbSwan 1
          }
     if (($Warding.LearningRate > 33) && ($barbSwan = 1)) then send form stop swan
     # MISC
     if (matchre("%barbBear", "(ON|1|YES)") && ($barbBear = 0) && ($mana > 3)) then
          {
               var abilityStarted 0
               gosub PUT form bear
               pause 0.5
               if (%abilityStarted = 1) then put #var barbBear 1
          }
     pause 0.0001
     pause 0.0001
     if ($Warding.LearningRate < 31) then
          {
               put meditate research turtle
               pause 0.5
               goto MEDITATE
          }
     if ($Augmentation.LearningRate < 31) then
          {
               put meditate research panther
               pause 0.5
               goto MEDITATE
          }
     #### MEDITATIONS
MEDITATE:
     if (%Playing = 1) then gosub STOP_PLAY
     if (%yogi = 1) then
          {
               if (($medTenacity = 0) && (%medTenacity = 1) && ($mana > 6)) then
                    {
                         put meditate tenacity
                         pause 0.5
                         pause 0.0001
                    }
               if (($medSerenity = 0) && (%medSerenity = 1) && ($mana > 6)) then
                    {
                         put meditate serenity
                         pause 0.5
                         pause 0.0001
                    }
               if (($medContemplation = 0) && (%medContemplation = 1) && ($mana > 6)) then
                    {
                         put meditate contemplation
                         pause 0.5
                         pause 0.0001
                    }
          }
     pause 0.0001
     var BarbBuffTime $gametime
     action remove ^But you are already practicing that form\!|But you are already enraged with that berserk\.
     if ($standing = 0) then gosub STAND
     unvar abilityStarted
     return
ROAR:
     pause 0.0001
     if ($standing = 0) then gosub STAND
     if ((%roarAnger) && ($Debilitation.LearningRate < 32) && ($hidden = 0)) then
          {
               put roar quiet anger
               pause 0.5
               pause 0.0001
               return
          }
     if ((%roarScreech) && ($Debilitation.LearningRate < 32) && ($hidden = 0)) then
          {
               put roar quiet screech
               pause 0.5
               pause 0.0001
               return
          }
     if ((%roarShriek) && ($Debilitation.LearningRate < 32) && ($hidden = 0)) then
          {
               put roar quiet shriek
               pause 0.5
               pause 0.0001
               return
          }
     if ((%roarEverild) && ($Debilitation.LearningRate < 32) && ($hidden = 0)) then
          {
               put roar quiet everild
               pause 0.5
               pause 0.0001
               return
          }
     if ((%roarEmbrace) && ($Debilitation.LearningRate < 32) && ($hidden = 0)) then
          {
               put roar quiet embrace
               pause 0.5
               pause 0.0001
               return
          }
     if ((%roarWail) && ($Debilitation.LearningRate < 32) && ($hidden = 0)) then
          {
               put roar quiet wail
               pause 0.5
               pause 0.0001
               return
          }
     if ((%roarKuniyo) && ($Debilitation.LearningRate < 32) && ($hidden = 0)  && ($mana > 1)) then
          {
               put roar quiet kuniyo
               pause 0.5
               pause 0.0001
               return
          }
     return
#### DUAL WIELDING LOGIC
DW_CHECK:
     if matchre("$UC_WeaponType", "(OFFHAND|THE|THB|BOW|SLINGS|XBOW|CROSSBOW|POLEARMS)") then return
     gosub DUALWIELD_TIMER
     return
DW_SWITCH:
     # echo *** TURNING DEBUG ON FOR BARB DUAL WIELD
     # debug 10
     var whirlreset 0
     echo
     echo ##########################
     echo ** SWITCHING BARB DUAL WIELD WEAPON
     echo ##########################
     echo
     if ("$guild" = "Barbarian") then
          {
               var whirlweapons Small_Blunt|Large_Blunt|Small_Edged|Large_Edged|Staves|Polearms
          }
     if ("$guild" != "Barbarian") then
          {
               var whirlweapons Small_Blunt|Small_Edged|Staves
          }
     gosub DW_REMOVE
     if !matchre("%STAVES", "(?i)\b(club|cane|(croupier'?s|walking|gnarled|kneecapping) stick|femur|fan|handle|(herder'?s|short) staff|jawbone|kneecapper|loaf|nightstick|prybar|shillelagh|shortstaff|spear|tanbo|tonfa|truncheon|wrench|NULL)") then
          {
               echo
               echo ##################################################
               echo ** STAVE WEAPON IS NOT RECOGNIZED AS 1-HANDED WEAPON FOR DUAL-WIELD- %STAVES
               echo ** IF THIS IS AN ERROR SEND ME THE NAME OF THE WEAPON
               echo ** Removing Staves from Dual Wield Weapons
               echo ##################################################
               echo
               eval whirlweapons replace("%whirlweapons", "Staves", "")
               pause 0.3
               gosub DW_CLEANUP
          }
     if !matchre("%POLEARMS", "(?i)(allarh|hunthsleg|javelin|light spear|witchclaw pilum|NULL)") then
          {
               echo
               echo ##################################################
               echo ** POLEARM WEAPON IS NOT RECOGNIZED AS 1-HANDED WEAPON FOR DUAL-WIELD - %POLEARMS
               echo ** IF THIS IS AN ERROR SEND ME THE NAME OF THE WEAPON
               echo ** Removing Polearms from Dual Wield Weapons
               echo ##################################################
               echo
               eval whirlweapons replace("%whirlweapons", "Polearms", "")
               pause 0.3
               gosub DW_CLEANUP
          }
     eval whirlweapons replace("%whirlweapons", "%LEARNING", "")
     gosub DW_CLEANUP
     eval whirltotal count("%whirlweapons", "|")
     var whirlcount 0
     var low.whirl %whirlweapons(0)
WHIRLPICK_1:
    delay 0.0001
     if (%whirlcount <= %whirltotal) then
          {
               if ($%whirlweapons(%whirlcount).LearningRate < $%low.whirl.LearningRate) then var low.whirl %whirlweapons(%whirlcount)
               math whirlcount add 1
               goto whirlpick_1
          }
     if matchre("%weapon.%low.whirl", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               if (%whirlreset = 0) then
                    {
                         var whirlcount 0
                         var whirlreset 1
                         goto WHIRLPICK_1
                    }
               unvar whirlreset
               return
          }
     if ("%CurrentDW" = "NULL") then return
     echo
     echo *** Barb Dual-Wield Weapon: %weapon.%low.whirl
     echo
     var CurrentDW %weapon.%low.whirl
     if !matchre("%CurrentDW", "$lefthand") then gosub STOWIT $lefthandnoun
     gosub WIELD_LEFT %weapon.%low.whirl
     delay 0.1
     if matchre("%CurrentDW", "$UC_ALLSWAPPABLE") then goto WHIRLSWAP
     unvar whirlreset
     unvar whirlweapons
     unvar whirlcount
     unvar low.whirl
     return
DW_REMOVE:
     var DWCOUNT 0
DW_REMOVE_1:
     if (%DWCOUNT < 6) then
          {
               if matchre("%weapon.%whirlweapons(%DWCOUNT)", "(?i)(NULL|OFF)") then
                    {
                         eval whirlweapons replace("%whirlweapons", "%whirlweapons(%DWCOUNT)", "")
                         gosub DW_CLEANUP
                         math DWCOUNT add 1
                         goto DW_REMOVE_1
                    }
               math DWCOUNT add 1
               goto DW_REMOVE_1
          }
     return
DW_CLEANUP:
     eval whirlweapons replacere("%whirlweapons", "\|+", "|")
     eval whirlweapons replacere("%whirlweapons", "^\|", "")
     eval whirlweapons replacere("%whirlweapons", "\|$", "")
     return
WHIRLSWAP:
     var LOCATION WHIRLSWAP
     delay 0.001
     delay 0.001
     matchre WHIRLSWAP ^\.\.\.wait|^Sorry\,|^You are still stunned\.|you don't feel like fighting
     matchre DW_RETURN ^You must have two free hands
     matchre WHIRLSWAP two\-handed|two handed|twohanded
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WHIRLOPEN ^You'll need to open or close
     matchre DW_RETURN ^(?:The|You|With|Your(?! eyes blaze)|Stepping|Silver|switch|shift) .* (?:it|a|and) (.*)
     matchre DW_RETURN ^(?:Poised) .* (?:it|a) (.*) and .*
     matchre DW_RETURN ^(?:With|Your) .* (?:it|as?|and) (.*) (on|in front of) your (?:\S+).
     matchre DW_RETURN ^(?:You (?:switch|deftly)) .* (?:a)? (.*) (?:a|and) (.*)\.
     matchre DW_RETURN ^You turn
     matchre DW_RETURN ^Please rephrase|^What were
     put swap my %CurrentDW
     matchwait 9
     return
WHIRLOPEN:
     delay 0.0001
     put open my %CurrentDW
     pause 0.0001
     goto WHIRLSWAP

DW_RETURN:
     put #var UC_swappable-state NULL
     # debug 0
     unvar whirlreset
     unvar whirlweapons
     unvar whirlcount
     unvar low.whirl
     return
###############################################
### RANGER SUBS - RANGER GOSUBS
###############################################
RANGER_VARS:
     return
RANGER_STRIP:
     unvar MM.Cyclics
     unvar MM.Cyclics.mana
     unvar MM.Buffs
     unvar MM.Augmentation.Spell
     unvar MM.Debilitation.Spell
     unvar MM.Target.Spell
     unvar MM.Utility.Spell
     unvar MM.Warding.Spell
     unvar MM.Sorcery.Spell
     unvar Paladin.Cyclics
     unvar Paladin.Cyclics.mana
     unvar Paladin.Buffs
     unvar Paladin.Augmentation.Spell
     unvar Paladin.Debilitation.Spell
     unvar Paladin.Target.Spell
     unvar Paladin.Utility.Spell
     unvar Paladin.Warding.Spell
     unvar Paladin.Sorcery.Spell
     unvar Necro.Cyclics
     unvar Necro.Cyclics.mana
     unvar Necro.Buffs
     unvar Necro.Augmentation.Spell
     unvar Necro.Debilitation.Spell
     unvar Necro.Target.Spell
     unvar Necro.Utility.Spell
     unvar Necro.Warding.Spell
     unvar Necro.Sorcery.Spell
     unvar Empath.Cyclics
     unvar Empath.Cyclics.mana
     unvar Empath.Buffs
     unvar Empath.Augmentation.Spell
     unvar Empath.Debilitation.Spell
     unvar Empath.Target.Spell
     unvar Empath.Utility.Spell
     unvar Empath.Warding.Spell
     unvar Empath.Sorcery.Spell
     unvar Cleric.Cyclics
     unvar Cleric.Cyclics.mana
     unvar Cleric.Buffs
     unvar Cleric.Augmentation.Spell
     unvar Cleric.Debilitation.Spell
     unvar Cleric.Target.Spell
     unvar Cleric.Utility.Spell
     unvar Cleric.Warding.Spell
     unvar Cleric.Sorcery.Spell
     unvar Bard.Cyclics
     unvar Bard.Cyclics.mana
     unvar Bard.Buffs
     unvar Bard.Augmentation.Spell
     unvar Bard.Debilitation.Spell
     unvar Bard.Target.Spell
     unvar Bard.Utility.Spell
     unvar Bard.Warding.Spell
     unvar Bard.Sorcery.Spell
     unvar WM.Cyclics
     unvar WM.Cyclics.mana
     unvar WM.Buffs
     unvar WM.Augmentation.Spell
     unvar WM.Debilitation.Spell
     unvar WM.Target.Spell
     unvar WM.Utility.Spell
     unvar WM.Warding.Spell
     unvar WM.Sorcery.Spell
     unvar Trader.Cyclics
     unvar Trader.Cyclics.mana
     unvar Trader.Buffs
     unvar Trader.Augmentation.Spell
     unvar Trader.Debilitation.Spell
     unvar Trader.Target.Spell
     unvar Trader.Utility.Spell
     unvar Trader.Warding.Spell
     unvar Trader.Sorcery.Spell
     return
###############################################
### BARD SUBS - BARD GOSUBS
###############################################
BARD_VARS:
     var Bard.Whistle ON
     var Bard.Scream ON
     var ScreamTime $gametime
     var WhistleTime $gametime
     return
BARD_STRIP:
     unvar MM.Cyclics
     unvar MM.Cyclics.mana
     unvar MM.Buffs
     unvar MM.Augmentation.Spell
     unvar MM.Debilitation.Spell
     unvar MM.Target.Spell
     unvar MM.Utility.Spell
     unvar MM.Warding.Spell
     unvar MM.Sorcery.Spell
     unvar Paladin.Cyclics
     unvar Paladin.Cyclics.mana
     unvar Paladin.Buffs
     unvar Paladin.Augmentation.Spell
     unvar Paladin.Debilitation.Spell
     unvar Paladin.Target.Spell
     unvar Paladin.Utility.Spell
     unvar Paladin.Warding.Spell
     unvar Paladin.Sorcery.Spell
     unvar Necro.Cyclics
     unvar Necro.Cyclics.mana
     unvar Necro.Buffs
     unvar Necro.Augmentation.Spell
     unvar Necro.Debilitation.Spell
     unvar Necro.Target.Spell
     unvar Necro.Utility.Spell
     unvar Necro.Warding.Spell
     unvar Necro.Sorcery.Spell
     unvar Empath.Cyclics
     unvar Empath.Cyclics.mana
     unvar Empath.Buffs
     unvar Empath.Augmentation.Spell
     unvar Empath.Debilitation.Spell
     unvar Empath.Target.Spell
     unvar Empath.Utility.Spell
     unvar Empath.Warding.Spell
     unvar Empath.Sorcery.Spell
     unvar Cleric.Cyclics
     unvar Cleric.Cyclics.mana
     unvar Cleric.Buffs
     unvar Cleric.Augmentation.Spell
     unvar Cleric.Debilitation.Spell
     unvar Cleric.Target.Spell
     unvar Cleric.Utility.Spell
     unvar Cleric.Warding.Spell
     unvar Cleric.Sorcery.Spell
     unvar Ranger.Cyclics
     unvar Ranger.Cyclics.mana
     unvar Ranger.Buffs
     unvar Ranger.Augmentation.Spell
     unvar Ranger.Debilitation.Spell
     unvar Ranger.Target.Spell
     unvar Ranger.Utility.Spell
     unvar Ranger.Warding.Spell
     unvar Ranger.Sorcery.Spell
     unvar WM.Cyclics
     unvar WM.Cyclics.mana
     unvar WM.Buffs
     unvar WM.Augmentation.Spell
     unvar WM.Debilitation.Spell
     unvar WM.Target.Spell
     unvar WM.Utility.Spell
     unvar WM.Warding.Spell
     unvar WM.Sorcery.Spell
     unvar Trader.Cyclics
     unvar Trader.Cyclics.mana
     unvar Trader.Buffs
     unvar Trader.Augmentation.Spell
     unvar Trader.Debilitation.Spell
     unvar Trader.Target.Spell
     unvar Trader.Utility.Spell
     unvar Trader.Warding.Spell
     unvar Trader.Sorcery.Spell
     return
###############################
### BARD SCREAMS
###############################
SCREAM:
     pause 0.0001
     var LOCATION SCREAM_1
     var screamtype concuss
     if ($standing = 0) then gosub STAND
     if ($circle < 2) then return
     random 1 3
     if (%r = 1) then var screamtype concuss
     if (%r = 2) then var screamtype havoc
     if (%r = 3) && ($circle > 34) then var screamtype defiance
     if (%r = 3) && ($circle <= 34) then var screamtype concuss
     SCREAM_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^You have used this scream recently\, and must wait a few more seconds to use it again\.
     matchre RETURN ^You open your mouth\, then close it suddenly\, looking somewhat like a fish\.
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RETURN ^Scream at what\?
     matchre RETURN ^Please rephrase|^What were
     send scream %screamtype
     matchwait 2
     return
RESONANCE_PREP:
     pause 0.0001
     gosub stowing
     if !matchre("%SBWEAPON", "(?i)(NULL|OFF|^%|^\s*$)") then var RESONANCE.WEAPON %SBWEAPON
     if !matchre("%LBWEAPON", "(?i)(NULL|OFF|^%|^\s*$)") then var RESONANCE.WEAPON %LBWEAPON
     if !matchre("%THBWEAPON", "(?i)(NULL|OFF|^%|^\s*$)") then var RESONANCE.WEAPON %THBWEAPON
     if !matchre("%STAVES", "(?i)(NULL|OFF|^%|^\s*$)") then var RESONANCE.WEAPON %STAVES
     if !matchre("%POLEARMS", "(?i)(NULL|OFF|^%|^\s*$)") then var RESONANCE.WEAPON %POLEARMS
     if !matchre("%LTWEAPON", "(?i)(NULL|OFF|^%|^\s*$)") then var RESONANCE.WEAPON %LTWEAPON
     if !matchre("%HTWEAPON", "(?i)(NULL|OFF|^%|^\s*$)") then var RESONANCE.WEAPON %HTWEAPON
     if !matchre("%LEWEAPON", "(?i)(NULL|OFF|^%|^\s*$)") then var RESONANCE.WEAPON %LEWEAPON
     if !matchre("%THEWEAPON", "(?i)(NULL|OFF|^%|^\s*$)") then var RESONANCE.WEAPON %THEWEAPON
     if !matchre("%SEWEAPON", "(?i)(NULL|OFF|^%|^\s*$)") then var RESONANCE.WEAPON %SEWEAPON
     if ("%WEAPON" = "NULL") then var WEAPON %RESONANCE.WEAPON
     return
WHISTLE:
     pause 0.0001
     var LOCATION WHISTLE
     if ($standing = 0) then gosub STAND
     WHISTLE_1:
     pause 0.0001
     send whistle piercing
     pause 0.4
     pause 0.0001
     pause 0.0001
     return
### BARB AND BARD WARHORN
WARHORN:
     var temp NULL
     pause 0.0001
     if ($standing = 0) then gosub STAND
     if !matchre("$lefthand", "Empty") then
          {
               var temp $lefthandnoun
               gosub STOW $lefthandnoun
          }
     pause 0.0001
     put get my warhorn
     wait
     pause 0.0001
     pause 0.0001
     if !matchre("$righthand $lefthand", "warhorn") then
          {
               put get warhorn from my watery portal
               pause 0.3
          }
     if !matchre("$righthand $lefthand", "warhorn") then
          {
               put remove my warhorn
               pause 0.5
          }
     pause 0.0001
     pause 0.0001
     if ("$guild" = "Bard") then send exhale warhorn warn
     if ("$guild" = "Barbarian") then send exhale warhorn lure
     pause 2
     pause 0.0001
     pause 0.0001
     if matchre("$righthand $lefthand", "warhorn") then gosub WEAR warhorn
     pause 0.2
     if matchre("$righthand $lefthand", "warhorn") then gosub STOWIT warhorn
     pause 0.3
     if matchre("$righthand $lefthand", "warhorn") then send stow warhorn
     pause 0.2
     if ("%temp" != "NULL") then send get my %temp
     pause 0.0001
     pause 0.0001
     unvar temp
     return
##############################
# EMPATH SUBS - EMPATH GOSUBS
##############################
EMPATH_VARS:
     var ABSOLUTION 0
     var Construct.Only ON
     var Manipulate OFF
     var Empathy.Escape OFF
     var Guardian.Spirit OFF
     var Guardian.Custom OFF
     var Empath.Brawl 0
     var Empath.Critter NULL
     var Empath.Walk ON
     var TeachClass Evasion
     var Unity OFF
     var ParalysisTime $gametime
     var NissaTime $gametime
     var ManipulateTime $gametime
     var GSTime $gametime
     var PHealthTime $gametime
     return
EMPATH_STRIP:
     unvar MM.Cyclics
     unvar MM.Cyclics.mana
     unvar MM.Buffs
     unvar MM.Augmentation.Spell
     unvar MM.Debilitation.Spell
     unvar MM.Target.Spell
     unvar MM.Utility.Spell
     unvar MM.Warding.Spell
     unvar MM.Sorcery.Spell
     unvar Paladin.Cyclics
     unvar Paladin.Cyclics.mana
     unvar Paladin.Buffs
     unvar Paladin.Augmentation.Spell
     unvar Paladin.Debilitation.Spell
     unvar Paladin.Target.Spell
     unvar Paladin.Utility.Spell
     unvar Paladin.Warding.Spell
     unvar Paladin.Sorcery.Spell
     unvar Necro.Cyclics
     unvar Necro.Cyclics.mana
     unvar Necro.Buffs
     unvar Necro.Augmentation.Spell
     unvar Necro.Debilitation.Spell
     unvar Necro.Target.Spell
     unvar Necro.Utility.Spell
     unvar Necro.Warding.Spell
     unvar Necro.Sorcery.Spell
     unvar Bard.Cyclics
     unvar Bard.Cyclics.mana
     unvar Bard.Buffs
     unvar Bard.Augmentation.Spell
     unvar Bard.Debilitation.Spell
     unvar Bard.Target.Spell
     unvar Bard.Utility.Spell
     unvar Bard.Warding.Spell
     unvar Bard.Sorcery.Spell
     unvar Cleric.Cyclics
     unvar Cleric.Cyclics.mana
     unvar Cleric.Buffs
     unvar Cleric.Augmentation.Spell
     unvar Cleric.Debilitation.Spell
     unvar Cleric.Target.Spell
     unvar Cleric.Utility.Spell
     unvar Cleric.Warding.Spell
     unvar Cleric.Sorcery.Spell
     unvar Ranger.Cyclics
     unvar Ranger.Cyclics.mana
     unvar Ranger.Buffs
     unvar Ranger.Augmentation.Spell
     unvar Ranger.Debilitation.Spell
     unvar Ranger.Target.Spell
     unvar Ranger.Utility.Spell
     unvar Ranger.Warding.Spell
     unvar Ranger.Sorcery.Spell
     unvar WM.Cyclics
     unvar WM.Cyclics.mana
     unvar WM.Buffs
     unvar WM.Augmentation.Spell
     unvar WM.Debilitation.Spell
     unvar WM.Target.Spell
     unvar WM.Utility.Spell
     unvar WM.Warding.Spell
     unvar WM.Sorcery.Spell
     unvar Trader.Cyclics
     unvar Trader.Cyclics.mana
     unvar Trader.Buffs
     unvar Trader.Augmentation.Spell
     unvar Trader.Debilitation.Spell
     unvar Trader.Target.Spell
     unvar Trader.Utility.Spell
     unvar Trader.Warding.Spell
     unvar Trader.Sorcery.Spell
     return
BRAWL_TOGGLE:
     pause 0.0001
     matchre BRAWL_OFF ^You are now set to avoid aggressive brawling manuevers\.
     matchre BRAWL_ON ^You will no longer avoid aggressive brawling manuevers\.
     put brawl
     matchwait 4
BRAWL_OFF:
     pause 0.3
     goto BRAWL_TOGGLE
BRAWL_ON:
     return
MANIPULATE:
     if ($Empathy.Ranks < 40) then return
     echo
     echo ##############
     echo * MANIPULATE CHECK
     echo ##############
     pause 0.1
     if ($standing = 0) then gosub STAND
     gosub GET_MONSTER_NAME
     if matchre("$monsterlist", "%nomanipulate") then return
     if contains("$monsterlist", "%nomanipulate") then return
     if contains("%Critter", "%nomanipulate") then return
     pause 0.0001
     ### STRIP TO ROOT
     eval Critter replacere("%Critter", "([\w'-]+\s){0,5}", "")
     pause 0.0001
     pause 0.0001
     matchre RETURN ^You strain\, but cannot extend your will any further
     matchre RETURN ^You extend your will and attempt to Empathically manipulate .* but you cannot find any purchase\.
     send manipulate friendship first %Critter
     matchwait 2
     if contains("$monsterlist", "%nomanipulate") then return
     if ($monstercount < 3) then return
     matchre RETURN ^You strain\, but cannot extend your will any further
     matchre RETURN ^You extend your will and attempt to Empathically manipulate .* but you cannot find any purchase\.
     send manipulate friendship second %Critter
     matchwait 3
     return
GUARDIAN_SPIRIT:
     action put #var UC_GuardianSpirit 0 when your empathy now too weak to support the pattern
     var GSLoop 0
GUARDIAN_SPIRIT_1:
     math GSLoop add 1
     if (%GSLoop > 2) then return
     if ($Utility.Ranks < 160) then return
     if ($UC_GuardianSpirit = 0) then return
     if (%Backtraining = 1) then return
     if (matchre("$monsterlist", "(?i)%Undead") || matchre("$UC_combatCritter", "(?i)%Undead")) then return
     echo
     echo #################
     echo ** CASTING GUARDIAN SPIRIT
     echo #################
     echo
     pause 0.01
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     gosub RELEASE cyclic
     if ($standing = 0) then gosub STAND
     pause 0.0001
     put prep GS
     pause 19
     if ($UC_GuardianCustom = 1) then send cast custom
     else send cast
     pause 2
     pause 0.5
     pause 0.5
     if !matchre("$roomobjs", "(alfar|dastardly|senile|gracile|ethereal|tall|lean|slim|graceful|trim|alert|serene|delicate|slender|stoic|athletic|lithe|lissome|solemn|sedate|tranquil|wiry|svelte|imposing|savage) warrior") then
          {
               pause 3
          }
     if !matchre("$roomobjs", "(alfar|dastardly|senile|gracile|ethereal|tall|lean|slim|graceful|trim|alert|serene|delicate|slender|stoic|athletic|lithe|lissome|solemn|sedate|tranquil|wiry|svelte|imposing|savage) warrior") then
          {
               echo *** NO GUARDIAN SPIRIT? RETRYING..
               goto GUARDIAN_SPIRIT_1
          }
     pause 0.001
     if ((%Empath.Brawl = 0) || (%InCombat = 0)) then send command warrior to stance defense
     if ((%Empath.Brawl = 1) && (%InCombat = 1)) then send command warrior to stance offense
     pause 0.1
     pause 0.2
     if ((%Empath.Brawl = 0) || (%InCombat = 0)) then send command warrior to behavior defensive
     if ((%Empath.Brawl = 1) && (%InCombat = 1)) then send command warrior to behavior aggressive
     pause 0.2
     pause 0.1
     return
EMPATH_CONSTRUCT_CHECK:
     if (("$guild" = "Empath") && matchre("%facing", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then
          {
               gosub ASSESS
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (!matchre("$monsterlist", "(%Undead|%Construct)") && ("$monsterlist" != "")) then goto PREEMPATHBRAWLING
               if (matchre("%facing", "%Undead") && (%ABSOLUTION = 0)) then goto PREEMPATHBRAWLING
               if !matchre("%facing", "(%Undead|%Construct)") && ($UC_ConstructOnly = 1)) then goto PREEMPATHBRAWLING
          }
     return
VH_HEAL:
     var CurrentSpell VH
     if ($health > 95) then return
     echo
     echo ###############
     echo ** HEALTH LOW
     echo ** CASTING VITALITY HEALING
     echo ###############
     echo
     if ($Utility.Ranks <= 25) then gosub PREPARE VH 5
     if (($Utility.Ranks > 25) && ($Utility.Ranks <= 100)) then gosub PREPARE VH 7
     if (($Utility.Ranks > 100) && ($Utility.Ranks <= 200)) then gosub PREPARE VH 10
     if (($Utility.Ranks > 200) && ($Utility.Ranks <= 300)) then gosub PREPARE VH 15
     if (($Utility.Ranks > 300) && ($Utility.Ranks <= 400)) then gosub PREPARE VH 25
     if (($Utility.Ranks > 400) && ($Utility.Ranks <= 500)) then gosub PREPARE VH 30
     if (($Utility.Ranks > 500) && ($Utility.Ranks <= 600)) then gosub PREPARE VH 35
     if ($Utility.Ranks > 600) then gosub PREPARE VH 45
     pause 8
     send cast
     pause 0.1
     return
#############################
# NECRO HEALING & RITUALS
# NECRO SUBS
#############################
NECRO_VARS:
     var NecroMoved 0
     var NecroBuffed 0
     var zombie 0
     var ARISETIMES 0
     var activezombie 0
     var RitualLoop 0
     var Nec.Ritual dissect
     var Necro.Material 0
     var Necro.Parts 0
     var QE.Mana 10
     var CFB.Mana 20
     var NecroHealing 0
     var Known.Cross 0
     var Known.Leth 0
     var Known.Shard 0
     var Known.Hib 0
     var Known.Theren 0
     var Known.Haven 0
     var Known.Ratha 0
     var Known.Aesry 0
     var Known.Muspari 0
     var Know.Butchery 0
     var Divine.Outrage 0
     var Necro.Known 0
     var City.Known 0
     var Forsaken OFF
     var JusticeTime $gametime
     var NecroHealTime $gametime
     var OutrageTime $gametime
     var QuickenEarthTime $gametime
     return
NECRO_STRIP:
     unvar MM.Cyclics
     unvar WM.Cyclics.mana
     unvar MM.Buffs
     unvar MM.Augmentation.Spell
     unvar MM.Debilitation.Spell
     unvar MM.Target.Spell
     unvar MM.Utility.Spell
     unvar MM.Warding.Spell
     unvar MM.Sorcery.Spell
     unvar Paladin.Cyclics
     unvar Paladin.Cyclics.mana
     unvar Paladin.Buffs
     unvar Paladin.Augmentation.Spell
     unvar Paladin.Debilitation.Spell
     unvar Paladin.Target.Spell
     unvar Paladin.Utility.Spell
     unvar Paladin.Warding.Spell
     unvar Paladin.Sorcery.Spell
     unvar Empath.Cyclics
     unvar Empath.Cyclics.mana
     unvar Empath.Buffs
     unvar Empath.Augmentation.Spell
     unvar Empath.Debilitation.Spell
     unvar Empath.Target.Spell
     unvar Empath.Utility.Spell
     unvar Empath.Warding.Spell
     unvar Empath.Sorcery.Spell
     unvar Bard.Cyclics
     unvar Bard.Cyclicss.mana
     unvar Bard.Buffs
     unvar Bard.Augmentation.Spell
     unvar Bard.Debilitation.Spell
     unvar Bard.Target.Spell
     unvar Bard.Utility.Spell
     unvar Bard.Warding.Spell
     unvar Bard.Sorcery.Spell
     unvar Cleric.Cyclics
     unvar Cleric.Cyclics.mana
     unvar Cleric.Buffs
     unvar Cleric.Augmentation.Spell
     unvar Cleric.Debilitation.Spell
     unvar Cleric.Target.Spell
     unvar Cleric.Utility.Spell
     unvar Cleric.Warding.Spell
     unvar Cleric.Sorcery.Spell
     unvar Ranger.Cyclics
     unvar Ranger.Cyclics.mana
     unvar Ranger.Buffs
     unvar Ranger.Augmentation.Spell
     unvar Ranger.Debilitation.Spell
     unvar Ranger.Target.Spell
     unvar Ranger.Utility.Spell
     unvar Ranger.Warding.Spell
     unvar Ranger.Sorcery.Spell
     unvar WM.Cyclics
     unvar WM.Cyclics.mana
     unvar WM.Buffs
     unvar WM.Augmentation.Spell
     unvar WM.Debilitation.Spell
     unvar WM.Target.Spell
     unvar WM.Utility.Spell
     unvar WM.Warding.Spell
     unvar WM.Sorcery.Spell
     unvar Trader.Cyclics
     unvar Trader.Cyclics.mana
     unvar Trader.Buffs
     unvar Trader.Augmentation.Spell
     unvar Trader.Debilitation.Spell
     unvar Trader.Target.Spell
     unvar Trader.Utility.Spell
     unvar Trader.Warding.Spell
     unvar Trader.Sorcery.Spell
     return
PERFORM_CHECK:
     action (necro) on
     echo
     echo *** Checking Known Necro Rituals..
     echo
     pause 0.1
     pause 0.0001
     put perform
     wait
     pause 0.0001
     pause 0.0001
     pause 0.0001
     action (necro) off
     return
NECRO_PREP:
     action (buffs) on
     action (necro) on
     if ($SpellTimer.RiteofGrace.active = 1) then put #var spellROG 1
     if ($SpellTimer.RiteofContrition.active = 1) then put #var spellROC 1
     if ("$guild" != "Necromancer") then return
     var donotcastlist The Crossing, Western Gate|Northeast Wilds, Outside Northeast Gate
     gosub JUSTICE_TIMER
     pause 0.0001
     if matchre("%abbrevs", "(?i)(ROC|ROG)") then gosub ROC
     if !matchre("(%abbrevs|%spelltimer)", "(?i)(EOTB|EyesoftheBlind)") then
          {
               echo *** EOTB NOT KNOWN!
               return
          }
     if matchre("(%abbrevs|%spelltimer)", "(?i)(EOTB|EyesoftheBlind)") then gosub EOTB
     if ($SpellTimer.EyesoftheBlind.active = 0) then gosub EOTB
     if (($spellEOTB = 1) && ($invisible = 0)) then
          {
               echo *** Waiting for invis to pulse....
               matchre RETURN You feel a rippling sensation|Your spell subtly alters|You feel an unsteady, rippling sensation
               matchwait 20
          }
     if ($invisible = 0) then gosub EOTB
     return

JUSTICE_CHECK:
     var Necro.Known 0
     var City.Known 0
     var Known.Cross 0
     var Known.Leth 0
     var Known.Shard 0
     var Known.Hib 0
     var Known.Theren 0
     var Known.Haven 0
     var Known.Ratha 0
     var Known.Aesry 0
     var Known.Muspari 0
     pause 0.001
     action (necro) on
     pause 0.3
     echo ** CHECKING NECRO JUSTICE...
     send justice
     wait
     pause 0.5
     pause 0.5
     goto JUSTICE_RETURN
JUSTICE_RETURN:
     action (necro) off
     if ($UC_Forsaken = 1) then var Necro.Known 1
     if (matchre("$zoneid","\b(1|2|2a|4|5|6|7|8|10)\b") && (%Known.Cross = 1)) then var Necro.Known 1
     if (matchre("$zoneid","\b(30|34a|34|33a|32|31|33)\b") && (%Known.Haven = 1)) then var Necro.Known 1
     if (matchre("$zoneid","\b(40|41|42)\b") && (%Known.Theren = 1)) then var Necro.Known 1
     if (matchre("$zoneid","\b(112|62|61|60)\b") && (%Known.Leth = 1)) then var Necro.Known 1
     if (matchre("$zoneid","\b(65|66|67|68|69)\b") && (%Known.Shard = 1)) then var Necro.Known 1
     if (matchre("$zoneid","\b(116|127|126)\b") && (%Known.Hib = 1)) then var Necro.Known 1
     if (matchre("$zoneid","\b(90a|92|95|90)\b") && (%Known.Ratha = 1)) then var Necro.Known 1
     if (matchre("$zoneid","\b(99|98)\b") && (%Known.Aesry = 1)) then var Necro.Known 1
     if (matchre("$zoneid","\b47\b") && (%Known.Muspari = 1)) then var Necro.Known 1
     if (%City.Known = 1) then var Necro.Known 1
     if (%Necro.Known = 1) then echo *** WE ARE KNOWN AS A NECRO IN THIS PROVINCE!
     if (%Necro.Known = 0) then echo *** Necro presence unkown! We are in the clear for now..
     pause 0.0001
     pause 0.0001
     return

DO_CHECK:
     var Divine.Outrage 0
     pause 0.0001
     # if (($SpellTimer.RiteofGrace.active = 0) && matchre("%abbrevs", "(?i)ROG")) then gosub ROG
     action math Divine.Outrage add 1 when The experience leaves you feeling naked for all to see
     action math Divine.Outrage add 1 when you are struck by a feeling of insecurity
     action math Divine.Outrage add 2 when you have a brief\, sharp pain in your limbs
     action math Divine.Outrage add 3 when you feel a deep pain in your chest
     pause 0.0001
     pause 0.0001
     put pray
     wait
     pause 0.0001
     pause 0.0001
     if ($standing = 0) then gosub STAND
     pause 0.0001
     action remove you are struck by a feeling of insecurity
     action remove you have a brief\, sharp pain in your limbs
     action remove you feel a deep pain in your chest
     action remove The experience leaves you feeling naked for all to see
     echo *** DIVINE OUTRAGE LEVEL: %Divine.Outrage/4
     if ($standing = 0) then gosub STAND
     pause 0.0001
     return

ROC:
     var EOTBLoop 0
     var ROCLoop 0
     var NecroPrep ROC
ROC_1:
     action (buffs) on
     if ($Utility.Ranks < 70) then
          {
               echo *** UTILITY RANKS TOO LOW FOR ROC (~70) - SKIPPING
               return
          }
     math ROCLoop add 1
     # if (matchre("%spelltimer", "Liturgy") && ($Utility.Ranks >= 600)) then
          # {
               # var NecroPrep ROG
          # }
     if (%ROCLoop > 1) then var NecroPrep ROC
     if (%ROCLoop > 2) then goto ROC_RETURN
     if (($spellROC = 1) || ($spellROG = 1)) then goto NECRO_DONE
     # if (($spellROG = 1) && matchre("%spelltimer", "Liturgy")) then goto NECRO_DONE
     # if (($spellROG = 1) && ("%NecroPrep" = "ROG")) then goto NECRO.DONE
     var CurrentSpell %NecroPrep
     var CurrentCambMana %CambrinthMana
     echo **** Prepping %NecroPrep ****
     if (%Research.Active = 1) then gosub RESEARCH_CANCEL
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     gosub RELEASE cyclic
     if ($mana < 50) then
          {
               echo ** MANA TOO LOW! PAUSING FOR MANA
               waiteval ($mana > 60)
          }
     pause 0.0001
     if (((matchre("$roomobjs", "exchange board")) || (matchre("$roomname", "([T|t]eller|[E|e]xchange|[B|b]ank)")) || (matchre("$roomname", "(%donotcastlist)"))) then
          {
               echo *** BAD ROOM FOR NECRO PREP!!
               return
          }
     gosub NECRO_CHECKROOM
     if ($Utility.Ranks < 200) then gosub PREPARE %NecroPrep 5
     if ($Utility.Ranks >= 200) && ($Utility.Ranks < 350) then gosub PREPARE %NecroPrep 7
     if ($Utility.Ranks >= 350) && ($Utility.Ranks < 450) then gosub PREPARE %NecroPrep 10
     if ($Utility.Ranks >= 450) && ($Utility.Ranks < 600) then gosub PREPARE %NecroPrep 13
     if ($Utility.Ranks >= 600) && ($Utility.Ranks < 800) then gosub PREPARE %NecroPrep 16
     if ($Utility.Ranks >= 800) then gosub PREPARE %NecroPrep 20
     pause 13
     if (("$roomplayers" != "") && matchre("$preparedspell", "(Rite of Contrition|Eyes of the Blind|Rite of Grace)")) then gosub RANDOMMOVE
     gosub SPELL_CAST
     pause 0.1
     pause 0.1
     matchre ROC_1_RELOOP ivory mask|bone structure beneath is subtly altered|gleaming with arcane power|mutative nervous system|whitened ridges|black mist|sheath of spell\-disrupting miasma|sensitive eye\-cysts
     matchre ROC_RETURN You are
     put look $charactername
     matchwait 3
ROC_RETURN:
     if (($spellROC = 0) && ($spellROG = 0) && (%ROCLoop < 3)) then goto ROC_1
     unvar ROCLoop
     unvar EOTBLoop
     unvar ROCLoop
     unvar NecroPrep
     return
ROC_1_RELOOP:
     echo ===========================
     echo *** TRANS BUFFS STILL VISIBLE/ACTIVE
     if matchre("%NecroPrep", "ROG") then echo *** SWITCHING TO ROC
     if !matchre("%NecroPrep", "ROG") then echo *** AFTER %NecroPrep - TRYING AGAIN
     echo ===========================
     pause 0.5
     goto ROC_1


EOTB:
     var EOTBLoop 0
EOTB_1:
     action (buffs) on
     # debug 5
     math EOTBLoop add 1
     if ($Utility.Ranks < 50) then return
     if (%EOTBLoop > 2) then goto EOTB_RETURN
     if (%Research.Active = 1) then gosub RESEARCH_CANCEL
     if (($spellEOTB = 1) && ($invisible = 1)) then goto NECRO_DONE
     pause 0.0001
     var CurrentSpell EOTB
     var CurrentCambMana %CambrinthMana
     echo  **** Prepping EOTB ****
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if ($mana < 50) then
          {
               echo ** MANA TOO LOW! PAUSING FOR MANA
               waiteval ($mana > 60)
          }
     ## ** Waits for invis pulse or casts the spell if invisible is off..
     pause 0.0001
     if (($SpellTimer.EyesoftheBlind.active = 1) && ($invisible = 0)) then
          {
               echo *** EOTB already active? Waiting for invis to pulse..
               ## ** This return is slightly different, it will not wait for pulse inside the exchange.
               ## ** It will also not wait for a pulse if destination = exchange, account or any teller trips to the exchange when moving areas.
               ## ** It should wait for a pulse inside the teller if going anywhere else.
               if (((matchre("$roomobjs", "exchange rate board")) || (matchre("$roomname", "([T|t]eller|[E|e]xchange|[B|b]ank)")) || (matchre("$roomname", "(%donotcastlist)"))) && ((matchre("$roomname", "([T|t]eller|[E|e]xchange|[B|b]ank)")) && (matchre("%Destination", "(teller|exchange)")))) then return
               matchre EOTB_1 ^Your spell subtly|^Your corruptive mutation fades|^You weave a field of sublime corruption
               matchre EOTB_RETURN_2 For some reason, the corruption fails
               matchwait 22
               put #echo >Log #ff0000 *** Error with EOTB not pulsing invis. Attempting to recast.
          }
     if ($invisible = 1) then return
     ## ** If script made it to this section then EOTB must be recast.
     ## ** This will not cast while inside the bank or any other unapproved rooms.
     if (((matchre("$roomobjs", "exchange rate board")) || (matchre("$roomname", "([T|t]eller|[E|e]xchange|[B|b]ank)")) || (matchre("$roomname", "(%donotcastlist)"))) then return
     if ($stamina < 30) then return
     gosub NECRO_CHECKROOM
     if ($Utility.Ranks < 80) then gosub PREPARE EOTB 2
     if ($Utility.Ranks >= 80) && ($Utility.Ranks < 120) then gosub PREPARE EOTB 5
     if ($Utility.Ranks >= 120) && ($Utility.Ranks < 240) then gosub PREPARE EOTB 7
     if ($Utility.Ranks >= 240) && ($Utility.Ranks < 400) then gosub PREPARE EOTB 8
     if ($Utility.Ranks >= 400) && ($Utility.Ranks < 500) then gosub PREPARE EOTB 10
     if ($Utility.Ranks >= 500) && ($Utility.Ranks < 700) then gosub PREPARE EOTB 12
     if ($Utility.Ranks >= 700) then gosub PREPARE EOTB 20
     pause 13
     if (("$roomplayers" != "") && matchre("$preparedspell", "(Rite of Contrition|Eyes of the Blind|Rite of Grace)")) then gosub RANDOMMOVE
     gosub SPELL_CAST
EOTB_RETURN:
     if (($spellEOTB = 0) && (%EOTBLoop < 3)) then goto EOTB_1
     # debug 0
EOTB_RETURN_2:
     return
NECRO_DONE:
     delay 0.0001
     unvar ROCLoop
     unvar EOTBLoop
     unvar ROCLoop
     unvar NecroPrep
     return
NECRO_CHECKROOM:
     pause 0.0001
     pause 0.0001
     if !("$roomplayers" = "") then gosub RANDOMMOVE
     send search
     pause 0.5
     pause 0.1
     pause 0.0001
     pause 0.0001
     if !("$roomplayers" = "") then gosub RANDOMMOVE
     if !("$roomplayers" = "") then goto NECRO_CHECKROOM
     echo **** FOUND EMPTY ROOM! ***
     return
#### QUICKEN THE EARTH
QUICKEN_EARTH_CHECK:
     if matchre("$roomobjs", "dirt construct") then goto QUICKEN_RETURN
CAST_QUICKEN:
     pause 0.0001
     var CurrentSpell QE
     var CurrentSpellMana %QE.Mana
     var spellID QE %QE.Mana
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if !matchre("$lefthand", "Empty") then gosub STOW $lefthandnoun
     gosub GET dirt
     pause 0.1
     if !matchre("$righthand $lefthand", "dirt") then
          {
               if !matchre("$UC_Container.Dirt", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
                    {
                         gosub PUT push $UC_Container.Dirt
                         pause 0.2
                         if !matchre("$righthand $lefthand", "dirt") then gosub GET dirt from $UC_Container.Dirt
                         pause 0.2
                    }
          }
     if !matchre("$righthand $lefthand", "dirt") then
          {
               gosub RETREAT
               send forage dirt
               pause 2
               pause
          }
     if !matchre("$righthand $lefthand", "dirt") then
          {
               echo **** NO DIRT FOR QUICKEN EARTH!
               goto QUICKEN_RETURN
          }
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     pause 0.0001
     pause 0.0001
     send release symb
     pause 0.2
     pause 0.2
     send prep QE %QE.Mana
     pause 3
     send perform cut
     pause 15
     pause 0.0001
     send cast
     pause 0.5
     pause 0.0001
     pause 0.0001
QUICKEN_RETURN:
     if ((%Backfired = 1) && ($UC_SmartSpells = 1)) then
          {
               var CurrentBackfire %CurrentSpell
               gosub SPELL_BACKFIRED
               var Backfired 0
          }
     return
#### RITUALS / HEALING
FACE_RITUAL:
     if matchre("roomobjs", "(%RitualMonsters)") then send face $1
     else return
NECROHEAL:
     var devour 0
     var performed 0
     var killed 0
     var nerves 0
     var necroloop 0
     var healme 1
     var skinned 1
     action (buffs) off
     action var wounds $1 when ^You have ((\b(?!no )\w+).+)
     if ($circle < 15) then
          {
               put #echo SkyBlue ** Tried NecroHealing but you can't Heal yourself yet! Get healed somewhere else!
               goto ESCAPE
          }
     if (%NecroHealing = 1) then
          {
               gosub HEALTH_CHECK_ALL
          }
     if (%NecroHealing = 0) then
          {
               gosub HEALTH_CHECK
          }
     action remove ^You have ((\b(?!no )\w+).+)
     action (buffs) on
     if ($needHealing = 1) then goto PUNCHTHEBITCH
     unvar devour
     unvar performed
     unvar killed
     unvar nerves
     unvar necroloop
     unvar healme
     return
PUNCHTHEBITCH:
     pause 0.0001
     math necroloop add 1
     gosub stowing
     if matchre("$roomobjs", ".* ((?:which|that) appears dead|\(dead\))") then gosub PREPTHEDEAD
     ## gosub HEALTH_CHECK
     if ($needHealing = 0) then return
     if (($monstercount) && (%Melee.Range)) then send ATTACK
     pause 0.5
     pause 0.1
     if (($monstercount) && (!%Melee.Range)) then send ADVANCE
     pause 0.0001
     pause 0.1
     if (($monstercount) && (%Melee.Range)) then send PUNCH
     pause 0.5
     pause 0.0001
     pause 0.0001
     if (%necroloop > 6) then
          {
               var necroloop 0
               return
          }
     goto PUNCHTHEBITCH
PREPTHEDEAD:
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if !matchre("$roomobjs", "(?i)(%RitualMonsters) ((?:which|that) appears dead|\(dead\))")  then
          {
               gosub PUT loot
               return
          }
     if matchre("$roomobjs", "(?i)(%RitualMonsters) ((which|that) appears dead|\(dead\))") then
          {
               var Ritual.critter $1
               if matchre("%Ritual.critter", "(suw bizar|bizar)") then var Ritual.critter puddle
               if matchre("%Ritual.critter", "belly crocodile") then var Ritual.critter crocodile
               echo *** Ritual.critter: %Ritual.critter
               gosub TARGET_RITUAL
               if ($Utility.Ranks < 300) then gosub PRESERVE
               gosub TARGET_RITUAL
               gosub PERFORM_CONSUME
               if (%consumeReady = 1) then
                    {
                         if (($circle > 49) && ($Utility.Ranks >= 300) && matchre("%abbrevs", "(?i)DEVOUR")) then gosub DEVOUR
                         if (($Utility.Ranks < 300) || ($circle <= 50)) then gosub CF
                    }
               var NecroHealTime $gametime
               if ("$preparedspell" != "None") then gosub RELEASE spell
               gosub PUT loot
          }
     return
#### ARISEN ZOMBIE STUFF
ARISE:
ARISE_PREPARE:
     var skinned 1
     if (%Playing = 1) then gosub STOP_PLAY
     if ($standing = 0) then gosub STAND
     if !matchre("%spelltimer", "CallfromBeyond") then return
     if ("$preparedspell" != "None") then send release
     pause 0.1
     pause 0.0001
     pause 0.0001
     send prepare cfb %CFB.Mana
     pause 0.2
     pause 0.1
     pause 0.0001
     if ("$preparedspell" = "None") then goto ARISE_PREPARE
ARISE_LOOP:
     pause 0.0001
     pause 0.0001
     send release symb
     pause 0.0001
     pause 0.0001
     if ($monstercount > 0) then send attack left
     pause 0.5
     pause 0.1
     pause 0.0001
     if ($monstercount > 0) then send bob
     pause 0.5
     pause 0.1
     pause 0.0001
     if ($spelltime >= 30) then send cast
     if ("$preparedspell" = "None") then goto ARISE_COMMAND
     goto ARISE_LOOP
ARISE_COMMAND:
     var zombie 1
     var activezombie 1
     var arise_command behavior aggressive
     gosub COMMAND
     return
LEAVE_COMMAND:
     var zombie 0
     var activezombie 1
     var arise_command leave
     gosub command
     return
COME_COMMAND:
     var zombie 1
     var activezombie 1
     var arise_command come
     gosub command
     gosub arise_command
     return
COMMAND:
     var LOCATION COMMAND_1
     if ($standing = 0) then gosub STAND
     pause 0.0001
     pause 0.0001
     pause 0.0001
     COMMAND_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre RETURN is already right beside you\.
     matchre RETURN ^You have already shifted you
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RETURN ^You sense your Call from Beyond spell weaken and disperse
     matchre RETURN ^You do not have a zombie to command
     matchre RETURN ^Please rephrase|^What were
     send command zombie %arise_command
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN command! (ubercombat.cmd) ***
     put #log $datetime MISSING MATCH IN command (ubercombat.cmd)
     return
#### NECRO HEALING STUFF
DEVOUR:
     action (buffs) off
     gosub HEALTH_CHECK_ALL
     action (buffs) on
     if ($needHealing = 0) then return
     var CurrentSpell DEVOUR
     gosub RELEASE symb
     if ($Utility.Ranks < 400) then gosub PREPARE DEVOUR 30
     if (($Utility.Ranks > 400) && ($Utility.Ranks < 500)) then gosub PREPARE DEVOUR 32
     if (($Utility.Ranks > 500) && ($Utility.Ranks < 600)) then gosub PREPARE DEVOUR 37
     if (($Utility.Ranks > 600) && ($Utility.Ranks < 700)) then gosub PREPARE DEVOUR 42
     if (($Utility.Ranks > 700) && ($Utility.Ranks < 800)) then gosub PREPARE DEVOUR 47
     if (($Utility.Ranks > 800) && ($Utility.Ranks < 900)) then gosub PREPARE DEVOUR 55
     if (($Utility.Ranks > 900) && ($Utility.Ranks < 1000)) then gosub PREPARE DEVOUR 64
     if ($Utility.Ranks > 1000) then gosub PREPARE DEVOUR 85
     # gosub SPELL_WAIT
     pause 23
     put cast
     pause 0.5
     return
CF:
     math necroloop add 1
     action (buffs) off
     action var wounds $1 when ^You have ((\b(?!no )\w+).+)
     gosub HEALTH_CHECK_ALL
     action remove ^You have ((\b(?!no )\w+).+)
     action (buffs) on
     if ($needHealing = 0) then return
     var CurrentSpell CF
     if ($Utility.Ranks < 150) then gosub PREPARE CF 15
     if (($Utility.Ranks > 150) && ($Utility.Ranks < 250)) then gosub PREPARE CF 17
     if (($Utility.Ranks > 250) && ($Utility.Ranks < 350)) then gosub PREPARE CF 24
     if (($Utility.Ranks > 350) && ($Utility.Ranks < 500)) then gosub PREPARE CF 29
     if (($Utility.Ranks > 500) && ($Utility.Ranks < 550)) then gosub PREPARE CF 36
     if (($Utility.Ranks > 550) && ($Utility.Ranks < 600)) then gosub PREPARE CF 42
     if ($Utility.Ranks > 600) then gosub PREPARE CF 50
     gosub IDAREATOHEAL
     gosub SPELL_WAIT_NECRO
     gosub SPELL_CAST_NECRO %AREATOHEAL
     if (matchre("$roomobjs", "(%RitualMonsters) ((?:which|that) appears dead|\(dead\))") && (%necroloop < 3) || matchre("$righthand $lefthand", "material") && (%necroloop < 3)) then goto CF
     return
### CHECK FOR NECRO HEALING
IDAREATOHEAL:
     action (buffs) off
     gosub checkMinorScars
     gosub checkModerateScars
     gosub checkMajorScars
     gosub checkminor
     gosub checkmoderate
     gosub checkmajor
     gosub checknerves
     action (buffs) on
     return
#### CHECK FOR EMPATHS HW
IDHWHEAL:
     action (buffs) off
     gosub checkminor
     gosub checkmoderate
     gosub checkmajor
     gosub checknerves
     action (buffs) on
     return
HEALSELF:
     var AREATOHEAL $1
     return
checkNerves:
     if contains("%wounds", "open and bleeding sores all over the skin") then gosub HEALSELF "skin" 6
     if contains("%wounds", "complete paralysis of the entire body") then gosub HEALSELF "skin" 6
     if contains("%wounds", "boils and sores around the skin") then gosub HEALSELF "skin" 5
     if contains("%wounds", "severe paralysis of the entire body") then gosub HEALSELF "skin" 5
     if contains("%wounds", "a painful, enflamed body rash") then gosub HEALSELF "skin" 4
     if contains("%wounds", "partial paralysis of the entire body") then gosub HEALSELF "skin" 4
     if contains("%wounds", "a body rash") then gosub HEALSELF "skin" 3
     if contains("%wounds", "difficulty controlling actions") then gosub HEALSELF "skin" 3
     if contains("%wounds", "a large skin rash") then gosub HEALSELF "skin" 2
     if contains("%wounds", "some severe twitching") then gosub HEALSELF "skin" 2
     if contains("%wounds", "some minor twitching") then gosub HEALSELF "skin" 1
     if contains("%wounds", "severe skin loss exposing bone and internal organs") then gosub HEALSELF "skin" 6
     if contains("%wounds", "general numbness all over and have difficulty thinking") then gosub HEALSELF "skin" 6
     if contains("%wounds", "severely stiff and shriveled skin that seems to be peeling off the body") then gosub HEALSELF "skin" 5
     if contains("%wounds", "some shriveled and oddly folded skin") then gosub HEALSELF "skin" 4
     if contains("%wounds", "slight numbness in the arms and legs") then gosub HEALSELF "skin" 2
     if contains("%wounds", "slight numbness in your arms and legs") then gosub HEALSELF "skin" 2
     return
checkMajor:
     if contains("%wounds", "open and bleeding sores all over the skin") then gosub HEALSELF "skin" 6
     if contains("%wounds", "a pulpy stump for a head") then gosub HEALSELF "head" 6
     if contains("%wounds", "a completely useless neck with nearly all flesh and bone torn away") then gosub HEALSELF "neck" 6
     if contains("%wounds", "a completely destroyed chest area with nearly all flesh and bone torn away revealing a gaping hole") then gosub HEALSELF "chest" 6
     if contains("%wounds", "a completely destroyed abdomen with nearly all flesh and bone torn away revealing a gaping hole") then gosub HEALSELF "abdomen" 6
     if contains("%wounds", "a completely destroyed back with nearly all flesh and bone torn away revealing a gaping hole") then gosub HEALSELF "back" 6
     if contains("%wounds", "a pulpy cavity for a right eye") then gosub HEALSELF "right eye" 6
     if contains("%wounds", "a pulpy cavity for a left eye") then gosub HEALSELF "left eye" 6
     if contains("%wounds", "an ugly stump for a right arm") then gosub HEALSELF "right arm" 6
     if contains("%wounds", "an ugly stump for a left arm") then gosub HEALSELF "left arm" 6
     if contains("%wounds", "an ugly stump for a right leg") then gosub HEALSELF "right leg" 6
     if contains("%wounds", "an ugly stump for a left leg") then gosub HEALSELF "left leg" 6
     if contains("%wounds", "an ugly stump for a right hand") then gosub HEALSELF "right hand" 6
     if contains("%wounds", "an ugly stump for a left hand") then gosub HEALSELF "left hand" 6
     if contains("%wounds", "an ugly stump for a tail") then gosub HEALSELF "tail" 6
     if contains("%wounds", "complete paralysis of the entire body") then gosub HEALSELF "skin" 6
     if contains("%wounds", "a grotesquely bloated head with bleeding from the eyes and ears") then gosub HEALSELF "head" 6
     if contains("%wounds", "a severely swollen and shattered neck which appears useless to hold up the head") then gosub HEALSELF "neck" 6
     if contains("%wounds", "a severely swollen chest area with a shattered rib cage") then gosub HEALSELF "chest" 6
     if contains("%wounds", "a severely bloated and discolored abdomen which appears oddly rearranged") then gosub HEALSELF "abdomen" 6
     if contains("%wounds", "a severely swollen back with a shattered spinal cord") then gosub HEALSELF "back" 6
     if contains("%wounds", "a severely swollen, cruised and blind right eye") then gosub HEALSELF "right eye" 6
     if contains("%wounds", "a severely swollen, cruised and blind left eye") then gosub HEALSELF "left eye" 6
     if contains("%wounds", "a severely swollen and shattered right arm which appears completely useless") then gosub HEALSELF "right arm" 6
     if contains("%wounds", "a severely swollen and shattered left arm which appears completely useless") then gosub HEALSELF "left arm" 6
     if contains("%wounds", "a severely swollen and shattered right leg which appears completely useless") then gosub HEALSELF "right leg" 6
     if contains("%wounds", "a severely swollen and shattered left leg which appears completely useless") then gosub HEALSELF "left leg" 6
     if contains("%wounds", "a severely swollen and shattered right hand which appears completely useless") then gosub HEALSELF "right hand" 6
     if contains("%wounds", "a severely swollen and shattered left hand which appears completely useless") then gosub HEALSELF "left hand" 6
     if contains("%wounds", "a severely swollen and shattered tail which appears completely useless") then gosub HEALSELF "tail" 6
     if contains("%wounds", "boils and sores around the skin") then gosub HEALSELF "skin" 5
     if contains("%wounds", "a crushed skull with horrendous wounds") then gosub HEALSELF "head" 5
     if contains("%wounds", "a shattered neck with gaping wounds") then gosub HEALSELF "neck" 5
     if contains("%wounds", "a shattered chest area with gaping wounds") then gosub HEALSELF "chest" 5
     if contains("%wounds", "an abdomen deeply gouged with gaping wounds") then gosub HEALSELF "abdomen" 5
     if contains("%wounds", "a shattered back with gaping wounds") then gosub HEALSELF "back" 5
     if contains("%wounds", "a bruised, swollen and shattered right eye") then gosub HEALSELF "right eye" 5
     if contains("%wounds", "a bruised, swollen and shattered left eye") then gosub HEALSELF "left eye" 5
     if contains("%wounds", "a shattered right arm with gaping wounds") then gosub HEALSELF "right arm" 5
     if contains("%wounds", "a shattered left arm with gaping wounds") then gosub HEALSELF "left arm" 5
     if contains("%wounds", "a shattered right leg with gaping wounds") then gosub HEALSELF "right leg" 5
     if contains("%wounds", "a shattered left leg with gaping wounds") then gosub HEALSELF "left leg" 5
     if contains("%wounds", "a shattered right hand with gaping wounds") then gosub HEALSELF "right hand" 5
     if contains("%wounds", "a shattered left hand with gaping wounds") then gosub HEALSELF "left hand" 5
     if contains("%wounds", "a shattered tail with gaping wounds") then gosub HEALSELF "tail" 5
     if contains("%wounds", "severe paralysis of the entire body") then gosub HEALSELF "skin" 5
     if contains("%wounds", "a ghastly bloated head with bleeding from the ears") then gosub HEALSELF "head" 5
     if contains("%wounds", "a severely swollen and deeply bruised neck with bones protruding out from the skin") then gosub HEALSELF "neck" 5
     if contains("%wounds", "a severely swollen and deeply bruised chest area with ribs protruding out from the skin") then gosub HEALSELF "chest" 5
     if contains("%wounds", "a severely swollen and deeply bruised abdomen with strange round lumps under the skin") then gosub HEALSELF "abdomen" 5
     if contains("%wounds", "a severely swollen and deeply bruised back with ribs or vertebrae protruding out from the skin") then gosub HEALSELF "back" 5
     if contains("%wounds", "a severely swollen, bruised and blind right eye") then gosub HEALSELF "right eye" 5
     if contains("%wounds", "a severely swollen, bruised and blind left eye") then gosub HEALSELF "left eye" 5
     if contains("%wounds", "a severely swollen and deeply bruised right arm with bones protruding out from the skin") then gosub HEALSELF "right arm" 5
     if contains("%wounds", "a severely swollen and deeply bruised left arm with bones protruding revealing a gaping hole") then gosub HEALSELF "left arm" 5
     if contains("%wounds", "a severely swollen and deeply bruised right leg with bones protruding out from the skin") then gosub HEALSELF "right leg" 5
     if contains("%wounds", "a severely swollen and deeply bruised left leg with bones protruding out from the skin") then gosub HEALSELF "left leg" 5
     if contains("%wounds", "a severely swollen and deeply bruised right hand with bones protruding out from the skin") then gosub HEALSELF "right hand" 5
     if contains("%wounds", "a severely swollen and deeply bruised left hand with bones protruding out from the skin") then gosub HEALSELF "left hand" 5
     if contains("%wounds", "a severely swollen and deeply bruised tail with bones protruding out from the skin") then gosub HEALSELF "tail" 5
     if contains("%wounds", "a painful, enflamed body rash") then gosub HEALSELF "skin" 4
     if contains("%wounds", "a cracked skull with deep slashes") then gosub HEALSELF "head" 4
     if contains("%wounds", "gaping holes in the neck") then gosub HEALSELF "neck" 4
     if contains("%wounds", "gaping holes in the chest area") then gosub HEALSELF "chest" 4
     if contains("%wounds", "gaping holes in the abdomen") then gosub HEALSELF "abdomen" 4
     if contains("%wounds", "gaping holes in the back") then gosub HEALSELF "back" 4
     if contains("%wounds", "a bruised, swollen and slashed right eye") then gosub HEALSELF "right eye" 4
     if contains("%wounds", "a bruised, swollen and slashed left eye") then gosub HEALSELF "left eye" 4
     if contains("%wounds", "a broken right arm with gaping holes") then gosub HEALSELF "right arm" 4
     if contains("%wounds", "a broken left arm with gaping holes") then gosub HEALSELF "left arm" 4
     if contains("%wounds", "a broken right leg with gaping holes") then gosub HEALSELF "right leg" 4
     if contains("%wounds", "a broken left leg with gaping holes") then gosub HEALSELF "left leg" 4
     if contains("%wounds", "a broken right hand with gaping holes") then gosub HEALSELF "right hand" 4
     if contains("%wounds", "a broken left hand with gaping holes") then gosub HEALSELF "left hand" 4
     if contains("%wounds", "a broken tail with gaping holes") then gosub HEALSELF "tail" 4
     if contains("%wounds", "partial paralysis of the entire body") then gosub HEALSELF "skin" 4
     if contains("%wounds", "major swelling and bruising around the head") then gosub HEALSELF "head" 4
     if contains("%wounds", "a severely swollen and deeply bruised neck with odd protrusions under the skin") then gosub HEALSELF "neck" 4
     if contains("%wounds", "a severely swollen and deeply bruised chest area with odd protrusions under the skin") then gosub HEALSELF "chest" 4
     if contains("%wounds", "a severely bloated and discolored abdomen with strange round lumps under the skin") then gosub HEALSELF "abdomen" 4
     if contains("%wounds", "a severely swollen and deeply bruised back with odd protrusions under the skin") then gosub HEALSELF "back" 4
     if contains("%wounds", "a severely swollen, bruised and cloudy right eye") then gosub HEALSELF "right eye" 4
     if contains("%wounds", "a severely swollen, bruised and cloudy left eye") then gosub HEALSELF "left eye" 4
     if contains("%wounds", "a severely swollen and deeply bruised right arm with odd protrusions under the skin") then gosub HEALSELF "right arm" 4
     if contains("%wounds", "a severely swollen and deeply bruised left arm with odd protrusions under the skin") then gosub HEALSELF "left arm" 4
     if contains("%wounds", "a severely swollen and deeply bruised right leg with odd protrusions under the skin") then gosub HEALSELF "right leg" 4
     if contains("%wounds", "a severely swollen and deeply bruised left leg with odd protrusions under the skin") then gosub HEALSELF "left leg" 4
     if contains("%wounds", "a severely swollen and deeply bruised right hand with odd protrusions under the skin") then gosub HEALSELF "right hand" 4
     if contains("%wounds", "a severely swollen and deeply bruised left hand with odd protrusions under the skin") then gosub HEALSELF "left hand" 4
     if contains("%wounds", "a severely swollen and deeply bruised tail with odd protrusions under the skin") then gosub HEALSELF "tail" 4
     return
checkModerate:
     if contains("%wounds", "a body rash") then gosub HEALSELF "skin" 3
     if contains("%wounds", "some deep slashes and cuts about the head") then gosub HEALSELF "head" 3
     if contains("%wounds", "deep slashes across the neck") then gosub HEALSELF "neck" 3
     if contains("%wounds", "deep slashes across the chest area") then gosub HEALSELF "chest" 3
     if contains("%wounds", "deep slashes across the abdomen") then gosub HEALSELF "abdomen" 3
     if contains("%wounds", "deep slashes across the back") then gosub HEALSELF "back" 3
     if contains("%wounds", "a bruised, swollen and bleeding right eye") then gosub HEALSELF "right eye" 3
     if contains("%wounds", "a bruised, swollen and bleeding left eye") then gosub HEALSELF "left eye" 3
     if contains("%wounds", "difficulty controlling actions") then gosub HEALSELF "skin" 3
     if contains("%wounds", "a badly bruised and swollen head") then gosub HEALSELF "head" 3
     if contains("%wounds", "a severely swollen and deeply bruised neck") then gosub HEALSELF "neck" 3
     if contains("%wounds", "severely swollen and bruised chest area") then gosub HEALSELF "chest" 3
     if contains("%wounds", "severely swollen and bruised abdomen") then gosub HEALSELF "abdomen" 3
     if contains("%wounds", "severely swollen and bruised back") then gosub HEALSELF "back" 3
     if contains("%wounds", "a severely swollen, bruised and crossed right eye") then gosub HEALSELF "right eye" 3
     if contains("%wounds", "a severely swollen, bruised and crossed left eye") then gosub HEALSELF "left eye" 3
     if contains("%wounds", "deep slashes across the right arm") then gosub HEALSELF "right arm" 3
     if contains("%wounds", "deep slashes across the left arm") then gosub HEALSELF "left arm" 3
     if contains("%wounds", "deep slashes across the right leg") then gosub HEALSELF "right leg" 3
     if contains("%wounds", "deep slashes across the left leg") then gosub HEALSELF "left leg" 3
     if contains("%wounds", "deep slashes across the right hand") then gosub HEALSELF "right hand" 3
     if contains("%wounds", "deep slashes across the left hand") then gosub HEALSELF "left hand" 3
     if contains("%wounds", "deep slashes across the tail") then gosub HEALSELF "tail" 3
     if contains("%wounds", "a severely swollen and deeply bruised right arm") then gosub HEALSELF "right arm" 3
     if contains("%wounds", "a severely swollen and deeply bruised left arm") then gosub HEALSELF "left arm" 3
     if contains("%wounds", "a severely swollen and deeply bruised right leg") then gosub HEALSELF "right leg" 3
     if contains("%wounds", "a severely swollen and deeply bruised left leg") then gosub HEALSELF "left leg" 3
     if contains("%wounds", "a severely swollen and deeply bruised right hand") then gosub HEALSELF "right hand" 3
     if contains("%wounds", "a severely swollen and deeply bruised left hand") then gosub HEALSELF "left hand" 3
     if contains("%wounds", "a severely swollen and deeply bruised tail") then gosub HEALSELF "tail" 3
     if contains("%wounds", "a large skin rash") then gosub HEALSELF "skin" 2
     if contains("%wounds", "some moderately deep cuts about the head") then gosub HEALSELF "head" 2
     if contains("%wounds", "deep cuts across the neck") then gosub HEALSELF "neck" 2
     if contains("%wounds", "deep cuts across the chest area") then gosub HEALSELF "chest" 2
     if contains("%wounds", "deep cuts across the abdomen") then gosub HEALSELF "abdomen" 2
     if contains("%wounds", "deep cuts across the back") then gosub HEALSELF "back" 2
     if contains("%wounds", "a bruised and swollen right eye") then gosub HEALSELF "right eye" 2
     if contains("%wounds", "a bruised and swollen left eye") then gosub HEALSELF "left eye" 2
     if contains("%wounds", "some severe twitching") then gosub HEALSELF "skin" 2
     if contains("%wounds", "a deeply bruised head") then gosub HEALSELF "head" 2
     if contains("%wounds", "a severely swollen and deeply bruised neck") then gosub HEALSELF "neck" 2
     if contains("%wounds", "severely swollen and bruised chest area") then gosub HEALSELF "chest" 2
     if contains("%wounds", "severely swollen and bruised abdomen") then gosub HEALSELF "abdomen" 2
     if contains("%wounds", "severely swollen and bruised back") then gosub HEALSELF "back" 2
     if contains("%wounds", "a severely swollen and bruised right eye") then gosub HEALSELF "right eye" 2
     if contains("%wounds", "a severely swollen and bruised left eye") then gosub HEALSELF "left eye" 2
     if contains("%wounds", "deep cuts across the right arm") then gosub HEALSELF "right arm" 2
     if contains("%wounds", "deep cuts across the left arm") then gosub HEALSELF "left arm" 2
     if contains("%wounds", "deep cuts across the right leg") then gosub HEALSELF "right leg" 2
     if contains("%wounds", "deep cuts across the left leg") then gosub HEALSELF "left leg" 2
     if contains("%wounds", "deep cuts across the right hand") then gosub HEALSELF "right hand" 2
     if contains("%wounds", "deep cuts across the left hand") then gosub HEALSELF "left hand" 2
     if contains("%wounds", "deep cuts across the tail") then gosub HEALSELF "tail" 2
     if contains("%wounds", "a severely swollen and deeply bruised right arm") then gosub HEALSELF "right arm" 2
     if contains("%wounds", "a severely swollen and deeply bruised left arm") then gosub HEALSELF "left arm" 2
     if contains("%wounds", "a severely swollen and deeply bruised right leg") then gosub HEALSELF "right leg" 2
     if contains("%wounds", "a severely swollen and deeply bruised left leg") then gosub HEALSELF "left leg" 2
     if contains("%wounds", "a severely swollen and deeply bruised right hand") then gosub HEALSELF "right hand" 2
     if contains("%wounds", "a severely swollen and deeply bruised left hand") then gosub HEALSELF "left hand" 2
     if contains("%wounds", "a severely swollen and deeply bruised tail") then gosub HEALSELF "tail" 2
     return
checkMinor:
     if contains("%wounds", "some minor twitching") then gosub HEALSELF "skin" 1
     if contains("%wounds", "cuts and bruises about the head") then gosub HEALSELF "head" 1
     if contains("%wounds", "cuts and bruises about the neck") then gosub HEALSELF "neck" 1
     if contains("%wounds", "cuts and bruises about the chest area") then gosub HEALSELF "chest" 1
     if contains("%wounds", "cuts and bruises about the abdomen") then gosub HEALSELF "abdomen" 1
     if contains("%wounds", "cuts and bruises about the back") then gosub HEALSELF "back" 1
     if contains("%wounds", "a black and blue right eye") then gosub HEALSELF "right eye" 1
     if contains("%wounds", "a black and blue left eye") then gosub HEALSELF "left eye" 1
     if contains("%wounds", "cuts and bruises about the right arm") then gosub HEALSELF "right arm" 1
     if contains("%wounds", "cuts and bruises about the left arm") then gosub HEALSELF "left arm" 1
     if contains("%wounds", "cuts and bruises about the right leg") then gosub HEALSELF "right leg" 1
     if contains("%wounds", "cuts and bruises about the left leg") then gosub HEALSELF "left leg" 1
     if contains("%wounds", "cuts and bruises about the right hand") then gosub HEALSELF "right hand" 1
     if contains("%wounds", "cuts and bruises about the left hand") then gosub HEALSELF "left hand" 1
     if contains("%wounds", "cuts and bruises about the tail") then gosub HEALSELF "tail" 1
     if contains("%wounds", "a bruised head") then gosub HEALSELF "head" 1
     if contains("%wounds", "minor swelling and bruising around the neck") then gosub HEALSELF "neck" 1
     if contains("%wounds", "minor swelling and bruising in the chest area") then gosub HEALSELF "chest" 1
     if contains("%wounds", "minor swelling and bruising in the abdomen") then gosub HEALSELF "abdomen" 1
     if contains("%wounds", "minor swelling and bruising in the back") then gosub HEALSELF "back" 1
     if contains("%wounds", "some minor swelling and bruising around the right eye") then gosub HEALSELF "right eye" 1
     if contains("%wounds", "some minor swelling and bruising around the left eye") then gosub HEALSELF "left eye" 1
     if contains("%wounds", "minor swelling and bruising around the right arm") then gosub HEALSELF "right arm" 1
     if contains("%wounds", "minor swelling and bruising around the left arm") then gosub HEALSELF "left arm" 1
     if contains("%wounds", "minor swelling and bruising around the right leg") then gosub HEALSELF "right leg" 1
     if contains("%wounds", "minor swelling and bruising around the left leg") then gosub HEALSELF "left leg" 1
     if contains("%wounds", "minor swelling and bruising around the right hand") then gosub HEALSELF "right hand" 1
     if contains("%wounds", "minor swelling and bruising around the left hand") then gosub HEALSELF "left hand" 1
     if contains("%wounds", "minor swelling and bruising around the tail") then gosub HEALSELF "tail" 1
     if contains("%wounds", "some tiny scratches to the head") then gosub HEALSELF "head" 0
     if contains("%wounds", "some tiny scratches to the neck") then gosub HEALSELF "neck" 0
     if contains("%wounds", "some tiny scratches to the chest") then gosub HEALSELF "chest" 0
     if contains("%wounds", "some tiny scratches to the abdomen") then gosub HEALSELF "abdomen" 0
     if contains("%wounds", "some tiny scratches to the back") then gosub HEALSELF "back" 0
     if contains("%wounds", "some tiny scratches to the right eye") then gosub HEALSELF "right eye" 0
     if contains("%wounds", "some tiny scratches to the left eye") then gosub HEALSELF "left eye" 0
     if contains("%wounds", "some tiny scratches to the right arm") then gosub HEALSELF "right arm" 0
     if contains("%wounds", "some tiny scratches to the left arm") then gosub HEALSELF "left arm" 0
     if contains("%wounds", "some tiny scratches to the right leg") then gosub HEALSELF "right leg" 0
     if contains("%wounds", "some tiny scratches to the left leg") then gosub HEALSELF "left leg" 0
     if contains("%wounds", "some tiny scratches to the right hand") then gosub HEALSELF "right hand" 0
     if contains("%wounds", "some tiny scratches to the left hand") then gosub HEALSELF "left hand" 0
     if contains("%wounds", "some tiny scratches to the tail") then gosub HEALSELF "tail" 0
     if contains("%wounds", "some minor abrasions to the head") then gosub HEALSELF "head" 0
     if contains("%wounds", "some minor abrasions to the neck") then gosub HEALSELF "neck" 0
     if contains("%wounds", "some minor abrasions to the chest") then gosub HEALSELF "chest" 0
     if contains("%wounds", "some minor abrasions to the abdomen") then gosub HEALSELF "abdomen" 0
     if contains("%wounds", "some minor abrasions to the back") then gosub HEALSELF "back" 0
     if contains("%wounds", "some minor abrasions to the right eye") then gosub HEALSELF "right eye" 0
     if contains("%wounds", "some minor abrasions to the left eye") then gosub HEALSELF "left eye" 0
     if contains("%wounds", "some minor abrasions to the right arm") then gosub HEALSELF "right arm" 0
     if contains("%wounds", "some minor abrasions to the left arm") then gosub HEALSELF "left arm" 0
     if contains("%wounds", "some minor abrasions to the right leg") then gosub HEALSELF "right leg" 0
     if contains("%wounds", "some minor abrasions to the left leg") then gosub HEALSELF "left leg" 0
     if contains("%wounds", "some minor abrasions to the right hand") then gosub HEALSELF "right hand" 0
     if contains("%wounds", "some minor abrasions to the left hand") then gosub HEALSELF "left hand" 0
     if contains("%wounds", "some minor abrasions to the tail") then gosub HEALSELF "tail" 0
     return
checkMajorScars:
     if contains("%wounds", "severe skin loss exposing bone and internal organs") then gosub HEALSELF "skin" 6
     if contains("%wounds", "a stump for a head") then gosub HEALSELF "head" 6
     if contains("%wounds", "an ugly flesh stump for a neck with little left to support the head") then gosub HEALSELF "neck" 6
     if contains("%wounds", "an mostly non-existent chest area filled with ugly chunks of scared flesh") then gosub HEALSELF "chest" 6
     if contains("%wounds", "an mostly non-existent abdomen filled with ugly chunks of scared flesh") then gosub HEALSELF "abdomen" 6
     if contains("%wounds", "an mostly non-existent back filled with ugly chunks of scared flesh and rearranged bone") then gosub HEALSELF "back" 6
     if contains("%wounds", "an empty right eye socket overgrown with bits of odd shaped flesh") then gosub HEALSELF "right eye" 6
     if contains("%wounds", "an empty left eye socket overgrown with bits of odd shaped flesh") then gosub HEALSELF "left eye" 6
     if contains("%wounds", "an ugly flesh stump for a right arm") then gosub HEALSELF "right arm" 6
     if contains("%wounds", "an ugly flesh stump for a left arm") then gosub HEALSELF "left arm" 6
     if contains("%wounds", "an ugly flesh stump for a right leg") then gosub HEALSELF "right leg" 6
     if contains("%wounds", "an ugly flesh stump for a left leg") then gosub HEALSELF "left leg" 6
     if contains("%wounds", "an ugly flesh stump for a right hand") then gosub HEALSELF "right hand" 6
     if contains("%wounds", "an ugly flesh stump for a left hand") then gosub HEALSELF "left hand" 6
     if contains("%wounds", "an ugly flesh stump for a tail") then gosub HEALSELF "tail" 6
     if contains("%wounds", "general numbness all over and have difficulty thinking") then gosub HEALSELF "skin" 6
     if contains("%wounds", "a blank stare") then gosub HEALSELF "head" 6
     if contains("%wounds", "a completely paralyzed neck") then gosub HEALSELF "neck" 6
     if contains("%wounds", "an extremely painful chest while gasping for breath in short shallow bursts") then gosub HEALSELF "chest" 6
     if contains("%wounds", "a death pallor and a extreme loss of weight") then gosub HEALSELF "abdomen" 6
     if contains("%wounds", "an extremely painful and bizarrely twisted back making it nearly impossible to move") then gosub HEALSELF "back" 6
     if contains("%wounds", "a blind right eye") then gosub HEALSELF "right eye" 6
     if contains("%wounds", "a blind left eye") then gosub HEALSELF "left eye" 6
     if contains("%wounds", "a completely paralyzed right arm") then gosub HEALSELF "right arm" 6
     if contains("%wounds", "a completely paralyzed left arm") then gosub HEALSELF "left arm" 6
     if contains("%wounds", "a completely paralyzed right leg") then gosub HEALSELF "right leg" 6
     if contains("%wounds", "a completely paralyzed left leg") then gosub HEALSELF "left leg" 6
     if contains("%wounds", "a completely paralyzed right hand") then gosub HEALSELF "right hand" 6
     if contains("%wounds", "a completely paralyzed left hand") then gosub HEALSELF "left hand" 6
     if contains("%wounds", "a completely paralyzed tail") then gosub HEALSELF "tail" 6
     if contains("%wounds", "severely stiff and shriveled skin that seems to be peeling off the body") then gosub HEALSELF "skin" 5
     if contains("%wounds", "a mangled and malformed head") then gosub HEALSELF "head" 5
     if contains("%wounds", "a severely scarred, mangled and malformed neck") then gosub HEALSELF "neck" 5
     if contains("%wounds", "a severely scarred, mangled and malformed chest area") then gosub HEALSELF "chest" 5
     if contains("%wounds", "a severely scarred, mangled and malformed abdomen") then gosub HEALSELF "abdomen" 5
     if contains("%wounds", "a severely scarred, mangled and malformed back") then gosub HEALSELF "back" 5
     if contains("%wounds", "a painfully mangled and malformed right eye in a shattered eye socket") then gosub HEALSELF "right eye" 5
     if contains("%wounds", "a painfully mangled and malformed left eye in a shattered eye socket") then gosub HEALSELF "left eye" 5
     if contains("%wounds", "a severely scarred, mangled and malformed right arm") then gosub HEALSELF "right arm" 5
     if contains("%wounds", "a severely scarred, mangled and malformed left arm") then gosub HEALSELF "left arm" 5
     if contains("%wounds", "a severely scarred, mangled and malformed right leg") then gosub HEALSELF "right leg" 5
     if contains("%wounds", "a severely scarred, mangled and malformed left leg") then gosub HEALSELF "left leg" 5
     if contains("%wounds", "a severely scarred, mangled and malformed right hand") then gosub HEALSELF "right hand" 5
     if contains("%wounds", "a severely scarred, mangled and malformed left hand") then gosub HEALSELF "left hand" 5
     if contains("%wounds", "a severely scarred, mangled and malformed tail") then gosub HEALSELF "tail" 5
     if contains("%wounds", "general numbness all over") then gosub HEALSELF "skin" 5
     if contains("%wounds", "a confused look with sporadic twitching of the forehead") then gosub HEALSELF "head" 5
     if contains("%wounds", "a severely paralyzed neck") then gosub HEALSELF "neck" 5
     if contains("%wounds", "a severely painful chest area with significant problems breathing") then gosub HEALSELF "chest" 5
     if contains("%wounds", "a severely yellow pallor and a look of starvation") then gosub HEALSELF "abdomen" 5
     if contains("%wounds", "a severely painful back with significant problems moving") then gosub HEALSELF "back" 5
     if contains("%wounds", "a completely clouded right eye") then gosub HEALSELF "right eye" 5
     if contains("%wounds", "a completely clouded left eye") then gosub HEALSELF "left eye" 5
     if contains("%wounds", "a severely paralyzed right arm") then gosub HEALSELF "right arm" 5
     if contains("%wounds", "a severely paralyzed left arm") then gosub HEALSELF "left arm" 5
     if contains("%wounds", "a severely paralyzed right leg") then gosub HEALSELF "right leg" 5
     if contains("%wounds", "a severely paralyzed left leg") then gosub HEALSELF "left leg" 5
     if contains("%wounds", "a severely paralyzed right hand") then gosub HEALSELF "right hand" 5
     if contains("%wounds", "a severely paralyzed left hand") then gosub HEALSELF "left hand" 5
     if contains("%wounds", "a severely paralyzed tail") then gosub HEALSELF "tail" 5
     if contains("%wounds", "some shriveled and oddly folded skin") then gosub HEALSELF "skin" 4
     if contains("%wounds", "missing chunks out of the head") then gosub HEALSELF "head" 4
     if contains("%wounds", "severe scarring and chunks of flesh missing from the neck") then gosub HEALSELF "neck" 4
     if contains("%wounds", "severe scarring and chunks of flesh missing from the chest area") then gosub HEALSELF "chest" 4
     if contains("%wounds", "severe scarring and chunks of flesh missing from the abdomen") then gosub HEALSELF "abdomen" 4
     if contains("%wounds", "severe scarring and chunks of flesh missing from the back") then gosub HEALSELF "back" 4
     if contains("%wounds", "a punctured and shriveled right eye") then gosub HEALSELF "right eye" 4
     if contains("%wounds", "a punctured and shriveled left eye") then gosub HEALSELF "left eye" 4
     if contains("%wounds", "severe scarring and chunks of flesh missing from the right arm") then gosub HEALSELF "right arm" 4
     if contains("%wounds", "severe scarring and chunks of flesh missing from the left arm") then gosub HEALSELF "left arm" 4
     if contains("%wounds", "severe scarring and chunks of flesh missing from the right leg") then gosub HEALSELF "right leg" 4
     if contains("%wounds", "severe scarring and chunks of flesh missing from the left leg") then gosub HEALSELF "left leg" 4
     if contains("%wounds", "severe scarring and chunks of flesh missing from the right hand") then gosub HEALSELF "right hand" 4
     if contains("%wounds", "severe scarring and chunks of flesh missing from the left hand") then gosub HEALSELF "left hand" 4
     if contains("%wounds", "severe scarring and chunks of flesh missing from the tail") then gosub HEALSELF "tail" 4
     if contains("%wounds", "numbness in the arms and legs") then gosub HEALSELF "skin" 4
     if contains("%wounds", "numbness in your arms and legs") then gosub HEALSELF "skin" 4
     if contains("%wounds", "partial paralysis around the head") then gosub HEALSELF "head" 4
     if contains("%wounds", "a partially paralyzed neck") then gosub HEALSELF "neck" 4
     if contains("%wounds", "a painful chest area and difficulty getting a breath without pain") then gosub HEALSELF "chest" 4
     if contains("%wounds", "a definite greenish pallor and emaciated look") then gosub HEALSELF "abdomen" 4
     if contains("%wounds", "a painful back and difficulty moving without pain") then gosub HEALSELF "back" 4
     if contains("%wounds", "a clouded right eye") then gosub HEALSELF "right eye" 4
     if contains("%wounds", "a clouded left eye") then gosub HEALSELF "left eye" 4
     if contains("%wounds", "a partially paralyzed right arm") then gosub HEALSELF "right arm" 4
     if contains("%wounds", "a partially paralyzed right arm") then gosub HEALSELF "right arm" 4
     if contains("%wounds", "a partially paralyzed left arm") then gosub HEALSELF "left arm" 4
     if contains("%wounds", "a partially paralyzed right leg") then gosub HEALSELF "right leg" 4
     if contains("%wounds", "a partially paralyzed left leg") then gosub HEALSELF "left leg" 4
     if contains("%wounds", "a partially paralyzed right hand") then gosub HEALSELF "right hand" 4
     if contains("%wounds", "a partially paralyzed left hand") then gosub HEALSELF "left hand" 4
     if contains("%wounds", "a partially paralyzed tail") then gosub HEALSELF "tail" 4
     return
checkModerateScars:
     if contains("%wounds", "severe skin discoloration") then gosub HEALSELF "skin" 3
     if contains("%wounds", "severe scarring and ugly gashes about the head") then gosub HEALSELF "head" 3
     if contains("%wounds", "severe scarring and ugly gashes about the neck") then gosub HEALSELF "neck" 3
     if contains("%wounds", "severe scarring and ugly gashes about the chest area") then gosub HEALSELF "chest" 3
     if contains("%wounds", "severe scarring and ugly gashes about the abdomen") then gosub HEALSELF "abdomen" 3
     if contains("%wounds", "severe scarring and ugly gashes about the back") then gosub HEALSELF "back" 3
     if contains("%wounds", "deeply scared gashes across the right eye") then gosub HEALSELF "right eye" 3
     if contains("%wounds", "deeply scared gashes across the left eye") then gosub HEALSELF "left eye" 3
     if contains("%wounds", "severe scarring and ugly gashes about the right arm") then gosub HEALSELF "right arm" 3
     if contains("%wounds", "severe scarring and ugly gashes about the left arm") then gosub HEALSELF "left arm" 3
     if contains("%wounds", "severe scarring and ugly gashes about the right leg") then gosub HEALSELF "right leg" 3
     if contains("%wounds", "severe scarring and ugly gashes about the left leg") then gosub HEALSELF "left leg" 3
     if contains("%wounds", "severe scarring and ugly gashes about the right hand") then gosub HEALSELF "right hand" 3
     if contains("%wounds", "severe scarring and ugly gashes about the left hand") then gosub HEALSELF "left hand" 3
     if contains("%wounds", "severe scarring and ugly gashes about the tail") then gosub HEALSELF "tail" 3
     if contains("%wounds", "numbness in the fingers and toes") then gosub HEALSELF "skin" 3
     if contains("%wounds", "numbness in your fingers and toes") then gosub HEALSELF "skin" 3
     if contains("%wounds", "an occasional twitch on the forehead") then gosub HEALSELF "head" 3
     if contains("%wounds", "a constant twitching in the neck") then gosub HEALSELF "neck" 3
     if contains("%wounds", "a constant twitching in the chest area and difficulty breathing") then gosub HEALSELF "chest" 3
     if contains("%wounds", "a somewhat emaciated look") then gosub HEALSELF "abdomen" 3
     if contains("%wounds", "a constant twitching in the back and difficulty moving in general") then gosub HEALSELF "back" 3
     if contains("%wounds", "a constant twitching in the right eye") then gosub HEALSELF "right eye" 3
     if contains("%wounds", "a constant twitching in the left eye") then gosub HEALSELF "left eye" 3
     if contains("%wounds", "a constant twitching in the right arm") then gosub HEALSELF "right arm" 3
     if contains("%wounds", "a constant twitching in the left arm") then gosub HEALSELF "left arm" 3
     if contains("%wounds", "a constant twitching in the right leg") then gosub HEALSELF "right leg" 3
     if contains("%wounds", "a constant twitching in the left leg") then gosub HEALSELF "left leg" 3
     if contains("%wounds", "a constant twitching in the right hand") then gosub HEALSELF "right hand" 3
     if contains("%wounds", "a constant twitching in the left hand") then gosub HEALSELF "left hand" 3
     if contains("%wounds", "a constant twitching in the tail") then gosub HEALSELF "tail" 3
     if contains("%wounds", "severe scarring about the head") then gosub HEALSELF "head" 2
     if contains("%wounds", "severe scarring along the neck") then gosub HEALSELF "neck" 2
     if contains("%wounds", "severe scarring along the chest area") then gosub HEALSELF "chest" 2
     if contains("%wounds", "severe scarring along the abdomen") then gosub HEALSELF "abdomen" 2
     if contains("%wounds", "severe scarring along the back") then gosub HEALSELF "back" 2
     if contains("%wounds", "severe scarring across the right eye") then gosub HEALSELF "right eye" 2
     if contains("%wounds", "severe scarring across the left eye") then gosub HEALSELF "left eye" 2
     if contains("%wounds", "severe scarring along the right arm") then gosub HEALSELF "right arm" 2
     if contains("%wounds", "severe scarring along the left arm") then gosub HEALSELF "left arm" 2
     if contains("%wounds", "severe scarring along the right leg") then gosub HEALSELF "right leg" 2
     if contains("%wounds", "severe scarring along the left leg") then gosub HEALSELF "left leg" 2
     if contains("%wounds", "severe scarring along the right hand") then gosub HEALSELF "right hand" 2
     if contains("%wounds", "severe scarring along the left hand") then gosub HEALSELF "left hand" 2
     if contains("%wounds", "severe scarring along the tail") then gosub HEALSELF "tail" 2
     if contains("%wounds", "slight numbness in the arms and legs") then gosub HEALSELF "skin" 2
     if contains("%wounds", "slight numbness in your arms and legs") then gosub HEALSELF "skin" 2
     if contains("%wounds", "an occasional twitch on the forehead") then gosub HEALSELF "head" 2
     if contains("%wounds", "a constant twitching in the neck") then gosub HEALSELF "neck" 2
     if contains("%wounds", "a constant twitching in the chest area") then gosub HEALSELF "chest" 2
     if contains("%wounds", "a constant twitching in the abdomen") then gosub HEALSELF "abdomen" 2
     if contains("%wounds", "a constant twitching in the back") then gosub HEALSELF "back" 2
     if contains("%wounds", "a constant twitching in the right eye") then gosub HEALSELF "right eye" 2
     if contains("%wounds", "a constant twitching in the left eye") then gosub HEALSELF "left eye" 2
     if contains("%wounds", "a constant twitching in the right arm") then gosub HEALSELF "right arm" 2
     if contains("%wounds", "a constant twitching in the left arm") then gosub HEALSELF "left arm" 2
     if contains("%wounds", "a constant twitching in the right leg") then gosub HEALSELF "right leg" 2
     if contains("%wounds", "a constant twitching in the left leg") then gosub HEALSELF "left leg" 2
     if contains("%wounds", "a constant twitching in the right hand") then gosub HEALSELF "right hand" 2
     if contains("%wounds", "a constant twitching in the left hand") then gosub HEALSELF "left hand" 2
     if contains("%wounds", "a constant twitching in the tail") then gosub HEALSELF "tail" 2
     return
checkMinorScars:
     if contains("%wounds", "minor scars about the head") then gosub HEALSELF "head" 1
     if contains("%wounds", "minor scarring along the neck") then gosub HEALSELF "neck" 1
     if contains("%wounds", "minor scarring along the chest area") then gosub HEALSELF "chest" 1
     if contains("%wounds", "minor scarring along the abdomen") then gosub HEALSELF "abdomen" 1
     if contains("%wounds", "minor scarring along the back") then gosub HEALSELF "back" 1
     if contains("%wounds", "minor scars across the right eye") then gosub HEALSELF "right eye" 1
     if contains("%wounds", "minor scars across the left eye") then gosub HEALSELF "left eye" 1
     if contains("%wounds", "minor scarring along the right arm") then gosub HEALSELF "right arm" 1
     if contains("%wounds", "minor scarring along the left arm") then gosub HEALSELF "left arm" 1
     if contains("%wounds", "minor scarring along the right leg") then gosub HEALSELF "right leg" 1
     if contains("%wounds", "minor scarring along the left leg") then gosub HEALSELF "left leg" 1
     if contains("%wounds", "minor scarring along the right hand") then gosub HEALSELF "right hand" 1
     if contains("%wounds", "minor scarring along the left hand") then gosub HEALSELF "left hand" 1
     if contains("%wounds", "minor scarring along the tail") then gosub HEALSELF "tail" 1
     if contains("%wounds", "slight numbness in the fingers and toes") then gosub HEALSELF "skin" 1
     if contains("%wounds", "slight numbness in your fingers and toes") then gosub HEALSELF "skin" 1
     if contains("%wounds", "an occasional twitching of the head") then gosub HEALSELF "head" 1
     if contains("%wounds", "an occasional twitching in the neck") then gosub HEALSELF "neck" 1
     if contains("%wounds", "an occasional twitching in the chest area") then gosub HEALSELF "chest" 1
     if contains("%wounds", "an occasional twitching in the abdomen") then gosub HEALSELF "abdomen" 1
     if contains("%wounds", "an occasional twitching in the back") then gosub HEALSELF "back" 1
     if contains("%wounds", "an occasional twitching in the right eye") then gosub HEALSELF "right eye" 1
     if contains("%wounds", "an occasional twitching in the left eye") then gosub HEALSELF "left eye" 1
     if contains("%wounds", "an occasional twitching in the right arm") then gosub HEALSELF "right arm" 1
     if contains("%wounds", "an occasional twitching in the left arm") then gosub HEALSELF "left arm" 1
     if contains("%wounds", "an occasional twitching in the right leg") then gosub HEALSELF "right leg" 1
     if contains("%wounds", "an occasional twitching in the left leg") then gosub HEALSELF "left leg" 1
     if contains("%wounds", "an occasional twitching in the right hand") then gosub HEALSELF "right hand" 1
     if contains("%wounds", "an occasional twitching in the left hand") then gosub HEALSELF "left hand" 1
     if contains("%wounds", "an occasional twitching in the tail") then gosub HEALSELF "tail" 1
     if contains("%wounds", "some tiny scars across the head") then gosub HEALSELF  "head" 0
     if contains("%wounds", "some tiny scars across the neck") then gosub HEALSELF  "neck" 0
     if contains("%wounds", "some tiny scars across the chest") then gosub HEALSELF  "chest" 0
     if contains("%wounds", "some tiny scars across the abdomen") then gosub HEALSELF  "abdomen" 0
     if contains("%wounds", "some tiny scars across the back") then gosub HEALSELF  "back" 0
     if contains("%wounds", "some tiny scars across the right eye") then gosub HEALSELF  "right eye" 0
     if contains("%wounds", "some tiny scars across the left eye") then gosub HEALSELF  "left eye" 0
     if contains("%wounds", "some tiny scars across the right arm") then gosub HEALSELF  "right arm" 0
     if contains("%wounds", "some tiny scars across the left arm") then gosub HEALSELF  "left arm" 0
     if contains("%wounds", "some tiny scars across the right leg") then gosub HEALSELF  "right leg" 0
     if contains("%wounds", "some tiny scars across the left leg") then gosub HEALSELF  "left leg" 0
     if contains("%wounds", "some tiny scars across the right hand") then gosub HEALSELF  "right hand" 0
     if contains("%wounds", "some tiny scars across the left hand") then gosub HEALSELF  "left hand" 0
     if contains("%wounds", "some tiny scars across the tail") then gosub HEALSELF  "tail" 0
     if contains("%wounds", "a few nearly invisible scars along the head") then gosub HEALSELF  "head" 0
     if contains("%wounds", "a few nearly invisible scars along the neck") then gosub HEALSELF  "neck" 0
     if contains("%wounds", "a few nearly invisible scars along the chest") then gosub HEALSELF  "chest" 0
     if contains("%wounds", "a few nearly invisible scars along the abdomen") then gosub HEALSELF  "abdomen" 0
     if contains("%wounds", "a few nearly invisible scars along the back") then gosub HEALSELF  "back" 0
     if contains("%wounds", "a few nearly invisible scars along the right eye") then gosub HEALSELF  "right eye" 0
     if contains("%wounds", "a few nearly invisible scars along the left eye") then gosub HEALSELF  "left eye" 0
     if contains("%wounds", "a few nearly invisible scars along the right arm") then gosub HEALSELF  "right arm" 0
     if contains("%wounds", "a few nearly invisible scars along the left arm") then gosub HEALSELF  "left arm" 0
     if contains("%wounds", "a few nearly invisible scars along the right leg") then gosub HEALSELF  "right leg" 0
     if contains("%wounds", "a few nearly invisible scars along the left leg") then gosub HEALSELF  "left leg" 0
     if contains("%wounds", "a few nearly invisible scars along the right hand") then gosub HEALSELF  "right hand" 0
     if contains("%wounds", "a few nearly invisible scars along the left hand") then gosub HEALSELF  "left hand" 0
     if contains("%wounds", "a few nearly invisible scars along the tail") then gosub HEALSELF  "tail" 0
     return
PERFORM_CONSUME:
     pause 0.1
     var consumeReady 0
     matchre PERFORM_CONSUME ^\.\.\.\wait|^Sorry\,
     matchre PERFORM_CONSUME_FAIL ^This ritual may only be performed on a corpse\.|You cannot
     matchre PERFORM_CONSUME_FAIL ^A failed or completed ritual has rendered this corpse unusable for your purposes\.
     matchre PERFORM_CONSUME_SUCCESS ^This corpse has already been prepared for consumption\.
     matchre PERFORM_CONSUME_SUCCESS ^You bend over .* corpse to make a few quick\, precise cuts with your ritual knife\, focusing your thanatological insight intently in order to allow you to drain the body's energies\.
     matchre PERFORM_CONSUME_SUCCESS ^You kneel over the .* corpse and make a few quick\, precise cuts with your ritual knife\.
     send perform consume on %Ritual.critter
     matchwait 20
     goto PERFORM_CONSUME_FAIL
PERFORM_CONSUME_SUCCESS:
     var consumeReady 1
     return
PERFORM_CONSUME_FAIL:
     var consumeReady 0
     return
############################################################################
ARRANGE_ALL_CHECK:
     pause 0.1
     # if ("$guild" = "Ranger") then goto ARRANGE_ALL_YES
     matchre ARRANGE_ALL_YES Leather Tanning Expertise
     send craft tailoring
     matchwait 2
     matchre ARRANGE_ALL_YES Basic Bone Collecting
     send craft carving
     matchwait 2
     goto ARRANGE_ALL_NO
ARRANGE_ALL_YES:
     put #var UC_ArrangeMax 1
     return
ARRANGE_ALL_NO:
     put #var UC_ArrangeMax 0
     return
##############################################################################################################################################################################################################################
##############################################################################################################################################################################################################################
##############################################################################################################################################################################################################################
##############################################################################################################################################################################################################################
##############################################################################################################################################################################################################################
### MAGIC SECTION
##############################################################################################################################################################################################################################
##############################################################################################################################################################################################################################
##############################################################################################################################################################################################################################
##############################################################################################################################################################################################################################
##############################################################################################################################################################################################################################
## Checks for all known spells and feats
SPELLS:
SPELL_CHECK:
    # debug 10
     delay 0.00001
     action (magic) on
     var spelltimer
     var spellCheck 1
     echo
     echo ###########################
     echo *** CHECKING KNOWN SPELLS / FEATS
     echo ###########################
     echo
     action var spelltimer %spelltimer|$1 when ^(?:From your apprenticeship you remember practicing with the|In the chapter entitled.*?you have notes on the)(.*)
     action var spelltimer %spelltimer|$1|$2 when You have temporarily memorized the (.*) and (.*)
     action var spelltimer %spelltimer|$1 when You have temporarily memorized the (.*) spell\.
     action var RawChanneling 1 when Raw Channeling
     action var DedicatedCamb 1 when Dedicated Cambrinth Use
     action var ExpansiveInfusions 1 when Expansive Infusions
     action var QuickInfusions 1 when Quick Infusions
     action var AugmentationMastery 1 when Augmentation Mastery
     action var Targeted_MagicMastery 1 when Targeted Mastery
     action var UtilityMastery 1 when Utility Mastery
     action var WardingMastery 1 when Warding Mastery
     action var DebilitationMastery 1 when Debilitation Mastery
     action var SorceryMastery 1 when Sorcerous Patterns
     action var BurningTouch 1 when Burning Touch
     pause 0.0001
     matchre SPELL_CHECK_2 Raw Channeling|You can use SPELL STANCE
     put spell
     matchwait 5
SPELL_CHECK_2:
     pause 0.0001
     pause 0.0001
     action remove Raw Channeling
     action remove Dedicated Cambrinth Use
     action remove Expansive Infusions
     action remove Quick Infusions
     action remove Augmentation Mastery
     action remove Targeted Mastery
     action remove Utility Mastery
     action remove Warding Mastery
     action remove Debilitation Mastery
     action remove Sorcerous Patterns
     action remove Burning Touch
     action remove You have temporarily memorized the (.*) spell\.
     action remove You have temporarily memorized the (.*) and (.*)
     action remove ^(?:From your apprenticeship you remember practicing with the|You have temporarily memorized the .+ and|In the chapter entitled.*?you have notes on the)(.*)
     if ("$guild" = "Bard") then var RawChanneling 1
     if (%RawChanneling = 1) then echo *** RAW CHANNELING FEAT ACTIVE
     if (%DedicatedCamb = 1) then echo *** DEDICATED CAMBRINTH FEAT ACTIVE
     if (%ExpansiveInfusions = 1) then echo *** EXPANSIVE INFUSIONS FEAT ACTIVE
     if (%QuickInfusions = 1) then echo *** QUICK INFUSIONS FEAT ACTIVE
     if (%AugmentationMastery = 1) then echo *** AUGMENTATION MASTERY ACTIVE
     if (%Targeted_MagicMastery = 1) then echo *** TARGETED MAGIC MASTERY ACTIVE
     if (%UtilityMastery = 1) then echo *** UTILITY MASTERY ACTIVE
     if (%WardingMastery = 1) then echo *** WARDING MASTERY ACTIVE
     if (%DebilitationMastery = 1) then echo *** DEBILITATION MASTERY ACTIVE
     if (%BurningTouch = 1) then echo *** BURNING TOUCH CANTRIP ACTIVE
SPELL_CHECK_3:
     eval spelltimer replacere("%spelltimer", "[,\.](?: (?<!\w)and(?!\w))?|(?<!\w)and(?!\w)", "|")
     eval spelltimer replacere("%spelltimer", "\s|['-]|(?<!\w)spells?(?!\w)", "")
     eval spelltimer replacere("%spelltimer", "\|\|", "|")
     var abbrevs %spelltimer
     eval spelltimer replacere("%spelltimer", "\[.*?\]", "")
     eval abbrevs replacere("%abbrevs", "\|\w+\[", "|[")
     eval abbrevs replacere("%abbrevs", "\[|\]", "")
     eval abbrevs replacere("%abbrevs", "^\||\|$", "")
     eval spelltimer replacere("%spelltimer", "^\||\|$", "")
     eval abbrevs toupper("%abbrevs")
     # put #echo %spelltimer
     # put #echo %abbrevs
     echo
     echo #############################################################
     echo #############################################################
     echo ** ALL KNOWN SPELLS (SpellTimer name): %spelltimer
     echo ** ABBREVIATIONS: %abbrevs
     echo #############################################################
     echo #############################################################
     echo
     pause 0.0001
     if ("$guild" = "Warrior Mage") then
          {
               if !matchre("%spelltimer", "ExpansiveInfusions") then var SummonWeapons OFF
               if matchre("%spelltimer", "ExpansiveInfusions") then var ExpansiveInfusions 1
          }
     if ("$guild" = "Empath") then
          {
               var ABSOLUTION 0
               if matchre("%abbrevs", "(?i)ABSOLUTION") then var ABSOLUTION 1
               if matchre("%spelltimer", "(?i)ABSOLUTION") then var ABSOLUTION 1
          }
     return
SPELL_CHECK_4:
     if (%l > %totalspells) then return
     if matchre("%%GuildType.Buffs", "\b(?i)%abbrevs(%l)\b") then
          {
               var buffabbrevs %buffabbrevs|%abbrevs(%l)
               var buffs %buffs|%spelltimer(%l)
          }
     math l add 1
     goto spell_check_4

### SPELL SETUP
SPELL_SETUP_START:
     action (magic) on
     action (retreat) on
     var NOCAST 0
     if matchre("%command", "(?i)SPELL") then
          {
               var SMART.SPELLS ON
               put #var UC_SmartSpells 1
               echo
               echo ########################
               echo **   ~SPELL~ COMMAND UTILIZED!
               echo ** RESETTING MANA FOR COMBAT SPELLS!
               echo ########################
               echo
               pause 0.1
          }
     #####
     eval %GuildType.Target.Spell toupper("%%GuildType.Target.Spell")
     eval %GuildType.Debilitation.Spell toupper("%%GuildType.Debilitation.Spell")
     eval %GuildType.Utility.Spell toupper("%%GuildType.Utility.Spell")
     eval %GuildType.Warding.Spell toupper("%%GuildType.Warding.Spell")
     eval %GuildType.Sorcery.Spell toupper("%%GuildType.Sorcery.Spell")
     eval %GuildType.Augmentation.Spell toupper("%%GuildType.Augmentation.Spell")
     #####
     put #var %GuildType.Augmentation.Spell %%GuildType.Augmentation.Spell
     put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell
     put #var %GuildType.Utility.Spell %%GuildType.Utility.Spell
     put #var %GuildType.Warding.Spell %%GuildType.Warding.Spell
     put #var %GuildType.Target.Spell %%GuildType.Target.Spell
     put #var %GuildType.Sorcery.Spell %%GuildType.Sorcery.Spell
     if ($Attunement.Ranks < 200) then
          {
               var Target.Symbiosis OFF
               var Utility.Symbiosis OFF
               var Augmentation.Symbiosis OFF
               var Warding.Symbiosis OFF
               var Sorcery.Symbiosis OFF
               var Debilitation.Symbiosis OFF
               var Symbiosis.Buffs OFF
          }
     ### SET NULL SPELLS OFF
     if matchre("%%GuildType.Target.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var TargetON 0
               put #var %GuildType.Target.Spell NULL
               var %GuildType.Target.Spell NULL
          }
     if matchre("%%GuildType.Debilitation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var DebilitationON 0
               put #var %GuildType.Debilitation.Spell NULL
               var %GuildType.Debilitation.Spell NULL
          }
     if matchre("%%GuildType.Utility.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var UtilityON 0
               put #var %GuildType.Utility.Spell NULL
               var %GuildType.Utility.Spell NULL
          }
     if matchre("%%GuildType.Warding.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var WardingON 0
               put #var %GuildType.Warding.Spell NULL
               var %GuildType.Warding.Spell NULL
          }
     if matchre("%%GuildType.Augmentation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var AugmentationON 0
               put #var %GuildType.Augmentation.Spell NULL
               var %GuildType.Augmentation.Spell NULL
          }
     if matchre("%%GuildType.Sorcery.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var SorceryON 0
               put #var %GuildType.Sorcery.Spell NULL
               var %GuildType.Sorcery.Spell NULL
          }
     echo
     echo ##########################################
     echo *** OFFENSIVE SPELLS WE HAVE SET:
     echo *** $%GuildType.Augmentation.Spell - $%GuildType.Debilitation.Spell - $%GuildType.Utility.Spell - $%GuildType.Warding.Spell - $%GuildType.Target.Spell - $%GuildType.Sorcery.Spell
     echo ##########################################
     echo
     delay 0.00001
	### Reorder Spell Array based on Ranks
     var lowarray
     var temparray %SpellArray
     ## eval temparray replacere("%temparray", "Target", "Targeted_Magic")
     ## eval temparray replacere("%temparray", "_", " ")
     ## action (magic) var lowarray $1|%lowarray when ^(%temparray)\s+-
     gosub LowRanks "%temparray" magic
	var SpellArray %lowarray
     action remove ^(%temparray)\s+-
     ### SET SPELLS ON
     if !matchre("$%GuildType.Target.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then var TargetON 1
     if !matchre("$%GuildType.Debilitation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then var DebilitationON 1
     if !matchre("$%GuildType.Augmentation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then var AugmentationON 1
     if !matchre("$%GuildType.Utility.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then var UtilityON 1
     if !matchre("$%GuildType.Warding.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then var WardingON 1
     if !matchre("$%GuildType.Sorcery.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then var SorceryON 1
     ################################################################
     if ($UC_SmartSpells = 1) then
          {
               echo
               echo ########################
               echo * SMART SPELLS VAR IS -ON-
               echo * ANALYZING OFFENSIVE SPELLS
               echo * TO DETERMINE OPTIMAL SPELL MANA
               echo ########################
               echo
               delay 0.01
          }
#######################################################################################################
### MULTI SPELL PARSE
### THIS ANALYZES IF ANY SINGLE SPELL VARS HAVE AN ARRAY, THEN SETS UP MULTIPLE COUNTS FOR THAT SPELL
### CREATES A COUNT FOR EACH SPELL Ex. SorceryCount = 0 (Only 1 Spell) /  SorceryCount = 1 (2 Sorcery Spell)
MULTI_SPELL_PARSE:
     #debug 10
     var SpellCheckLoop 0
     var TargetCount 0
     var DebilCount 0
     var AugmentCount 0
     var UtilCount 0
     var WardingCount 0
     var SorceryCount 0
     var Target.Spell.0 0
     var Target.Spell.1 0
     var Target.Spell.2 0
     var Target.Spell.3 0
     var Debilitation.Spell.0 0
     var Debilitation.Spell.1 0
     var Debilitation.Spell.2 0
     var Debilitation.Spell.3 0
     eval TargetCount count("$%GuildType.Target.Spell", "|")
     eval DebilCount count("$%GuildType.Debilitation.Spell", "|")
     eval AugmentCount count("$%GuildType.Augmentation.Spell", "|")
     eval UtilCount count("$%GuildType.Utility.Spell", "|")
     eval WardingCount count("$%GuildType.Warding.Spell", "|")
     eval SorceryCount count("$%GuildType.Sorcery.Spell", "|")
     evalmath actualCount (%SpellCheckLoop + 1)
     echo ################################
     if (%TargetCount > 0) then
          {
               echo *** Targetted Spells: %%GuildType.Target.Spell
               gosub MULTI_SPELL_LOOP Target TargetCount
          }
     if (%DebilCount > 0) then
          {
               echo *** Debilitation Spells: %%GuildType.Debilitation.Spell
               gosub MULTI_SPELL_LOOP Debilitation DebilCount
          }
     if (%AugmentCount > 0) then
          {
               echo *** Augmentation Spells: %%GuildType.Augmentation.Spell
               gosub MULTI_SPELL_LOOP Augmentation AugmentCount
          }
     if (%UtilCount > 0) then
          {
               echo *** Utility Spells: %%GuildType.Utility.Spell
               gosub MULTI_SPELL_LOOP Utility UtilCount
          }
     if (%WardingCount > 0) then
          {
               echo *** Warding Spells: %%GuildType.Warding.Spell
               gosub MULTI_SPELL_LOOP Warding WardingCount
          }
     if (%SorceryCount > 0) then
          {
               echo *** Sorcery Spells: %%GuildType.Sorcery.Spell
               gosub MULTI_SPELL_LOOP Sorcery SorceryCount
          }
     echo ################################
     echo
     goto SPELL_SETUP_CONT
MULTI_SPELL_LOOP:
     var Skill $1
     var CountSkill $2
MULTI_SPELL_LOOP_1:
     pause 0.0001
     if (%SpellCheckLoop > %%CountSkill) then goto MULTI_SPELL_RETURN
     if (%SpellCheckLoop > 3) then goto MULTI_SPELL_RETURN
     echo *** %Skill.Spell.%SpellCheckLoop = $%GuildType.%Skill.Spell(%SpellCheckLoop)
     var %Skill.Spell.%SpellCheckLoop $%GuildType.%Skill.Spell(%SpellCheckLoop)
     math SpellCheckLoop add 1
     goto MULTI_SPELL_LOOP_1
MULTI_SPELL_RETURN:
     var SpellCheckLoop 0
     return
##################################################################################################
## END OF MULTI SPELL PARSE - CONTINUE WITH SPELL SETUP
SPELL_SETUP_CONT:
     delay 0.0001
     var SpellCheckLoop 0
SPELL_SETUP_CONT_1:
############################################################################################################
     ### HARD SET ALL GUILD SPELL VARS TO GLOBALS HERE
     if (%TargetCount > 0) then
          {
               put #var %GuildType.Target.Spell %%GuildType.Target.Spell(%SpellCheckLoop)
          }
     else put #var %GuildType.Target.Spell %%GuildType.Target.Spell
     if (%DebilCount > 0) then
          {
               put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(%SpellCheckLoop)
          }
     else put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell
     if (%AugmentCount > 0) then
          {
               put #var %GuildType.Augmentation.Spell %%GuildType.Augmentation.Spell(%SpellCheckLoop)
          }
     else put #var %GuildType.Augmentation.Spell %%GuildType.Augmentation.Spell
     if (%UtilCount > 0) then
          {
               put #var %GuildType.Utility.Spell %%GuildType.Utility.Spell(%SpellCheckLoop)
          }
     else put #var %GuildType.Utility.Spell %%GuildType.Utility.Spell
     if (%WardingCount > 0) then
          {
               put #var %GuildType.Warding.Spell %%GuildType.Warding.Spell(%SpellCheckLoop)
          }
     else put #var %GuildType.Warding.Spell %%GuildType.Warding.Spell
     if (%SorceryCount > 0) then
          {
               put #var %GuildType.Sorcery.Spell %%GuildType.Sorcery.Spell(%SpellCheckLoop)
          }
     else put #var %GuildType.Sorcery.Spell %%GuildType.Sorcery.Spell
     delay 0.0001
############################################################################################################
     ### TURN OFF MAGIC SCHOOL COMPLETELY IF SPELL WE SET IS UNKNOWN ~~~
     if (!matchre("$%GuildType.Target.Spell", "(?i)(%abbrevs|%spelltimer|NULL)") && !matchre("$%GuildType.Target.Spell", "(?i)%Magic.Tattoo") && !matchre("%buffs", "(?i)%Magic.Tattoo")) then
          {
               echo ** $%GuildType.Target.Spell is not known - Removing from vars
               var TargetON 0
               put #var %GuildType.Target.Spell NULL
               var GuildType.Target.Spell NULL
          }
     if (!matchre("$%GuildType.Debilitation.Spell", "(?i)(%abbrevs|%spelltimer|NULL)") && !matchre("$%GuildType.Debilitation.Spell", "(?i)%Magic.Tattoo") && !matchre("%buffs", "(?i)%Magic.Tattoo")) then
          {
               echo ** $%GuildType.Debilitation.Spell is not known - Removing from vars
               var DebilitationON 0
               put #var %GuildType.Debilitation.Spell NULL
               var GuildType.Debilitation.Spell NULL
          }
     if (!matchre("$%GuildType.Utility.Spell", "(?i)(%abbrevs|%spelltimer|NULL)") && !matchre("$%GuildType.Utility.Spell", "(?i)%Magic.Tattoo") && !matchre("%buffs", "(?i)%Magic.Tattoo")) then
          {
               echo ** $%GuildType.Utility.Spell is not known - Removing from vars
               var UtilityON 0
               put #var %GuildType.Utility.Spell NULL
               var GuildType.Utility.Spell NULL
          }
     if (!matchre("$%GuildType.Warding.Spell", "(?i)(%abbrevs|%spelltimer|NULL)") && !matchre("$%GuildType.Warding.Spell", "(?i)%Magic.Tattoo") && !matchre("%buffs", "(?i)%Magic.Tattoo")) then
          {
               echo ** $%GuildType.Warding.Spell is not known - Removing from vars
               var WardingON 0
               put #var %GuildType.Warding.Spell NULL
               var GuildType.Warding.Spell NULL
          }
     if (!matchre("$%GuildType.Augmentation.Spell", "(?i)(%abbrevs|%spelltimer|NULL)") && !matchre("$%GuildType.Augmentation.Spell", "(?i)%Magic.Tattoo") && !matchre("%buffs", "(?i)%Magic.Tattoo")) then
          {
               echo ** $%GuildType.Augmentation.Spell is not known - Removing from vars
               var AugmentationON 0
               put #var %GuildType.Augmentation.Spell NULL
               var GuildType.Augmentation.Spell NULL
          }
     if (!matchre("$%GuildType.Sorcery.Spell", "(?i)(%abbrevs|%spelltimer|NULL)") && !matchre("$%GuildType.Sorcery.Spell", "(?i)%Magic.Tattoo") && !matchre("%buffs", "(?i)%Magic.Tattoo")) then
          {
               echo ** $%GuildType.Sorcery.Spell is not known - Removing from vars
               var SorceryON 0
               put #var %GuildType.Sorcery.Spell NULL
               var GuildType.Sorcery.Spell NULL
          }
     delay 0.00001
####################################################################################
# SPECIAL SECTION TO CALCULATE SPECIFIC GUILD SPELLS THE SCRIPT USES
     if ("$guild" = "Warrior Mage") then
          {
               if !matchre("%ChargeSpell", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
                    {
                         eval ChargeSpell toupper("%ChargeSpell")
                         gosub SPELLMATH %ChargeSpell
                         put #var Mana.%ChargeSpell %spellCMax
                         put #var Camb.%ChargeSpell %spellResplit
                         echo
                         echo ################################
                         echo **** SETTING %ChargeSpell spell to %spellCMax Mana
                         echo **** SETTING %ChargeSpell cambrinth to %spellResplit Mana
                         echo ################################
                         echo
                    }
          }
     if ("$guild" = "Empath") then
               {
                    if (matchre("%Undead", "($UC_combatCritter|$UC_backtrainCritter)") && (%ABSOLUTION = 0)) then goto ABSOLUTION_ERROR
                    if matchre("%Undead", "($UC_combatCritter|$UC_backtrainCritter)") then
                         {
                              gosub SPELLMATH Absolution
                              put #var Mana.ABSOLUTION %spellCMax
                              put #var Camb.ABSOLUTION %spellResplit
                              echo
                              echo ################################
                              echo **** SETTING ABSOLUTION spell to %spellCMax Mana
                              echo **** SETTING ABSOLUTION cambrinth to %spellResplit Mana
                              echo ################################
                              echo
                         }
                    if matchre("%abbrevs", "(?i)HEAL") then
                         {
                              gosub SPELLMATH Heal
                              put #var Mana.HEAL %spellCMax
                              put #var Camb.HEAL %spellResplit
                              echo
                              echo ################################
                              echo **** SETTING HEAL spell to %spellCMax Mana
                              echo **** SETTING HEAL cambrinth to %spellResplit Mana
                              echo ################################
                              echo
                         }
                    if matchre("%abbrevs", "(?i)REGEN") then
                         {
                              gosub SPELLMATH regen
                              put #var Mana.REGENERATION %spellCMax
                              put #var Camb.REGENERATION %spellResplit
                              echo
                              echo ###################################
                              echo **** SETTING REGENERATION spell to %spellCMax Mana
                              echo ###################################
                              echo
                         }
               }
     if matchre("$%GuildType.Target.Spell", "(?i)(TKT|TKS)") then var Dump.Combat 0
     if matchre("$%GuildType.Sorcery.Spell", "(?i)(TKT|TKS)") then var Dump.Combat 0
     if ((%TargetCount > 0) || (%SorceryCount > 0)) then
          {
               if matchre("%%GuildType.Target.Spell(0)", "(?i)(TKT|TKS)") then var Dump.Combat 0
               if matchre("%%GuildType.Target.Spell(1)", "(?i)(TKT|TKS)") then var Dump.Combat 0
               if matchre("%%GuildType.Target.Spell(2)", "(?i)(TKT|TKS)") then var Dump.Combat 0
               if matchre("%%GuildType.Sorcery.Spell(0)", "(?i)(TKT|TKS)") then var Dump.Combat 0
               if matchre("%%GuildType.Sorcery.Spell(1)", "(?i)(TKT|TKS)") then var Dump.Combat 0
               if matchre("%%GuildType.Sorcery.Spell(2)", "(?i)(TKT|TKS)") then var Dump.Combat 0
          }
     if ($UC_SmartSpells = 0) then goto SPELL_RETURN_NOSMART
######################################################
# THIS IS WHERE SMART MANA WILL CACLULATE MANA FOR EACH SPELL IN EACH SCHOOL
     if (%TargetON = 1) then gosub SPELL_SETUP Target
	if (%DebilitationON = 1) then gosub SPELL_SETUP Debilitation
	if (%UtilityON = 1) then gosub SPELL_SETUP Utility
	if (%WardingON = 1) then gosub SPELL_SETUP Warding
     if (%AugmentationON = 1) then gosub SPELL_SETUP Augmentation
	if (%SorceryON = 1) then gosub SPELL_SETUP Sorcery
######################################################
# IF WE HAVE MULTIPLE SPELLS SETUP FOR A SINGLE SCHOOL THEN CALCULATE EACH ONE HERE - MAX OF 3
MULTI_SPELL_SETUP:
     var SpellCheckLoop 1
     if (%TargetCount > 0) then
          {
               put #var %GuildType.Target.Spell %%GuildType.Target.Spell(%SpellCheckLoop)
               gosub SPELL_SETUP Target
               if (%TargetCount > 1) then
                    {
                         math SpellCheckLoop add 1
                         put #var %GuildType.Target.Spell %%GuildType.Target.Spell(%SpellCheckLoop)
                         gosub SPELL_SETUP Target
                    }
               if (%TargetCount > 2) then
                    {
                         math SpellCheckLoop add 1
                         put #var %GuildType.Target.Spell %%GuildType.Target.Spell(%SpellCheckLoop)
                         gosub SPELL_SETUP Target
                    }
          var SpellCheckLoop 1
          }
     if (%DebilCount > 0) then
          {
               put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(%SpellCheckLoop)
               gosub SPELL_SETUP Debilitation
               if (%DebilCount > 1) then
                    {
                         math SpellCheckLoop add 1
                         put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(%SpellCheckLoop)
                         gosub SPELL_SETUP Target
                    }
               if (%DebilCount > 2) then
                    {
                         math SpellCheckLoop add 1
                         put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(%SpellCheckLoop)
                         gosub SPELL_SETUP Debilitation
                    }
          var SpellCheckLoop 1
          }
     if (%AugmentCount > 0) then
          {
               put #var %GuildType.Augmentation.Spell %%GuildType.Augmentation.Spell(%SpellCheckLoop)
               gosub SPELL_SETUP Augmentation
               if (%DebilCount > 1) then
                    {
                         math SpellCheckLoop add 1
                         put #var %GuildType.Augmentation.Spell %%GuildType.Augmentation.Spell(%SpellCheckLoop)
                         gosub SPELL_SETUP Augmentation
                    }
               if (%DebilCount > 2) then
                    {
                         math SpellCheckLoop add 1
                         put #var %GuildType.Augmentation.Spell %%GuildType.Augmentation.Spell(%SpellCheckLoop)
                         gosub SPELL_SETUP Augmentation
                    }
          var SpellCheckLoop 1
          }
     if (%WardingCount > 0) then
          {
               put #var %GuildType.Warding.Spell %%GuildType.Warding.Spell(%SpellCheckLoop)
               gosub SPELL_SETUP Warding
               if (%DebilCount > 1) then
                    {
                         math SpellCheckLoop add 1
                         put #var %GuildType.Warding.Spell %%GuildType.Warding.Spell(%SpellCheckLoop)
                         gosub SPELL_SETUP Warding
                    }
               if (%DebilCount > 2) then
                    {
                         math SpellCheckLoop add 1
                         put #var %GuildType.Warding.Spell %%GuildType.Warding.Spell(%SpellCheckLoop)
                         gosub SPELL_SETUP Warding
                    }
          var SpellCheckLoop 1
          }
     if (%UtilCount > 0) then
          {
               put #var %GuildType.Utility.Spell %%GuildType.Utility.Spell(%SpellCheckLoop)
               gosub SPELL_SETUP Utility
               if (%DebilCount > 1) then
                    {
                         math SpellCheckLoop add 1
                         put #var %GuildType.Utility.Spell %%GuildType.Utility.Spell(%SpellCheckLoop)
                         gosub SPELL_SETUP Utility
                    }
               if (%DebilCount > 2) then
                    {
                         math SpellCheckLoop add 1
                         put #var %GuildType.Utility.Spell %%GuildType.Utility.Spell(%SpellCheckLoop)
                         gosub SPELL_SETUP Utility
                    }
          var SpellCheckLoop 1
          }
     if (%SorceryCount > 0) then
          {
               put #var %GuildType.Sorcery.Spell %%GuildType.Sorcery.Spell(%SpellCheckLoop)
               gosub SPELL_SETUP Sorcery
               if (%DebilCount > 1) then
                    {
                         math SpellCheckLoop add 1
                         put #var %GuildType.Sorcery.Spell %%GuildType.Sorcery.Spell(%SpellCheckLoop)
                         gosub SPELL_SETUP Sorcery
                    }
               if (%DebilCount > 2) then
                    {
                         math SpellCheckLoop add 1
                         put #var %GuildType.Sorcery.Spell %%GuildType.Sorcery.Spell(%SpellCheckLoop)
                         gosub SPELL_SETUP Sorcery
                    }
          var SpellCheckLoop 1
          }
     ########################################################################################################################
     action (backtraining) off
     action (main) off
     action (buffs) on
	goto SPELL_SETUP_REPORT
SPELL_RETURN_NOSMART:
     echo
     echo ############################
     echo ** SMART SPELLS SETTING IS ~OFF~
     echo ** SETTING MANA LEVELS TO USER-DEFINED VARIABLES
     echo ############################
     echo
     var SpellsTotal 0
     delay 0.0001
     put #var Mana.Target %Target.Mana
     put #var Camb.Target %Target.Camb
     put #var Mana.%%GuildType.Target.Spell %Target.Mana
     put #var Camb.%%GuildType.Target.Spell %Target.Camb
     put #var Mana.Debilitation %Debilitation.Mana
     put #var Camb.Debilitation %Debilitation.Camb
     put #var Mana.%%GuildType.Debilitation.Spell %Debilitation.Mana
     put #var Camb.%%GuildType.Debilitation.Spell %Debilitation.Camb
     put #var Mana.Warding %Warding.Mana
     put #var Camb.Warding %Warding.Camb
     put #var Mana.%%GuildType.Warding.Spell %Warding.Mana
     put #var Camb.%%GuildType.Warding.Spell %Warding.Camb
     put #var Mana.Utility %Utility.Mana
     put #var Camb.Utility %Utility.Camb
     put #var Mana.%%GuildType.Utility.Spell %Utility.Mana
     put #var Camb.%%GuildType.Utility.Spell %Utility.Camb
     put #var Mana.Augmentation %Augmentation.Mana
     put #var Camb.Augmentation %Augmentation.Camb
     put #var Mana.%%GuildType.Augmentation.Spell %Augmentation.Mana
     put #var Camb.%%GuildType.Augmentation.Spell %Augmentation.Camb
     put #var Mana.Sorcery %Sorcery.Mana
     put #var Mana.%%GuildType.Sorcery.Spell %Sorcery.Mana
     if (%firstlaunch = 1) then put #var Camb.Sorcery %Sorcery.Camb
     if (%firstlaunch = 1) then put #var Camb.%%GuildType.Sorcery.Spell %Sorcery.Camb
     echo
     echo ############################
     echo ** SET USER MANA:
     if !matchre("$%GuildType.Target.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               echo * Target Mana (Spell: $%GuildType.Target.Spell - Mana: $Mana.%%GuildType.Target.Spell)
               math SpellsTotal add 1
          }
     if !matchre("$%GuildType.Debilitation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               echo * Debilitation Mana (Spell: $%GuildType.Debilitation.Spell - Mana: $Mana.%%GuildType.Debilitation.Spell)
               math SpellsTotal add 1
          }
     if !matchre("$%GuildType.Warding.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               echo * Warding Mana (Spell: $%GuildType.Warding.Spell - Mana: $Mana.%%GuildType.Warding.Spell)
               math SpellsTotal add 1
          }
     if !matchre("$%GuildType.Utility.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               echo * Utility Mana (Spell: $%GuildType.Utility.Spell - Mana: $Mana.%%GuildType.Utility.Spell)
               math SpellsTotal add 1
          }
     if !matchre("$%GuildType.Augmentation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               echo * Augmentation Mana (Spell: $%GuildType.Augmentation.Spell - Mana: $Mana.%%GuildType.Augmentation.Spell)
               math SpellsTotal add 1
          }
     if !matchre("$%GuildType.Sorcery.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               echo * Sorcery Mana (Spell: $%GuildType.Sorcery.Spell - Mana: $Mana.$%GuildType.Sorcery.Spell)
               math SpellsTotal add 1
          }
     echo ** CAMBRINTH LEVELS:
     if !matchre("$%GuildType.Target.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then echo * Target Cambrinth - %Target.Camb
     if !matchre("$%GuildType.Debilitation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then echo * Debilitation Cambrinth - %Debilitation.Camb
     if !matchre("$%GuildType.Warding.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then echo * Warding Cambrinth - %Warding.Camb
     if !matchre("$%GuildType.Utility.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then echo * Utility Cambrinth - %Utility.Camb
     if !matchre("$%GuildType.Augmentation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then echo * Augmentation Cambrinth - %Augmentation.Camb
     if !matchre("$%GuildType.Sorcery.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then echo * Sorcery Cambrinth - $Camb.Sorcery
     echo ############################
     # if ((%TargetCount > 0) && !matchre("%%GuildType.Target.Spell(1)", "(?i)(NULL|OFF|^%|^\s*$)")) then math SpellsTotal add 2
     # if ((%TargetCount > 1) && !matchre("%%GuildType.Target.Spell(2)", "(?i)(NULL|OFF|^%|^\s*$)")) then math SpellsTotal add 3
     # if ((%DebilCount > 0) && !matchre("%%GuildType.Debilitation.Spell(1)", "(?i)(NULL|OFF|^%|^\s*$)")) then math SpellsTotal add 2
     # if ((%DebilCount > 1) && !matchre("%%GuildType.Debilitation.Spell(2)", "(?i)(NULL|OFF|^%|^\s*$)")) then math SpellsTotal add 3
     echo *** TOTAL COMBAT SPELLS: %SpellsTotal
     delay 0.01
     action (buffs) on
     return
SPELL_SETUP_REPORT:
     var SpellsTotal 0
     echo
     echo ###############################
     echo *** SETUP SMART MANA AMOUNTS ***
     if !matchre("$%GuildType.Target.Spell", "(?i)(NULL|OFF|^%|^\s*$)")) then
          {
               math SpellsTotal add 1
               if (%TargetCount = 0) then
                    {
                         echo * Targeted Magic (Spell: $%GuildType.Target.Spell - Mana: $Mana.$%GuildType.Target.Spell)
                         echo * Target Cambrinth - $Camb.$%GuildType.Target.Spell
                    }
               if (%TargetCount > 0) then
                    {
                         echo * Targeted Magic 1 (Spell: %%GuildType.Target.Spell(0) - Mana: $Mana.%%GuildType.Target.Spell(0))
                         echo * Targeted Magic 2 (Spell: %%GuildType.Target.Spell(1) - Mana: $Mana.%%GuildType.Target.Spell(1))
                    }
               if (%TargetCount > 1) then echo * Targeted Magic 3 (Spell: %%GuildType.Target.Spell(2) - Mana: $Mana.%%GuildType.Target.Spell(2))
               if (%TargetCount > 2) then echo * Targeted Magic 4 (Spell: %%GuildType.Target.Spell(3) - Mana: $Mana.%%GuildType.Target.Spell(3))
          }
     if !matchre("$%GuildType.Debilitation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               math SpellsTotal add 1
               if (%DebilCount = 0) then
                    {
                         echo * Debilitation (Spell: $%GuildType.Debilitation.Spell - Mana: $Mana.$%GuildType.Debilitation.Spell)
                         echo * Debilitation Cambrinth - $Camb.$%GuildType.Debilitation.Spell
                    }
               if (%DebilCount > 0) then
                    {
                         echo * Debilitation Spell 1 (Spell: %%GuildType.Debilitation.Spell(0) - Mana: $Mana.%%GuildType.Debilitation.Spell(0))
                         echo * Debilitation Spell 2 (Spell: %%GuildType.Debilitation.Spell(1) - Mana: $Mana.%%GuildType.Debilitation.Spell(1))
                    }
               if (%DebilCount > 1) then echo * Debilitation Spell 3: (Spell: %%GuildType.Debilitation.Spell(2) - Mana: $Mana.%%GuildType.Debilitation.Spell(2))
               if (%DebilCount > 2) then echo * Debilitation Spell 4: (Spell: %%GuildType.Debilitation.Spell(3) - Mana: $Mana.%%GuildType.Debilitation.Spell(3))
          }
     if !matchre("$%GuildType.Warding.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               math SpellsTotal add 1
               if (%WardingCount = 0) then
                    {
                         echo * Warding (Spell: $%GuildType.Warding.Spell - Mana: $Mana.$%GuildType.Warding.Spell)
                         echo * Warding Cambrinth - $Camb.$%GuildType.Warding.Spell
                    }
               if (%WardingCount > 0) then
                    {
                         echo * Warding Spell 1 (Spell: %%GuildType.Warding.Spell(0) - Mana: $Mana.%%GuildType.Warding.Spell(0))
                         echo * Warding Spell 2 (Spell: %%GuildType.Warding.Spell(1) - Mana: $Mana.%%GuildType.Warding.Spell(1))
                    }
               if (%WardingCount > 1) then echo * Warding Spell 3: (Spell: %%GuildType.Warding.Spell(2) - Mana: $Mana.%%GuildType.Warding.Spell(2))
               if (%WardingCount > 2) then echo * Warding Spell 4: (Spell: %%GuildType.Warding.Spell(3) - Mana: $Mana.%%GuildType.Warding.Spell(3))
          }
     if !matchre("$%GuildType.Utility.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               math SpellsTotal add 1
               if (%UtilCount = 0) then
                    {
                         echo * Utility (Spell: $%GuildType.Utility.Spell - Mana: $Mana.$%GuildType.Utility.Spell)
                         echo * Utility Cambrinth - $Camb.$%GuildType.Utility.Spell
                    }
               if (%UtilCount > 0) then
                    {
                         echo * Utility Spell 1 (Spell: %%GuildType.Utility.Spell(0) - Mana: $Mana.%%GuildType.Utility.Spell(0))
                         echo * Utility Spell 2 (Spell: %%GuildType.Utility.Spell(1) - Mana: $Mana.%%GuildType.Utility.Spell(1))
                    }
               if (%UtilCount > 1) then echo * Utility Spell 3: (Spell: %%GuildType.Utility.Spell(2) - Mana: $Mana.%%GuildType.Utility.Spell(2))
               if (%UtilCount > 2) then echo * Utility Spell 4: (Spell: %%GuildType.Utility.Spell(3) - Mana: $Mana.%%GuildType.Utility.Spell(3))
          }
     if !matchre("$%GuildType.Augmentation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               math SpellsTotal add 1
               if (%AugmentCount = 0) then
                    {
                         echo * Augmentation (Spell: $%GuildType.Augmentation.Spell - Mana: $Mana.$%GuildType.Augmentation.Spell)
                         echo * Augmentation Cambrinth - $Camb.$%GuildType.Augmentation.Spell
                    }
               if (%UtilCount > 0) then
                    {
                         echo * Augmentation Spell 1 (Spell: %%GuildType.Augmentation.Spell(0) - Mana: $Mana.%%GuildType.Augmentation.Spell(0))
                         echo * Augmentation Spell 2 (Spell: %%GuildType.Augmentation.Spell(1) - Mana: $Mana.%%GuildType.Augmentation.Spell(1))
                    }
               if (%UtilCount > 1) then echo * Augmentation Spell 3: (Spell: %%GuildType.Augmentation.Spell(2) - Mana: $Mana.%%GuildType.Augmentation.Spell(2))
               if (%UtilCount > 2) then echo * Augmentation Spell 4: (Spell: %%GuildType.Augmentation.Spell(3) - Mana: $Mana.%%GuildType.Augmentation.Spell(3))
          }
     if !matchre("$%GuildType.Sorcery.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               math SpellsTotal add 1
               if (%SorceryCount = 0) then
                    {
                         echo * Sorcery (Spell: $%GuildType.Sorcery.Spell - Mana: $Mana.$%GuildType.Sorcery.Spell)
                         echo * Sorcery Cambrinth - $Camb.$%GuildType.Sorcery.Spell
                    }
               if (%SorceryCount > 0) then
                    {
                         echo * Sorcery Spell 1 (Spell: %%GuildType.Sorcery.Spell(0) - Mana: $Mana.%%GuildType.Sorcery.Spell(0))
                         echo * Sorcery Spell 2 (Spell: %%GuildType.Sorcery.Spell(1) - Mana: $Mana.%%GuildType.Sorcery.Spell(1))
                    }
               if (%SorceryCount > 1) then echo * Sorcery Spell 3: (Spell: %%GuildType.Sorcery.Spell(2) - Mana: $Mana.%%GuildType.Sorcery.Spell(2))
               if (%SorceryCount > 2) then echo * Sorcery Spell 4: (Spell: %%GuildType.Sorcery.Spell(3) - Mana: $Mana.%%GuildType.Sorcery.Spell(3))
          }
     echo ** CAMBRINTH LEVELS:
     if !matchre("$%GuildType.Target.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then echo * Target Cambrinth - %Target.Camb
     if !matchre("$%GuildType.Debilitation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then echo * Debilitation Cambrinth - %Debilitation.Camb
     if !matchre("$%GuildType.Warding.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then echo * Warding Cambrinth - $Camb.$%GuildType.Warding.Spell
     if !matchre("$%GuildType.Utility.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then echo * Utility Cambrinth - $Camb.$%GuildType.Utility.Spell
     if !matchre("$%GuildType.Augmentation.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then echo * Augmentation Cambrinth - $Camb.$%GuildType.Augmentation.Spell
     if !matchre("$%GuildType.Sorcery.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then echo * Sorcery Cambrinth - $Camb.$%GuildType.Sorcery.Spell
     echo ###############################
     echo
     echo *** TOTAL COMBAT SPELLS: %SpellsTotal
     echo
     delay 0.0001
     action (buffs) on
     return
##############################################################################################################
SPELL_SETUP:
     action (magic) on
     var NOCAST 0
     var KNOWN 0
	var TempSchool $1
     var CurrentSpell $%GuildType.%TempSchool.Spell
     if ((%Melee.Range = 1) && ($UC_Retreat = 1)) then gosub RETREAT
     if matchre("$%GuildType.%TempSchool.Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               var %TempSchoolON 0
               return
          }
     if ($UC_SmartSpells = 0) then return
     if matchre("%CurrentSpell", "\b(?i)NULL\b") then return
     if matchre("%CurrentSpell", "\b(?i)%Magic.Tattoo\b") then
          {
               put #var Mana.$%GuildType.%TempSchool.Spell 20
               put #var Camb.$%GuildType.%TempSchool.Spell %Sorcery.Camb
               put #var Camb.%TempSchool %Sorcery.Camb
               var ChargeMana.%TempSchool %Sorcery.Camb
               put #var Camb.Tattoo %Sorcery.Camb
               echo
               echo  #############################
               echo *** %CurrentSpell is our Magic Tattoo
               echo *** Setting camb mana to $Camb.Sorcery
               echo  #############################
               echo
               var %TempSchoolON 1
               pause 0.5
               return
          }
     eval School toupper("%TempSchool")
     #### NEW SETUP ROUTINE TO CHECK FOR SMART SPELL MANA ALREADY SET
     if matchre("%command","(?i)SETUP") then goto SPELL_SETUP_DISCERN
     if matchre("%command","(?i)SPELL") then goto SPELL_SETUP_DISCERN
     if (($Mana.$%GuildType.%TempSchool.Spell > 100) && !matchre("$%GuildType.%TempSchool.Spell", "(?i)%Ritual.Spell.List")) then goto SPELL_SETUP_DISCERN
     if ($Mana.$%GuildType.%TempSchool.Spell = 0) then goto SPELL_SETUP_DISCERN
     if !def(Mana.$%GuildType.%TempSchool.Spell) then goto SPELL_SETUP_DISCERN
     if !def(Camb.$%GuildType.%TempSchool.Spell) then goto SPELL_SETUP_DISCERN
     if (def(Mana.$%GuildType.%TempSchool.Spell) && !matchre("%command","(?i)SETUP")) then goto SPELL_SETUP_KNOWN
SPELL_SETUP_DISCERN:
     echo
     echo *** Checking Optimal Cast Mana for $%GuildType.%TempSchool.Spell
     echo
     pause 0.001
     gosub SPELLMATH $%GuildType.%TempSchool.Spell
     if (%NOCAST = 1) then
          {
               var %TempSchoolON 0
               var %GuildType.%TempSchool.Spell NULL
               var NOCAST 0
               return
          }
     if (%spellCMax = 0) then
          {
               var %TempSchool.Mana 1
               put #var Mana.%TempSchool 1
               put #var Mana.$%GuildType.%TempSchool.Spell 1
               put #var Camb.$%GuildType.%TempSchool.Spell 1
               put #var Camb.%TempSchool 1
               var ChargeMana.%TempSchool NULL
          }
     else
          {
               var %TempSchool.Mana %spellCMax
               put #var Mana.%TempSchool %spellCMax
               put #var Mana.$%GuildType.%TempSchool.Spell %spellCMax
               put #var Camb.$%GuildType.%TempSchool.Spell %spellResplit
               if matchre("$%GuildType.%TempSchool.Spell", "(?i)%Ritual.Spell.List") then
                    {
                         var spellResplit 0
                         put #var Camb.$%GuildType.%TempSchool.Spell NULL
                         put #var Camb.%TempSchool NULL
                         var ChargeMana.%TempSchool NULL
                         # if (%spellResplit >= 200) then var spellResplit 30
                         # if ((%spellResplit < 200) && (%spellResplit > 150)) then var spellResplit 20
                         # if ((%spellResplit < 150) && (%spellResplit > 50)) then var spellResplit 15
                    }
               if ((%CambrinthCharge = 0) || (matchre("%TempSchool", "(TARGET|DEBILITATION)") && ($UC_NoCambTM = 1))) then
                    {
                         put #var Camb.$%GuildType.%TempSchool.Spell NULL
                         put #var Camb.%TempSchool NULL
                         var ChargeMana.%TempSchool NULL
                    }
               else
                    {
                         put #var Camb.$%GuildType.%TempSchool.Spell %spellResplit
                         # put #var Camb.%TempSchool %spellResplit
                         var ChargeMana.%TempSchool %spellResplit
                    }
          }
SPELL_SETUP_NEW_DISCERN:
     echo
     echo ##############################
     echo **** SETTING $%GuildType.%TempSchool.Spell spell to %spellCMax Mana
     echo **** SETTING $%GuildType.%TempSchool.Spell cambrinth to %spellResplit Mana
     echo ##############################
     echo
     pause 0.001
	return
SPELL_SETUP_KNOWN:
     echo
     echo ##############################
     echo **** SETTING $%GuildType.%TempSchool.Spell spell to $Mana.$%GuildType.%TempSchool.Spell Mana
     echo **** SETTING $%GuildType.%TempSchool.Spell cambrinth to $Camb.$%GuildType.%TempSchool.Spell Mana
     echo ##############################
     echo
     pause 0.001
     put #var Mana.%TempSchool $Mana.$%GuildType.%TempSchool.Spell
     if ((%CambrinthCharge = 0) || (matchre("%TempSchool", "(TARGET|DEBILITATION)") && ($UC_NoCambTM = 1))) then
                    {
                         put #var Camb.$%GuildType.%TempSchool.Spell NULL
                         put #var Camb.%TempSchool NULL
                         var ChargeMana.%TempSchool NULL
                    }
               else
                    {
                         put #var Camb.%TempSchool $Camb.$%GuildType.%TempSchool.Spell
                    }
     return
### SPELLMATH SUB
SPELLMATH:
     delay 0.0001
     var CurrentSpell $0
     var NOCAST 0
     var spellRitual 0
     var Skill NULL
     var tooN00b 0
     var lowly_novice 1
     var promising_novice 10
     var experienced_practitioner 80
     var adept 200
     var 50th_degree_adept 250
     var professional 400
     var genius 600
     var master 800
     var guru 1000
     if matchre("%CurrentSpell", "\b(?i)%Magic.Tattoo\b") then return
     action var spellRitual 1 when ^This is a ritual spell
     action var spellMin $1;var spellMax $2 when ^The spell requires at minimum (\d+) .*\, for a total of (\d+) streams\.
     action var spellMin 0;var spellMax 0 when ^You have no idea how to cast that spell\.
     action var spellMax 1 when ^You don't think you are able to cast this spell\.
     action var Skill $1 when It requires the (.*) skill(s?) to cast effectively\.
	# action var SpellTier $1 when To begin to be able to cast this spell, you will need to reach the rank of (?:an?) (.*?)\.
     action var SpellMinRanks $1 when To begin to be able to cast this spell, you will need to reach the rank of (?:an?) (.*?)\.
     action var SpellMaxRanks $1 when By the time you have mastered this spell, you will be ranked as (?:an?) (.*?) in your abilities as a caster\.
     gosub PUT discern %CurrentSpell
     pause 2
     pause 0.1
     pause 0.001
     pause 0.001
     var SpellTier %SpellMinRanks
     eval Skill replacere("%Skill", " and ", "|")
     eval Skill replacere("%Skill", " ", "_")
     eval SpellMinRanks replacere("%SpellMinRanks", " ", "_"
     eval SpellMaxRanks replacere("%SpellMaxRanks", " ", "_"
     var SpellMinRanks %%SpellMinRanks
     var SpellMaxRanks %%SpellMaxRanks
     eval SkillCount count("%Skill", "|")
     if matchre("%Skill", "Sorcery") then var TempSchool Sorcery
     if matchre("%Skill", "Augmentation") then var TempSchool Augmentation
     if matchre("%Skill", "Warding") then var TempSchool Warding
     if matchre("%Skill", "Target") then var TempSchool Target
     if matchre("%Skill", "Utility") then var TempSchool Utility
     if matchre("%Skill", "Debilitation") then var TempSchool Debilitation
     if matchre("%CurrentSpell", "(?i)$%GuildType.Sorcery.Spell") then
          {
               var LastSkill %Skill
               var TempSchool Sorcery
               var Skill Sorcery
               var Skill2 %LastSkill
               var SkillCount 0
          }
     if (%spellMax < 3) then var tooN00b 1
     if (%spellMax = 0) then goto NO_CAST
     pause 0.0001
     if (%SkillCount > 0) then
          {
               if (%%Skill(0)Mastery) then evalmath Skill1 ($%Skill(0).Ranks + 50)
               else var Skill1 $%Skill(0)
               if (%%Skill(1)Mastery) then evalmath Skill2 ($%Skill(1).Ranks + 50)
               else var Skill2 $%Skill(1)
               evalmath SpellRanks (($%Skill(0).Ranks + $%Skill(1).Ranks) / 2)
          }
     else
          {
               if %%SkillMastery then evalmath SpellRanks $%Skill.Ranks + 50
               else var SpellRanks $%Skill.Ranks
          }
     if matchre("%TempSchool", "Sorcery") then evalmath SpellRanks floor((%SpellRanks*.8)+($Sorcery.Ranks*.2))
     else evalmath SpellRanks ceiling((%SpellRanks*.8)+($Primary_Magic.Ranks*.4))
     if (%tooN00b) then
          {
               var spellCMax 2
               var spellSplit 1
               var spellResplit 1
               var spellMin 1
			goto SPELLMATH2
          }
     if (%spellRitual = 1) then
          {
               evalmath spellCMax ceiling(%spellMax * .90)
               evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+8))
               var spellRitual 0
               goto SPELLMATH2
          }
     if (matchre("%TempSchool", "Target") && ($UC_Target.Symbiosis = 1)) || (matchre("%TempSchool", "Debilitation") && ($UC_Debilitation.Symbiosis = 1) || (matchre("%TempSchool", "Utility") && ($UC_Utility.Symbiosis = 1) || (matchre("%TempSchool", "Augmentation") && ($UC_Augmentation.Symbiosis = 1) || (matchre("%TempSchool", "Warding") && ($UC_Warding.Symbiosis = 1) || (matchre("%TempSchool", "Sorcery") && ($UC_Sorcery.Symbiosis = 1)) then
          {
               if ("%BUFFING" != "ON") then
                    {
                         echo *** SYMBIOSIS CALCULATION.....
                         if (%spellMax >= 25) then evalmath spellCMax ceiling(%spellMax * .30)
                         if (%spellMax < 25) then evalmath spellCMax ceiling(%spellMax * .25)
                         if (!matchre("%TempSchool", "(Target|Debilitation)") && ($UC_CambHeavy = 1) && ($UC_NoCambTM = 0)) then
                              {
                                   evalmath spellCMax floor(%spellCMax / (%CambrinthCharge+2))
                                   evalmath spellResplit ceiling(%spellCMax * (%CambrinthCharge+2.2))
                                   goto SPELLMATH2
                              }
                         if (matchre("%TempSchool", "(Target|Debilitation)") && ($UC_NoCambTM = 1)) then
                              {
                                   var spellCMax %spellCMax
                                   var spellResplit 0
                                   goto SPELLMATH2
                              }
                         evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+2))
                         evalmath spellCMax ceiling(%spellResplit * (%CambrinthCharge+2.2))
                         if ($UC_Cambrinth.Use = 0) then
                              {
                                   evalmath spellCMax floor(%spellCMax + %spellResplit)
                                   var spellResplit 0
                              }
                         goto SPELLMATH2
                    }
          }
     if (matchre("%TempSchool", "Sorcery") && ($Symbiosis.Buffs = 1) && ("%BUFFING" = "ON")) then
          {
               echo *** SYMBIOSIS SORCERY CALCULATION...
               if ($Sorcery.Ranks >= 1000) then evalmath spellCMax ceiling(%spellMax * .69)
               if (($Sorcery.Ranks < 1000) && ($Sorcery.Ranks >= 750)) then evalmath spellCMax ceiling(%spellMax * .62)
               if (($Sorcery.Ranks < 750) && ($Sorcery.Ranks >= 400)) then evalmath spellCMax ceiling(%spellMax * .52)
               if (($Sorcery.Ranks < 400) && ($Sorcery.Ranks >= 200)) then evalmath spellCMax ceiling(%spellMax * .40)
               if (($Sorcery.Ranks < 200) && ($Sorcery.Ranks >= 100)) then evalmath spellCMax ceiling(%spellMax * .35)
               if ($Sorcery.Ranks < 100) then evalmath spellCMax ceiling(%spellMax * .30)
               if ($UC_CambHeavy = 1) then
                    {
                         evalmath spellCMax ceiling(%spellCMax / (%CambrinthCharge+2))
                         evalmath spellResplit ceiling(%spellCMax * (%CambrinthCharge+2.2))
                         goto SPELLMATH2
                    }
               evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+2))
               evalmath spellCMax ceiling(%spellResplit * (%CambrinthCharge+2.2))
               if ($UC_Cambrinth.Use.Buffs = 0) then
                    {
                         evalmath spellCMax floor(%spellCMax + %spellResplit)
                         var spellResplit 0
                    }
               goto SPELLMATH2
          }
     if (("%BUFFING" = "ON") && ($Symbiosis.Buffs = 1)) then
          {
               echo *** SYMBIOSIS BUFF CALCULATION...
               if ($Attunement.Ranks >= 1500) then evalmath spellCMax ceiling(%spellMax * .40)
               if (($Attunement.Ranks > 1000) && ($Attunement.Ranks < 1500)) then evalmath spellCMax ceiling(%spellMax * .35)
               if (($Attunement.Ranks > 500) && ($Attunement.Ranks < 1000)) then evalmath spellCMax ceiling(%spellMax * .30)
               if ($Attunement.Ranks < 500) then evalmath spellCMax ceiling(%spellMax * .25)
               if ($UC_CambHeavy = 1) then
                    {
                         evalmath spellCMax ceiling(%spellCMax / (%CambrinthCharge+2))
                         evalmath spellResplit ceiling(%spellCMax * (%CambrinthCharge+2.2))
                         goto SPELLMATH2
                    }
               evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+2))
               evalmath spellCMax ceiling(%spellResplit * (%CambrinthCharge+2.2))
               if ($UC_Cambrinth.Use.Buffs = 0) then
                    {
                         evalmath spellCMax floor(%spellCMax + %spellResplit)
                         var spellResplit 0
                    }
               goto SPELLMATH2
          }
     if (("%BUFFING" = "ON") && ($Symbiosis.Buffs = 0)) then
          {
               if ($Attunement.Ranks >= 1500) then evalmath spellCMax ceiling(%spellMax * .70)
               if (($Attunement.Ranks > 1000) && ($Attunement.Ranks < 1500)) then evalmath spellCMax ceiling(%spellMax * .65)
               if (($Attunement.Ranks > 500) && ($Attunement.Ranks < 1000)) then evalmath spellCMax ceiling(%spellMax * .60)
               if (($Attunement.Ranks > 200) && ($Attunement.Ranks < 500)) then evalmath spellCMax ceiling(%spellMax * .55)
               if ($Attunement.Ranks < 200) then evalmath spellCMax ceiling(%spellMax * .50)
               if ($UC_CambHeavy = 1) then
                    {
                         evalmath spellCMax ceiling(%spellCMax / (%CambrinthCharge+2))
                         evalmath spellResplit ceiling(%spellCMax * (%CambrinthCharge+2.2))
                         goto SPELLMATH2
                    }
               evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+2))
               evalmath spellCMax ceiling(%spellResplit * (%CambrinthCharge+2.2))
               if ($UC_Cambrinth.Use.Buffs = 0) then
                    {
                         evalmath spellCMax floor(%spellCMax + %spellResplit)
                         var spellResplit 0
                    }
               goto SPELLMATH2
          }
	if matchre("%TempSchool", "(Target|Debilitation)") then
		{
			if (%spellMax >= 25) then evalmath spellCMax ceiling(%spellMax * .70)
               if (%spellMax < 25) then evalmath spellCMax ceiling(%spellMax * .65)
               if (($UC_CambHeavy = 1) && ($UC_NoCambTM = 0)) then
                    {
                         evalmath spellCMax floor(%spellCMax / (%CambrinthCharge+2))
                         evalmath spellResplit ceiling(%spellCMax * (%CambrinthCharge+2.2))
                         goto SPELLMATH2
                    }
               if ($UC_NoCambTM = 1) then
                    {
                         var spellCMax %spellCMax
                         var spellResplit 0
                         goto SPELLMATH2
                    }
               evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+2))
               evalmath spellCMax ceiling(%spellResplit * (%CambrinthCharge+2.2))
			if ($UC_NoCambTM = 1) then var spellResplit 0
               if ($UC_Cambrinth.Use = 0) then
                    {
                         evalmath spellCMax floor(%spellCMax + %spellResplit)
                         var spellResplit 0
                    }
			goto SPELLMATH2
          }
     if matchre("%TempSchool", "(Warding|Utility|Augmentation)") then
          {
               if ($%TempSchool.Ranks >= 1500) then evalmath spellCMax ceiling(%spellMax * .78)
               if (($%TempSchool.Ranks > 1000) && ($%TempSchool.Ranks < 1500)) then evalmath spellCMax ceiling(%spellMax * .72)
               if (($%TempSchool.Ranks > 700) && ($%TempSchool.Ranks < 1000)) then evalmath spellCMax ceiling(%spellMax * .68)
               if (($%TempSchool.Ranks >= 300) && ($%TempSchool.Ranks < 700)) then evalmath spellCMax ceiling(%spellMax * .60)
               if ($%TempSchool.Ranks < 300) then evalmath spellCMax ceiling(%spellMax * .55)
               # if (%spellMax >= 25) then evalmath spellCMax ceiling(%spellMax * .70)
               # if (%spellMax < 25) then evalmath spellCMax ceiling(%spellMax * .60)
               if ($UC_CambHeavy = 1) then
                    {
                         evalmath spellCMax ceiling(%spellCMax / (%CambrinthCharge+2))
                         evalmath spellResplit ceiling(%spellCMax * (%CambrinthCharge+2.2))
                         goto SPELLMATH2
                    }
               evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+2))
               evalmath spellCMax ceiling(%spellResplit * (%CambrinthCharge+2.2))
               if ($UC_Cambrinth.Use = 0) then
                    {
                         evalmath spellCMax floor(%spellCMax + %spellResplit)
                         var spellResplit 0
                    }
               goto SPELLMATH2
          }
	if matchre("%TempSchool", "Sorcery") then
		{
               echo *** SORCERY CALCULATION...
               if ($Sorcery.Ranks >= 1000) then evalmath spellCMax ceiling(%spellMax * .80)
               if (($Sorcery.Ranks < 1000) && ($Sorcery.Ranks >= 750)) then evalmath spellCMax ceiling(%spellMax * .75)
               if (($Sorcery.Ranks < 750) && ($Sorcery.Ranks >= 400)) then evalmath spellCMax ceiling(%spellMax * .70)
               if (($Sorcery.Ranks < 400) && ($Sorcery.Ranks >= 200)) then evalmath spellCMax ceiling(%spellMax * .66)
               if (($Sorcery.Ranks < 200) && ($Sorcery.Ranks >= 100)) then evalmath spellCMax ceiling(%spellMax * .60)
               if ($Sorcery.Ranks < 100) then evalmath spellCMax ceiling(%spellMax * .50)
               if (($UC_CambHeavy = 1) && ($UC_NoCambTM = 0)) then
                    {
                         evalmath spellCMax floor(%spellCMax / (%CambrinthCharge+2))
                         evalmath spellResplit ceiling(%spellCMax * (%CambrinthCharge+2.2))
                         goto SPELLMATH2
                    }
               if (($UC_NoCambTM = 1) && matchre("%CurrentSpell", "(?i)(%TM.Spell.List|%Debil.Spell.List)")) then
                    {
                         var spellCMax %spellCMax
                         var spellResplit 0
                         goto SPELLMATH2
                    }
               evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+2))
               evalmath spellCMax ceiling(%spellResplit * (%CambrinthCharge+2.2))
			if ($UC_NoCambTM = 1) then var spellResplit 0
               if ($UC_Cambrinth.Use = 0) then
                    {
                         evalmath spellCMax floor(%spellCMax + %spellResplit)
                         var spellResplit 0
                    }
			goto SPELLMATH2
          }
     evalmath spellCMax ceiling(((%spellMax-%spellMin)*((%SpellRanks-%SpellMinRanks)/%SpellMaxRanks))+%spellMin)
     if (%spellCMax > %spellMax) then var spellCMax %spellMax
     if (%spellCMax < %spellMin) then var spellCMax %spellMin
     # evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+3))
	# evalmath spellCMax ceiling(%spellResplit * 3)
     #
     # var spellCMax %spellResplit
     if matchre("%TempSchool", "Target") then var TempSchool Targeted_Magic
     if ("%SpellTier" = "lowly novice") then
          {
			if (%spellMax >= 25) then evalmath spellCMax ceiling(%spellMax * .80)
               if (%spellMax < 25) then evalmath spellCMax ceiling(%spellMax * .75)
			if (%spellCMax > %spellMax) then var spellCMax %spellMax
               if ($UC_CambHeavy = 1) then
                    {
                         evalmath spellCMax ceiling(%spellCMax / (%CambrinthCharge+2))
                         evalmath spellResplit ceiling(%spellCMax * (%CambrinthCharge+2.2))
                         goto SPELLMATH2
                    }
               evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+2))
               evalmath spellCMax ceiling(%spellResplit * (%CambrinthCharge+2.5))
               # if (%spellMax < 25) then evalmath spellResplit floor(%spellResplit * .50)
          }
	if ("%SpellTier" = "promising novice") then
          {
			if (%spellMax >= 25) then evalmath spellCMax ceiling(%spellMax * .75)
               if (%spellMax < 25) then evalmath spellCMax ceiling(%spellMax * .70)
			if (%spellCMax > %spellMax) then var spellCMax %spellMax
               if ($UC_CambHeavy = 1) then
                    {
                         evalmath spellCMax ceiling(%spellCMax / (%CambrinthCharge+2))
                         evalmath spellResplit ceiling(%spellCMax * (%CambrinthCharge+2.5))
                         goto SPELLMATH2
                    }
               evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+2))
               evalmath spellCMax ceiling(%spellResplit * (%CambrinthCharge+2.5))
               # if (%spellMax < 25) then evalmath spellResplit floor(%spellResplit * .50)
          }
	if ("%SpellTier" = "experienced practitioner") then
          {
			if (%spellMax >= 30) then evalmath spellCMax ceiling(%spellMax *.50)
               if (%spellMax < 30) then evalmath spellCMax ceiling(%spellMax *.45)
			if (%spellCMax > %spellMax) then var spellCMax %spellMax
               if ($UC_CambHeavy = 1) then
                    {
                         evalmath spellCMax ceiling(%spellCMax / (%CambrinthCharge+2))
                         evalmath spellResplit ceiling(%spellCMax * (%CambrinthCharge+2.5))
                         goto SPELLMATH2
                    }
               evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+2))
               evalmath spellCMax ceiling(%spellResplit * (%CambrinthCharge+2.5))
               # if (%spellMax < 25) then evalmath spellResplit floor(%spellResplit * .50)
          }
	if ("%SpellTier" = "50th degree adept") then
          {
			if (%spellMax >= 30) then evalmath spellCMax ceiling(%spellMax *.35)
               if (%spellMax < 30) then evalmath spellCMax ceiling(%spellMax *.25)
			if (%spellCMax > %spellMax) then var spellCMax %spellMax
               if ($UC_CambHeavy = 1) then
                    {
                         evalmath spellCMax ceiling(%spellCMax / (%CambrinthCharge+2))
                         evalmath spellResplit ceiling(%spellCMax * (%CambrinthCharge+2.5))
                         goto SPELLMATH2
                    }
               evalmath spellResplit ceiling(%spellCMax / (%CambrinthCharge+2))
               evalmath spellCMax ceiling(%spellResplit * (%CambrinthCharge+2.5))
               # if (%spellCMax < %spellMin) then var spellCMax %spellMin
               # evalmath spellResplit floor(%spellCMax / (%CambrinthCharge+1))
               # var spellCMax %spellResplit
			# if (%spellMax >= 25) then evalmath spellResplit floor(%spellResplit * .99)
               # if (%spellMax < 25) then evalmath spellResplit floor(%spellResplit * .50)
			# var spellCMax %spellResplit
          }
     if ($UC_Cambrinth.Use = 0) then
          {
               evalmath spellCMax floor(%spellCMax + %spellResplit)
               var spellResplit 0
          }
	if matchre("%CurrentSpell", "(?i)%Cyclic.Spell.List") then
          {
               evalmath spellCMax ceiling(%spellMax * .20)
               evalmath spellSplit ceiling(%spellCMax / 2)
               evalmath spellResplit ceiling(%spellSplit / 2)
          }
	# if (%spellMax > 100) then
          # {
			# evalmath spellCMax floor(%spellMax * .8)
			# evalmath spellResplit floor(%spellCMax/(%CambrinthCharge+2))
          # }
     if matchre("%TempSchool", "Targeted_Magic") then var TempSchool Target
     goto SPELLMATH2
NO_CAST:
     echo
     echo ####################################
     echo ** YOU ARE TOO NOOB TO CAST %CurrentSpell OR DONT KNOW IT!!
     echo ** REMOVING IT FROM YOUR VARIABLES!
     echo ####################################
     echo
     var NOCAST 1
     if matchre("$%GuildType.Sorcery.Spell", "\b(?i)%CurrentSpell\b") then
          {
               var %GuildType.Sorcery.Spell NULL
               put #var %GuildType.Sorcery.Spell NULL
               var SorceryON 0
               goto NO_CAST_2
          }
     if matchre("$%GuildType.Augmentation.Spell", "\b(?i)%CurrentSpell\b") then
          {
               var %GuildType.Augmentation.Spell NULL
               put #var %GuildType.Augmentation.Spell NULL
               var AugmentationON 0
               goto NO_CAST_2
          }
     if matchre("$%GuildType.Warding.Spell", "\b(?i)%CurrentSpell\b") then
          {
               var %GuildType.Warding.Spell NULL
               put #var %GuildType.Warding.Spell NULL
               var WardingON 0
               goto NO_CAST_2
          }
     if matchre("$%GuildType.Debilitation.Spell", "\b(?i)%CurrentSpell\b") then
          {
               var %GuildType.Debilitation.Spell NULL
               put #var %GuildType.Debilitation.Spell NULL
               var DebilitationON 0
               goto NO_CAST_2
          }
     if matchre("$%GuildType.Target.Spell", "\b(?i)%CurrentSpell\b") then
          {
               var %GuildType.Target.Spell NULL
               put #var %GuildType.Target.Spell NULL
               var TargetON 0
               goto NO_CAST_2
          }
     if matchre("$%GuildType.Utility.Spell", "\b(?i)%CurrentSpell\b") then
          {
               var %GuildType.Utility.Spell NULL
               put #var %GuildType.Utility.Spell NULL
               var UtilityON 0
               goto NO_CAST_2
          }
NO_CAST_2:
     action remove ^The spell requires at minimum (\d+) .*\, for a total of (\d+) streams\.
     action remove ^You have no idea how to cast that spell\.
     action remove ^You don't think you are able to cast this spell\.
     action remove It requires the (.*) skill to cast effectively\.
     return
SPELLMATH2:
     # debug 5
     if ((%spellCMax > 70) && ($Attunement.Ranks < 1500) && !matchre("%CurrentSpell", "(?i)%Ritual.Spell.List")) then
          {
               echo ** Spell Mana (%spellCMax) over 70! - Putting half that into Cambrinth
               evalmath spellCMax ceiling(%spellCMax / 2)
               evalmath spellResplit ceiling(%spellResplit + %spellCMax)
               pause 0.1
               echo ** New Spell Mana: %spellCMax
               echo ** New Cambrinth Mana: %spellResplit
          }
     if (%spellCMax < %spellMin) then
          {
               evalmath tempMath (%spellMin - %spellCMax)
               var spellCMax %spellMin
               evalmath spellResplit (%spellResplit - %tempMath)
          }
     if (%spellCMax < 1) then var spellCMax 1
     if (%spellResplit < 0) then var spellResplit 1
     if (%tooN00b) then var spellCMax %spellMin
     if (%spellCMax = 1) then var spellResplit 0
     #if (%spellCMax = 0) then var spellCMax 1
     #if (%spellCMax = 0) then var spellCMax
SPELLMATH_CALC:
     var tempCambmana 0
     var totalMax 0
     delay 0.0001
     evalmath tempCambmana (%spellResplit * %CambrinthCharge)
     evalmath totalMax (%spellCMax + %tempCambmana)
     delay 0.0001
     if (%totalMax > %spellMax) then
          {
               echo
               echo #############################
               echo *** %CurrentSpell Spell TotalMax - %totalMax
               echo *** Prep mana:(%spellCMax) + Camb mana:(%spellResplit x %CambrinthCharge) = higher than spell Maximum!(%spellMax)
               echo *** Re-calculating and Reducing Mana Levels...
               echo #############################
               echo
               pause 0.1
               if ($UC_CambHeavy = 1) then
                    {
                         evalmath spellResplit floor(%spellResplit / 1.2)
                         evalmath spellCMax floor(%spellCMax / 1.5)
                         goto SPELLMATH_CALC_2
                    }
               evalmath spellResplit floor(%spellResplit / 1.5)
               if (%spellCMax > 1) then evalmath spellCMax floor(%spellCMax / 1.2)
               pause 0.0001
               goto SPELLMATH_CALC_2
          }
     goto SPELLMATH_CALC_DONE
SPELLMATH_CALC_2:
     if (%spellCMax >= %spellMax) then evalmath spellCMax floor(%spellCMax / 1.4)
     if (%spellCMax < 1) then var spellCMax 1
     if (%spellResplit < 1) then var spellResplit 0
     if (%spellResplit > 0) then var CambrinthCharge 1
     if (%spellCMax < %spellMin) then var spellCMax %spellMin
     #### RECALCULATE TOTAL MAX AFTER ADJUSTMENTS
     if (%totalMax > %spellMax) then
          {
               if ($UC_CambHeavy = 0) then math spellCMax subtract 1
               if ($UC_CambHeavy = 1) then math spellResplit subtract 1
               if (%spellResplit > 1) then
                    {
                         math spellResplit subtract 1
                    }
          }
     evalmath tempCambmana (%spellResplit * %CambrinthCharge)
     evalmath totalMax (%spellCMax + %tempCambmana)
     echo *** NEW Prep Mana: %spellCMax
     echo *** NEW Camb Mana: %spellResplit
     echo *** TotalMax - %totalMax
     echo ######################
     echo
     pause 0.0001
     goto SPELLMATH_CALC

SPELLMATH_CALC_DONE:
     var Prep %Skill %totalMax
     evalmath spellTemp round((%totalMax),0)
     put #var spellMax.%CurrentSpell %spellTemp
     echo *** Setting spellMax.%CurrentSpell $spellMax.%CurrentSpell
    #var charge %spellResplit
     action remove ^The spell requires at minimum (\d+) .*\, for a total of (\d+) streams\.
     action remove ^You have no idea how to cast that spell\.
     action remove ^You don't think you are able to cast this spell\.
     action remove It requires the (.*) skill to cast effectively\.
     # debug 0
     return
################################################################################################
# OFFENSIVE CASTING SUB
SPELL:
PREP:
     action (magic) on
     delay 0.00001
     var nissaloop 0
     if !matchre("$guild", "%MAGICUSER") then return
     # if (!%AugmentationON) && (!%UtilityON) && (!%WardingON) && (!%DebilitationON) && (!%TargetON) && (!%SorceryON) then return
	if ($UC_NoCombat = 0) then gosub CYCLIC_TIMER
     if ("$preparedspell" != "None") then return
     if ($mana < 35) then
          {
               echo
               echo ########################
               echo *** MANA TOO LOW - SKIPPING MAGIC
               echo ########################
               echo
               if (($UC_Crystal = 1) && ($UC_CrystalCombat = 1)) then gosub CRYSTAL_TIMER
               return
          }
     if ((%Backfired = 1) && ($UC_SmartSpells = 1)) then
          {
               var CurrentBackfire %CurrentSpell
               gosub SPELL_BACKFIRED
               var Backfired 0
          }
     if ((%Backfired = 1) && ($UC_SmartSpells = 0)) then
          {
               echo
               echo ##############
               echo *** BACKFIRED %spellID !
               echo *** NOT REDUCING MANA - SMART MANA IS OFF
               echo ##############
               echo
               put #echo >Log #FC0FC0 ** BACKFIRED %spellID !
               var Backfired 0
          }
#################################
##### SPELL DECISION / SPELL SWAPPING
SPELL_DECIDE:
SPELLCHECK:
     action (magic) on
     var Backfired 0
     var spellcheckloop 0
     var looploop 0
SPELLCHECK_1:
     math looploop add 1
     delay 0.00001
     if ("$%GuildType.%SpellArray(0).Spell|$%GuildType.%SpellArray(1).Spell|$%GuildType.%SpellArray(2).Spell|$%GuildType.%SpellArray(3).Spell|$%GuildType.%SpellArray(4).Spell|$%GuildType.%SpellArray(5).Spell" = "NULL|NULL|NULL|NULL|NULL|NULL") then goto SPELLCHECK_RETURN
     if (($mana < 40) || ($concentration < 65) || ("$preparedspell" != "None")) then goto SPELLCHECK_RETURN
     if (%NecroHealing = 1) then goto SPELLCHECK_RETURN
     ###########################################
     var CastTime $gametime
	var spelllearn %SpellArray(%spellcount)
	var CurrentSpell %%GuildType.%SpellArray(%spellcount).Spell
     var CurrentSpellMana $Mana.%spelllearn
     var CurrentCambMana $Camb.%spelllearn
     if (matchre("%SpellArray(%spellcount)", "Target") && (%TargetCount > 0)) then var CurrentSpell %%GuildType.Target.Spell(0)
     if (matchre("%SpellArray(%spellcount)", "Debilitation") && (%DebilCount > 0)) then var CurrentSpell %%GuildType.Debilitation.Spell(0)
     if (matchre("%SpellArray(%spellcount)", "Warding") && (%WardingCount > 0)) then var CurrentSpell %%GuildType.Warding.Spell(0)
     if (matchre("%SpellArray(%spellcount)", "Utility") && (%UtilCount > 0)) then var CurrentSpell %%GuildType.Utility.Spell(0)
     if (matchre("%SpellArray(%spellcount)", "Augmentation") && (%AugmentCount > 0)) then var CurrentSpell %%GuildType.Augmentation.Spell(0)
     if (matchre("%SpellArray(%spellcount)", "Sorcery") && (%SorceryCount > 0)) then var CurrentSpell %%GuildType.Sorcery.Spell(0)
     ###########################################
     ### TM FOCI CHECK
     if ((%Foci.Active = 1) && ($Targeted_Magic.LearningRate < 34)) then
          {
               math spellcount subtract 1
               if (%spellcount < 0) then var spellcount 0
               var spelllearn Targeted_Magic
               var CurrentSchool Target
               var CurrentSpell $%GuildType.Target.Spell
               if (%TargetCount > 0) then var CurrentSpell %%GuildType.Target.Spell(0)
               if ($UC_SmartSpells = 1) then
                    {
                         var CurrentSpellMana $Mana.%%GuildType.Target.Spell
                         var CurrentCambMana $Camb.%%GuildType.Target.Spell
                         goto SPELLCHECK2
                    }
               goto SPELL_NOSMART
          }
     #################################################################################
     ### SPECIAL - NEW MAGIC CYCLE COUNTER - Increase spellcount dynamically
     ### Magic.Rate NULL = cycle spells constantly / Magic.Rate 5 = Cycle spells after reaching 5/34
     ### Now will automatically increase Magic.Rate if it cycles through all spells but all Maxed
     #################################################################################
     if ("%spelllearn" = "Target") then var spelllearn Targeted_Magic
     if (!matchre("%Magic.Rate", "(?i)(NULL|OFF|^%|^\s*$)") && ($%spelllearn.LearningRate > %Magic.Rate)) then
          {
               echo *** Magic Rate over Max (%Magic.Rate/34) - Switching spell
               if (%looploop > 6) then
                    {
                         var newrate 0
                         evalmath newrate (%Magic.Rate + 3)
                         pause 0.0001
                         var Magic.Rate %newrate
                         echo *** ALL MAGICS OVER MAX.RATE?
                         echo *** INCREASING MAGIC MAX RATE TO ( %Magic.Rate/34 )
                         var looploop 0
                         var spellcount 0
                         goto SPELLCHECK_1

                    }
               math spellcount add 1
               goto SPELLCHECK_1
          }
	if matchre("%Magic.Rate", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               if matchre("%CurrentSpell", "(?i)%LastSpell")) then math spellcount add 1
          }
     if (%looploop > 6) then goto SPELLCHECK_RETURN
     # echo **SpellCount: %spellcount
     #################################################################################
     #################################################################################
     if (%spellcount > 6) then
          {
               delay 0.0001
               var spellcount 0
               if (%spellcheckloop > 20) then var spellcheckloop 0
               goto SPELLCHECK_1
          }
     if (!matchre("$%GuildType.%SpellArray(%spellcount).Spell", "(?i)(%abbrevs|%spelltimer)") && !matchre("$%GuildType.%SpellArray(%spellcount).Spell", "(?i)%Magic.Tattoo")) then
          {
               var %SpellArrayON 0
               put #var %GuildType.%SpellArray(%spellcount).Spell NULL
          }
     if matchre("$%GuildType.%SpellArray(%spellcount).Spell", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               if (%spellcount > 6) then
                    {
                         var spellcount 0
                         ### used to be a return here
                         return
                         goto SPELLCHECK_1
                    }
               if (%spellcheckloop > 20) then var spellcheckloop 0
               goto SPELLCHECK_NEXT
          }
     if matchre("$%GuildType.%SpellArray(%spellcount).Spell", "(?i)RESONANCE") then
          {
               if (matchre("$UC_WeaponType","(OFFHAND|BRAWL|CROSSBOW|SLINGS|BOW|LT)") || (%Resonance.Check = 1)) then
                    {
                         goto SPELLCHECK_NEXT
                    }
               var Resonance.Check 1
          }
     if matchre("$%GuildType.%SpellArray(%spellcount).Spell", "\b(?i)COL\b") then
          {
               if (($Time.isXibarUp = 0) && ($Time.isYavashUp = 0) && ($Time.isKatambaUp = 0)) then
                    {
                         echo ** NO MOONS UP - NO COL
                         if (%spellcount > 6) then var spellcount 0
                         if (%spellcheckloop > 14) then
                              {
                                   var spellcheckloop 0
                                   ### used to be a return here
                                   goto SPELLCHECK_1
                              }
                         goto SPELLCHECK_NEXT
                    }
          }
 	if (($UC_NoCombat = 1) && (matchre("%SpellArray(%spellcount)", "Target|Debilitation"))) then
	     {
               if (%spellcount >= 6) then var spellcount 0
               if (%spellcheckloop > 14) then
                    {
                         var spellcheckloop 0
                         ### used to be a return here
                         goto SPELLCHECK_1
                    }
               goto SPELLCHECK_NEXT
		}
 	if ((%Backtraining = 1) && ($UC_BacktrainTM = 0) && (matchre("%SpellArray(%spellcount)", "Target|Debilitation"))) then
	     {
               if (%spellcount >= 6) then var spellcount 0
               if (%spellcheckloop > 14) then
                    {
                         var spellcheckloop 0
                         ### used to be a return here
                         goto SPELLCHECK_1
                    }
               goto SPELLCHECK_NEXT
		}
     if ((%indoors = 1) && matchre("$%GuildType.%SpellArray(%spellcount).Spell", "(?i)%Outdoor.Spell.List")) then
          {
               echo ##############################################
               echo *** %%GuildType.%SpellArray(%spellcount).Spell cannot be cast indoors.
               echo ##############################################
               if (%spellcount > 6) then var spellcount 0
               goto SPELLCHECK_NEXT
          }
spellcheck1:
     var LastSpell %CurrentSpell
	if ("%spelllearn" = "Target") then var spelllearn Targeted_Magic
     if (%spellcheckloop > 20) then var spellcheckloop 0
     if ("%SpellArray(%spellcount)" = "") then
          {
               if (%spellcount > 6) then
                    {
                         var spellcount 0
                         ### used to be a return here
                         goto SPELLCHECK_1
                    }
               goto SPELLCHECK_NEXT
          }
     if ($%spelllearn.LearningRate > 33) then
          {
               if (%spellcount >= 6) then
                    {
                         var spellcount 0
                         return
                         ### used to be a return here
                         goto SPELLCHECK_1
                    }
               goto SPELLCHECK_NEXT
          }
     if ("$guild" = "Empath") then
          {
               if ((matchre("$%GuildType.%SpellArray(%spellcount).Spell", "(?i)GS") && matchre("$monsterlist", "(?i)%Undead")) || (matchre("$%GuildType.%SpellArray(%spellcount).Spell", "(?i)GS") && matchre("$UC_combatCritter", "(?i)%Undead"))) then
                    {
                         if (%spellcount >= 6) then var spellcount 0
                         goto SPELLCHECK_NEXT
                    }
               if matchre("$%GuildType.%SpellArray(%spellcount).Spell", "(?i)Paralysis") then
                    {
                         gosub PARALYSIS_TIMER
                         if ((%ParalysisLast < 80) || matchre("$monsterlist", "%Undead")) then
                              {
                                   if (%spellcount >= 6) then var spellcount 0
                                   goto SPELLCHECK_NEXT
                              }
                    }
               if matchre("$%GuildType.%SpellArray(%spellcount).Spell", "(?i)NB") then
                    {
                         gosub NISSA_TIMER
                         if ((%NissaLast < 100) || matchre("$monsterlist", "%Undead")) then
                              {
                                   if (%spellcount >= 6) then var spellcount 0
                                   goto SPELLCHECK_NEXT
                              }
                    }
               if (($UC_ConstructOnly = 1) && ($UC_NoCombat = 0)) then
                    {
                         if ("%Empath.Critter" = "NULL") && matchre("$monsterlist", "(%Undead|%Construct)") then gosub ASSESS
                         if (("%Empath.Critter" != "NULL") && !matchre("%Empath.Critter", "%Construct")) then
                              {
                              if !matchre("%Empath.Critter", "%Undead") then
                                   {
                                        if (matchre("%CurrentSpell", "(?i)(%TM.Spell.List|%Debil.Spell.List)") && !matchre("%CurrentSpell", "\b(?i)(NB|LETHARGY|PARALYSIS|EASE)")) then
                                             {
                                                  echo ######################################################
                                                  echo ** NOPE! %CurrentSpell SPELL WILL CAUSE EMPATHIC SHOCK!! - RELEASE
                                                  echo ######################################################
                                                  pause 0.2
                                                  gosub RELEASE SPELL
                                                  if (%spellcount >= 6) then var spellcount 0
                                                  goto SPELLCHECK_NEXT
                                             }
                                   }
                              }
                    }
          }
	if (matchre("%CurrentSpell", "\b(?i)RM\b") && matchre("$roomexits", "obscured by a thick fog")) then
		{
               if (%spellcount > 6) then var spellcount 0
               goto SPELLCHECK_NEXT
		}
	# if (matchre("%CurrentSpell", "(?i)$%GuildType.Target.Spell") && ($SpellTimer.AetherCloak.active = 1)) then
		# {
               # math spellcount add 1
               # if (%spellcount > 6) then var spellcount 0
               # return
		# }
	if matchre("$%GuildType.%SpellArray(%spellcount).Spell", "(?i)(TKT|TKS)") then
          {
               gosub SHARD_CHECK
               if (("$guild" = "Moon Mage") && (%shardnumber < 5)) then gosub MOONBLADE_PREP
          }

     if (("$guild" = "Empath") && ($UC_ConstructOnly = 1) && ($UC_NoCombat = 0)) then
          {
               if (("%Empath.Critter" = "NULL") && matchre("$monsterlist", "(%Construct|%Undead)")) then gosub ASSESS
               if (("%Empath.Critter" != "NULL") && !matchre("%Empath.Critter", "%Construct")) then
                    {
                    if !matchre("%Empath.Critter", "%Undead") then
                         {
                              if (matchre("%CurrentSpell", "(?i)(%TM.Spell.List|%Debil.Spell.List)") && !matchre("%CurrentSpell", "\b(?i)(NB|LETHARGY|PARALYSIS|EASE)")) then
                                   {
                                        echo #############################################
                                        echo ** Skipping using %CurrentSpell spell.. may cause Empath shock
                                        echo #############################################
                                        goto SPELLCHECK_SET
                                   }
                         }
                    }
          }
TMSPELLCHECK:
     if (%TargetON = 0) then goto DEBILSPELLCHECK
     #### RESETS TM LOOP AFTER DOING 2 FULL NORMAL SPELL LOOPS
     if (%TargetLoops > 10) then var TargetLoops 0
     # if ($SpellTimer.AetherCloak.active = 1) then goto DEBILSPELLCHECK
     #### DOES 2 LOOPS OF TM SPELL IF TM LEARNING IS < 24
     math TargetLoops add 1
     if !matchre("$roomobjs", "(?i)%critters") then goto DEBILSPELLCHECK
     if (($Targeted_Magic.LearningRate < 24) && (%TargetLoops < 3) && (%TargetON = 1) && matchre("%Magic.Rate", "(?i)(NULL|OFF|^%|^\s*$)")) then
          {
               # math spellcount subtract 1
               var CurrentSchool Target
               if (%TargetCount = 0) then var CurrentSpell %%GuildType.Target.Spell
               if (%TargetCount > 0) then var CurrentSpell %%GuildType.Target.Spell(0)
               if ((%TargetCount > 0) && (%TargetLoops = 1)) then var CurrentSpell %%GuildType.Target.Spell(0)
               if ((%TargetCount > 1) && (%TargetLoops = 2)) then var CurrentSpell %%GuildType.Target.Spell(1)
               if ((%TargetCount > 2) && (%TargetLoops = 3)) then var CurrentSpell %%GuildType.Target.Spell(2)
               put #var %GuildType.Target.Spell %CurrentSpell
               echo *** TM spellcount: %TargetLoops/2 (Prioritizing TM)
               if ($UC_SmartSpells = 1) then
                    {
                         if (%TargetCount = 0) then
                              {
                                   var CurrentSpellMana $Mana.%%GuildType.Target.Spell
                                   var CurrentCambMana $Camb.%%GuildType.Target.Spell
                              }
                         if ((%TargetCount > 0) && (%TargetLoops = 1)) then
                              {
                                   var CurrentSpellMana $Mana.%%GuildType.Target.Spell(0)
                                   var CurrentCambMana $Camb.%%GuildType.Target.Spell(0)
                              }
                         if ((%TargetCount > 1) && (%TargetLoops = 2)) then
                              {
                                   var CurrentSpellMana $Mana.%%GuildType.Target.Spell(1)
                                   var CurrentCambMana $Camb.%%GuildType.Target.Spell(1)
                              }
                         if ((%TargetCount > 2) && (%TargetLoops = 3)) then
                              {
                                   var CurrentSpellMana $Mana.%%GuildType.Target.Spell(2)
                                   var CurrentCambMana $Camb.%%GuildType.Target.Spell(2)
                              }
                              # echo Spell Mana: %CurrentSpellMana
                              # echo Camb Mana: %CurrentCambMana
                         goto SPELLCHECK2
                    }
               goto SPELL_NOSMART
          }
DEBILSPELLCHECK:
     if (%DebilitationON = 0) then goto SPELLCHECK_SET
     #### RESETS DEBIL LOOP AFTER DOING 2 FULL NORMAL SPELL LOOPS
     if (%DebTargetLoop > 10) then var DebTargetLoop 0
     #### DOES 2 LOOPS OF DEBIL SPELL IF DEBIL LEARNING IS < 24
     math DebTargetLoop add 1
     if !matchre("$roomobjs", "(?i)%critters") then goto SORCERYCHECK
     if (($Debilitation.LearningRate < 24) && (%DebTargetLoop < 3) && (%DebilitationON = 1) && matchre("%Magic.Rate", "(?i)(NULL|OFF|^%|^\s*$)")) then
          {
               # math spellcount subtract 1
               var CurrentSchool Debilitation
               if (%DebilCount = 0) then var CurrentSpell %%GuildType.Debilitation.Spell
               if (%DebilCount > 0) then var CurrentSpell %%GuildType.Debilitation.Spell(0)
               if ((%DebilCount > 0) && (%DebTargetLoop = 1)) then var CurrentSpell %%GuildType.Debilitation.Spell(0)
               if ((%DebilCount > 1) && (%DebTargetLoop = 2)) then var CurrentSpell %%GuildType.Debilitation.Spell(1)
               if ((%DebilCount > 2) && (%DebTargetLoop = 3)) then var CurrentSpell %%GuildType.Debilitation.Spell(2)
               put #var %GuildType.Debilitation.Spell %CurrentSpell
               echo **** Debil spellcount %DebTargetLoop/2 (Prioritizing Debilitation)
               if ($UC_SmartSpells = 1) then
                    {
                         if (%DebilCount = 0) then
                              {
                                   var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell
                                   var CurrentCambMana $Camb.%%GuildType.Debilitation.Spell
                              }
                         if ((%DebilCount > 0) && (%DebTargetLoop = 1)) then
                              {
                                   var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell(0)
                                   var CurrentCambMana $Camb.%%GuildType.Debilitation.Spell(0)
                              }
                         if ((%DebilCount > 1) && (%DebTargetLoop = 2)) then
                              {
                                   var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell(1)
                                   var CurrentCambMana $Camb.%%GuildType.Debilitation.Spell(1)
                              }
                         if ((%DebilCount > 2) && (%DebTargetLoop = 3)) then
                              {
                                   var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell(2)
                                   var CurrentCambMana $Camb.%%GuildType.Debilitation.Spell(2)
                              }
                         # echo Spell Mana: %CurrentSpellMana
                         # echo Camb Mana: %CurrentCambMana
                         goto SPELLCHECK2
                    }
               goto SPELL_NOSMART
          }
SORCERYCHECK:
     if (%SorceryON = 0) then goto SPELLCHECK_SET
     #### RESETS TM LOOP AFTER DOING 2 FULL NORMAL SPELL LOOPS
     if (%SorceryLoops > 10) then var SorceryLoops 0
     # if ($SpellTimer.AetherCloak.active = 1) then goto DEBILSPELLCHECK
     #### DOES 3 LOOPS OF SORCERY SPELL IF SORCERY LEARNING IS < 24
     math SorceryLoops add 1
     if (%SorceryLoops = 4) then
          {
               if (($Sorcery.Ranks < $Debilitation.Ranks) && ($Sorcery.Ranks < $Targeted_Magic.Ranks)) then
                    {
                         if (($Sorcery.LearningRate < $Debilitation.LearningRate) && ($Sorcery.LearningRate < $Targeted_Magic.LearningRate)) then
                              {
                                   math SorcerySpecial add 1
                                   if (%SorcerySpecial > 2) then
                                        {
                                             var SorcerySpecial 0
                                             goto SORCERYCHECK_2
                                        }
                                   var SorceryLoops 2
                              }
                    }
          }
SORCERYCHECK_2:
     if (($Sorcery.LearningRate < 28) && (%SorceryLoops < 4) && (%TargetON = 1) && matchre("%Magic.Rate", "(?i)(NULL|OFF|^%|^\s*$)")) then
          {
               # math spellcount subtract 1
               var CurrentSchool Sorcery
               if (%SorceryCount = 0) then var CurrentSpell %%GuildType.Sorcery.Spell
               if (%SorceryCount > 0) then var CurrentSpell %%GuildType.Sorcery.Spell(0)
               if ((%SorceryCount > 0) && (%SorceryLoops = 1)) then var CurrentSpell %%GuildType.Sorcery.Spell(0)
               if ((%SorceryCount > 1) && (%SorceryLoops = 2)) then var CurrentSpell %%GuildType.Sorcery.Spell(1)
               if ((%SorceryCount > 2) && (%SorceryLoops = 3)) then var CurrentSpell %%GuildType.Sorcery.Spell(2)
               put #var %GuildType.Sorcery.Spell %CurrentSpell
               echo *** Sorcery spellcount: %SorceryLoops/3 (Prioritizing Sorcery)
               if ($UC_SmartSpells = 1) then
                    {
                         if (%SorceryCount = 0) then
                              {
                                   var CurrentSpellMana $Mana.%%GuildType.Sorcery.Spell
                                   var CurrentCambMana $Camb.%%GuildType.Sorcery.Spell
                              }
                         if ((%SorceryCount > 0) && (%SorceryLoops = 1)) then
                              {
                                   var CurrentSpellMana $Mana.%%GuildType.Sorcery.Spell(0)
                                   var CurrentCambMana $Camb.%%GuildType.Sorcery.Spell(0)
                              }
                         if ((%SorceryCount > 1) && (%SorceryLoops = 2)) then
                              {
                                   var CurrentSpellMana $Mana.%%GuildType.Sorcery.Spell(1)
                                   var CurrentCambMana $Camb.%%GuildType.Sorcery.Spell(1)
                              }
                         if ((%SorceryCount > 2) && (%SorceryLoops = 3)) then
                              {
                                   var CurrentSpellMana $Mana.%%GuildType.Sorcery.Spell(2)
                                   var CurrentCambMana $Camb.%%GuildType.Sorcery.Spell(2)
                              }
                              # echo Spell Mana: %CurrentSpellMana
                              # echo Camb Mana: %CurrentCambMana
                         goto SPELLCHECK2
                    }
               goto SPELL_NOSMART
          }
SPELLCHECK_SET:
     var CurrentSchool %SpellArray(%spellcount)
     var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
     #### CHOOSES A RANDOM SPELL IF MULTIPLE SPELLS ARE SET
     if matchre("%CurrentSchool", "Augmentation") then
          {
          if (%AugmentCount = 1) then
               {
                    random 1 2
                    if (%r = 1) then put #var %GuildType.Augmentation.Spell %%GuildType.Augmentation.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Augmentation.Spell(0);var CurrentCambMana $Mana.%%GuildType.Augmentation.Spell(0)
                    if (%r = 2) then put #var %GuildType.Augmentation.Spell %%GuildType.Augmentation.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Augmentation.Spell(1);var CurrentCambMana $Mana.%%GuildType.Augmentation.Spell(1)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          if (%AugmentCount > 1) then
               {
                    random 1 3
                    if (%r = 1) then put #var %GuildType.Augmentation.Spell %%GuildType.Augmentation.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Augmentation.Spell(0);var CurrentCambMana $Mana.%%GuildType.Augmentation.Spell(0)
                    if (%r = 2) then put #var %GuildType.Augmentation.Spell %%GuildType.Augmentation.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Augmentation.Spell(1);var CurrentCambMana $Mana.%%GuildType.Augmentation.Spell(1)
                    if (%r = 3) then put #var %GuildType.Augmentation.Spell %%GuildType.Augmentation.Spell(2);var CurrentSpellMana $Mana.%%GuildType.Augmentation.Spell(2);var CurrentCambMana $Mana.%%GuildType.Augmentation.Spell(2)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          }
     if matchre("%CurrentSchool", "Utility") then
          {
          if (%UtilCount = 1) then
               {
                    random 1 2
                    if (%r = 1) then put #var %GuildType.Utility.Spell %%GuildType.Utility.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Utility.Spell(0);var CurrentCambMana $Mana.%%GuildType.Utility.Spell(0)
                    if (%r = 2) then put #var %GuildType.Utility.Spell %%GuildType.Utility.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Utility.Spell(1);var CurrentCambMana $Mana.%%GuildType.Utility.Spell(1)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          if (%UtilCount > 1) then
               {
                    random 1 3
                    if (%r = 1) then put #var %GuildType.Utility.Spell %%GuildType.Utility.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Utility.Spell(0);var CurrentCambMana $Mana.%%GuildType.Utility.Spell(0)
                    if (%r = 2) then put #var %GuildType.Utility.Spell %%GuildType.Utility.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Utility.Spell(1);var CurrentCambMana $Mana.%%GuildType.Utility.Spell(1)
                    if (%r = 3) then put #var %GuildType.Utility.Spell %%GuildType.Utility.Spell(2);var CurrentSpellMana $Mana.%%GuildType.Utility.Spell(2);var CurrentCambMana $Mana.%%GuildType.Utility.Spell(2)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          }
     if matchre("%CurrentSchool", "Warding") then
          {
          if (%WardingCount = 1) then
               {
                    random 1 2
                    if (%r = 1) then put #var %GuildType.Warding.Spell %%GuildType.Warding.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Warding.Spell(0);var CurrentCambMana $Mana.%%GuildType.Warding.Spell(0)
                    if (%r = 2) then put #var %GuildType.Warding.Spell %%GuildType.Warding.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Warding.Spell(1);var CurrentCambMana $Mana.%%GuildType.Warding.Spell(1)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          if (%WardingCount > 1) then
               {
                    random 1 3
                    if (%r = 1) then put #var %GuildType.Warding.Spell %%GuildType.Warding.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Warding.Spell(0);var CurrentCambMana $Mana.%%GuildType.Warding.Spell(0)
                    if (%r = 2) then put #var %GuildType.Warding.Spell %%GuildType.Warding.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Warding.Spell(1);var CurrentCambMana $Mana.%%GuildType.Warding.Spell(1)
                    if (%r = 3) then put #var %GuildType.Warding.Spell %%GuildType.Warding.Spell(2);var CurrentSpellMana $Mana.%%GuildType.Warding.Spell(2);var CurrentCambMana $Mana.%%GuildType.Warding.Spell(2)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          }
     if matchre("%CurrentSchool", "Sorcery") then
          {
          if (%SorceryCount = 1) then
               {
                    random 1 2
                    if (%r = 1) then put #var %GuildType.Sorcery.Spell %%GuildType.Sorcery.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Sorcery.Spell(0);var CurrentCambMana $Mana.%%GuildType.Sorcery.Spell(0)
                    if (%r = 2) then put #var %GuildType.Sorcery.Spell %%GuildType.Sorcery.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Sorcery.Spell(1);var CurrentCambMana $Mana.%%GuildType.Sorcery.Spell(1)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          if (%SorceryCount > 1) then
               {
                    random 1 3
                    if (%r = 1) then put #var %GuildType.Sorcery.Spell %%GuildType.Sorcery.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Sorcery.Spell(0);var CurrentCambMana $Mana.%%GuildType.Sorcery.Spell(0)
                    if (%r = 2) then put #var %GuildType.Sorcery.Spell %%GuildType.Sorcery.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Sorcery.Spell(1);var CurrentCambMana $Mana.%%GuildType.Sorcery.Spell(1)
                    if (%r = 3) then put #var %GuildType.Sorcery.Spell %%GuildType.Sorcery.Spell(2);var CurrentSpellMana $Mana.%%GuildType.Sorcery.Spell(2);var CurrentCambMana $Mana.%%GuildType.Sorcery.Spell(2)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          }
     if matchre("%CurrentSchool", "Debilitation") then
          {
          if (%DebilCount = 1) then
               {
                    random 1 2
                    if (%r = 1) then put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell(0);var CurrentCambMana $Mana.%%GuildType.Debilitation.Spell(0)
                    if (%r = 2) then put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell(1);var CurrentCambMana $Mana.%%GuildType.Debilitation.Spell(1)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          if (%DebilCount = 2) then
               {
                    random 1 3
                    if (%r = 1) then put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell(0);var CurrentCambMana $Mana.%%GuildType.Debilitation.Spell(0)
                    if (%r = 2) then put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell(1);var CurrentCambMana $Mana.%%GuildType.Debilitation.Spell(1)
                    if (%r = 3) then put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(2);var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell(2);var CurrentCambMana $Mana.%%GuildType.Debilitation.Spell(2)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          if (%DebilCount > 2) then
               {
                    random 1 4
                    if (%r = 1) then put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell(0);var CurrentCambMana $Mana.%%GuildType.Debilitation.Spell(0)
                    if (%r = 2) then put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell(1);var CurrentCambMana $Mana.%%GuildType.Debilitation.Spell(1)
                    if (%r = 3) then put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(2);var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell(2);var CurrentCambMana $Mana.%%GuildType.Debilitation.Spell(2)
                    if (%r = 4) then put #var %GuildType.Debilitation.Spell %%GuildType.Debilitation.Spell(3);var CurrentSpellMana $Mana.%%GuildType.Debilitation.Spell(3);var CurrentCambMana $Mana.%%GuildType.Debilitation.Spell(3)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          }
     if matchre("%CurrentSchool", "Target") then
          {
          if (%TargetCount = 1) then
               {
                    random 1 2
                    if (%r = 1) then put #var %GuildType.Target.Spell %%GuildType.Target.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Target.Spell(0);var CurrentCambMana $Mana.%%GuildType.Target.Spell(0)
                    if (%r = 2) then put #var %GuildType.Target.Spell %%GuildType.Target.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Target.Spell(1);var CurrentCambMana $Mana.%%GuildType.Target.Spell(1)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          if (%TargetCount > 1) then
               {
                    random 1 3
                    if (%r = 1) then put #var %GuildType.Target.Spell %%GuildType.Target.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Target.Spell(0);var CurrentCambMana $Mana.%%GuildType.Target.Spell(0)
                    if (%r = 2) then put #var %GuildType.Target.Spell %%GuildType.Target.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Target.Spell(1);var CurrentCambMana $Mana.%%GuildType.Target.Spell(1)
                    if (%r = 3) then put #var %GuildType.Target.Spell %%GuildType.Target.Spell(2);var CurrentSpellMana $Mana.%%GuildType.Target.Spell(2);var CurrentCambMana $Mana.%%GuildType.Target.Spell(2)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          if (%TargetCount > 2) then
               {
                    random 1 4
                    if (%r = 1) then put #var %GuildType.Target.Spell %%GuildType.Target.Spell(0);var CurrentSpellMana $Mana.%%GuildType.Target.Spell(0);var CurrentCambMana $Mana.%%GuildType.Target.Spell(0)
                    if (%r = 2) then put #var %GuildType.Target.Spell %%GuildType.Target.Spell(1);var CurrentSpellMana $Mana.%%GuildType.Target.Spell(1);var CurrentCambMana $Mana.%%GuildType.Target.Spell(1)
                    if (%r = 3) then put #var %GuildType.Target.Spell %%GuildType.Target.Spell(2);var CurrentSpellMana $Mana.%%GuildType.Target.Spell(2);var CurrentCambMana $Mana.%%GuildType.Target.Spell(2)
                    if (%r = 4) then put #var %GuildType.Target.Spell %%GuildType.Target.Spell(3);var CurrentSpellMana $Mana.%%GuildType.Target.Spell(3);var CurrentCambMana $Mana.%%GuildType.Target.Spell(3)
                    var CurrentSpell $%GuildType.%SpellArray(%spellcount).Spell
                    goto SPELLCHECK2
               }
          }
     if ($UC_SmartSpells = 0) then goto SPELL_NOSMART
### WE GO TO SPELL_SMART WHEN WE WANT TO USE THE SMART MANA GLOBAL VARIABLE DEFINED FOR THAT SPECIFIC SPELL
### THIS SHOULD HAVE BEEN ALREADY SET PREVIOUSLY BY THE DISCERN ROUTINE OR SETUP
SPELL_SMART:
     var CurrentSpellMana $Mana.%%GuildType.%SpellArray(%spellcount).Spell
     var CurrentCambMana $Camb.%%GuildType.%SpellArray(%spellcount).Spell
     if (%CurrentSpellMana = 0) then
          {
               put #var Mana.%%GuildType.%SpellArray(%spellcount).Spell 1
               var CurrentSpellMana 1
          }
     goto SPELLCHECK2
### SPELL_NOSMART IS FOR SMART SPELLS OFF - OR FOR OTHER MISC THINGS LIKE TM_FOCI LOGIC
SPELL_NOSMART:
	var CurrentSpellMana $Mana.%CurrentSchool
     var CurrentCambMana $Camb.%CurrentSchool
SPELLCHECK2:
     if ($stunned) then waiteval (!$stunned)
     if matchre("%CurrentSpell", "(?i)NULL") then
          {
               if (%spellcount > 6) then
                    {
                         var spellcount 0
                         ### used to be a return here
                         goto SPELLCHECK_1
                    }
               goto SPELLCHECK_NEXT
          }
     if (matchre("%CurrentSpell", "\b(?i)$%GuildType.Sorcery.Spell\b") && ($UC_SmartSpells = 0)) then
          {
               if (!matchre("%Sorcery.Mana", "(?i)(NULL|OFF)") && ($UC_SmartSpells = 0)) then var CurrentSpellMana %Sorcery.Mana
               if (!matchre("%Sorcery.Camb", "(?i)(NULL|OFF)") && ($UC_SmartSpells = 0)) then var CurrentCambMana $Camb.Sorcery
               echo *** SMART SPELLS SETTING IS OFF - RESETTING SORCERY MANA BACK TO %CurrentSpellMana
          }
     if matchre("%CurrentSpell", "\b(?i)SLS\b") then
          {
               gosub SLS_SET
               if matchre("%SLS", "(?i)NULL") then goto SPELLCHECK_NEXT
          }
     if (matchre("%CurrentSchool", "(Target|Debilitation)") && !matchre("$roomobjs", "(?i)%critters")) then
          {
               if (%looploop > 3) then goto SPELLCHECK_RETURN
               echo *** NO MONSTERS DETECTED - SKIPPING TM/DEBIL SPELL
               goto SPELLCHECK_NEXT
          }
	if matchre("%CurrentSpell", "%Cyclic.Spell.List") then
          {
               if ($spell%CurrentSpell) then gosub RELEASE cyclic
          }
     if (matchre("%CurrentSpell", "(?i)(ETF|EtherealFissure)") && !matchre("$roomobjs", "a .+ fissure")) then put #tvar spellETF 0
     if (matchre("%CurrentSpell", "(?i)(RM|RisingMists)") && !matchre("$roomobjs", "(dense unnatural fog|wispy grey mist)")) then put #tvar spellRM 0
     ######
     if (($UC_%CurrentSchool.Symbiosis) && !matchre("%CurrentSpell", "\b(?i)(%Cyclic.Spell.List|%Ritual.Spell.List)\b") && (!$preparedSymbiosis)) then
          {
               pause 0.00001
               gosub PUT prepare symbiosis
          }
     if ($preparedSymbiosis = 1) then
          {
               if (matchre("%CurrentSpell", "(?i)%Ritual.Spell.List") || (!$UC_%CurrentSchool.Symbiosis)) then
                    {
                         put release symbiosis
                         pause 0.4
                    }
          }
     if matchre("%CurrentSpell", "\b(?i)%Magic.Tattoo\b") then
          {
               if ($hidden = 1) then gosub UNHIDE
               gosub INVOKE tattoo
               pause 0.001
               var spelllearn Sorcery
               var spellID %Magic.Tattoo
               var CurrentSpell %Magic.Tattoo
               var CurrentCambMana $Camb.Tattoo
               if (matchre("%CurrentSchool", "(Target|Sorcery)") || (%MagicTM = 1) || matchre("%CurrentSpell", "(?i)%TM.Spell.List")) then
                    {
                         send target
                         var MagicTM 0
                         pause 0.5
                    }
          }
     if !matchre("%CurrentSpell", "\b(?i)%Magic.Tattoo\b") then
          {
               if (("%CurrentSchool" = "Target") || matchre("%TM.Spell.List", "\b%CurrentSpell\b") || (matchre("%CurrentSpell", "\b(DR|DivineRadiance)") && matchre("%CurrentSpell", "%%GuildType.Target.Spell"))) then gosub TM %CurrentSpell %CurrentSpellMana
               else gosub PREPARE %CurrentSpell %CurrentSpellMana
          }
     var CastTime $gametime
     delay 0.00001
     ##### SPECIAL
     ### if (!matchre("%Magic.Rate", "(?i)(NULL|OFF|^%|^\s*$)") && ($%spelllearn.LearningRate > %Magic.Rate)) then goto SPELLCHECK_NEXT
	### if matchre("%Magic.Rate", "(?i)(NULL|OFF|^%|^\s*$)") then math spellcount add 1
     if (%spellcount > 6) then var spellcount 0
     if matchre("%CurrentSpell", "(?i)%Cyclic.Spell.List") then
          {
               var CyclicActive 1
               if (%RawChanneling = 0) then send harness %CambrinthMana
               pause 0.5
          }
     if matchre("(?i)%Ritual.Spell.List", "\b%CurrentSpell\b") then gosub RITUAL
     if matchre("%CurrentSpell", "(?i)(TKT|TKS)") then
          {
               gosub SHARD_CHECK
               if (("$guild" != "Moon Mage") && !matchre("$roomobjs", "\bcoins?\b") && (%InCombat = 1)) then put drop 2 copper kron
               if (("$guild" = "Moon Mage") && (%shardnumber = 0) && !matchre("$roomobjs", "\bcoins?\b") && (%InCombat = 1)) then put drop 2 copper kron
          }
     ### REMOVED CAMBRINTH CHARGING HERE
     if ((%Backfired = 1) && ($UC_SmartSpells = 1)) then
          {
               var CurrentBackfire %CurrentSpell
               gosub SPELL_BACKFIRED
               var Backfired 0
          }
     if ((%Backfired = 1) && ($UC_SmartSpells = 0)) then
          {
               echo ###############
               echo *** BACKFIRED %spellID !
               echo ###############
               put #echo >Log #FC0FC0 ** BACKFIRED %spellID !
               var Backfired 0
          }
     if (matchre("(?i)%Cyclic.Spell.List", "\b%CurrentSpell\b") && (%RawChanneling = 0)) then send harness %CambrinthMana
     # if ("$preparedspell" = "Lethargy") then send target %Critter
     goto SPELLCHECK_RETURN
SPELL_CAMBRINTH:
     delay 0.00001
     if (matchre("$guild", "Necromancer") && ($Utility.Ranks < 250) && matchre("%CurrentSpell", "(EOTB|ROC|ROG)") then return
     if matchre("%Cyclic.Spell.List", "\b(?i)%CurrentSpell\b") then return
     if (($UC_NoCambTM = 1) && matchre("%CurrentSchool", "(?i)(TARGET|DEBILITATION)")) then return
     if (($UC_NoCambTM = 1) && matchre("%CurrentSpell", "(?i)(%TM.Spell.List|%Debil.Spell.List)")) then return
	if ("%CurrentCambMana" = "") then return
     if matchre("%CurrentCambMana", "\b(NULL|0)") then return
     if ((%MagicTM = 1) && matchre("%CurrentSpell", "\b(?i)%Magic.Tattoo\b") && matchre("%CurrentSpell", "\b(?i)%TM.Spell.List\b")) then
          {
               echo *** TM Magic Tattoo detected - Acquiring Target
               var MagicTM 0
               put target
               pause 2
               pause 0.5
          }
     if ((!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ($Arcana.LearningRate < 31)) || (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ($Attunement.LearningRate > 31))) then
          {
               if (($Arcana.Ranks < 205) && !matchre("$lefthand", "Empty") && !matchre("$UC_WeaponType", "OFFHAND")) then gosub STOWIT left
               pause 0.0001
               if (($Arcana.Ranks < 205) && !matchre("$righthand", "Empty") && matchre("$UC_WeaponType", "OFFHAND")) then gosub STOWIT right
               if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)")  && ($Arcana.Ranks < 200)) then gosub REMOVE my $UC_Cambrinth
               if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ("$preparedspell" != "None") && (%CambrinthCharge > 0) && (%cambCharged = 0)) then
                    {
                         gosub CHARGE my $UC_Cambrinth %CurrentCambMana
                         if (%CambrinthCharge = 1) then var cambCharged 1
                    }
               if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ("$preparedspell" != "None") && (%CambrinthCharge > 1) && (%cambCharged = 0)) then
                    {
                         gosub CHARGE my $UC_Cambrinth %CurrentCambMana
                         if (%CambrinthCharge = 2) then var cambCharged 1
                    }
               if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ("$preparedspell" != "None") && (%CambrinthCharge > 2) && (%cambCharged = 0)) then
                    {
                         gosub CHARGE my $UC_Cambrinth %CurrentCambMana
                         if (%CambrinthCharge > 2) then var cambCharged 1
                    }
               if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ("$preparedspell" != "None")) then
                    {
                         if (matchre("(?i)%Cyclic.Spell.List", "\b%CurrentSpell\b") && (%DedicatedCamb = 1) && (%RawChanneling = 0)) then gosub INVOKE my $UC_Cambrinth cyclic
                         else gosub INVOKE my $UC_Cambrinth spell
                    }
          if ($Arcana.Ranks < 205) then gosub WEAR $UC_Cambrinth
          if (matchre("$righthand $lefthand", "$UC_Cambrinth") && !matchre("$UC_Cambrinth", "(?i)%WEAPON")) then gosub WEAR $UC_Cambrinth
          if (matchre("$righthand $lefthand", "$UC_Cambrinth") && !matchre("$UC_Cambrinth", "(?i)%WEAPON")) then gosub STOWIT $UC_Cambrinth
          if (%InCombat = 1) then
               {
                    if (!matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") && !matchre("(?i)%WEAPON", "(?i)\b($charactername|NULL|OFF|0|^%|^\s*$)\b")) then gosub WIELD %WEAPON
               }
          }
	else
          {
               if !matchre("(?i)%Cyclic.Spell.List", "\b%CurrentSpell\b") then
               {
                    if (("$preparedspell" != "None") && (%CambrinthCharge > 0) && (%cambCharged = 0)) then
                         {
                              gosub HARNESS %CurrentCambMana
                              if (%CambrinthCharge = 1) then var cambCharged 1
                         }
                    if (("$preparedspell" != "None") && (%CambrinthCharge > 1) && (%cambCharged = 0)) then
                         {
                              gosub HARNESS %CurrentCambMana
                              if (%CambrinthCharge = 2) then var cambCharged 1
                         }
                    if (("$preparedspell" != "None") && (%CambrinthCharge > 2) && (%cambCharged = 0)) then
                         {
                              gosub HARNESS %CurrentCambMana
                              if (%CambrinthCharge > 2) then var cambCharged 1
                         }
			}
          }
     if (("$guild" = "Warrior Mage") && ($pathway = 1)) then
          {
               put path sense
               pause 0.3
               pause 0.2
               pause 0.00001
               if (($charge < 9) || ($Summoning.LearningRate > 30)) then put pathway stop
          }
     return
SPELLCHECK_NEXT:
     math spellcount add 1
     goto SPELLCHECK_1
SPELLCHECK_RETURN:
     var looploop 0
     return
###############################
# BUFF CHECKS
###############################
BUFF_CHECK:
     # debug 10
     action (magic) on
     var Backfired 0
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then gosub SPELL_WAIT
     if (("$guild" = "Necromancer") && ($spellROC = 1)) then gosub RELEASE ROC
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     echo
     echo ******** BUFF CHECK
     echo
     if ("$guild" = "Commoner") then return
     if ("$guild" = "Thief") then goto THIEF_CHECK
     if ("$guild" = "Barbarian") then goto BARB_CHECK
     if (("$guild" = "Warrior Mage") then
          {
               if !matchre("$roomobjs", "a .+ fissure") then put #tvar spellETF 0
               if !matchre("$roomobjs", "(dense unnatural fog|wispy grey mist)") then put #tvar spellRM 0
               if $pathway = 1) then
                    {
                         put path sense
                         pause 0.3
                         pause 0.2
                         pause 0.1
                         if (($charge < 9) || ($Summoning.LearningRate > 30)) then put pathway stop
                    }
          }
     if ($mana < 30) then
          {
               echo
               echo *** MANA TOO LOW - SKIPPING BUFF CHECK
               echo
               return
          }
     var buffcheck 0
BUFF_CHECK1:
     # eval %GuildType.Buffs toupper("%%GuildType.Buffs")
     eval BUFFTOTAL count("%buffs", "|")
     evalmath BUFFTOTAL (%BUFFTOTAL + 1)
     eval %GuildType.Buffs toupper("%%GuildType.Buffs")
     if ("%%GuildType.Buffs" = "") then return
     if matchre("%%GuildType.Buffs", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then return
BUFF_CHECK2:
     delay 0.00001
     if (%buffcheck > 19) then return
     if (%Playing = 1) then gosub STOP_PLAY
     if (%buffcheck > %BUFFTOTAL) then goto BUFF_CHECK_RETURN
     if ("%buffabbrevs(%buffcheck)" = "") then goto BUFF_CHECK_NEXT
     if matchre("%buffabbrevs(%buffcheck)", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto BUFF_CHECK_NEXT
     if matchre("%buffabbrevs(%buffcheck)", "(?i)RUE") then
          {
               if matchre("$UC_WeaponType","(SLINGS|BOW|CROSSBOW|BRAWL|LT)") then goto BUFF_CHECK_NEXT
          }
     if matchre("%buffabbrevs(%buffcheck)", "(?i)RESONANCE") then
          {
               if matchre("$UC_WeaponType","(OFFHAND|BRAWL|CROSSBOW|SLINGS|BOW)") then goto BUFF_CHECK_NEXT
               if (%Resonance.Check = 1) then goto BUFF_CHECK_NEXT
               var Resonance.Check 1
          }
     if matchre("%buffabbrevs(%buffcheck)", "(?i)IOTS") then
          {
               if (($SpellTimer.InvocationoftheSpheres.active = 1) && ($SpellTimer.InvocationoftheSpheres.duration <= 2)) then gosub RELEASE IOTS
               if ($SpellTimer.InvocationoftheSpheres.duration > 2) then goto BUFF_CHECK_NEXT
               gosub IOTS_CHECK
               if matchre("%planet", "(?i)NULL") then
                    {
                         echo #######################
                         echo *** No Valid Planet to Cast On!
                         echo *** SKIPPING IOTS!
                         echo *** Last IOTS Planet: %lastIOTS
                         echo #######################
                         goto BUFF_CHECK_NEXT
                    }
          }
     delay 0.00001
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then gosub SPELL_WAIT
     if matchre("%buffs(%buffcheck)", "\b(?i)%Magic.Tattoo\b") then
          {
               if ($SpellTimer.%buffs(%buffcheck).duration <= 2) then gosub BUFF %buffabbrevs(%buffcheck)
               pause 0.00001
               pause 0.00001
               if (matchre("%buffs", "%buffs(%buffcheck)") && ($spell%buffabbrevs(%buffcheck) = 0)) then gosub BUFF %buffabbrevs(%buffcheck) $Mana.%buffabbrevs(%buffcheck)
          }
     ### SPECIAL SECTION FOR ROOM-ONLY BUFFS THAT DON'T SHOW UP IN SPELLTIMER
     if matchre("%buffabbrevs(%buffcheck)", "(?i)(ZEPHYR|SW|RM|RISINGMIST)") then
          {
                    if ($spell%buffabbrevs(%buffcheck) = 0) then gosub BUFF %buffabbrevs(%buffcheck) $Mana.%buffabbrevs(%buffcheck)
                    goto BUFF_CHECK_NEXT
          }
     if (($SpellTimer.%buffs(%buffcheck).duration <= 2) || ($spell%buffabbrevs(%buffcheck) = 0)) then gosub BUFF %buffabbrevs(%buffcheck) $Mana.%buffabbrevs(%buffcheck)
     delay 0.00001
BUFF_CHECK_NEXT:
     math buffcheck add 1
     goto BUFF_CHECK2
BUFF_CHECK_RETURN:
     if ("$guild" = "Cleric") then
               {
                    if (matchre("%buffs", "(?i)\b(OsrelMeraud|OM)\b") && (%OrbFull = 0)) then gosub OM_CHECK
                    if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 80)) then gosub CHARGE_ORB %OM.Mana
                    # if ($mana < 50) then echo *** Waiting on Mana.
                    # if ($mana < 50) then waiteval ($mana > 70)
               }
     return
###############################
### Cyclic Spells
###############################
CYCLIC_SETUP:
     var TotalCyclics 0
     if matchre("%%GuildType.Cyclics", "(?i)NULL|NIL") then return
     put #var %GuildType.Cyclics %%GuildType.Cyclics
     eval %GuildType.Cyclics replacere("%%GuildType.Cyclics", "^\||\|$", "")
     eval %GuildType.Cyclics replacere("%%GuildType.Cyclics", "\|+", "|")
     eval %GuildType.Cyclics replacere("%%GuildType.Cyclics", "\|$", "")
     eval %GuildType.Cyclics replacere("%%GuildType.Cyclics", "^\|", "")
     eval %GuildType.Cyclics.mana replacere("%%GuildType.Cyclics.mana", "^\||\|$", "")
     eval %GuildType.Cyclics.mana replacere("%%GuildType.Cyclics.mana", "\|+", "|")
     eval %GuildType.Cyclics.mana replacere("%%GuildType.Cyclics.mana", "\|$", "")
     eval %GuildType.Cyclics.mana replacere("%%GuildType.Cyclics.mana", "^\|", "")
     eval TotalCyclics count("%%GuildType.Cyclics", "|")
     gosub cyclicLearnSet
     eval cyclicLearn replacere("%cyclicLearn", "^\||\|$", "")
     evalmath learningCyclics (%TotalCyclics + 1)
     var cyclicNumber 0
     echo *** Total Cyclics: %learningCyclics
     echo *** Cyclics: %%GuildType.Cyclics
     return
CYCLICLEARNSET:
     var cyclicLearn
     var cyclic.count 0
CYCLICLEARNSET_1:
     if matchre("%%GuildType.Cyclics", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then return
     if (%cyclic.count > %TotalCyclics) then return
     if matchre("%%GuildType.Cyclics(%cyclic.count)", "%Targeted_MagicCyclic") then var cyclicLearn %cyclicLearn|Targeted_Magic
     if matchre("%%GuildType.Cyclics(%cyclic.count)", "%AugmentationCyclic") then var cyclicLearn %cyclicLearn|Augmentation
     if matchre("%%GuildType.Cyclics(%cyclic.count)", "%DebilitationCyclic") then var cyclicLearn %cyclicLearn|Debilitation
     if matchre("%%GuildType.Cyclics(%cyclic.count)", "%UtilityCyclic") then var cyclicLearn %cyclicLearn|Utility
     if matchre("%%GuildType.Cyclics(%cyclic.count)", "%WardingCyclic") then var cyclicLearn %cyclicLearn|Warding
     math cyclic.count add 1
     goto CYCLICLEARNSET_1

CYCLIC:
     var cyclic.backfire 0
CYCLIC_1:
     var cyclic.casting 1
     var cyclic.loop 0
     var cyclic.count 0
     delay 0.0001
     pause 0.00001
     if ((%Backtraining = 1) && ($UC_BacktrainMagic = 0)) then return
	if matchre("%%GuildType.Cyclics", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then return
     if ($standing = 0) then gosub STAND
     if (%TotalCyclics = 0) then goto CYCLIC_SET
	var cyclicNumber 0
	var lowcyclic %cyclicLearn(0)
CYCLIC_CHOOSE:
     delay 0.00001
     math cyclic.loop add 1
     if (%cyclic.loop > 7) then return
	if (%cyclicNumber > %learningCyclics) then
          {
               # gosub RELEASE cyclic
               var cyclic.count 0
               goto CYCLIC_SET
          }
	if ($%cyclicLearn(%cyclicNumber).LearningRate < $%lowcyclic.LearningRate) then
		{
			var cyclic.count %cyclicNumber
			var lowcyclic %%GuildType.Cyclics(%cyclicNumber)
               if matchre("%cyclic", "(?i)SA") then
                    {
                    if (matchre("$monsterlist", "(?i)%Undead") || matchre("%COMBAT.CRITTER", "(?i)%Undead")) then
                         {
                              echo ** UNDEAD! SKIPPING SOUL ATTRITION!
                              if (%learningCyclics = 1) then return
                              math cyclic.count add 1
                              pause 0.01
                              if (%cyclic.count > %learningCyclics) then math cyclic.count subtract 2
                              goto CYCLIC_SET
                         }
                    }
               if (matchre("%cyclic", "(?i)USOL") && (%Backtraining = 1)) then
                    {
                         echo ** BACKTRAINING ACTIVE - SKIPPING USOL
                         if (%learningCyclics = 1) then return
                         math cyclic.count add 1
                         pause 0.01
                         if (%cyclic.count > %learningCyclics) then math cyclic.count subtract 2
                         goto CYCLIC_SET
                    }
               if (matchre("%cyclic", "(?i)SLS") && ($Time.isDay = 1)) then
                    {
                         if (%learningCyclics = 1) then
                              {
                                   echo ** DAY TIME - NO SLS
                                   return
                              }
                         echo ** DAY TIME - NO SLS - CHOOSING DIFFERENT CYCLIC
                         math cyclic.count add 1
                         pause 0.01
                         if (%cyclic.count > %learningCyclics) then math cyclic.count subtract 2
                         goto CYCLIC_SET
                    }
		}
     math cyclicNumber add 1
     goto CYCLIC_CHOOSE

CYCLIC_SET:
     var cyclic %%GuildType.Cyclics(%cyclic.count)
     var mana.cyclic %%GuildType.Cyclics.mana(%cyclic.count)
     if ("%%GuildType.Cyclics.mana(%cyclic.count)" = "") then
          {
               echo
               echo *** CYCLIC ERROR!  YOU DIDN'T SET YOUR VARIABLES PROPERLY!
               echo *** CYCLIC MANA IS NOT PROPERLY DEFINED FOR %%GuildType.Cyclics.mana(%cyclic.count) !!
               echo *** SETTING TO A BASE OF 5
               var mana.cyclic 5
          }
     if !matchre("%%GuildType.Cyclics.mana(%cyclic.count)", "\d+") then
          {
               echo *** CYCLIC ERROR!  YOU DIDN'T SET YOUR VARIABLES PROPERLY!
               echo *** CYCLIC MANA IS NOT PROPERLY DEFINED FOR %%GuildType.Cyclics.mana(%cyclic.count) !!
               echo *** SETTING TO A BASE OF 5
               var mana.cyclic 5
          }
     if matchre("%cyclic", "(?i)SA") then
          {
          if (matchre("$monsterlist", "(?i)%Undead") || matchre("%COMBAT.CRITTER", "(?i)%Undead")) then
               {
                    echo ** UNDEAD! SKIPPING SOUL ATTRITION!
                    if (%learningCyclics = 1) then return
                    math cyclic.count add 1
                    pause 0.01
                    if (%cyclic.count > %learningCyclics) then math cyclic.count subtract 2
                    goto CYCLIC_SET
               }
          }
     if (matchre("%cyclic", "(?i)USOL") && (%Backtraining = 1)) then
          {
               echo ** BACKTRAINING ACTIVE - SKIPPING USOL
               if (%learningCyclics = 1) then return
               math cyclic.count add 1
               pause 0.01
               if (%cyclic.count > %learningCyclics) then math cyclic.count subtract 2
               goto CYCLIC_SET
          }
     if (matchre("%cyclic", "(?i)SLS") && ($Time.isDay = 1)) then
          {
               if (%learningCyclics = 1) then
                    {
                         return
                    }
               echo ** DAY TIME! NO SLS! CHOOSING DIFFERENT CYCLIC
               math cyclic.count add 1
               pause 0.01
               if (%cyclic.count > %learningCyclics) then math cyclic.count subtract 2
               goto CYCLIC_SET
          }
     if matchre("%cyclic", "\b(?i)SLS\b") then
          {
               gosub SLS_SET
               if matchre("%SLS", "(?i)NULL") then return
          }
     if (matchre("%cyclic", "(?i)%Outdoor.Spell.List") && (%indoors = 1)) then
          {
               echo ################
               echo *** Cant cast %cyclic indoors
               echo *** SKIPPING
               echo ################
               return
          }
     if matchre("%cyclic", "(^%|^\s*$|^$)") then return
     if matchre("%cyclic", "$^") then return
     if (matchre("%Targeted_MagicCyclic|%DebilitationCyclic", "%cyclic") && ($spell%cyclic)) then
          {
               var CyclicTime $gametime
               return
          }
     if (("$guild" = "Bard") && ($Bardic_Lore.Ranks > 200)) then goto CYCLIC_SET_2
     else gosub RELEASE cyclic
CYCLIC_SET_2:
     echo
     echo ####################
     echo * $guild Cyclic: %cyclic @ %mana.cyclic mana
     echo * Count: %cyclic.count
     echo ####################
     echo
     pause 0.001
     var CurrentSpell %cyclic
     var CurrentSpellMana %mana.cyclic
     var CurrentCambMana %mana.cyclic
     var CurrentSchool CYCLIC
     var SCHOOL CYCLIC
     delay 0.00001
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if (("$guild" = "Bard") && ($Bardic_Lore.Ranks > 200)) then goto SEGUE
     goto CYCLIC_GO

SEGUE:
     pause 0.00001
     matchre CYCLIC_GO ^You must be performing a cyclic spell to segue from
     matchre CYCLIC_GO_2 ^You attempt to segue
     send segue %cyclic %mana.cyclic
     matchwait 5
     goto CYCLIC_GO

CYCLIC_GO:
     gosub PREPARE %cyclic %mana.cyclic
CYCLIC_GO_2:
     pause 0.00001
     pause 0.00001
     if (%DedicatedCamb = 1) then
          {
               if (($Arcana.Ranks < 205) && !matchre("$lefthand", "Empty") && !matchre("$UC_WeaponType", "OFFHAND")) then gosub STOW $lefthandnoun
               if (($Arcana.Ranks < 205) && !matchre("$righthand", "Empty") && matchre("$UC_WeaponType", "OFFHAND")) then gosub STOW $righthandnoun
               if ((!matchre("$UC_Cyclic.Cambrinth", "NULL") && ($Arcana.Ranks < 205)) then gosub REMOVE my $UC_Cyclic.Cambrinth
               if ((!matchre("$UC_Cyclic.Cambrinth", "NULL") && ("$preparedspell" != "None") && (%cambCharged = 0)) then
                    {
                         gosub CHARGE my $UC_Cyclic.Cambrinth $UC_CyclicCharge
                         var cambCharged 1
                    }
               if ((!matchre("$UC_Cyclic.Cambrinth", "NULL") && ("$preparedspell" != "None")) then
                    {
                         if (matchre("%cyclic", "(?i)%Cyclic.Spell.List") && (%DedicatedCamb = 1)) then gosub INVOKE my $UC_Cyclic.Cambrinth cyclic
                         else gosub INVOKE my $UC_Cyclic.Cambrinth spell
                    }
               if ((!matchre("$UC_Cyclic.Cambrinth", "NULL") && ($Arcana.Ranks < 205)) then gosub WEAR $UC_Cyclic.Cambrinth
               if matchre("$righthand $lefthand", "$UC_Cyclic.Cambrinth") then gosub WEAR $UC_Cyclic.Cambrinth
          }
     if ("$preparedspell" != "None") then
          {
               if (%spellPrepped = 1) then goto CYCLIC_CAST
               else goto CYCLIC_WAIT
          }
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     #if (%Backfired) then goto BUFF_START_1
CYCLIC_WAIT:
     pause 0.1
     pause 0.00001
     var cyclicwaitcount 0
     if ("$preparedspell" = "None") then return
     if (%spellPrepped = 1) then goto CYCLIC_CAST
     eval temp count("%AimActions", "|")
CYCLIC_WAIT_ACTIONS:
     pause 0.00001
     if (%spellPrepped = 1) then goto CYCLIC_CAST
     if (%cyclicwaitcount > %temp) then goto CYCLIC_WAIT_2
     if (($monstercount > 0) && ($hidden = 0)) then
          {
               if (matchre("%AimActions(%cyclicwaitcount)", "throw (.*)") then
                    {
                         var aimthrow $1
                         gosub GET_IT %aimthrow
                         if (!matchre("$lefthand", "%aimthrow") && !matchre("$righthand", "(?i)%WEAPON")) then
                              {
                                   put swap
                                   pause 0.3
                              }
                         gosub put %ThrowType left
                         gosub STOW %aimthrow
                    }
               if matchre("%AimActions(%cyclicwaitcount)", "(?i)attack\b") then
                    {
                         if matchre("$righthand", "(?i)(shortbow|bow|crossbow|sling|slurbow|arbalest|longbow)") then
                              {
                                   if ($monstercount > 0) then gosub PUT attack left
                              }
                         else if ($monstercount > 0) then gosub PUT attack
                    }
               else put %AimActions(%cyclicwaitcount)
          }
     pause 0.5
     pause 0.2
     pause 0.00001
     if (%spellPrepped = 1) then goto CYCLIC_CAST
     math cyclicwaitcount add 1
     goto CYCLIC_WAIT_ACTIONS
CYCLIC_WAIT_2:
     if (%spellPrepped = 1) then goto CYCLIC_CAST
     matchre CYCLIC_CAST ^You feel fully prepared|^Your concentration
     matchwait 24
CYCLIC_CAST:
     gosub SPELL_CAST
     pause 0.00001
     if ((%Backfired = 1) && ($UC_SmartSpells = 1)) then
          {
               math cyclic.backfire add 1
               if (%cyclic.backfire > 2) then return
               var CurrentBackfire %CurrentSpell
               gosub SPELL_BACKFIRED
               var Backfired 0
               goto CYCLIC_SET
          }
     var CyclicTime $gametime
     var cyclic.casting 0
     if matchre("$guild", "Empath") then
          {
               if matchre("$roomobjs", "(alfar|dastardly|senile|gracile|ethereal|tall|lean|slim|graceful|trim|alert|serene|delicate|slender|stoic|athletic|lithe|lissome|solemn|sedate|tranquil|wiry|svelte|imposing|savage) warrior") then
                    {
                         if (%Empath.Brawl = 0) then send command warrior to stance defense
                         if (%Empath.Brawl = 1) then send command warrior to stance offense
                         pause 0.5
                         if (%Empath.Brawl = 0) then send command warrior to behavior defensive
                         if (%Empath.Brawl = 1) then send command warrior to behavior aggressive
                    }
          }
     return
###############################
# BACKFIRE LOGIC
###############################
SPELL_BACKFIRE_SEVERITY:
     if (%BackfireSeverity = 6) then
          {
               if ((%CurrentSpellMana >= 3) && (%CurrentSpellMana < 8)) then math mana.drop add 2
               if ((%CurrentSpellMana >= 8) && (%CurrentSpellMana < 18)) then math mana.drop add 3
               if ((%CurrentSpellMana >= 18) && (%CurrentSpellMana < 27)) then math mana.drop add 5
               if ((%CurrentSpellMana >= 27) && (%CurrentSpellMana < 50)) then math mana.drop add 7
               if ((%CurrentSpellMana >= 50) && (%CurrentSpellMana < 100)) then math mana.drop add 12
               if ((%CurrentSpellMana >= 100) && (%CurrentSpellMana < 500)) then math mana.drop add 20
               if ((%CurrentSpellMana >= 500) && (%CurrentSpellMana < 900)) then math mana.drop add 40
               return
          }
     if (%BackfireSeverity = 5) then
          {
               if ((%CurrentSpellMana >= 3) && (%CurrentSpellMana < 8)) then math mana.drop add 1
               if ((%CurrentSpellMana >= 8) && (%CurrentSpellMana < 18)) then math mana.drop add 2
               if ((%CurrentSpellMana >= 18) && (%CurrentSpellMana < 27)) then math mana.drop add 4
               if ((%CurrentSpellMana >= 27) && (%CurrentSpellMana < 50)) then math mana.drop add 6
               if ((%CurrentSpellMana >= 50) && (%CurrentSpellMana < 100)) then math mana.drop add 10
               if ((%CurrentSpellMana >= 100) && (%CurrentSpellMana < 500)) then math mana.drop add 18
               if ((%CurrentSpellMana >= 500) && (%CurrentSpellMana < 900)) then math mana.drop add 35
               return
          }
     if (%BackfireSeverity = 4) then
          {
               if ((%CurrentSpellMana >= 3) && (%CurrentSpellMana < 8)) then math mana.drop add 0
               if ((%CurrentSpellMana >= 8) && (%CurrentSpellMana < 18)) then math mana.drop add 2
               if ((%CurrentSpellMana >= 18) && (%CurrentSpellMana < 27)) then math mana.drop add 3
               if ((%CurrentSpellMana >= 27) && (%CurrentSpellMana < 50)) then math mana.drop add 5
               if ((%CurrentSpellMana >= 50) && (%CurrentSpellMana < 100)) then math mana.drop add 7
               if ((%CurrentSpellMana >= 100) && (%CurrentSpellMana < 500)) then math mana.drop add 10
               if ((%CurrentSpellMana >= 500) && (%CurrentSpellMana < 900)) then math mana.drop add 30
               return
          }
     if (%BackfireSeverity = 3) then
          {
               if ((%CurrentSpellMana >= 3) && (%CurrentSpellMana < 8)) then math mana.drop add 0
               if ((%CurrentSpellMana >= 8) && (%CurrentSpellMana < 18)) then math mana.drop add 1
               if ((%CurrentSpellMana >= 18) && (%CurrentSpellMana < 27)) then math mana.drop add 2
               if ((%CurrentSpellMana >= 27) && (%CurrentSpellMana < 50)) then math mana.drop add 4
               if ((%CurrentSpellMana >= 50) && (%CurrentSpellMana < 100)) then math mana.drop add 5
               if ((%CurrentSpellMana >= 100) && (%CurrentSpellMana < 500)) then math mana.drop add 9
               if ((%CurrentSpellMana >= 500) && (%CurrentSpellMana < 900)) then math mana.drop add 20
               return
          }
     if (%BackfireSeverity = 2) then
          {
               if ((%CurrentSpellMana >= 3) && (%CurrentSpellMana < 8)) then math mana.drop add 0
               if ((%CurrentSpellMana >= 8) && (%CurrentSpellMana < 18)) then math mana.drop add 0
               if ((%CurrentSpellMana >= 18) && (%CurrentSpellMana < 27)) then math mana.drop add 1
               if ((%CurrentSpellMana >= 27) && (%CurrentSpellMana < 50)) then math mana.drop add 3
               if ((%CurrentSpellMana >= 50) && (%CurrentSpellMana < 100)) then math mana.drop add 3
               if ((%CurrentSpellMana >= 100) && (%CurrentSpellMana < 500)) then math mana.drop add 5
               if ((%CurrentSpellMana >= 500) && (%CurrentSpellMana < 900)) then math mana.drop add 15
          }
     return
##### BUFF BACKFIRES
BACKFIRE_SEVERITY:
     if (%BackfireSeverity = 6) then
          {
               if ((%CurrentBuffMana >= 3) && (%CurrentBuffMana < 8)) then math mana.drop add 2
               if ((%CurrentBuffMana >= 8) && (%CurrentBuffMana < 18)) then math mana.drop add 4
               if ((%CurrentBuffMana >= 18) && (%CurrentBuffMana < 27)) then math mana.drop add 5
               if ((%CurrentBuffMana >= 27) && (%CurrentBuffMana < 50)) then math mana.drop add 7
               if ((%CurrentBuffMana >= 50) && (%CurrentBuffMana < 100)) then math mana.drop add 10
               if ((%CurrentBuffMana >= 100) && (%CurrentBuffMana < 500)) then math mana.drop add 20
               if ((%CurrentBuffMana >= 500) && (%CurrentBuffMana < 900)) then math mana.drop add 50
               return
          }
     if (%BackfireSeverity = 5) then
          {
               if ((%CurrentBuffMana >= 3) && (%CurrentBuffMana < 8)) then math mana.drop add 1
               if ((%CurrentBuffMana >= 8) && (%CurrentBuffMana < 18)) then math mana.drop add 3
               if ((%CurrentBuffMana >= 18) && (%CurrentBuffMana < 27)) then math mana.drop add 4
               if ((%CurrentBuffMana >= 27) && (%CurrentBuffMana < 50)) then math mana.drop add 5
               if ((%CurrentBuffMana >= 50) && (%CurrentBuffMana < 100)) then math mana.drop add 7
               if ((%CurrentBuffMana >= 100) && (%CurrentBuffMana < 500)) then math mana.drop add 15
               if ((%CurrentBuffMana >= 500) && (%CurrentBuffMana < 900)) then math mana.drop add 40
               return
          }
     if (%BackfireSeverity = 4) then
          {
               if ((%CurrentBuffMana >= 3) && (%CurrentBuffMana < 8)) then math mana.drop add 1
               if ((%CurrentBuffMana >= 8) && (%CurrentBuffMana < 18)) then math mana.drop add 2
               if ((%CurrentBuffMana >= 18) && (%CurrentBuffMana < 27)) then math mana.drop add 3
               if ((%CurrentBuffMana >= 27) && (%CurrentBuffMana < 50)) then math mana.drop add 4
               if ((%CurrentBuffMana >= 50) && (%CurrentBuffMana < 100)) then math mana.drop add 6
               if ((%CurrentBuffMana >= 100) && (%CurrentBuffMana < 500)) then math mana.drop add 12
               if ((%CurrentBuffMana >= 500) && (%CurrentBuffMana < 900)) then math mana.drop add 25
               return
          }
     if (%BackfireSeverity = 3) then
          {
               if ((%CurrentBuffMana >= 3) && (%CurrentBuffMana < 8)) then math mana.drop add 0
               if ((%CurrentBuffMana >= 8) && (%CurrentBuffMana < 18)) then math mana.drop add 1
               if ((%CurrentBuffMana >= 18) && (%CurrentBuffMana < 27)) then math mana.drop add 2
               if ((%CurrentBuffMana >= 27) && (%CurrentBuffMana < 50)) then math mana.drop add 3
               if ((%CurrentBuffMana >= 50) && (%CurrentBuffMana < 100)) then math mana.drop add 5
               if ((%CurrentBuffMana >= 100) && (%CurrentBuffMana < 500)) then math mana.drop add 9
               if ((%CurrentBuffMana >= 500) && (%CurrentBuffMana < 900)) then math mana.drop add 10
               return
          }
     if (%BackfireSeverity = 2) then
          {
               if ((%CurrentBuffMana >= 3) && (%CurrentBuffMana < 8)) then math mana.drop add 0
               if ((%CurrentBuffMana >= 8) && (%CurrentBuffMana < 18)) then math mana.drop add 0
               if ((%CurrentBuffMana >= 18) && (%CurrentBuffMana < 27)) then math mana.drop add 1
               if ((%CurrentBuffMana >= 27) && (%CurrentBuffMana < 50)) then math mana.drop add 2
               if ((%CurrentBuffMana >= 50) && (%CurrentBuffMana < 100)) then math mana.drop add 3
               if ((%CurrentBuffMana >= 100) && (%CurrentBuffMana < 500)) then math mana.drop add 5
               if ((%CurrentBuffMana >= 500) && (%CurrentBuffMana < 900)) then math mana.drop add 9
          }
     return
     ### CAMBRINTH BACKFIRE REDUCTION
CAMB_BACKFIRE_SEVERITY:
     if (%BackfireSeverity = 6) then
          {
               if ((%CurrentCambMana >= 3) && (%CurrentCambMana < 10)) then math camdrop add 2
               if ((%CurrentCambMana >= 10) && (%CurrentCambMana < 25)) then math camdrop add 4
               if ((%CurrentCambMana >= 25) && (%CurrentCambMana < 50)) then math camdrop add 6
               if ((%CurrentCambMana >= 50) && (%CurrentCambMana < 80)) then math camdrop add 8
               if (%CurrentCambMana >= 80) then math camdrop add 10
               if (%CambrinthCharge > 1) then var CambrinthCharge 1
               return
          }
     if (%BackfireSeverity = 5) then
          {
               if ((%CurrentCambMana >= 3) && (%CurrentCambMana < 10)) then math camdrop add 2
               if ((%CurrentCambMana >= 10) && (%CurrentCambMana < 25)) then math camdrop add 3
               if ((%CurrentCambMana >= 25) && (%CurrentCambMana < 50)) then math camdrop add 5
               if ((%CurrentCambMana >= 50) && (%CurrentCambMana < 80)) then math camdrop add 7
               if (%CurrentCambMana >= 80) then math camdrop add 9
               if (%CambrinthCharge > 1) then var CambrinthCharge 1
               return
          }
     if (%BackfireSeverity = 4) then
          {
               if ((%CurrentCambMana >= 2) && (%CurrentCambMana < 10)) then math camdrop add 1
               if ((%CurrentCambMana >= 10) && (%CurrentCambMana < 25)) then math camdrop add 2
               if ((%CurrentCambMana >= 25) && (%CurrentCambMana < 50)) then math camdrop add 4
               if ((%CurrentCambMana >= 50) && (%CurrentCambMana < 80)) then math camdrop add 6
               if (%CurrentCambMana >= 80) then math camdrop add 8
               if (%CambrinthCharge > 1) then var CambrinthCharge 1
               return
          }
     if (%BackfireSeverity = 3) then
          {
               if ((%CurrentCambMana >= 2) && (%CurrentCambMana < 10)) then math camdrop add 1
               if ((%CurrentCambMana >= 10) && (%CurrentCambMana < 25)) then math camdrop add 1
               if ((%CurrentCambMana >= 25) && (%CurrentCambMana < 50)) then math camdrop add 3
               if ((%CurrentCambMana >= 50) && (%CurrentCambMana < 80)) then math camdrop add 5
               if (%CurrentCambMana >= 80) then math camdrop add 7
               if (%CambrinthCharge > 1) then var CambrinthCharge 1
               return
          }
     if (%BackfireSeverity = 2) then
          {
               if ((%CurrentCambMana >= 2) && (%CurrentCambMana < 10)) then math camdrop add 0
               if ((%CurrentCambMana >= 10) && (%CurrentCambMana < 25)) then math camdrop add 1
               if ((%CurrentCambMana >= 25) && (%CurrentCambMana < 50)) then math camdrop add 4
               if ((%CurrentCambMana >= 50) && (%CurrentCambMana < 80)) then math camdrop add 5
               if (%CurrentCambMana >= 80) then math camdrop add 5
               if (%CambrinthCharge > 1) then var CambrinthCharge 1
               return
          }
     return
BUFF_BACKFIRED:
     var noCharge 1
     var mana.drop 0
     var camdrop 0
     if ($concentration < 20) then
          {
               var Backfired 0
               return
          }
     # if matchre("%CurrentBackfire", "(?i)%Magic.Tattoo") then
          # {
               # var Backfired 0
               # return
          # }
     if !matchre("%CurrentBackfire", "\b%CurrentBuff\b") then
          {
               return
          }
     if ($UC_CambHeavy = 0) then
     {
          if !matchre("%CurrentBackfire", "(?i)%Magic.Tattoo") then
               {
                    if ((%CurrentBuffMana >= 3) && (%CurrentBuffMana < 18)) then var mana.drop 0
                    if ((%CurrentBuffMana >= 18) && (%CurrentBuffMana < 30)) then var mana.drop 1
                    if ((%CurrentBuffMana >= 30) && (%CurrentBuffMana < 40)) then var mana.drop 2
                    if ((%CurrentBuffMana >= 40) && (%CurrentBuffMana < 50)) then var mana.drop 3
                    if ((%CurrentBuffMana >= 50) && (%CurrentBuffMana < 100)) then var mana.drop 5
                    if ((%CurrentBuffMana >= 100) && (%CurrentBuffMana < 500)) then var mana.drop 10
                    if ((%CurrentBuffMana >= 500) && (%CurrentBuffMana < 900)) then var mana.drop 25
                    if (%CurrentBuffMana >= 900) then var mana.drop 50
                    gosub BACKFIRE_SEVERITY
               }
          if ((%CurrentCambMana >= 2) && (%CurrentCambMana < 8)) then var camdrop 1
          if ((%CurrentCambMana >= 8) && (%CurrentCambMana < 15)) then var camdrop 1
          if ((%CurrentCambMana >= 15) && (%CurrentCambMana < 25)) then var camdrop 2
          if ((%CurrentCambMana >= 25) && (%CurrentCambMana < 50)) then var camdrop 3
          if ((%CurrentCambMana >= 50) && (%CurrentCambMana < 100)) then var camdrop 5
          if ((%CurrentCambMana >= 100) && (%CurrentCambMana < 500)) then var camdrop 20
          if ((%CurrentCambMana >= 500) && (%CurrentCambMana < 900)) then var camdrop 35
          if (%CurrentCambMana >= 900) then var camdrop 60
     }
     if ($UC_CambHeavy = 1) then
     {
          if !matchre("%CurrentBackfire", "(?i)%Magic.Tattoo") then
               {
                    if ((%CurrentBuffMana >= 3) && (%CurrentBuffMana < 18)) then var mana.drop 0
                    if ((%CurrentBuffMana >= 18) && (%CurrentBuffMana < 30)) then var mana.drop 1
                    if ((%CurrentBuffMana >= 30) && (%CurrentBuffMana < 40)) then var mana.drop 2
                    if ((%CurrentBuffMana >= 40) && (%CurrentBuffMana < 50)) then var mana.drop 3
                    if ((%CurrentBuffMana >= 50) && (%CurrentBuffMana < 100)) then var mana.drop 5
                    if ((%CurrentBuffMana >= 100) && (%CurrentBuffMana < 500)) then var mana.drop 10
                    if ((%CurrentBuffMana >= 500) && (%CurrentBuffMana < 900)) then var mana.drop 25
                    if (%CurrentBuffMana >= 900) then var mana.drop 50
                    gosub BACKFIRE_SEVERITY
               }
          if ((%CurrentCambMana >= 2) && (%CurrentCambMana < 8)) then var camdrop 1
          if ((%CurrentCambMana >= 8) && (%CurrentCambMana < 15)) then var camdrop 2
          if ((%CurrentCambMana >= 15) && (%CurrentCambMana < 25)) then var camdrop 4
          if ((%CurrentCambMana >= 25) && (%CurrentCambMana < 50)) then var camdrop 5
          if ((%CurrentCambMana >= 50) && (%CurrentCambMana < 100)) then var camdrop 8
          if ((%CurrentCambMana >= 100) && (%CurrentCambMana < 500)) then var camdrop 20
          if ((%CurrentCambMana >= 500) && (%CurrentCambMana < 900)) then var camdrop 35
          if (%CurrentCambMana >= 900) then var camdrop 60
     }
     gosub CAMB_BACKFIRE_SEVERITY
     echo ###########################
     echo ** BUFF BACKFIRED %spellID / %CurrentCambMana - DROPPING MANA:%mana.drop / CAMB:%camdrop
     echo ###########################
     echo ** Old Mana: %CurrentBuffMana
     put #echo >Log #FC0FC0 ** BUFF BACKFIRE %spellID / %CurrentCambMana | MANA-%mana.drop / CAMB-%camdrop
     put #log ** BACKFIRED %spellID/%CurrentCambMana - DROPPING MANA:%mana.drop / CAMB:%camdrop
     evalmath CurrentBuffMana (%CurrentBuffMana - %mana.drop)
     if matchre("%CurrentBackfire", "(?i)%Magic.Tattoo") then
          {
               evalmath CurrentCambMana (%CurrentCambMana - %camdrop)
               var Sorcery.Camb %CurrentCambMana
               put #var Camb.Tattoo %CurrentCambMana
               echo ** NEW Tattoo Camb Mana: %CurrentCambMana
               goto BUFF_BACKFIRED_RETURN
          }
     if (("%CurrentCambMana" != "NULL") && (%camdrop != 0)) then
          {
               evalmath CurrentCambMana (%CurrentCambMana - %camdrop)
          }
     if (%CurrentBuffMana < 1) then var CurrentBuffMana 1
     if (%CurrentCambMana < 1) then var CurrentCambMana 1
     put #var Mana.%CurrentBuff %CurrentBuffMana
     put #var Camb.%CurrentBuff %CurrentCambMana
     pause 0.00001
     pause 0.00001
BUFF_BACKFIRED_RETURN:
     echo #########################
     echo ** %CurrentBackfire - NEW MANA: %CurrentBuffMana
     if !matchre("$UC_Cambrinth", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then echo ** NEW CAMB MANA: %CurrentCambMana
     echo #########################
     var mana.drop 0
     var camdrop 0
     var Backfired 0
     var cambCharged 0
     var spellPrepped 0
     put #var save
     if ((%backfirecount > 12) && (%healbot = 0)) then goto BACKFIRE_ESCAPE
     return
SPELL_BACKFIRED:
     var noCharge 1
     var mana.drop 0
     var camdrop 0
     if ($concentration < 50) then
          {
               var Backfired 0
               return
          }
     # if matchre("%CurrentBackfire", "(?i)%Magic.Tattoo") then
          # {
               # var Backfired 0
               # return
          # }
     if !matchre("%CurrentBackfire", "\b%CurrentSpell\b") then
          {
               # debug 0
               return
          }
     if ($UC_CambHeavy = 0) then
     {
          if !matchre("%CurrentBackfire", "(?i)%Magic.Tattoo") then
               {
                    if ((%CurrentSpellMana >= 3) && (%CurrentSpellMana < 8)) then var mana.drop 0
                    if ((%CurrentSpellMana >= 8) && (%CurrentSpellMana < 18)) then var mana.drop 1
                    if ((%CurrentSpellMana >= 18) && (%CurrentSpellMana < 30)) then var mana.drop 2
                    if ((%CurrentSpellMana >= 30) && (%CurrentSpellMana < 50)) then var mana.drop 3
                    if ((%CurrentSpellMana >= 50) && (%CurrentSpellMana < 100)) then var mana.drop 4
                    if ((%CurrentSpellMana >= 100) && (%CurrentSpellMana < 500)) then var mana.drop 10
                    if ((%CurrentSpellMana >= 500) && (%CurrentSpellMana < 900)) then var mana.drop 25
                    if (%CurrentSpellMana >= 900) then var mana.drop 50
                    gosub SPELL_BACKFIRE_SEVERITY
               }
          if ((%CurrentCambMana >= 2) && (%CurrentCambMana < 8)) then var camdrop 1
          if ((%CurrentCambMana >= 8) && (%CurrentCambMana < 15)) then var camdrop 1
          if ((%CurrentCambMana >= 15) && (%CurrentCambMana < 25)) then var camdrop 3
          if ((%CurrentCambMana >= 25) && (%CurrentCambMana < 50)) then var camdrop 4
          if ((%CurrentCambMana >= 50) && (%CurrentCambMana < 100)) then var camdrop 5
          if ((%CurrentCambMana >= 100) && (%CurrentCambMana < 500)) then var camdrop 10
          if ((%CurrentCambMana >= 500) && (%CurrentCambMana < 900)) then var camdrop 35
          if (%CurrentCambMana >= 900) then var camdrop 60
     }
     if ($UC_CambHeavy = 1) then
     {
          if !matchre("%CurrentBackfire", "(?i)%Magic.Tattoo") then
               {
                    if ((%CurrentSpellMana >= 3) && (%CurrentSpellMana < 8)) then var mana.drop 0
                    if ((%CurrentSpellMana >= 8) && (%CurrentSpellMana < 18)) then var mana.drop 1
                    if ((%CurrentSpellMana >= 18) && (%CurrentSpellMana < 30)) then var mana.drop 2
                    if ((%CurrentSpellMana >= 30) && (%CurrentSpellMana < 50)) then var mana.drop 3
                    if ((%CurrentSpellMana >= 50) && (%CurrentSpellMana < 100)) then var mana.drop 4
                    if ((%CurrentSpellMana >= 100) && (%CurrentSpellMana < 500)) then var mana.drop 10
                    if ((%CurrentSpellMana >= 500) && (%CurrentSpellMana < 900)) then var mana.drop 25
                    if (%CurrentSpellMana >= 900) then var mana.drop 50
                    gosub SPELL_BACKFIRE_SEVERITY
               }
          if ((%CurrentCambMana >= 2) && (%CurrentCambMana < 8)) then var camdrop 1
          if ((%CurrentCambMana >= 8) && (%CurrentCambMana < 15)) then var camdrop 2
          if ((%CurrentCambMana >= 15) && (%CurrentCambMana < 25)) then var camdrop 4
          if ((%CurrentCambMana >= 25) && (%CurrentCambMana < 50)) then var camdrop 5
          if ((%CurrentCambMana >= 50) && (%CurrentCambMana < 100)) then var camdrop 8
          if ((%CurrentCambMana >= 100) && (%CurrentCambMana < 500)) then var camdrop 10
          if ((%CurrentCambMana >= 500) && (%CurrentCambMana < 900)) then var camdrop 35
          if (%CurrentCambMana >= 900) then var camdrop 60
     }
     gosub CAMB_BACKFIRE_SEVERITY
     echo ############################
     echo ** BACKFIRED %spellID / %CurrentCambMana - DROPPING MANA:%mana.drop / CAMB:%camdrop
     echo ############################
     echo ** Old Mana: %CurrentSpellMana
     put #echo >Log #FC0FC0 ** BACKFIRED %spellID / %CurrentCambMana | MANA-%mana.drop / CAMB-%camdrop
     if matchre("%CurrentBackfire", "(?i)%Magic.Tattoo") then
          {
               evalmath CurrentCambMana (%CurrentCambMana - %camdrop)
               var Sorcery.Camb %CurrentCambMana
               put #var Camb.Tattoo %CurrentCambMana
               put #var Camb.Sorcery %CurrentCambMana
               echo ** NEW Tattoo Camb Mana: %CurrentCambMana
               # debug 0
               return
          }
     if matchre("%CurrentSpell", "(?i)QE\b") then
          {
               evalmath QE.Mana (%QE.Mana - %mana.drop)
               var mana.drop 0
               var camdrop 0
               var Backfired 0
               var cambCharged 0
               var spellPrepped 0
               goto NO_SMART_BACKFIRE_3
          }
     evalmath CurrentSpellMana (%CurrentSpellMana - %mana.drop)
     if (($Camb.%CurrentSchool != "NULL") && (%camdrop != 0)) then
          {
               evalmath CurrentCambMana (%CurrentCambMana - %camdrop)
               put #var Camb.%CurrentSchool %CurrentCambMana
               #if ((!matchre("%SMART.SPELLS", "(?i)(ON|1|YES)") || matchre("%CurrentBackfire", "%Magic.Tattoo")) then put #var UC_CambMana %CambrinthMana
          }
SPELL_BACKFIRED_RETURN:
     if (%CurrentSpellMana < 1) then
          {
               var CurrentSpellMana 1
               put #var Mana.%CurrentSchool 1
          }
     if (%CurrentCambMana < 1) then var CurrentCambMana 1
     if matchre("%CurrentSchool", "(?i)CYCLIC") then
          {
               put #var UC_CyclicCharge %CurrentCambMana
               evalmath CyclicTime ($gametime - 300)
               goto NO_SMART_BACKFIRE_3
          }
     # debug 0
     if ($UC_SmartSpells = 1) then goto SMART_SPELL_BACKFIRE
     goto NO_SMART_BACKFIRE
SMART_SPELL_BACKFIRE:
     put #var Mana.$%GuildType.%CurrentSchool.Spell %CurrentSpellMana
     put #var Camb.$%GuildType.%CurrentSchool.Spell %CurrentCambMana
NO_SMART_BACKFIRE:
     ### TURN OFF SPELL IF MANA IS AT 0 AFTER BACKFIRE
     # if (matchre("%CurrentSchool", "(?i)TARGET") && (%CurrentSpellMana < 1)) then
          # {
               # echo *** TURNING OFF SPELL: %CurrentSpell
               # put #var %GuildType.Target.Spell NULL
               # var CurrentSpell NULL
               # goto NO_SMART_BACKFIRE_2
          # }
     # if (matchre("%CurrentSchool", "(?i)WARDING") && (%CurrentSpellMana < 1)) then
          # {
               # echo *** TURNING OFF SPELL: %CurrentSpell
               # put #var %GuildType.Warding.Spell NULL
               # var CurrentSpell NULL
               # goto NO_SMART_BACKFIRE_2
          # }
     # if (matchre("%CurrentSchool", "(?i)UTILITY") && (%CurrentSpellMana < 1)) then
          # {
               # echo *** TURNING OFF SPELL: %CurrentSpell
               # put #var %GuildType.Utility.Spell NULL
               # var CurrentSpell NULL
               # goto NO_SMART_BACKFIRE_2
          # }
     # if (matchre("%CurrentSchool", "(?i)DEBILITATION") && (%CurrentSpellMana < 1)) then
          # {
               # echo *** TURNING OFF SPELL: %CurrentSpell
               # put #var %GuildType.Debilitation.Spell NULL
               # var CurrentSpell NULL
               # goto NO_SMART_BACKFIRE_2
          # }
     # if (matchre("%CurrentSchool", "(?i)AUGMENTATION") && (%CurrentSpellMana < 1)) then
          # {
               # echo *** TURNING OFF SPELL: %CurrentSpell
               # put #var %GuildType.Augmentation.Spell NULL
               # var CurrentSpell NULL
               # goto NO_SMART_BACKFIRE_2
          # }
     # if (matchre("%CurrentSchool", "(?i)SORCERY") && (%CurrentSpellMana < 1)) then
          # {
               # echo *** TURNING OFF SPELL: %CurrentSpell
               # put #var %GuildType.Sorcery.Spell NULL
               # var CurrentSpell NULL
               # goto NO_SMART_BACKFIRE_2
          # }
NO_SMART_BACKFIRE_2:
     ### SET NEW MANA LEVELS FOR GLOBAL VARIABLE
     if (matchre("%CurrentSchool", "(?i)TARGET") || matchre("$%GuildType.Target.Spell", "\b%CurrentSpell\b")) then put #var Mana.Target %CurrentSpellMana
     if (matchre("%CurrentSchool", "(?i)WARDING") || matchre("$%GuildType.Warding.Spell", "\b%CurrentSpell\b")) then put #var Mana.Warding %CurrentSpellMana
     if (matchre("%CurrentSchool", "(?i)UTILITY") || matchre("$%GuildType.Utility.Spell", "\b%CurrentSpell\b")) then put #var Mana.Utility %CurrentSpellMana
     if (matchre("%CurrentSchool", "(?i)DEBILITATION") || matchre("$%GuildType.Debilitation.Spell", "\b%CurrentSpell\b")) then put #var Mana.Debilitation %CurrentSpellMana
     if (matchre("%CurrentSchool", "(?i)AUGMENTATION") || matchre("$%GuildType.Augmentation.Spell", "\b%CurrentSpell\b")) then put #var Mana.Augmentation %CurrentSpellMana
     if (matchre("%CurrentSchool", "(?i)SORCERY") || matchre("$%GuildType.Sorcery.Spell", "\b%CurrentSpell\b")) then put #var Mana.Sorcery %CurrentSpellMana
NO_SMART_BACKFIRE_3:
     if ($Camb.%CurrentSchool < 1) then put #var Camb%CurrentSchool 1
     if (%CurrentSpellMana < 1) then var CurrentSpellMana 1
     if matchre("%CurrentSchool", "(?i)CYCLIC") then gosub CyclicChangeMana
     pause 0.00001
     pause 0.00001
     echo ######################
     echo ** New Mana: %CurrentSpellMana
     if !matchre("$UC_Cambrinth", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then echo ** Camb Mana: %CurrentCambMana
     echo ######################
     var mana.drop 0
     var camdrop 0
     var Backfired 0
     var cambCharged 0
     var spellPrepped 0
     put #var save
     if ((%backfirecount > 10) && (%healbot = 0)) then goto BACKFIRE_ESCAPE
     return
#################################################################
## CYCLIC BACKFIRES
CyclicChangeMana:
	var temparray
	evalmath tempmana (%%GuildType.Cyclics.mana(%cyclic.count) - %mana.drop)
	var currentnumber 0
cycmanareplaceloop:
     pause 0.0001
	if (%currentnumber >= %learningCyclics) then
          {
               var %GuildType.Cyclics.mana %temparray
               echo ** NEW CYCLIC MANA ARRAY: %temparray
               evalmath CyclicTime ($gametime - 300)
               return
		}
	if (%currentnumber = %cyclic.count) then var temparray %temparray|%tempmana
	else var temparray %temparray|%%GuildType.Cyclics.mana(%cyclic.count)
     pause 0.0001
     eval temparray replacere("%temparray", "^\||\|$", "")
     eval temparray replacere("%temparray", "\|+", "|")
     eval temparray replacere("%temparray", "\|$", "")
     eval temparray replacere("%temparray", "^\|", "")
	math currentnumber add 1
	goto cycmanareplaceloop
#################################################################
OM_BACKFIRE:
OM_BACKFIRED:
     var Backfired 0
     var noCharge 1
     if ("%CurrentBackfire" != "%OMBuffshort(%OMTracker)") then return
     if ((%CurrentBuffMana >= 1) && (%CurrentBuffMana < 18)) then var mana.drop 0
     if ((%CurrentBuffMana >= 18) && (%CurrentBuffMana < 27)) then var mana.drop 1
     if ((%CurrentBuffMana >= 27) && (%CurrentBuffMana < 50)) then var mana.drop 2
     if ((%CurrentBuffMana >= 50) && (%CurrentBuffMana < 100)) then var mana.drop 4
     if ((%CurrentBuffMana >= 100) && (%CurrentBuffMana < 500)) then var mana.drop 10
     if ((%CurrentBuffMana >= 500) && (%CurrentBuffMana < 900)) then var mana.drop 20
     if (%CurrentBuffMana >= 900) then var mana.drop 100
     gosub BACKFIRE_SEVERITY
     if (($UC_CambMana >= 2) && ($UC_CambMana < 10)) then var camdrop 1
     if (($UC_CambMana >= 10) && ($UC_CambMana < 25)) then var camdrop 3
     if (($UC_CambMana >= 25) && ($UC_CambMana < 50)) then var camdrop 5
     if (($UC_CambMana >= 50) && ($UC_CambMana < 100)) then var camdrop 8
     if (($UC_CambMana >= 100) && ($UC_CambMana < 500)) then var camdrop 10
     if (($UC_CambMana >= 500) && ($UC_CambMana < 900)) then var camdrop 30
     if ($UC_CambMana >= 900) then var camdrop 70
     gosub CAMB_BACKFIRE_SEVERITY
     echo ######################
     echo ** BACKFIRED %spellID/%CurrentCambMana - DROPPING MANA:%mana.drop / CAMB:%camdrop
     echo ######################
     echo ** Old Mana: %CurrentBuffMana
     put #echo >Log #FC0FC0 ** BACKFIRED %spellID/%CurrentCambMana - DROPPING MANA:%mana.drop / CAMB:%camdrop
     evalmath CurrentBuffMana (%CurrentBuffMana - %mana.drop)
     evalmath CambMana ($UC_CambMana - %camdrop)
     put #var UC_CambMana %CambrinthMana
     put #var Mana.%OMBuffshort(%OMTracker) %CurrentBuffMana
     put #var Camb.%CurrentSchool.Spell %CurrentCambMana
     if (%CurrentBuffMana < 1) then var CurrentBuffMana 1
     if ($UC_CambMana < 1) then put #var UC_CambMana 1
     pause 0.1
     pause 0.00001
     if matchre("%CurrentSchool", "(?i)TARGET") then put #var Mana.Target %CurrentBuffMana
     if matchre("%CurrentSchool", "(?i)WARDING") then put #var Mana.Warding %CurrentBuffMana
     if matchre("%CurrentSchool", "(?i)UTILITY") then put #var Mana.Utility %CurrentBuffMana
     if matchre("%CurrentSchool", "(?i)DEBILITATION") then put #var Mana.Debilitation %CurrentBuffMana
     if matchre("%CurrentSchool", "(?i)AUGMENTATION") then put #var Mana.Augmentation %CurrentBuffMana
     if matchre("%CurrentSchool", "(?i)SORCERY") then put #var Mana.Sorcery %CurrentBuffMana
     echo #############
     echo ** New Mana: %CurrentBuffMana
     echo #############
     put #var Mana.%OMBuff(%OMTracker) %CurrentBuffMana
     var mana.drop 0
     var camdrop 0
     var cambCharged 0
     var spellPrepped 0
     if ((%backfirecount > 12) && (%healbot = 0)) then goto BACKFIRE_ESCAPE
     return
#### MANA BUMP ROUTINE - BUMP UP MANA FOR SPELL WHEN NOT LEARNING
MANA_BUMP:
     pause 0.0001
     if (%Backtraining = 1) then return
     if ($%spelllearn.LearningRate > 0) then return
     if matchre("%CurrentSpell", "(?i)Obfuscation") then return
     if matchre("%CurrentSchool", "(?i)(CYCLIC|TARGET|DEBILITATION|Targeted_Magic)") then return
     echo
     if matchre("%CurrentSchool", "(?i)WARDING") then
          {
               math Warding.Learn add 1
               echo *** NOT LEARNING WARDING FROM %CurrentSpell - Count %Warding.Learn/3
          }
     if matchre("%CurrentSchool", "(?i)(Utility)") then
          {
               math Utility.Learn add 1
               echo *** NOT LEARNING UTILITY FROM %CurrentSpell - Count %Utility.Learn/3
          }
     if matchre("%CurrentSchool", "(?i)(Augmentation|Augment)") then
          {
               math Augment.Learn add 1
               echo *** NOT LEARNING AUGMENTATION FROM %CurrentSpell - Count %Augment.Learn/3
          }
     if (matchre("%CurrentSchool", "(?i)Sorcery") && !matchre("%CurrentSpell", "(?i)(%TM.Spell.List|%Debil.Spell.List)")) then
          {
               math Sorcery.Learn add 1
               echo *** NOT LEARNING SORCERY FROM %CurrentSpell - Count %Sorcery.Learn/2
          }
     echo
     if (matchre("%CurrentSchool", "(?i)WARDING") && (%Warding.Learn > 2)) then goto MANA_BUMP_GO
     if (matchre("%CurrentSchool", "(?i)UTILITY") && (%Utility.Learn > 2)) then goto MANA_BUMP_GO
     if (matchre("%CurrentSchool", "(?i)AUGMENTATION") && (%Augment.Learn > 2)) then goto MANA_BUMP_GO
     if (matchre("%CurrentSchool", "(?i)SORCERY") && (%Sorcery.Learn > 2)) then goto MANA_BUMP_GO
     return
MANA_BUMP_GO:
     if (matchre("%CurrentSchool", "(?i)Sorcery") && matchre("%CurrentSpell", "(?i)%Magic.Tattoo")) then
          {
               if ($%spelllearn.Ranks <= 1000) then evalmath newmana ($Camb.Tattoo + 5)
               if ($%spelllearn.Ranks > 1000) then evalmath newmana ($Camb.Tattoo + 7)
               put #echo >Log #B8FF09 *** NOT LEARNING MAGIC TATTOO - %CurrentSpell
               put #echo >Log #B8FF09 *** BUMPING SORCERY.CAMB MANA: $Camb.Tattoo to %newmana
               echo
               echo #################################
               echo ** Not Learning from Magic Tattoo: %CurrentSpell!
               echo ** Bumping up Camb.Tattoo Mana!
               echo ** Old Mana: $Camb.Tattoo New Mana: %newmana
               echo #################################
               echo
               var Sorcery.Camb %newmana
               put #var Camb.Sorcery %newmana
               put #var Mana.%%GuildType.%CurrentSchool.Spell %newmana
               put #var Camb.Tattoo %newmana
          }
     if (%CurrentSpellMana < $spellMax.%CurrentSpell) then
         {
               if ($%spelllearn.Ranks <= 1000) then evalmath newmana (%CurrentSpellMana + 3)
               if ($%spelllearn.Ranks > 1000) then evalmath newmana (%CurrentSpellMana + 6)
               if ($Arcana.Ranks < 1000) then evalmath newcambmana (%CurrentCambMana + 4)
               if ($Arcana.Ranks > 1000) then evalmath newcambmana (%CurrentCambMana + 7)
               put #echo >Log #B8FF09 *** NOT LEARNING: %CurrentSchool - BUMPING %CurrentSpell MANA from %CurrentSpellMana to %newmana
               echo
               echo #################################
               echo ** Not Learning %CurrentSchool!
               echo ** Bumping up Mana for last spell: %CurrentSpell
               echo ** Old Mana: %CurrentSpellMana New Mana: %newmana
               echo #################################
               echo
               if matchre("%CurrentSchool", "(?i)Targeted_Magic") then var CurrentSchool Target
               put #var Mana.%%GuildType.%CurrentSchool.Spell %newmana
               put #var Camb.%%GuildType.%CurrentSchool.Spell %newcambmana
         }
      if matchre("%CurrentSchool", "(?i)WARDING") then var Warding.Learn 0
      if matchre("%CurrentSchool", "(?i)UTILITY") then var Utility.Learn 0
      if matchre("%CurrentSchool", "(?i)AUGMENTATION") then var Augment.Learn 0
      if matchre("%CurrentSchool", "(?i)SORCERY") then var Sorcery.Learn 0
      put #var save
      return
###############################
# BUFF SECTION
###############################
###############################
## SINGLE BUFF
BUFF:
     action (magic) on
     delay 0.00001
     # debuglevel 10
     var Backfired 0
     var BUFFING ON
     var singlebuff 1
     var castme $1
     var maname $2
     var spellID %castme
     var CurrentBuff %castme
     var CurrentSpell %castme
     # var maname Mana.%castme
     var CurrentBuffMana 10
     var CurrentCambMana $Camb.%castme
     if matchre("%maname", "(\d+)") then var CurrentBuffMana %maname
     pause 0.00001
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then return
     if (("$guild" = "Necromancer") && ($spellROC = 1)) then gosub RELEASE ROC
     if (%Playing = 1) then gosub STOP_PLAY
     # if matchre("%CurrentBuff", "(?i)ABSOLUTION") then gosub RELEASE cyclic
     if matchre("%CurrentBuff", "(?i)%Magic.Tattoo") then
          {
               var chargemana %CambrinthMana
               var CurrentCambMana %CambrinthMana
          }
     if ($mana < 24) then
          {
               echo
               echo *** LOW ON MANA - SKIPPING BUFF..
               echo
               return
          }
     if matchre("%castme", "\b(?i)COL\b") then
          {
               if (($Time.isXibarUp = 0) && ($Time.isYavashUp = 0) && ($Time.isKatambaUp = 0)) then
                    {
                         echo ** NO MOONS UP - NO COL!!
                         return
                    }
          }
     if (matchre("%castme", "RM") && matchre("$roomexits", "obscured by a thick fog")) then return
     if (matchre("%castme", "RM") && matchre("$roomobjs", "obscured by a thick fog")) then return
     if (matchre("%castme", "ETF") && matchre("$roomobjs", "a .+ fissure")) then return
     if (matchre("%castme", "RUE") && matchre("$UC_WeaponType", "(SLINGS|BOW|CROSSBOW|BRAWL|LT)")) then
          {
               echo **** Skipping RUE - Training $UC_WeaponType
               return
          }
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then gosub SPELL_WAIT
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if ($preparedSymbiosis) then
          {
               put release symbiosis
               pause 0.3
          }
     if matchre("%castme", "(?i)ABSOLUTION") then
          {
               echo ##########
               echo * UNDEAD DETECTED!
               echo * PUTTING UP ABSOLUTION!
               echo ###########
          }
     if ("$guild" = "Empath") then
          {
               if (($UC_GuardianSpirit = 1) && !matchre("$roomobjs", "(alfar|dastardly|senile|gracile|ethereal|tall|lean|slim|graceful|trim|alert|serene|delicate|slender|stoic|athletic|lithe|lissome|solemn|sedate|tranquil|wiry|svelte|imposing|savage) warrior")) then gosub GUARDIAN_SPIRIT
          }
     ### CHECKING TO SEE IF MANA IS ALREADY DEFINED, IF NOT - DISCERN IT
     # if ($Mana.%buffMana = 1) then goto DISCERN_IT
     if matchre("%CurrentBuff", "(?i)%Magic.Tattoo") then goto BUFF_PREPARE
     # if (($%maname > 100) && !matchre("%castme", "(?i)%Ritual.Spell.List")) then goto DISCERN_IT
     if (!matchre("%maname", "(\d+)") || ("%maname" = "")) then goto DISCERN_IT
     if matchre("%maname", "(\d+)") then goto BUFF_PREPARE
     if matchre("%1","(?i)SETUP") then goto DISCERN_IT
     goto BUFF_PREPARE
DISCERN_IT:
     echo *** Checking Optimal Cast Mana for %castme
     gosub SPELLMATH %castme
     if (%NOCAST = 1) then goto REMOVE_SINGLE_BUFF
     if %spellCMax = 0 then
          {
               put #var Mana.%castme 1
               put #var Camb.%castme NULL
          }
     else
          {
			if (%spellCMax > %spellMax) then var spellCMax %spellMax
               evalmath spellCMax ceiling(%spellCMax * .75)
               evalmath spellResplit floor(%spellCMax / (%CambrinthCharge+2))
               evalmath spellCMax ceiling(%spellResplit * 3)
               put #var Mana.%castme %spellCMax
               if matchre("%castme", "(?i)%Ritual.Spell.List") then put #var Camb.%castme NULL
               else put #var Camb.%castme %spellResplit
          }
     var CurrentBuffMana $Mana.%castme
     var CurrentCambMana $Camb.%castme
     echo ####################
     echo *** SETTING %castme spell to %spellCMax Mana
     echo *** SETTING %castme cambrinth to %spellResplit Mana
     echo ####################
BUFF_PREPARE:
     if (%Playing = 1) then gosub STOP_PLAY
     if ($standing = 0) then gosub STAND
     if ($stunned) then waiteval (!$stunned)
     if (($Symbiosis.Buffs)  && !matchre("%castme", "\b(?i)(%Cyclic.Spell.List|%Ritual.Spell.List)\b") && (!$preparedSymbiosis)) then gosub PUT prepare symbiosis
     if (matchre("%castme", "(?i)SHEAR") && ($SpellTimer.Shear.active = 1)) then gosub RELEASE shear
     if (matchre("%castme", "(?i)IGNITE") && ($SpellTimer.Ignite.active = 1)) then gosub RELEASE ignite
	if (($preparedSymbiosis) && (!$Symbiosis.Buffs)) then
          {
               put release symbiosis
               pause 0.4
          }
     if matchre("%CurrentBuff", "\b(?i)%Magic.Tattoo\b") then
          {
               gosub INVOKE tattoo
               pause 0.001
               var spelllearn Sorcery
               var spellID %Magic.Tattoo
               var CurrentSpell %Magic.Tattoo
               var CurrentCambMana $Camb.Tattoo
               if ((%MagicTM = 1) || matchre("%CurrentBuff", "(?i)%TM.Spell.List")) then
                    {
                         send target
                         var MagicTM 0
                         pause 0.5
                    }
          }
     else gosub PREPARE %castme %CurrentBuffMana
     if ((matchre("%castme", "(?i)%Ritual.Spell.List") || matchre("%castme", "(?i)ABSOLUTION")) then gosub RITUAL
     gosub BUFF_WAIT
     goto SINGLE_BUFF_RETURN
REMOVE_SINGLE_BUFF:
     echo
     echo ** %spellID spell is too hard for us right now!
     echo ** Removing from buffs list
     echo
     eval buffs replacere("%buffs", "%castme", "")
     eval buffs replacere("%buffs", "\|+", "|")
     eval buffs replacere("%buffs", "\|$", "")
     eval buffs replacere("%buffs", "^\|", "")
     var %GuildType.Buffs %buffs
     echo
     echo *** Buffs: %buffs
     echo
SINGLE_BUFF_RETURN:
     # debug 5
     if (%Backfired = 1) then
          {
               var CurrentBackfire %castme
               gosub BUFF_BACKFIRED
               put #var Mana.%castme %CurrentBuffMana
               put #var Camb.%castme %CurrentCambMana
               var Backfired 0
          }
     if ((%Backfired = 1) && ($UC_SmartSpells = 1)) then
          {
               var CurrentBackfire %castme
               gosub BUFF_BACKFIRED
               put #var Mana.%castme %CurrentBuffMana
               put #var Camb.%castme %CurrentCambMana
               var Backfired 0
          }
     # if ((%Backfired = 1) && ($UC_SmartSpells = 0)) then
          # {
               # echo #######################
               # echo *** BACKFIRED %castme !
               # echo #######################
               # put #echo >Log #ff0000 ** BACKFIRED %castme !
               # var Backfired 0
               # pause 0.2
          # }
     if matchre("$righthand $lefthand", "$UC_Cambrinth") then gosub WEAR $UC_Cambrinth
     if matchre("$righthand $lefthand", "$UC_Cambrinth") then gosub STOWIT $UC_Cambrinth
     if matchre("$guild", "Moon Mage") then
          {
               if (matchre("%castme", "(?i)SHADOWLING") || matchre("%CurrentSpell", "(?i)SHADOWLING")) then
                    {
                         echo *** CHECKING ROOM FOR SHADOWLING...
                         if !matchre("$roomobjs", "(?i)shadow") then
                              {
                                   pause
                                   pause
                                   put look
                                   pause 0.3
                                   pause 0.3
                              }
                         pause 0.2
                         if !matchre("$roomobjs", "(?i)shadow") then
                              {
                                   pause
                                   pause
                                   put look
                                   pause 0.3
                                   pause 0.3
                              }
                         if matchre("$roomobjs", "(?i)SHADOWLING") then send invoke shadowling
                         if matchre("$roomobjs", "(?i)SHADOWCAT") then send invoke shadowcat
                         if matchre("$roomobjs", "(?i)SHADOWPANTHER") then send invoke shadowpanther
                         if matchre("$roomobjs", "(?i)SHADOWTABBY") then send invoke shadowtabby
                         pause 0.4
                    }
          }
     var spellPrepped 0
     var Backfired 0
     var BUFFING OFF
     var cambCharged 0
     var singlebuff 0
     #debug 0
     return
############################################################################################
## PRIMARY INITIAL BUFF ROUTINE
BUFF_UP:
     action (magic) on
     action (retreat) on
     var BUFFING ON
     var Backfired 0
     var buff.tracker 0
     var spell.tracker 0
     pause 0.00001
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then gosub SPELL_WAIT
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if ("$guild" = "Necromancer") then var NecroBuffed 1
     if (("$guild" = "Necromancer") && !matchre("%command", "(?i)fight")) then
          {
               var NecroMoved 0
               echo ##################
               echo ** CHECKING TO MAKE SURE
               echo ** WE AREN'T IN TOWN BEFORE BUFFING
               echo ##################
               # if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
               if (("$zoneid" = "1") && !matchre("$roomname", "(?i)(sewer|cavity|warehouse|mudflat)")) then
                    {
                         var NecroMoved 1
                         gosub AUTOMOVE e gate
                    }
               if (("$zoneid" = "30") && !matchre("$roomname", "(?i)salt yard")) then
                    {
                         var NecroMoved 1
                         gosub AUTOMOVE w gate
                    }
               if matchre("$zoneid", "\b(8|33|34a|42|47|61|67|90|99|116)\b") then var NecroMoved 1
               if ("$zoneid" = "8") then gosub AUTOMOVE 50
               if ("$zoneid" = "33") then gosub AUTOMOVE 9
               if ("$zoneid" = "34a") then gosub AUTOMOVE forest
               if ("$zoneid" = "42") then gosub AUTOMOVE gate
               if ("$zoneid" = "47") then gosub AUTOMOVE 109
               if ("$zoneid" = "61") then gosub AUTOMOVE shard
               if ("$zoneid" = "67") then
                    {
                         gosub AUTOMOVE east
                         gosub AUTOMOVE 638
                    }
               if ("$zoneid" = "90") then gosub AUTOMOVE sprite
               if ("$zoneid" = "99") then gosub AUTOMOVE west
               if ("$zoneid" = "116") then gosub AUTOMOVE raven
          }
     echo ##################
     echo *  PUTTING UP BUFFS!
     echo ##################
     var BuffTime $gametime
     if ("$guild" = "Thief") then
          {
               gosub KHRI
               return
          }
     if ("$guild" = "Barbarian") then
          {
               gosub BARB_CHECK
               return
          }
     pause 0.00001
BUFF_START:
     action (buffs) on
     action (magic) on
     var l 0
     var buffabbrevs
     var buffs
     eval totalspells count("%spelltimer", "|")
     gosub SPELL_CHECK_4
     unvar l
     pause 0.00001
     ## var buffs %%GuildType.Buffs
     #### CONVERT BUFFS TO ALL CAPS
     eval buffs replacere("%buffs", "\|\w+\[", "|[")
     eval buffs replacere("%buffs", "\[|\]", "")
     #eval buffs replacere("%buffs", "^\||\|$", "")
     #eval buffs toupper("%buffs")
     #### REMOVE NULL AND EXTRA PIPES
     eval buffs replacere("%buffs", "[Nn][Uu][Ll][Ll]", "")
     var buffs |%buffs
     eval buffs replacere("%buffs", "\|+", "|")
     eval buffs replacere("%buffs", "\|$", "")
     eval buffs replacere("%buffs", "^\|", "")
     eval buffabbrevs replacere("%buffabbrevs", "\|+", "|")
     eval buffabbrevs replacere("%buffabbrevs", "\|$", "")
     eval buffabbrevs replacere("%buffabbrevs", "^\|", "")
     if matchre("%%GuildType.Buffs", "\b(?i)%Magic.Tattoo\b") then
          {
               var buffs %buffs|%Magic.Tattoo
               var buffabbrevs %buffabbrevs|%Magic.Tattoo
          }
     echo
     echo *** BUFFS: %buffs
     echo
BUFF_START_CHECK:
     var buff.count 0
     var OMTracker 0
     var OMChecked 0
     eval buff.count count("%buffs", "|")
     evalmath buff.count (%buff.count + 1)
     echo
     echo *** Buff Count: %buff.count
     echo *** Buffs: %buffs
     echo *** (%buffabbrevs)
     echo
BUFF_START_1:
     pause 0.0001
     if (($mana < 25) && !matchre("%command", "(?i)SETUP")) then
          {
               echo ####################
               echo *** LOW ON MANA! PAUSING..
               echo ####################
               pause 19
               if ($mana > 30) then goto BUFF_START_2
               echo ###################
               echo *** LOW MANA -> SKIPPING SPELL
               echo ###################
               goto BUFF_RETURN
          }
BUFF_START_2:
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if (("$guild" = "Cleric") && matchre("%buffs", "(?i)\b(OsrelMeraud|OM)\b") && (%OMChecked = 0) && (%OrbFull = 0)) then
          {
               gosub OM_CHECK
               if ($mana < 50) then
                    {
                         gosub RELEASE mana
                         echo *** WAITING FOR MANA to recover after charging OM
                         echo *** Will continue at 80%
                         waiteval ($mana > 80)
                    }
          }
     if ($mana < 50) then
          {
               if ("$guild" = "Necromancer") then gosub HIDE
               echo ###################
               echo *** LOW ON MANA! PAUSING..
               echo ###################
               pause 10
               if ($mana > 60) then goto BUFF_START_3
               pause 10
               if ($mana > 60) then goto BUFF_START_3
               pause 10
               if ($mana > 60) then goto BUFF_START_3
               if ($hidden = 1) then gosub UNHIDE
               goto BUFF_START_2
          }
BUFF_START_3:
     pause 0.00001
     if ($mana < 80) then pause
     if ((%Backfired = 1) && ($UC_SmartSpells = 1)) then
          {
               var CurrentBackfire %buffabbrevs(%buff.tracker)
               gosub BUFF_BACKFIRED
               put #var Mana.%buffabbrevs(%buff.tracker) %CurrentBuffMana
               put #var Camb.%buffabbrevs(%buff.tracker) %CurrentCambMana
               var Backfired 0
          }
     if ((%Backfired = 1) && ($UC_SmartSpells = 0)) then
          {
               echo #######################
               echo *** BACKFIRED %spellID !
               echo #######################
               put #echo >Log #FC0FC0 ** BACKFIRED %spellID !
               var Backfired 0
               pause 0.2
          }
     pause 0.00001
     if (%buff.tracker > %buff.count) then goto BUFF_RETURN
     if ("%buffabbrevs(%buff.tracker)" = "") then goto BUFF_NEXT
     if matchre("%buffs(%buff.tracker)", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto BUFF_NEXT
     if matchre("%buffabbrevs(%buff.tracker)", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto BUFF_NEXT
     if (matchre("%buffabbrevs(%buff.tracker)", "\b(?i)(RUE|RESONANCE|IGNITE)\b") && ("$UC_WeaponType" = "BRAWL")) then goto BUFF_NEXT
     if ((%Melee.Range = 1) && ($UC_Retreat = 1)) then gosub RETREAT
     if (matchre("%buffabbrevs(%buff.tracker)", "(?i)(ETF|EtherealFissure)") && !matchre("$roomobjs", "a .+ fissure")) then put #tvar spellETF 0
     if (matchre("%buffabbrevs(%buff.tracker)", "(?i)(RM|RisingMists)") && !matchre("$roomobjs", "(dense unnatural fog|wispy grey mist)")) then put #tvar spellRM 0
     if matchre("%buffabbrevs(%buff.tracker)", "\b(?i)COL\b") then
          {
               if (($Time.isXibarUp = 0) && ($Time.isYavashUp = 0) && ($Time.isKatambaUp = 0)) then
                    {
                         echo ** NO MOONS UP - NO COL!!
                         goto BUFF_NEXT
                    }
          }
     ## if ($SpellTimer.%spelltimer(%spell.tracker).duration < 2) then goto BUFF_NEXT
     pause 0.00001
     if (matchre("%buffabbrevs(%buff.tracker)", "RUE") && matchre("$UC_WeaponType", "(SLINGS|BOW|CROSSBOW|BRAWL|LT)")) then
          {
               echo **** Skipping RUE - Training $UC_WeaponType
               goto BUFF_RETURN
          }
     #########
     put #echo Current Buff: %buffs(%buff.tracker)
     var CurrentBuff %buffabbrevs(%buff.tracker)
     pause 0.00001
     if matchre("%buffabbrevs(%buff.tracker)", "(?i)IOTS") then
          {
               if (($SpellTimer.InvocationoftheSpheres.active = 1) && ($SpellTimer.InvocationoftheSpheres.duration <= 2)) then gosub RELEASE IOTS
               if ($SpellTimer.InvocationoftheSpheres.duration > 2) then goto BUFF_NEXT
               gosub IOTS_CHECK
               if matchre("%planet", "(?i)NULL") then
                    {
                         echo ####################
                         echo *** No Valid Planet to Cast On!
                         echo *** SKIPPING IOTS!
                         echo *** Last IOTS Planet: %lastIOTS
                         echo ####################
                         goto BUFF_NEXT
                    }
          }
     if matchre("%CurrentBuff", "\b(?i)SLS\b") then
          {
               gosub SLS_SET
               if matchre("%SLS", "(?i)NULL") then goto BUFF_NEXT
          }
     if (matchre("%buffs", "%buffs(%buff.tracker)") && ($SpellTimer.%buffs(%buff.tracker).duration > 2) && !matchre("%command", "(?i)SETUP") && ($spell%buffabbrevs(%buff.tracker) = 1)) then
          {
               echo *** %buffs(%buff.tracker) already active
               goto BUFF_NEXT
          }
     if matchre("%buffs(%buff.tracker)", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto BUFF_NEXT
     if matchre("%buffabbrevs(%buff.tracker)", "(?i)%Magic.Tattoo") then
          {
               put #var Mana.%buffabbrevs(%buff.tracker) 20
               put #var Camb.%buffabbrevs(%buff.tracker) $Camb.Sorcery
               put #var Camb.Sorcery $Camb.Sorcery
               put #var Camb.Tattoo $Camb.Sorcery
               var ChargeMana.Sorcery $Camb.Sorcery
               echo  ########################
               echo ** %buffabbrevs(%buff.tracker) is our Magic Tattoo
               echo ** Setting camb mana to %ChargeMana.Sorcery (Sorcery.Camb variable)
               echo  ########################
               var SorceryON 1
               pause 0.5
               goto BUFF_START_KNOWN
          }
     if matchre("%abbrevs", "(?i)%buffabbrevs(%buff.tracker)") then
          {
               if matchre("%command","(?i)SETUP") then goto BUFF_START_DISCERN
               if (($Mana.%buffabbrevs(%buff.tracker) > 100) && !matchre("%buffabbrevs(%buff.tracker)", "(?i)%Ritual.Spell.List")) then goto BUFF_START_DISCERN
               if ($Mana.%buffabbrevs(%buff.tracker) = 1) then goto BUFF_START_DISCERN
               if !def(Mana.%buffabbrevs(%buff.tracker)) then goto BUFF_START_DISCERN
               if !def(Camb.%buffabbrevs(%buff.tracker)) then goto BUFF_START_DISCERN
               if def(Mana.%buffabbrevs(%buff.tracker)) && !matchre("%1","(?i)SETUP") then goto BUFF_START_KNOWN
          }
     if !matchre("%abbrevs", "(?i)%buffabbrevs(%buff.tracker)") then goto BUFF_REMOVE
BUFF_START_DISCERN:
     if (%Backfired = 1) then goto BUFF_START_KNOWN_2
     echo
     echo *** Checking Optimal Cast Mana for %buffs(%buff.tracker)
     echo
     gosub SPELLMATH %buffabbrevs(%buff.tracker)
     if (%NOCAST = 1) then goto BUFF_REMOVE
     if matchre("%buffabbrevs(%buff.tracker)", "(?i)%Ritual.Spell.List") then
          {
               var spellResplit 0
               put #var Camb.%buffabbrevs(%buff.tracker) NULL
          }
     put #var Mana.%buffabbrevs(%buff.tracker) %spellCMax
     if ((%CambrinthCharge != 0) && (%spellResplit != 0) && ("%spellResplit" != "NULL")) then put #var Camb.%buffabbrevs(%buff.tracker) %spellResplit
     else put #var Camb.%buffabbrevs(%buff.tracker) 1
     echo ###############################
     echo *** SETTING %buffs(%buff.tracker) spell to %spellCMax Mana
     echo *** SETTING %buffs(%buff.tracker) cambrinth to %spellResplit Mana
     echo ###############################
BUFF_START_KNOWN:
     var CurrentBuffMana $Mana.%buffabbrevs(%buff.tracker)
     var CurrentCambMana $Camb.%buffabbrevs(%buff.tracker)
     if matchre("%buffs(%buff.tracker)", "(?i)%Magic.Tattoo") then var CurrentCambMana %CambrinthMana
     if ((%CurrentBuffMana != 0) && (%CurrentBuffMana != $Mana.%buffabbrevs(%buff.tracker))) then put #var Mana.%buffabbrevs(%buff.tracker) %CurrentBuffMana
     if (%CurrentBuffMana = 0) then var CurrentBuffMana $Mana.%buffabbrevs(%buff.tracker)
     # var CurrentBuffMana $Mana.%buffs(%buff.tracker)
     if ($Mana.%buffabbrevs(%buff.tracker) = 0) then goto BUFF_START_DISCERN
BUFF_START_KNOWN_2:
     # echo $Mana.%buffs(%buff.tracker)
     if ("%buffabbrevs(%buff.tracker)" = "COL") then
          {
               if ($Time.isKatambaUp = 1) then var COL Katamba
               if ($Time.isXibarUp = 1) then var COL Xibar
               if ($Time.isYavashUp = 1) then var COL Yavash
               if ("%COL" != "NULL") then goto BUFF_BEGIN
               goto BUFF_NEXT
          }
BUFF_BEGIN:
     echo
     echo * BUFF: %buffabbrevs(%buff.tracker)
     echo * FULLNAME: %buffs(%buff.tracker)
     echo * SPELLTIMER: $SpellTimer.%buffs(%buff.tracker).duration
     echo
     if (matchre("%buffs", "%buffs(%buff.tracker)") && ($SpellTimer.%buffs(%buff.tracker).duration > 2) || ($SpellTimer.%buffs(%buff.tracker).duration = 999)) then
          {
               echo
               echo *** %buffs(%buff.tracker) already active
               echo
               goto BUFF_NEXT
          }
     var spellID %buffabbrevs(%buff.tracker)
     if (matchre("%buffs(%buff.tracker)", "%Magic.Tattoo") || matchre("%buffabbrevs(%buff.tracker)", "%Magic.Tattoo")) then echo **** CASTING: %Magic.Tattoo Tattoo
     else echo **** CASTING: %buffabbrevs(%buff.tracker) @ $Mana.%buffabbrevs(%buff.tracker) Mana
     if (%Backfired = 0) then var CurrentBuffMana $Mana.%buffabbrevs(%buff.tracker)
     if matchre("%Magic.Tattoo", "%buffs(%buff.tracker)") then gosub BUFF_PREP %buffs(%buff.tracker) %CambrinthMana
     else gosub BUFF_PREP %buffabbrevs(%buff.tracker) $Mana.%buffabbrevs(%buff.tracker)
BUFF_REMOVE:
     if ((%Backfired = 1) && ($UC_SmartSpells = 1)) then
          {
               var CurrentBackfire %buffabbrevs(%buff.tracker)
               gosub BUFF_BACKFIRED
               put #var Mana.%buffabbrevs(%buff.tracker) %CurrentBuffMana
               put #var Camb.%buffabbrevs(%buff.tracker) %CurrentCambMana
               var Backfired 0
               goto BUFF_NEXT
          }
     if ((%Backfired = 1) && ($UC_SmartSpells = 0)) then
          {
               echo ##############
               echo *** BACKFIRED %spellID !
               echo ##############
               put #echo >Log #FC0FC0 ** BACKFIRED %spellID !
               var Backfired 0
               pause 0.2
          }
     if matchre("%buffs(%buff.tracker)", "(?i)%Magic.Tattoo") then goto BUFF_NEXT
     if (!matchre("%abbrevs", "(?i)%buffabbrevs(%buff.tracker)") || (%NOCAST = 1)) then
          {
               echo
               echo ** %buffs(%buff.tracker) Spell is not known/Too Hard!
               echo ** Removing from buffs list
               echo
               eval buffs replacere("%buffs", "%buffs(%buff.tracker)", "")
               #eval buffs replacere("%buffs", "\|%buffs(%buff.tracker)", "")
               eval buffs replacere("%buffs", "\|+", "|")
               eval buffs replacere("%buffs", "\|$", "")
               eval buffs replacere("%buffs", "^\|", "")
               eval buffabbrevs replacere("%buffabbrevs", "%buffabbrevs(%buff.tracker)", "")
               #eval buffs replacere("%buffs", "\|%buffs(%buff.tracker)", "")
               eval buffabbrevs replacere("%buffabbrevs", "\|+", "|")
               eval buffabbrevs replacere("%buffabbrevs", "\|$", "")
               eval buffabbrevs replacere("%buffabbrevs", "^\|", "")
               math buff.tracker subtract 1
               math buff.count subtract 1
               var %GuildType.Buffs %buffs
               echo *** New Buffs list: %buffs
               var NOCAST 0
               pause
          }
BUFF_NEXT:
     math spell.tracker add 1
     math buff.tracker add 1
     goto BUFF_START_1

BUFF_RETURN:
     var NOCAST 0
     var Backfired 0
     var BUFFING OFF
     var buff.count 0
     var OMTracker 0
     var buff.tracker 0
     var spell.tracker 0
     var noCharge 0
     var SLS NULL
     var COL NULL
     var spellPrepped 0
     var BuffTime $gametime
     if (%InCombat = 0) then gosub stowing
     return
########## BUFFING GOOOOOO
BUFF_PREP:
     action (magic) on
     delay 0.00001
     var buffPrep $1
     var buffPrepMana $2
     if (%buffPrepMana = 0) then var buffPrepMana
     BUFF_PREP_1:
     if (matchre("%buffPrep", "(?i)SHEAR") && ($SpellTimer.Shear.active = 1)) then gosub RELEASE shear
     if (matchre("%buffPrep", "(?i)IGNITE") && ($SpellTimer.Ignite.active = 1)) then gosub RELEASE ignite
     if (matchre("%buffPrep", "RM") && matchre("$roomexits", "obscured by a thick fog")) then return
     if (matchre("%buffPrep", "RUE") && matchre("$UC_WeaponType", "(SLINGS|BOW|CROSSBOW|LT|BRAWL)")) then return
     if !matchre("$guild", "%MAGICUSER") then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if ($stunned) then waiteval (!$stunned)
     if (($Symbiosis.Buffs)  && !matchre("%buffPrep", "\b(?i)(%Cyclic.Spell.List|%Ritual.Spell.List)\b") && (!$preparedSymbiosis)) then gosub PUT prepare symbiosis
	if (($preparedSymbiosis) && (!$Symbiosis.Buffs)) then
          {
               put release symbiosis
               pause 0.4
          }
     pause 0.00001
     var spellID %buffPrep %buffPrepMana
     if ((%CurrentBuffMana != 0) && (%CurrentBuffMana != $Mana.%buffabbrevs(%buff.tracker))) then put #var Mana.%buffabbrevs(%buff.tracker) %CurrentBuffMana
     if matchre("%buffPrep", "%Magic.Tattoo") then
          {
               gosub INVOKE tattoo
               pause 0.001
               var spelllearn Sorcery
               var spellID %Magic.Tattoo
               var CurrentSpell %Magic.Tattoo
               var CurrentCambMana $Camb.Tattoo
               if ((%MagicTM = 1) || matchre("%buffPrep", "(?i)%TM.Spell.List")) then
                    {
                         send target
                         var MagicTM 0
                         pause 0.5
                    }
          }

     else gosub PREPARE %buffPrep %buffPrepMana
BUFF_CASTING:
     pause 0.00001
     if ((%CurrentBuffMana != 0) && (%CurrentBuffMana != $Mana.%buffabbrevs(%buff.tracker)) && ("%buffs(%buff.tracker)" != "%Magic.Tattoo")) then put #var Mana.%buffabbrevs(%buff.tracker) %CurrentBuffMana
     if matchre("%buffabbrevs(%buff.tracker)", "(?i)%Ritual.Spell.List") then gosub RITUAL
     # if matchre("$preparedspell" = "Persistence of Mana|Murrula's Flames") then gosub RITUAL
     if (("$preparedspell" = "Ignite") && ("%IGNITE.WEAPON" = "NULL")) then gosub IGNITE_PREP
     if ("$preparedspell" != "None") then
          {
               if (%spellPrepped = 1) then gosub BUFF_CAST
               else gosub BUFF_WAIT
          }
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if matchre("$righthand $lefthand", "$UC_Cambrinth") then gosub WEAR $UC_Cambrinth
     #if (%Backfired) then goto BUFF_START_1
     return
##### END BUFFING LOGIC
#### SPELL SUBS
SPELL_WAIT:
     action (magic) on
     pause 0.00001
     var spellwaitcount 0
     if ("$preparedspell" = "None") then return
     if (%spellPrepped = 1) then goto SPELL_CAST
     eval temp count("%AimActions", "|")
SPELLWAIT_ACTIONS:
     pause 0.00001
     math spellwaitcount add 1
     if ($standing = 0) then gosub STAND
     if (%spellPrepped = 1) then goto SPELL_CAST
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if ((%MagicTM = 1) && matchre("%CurrentSpell", "\b(?i)%Magic.Tattoo\b") && matchre("%CurrentSpell", "\b(?i)%TM.Spell.List\b")) then
          {
               echo *** TM Magic Tattoo detected - Acquiring Target
               var MagicTM 0
               put target
               pause 7
          }
     if (("$preparedspell" = "ABSOLUTION") || ("$preparedspell" = "Absolution")) then goto SPELL_WAIT_2
     if ("$guild" = "Empath") then
          {
               if (($UC_ConstructOnly = 1) && !matchre("%Empath.Critter", "%Undead|%Construct")) then goto SPELL_WAIT_2
          }
     if matchre("$righthand $lefthand", "$UC_Cambrinth") then gosub WEAR $UC_Cambrinth
     if (%spellwaitcount > %temp) then goto SPELL_WAIT_2
     pause 0.1
     if (($monstercount > 0) && ($hidden = 0) && (%Foci.Active = 0) && (%InCombat = 0)) then
          {
               if (matchre("%AimActions(%spellwaitcount)", "throw (.*)") then
                    {
                         var aimthrow $1
                         gosub GET_IT %aimthrow
                         if (!matchre("$lefthand", "%aimthrow") && !matchre("$righthand", "(?i)%WEAPON")) then
                              {
                                   put swap
                                   pause 0.3
                              }
                         gosub put %ThrowType left
                         gosub STOW %aimthrow
                    }
               if matchre("%AimActions(%spellwaitcount)", "(?i)attack\b") then
                    {
                         if matchre("$righthand", "(?i)(shortbow|bow|crossbow|sling|slurbow|arbalest|longbow)") then
                              {
                                   if ($monstercount > 0) then gosub PUT attack left
                              }
                         else if ($monstercount > 0) then gosub PUT attack
                    }
               else put %AimActions(%spellwaitcount)
          }
     pause 0.3
     pause 0.1
     if ($spelltime > 28) then goto SPELL_CAST
     if (%spellPrepped = 1) then goto SPELL_CAST
     goto SPELLWAIT_ACTIONS
SPELL_WAIT_2:
     if ($spelltime > 22) then goto SPELL_CAST
     if (%spellPrepped = 1) then goto SPELL_CAST
     if (%MAGIC.SNAP > 0) then
          {
               evalmath CastLast ($gametime - %CastTime)
               if (%CastTime >= %MAGIC.SNAP) then goto SPELL_CAST
               goto SPELL_WAIT_2
          }
     if ($spelltime > 30) then goto SPELL_CAST
     if (%spellPrepped = 1) then goto SPELL_CAST
     matchre SPELL_CAST ^You feel fully prepared to cast your spell\.
     matchre SPELL_CAST_FAIL ^Your concentration slips for a moment\, and your spell is lost\.
     matchre SPELL_CAST ^Your target pattern has finished forming around the area\.|^The formation of the target pattern around .* has completed\.|^Your formation of a targeting pattern
     matchwait 24
     goto SPELL_CAST
BUFF_WAIT:
     pause 0.1
     var buffcount 0
     delay 0.0001
     eval temp count("%AimActions", "|")
     # eval AimAction element("%AimActions", 1)
BUFF_ACTIONS:
     pause 0.00001
     if ($standing = 0) then gosub STAND
     if matchre("$righthand $lefthand", "$UC_Cambrinth") then gosub WEAR $UC_Cambrinth
     if matchre("$righthand $lefthand", "$UC_Cambrinth") then gosub STOWIT $UC_Cambrinth
     if (%spellPrepped = 1) then goto BUFF_CAST
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if ("$guild" = "Empath") then
          {
               if (matchre("$monsterlist", "%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then goto BUFF_WAIT_2
               if (($UC_ConstructOnly = 1) && !matchre("%Empath.Critter", "(%Undead|%Construct)")) then goto BUFF_WAIT_2
          }
     if matchre("$preparedspell" = "Absolution") then goto BUFF_WAIT_2
     if (%buffcount > %temp) then goto BUFF_WAIT_2
     pause 0.00001
     if (($monstercount > 0) && ($hidden = 0) && (%Foci.Active = 0) && (%InCombat = 0)) then
          {
               if (matchre("%AimActions(%buffcount)", "throw (.*)") then
                    {
                         var aimthrow $1
                         gosub GET_IT %aimthrow
                         if (!matchre("$lefthand", "%aimthrow") && !matchre("$righthand", "(?i)%WEAPON")) then
                              {
                                   put swap
                                   pause 0.3
                              }
                         gosub put %ThrowType left
                         gosub STOW %aimthrow
                    }
               if matchre("%AimActions(%buffcount)", "(?i)attack\b") then
                    {
                         if matchre("$righthand", "(?i)(shortbow|bow|crossbow|sling|slurbow|arbalest|longbow)") then
                              {
                                   if ($monstercount > 0) then gosub PUT attack left
                              }
                         else if ($monstercount > 0) then gosub PUT attack
                    }
               else put %AimActions(%buffcount)
          }
     pause 0.5
     pause 0.01
     if (%spellPrepped = 1) then goto BUFF_CAST
     math buffcount add 1
     goto BUFF_ACTIONS
BUFF_WAIT_2:
     pause 0.00001
     pause 0.00001
     if ("$preparedspell" = "None") then return
     if ($spelltime > 28) then goto BUFF_CAST
     if (%spellPrepped = 1) then goto BUFF_CAST
     if (%MAGIC.SNAP > 0) then
          {
               evalmath BuffLast ($gametime - %BuffTime)
               if (%BuffLast >= %MAGIC.SNAP) then goto BUFF_CAST
               goto BUFF_WAIT_2
          }
     if ($spelltime > 30) then goto BUFF_CAST
     if (%spellPrepped = 1) then goto BUFF_CAST
     matchre BUFF_CAST ^You feel fully prepared to cast your spell\.|^Your formation
     matchre BUFF_CAST_FAIL ^Your concentration slips for a moment\, and your spell is lost\.
     matchwait 24
BUFF_CAST:
     var LOCATION BUFF_CAST_1
     pause 0.00001
     var savedWeapon NULL
     var spellPrepped 0
     if ((%CambrinthCharge != 0) && !matchre("%CurrentCambMana", "(?i)\b(NULL|OFF|0)\b") && ($UC_Cambrinth.Use.Buffs = 1)) then gosub CAMBRINTH_SPELL %CurrentCambMana
     pause 0.00001
     if (%Playing = 1) then gosub STOP_PLAY
     if matchre("$righthand $lefthand", "$UC_Cambrinth") then gosub WEAR $UC_Cambrinth
     if matchre("$righthand $lefthand", "$UC_Cambrinth") then gosub STOWIT $UC_Cambrinth
     pause 0.00001
     if (matchre("%CurrentSpell", "(?i)Vivisection") && ($UC_TrainStealth = 1)) then gosub HIDE
     if (("$preparedspell" = "Absolution") && ($SpellTimer.GiftofLife.active = 1)) then gosub RELEASE GOL
BUFF_CAST_1:
     var orb 0
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if (matchre("$guild", "(Ranger|Trader|Paladin)") && ($mana < 80)) then pause
     if ($mana < 70) then pause
     pause 0.00001
     if ($SpellTimer.OsrelMeraud.active = 1) then var orb 1
     matchre BUFF_CAST_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre BUFF_CAST_FAIL ^Your spell.*backfires
     matchre BUFF_CAST_FAIL ^Your spell backfires
     matchre BUFF_CAST_FAIL ^You strain, but are too mentally fatigued
     matchre BUFF_CAST_FAIL ^You strain\, but are too mentally fatigued to finish the pattern\, and it slips away\.
     matchre BUFF_CAST_REMOVE ^Currently lacking the skill to complete the pattern\, your spell fails completely\.
     matchre RELEASE_CYCLIC ^Maintaining two cyclic spells at once is beyond your mental comprehension
     matchre BUFF_CAST_DONE ^You don't have a spell prepared\!
     matchre BUFF_CAST_DONE ^Your concentration slips for a moment\, and your spell is lost\.
     matchre BUFF_CAST_DONE ^You gesture\.
     matchre BUFF_CAST_DONE ^You feel momentarily befuddled
     matchre BUFF_CAST_DONE ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre BUFF_CAST_DONE ^You wave your hand\.
     matchre BUFF_CAST_DONE ^Focus the power of justice on whom\?
     matchre BUFF_CAST_DONE ^A shaft|^Your spirit sings
     matchre BUFF_CAST_RELEASE already has a (.+) over (him|her)\!
     matchre BUFF_CAST_DONE You sense a tugging sensation
     matchre BUFF_CAST_DONE ^Your .+ emits a loud \*snap\* as it discharges
     matchre BUFF_CAST_DONE ^You roll your hands in an elliptical pattern in front of you
     matchre BUFF_CAST_DONE ^Please rephrase|^Sheathing|^What were
     matchre BUFF_CAST_DONE ^You draw your hand|^You step inside
     if ((%MagicTM = 1) && matchre("%CurrentSpell", "\b(?i)%Magic.Tattoo\b") && matchre("%CurrentSpell", "\b(?i)%TM.Spell.List\b")) then
          {
               echo *** TM Magic Tattoo detected - Acquiring Target
               var MagicTM 0
               put target
               pause 7
          }
     if (matchre("%buffs(%buff.tracker)", "\b(?i)IOTS\b") || ("$preparedspell" = "Invocation of the Spheres")) then
          {
                    put cast %planet
                    pause 0.5
                    pause 0.3
                    put invoke circle
                    echo #################################
                    echo ** IOTS Active! Planet: %planet  Type: %bufftype
                    echo #################################
                    matchwait 10
                    goto BUFF_CAST_DONE
          }
     if (matchre("%buffs(%buff.tracker)", "\b(?i)RTR\b") || ("$preparedspell" = "Read the Ripples")) then
          {
                    if ($standing) then send sit
                    pause 0.5
                    pause 0.1
                    put cast
                    matchwait 10
                    goto BUFF_CAST_DONE
          }
     if (matchre("%buffs(%buff.tracker)", "\b(?i)RITS\b") || ("$preparedspell" = "River in the Sky")) then
          {
                    put cast any
                    matchwait 10
                    goto BUFF_CAST_DONE
          }
     if (matchre("%buffs(%buff.tracker)", "\b(?i)HW\b") || ("$preparedspell" = "Heal Wounds")) then
          {
                    var AREATOHEAL chest
                    action var wounds $1 when ^You have ((\b(?!no )\w+).+)
                    gosub HEALTH_CHECK
                    gosub IDHWHEAL
                    action remove ^You have ((\b(?!no )\w+).+)
                    put cast %AREATOHEAL
                    matchwait 10
                    goto BUFF_CAST_DONE
          }
    if (matchre("%buffs(%buff.tracker)", "\b(?i)EF\b") || ("$preparedspell" = "Eylhaar's Feast")) then
          {
               if (%EF.Ready = 0) then
                    {
                         echo ** EF NOT READY YET - STILL ADDICTED
                         gosub RELEASE spell
                         gosub RELEASE_CAMB
                         return
                    }
               var EF.Ready 0
               if (($health < 96) && ($spirit > 60)) then
                    {
                         put cast vitality 7;-0.05 gesture
                         matchwait 20
                         goto BUFF_CAST_DONE
                    }
               if (($stamina < 92) && ($spirit > 60)) then
                    {
                         put cast fatigue 9;-0.05 gesture
                         matchwait 20
                         goto BUFF_CAST_DONE
                    }
               if ($spirit >= 60) then put cast attune 7;-0.05 gesture
               if (($spirit < 60) && ($spirit >= 50)) then put cast attune 2;-0.05 gesture
               if ($spirit < 50) then put cast attune 1;-0.05 gesture
               matchwait 3
               goto BUFF_CAST_DONE
          }
     if ("$preparedspell" = "Sanctify Pattern") then
          {
               gosub SANCTIFY_CHOOSE
               send -cast %Sanctify.Skill;-0.05 gesture
               matchwait 3
               goto BUFF_CAST_DONE
          }
     if ("$preparedspell" = "Benediction") then
          {
               send -cast %FAVOR.GOD;-0.05 gesture
               matchwait 3
               goto BUFF_CAST_DONE
          }
     if (matchre("%CurrentSpell", "\b(?i)MALEDICTION\b") || ("$preparedspell" = "Malediction")) then
          {
               var MALE defense
               random 1 2
               pause 0.001
               if (%r = 1) then var MALE offense
               if (%r = 2) then var MALE defense
               pause 0.01
               put cast %MALE
               matchwait 3
               goto BUFF_CAST_DONE
          }
     # if ("$preparedspell" = "Osrel Meraud") then
          # {
               # put -get my orb;-cast my orb;-0.05 gesture
               # matchwait 20
               # goto BUFF_CAST_DONE
          # }
     if (matchre("%buffs(%buff.tracker)", "\b(?i)OM\b") || ("$preparedspell" = "Osrel Meraud") || (($SpellTimer.OsrelMeraud.active = 1) && matchre("$preparedspell", "%OM.Buffs"))) then
          {
               send -touch my orb;-0.05 cast
               matchwait 3
               goto BUFF_CAST_DONE
          }
     if (matchre("%buffs(%buff.tracker)", "\b(?i)SLS\b") && ("%SLS" != "NULL")  || ("$preparedspell" = "Starlight Sphere")) then
          {
               send -cast %SLS;-0.05 point sphere at %Critter
               var SLS NULL
               matchwait 3
               goto BUFF_CAST_DONE
          }
     if (matchre("$preparedspell", "(Albreda's Balm|Electrostatic Eddy|Fire Rain|Universal Solvent)") || matchre("%buffs(%buff.tracker)", "(EE|ALB|FR|USOL)")) then
          {
               send cast creature
               matchwait 4
               goto BUFF_CAST_DONE
          }
     if (matchre("$preparedspell", "Hydra Hex") || matchre("%buffs(%buff.tracker)", "HH")) then
          {
               send cast COZ
               matchwait 3
               goto BUFF_CAST_DONE
          }
     if (("$preparedspell" = "Cage of Light") || ("$preparedspell" = "Moonblade") || matchre("%buffs(%buff.tracker)", "(Moonblade|COL)")) then
          {
               var COL NULL
               if ($Time.isKatambaUp) then var COL Katamba
               if ($Time.isXibarUp) then var COL Xibar
               if ($Time.isYavashUp) then var COL Yavash
               pause 0.1
               if ("%COL" = "NULL") then
                    {
                         echo ** $preparedspell ERROR! NO MOONS UP!
                         goto BUFF_CAST_DONE
                    }
               send cast %COL
               var COL NULL
               matchwait 3
               goto BUFF_CAST_DONE
          }
     if (("$preparedspell" = "Avren Aevareae") || matchre("%buffs(%buff.tracker)", "(AVA)")) then
          {
               var AVA NULL
               if ($Time.isKatambaUp) then var AVA Katamba
               if ($Time.isXibarUp) then var AVA Xibar
               if ($Time.isYavashUp) then var AVA Yavash
               pause 0.1
               if ("%AVA" = "NULL") then
                    {
                         echo ** $preparedspell ERROR! NO MOONS UP!
                         goto BUFF_CAST_DONE
                    }
               send cast %AVA
               var AVA NULL
               matchwait 3
               goto BUFF_CAST_DONE
          }
     if ("$preparedspell" = "Moonblade") then
          {
               var COL NULL
               if ($Time.isKatambaUp = 1) then var COL Katamba
               if ($Time.isXibarUp = 1) then var COL Xibar
               if ($Time.isYavashUp = 1) then var COL Yavash
               pause 0.1
               if ("%COL" = "NULL") then
                    {
                         echo ** Moonblade ERROR! NO MOONS!
                         goto BUFF_CAST_DONE
                    }
               send cast %COL
               var COL NULL
               matchwait 3
               goto BUFF_CAST_DONE
          }
     if (("$preparedspell" = "Ignite") && matchre("$UC_WeaponType", "(BOW|SLINGS|XBOW|CROSSBOW)")) then
               {
               var savedWeapon NULL
               if ("%IGNITE.WEAPON" = "NULL") then gosub IGNITE_PREP
               if (!matchre("$righthand", "Empty") && !matchre("$righthand", "%IGNITE.WEAPON")) then
                    {
                         var savedWeapon $righthandnoun
                         gosub stowing
                         gosub GET %IGNITE.WEAPON
                    }
               if (("$righthand" = "Empty") && !matchre("$lefthand", "Empty")) then
                    {
                         var savedWeapon $lefthandnoun
                         gosub stowing
                         gosub GET %IGNITE.WEAPON
                    }
               pause 0.1
               pause 0.1
               if !matchre("$righthand $lefthand", "%IGNITE.WEAPON") then gosub GET %IGNITE.WEAPON
               pause 0.4
               put cast $righthandnoun
               wait
               pause 0.2
               pause 0.2
               gosub STOWIT %IGNITE.WEAPON
               if ("%savedWeapon" != "NULL") then
                    {
                         gosub stowing
                         gosub GET %savedWeapon
                    }
               goto BUFF_CAST_DONE
               }
     if (matchre("%CurrentSpell", "\b(?i)ETF\b") || ("$preparedspell" = "Ethereal Fissure")) then
          {
               if ($spellETF = 1) then
                    {
                         pause 0.1
                         pause 0.1
                         send close fissure
                         wait
                         pause 0.5
                         pause 0.3
                    }
               put cast %element
               matchwait 3
               goto BUFF_CAST_DONE
          }
     if (("$preparedspell" = "Ignite") && !matchre("$righthand $lefthand", "(?i)%WEAPON")) then
          {
               if !matchre("$righthand", "Empty") && ("$righthand" != "%IGNITE.WEAPON") then
                    {
                         var savedWeapon $righthandnoun
                         gosub stowing
                         gosub GET my %IGNITE.WEAPON
                    }
               if !matchre("$righthand $lefthand", "%IGNITE.WEAPON") then gosub GET my %IGNITE.WEAPON
               pause 0.2
               put cast $righthandnoun
               if ("%savedWeapon" != "NULL") then
                    {
                         gosub stowing
                         gosub GET my %savedWeapon
                    }
               goto BUFF_CAST_DONE
          }
     if ("$preparedspell" = "Ignite") then
          {
               pause 0.2
               if !matchre("$righthand", "Empty") then put cast $righthandnoun
               if !matchre("$lefthand", "Empty") then put cast $lefthandnoun
               pause 0.2
               if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub stowing
               if (!matchre("$righthand $lefthand", "(?i)%WEAPON") && !matchre("$UC_WeaponType","BRAWL")) then gosub GET my %WEAPON
               goto BUFF_CAST_DONE
          }
     if matchre("$preparedspell", "(Resonance|Rutilor\'s Edge)") then
          {
               if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub stowing
               if (!matchre("$righthand $lefthand", "(?i)%WEAPON") && !matchre("$UC_WeaponType","BRAWL")) then gosub GET my %WEAPON
               pause 0.3
               put cast %WEAPON
               pause 0.5
               if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub stowing
               if (!matchre("$righthand $lefthand", "(?i)%WEAPON") && !matchre("$UC_WeaponType","BRAWL")) then gosub GET my %WEAPON
               goto BUFF_CAST_DONE
          }
     if (matchre("%CurrentSpell", "%OM.Buffs") && (%orb = 1) && (%OrbFull = 0)) then send -touch my orb;-0.05 cast
     if ((%orb = 0) || (%OrbFull = 1) || !matchre("%CurrentSpell", "%OM.Buffs")) then send -cast;-0.05 gesture
     matchwait 10
     goto BUFF_CAST_DONE
BUFF_CAST_REMOVE:
     var LOCATION BUFF_CAST_REMOVE
     pause 0.0001
     echo
     echo ** %buffs(%buff.tracker) spell is too hard for us right now!
     echo ** Removing from buffs list
     echo
     eval buffs replacere("%buffs", "%buffs(%buff.tracker)", "")
     eval buffs replacere("%buffs", "\|+", "|")
     eval buffs replacere("%buffs", "\|$", "")
     math buff.count subtract 1
     math buff.tracker subtract 1
     var %GuildType.Buffs %buffs
     echo
     echo *** Buffs: %buffs
     echo
     var NOCAST 0
     return
BUFF_CAST_RELEASE:
     pause 0.0001
     gosub RELEASE spell
     gosub RELEASE_CAMB
     pause 0.0001
     pause 0.0001
BUFF_CAST_DONE:
     put #queue clear
     math buff.tracker add 1
     if (%Backfired = 1) then goto BUFF_CAST_FAIL
     var Backfired 0
     var cambCharged 0
     var spellPrepped 0
     var spellExpired 0
     var noCharge 0
     var MagicTM 0
     var TM.Target NULL
	put #var preparedSymbiosis 0
     if ($stunned) then waiteval (!$stunned)
     if matchre("$guild", "Moon Mage") then
          {
               if matchre("%CurrentSpell", "(?i)SHADOWLING") then
                    {
                         echo *** CHECKING ROOM FOR SHADOWLING...
                         if !matchre("$roomobjs", "(?i)shadow") then
                              {
                                   pause 0.5
                                   pause 0.4
                                   put look
                                   pause 0.3
                                   pause 0.3
                              }
                         if matchre("$roomobjs", "(?i)(SHADOWLING|SHADOWCAT|SHADOWPANTHER|SHADOWTABBY)") then
                              {
                                   send invoke $1
                                   var CurrentSpell NULL
                                   pause 0.3
                                   goto BUFF_CAST_DONE_2
                              }
                         pause 0.5
                         put look
                         pause 0.5
                         pause 0.2
                         if matchre("$roomobjs", "(?i)(SHADOWLING|SHADOWCAT|SHADOWPANTHER|SHADOWTABBY)") then
                              {
                                   send invoke $1
                                   var CurrentSpell NULL
                                   pause 0.3
                                   goto BUFF_CAST_DONE_2
                              }
                    }
          }
BUFF_CAST_DONE_2:
     if matchre("$righthand $lefthand", "(?i)apparatus") then
          {
               put drop apparatus
               pause 0.4
          }
     return
BUFF_CAST_FAIL:
     var LOCATION BUFF_CAST_FAIL
     math buff.tracker add 1
     pause 0.0001
     if ((%Backfired = 1) && (%singlebuff = 0) && ($UC_SmartSpells = 1)) then
          {
               var CurrentBackfire %buffs(%buff.tracker)
               gosub BUFF_BACKFIRED
               put #var Mana.%buffs(%buff.tracker) %CurrentBuffMana
               put #var Camb.%buffs(%buff.tracker) %CurrentCambMana
               var Backfired 0
          }
     if ((%Backfired = 1) && ($UC_SmartSpells = 0)) then
          {
               echo ##############
               echo *** BACKFIRED %spellID !
               echo ##############
               put #echo >Log #FC0FC0 ** BACKFIRED %spellID !
               var Backfired 0
               pause 0.2
          }
     var noCharge 0
     var cambCharged 0
     var spellPrepped 0
     var spellExpired 0
     var MagicTM 0
     if ($stunned) then waiteval (!$stunned)
     return
TARGET_RELEASE:
     var spellExpired 0
     put release spell
     pause 0.1
     pause 0.00001
     pause 0.00001
     goto %LOCATION
RELEASE_CYCLIC:
     gosub RELEASE cyclic
     pause 0.00001
     goto %LOCATION
SPELL_CAST:
     var Temp.Right NULL
     var Temp.Left NULL
     var LOCATION SPELL_CAST_1
     pause 0.0001
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if ((%spellExpired = 1) || ($spelltime > 50)) then
          {
               echo *** SPELL EXPIRED
               gosub RELEASE spell
               gosub RELEASE_CAMB
               goto SPELL_CAST_DONE
          }
     if ((%MagicTM = 1) && matchre("%CurrentSpell", "\b(?i)%Magic.Tattoo\b") && matchre("%CurrentSpell", "\b(?i)%TM.Spell.List\b")) then
          {
               echo *** TM Magic Tattoo detected - Acquiring Target
               var MagicTM 0
               var noTarget 0
               put target
               pause 7
          }
     if ((matchre("%CurrentSpell", "(?i)%TM.Spell.List") && (%noTarget = 1) && && ($spelltime > 18)) || (matchre("%CurrentSpell", "(?i)%TM.Spell.List") && matchre("$roomobjs", "(?i)(%critters) ((?:which|that) appears dead|\(dead\)|(pile of rubble|pile of broken ice))") && (%noTarget = 1) && ($spelltime > 18)) || ((%MagicTM = 1) && ($monstercount > 0) && ($spelltime > 18)))  then
          {
               echo **** TM SPELL EXPIRED AND/OR CURRENT MOB TARGET DIED - RELEASING
               var MagicTM 0
               var noTarget 0
               gosub RELEASE spell
               gosub RELEASE_CAMB
               goto SPELL_CAST_DONE
          }
     if ((matchre("%CurrentSpell", "(?i)%TM.Spell.List") && (%noTarget = 1) && ($monstercount > 0)) || (matchre("%CurrentSpell", "(?i)%TM.Spell.List") && matchre("$roomobjs", "(?i)(%critters) ((?:which|that) appears dead|\(dead\)|(pile of rubble|pile of broken ice))") && (%noTarget = 1) && ($monstercount > 0)) || ((%MagicTM = 1) && ($monstercount > 0) && matchre("%CurrentSpell", "(?i)%TM.Spell.List"))) then
          {
               var MagicTM 0
               var noTarget 0
               var newdead 1
               echo **** NEW TARGET
               pause 0.1
               pause 0.1
               pause 0.1
               send target
               pause 1
               echo *** PAUSING BEFORE CAST....
               if ("$guild" != "Empath") then
                    {
                         if !matchre("$righthand", "\b(?i)(crossbow|stonebow|arbalest|shortbow|bow|lockbow|pelletbow|latchbow|slurbow|sling)\b") then put attack
                         else put attack left
                         pause 2
                         pause 0.2
                         if !matchre("$righthand", "\b(?i)(crossbow|stonebow|arbalest|shortbow|bow|lockbow|pelletbow|latchbow|slurbow|sling)\b") then put attack
                         else put attack left
                         pause 2
                         pause 0.2
                         if !matchre("$righthand", "\b(?i)(crossbow|stonebow|arbalest|shortbow|bow|lockbow|pelletbow|latchbow|slurbow|sling)\b") then put attack
                         else put attack left
                         pause 2
                         pause 0.2
                    }
              if ("$guild" = "Empath") then
                    {
                         put bob
                         pause 2
                         pause 0.4
                         put circle
                         pause 2
                         pause 0.4
                         put weave
                         pause 2
                         pause 0.4
                         put bob
                         pause 2
                         pause 0.4
                         pause 2
                    }
          }
     if (("$guild" = "Empath") && ($UC_ConstructOnly = 1) && (%InCombat = 1)) then
          {
               if (("%Empath.Critter" = "NULL") && matchre("$monsterlist", "(%Construct|%Undead)")) then gosub ASSESS
               if !matchre("%facing", "%Construct") then
                    {
                    if !matchre("%facing", "(?i)NULL") then echo *** FACING CRITTER: %facing
                    if !matchre("%facing", "%Undead") then
                         {
                              if (matchre("%CurrentSpell", "(?i)(%TM.Spell.List|%Debil.Spell.List)") && matchre("%facing", "(?i)NULL")) then
                                   {
                                        echo ################################
                                        echo ** OUR TARGET DIED OR LOST TARGET!
                                        echo ** RELEASING SPELL FOR SAFETY!!!
                                        echo ################################
                                        pause 0.2
                                        gosub RELEASE spell
                                        gosub RELEASE_CAMB
                                        goto SPELL_CAST_DONE
                                   }
                              if (matchre("%CurrentSpell", "(?i)(%TM.Spell.List|%Debil.Spell.List)") && !matchre("%CurrentSpell", "\b(?i)(NB|LETHARGY|PARALYSIS|EASE)")) then
                                   {
                                        echo ##########################################################
                                        echo ** NOPE! %CurrentSpell SPELL WILL CAUSE EMPATHIC SHOCK! - RELEASING
                                        echo ##########################################################
                                        pause 0.2
                                        gosub RELEASE spell
                                        gosub RELEASE_CAMB
                                        goto SPELL_CAST_DONE
                                   }
                         }
                    }
               if (matchre("%CurrentSpell", "(?i)ABSOLUTION") && ($SpellTimer.GiftofLife.active = 1)) then gosub RELEASE GOL
          }
     if (!matchre("$roomobjs", "(?i)%critters") && matchre("%CurrentSpell", "(?i)(%TM.Spell.List|%Debil.Spell.List)")) then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
               goto SPELL_CAST_DONE
          }
     if ((%CambrinthCharge != 0) && !matchre("%CurrentSpell", "\b(%Cyclic.Spell.List|%Ritual.Spell.List)\b")) then
          {
               if (!matchre("%CurrentCambMana", "(?i)\b(NULL|OFF|0)\b") && (%cambCharged = 0) && ($UC_Cambrinth.Use = 1)) then
                    {
                         if ((matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice))") && !matchre("%CurrentSpell", "(?i)(%TM.Spell.List|%Debil.Spell.List|%Cyclic.Spell.List)")) || (!matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice))"))) then gosub SPELL_CAMBRINTH
                    }
               if matchre("$righthand $lefthand", "$UC_Cambrinth") then gosub WEAR $UC_Cambrinth
               pause 0.2
          }
     if (%Playing = 1) then gosub STOP_PLAY
     if (matchre("%CurrentSpell", "(?i)Vivisection") && ($UC_TrainStealth = 1)) then gosub HIDE
     if !matchre("$righthand", "Empty") then var Temp.Right $righthandnoun
     if !matchre("$lefthand", "Empty") then var Temp.Left $lefthandnoun
     var savedWeapon NULL
     var spellPrepped 0
     SPELL_CAST_1:
     pause 0.00001
     matchre SPELL_CAST_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RELEASE_CYCLIC ^Maintaining two cyclic spells at once is beyond your mental comprehension
     matchre SPELL_CAST_CRITTER ^You can't cast .* yourself
     matchre SPELL_CAST_NOBACKFIRE ^Your target pattern dissipates because .+ is dead, but the main spell remains intact\.
     matchre SPELL_CAST_NOBACKFIRE ^You strain, but are too mentally fatigued to finish the pattern, and it slips away\.
     matchre SPELL_CAST_NOBACKFIRE ^Something in the area prevents your spell from working\.|^The mental strain of initiating a cyclic spell so recently prevents you from formulating the spell pattern\.
     matchre SPELL_CAST_FAIL ^Your spell barely backfires\.|^Your spell backfires somewhat\.|^Your spell backfires\.|^Your spell hopelessly backfires\.|^Your spell.*backfires?|^Currently lacking the skill to complete the pattern, your spell fails completely\.|^You can't cast that at yourself\!|^You don't have a spell prepared\!|^You can't cast .+ on .+\!|^The spell pattern resists the influx of unfocused mana\.  You are able to contain the backlash but doing so results in a splitting headache\.|^The spell pattern resists the influx of unfocused mana though you are able to channel the worst of the backlash into your nervous system\.|^The spell pattern resists the influx of unfocused mana though the backlash leaves you stunned\!|^The spell pattern resists the influx of unfocused mana, and a strange burning sensation backwashes from the spell pattern into your body\.
     matchre SPELL_CAST_FAIL ^The spell pattern collapses at the last moment due to the undead state
     matchre SPELL_CAST_DONE ^You don't have a spell prepared\!
     matchre SPELL_CAST_DONE ^Your concentration slips for a moment\, and your spell is lost\.
     matchre SPELL_CAST_DONE ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre SPELL_CAST_DONE ^You wave your hand\.
     matchre SPELL_CAST_DONE ^You gesture\.
     matchre SPELL_CAST_DONE ^Focus the power of justice on whom\?
     matchre SPELL_CAST_DONE ^Your .+ emits a loud \*snap\* as it discharges
     matchre SPELL_CAST_DONE ^You roll your hands in an elliptical pattern in front of you
     matchre SPELL_CAST_DONE ^Please rephrase|^Sheathing|^What were
     matchre SPELL_CAST_DONE ^You draw your hand|^You step inside
    # if ("\b%CurrentSpell\b" = "HYH") then put cast male
     if matchre("%CurrentSpell", "\b(?i)(COL|Moonblade)\b") then
          {
               var COL NULL
               if ($Time.isKatambaUp = 1) then var COL Katamba
               if ($Time.isXibarUp = 1) then var COL Xibar
               if ($Time.isYavashUp = 1) then var COL Yavash
               pause 0.1
               if ("%COL" = "NULL") then
                    {
                         echo ** %CurrentSpell ERROR! NO MOONS UP!
                         goto SPELL_CAST_DONE
                    }
               send cast %COL
               var COL NULL
               matchwait 2
               goto SPELL_CAST_DONE
          }
     if (matchre("%CurrentSpell", "\b(?i)IOTS\b") || ("$preparedspell" = "Invocation of the Spheres")) then
          {
                    put cast %planet
                    pause 0.5
                    pause 0.3
                    put invoke circle
                    echo #################################
                    echo ** IOTS Active! Planet: %planet  Type: %bufftype
                    echo #################################
                    matchwait 10
                    goto SPELL_CAST_DONE
          }
     if (matchre("%CurrentSpell", "\b(?i)HW\b") || ("$preparedspell" = "Heal Wounds")) then
          {
                    var AREATOHEAL chest
                    action var wounds $1 when ^You have ((\b(?!no )\w+).+)
                    gosub HEALTH_CHECK
                    gosub IDHWHEAL
                    action remove ^You have ((\b(?!no )\w+).+)
                    put cast %AREATOHEAL
                    matchwait 10
                    goto SPELL_CAST_DONE
          }
     if (matchre("%CurrentSpell", "\b(?i)RITS\b") || ("$preparedspell" = "River in the Sky")) then
          {
                    put cast any
                    matchwait 10
                    goto SPELL_CAST_DONE
          }
    if (matchre("%CurrentSpell", "\b(?i)EF\b") || ("$preparedspell" = "Eylhaar's Feast")) then
          {
               if (%EF.Ready = 0) then
                    {
                         echo ** EF NOT READY YET - STILL ADDICTED
                         gosub RELEASE spell
                         gosub RELEASE_CAMB
                         return
                    }
               var EF.Ready 0
               if (($health < 96) && ($spirit > 60)) then
                    {
                         put cast vitality 7;-0.05 gesture
                         matchwait 20
                         goto SPELL_CAST_DONE
                    }
               if (($stamina < 92) && ($spirit > 60)) then
                    {
                         put cast fatigue 8;-0.05 gesture
                         matchwait 20
                         goto SPELL_CAST_DONE
                    }

               if ($spirit >= 60) then put cast attune 7;-0.05 gesture
               if (($spirit < 60) && ($spirit >= 50)) then put cast attune 2;-0.05 gesture
               if ($spirit < 50) then put cast attune 1;-0.05 gesture
               matchwait 20
               goto SPELL_CAST_DONE
          }
    if ("$preparedspell" = "Sanctify Pattern") then
          {
               gosub SANCTIFY_CHOOSE
               put -cast %Sanctify.Skill;-0.05 gesture
               matchwait 20
               goto SPELL_CAST_DONE
          }
     if ("$preparedspell" = "Benediction") then
          {
               send -cast %FAVOR.GOD;-0.05 gesture
               matchwait 20
               goto SPELL_CAST_DONE
          }
     if (matchre("%CurrentSpell", "\b(?i)MALEDICTION\b") || ("$preparedspell" = "Malediction")) then
          {
               var MALE defense
               random 1 2
               pause 0.001
               if (%r = 1) then var MALE offense
               if (%r = 2) then var MALE defense
               pause 0.01
               put cast %MALE
               matchwait 3
               goto SPELL_CAST_DONE
          }
     if (matchre("%CurrentSpell", "\b(?i)GS\b") || ("$preparedspell" = "Guardian Spirit")) then
          {
               put cast
               pause 7
               if matchre("$roomobjs", "(alfar|dastardly|senile|gracile|ethereal|tall|lean|slim|graceful|trim|alert|serene|delicate|slender|stoic|athletic|lithe|lissome|solemn|sedate|tranquil|wiry|svelte|imposing|savage) warrior") then
                    {
                         if (%Empath.Brawl = 0) then send command warrior to stance defense
                         if (%Empath.Brawl = 1) then send command warrior to stance offense
                         pause 0.5
                         if (%Empath.Brawl = 0) then send command warrior to behavior defensive
                         if (%Empath.Brawl = 1) then send command warrior to behavior aggressive
                    }
               goto SPELL_CAST_DONE
          }
     if (matchre("%CurrentSpell", "\b(?i)ETF\b") || ("$preparedspell" = "Ethereal Fissure")) then
          {
               if ($spellETF = 1) then
                    {
                         pause 0.1
                         pause 0.1
                         send close fissure
                         wait
                         pause 0.5
                         pause 0.3
                    }
               put cast %element
               matchwait 20
               goto SPELL_CAST_DONE
          }
     if ((matchre("%CurrentSpell", "\b(?i)SLS\b") && ("%SLS" != "NULL"))  || ("$preparedspell" = "Starlight Sphere")) then
          {
               send -cast %SLS;-0.05 point sphere at %Critter
               var SLS NULL
               matchwait 20
               goto SPELL_CAST_DONE
          }
     if (matchre("%CurrentSpell", "\b(EE|ALB|FR|USOL|NB)\b") || matchre("$preparedspell", "(Albreda's Balm|Electrostatic Eddy|Fire Rain|Universal Solvent|Nissa's Binding)")) then
          {
               send cast creature
               matchwait 4
               goto SPELL_CAST_DONE
          }
     if (matchre("$preparedspell", "Hydra Hex") || matchre("%buffs(%buff.tracker)", "HH")) then
          {
               send cast Male
               matchwait 3
               goto SPELL_CAST_DONE
          }
     if (("$preparedspell" = "Ignite") && matchre("$UC_WeaponType", "(BOW|SLINGS|XBOW|CROSSBOW)")) then
          {
               if ("%IGNITE.WEAPON" = "NULL") then gosub IGNITE_PREP
               if (!matchre("$righthand", "Empty") && !matchre("$righthand", "%IGNITE.WEAPON")) then
                    {
                         var savedWeapon $righthandnoun
                         gosub stowing
                         gosub GET %IGNITE.WEAPON
                    }
               if (("$righthand" = "Empty") && !matchre("$lefthand", "Empty")) then
                    {
                         var savedWeapon $lefthandnoun
                         gosub stowing
                         gosub GET %IGNITE.WEAPON
                    }
               pause 0.00001
               if !matchre("$righthand $lefthand", "%IGNITE.WEAPON") then gosub GET %IGNITE.WEAPON
               pause 0.00001
               put cast $righthandnoun
               wait
               pause 0.2
               pause 0.2
               gosub STOWIT %IGNITE.WEAPON
               if ("%savedWeapon" != "NULL") then
                    {
                         gosub stowing
                         gosub GET %savedWeapon
                    }
               goto SPELL_CAST_DONE
          }
     if ("$preparedspell" = "Ignite") then
          {
               pause 0.00001
               if !matchre("$righthand", "Empty") then put cast $righthandnoun
               if !matchre("$lefthand", "Empty") then put cast $lefthandnoun
               pause 0.2
               if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub stowing
               if (!matchre("$righthand $lefthand", "(?i)%WEAPON") && !matchre("$UC_WeaponType","BRAWL")) then gosub GET my %WEAPON
               goto SPELL_CAST_DONE
          }
     if matchre("$preparedspell", "(Resonance|Rutilor\'s Edge)") then
          {
               if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub stowing
               if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub GET my %WEAPON
               pause 0.00001
               pause 0.00001
               put cast %WEAPON
               pause 0.5
               if !matchre("$righthand $lefthand", "(?i)%WEAPON") then gosub stowing
               if (!matchre("$righthand $lefthand", "(?i)%WEAPON") && !matchre("$UC_WeaponType","BRAWL")) then gosub GET my %WEAPON
               goto SPELL_CAST_DONE
          }
     if (matchre("$preparedspell", "Blufmor Garaen") || matchre("%CurrentSpell", "\b(?i)BG\b")) then
          {
               send slap
               matchwait 3
               goto SPELL_CAST_DONE
          }
     if (matchre("$preparedspell", "Dragon's Breath") || matchre("%CurrentSpell", "\b(?i)DB\b")) then
          {
               send exhale
               matchwait 3
               goto SPELL_CAST_DONE
          }
     if (("$preparedspell" = "Avren Aevareae") || matchre("%CurrentSpell", "(AVA)") then
          {
               var AVA NULL
               if ($Time.isKatambaUp) then var AVA Katamba
               if ($Time.isXibarUp) then var AVA Xibar
               if ($Time.isYavashUp) then var AVA Yavash
               pause 0.1
               if ("%AVA" = "NULL") then
                    {
                         echo ** $preparedspell ERROR! NO MOONS UP!
                         goto BUFF_CAST_DONE
                    }
               send cast %AVA
               var AVA NULL
               matchwait 2
               goto BUFF_CAST_DONE
          }
     else send -cast;-0.05 gesture
     matchwait 20
     goto SPELL_CAST_DONE
SPELL_WAIT_TARGET:
     if ("$preparedspell" = "None") then return
     matchre RETURN ^You feel fully prepared to cast your spell\.
     matchre RETURN ^Your concentration slips for a moment\, and your spell is lost\.
     matchwait 20
SPELL_CAST_TARGET:
     if ("$preparedspell" = "None") then return
     var spelltarget %Critter
     var LOCATION SPELL_CAST_TARGET_1
     pause 0.0001
     pause 0.1
	goto SPELL_CAST_TARGET_1
SPELL_CAST_NECRO:
     if ("$preparedspell" = "None") then return
     var spelltarget $0
     var LOCATION SPELL_CAST_TARGET_1
     pause 0.0001
     SPELL_CAST_TARGET_1:
     matchre SPELL_CAST_NECRO ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RELEASE_CYCLIC ^Maintaining two cyclic spells at once is beyond your mental comprehension
     matchre SPELL_CAST_FAIL ^Your spell barely backfires\.|^Your spell backfires somewhat\.|^Your spell backfires\.|^Your spell hopelessly backfires\.|^Currently lacking the skill to complete the pattern, your spell fails completely\.|^The spell pattern resists the influx of unfocused mana\.  You are able to contain the backlash but doing so results in a splitting headache\.|^The spell pattern resists the influx of unfocused mana though you are able to channel the worst of the backlash into your nervous system\.|^The spell pattern resists the influx of unfocused mana though the backlash leaves you stunned\!|^The spell pattern resists the influx of unfocused mana, and a strange burning sensation backwashes from the spell pattern into your body\.
     matchre SPELL_CAST_DONE ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre SPELL_CAST_DONE ^You gesture\.
     matchre SPELL_CAST_DONE ^Focus the power of justice on whom\?
     matchre SPELL_CAST_CRITTER ^You can't cast .* yourself
     matchre SPELL_CAST_DONE ^You strain, but are too mentally fatigued
     matchre SPELL_CAST_DONE ^You don't have a spell prepared\!
     matchre SPELL_CAST_DONE ^Your .+ emits a loud \*snap\* as it discharges
     matchre SPELL_CAST_DONE ^Please rephrase|^Sheathing|^What were
     matchre SPELL_CAST_DONE ^Your target pattern dissipates because .+ is dead, but the main spell remains intact\.|^You strain, but are too mentally fatigued to finish the pattern, and it slips away\.|^You can't cast that at yourself\!|^You don't have a spell prepared\!|^Something in the area prevents your spell from working\.|Lacking any .* the spell fails\.|^You can't cast .+ on .+\!
     matchre SPELL_CAST_DONE ^Your concentration slips for a moment\, and your spell is lost\.
     put -cast %spelltarget;-0.05 gesture
     matchwait 9
     goto SPELL_CAST_DONE
#####
SANCTIFY_CHOOSE:
     var Sanctify.Skill utility
     random 1 4
     pause 0.00001
     if (%r = 1) then var Sanctify.Skill augmentation
     if (%r = 2) then var Sanctify.Skill debilitation
     if (%r = 3) then var Sanctify.Skill warding
     if (%r = 4) then var Sanctify.Skill utility
     return
##### NECRO CF CASTING
SPELL_WAIT_NECRO:
     var necrospellcount 0
     if ("$preparedspell" = "None") then return
     if (%spellPrepped = 1) then return
     eval temp count("%AimActions", "|")
SPELL_WAIT_NECRO_ACTIONS:
     pause 0.00001
     math necrospellcount add 1
     if (%spellPrepped = 1) then return
     if (%necrospellcount > %temp) then goto NECRO_WAIT_2
     pause 0.00001
     if (($monstercount > 0) && ($hidden = 0)) then
          {
               if (matchre("%AimActions(%necrospellcount)", "throw (.*)") then
                    {
                         var aimthrow $1
                         gosub GET_IT %aimthrow
                         if (!matchre("$lefthand", "%aimthrow") && !matchre("$righthand", "(?i)%WEAPON")) then
                              {
                                   put swap
                                   pause 0.3
                              }
                         gosub put %ThrowType left
                         gosub STOW %aimthrow
                    }
               if matchre("%AimActions(%necrospellcount)", "(?i)attack\b") then
                    {
                         if matchre("$righthand", "(?i)(shortbow|bow|crossbow|sling|slurbow|arbalest|longbow)") then
                              {
                                   gosub PUT attack left
                              }
                         else gosub PUT attack
                    }
               else put %AimActions(%necrospellcount)
          }
     pause 0.3
     pause 0.1
     pause 0.1
     if ($spelltime > 24) then return
     if (%spellPrepped = 1) then return
     goto SPELL_WAIT_NECRO_ACTIONS
NECRO_WAIT_2:
     if ($spelltime > 24) then return
     if (%spellPrepped = 1) then return
     if (%MAGIC.SNAP > 0) then
          {
               evalmath CastLast ($gametime - %CastTime)
               if (%CastTime >= %MAGIC.SNAP) then return
               goto NECRO_WAIT_2
          }
     if ($spelltime > 24) then return
     if (%spellPrepped = 1) then return
     matchre RETURN ^You feel fully prepared to cast your spell\.
     matchre RETURN ^Your concentration slips for a moment\, and your spell is lost\.
     matchwait 24
     return
SPELL_CAST_NOBACKFIRE:
     put #queue clear
     var Backfired 0
     var spellPrepped 0
     var spellExpired 0
     var noCharge 0
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     return
SPELL_CAST_DONE:
     put #queue clear
     if (%Backfired = 1) then goto SPELL_CAST_FAIL
     if ($UC_SmartSpells = 1) then
          {
               if (($%spelllearn.LearningRate < 1) && !matchre("%CurrentSchool", "CYCLIC") && (%InCombat = 1)) then
                    {
                         pause 0.1
                         pause 0.1
                         if (($%spelllearn.LearningRate < 1) && !matchre("%CurrentSchool", "CYCLIC") && (%InCombat = 1)) then gosub MANA_BUMP
                    }
          }
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if (matchre("$righthand", "(?i)Moonblade") || matchre("$lefthand", "(?i)Moonblade")) then
          {
               put break moonblade
               pause 0.4
               pause 0.2
          }
     var Backfired 0
     var cambCharged 0
     var spellPrepped 0
     var spellExpired 0
     var noCharge 0
     var MagicTM 0
     var TM.Target NULL
	put #var preparedSymbiosis 0
     if ($stunned) then waiteval (!$stunned)
     if (("$guild" = "Warrior Mage") && ($pathway = 1)) then
          {
               put path sense
               pause 0.3
               pause 0.2
               pause 0.1
               if (($charge < 9) || ($Summoning.LearningRate > 30)) then put pathway stop
          }
     if matchre("$righthand $lefthand", "(?i)apparatus") then
          {
               put drop apparatus
               pause 0.4
               pause 0.1
          }
     if (("%Temp.Right" != "NULL") && !matchre("$righthand", "%Temp.Right")) then gosub GET %Temp.Right
     if (("%Temp.Left" != "NULL") && !matchre("$lefthand", "%Temp.Left")) then gosub GET %Temp.Left
     var Temp.Right NULL
     var Temp.Left NULL
     if matchre("$guild", "Moon Mage") then
          {
               if matchre("%CurrentSpell", "(?i)SHADOWLING") then
                    {
                         echo *** CHECKING ROOM FOR SHADOWLING...
                         pause 0.2
                         if !matchre("$roomobjs", "(?i)(SHADOWLING|SHADOWCAT|SHADOWPANTHER|SHADOWTABBY)") then
                              {
                                   pause 0.4
                                   put look
                                   pause 0.5
                                   pause 0.4
                              }
                         if !matchre("$roomobjs", "(?i)(SHADOWLING|SHADOWCAT|SHADOWPANTHER|SHADOWTABBY)") then
                              {
                                   pause 0.8
                                   put look
                                   pause 0.5
                                   pause 0.4
                              }
                         if matchre("$roomobjs", "(?i)(SHADOWLING|SHADOWCAT|SHADOWPANTHER|SHADOWTABBY)") then
                              {
                                   send invoke $1
                                   var CurrentSpell NULL
                                   pause 0.3
                                   goto BUFF_CAST_DONE_2
                              }
                         pause 0.1
                         put look
                         pause 0.1
                         pause 0.00001
                         if matchre("$roomobjs", "(?i)(SHADOWLING|SHADOWCAT|SHADOWPANTHER|SHADOWTABBY)") then
                              {
                                   send invoke $1
                                   var CurrentSpell NULL
                                   pause 0.3
                                   goto BUFF_CAST_DONE_2
                              }
                    }
          }
     return
SPELL_CAST_CRITTER:
     pause 0.1
     put cast %Critter
     pause 0.1
SPELL_CAST_NOTARGET:
     var noTarget 1
     echo *** NO SPELL TARGET
     return
SPELL_CAST_FAIL:
     gosub RELEASE spell
     gosub RELEASE_CAMB
     if ((%Backfired = 1) && ($UC_SmartSpells = 1)) then
          {
               var CurrentBackfire %CurrentSpell
               gosub SPELL_BACKFIRED
               var Backfired 0
          }
     if ((%Backfired = 1) && ($UC_SmartSpells = 0)) then
          {
               echo ##########################
               echo *** BACKFIRED %spellID !
               echo ##########################
               put #echo >Log #FC0FC0 ** BACKFIRED %spellID !
               var Backfired 0
          }
     if (("$guild" = "Warrior Mage") && ($pathway = 1)) then put pathway stop
     var noCharge 1
     var cambCharged 0
     var spellPrepped 0
SPELL_CAST_RETURN:
     var spellExpired 0
     var spellPrepped 0
     return
CAST:
     var spellPrepped 0
     var location CAST_1
     var todo $0
     CAST_1:
     pause 0.00001
     matchre CAST_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre CALMED ^Strangely\, you don\'t feel like fighting right now\.
     matchre CAST_2 ^You can't cast that at yourself\!
     matchre RELEASE_CYCLIC ^Maintaining two cyclic spells at once is beyond your mental comprehension
     matchre TARGET_RELEASE ^You don't have a spell prepared\!
     matchre TARGET_RELEASE ^.* is already dead, so that's a bit pointless\.
     matchre TARGET_RELEASE ^Your secondary spell pattern dissipates because your target is dead, but the main spell remains intact\.
     matchre TARGET_RELEASE ^Your target pattern dissipates because the .* is dead\, but the main spell remains intact\.
     matchre RETURN ^You gesture
     matchre RETURN ^Focus the power of justice on whom\?
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RETURN ^You raise your hand in an imaginary
     matchre RETURN ^You don't have a spell prepared\!
     matchre RETURN ^Your spell pattern collapses
     matchre RETURN ^With a wave of your hand,
     matchre RETURN ^Your target pattern dissipates
     matchre RETURN ^You wave your hand\.
     matchre RETURN ^You place your hands on your temples
     matchre RETURN ^A newfound fluidity of your mind
     matchre RETURN ^Your heart skips a beat as your spell
     matchre RETURN ^With a flick of your wrist,
     matchre RETURN ^Your secondary spell pattern dissipates
     matchre RETURN ^You can't cast .+ on yourself\!
     matchre RETURN ^You make a holy gesture
     matchre RETURN ^You raise your palms and face to the heavens
     matchre RETURN ^I could not find what you were referring to\.
     matchre RETURN ^You have difficulty manipulating the mana streams, causing the spell pattern to collapse at the last moment\.
     put cast %todo
	put #var preparedSymbiosis 0
     matchwait 20
     put #echo >$Log Crimson $datetime *** MISSING MATCH IN CAST! - %todo (ubercombat.inc) ***
     put #log $datetime MISSING MATCH IN CAST : %todo (ubercombat.inc)
     return
CAMBRINTH_SPELL:
     var ChargeMana $1
     if ("%BUFFING" != "ON") then
          {
               if (($UC_NoCambTM = 1) && matchre("%CurrentSchool", "(?i)(TARGET|DEBILITATION)")) then return
               if (($UC_NoCambTM = 1) && matchre("%CurrentSpell", "(?i)(%TM.Spell.List|%Debil.Spell.List)")) then return
               if ($UC_SmartSpells = 0) then var ChargeMana $UC_CambMana
               if ("%ChargeMana.%CurrentSchool" = "NULL") then return
          }
     var cambCount 0
     # if ("%BUFFING" = "ON") && ($Arcana.Ranks < 200) then return
     if (((%CambrinthCharge != 0) && ($Arcana.LearningRate > 31) && ($Attunement.LearningRate < 31)) || (matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && (%CambrinthCharge != 0))) then goto HARNESS_SPELL
     if (($Arcana.Ranks < 209) && !matchre("$lefthand", "Empty") && !matchre("$UC_WeaponType", "OFFHAND")) then gosub STOWIT left
     if (($Arcana.Ranks < 209) && !matchre("$righthand", "Empty") && matchre("$UC_WeaponType", "OFFHAND")) then gosub STOWIT right
     if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)")  && ($Arcana.Ranks < 209)) then gosub REMOVE my $UC_Cambrinth
CAMBRINTH_SPELL1:
     if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ("$preparedspell" != "None") && (%CambrinthCharge > %cambCount) && (%cambCharged = 0)) then
          {
               if (matchre("$guild", "(Ranger|Trader|Paladin)") && ($mana < 80)) then pause
               gosub CHARGE my $UC_Cambrinth %ChargeMana
               math cambCount add 1
               if (%CambrinthCharge >= %cambCount) then var cambCharged 1
               goto CAMBRINTH_SPELL1
          }
     if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ("$preparedspell" != "None")) then
          {
               if (matchre("(?i)%Cyclic.Spell.List", "\b%CurrentSpell\b") && (%DedicatedCamb = 1) && (%RawChanneling = 0)) then gosub INVOKE my $UC_Cambrinth cyclic
               else gosub INVOKE my $UC_Cambrinth spell
          }
     if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ($Arcana.Ranks < 209)) then gosub WEAR $UC_Cambrinth
     if matchre("$righthand $lefthand", "$UC_Cambrinth") then gosub WEAR $UC_Cambrinth
     if (%InCombat = 1) then
          {
               if (!matchre("$righthand $lefthand", "(?i)%WEAPON") && !matchre("(?i)%WEAPON", "(?i)($charactername|NULL|OFF|^%|^\s*$)")) then gosub WIELD %WEAPON
          }
     return
HARNESS_SPELL:
     if (%ChargeMana = 0) then return
     if matchre("%Cyclic.Spell.List", "\b(?i)%CurrentSpell\b") then return
     if ("%ChargeMana.%CurrentSchool" = "NULL") then return
     if (("$preparedspell" != "None") && (%CambrinthCharge > %cambCount) && (%cambCharged = 0)) then
          {
               gosub HARNESS %ChargeMana
               math cambCount add 1
               if (%CambrinthCharge = %cambCount) then var cambCharged 1
               goto HARNESS_SPELL
          }
     return
######################
# CLERIC OM ORB
OM_SETUP:
OM_CHECK:
     var buff.tracker 0
     var OMTracker 0
     var Backfired 0
     var orbcheck 0
     var OrbFull 0
     var infusion 1
     echo #####################
     echo *** OM ACTIVE - CHECKING ORB
     echo #####################
     if !def(SpellTimer.OsrelMeraud.active) then put #var SpellTimer.OsrelMeraud.active 0
     if !def(SpellTimer.OsrelMeraud.duration) then put #var SpellTimer.OsrelMeraud.duration 0
     pause 0.00001
     if (($Utility.Ranks < 250) && (%UtilityMastery = 0)) then goto OM_ERROR
     if (($Utility.Ranks < 215) && (%UtilityMastery = 1)) then goto OM_ERROR
     if ($SpellTimer.OsrelMeraud.active = 0) then gosub FIND_ORB
     if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
     var OMBuffs %OM.Buffs
     eval OMBuffs replacere("%OMBuffs", "\|+", "|")
     eval OMBuffs replacere("%OMBuffs", "\|$", "")
     eval OMBuffs replacere("%OMBuffs", "^|", "")
     var OMBuff
     var ORBCheck 0
     var OMBuffshort
     var OMTracker 0
     var OMChecked 1
     var spellAuspice 0
     var spellBenediction 0
     var spellBless 0
     var spellCentering 0
     var spellDivineRadiance 0
     var spellGlythtidesGift 0
     var spellHalo 0
     var spellMinorPhysicalProtection 0
     var spellMajorPhysicalProtection 0
     var spellMurrulasFlames 0
     var spellProtectionfromEvil 0
     var spellSanyuLyba 0
     var spellShieldofLight 0
     var spellSoulShield 0
     var spellPersistenceofMana 0
     pause 0.0001
     ##### SETTING BUFFS TO APPLY TO ORB
     if matchre("%OMBuffs", "(?i)(AUSPICE|AUSP|AUSPIC)") then var spellAuspice 1
     if matchre("%OMBuffs", "(?i)(BENEDICTION|BENE|BENEDIC)") then var spellBenediction 1
     if matchre("%OMBuffs", "(?i)(BLESS|BLES|BLE)") then var spellBless 1
     if matchre("%OMBuffs", "(?i)(CENTERING|CENTER|CENT)") then var spellCentering 1
     if matchre("%OMBuffs", "(?i)(DR|DIVINERADIANCE|DIVINE|DIVINE RADIANCE)") then var spellDivineRadiance 1
     if matchre("%OMBuffs", "(?i)(GG|glythtideSGIFT|GLYTH|glythtide)") then var spellGlythtidesGift 1
     if matchre("%OMBuffs", "(?i)(HALO|HAL)") then var spellHalo 1
     if matchre("%OMBuffs", "(?i)(MAPP|MAJORPHYSICALPROTECTION|MAJORPHYSICAL|MAJOR)") then var spellMajorPhysicalProtection 1
     if matchre("%OMBuffs", "(?i)(MAPP|MAJORPHYSICALPROTECTION|MAJORPHYSICAL|MAJOR)") then var spellMajorPhysicalProtection 1
     if matchre("%OMBuffs", "(?i)(MPP|MINOR|MINORPHYSICALPROTECTION)") then var spellMinorPhysicalProtection 1
     if matchre("%OMBuffs", "(?i)(MF|MURRULASFLAMES|MURRULA)") then var spellMurrulasFlames 1
     if matchre("%OMBuffs", "(?i)(PFE|PROTECTION FROM EVIL|PROTECTION)") then var spellProtectionfromEvil 1
     if matchre("%OMBuffs", "(?i)(SL|SANYULYBA|SANYU)") then var spellSanyuLyba 1
     if matchre("%OMBuffs", "(?i)(SOL|SHIELDOFLIGHT|SHIELD OF)") then var spellShieldofLight 1
     if matchre("%OMBuffs", "(?i)(SOS|SOULSHIELD|SOUL SHIELD)") then var spellSoulShield 1
     if matchre("%OMBuffs", "(?i)(POM|PERSISTENCE|PERSISTENCEOFMANA)") then var spellPersistenceofMana 1
     ##### CHECKING BUFFS ALREADY ACTIVE IN ORB
     if ((%spellAuspice = 1) && ($SpellTimer.Auspice.duration != 999))) then
          {
          var OMBuffshort %OMBuffshort|Auspice
          var OMBuff %OMBuff|Auspice
          }
     if ((%spellBenediction = 1) && ($SpellTimer.Benediction.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|Benediction
          var OMBuff %OMBuff|Benediction
          }
     if ((%spellBless = 1) && ($SpellTimer.Bless.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|Bless
          var OMBuff %OMBuff|Bless
          }
     if ((%spellCentering = 1) && ($SpellTimer.Centering.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|Centering
          var OMBuff %OMBuff|Centering
          }
     if ((%spellDivineRadiance = 1) && ($SpellTimer.DivineRadiance.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|DR
          var OMBuff %OMBuff|DivineRadiance
          }
     if ((%spellGlythtidesGift = 1) && ($SpellTimer.GlythtidesGift.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|GG
          var OMBuff %OMBuff|GlythtidesGift
          }
     if ((%spellHalo = 1) && ($SpellTimer.Halo.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|Halo
          var OMBuff %OMBuff|Halo
          }
     if ((%spellMajorPhysicalProtection = 1) && ($SpellTimer.MajorPhysicalProtection.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|MAPP
          var OMBuff %OMBuff|MajorPhysicalProtection
          }
     if ((%spellMinorPhysicalProtection = 1) && ($SpellTimer.MinorPhysicalProtection.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|MPP
          var OMBuff %OMBuff|MinorPhysicalProtection
          }
     if ((%spellMurrulasFlames = 1) && ($SpellTimer.MurrulasFlames.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|MF
          var OMBuff %OMBuff|MurrulasFlames
          }
     if ((%spellProtectionfromEvil = 1) && ($SpellTimer.ProtectionfromEvil.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|PFE
          var OMBuff %OMBuff|ProtectionfromEvil
          }
     if ((%spellSanyuLyba = 1) && ($SpellTimer.SanyuLyba.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|SL
          var OMBuff %OMBuff|SanyuLyba
          }
     if ((%spellShieldofLight = 1) && ($SpellTimer.ShieldofLight.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|SOL
          var OMBuff %OMBuff|ShieldofLight
          }
     if ((%spellSoulShield = 1) && ($SpellTimer.SoulShield.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|SS
          var OMBuff %OMBuff|SoulShield
          }
     if ((%spellPersistenceofMana = 1) && ($SpellTimer.PersistenceofMana.duration != 999)) then
          {
          var OMBuffshort %OMBuffshort|POM
          var OMBuff %OMBuff|PersistenceofMana
          }
     pause 0.0001
     eval OMBuff replacere("%OMBuff", "\bOM\b", "")
     eval OMBuff replacere("%OMBuff", "\|+", "|")
     eval OMBuff replacere("%OMBuff", "\|$", "")
     eval OMBuffshort replacere("%OMBuffshort", "\bOM\b", "")
     eval OMBuffshort replacere("%OMBuffshort", "\|+", "|")
     eval OMBuffshort replacere("%OMBuffshort", "\|$", "")
     echo *** OM BUFFS NEEDED: %OMBuffshort
     gosub ORB_BUFF_CHECK
     if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 70)) then
          {
               gosub CHARGE_ORB %OM.Mana
               # if ($mana < 50) then echo *** Waiting on Mana.
               # if ($mana < 50) then waiteval ($mana > 70)
          }
     var buff.tracker 0
     var OMTracker 0
     return
OM_ERROR:
     echo
     echo *** NOT ENOUGH UTILITY TO INFUSE OM ORB!!!
     echo *** TRAIN UP YOUR SKILLS SOME MORE!!
     echo *** REMOVING OM FROM YOUR BUFFS!
     echo *** Need ~250 Utility Ranks to infuse
     echo *** OR ~220 WITH UTILITY MASTERY FEAT
     echo
     var OM.Active 0
     put release orb
     pause 0.2
     pause 0.2
     eval buffabbrevs replacere("%buffabbrevs", "\bOM\b", "")
     eval abbrevs replacere("%abbrevs", "\bOM\b", "")
     eval buffs replacere("%buffs", "\bOsrelMeraud\b", "")
     eval buffs replacere("%buffs", "\|+", "|")
     eval buffs replacere("%buffs", "\|$", "")
     eval buffabbrevs replacere("%buffabbrevs", "\|+", "|")
     eval bbuffabbrevs replacere("%buffabbrevs", "\|$", "")
     math buff.count subtract 1
     echo
     echo ########################
     echo *** Buffs: %buffs
     echo ########################
     echo
     return
##### OM ORB BUFFING
##### SORTING THROUGH LIST OF BUFFS AND CASTING NON-ACTIVE BUFFS ON ORB
ORB_BUFF_CHECK:
     action var OrbFull 1 when you realize that you are not skilled enough to harness this combination of spells into the magic
     eval OMBuffcount count("%OMBuff", "|")
     evalmath OMBuffcount (%OMBuffcount + 1)
ORB_BUFF_CHECK_1:
     if ($mana < 25) then
          {
               echo
               echo *** LOW ON MANA! SKIPPING..
               echo
               var OMTracker 0
               return
          }
     if (($SpellTimer.%OMBuff(%OMTracker).active = 0) && ($SpellTimer.%OMBuff(%OMTracker).duration != 999)) then gosub CAST_ORB
     if (%Backfired = 1) then gosub OM_BACKFIRE
     if (%OrbFull = 1) then return
     if ((%OMTracker > %OMBuffcount) || (%buff.tracker > %buff.count)) then
          {
               action remove you realize that you are not skilled enough to harness this combination of spells into the magic
               var OMTracker 0
               return
          }
     goto ORB_NEXT
ORB_NEXT:
     math OMTracker add 1
     goto ORB_BUFF_CHECK_1
#### CASTING BUFFS ON ORB
CAST_ORB:
     var OM.Active 1
     if (matchre("%OMBuffshort(%OMTracker)", "(?i)OM") && !matchre("%OMBuffshort(%OMTracker)", "(?i)POM") && ($SpellTimer.OsrelMeraud.active = 0)) then gosub ORB_SUCCESS_1
CAST_ORB_2:
     var CurrentBuff %OMBuffshort(%OMTracker)
     if matchre("%OMBuffshort(%OMTracker)", "(?i)%abbrevs")  then
          {
               if matchre("%command","(?i)SETUP") then goto OM_START_DISCERN
               if !def(Mana.%OMBuffshort(%OMTracker)) then goto OM_START_DISCERN
               if matchre($Mana.%OMBuffshort(%OMTracker), "%spellCMax") then goto OM_START_DISCERN
               if def(Mana.%OMBuffshort(%OMTracker)) && !matchre("%command","(?i)SETUP") then goto OM_START_KNOWN
          }
          goto OM_START_3
OM_START_KNOWN:
     if ((%CurrentBuffMana != 0) && (%CurrentBuffMana != $Mana.%OMBuffshort(%OMTracker))) then put #var Mana.%OMBuffshort(%OMTracker) %CurrentBuffMana
     if (%CurrentBuffMana = 0) then var CurrentBuffMana $Mana.%OMBuffshort(%OMTracker)
     if ($Mana.%OMBuffshort(%OMTracker) = 0) then goto OM_START_DISCERN
     echo **** CASTING: %OMBuff(%OMTracker) @ $Mana.%OMBuffshort(%OMTracker) Mana
     gosub ORB_PREP %OMBuffshort(%OMTracker) $Mana.%OMBuffshort(%OMTracker)
     goto OM_START_3
OM_START_DISCERN:
     if (%Backfired = 1) then goto OM_START_KNOWN_2
     if ((%CurrentBuffMana != 0) && (%CurrentBuffMana != $Mana.%OMBuffshort(%OMTracker))) then put #var Mana.%OMBuffshort(%OMTracker) %CurrentBuffMana
     echo *** Checking Optimal Cast Mana for %OMBuffshort(%OMTracker)
     gosub SPELLMATH %OMBuffshort(%OMTracker)
     if (%NOCAST) then goto OM_START_3
     put #var Mana.%OMBuffshort(%OMTracker) %spellCMax
     put #var Camb.%OMBuffshort(%OMTracker) %spellResplit
     var CurrentBuffMana $Mana.%OMBuffshort(%OMTracker)
     echo ############################
     echo *** SETTING %OMBuffshort(%OMTracker) spell to %spellCMax Mana
     echo *** SETTING %OMBuffshort(%OMTracker) cambrinth to %spellResplit Mana
     echo ############################
     # if ($Mana.%OMBuff(%OMTracker) > 100) then put #var Mana.%OMBuff(%OMTracker) 100
OM_START_KNOWN_2:
     if (%Backfired = 0) then var CurrentBuffMana $Mana.%OMBuffshort(%OMTracker)
     if ((%CurrentBuffMana != 0) && (%CurrentBuffMana != $Mana.%OMBuffshort(%OMTracker))) then put #var Mana.%OMBuffshort(%OMTracker) %CurrentBuffMana
     if ($Mana.%OMBuffshort(%OMTracker) > 100) then put #var Mana.%OMBuffshort(%OMTracker) 100
     #var spellMANA $Mana.%OMBuff(%OMTracker)
     var Backfired 0
     echo **** CASTING: %OMBuffshort(%OMTracker) @ $Mana.%OMBuffshort(%OMTracker) Mana
     if (%Backfired = 0) then var CurrentBuffMana $Mana.%OMBuffshort(%OMTracker)
     gosub ORB_PREP %OMBuffshort(%OMTracker) $Mana.%OMBuffshort(%OMTracker)
OM_START_3:
     if !matchre("%OMBuffshort(%OMTracker)", ("(?i)%abbrevs")) then
          {
               echo
               echo ** %OMBuffshort(%OMTracker) Spell is not known!!
               echo ** Removing from buffs list
               echo
               eval OMREMOVE toupper("%buffs(%buff.tracker)")
               eval OMBuffshort(%OMTracker) replacere("%OMBuffshort(%OMTracker)", "%OMREMOVE", "")
               eval OMBuffshort(%OMTracker) replacere("%OMBuffshort(%OMTracker)", "\|+", "|")
               eval OMBuffshort(%OMTracker) replacere("%OMBuffshort(%OMTracker)", "\|$", "")
               eval OMBuffs replacere("%OMBuffs", "%OMREMOVE", "")
               eval OMBuffs replacere("%OMBuffs", "\|+", "|")
               eval OMBuffs replacere("%OMBuffs", "\|$", "")
               var NOCAST 0
          }
     pause 0.1
     goto CAST_ORB_DONE
CAST_ORB_DONE:
     gosub RemoveDuplicatesFromArray %buffs %OMBuffshort(%OMTracker)
     var SETUP 0
     var NOCAST 0
     var Backfired 0
     var spellPrepped 0
     var spellExpired 0
     return
ORB_PREP:
     delay 0.0001
     var buffPrep $1 %CurrentBuffMana
     ORB_PREP_1:
     delay 0.0001
     var spellID %buffPrep
     gosub PREPARE %buffPrep
     gosub SPELL_WAIT_ORB
     return
SPELL_WAIT_ORB:
     if ("$preparedspell" = "None") then return
     if ($UC_CambMana < 1) then put #var UC_CambMana 1
     if matchre("%OMBuffshort(%OMTracker)", ("%Ritual.Spell.List")) then gosub RITUAL
     # if matchre("$preparedspell" = "Persistence of Mana|Murrula's Flames") then gosub RITUAL
     if (($Arcana.LearningRate < 35) && !matchre("%OMBuffshort(%OMTracker)", ("%Ritual.Spell.List"))) then
          {
               if (($Arcana.Ranks < 205) && !matchre("$lefthand", "Empty") && !matchre("$UC_WeaponType", "OFFHAND")) then gosub STOW $lefthandnoun
               if (($Arcana.Ranks < 205) && !matchre("$righthand", "Empty") && matchre("$UC_WeaponType", "OFFHAND")) then gosub STOW $righthandnoun
               if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ($Arcana.Ranks < 200)) then gosub REMOVE my $UC_Cambrinth
               if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ("$preparedspell" != "None") && (%CambrinthCharge > 0) && (%cambCharged = 0)) then
                    {
                         if (%noCharge = 0) then gosub CHARGE my $UC_Cambrinth $UC_CambMana
                         if (%CambrinthCharge = 1) then var cambCharged 1
                    }
               if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ("$preparedspell" != "None") && (%CambrinthCharge > 1) && (%cambCharged = 0)) then
                    {
                         if (%noCharge = 0) then gosub CHARGE my $UC_Cambrinth $UC_CambMana
                         if (%CambrinthCharge = 2) then var cambCharged 1
                    }
               if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ("$preparedspell" != "None") && (%CambrinthCharge > 2) && (%cambCharged = 0)) then
                    {
                         if (%noCharge = 0) then gosub CHARGE my $UC_Cambrinth $UC_CambMana
                         if (%CambrinthCharge > 2) then var cambCharged 1
                    }
               if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ("$preparedspell" != "None") &&( %CambrinthCharge != 0)) then gosub INVOKE my $UC_Cambrinth spell
               if (!matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") && ($Arcana.Ranks < 200)) then gosub WEAR $UC_Cambrinth
          }
     if matchre("$righthand $lefthand", "$UC_Cambrinth") then gosub WEAR $UC_Cambrinth
     if ("$preparedspell" != "None") then
          {
               if (%spellPrepped = 1) then gosub ORB_CAST
               else gosub ORB_WAIT
          }
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     return
ORB_WAIT:
     if (%spellPrepped = 1) then goto ORB_CAST
     matchre ORB_CAST ^You feel fully prepared to cast your spell\.
     matchre ORB_CAST_FAIL ^Your concentration slips for a moment\, and your spell is lost\.
     matchwait 25
ORB_CAST:
     var LOCATION ORB_CAST_1
     pause 0.0001
ORB_CAST_1:
     # debug 5
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre ORB_CAST_FAIL ^Your spell.*backfires
     matchre ORB_CAST_FAIL ^You strain\, but are too mentally fatigued
     matchre ORB_CAST_FAIL ^Your spell barely backfires\.|^Your spell backfires somewhat\.|^Your spell backfires\.|^Your spell hopelessly backfires\.|^Currently lacking the skill to complete the pattern, your spell fails completely\.|^Your target pattern dissipates because .+ is dead, but the main spell remains intact\.|^You strain, but are too mentally fatigued to finish the pattern, and it slips away\.|^You can't cast that at yourself\!|^You don't have a spell prepared\!|^You can't cast .+ on .+\!|^The spell pattern resists the influx of unfocused mana\.  You are able to contain the backlash but doing so results in a splitting headache\.|^The spell pattern resists the influx of unfocused mana though you are able to channel the worst of the backlash into your nervous system\.|^The spell pattern resists the influx of unfocused mana though the backlash leaves you stunned\!|^The spell pattern resists the influx of unfocused mana, and a strange burning sensation backwashes from the spell pattern into your body\.|^Something in the area prevents your spell from working\.
     matchre ORB_CAST_DONE ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre ORB_CAST_DONE ^You sense a tugging sensation from the center of the orb
     matchre ORB_CAST_DONE ^You don't have a spell prepared\!
     matchre ORB_CAST_DONE ^Your concentration slips for a moment\, and your spell is lost\.
     matchre ORB_CAST_DONE ^You wave your hand\.
     matchre ORB_CAST_DONE ^You gesture\.
     matchre ORB_CAST_DONE ^Focus the power of justice on whom\?
     if ("$preparedspell" = "Sanctify Pattern") then
          {
               gosub SANCTIFY_CHOOSE
               put -cast %Sanctify.Skill;-0.05 gesture
               matchwait 5
               goto ORB_CAST_DONE
          }
     if (%OrbFull = 0) then put -touch my orb;-0.05 cast
     if (%OrbFull = 1) then put -cast;-0.05 gesture
     matchwait 3
ORB_CAST_FAIL:
     gosub RELEASE spell
     gosub RELEASE_CAMB
     var spellPrepped 0
     math OMTracker subtract 1
     math buff.tracker subtract 1
     if ((%Backfired = 1) && ($UC_SmartSpells = 1)) then
          {
               var CurrentBackfire %OMBuffshort(%OMTracker)
               gosub OM_BACKFIRED
               var Backfired 0
          }
     if ((%Backfired = 1) && ($UC_SmartSpells = 0)) then
          {
               echo #######################
               echo *** BACKFIRED %OMBuffshort(%OMTracker) !
               echo #######################
               put #echo >Log #FC0FC0 ** BACKFIRED %OMBuffshort(%OMTracker) !
          }
     if (%ORBCheck > 2) then goto ORB_CAST_DONE
     goto ORB_BUFF_CHECK
ORB_CAST_DONE:
     # debug 0
     math OMTracker add 1
     math buff.tracker add 1
     put #queue clear
     var Backfired 0
     var ORBCheck 0
     var spellPrepped 0
     var spellExpired 0
     var cambCharged 0
     var noCharge 0
     if ($stunned) then waiteval (!$stunned)
     pause 0.00001
     return
FIND_ORB:
     pause 0.0001
     if ($SpellTimer.OsrelMeraud.active = 1) then return
     gosub GET_ORB %FavorOrb
     pause 0.0001
     if ($SpellTimer.OsrelMeraud.active = 1) then return
     if !matchre("($lefthand|$righthand)", "orb") then goto NO_ORB
     if matchre("($lefthand|$righthand)", "orb") then goto ORB_SUCCESS
     return
GET_ORB:
     delay 0.0001
     if ($SpellTimer.OsrelMeraud.active = 1) then return
     var get $0
     GET_ORB_1:
     var LOCATION GET_ORB_1
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^You struggle with .* great weight but can't quite lift it\!
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre HOLD_ORB ^But that is already in your inventory\.
     matchre GET_ORB_2 ^Get what\?
     matchre GET_ORB_2 ^I could not find what you were referring to\.
     matchre GET_ORB_2 ^What were you referring to\?
     matchre RETURN ^You (?:get|grab|pick|pull|push|twist|slip|slide|sling|carefully|are) .*(?:\.|\!|\?)?
     matchre RETURN ^As best it can\, .* moves in your direction\.
     put get my %get orb
     matchwait 15
     return
GET_ORB_2:
     var LOCATION GET_ORB_1
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^You struggle with .* great weight but can't quite lift it\!
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre HOLD_ORB ^But that is already in your inventory\.
     matchre RETURN ^Get what\?
     matchre RETURN ^I could not find what you were referring to\.
     matchre RETURN ^What were you referring to\?
     matchre RETURN ^You (?:get|grab|pick|pull|push|twist|slip|slide|sling|carefully|are) .*(?:\.|\!|\?)?
     matchre RETURN ^As best it can\, .* moves in your direction\.
     put get my %get orb from my watery portal
     matchwait 15
     return
HOLD_ORB:
     var LOCATION HOLD_ORB
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^You struggle with .* great weight but can't quite lift it\!
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre NO_ORB ^But that is already in your inventory\.
     matchre NO_ORB ^Get what\?
     matchre NO_ORB ^I could not find what you were referring to\.
     matchre NO_ORB ^What were you referring to\?
     matchre RETURN ^You (?:get|grab|pick|pull|push|twist|slip|slide|sling|carefully|are) .*(?:\.|\!|\?)?
     matchre RETURN ^As best it can\, .* moves in your direction\.
     put hold my %get orb
     matchwait 15
     return
NO_ORB:
     if (%orbcheck = 0) then
          {
               gosub GET_FAVOR meraud
               var orbcheck 1
               goto FIND_ORB
          }
     echo
     echo **** ERROR!!! NO ORB FOUND FOR OSREL MERAUD SPELL!
     echo **** PICK UP A MERAUD FAVOR ORB!!
     echo
     put #echo >Log Crimson *** Missing Orb for Osrel MERAUD!!
     put #log *** Missing Orb for Osrel MERAUD!!
     eval buffabbrevs replacere("%buffabbrevs", "\bOM\b", "")
     eval abbrevs replacere("%abbrevs", "\bOM\b", "")
     eval buffs replacere("%buffs", "\bOsrelMeraud\b", "")
     eval buffs replacere("%buffs", "\|+", "|")
     eval buffs replacere("%buffs", "\|$", "")
     eval buffabbrevs replacere("%buffabbrevs", "\|+", "|")
     eval bbuffabbrevs replacere("%buffabbrevs", "\|$", "")
     math buff.count subtract 1
     return
ORB_SUCCESS:
     pause 0.2
     echo
     echo **** SUCCESS! FOUND ORB!
     echo **** PREPARING TO CAST OM ON ORB
     echo
ORB_SUCCESS_1:
     if ($SpellTimer.OsrelMeraud.active = 1) then return
     pause 0.1
     gosub PREPARE OM %OM.Mana
     matchre OM_ORB ^You feel fully prepared to cast your spell\.
     matchre ORB_SUCCESS ^Your concentration slips for a moment\, and your spell is lost\.
     matchwait 26
OM_ORB:
     pause 0.0001
     put cast my orb
     pause
     pause 0.5
     if matchre("$righthand", "orb") then goto ORB_SUCCESS
     if matchre("$lefthand", "orb") then goto ORB_SUCCESS
     return
##############################################################################################################################################
#### SPELL CASTING
PREP_STOP_PLAY:
     send stop play
     pause 0.1
     pause 0.0001
     goto PREPARE_1
PREPARE:
     action (magic) on
     var spellExpired 0
     var prepare $0
     var spellID %prepare
     var LOCATION PREPARE_1
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.0001
     PREPARE_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre PREP_STOP_PLAY ^You should stop playing
     matchre SPELL_CAST_RETURN ^But you're already
     matchre SPELL_CAST_RETURN ^Something in the area interferes
     matchre SPELL_CAST_RETURN ^With a .+ to your voice\,
     matchre SPELL_CAST_RETURN ^With a resounding \"POP\"
     matchre SPELL_CAST_RETURN ^Turning your focus solemnly inward
     matchre SPELL_CAST_RETURN ^You are already preparing the .* spell\!
     matchre SPELL_CAST_RETURN ^Slow, rich tones form a somber introduction
     matchre SPELL_CAST_RETURN ^But you've already prepared the .* symbiosis\!
     matchre SPELL_CAST_RETURN ^You begin chanting .* to invoke the .* spell\.
     matchre SPELL_CAST_RETURN ^Images of streaking stars falling from the heavens
     matchre SPELL_CAST_RETURN ^You mutter .* to yourself while preparing the .* spell\.
     matchre SPELL_CAST_RETURN ^With .* movements you prepare your body for the .* spell\.
     matchre SPELL_CAST_RETURN ^A strong wind swirls around you as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^You raise your .* skyward\, chanting the .* of the .* spell\.
     matchre SPELL_CAST_RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre SPELL_CAST_RETURN ^You trace a .* sigil in the air, shaping the pattern of the .* spell\.
     matchre SPELL_CAST_RETURN ^You whistle an intricate sequence of notes as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^Shadow and light collide wildly around you as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^The wailing of lost souls accompanies your preparations of the .* spell\.
     matchre SPELL_CAST_RETURN ^You rock back and forth, humming tunelessly as you invoke the .* spell\.
     matchre SPELL_CAST_RETURN ^The wailing of lost souls accompanies your preparations of the .* spell\.
     matchre SPELL_CAST_RETURN ^Your eyes darken to black as a starless night as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^You close your eyes and breathe deeply, gathering energy for the .* spell\.
     matchre SPELL_CAST_RETURN ^A soft breeze surrounds your body as you confidently prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^Your eyes darken to black as a starless night as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^Light withdraws from around you as you speak arcane words for the .* spell\.
     matchre SPELL_CAST_RETURN ^You trace a geometric sigil in the air, shaping the pattern of the .* spell\.
     matchre SPELL_CAST_RETURN ^Tiny tendrils of lightning jolt between your hands as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^Low, hummed tones form a soft backdrop for the opening notes of the .* enchante\.
     matchre SPELL_CAST_RETURN ^Heatless orange flames blaze between your fingertips as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^Throwing your head back, you release a savage roar and growl words for the .* spell\.
     matchre SPELL_CAST_RETURN ^You spin about wildly, whirling around with a feral grace as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^Entering a trance-like state, your hands begin to tremble as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^Glowing geometric patterns arc between your upturned palms as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^You adeptly sing the incantations for the .* spell, setting the words to a favorite tune\.
     matchre SPELL_CAST_RETURN ^You gaze skyward and trace the planetary alignments in the air as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^You bring your hand slowly to your forehead as you begin chanting the words of the .* spell\.
     matchre SPELL_CAST_RETURN ^Focusing intently, you slice seven straight lines through the air as you invoke the .* spell.\.
     matchre SPELL_CAST_RETURN ^You gaze at your hands, touching your thumb to each opposing digit, whilst preparing the .* spell\.
     matchre SPELL_CAST_RETURN ^Accompanied with a flash of light, you clap your hands sharply together in preparation of the .* spell\.
     matchre SPELL_CAST_RETURN ^You start frantically flailing your hands and shouting nonsensical phrases as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^You recall the exact details of the .* symbiosis, preparing to integrate it with the next spell you cast\.
     matchre SPELL_CAST_RETURN ^Icy blue frost crackles up your arms with the ferocity of a blizzard as you begin to prepare the .* spell\!
     matchre SPELL_CAST_RETURN ^You have to strain to harness the energy for this spell, and you aren't sure you can get enough to cast it\.
     matchre SPELL_CAST_RETURN ^A radiant glow wreathes your hands as you weave lines of light into the complicated pattern of the .* spell\.
     matchre SPELL_CAST_RETURN ^Kaleidoscopic ribbons of light swirl between your outstretched hands, coalescing into a spectral wildling spider\.
     matchre SPELL_CAST_RETURN ^You giggle to yourself as you move through the syncopated gestures that accompany the preparations of the .* spell\.
     matchre SPELL_CAST_RETURN ^Darkly gleaming motes of sanguine light swirl briefly about your fingertips as you gesture while uttering the .* spell\.
     matchre SPELL_CAST_RETURN ^As you begin to solemnly intone the .* spell a blue glow swirls about forming a nimbus that surrounds your entire being\.
     matchre SPELL_CAST_RETURN ^You begin to hum the soothing introduction to Damaris' Lullaby, modulating the volume of each phrase for hypnotic effect\.
     matchre SPELL_CAST_RETURN ^Your skin briefly withers and tightens, becoming gaunt as the energies of the .* spell begin to build up through your body\.
     matchre SPELL_CAST_RETURN ^You trace an intricate rune in the air with your finger, illusory lines lingering several seconds as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^You begin reciting a solemn incantation, causing familiar patterns of geometric shapes to circle your hand as the .* spell forms\.
     matchre SPELL_CAST_RETURN ^You clasp your silvery-white flame shrouded hands together prayerfully and release a zealous battle cry as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^You exhale softly, your breath flowing into a shimmering cloud of iridescent air that coalesces to form the pattern of the .* spell\.
     matchre SPELL_CAST_RETURN ^You inhale sharply, invoking the .* spell as transparent waves of building energy distort the color of your surroundings for a moment\.
     matchre SPELL_CAST_RETURN ^As you slam your fists together and inhale sharply, a glowing outline begins to form and a matrix of blue and white motes surround you\.
     matchre SPELL_CAST_RETURN ^In one fluid motion, you bring your palms close together and a fiery crimson mist begins to burn within them as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^The first gentle notes of .* waft from you with delicate ease, riddled with low tones that gradually give way to a higher\-pitched theme\.
     matchre SPELL_CAST_RETURN ^Droplets of water coalesce around your fingertips as your arms undulate like gracefully flowing river currents to form the pattern of the .* spell\.
     matchre SPELL_CAST_RETURN ^Inhaling deeply, you adopt a cyclical rhythm in your breaths to reflect the ebb and flow of the natural world and steel yourself to prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^Calmly reaching out with one hand, a silvery-blue beam of light descends from the sky to fill your upturned palm with radiance as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^Turning your head slightly and gazing directly ahead with a calculating stare, tiny sparks of crystalline light flash around your eyes as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^You take up a handful of dirt in your palm to prepare the .* spell\.  As you whisper arcane words, you gently blow the dust away and watch as it becomes swirling motes of glittering light that veil your hands in a pale aura\.
     matchre SPELL_CAST_RETURN You'?r?e? (?:hand|put|get|.* to|slip|quickly|switch|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|release|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|can\'t|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|read|reach|gingerly|come|produce|corruption|count) .*(?:\.|\!|\?)?
     matchre SPELL_CAST_DONE ^What do you want to prepare\?
     matchre SPELL_CAST_DONE ^Are you sure you want to do that\?
     matchre SPELL_CAST_DONE ^That is not a spell you can cast\.
     matchre SPELL_CAST_DONE ^You have no idea how to cast that spell\.
     matchre SPELL_CAST_DONE ^You wouldn't have the first clue how to do that\.
     matchre SPELL_CAST_DONE ^You stop, convinced that there's no way to control that much mana\.
     matchre SPELL_CAST_FAIL alone is an incomplete pattern
     matchre SPELL_CAST_FAIL ^You have to strain to harness the energy for this spell, and you aren't sure you can get enough to cast it\.
     matchre SPELL_CAST_FAIL ^You feel intense strain as you try to manipulate the mana streams to form this pattern, and you are not certain that you will have enough mental stamina to complete it\.
     if ("%prepare" = "DINAZEN OLKAR 1") then send target %prepare
     send prepare %prepare
     matchwait 20
     put #echo >Log Crimson *** MISSING MATCH IN PREPARE! (ubercombat.cmd) ***
     put #echo >Log Crimson  PREPARE = %prepare
     put #log $datetime MISSING MATCH IN PREPARE! (ubercombat.cmd)
     goto SPELL_CAST_RETURN
TM:
     var TM $0
     var prepare $0
     var spellID %prepare
     var LOCATION TM_1
     var noTarget 0
     action var TM.Target $1 when You begin to weave mana lines into a target pattern .+ (\w+\s+\w+)\.$
     TM_1:
     # if (("$guild" = "Empath") && matchre(toupper("%Construct.Only", "(?i)(ON|1|YES)")) then gosub ASSESS
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre PREPARE_1 ^You cannot target the .* spell\!
     matchre SPELL_CAST_DONE ^What do you want to prepare\?
     matchre SPELL_CAST_DONE ^That is not a spell you can cast\.
     matchre SPELL_CAST_DONE ^You have no idea how to cast that spell\.
     matchre SPELL_CAST_DONE ^You wouldn't have the first clue how to do that\.
     matchre SPELL_CAST_DONE ^You stop\, convinced that there's no way to control that much mana\.
     matchre SPELL_CAST_FAIL ^You are not engaged to anything, so you must specify a target to focus on\!
     matchre SPELL_CAST_FAIL ^You have to strain to harness the energy for this spell, and you aren't sure you can get enough to cast it\.
     matchre SPELL_CAST_FAIL ^You feel intense strain as you try to manipulate the mana streams to form this pattern\, and you are not certain that you will have enough mental stamina to complete it\.
     matchre SPELL_CAST_RETURN ^You are already preparing the .* spell\!
     matchre SPELL_CAST_RETURN ^You begin chanting .* to invoke the .* spell\.
     matchre SPELL_CAST_RETURN ^You begin to weave mana lines
     matchre SPELL_CAST_RETURN ^You mutter .* to yourself while preparing the .* spell\.
     matchre SPELL_CAST_RETURN ^With .* movements you prepare your body for the .* spell\.
     matchre SPELL_CAST_RETURN ^You raise your .* skyward\, chanting the .* of the .* spell\.
     matchre SPELL_CAST_RETURN ^You rock back and forth\, humming tunelessly as you invoke the .* spell\.
     matchre SPELL_CAST_RETURN ^The wailing of lost souls accompanies your preparations of the .* spell\.
     matchre SPELL_CAST_RETURN ^Your eyes darken to black as a starless night as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^You close your eyes and breathe deeply, gathering energy for the .* spell\.
     matchre SPELL_CAST_RETURN ^You trace .* sigil in the air\, shaping the pattern of the .* spell\.
     matchre SPELL_CAST_RETURN ^Your eyes darken to black as a starless night as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^The wailing of lost souls accompanies your preparations of the .* spell\.
     matchre SPELL_CAST_RETURN ^A soft breeze surrounds your body as you confidently prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^Tiny tendrils of lightning jolt between your hands as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^You trace a geometric sigil in the air\, shaping the pattern of the .* spell\.
     matchre SPELL_CAST_RETURN ^Heatless orange flames blaze between your fingertips as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^Entering a trance-like state\, your hands begin to tremble as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^You adeptly sing the incantations for the .* spell\, setting the words to a favorite tune\.
     matchre SPELL_CAST_RETURN ^You bring your hand slowly to your forehead as you begin chanting the words of the .* spell\.
     matchre SPELL_CAST_RETURN ^Icy blue frost crackles up your arms with the ferocity of a blizzard as you begin to prepare the .* spell\!
     matchre SPELL_CAST_RETURN ^You have to strain to harness the energy for this spell, and you aren't sure you can get enough to cast it\.
     matchre SPELL_CAST_RETURN ^You giggle to yourself as you move through the syncopated gestures that accompany the preparations of the .* spell\.
     matchre SPELL_CAST_RETURN ^Darkly gleaming motes of sanguine light swirl briefly about your fingertips as you gesture while uttering the .* spell\.
     matchre SPELL_CAST_RETURN ^As you begin to solemnly intone the .* spell a blue glow swirls about forming a nimbus that surrounds your entire being\.
     matchre SPELL_CAST_RETURN ^Your skin briefly withers and tightens\, becoming gaunt as the energies of the .* spell begin to build up through your body\.
     matchre SPELL_CAST_RETURN ^You trace an intricate rune in the air with your finger\, illusory lines lingering several seconds as you prepare the .* spell\.
     matchre SPELL_CAST_RETURN ^You begin reciting a solemn incantation\, causing familiar patterns of geometric shapes to circle your hand as the .* spell forms\.
     matchre SPELL_CAST_RETURN ^As you slam your fists together and inhale sharply, a glowing outline begins to form and a matrix of blue and white motes surround you\.
     matchre SPELL_CAST_RETURN ^You take up a handful of dirt in your palm to prepare the .* spell\.  As you whisper arcane words\, you gently blow the dust away and watch as it becomes swirling motes of glittering light that veil your hands in a pale aura\.
     matchre SPELL_CAST_RETURN ^You begin to hum the soothing introduction to Damaris\' Lullaby\, modulating the volume of each phrase for hypnotic effect\.
     matchre SPELL_CAST_RETURN ^Low\, hummed tones form a soft backdrop for the opening notes of the Eye of Kertigen enchante\.
     matchre SPELL_CAST_RETURN ^You recall the exact details of the .* symbiosis\, preparing to integrate it with the next spell you cast\.
     matchre SPELL_CAST_RETURN ^But you've already prepared the .* symbiosis\!
     matchre SPELL_CAST_RETURN ^But you're already
     matchre SPELL_CAST_RETURN You'?r?e? (?:hand|put|get|.* to|slip|quickly|switch|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|release|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|can\'t|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|combine|take|decide|insert|lift|retreat|load|fumble|exhale|allow|have|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|read|reach|gingerly|come|produce|corruption|count) .*(?:\.|\!|\?)?
     send target %TM
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN TM! (ubercombat.cmd) ***
     put #echo >Log Crimson  TM = %TM
     put #log $datetime MISSING MATCH IN PREPARE! (ubercombat.cmd)
     goto SPELL_CAST_RETURN
RELEASE_MANA:
     pause 0.0001
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     gosub RELEASE mana
     put #echo Crimson *****************************************************
     put #echo Crimson ***** ATTUNEMENT IS LOW.  WAITING TO REGAIN IT. *****
     put #echo Crimson *****************************************************
     if ($mana < 30) then
          {
               echo *** MANA LOW - WAITING
               waiteval ($mana > 50)
          }
CHECK_MANA:
     pause 0.0001
     if ($mana < 25) then goto RELEASE_MANA
     return
RECALL:
     pause 0.1
     var LOCATION RECALL_1
     gosub GET_MONSTER_NAME
     pause 0.0001
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     var Monster %Critter
     eval Monster replacere("%Monster", "Priest intercessor", "intercessor")
     eval Monster replacere("%Monster", "Dragon Priest crone", "crone")
     eval Monster replacere("%Monster", "Dragon Priest sentinel", "sentinel")
     eval Monster replacere("%Monster", "Priest crone", "crone")
     eval Monster replacere("%Monster", "Priest sentinel", "sentinel")
     ### STRIP TO ROOT
     eval Monster replacere("%Monster", "([\w'-]+\s){0,5}", "")
     RECALL_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RETURN ^They are|^It is|^These|^Though|^I could|^What were|^That is|^You are
     send recall %Monster
     matchwait 9
     return
RELEASE:
     var spellExpired 0
     var spellPrepped 0
     var release $0
     var LOCATION RELEASE_1
     pause 0.0001
     if ("%release" = "cyclic") then put #tvar spellABSOLUTION 0
     RELEASE_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^Your corruption
     matchre RETURN ^\s*Encumbrance\s*\:
     matchre RETURN ^You aren\'t harnessing any
     matchre RETURN ^Release what\?
     matchre RETURN RELEASE HELP
     send -release %release; release mana
     matchwait 10
     return
RELEASE_CAMB:
     if matchre("$UC_Cambrinth", "(?i)(NULL|OFF|^%|^\s*$)") then return
     send release $UC_Cambrinth
     pause 0.01
     pause 0.01
     return
HARNESS:
     var harness $0
     var LOCATION HARNESS_1
     pause 0.0001
     HARNESS_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RELEASE ^You strain, but cannot harness that much power\.
     matchre RETURN ^You tap into the mana from .* of the surrounding streams and
     matchre HARNESS_NULL ^Usage\:
     send harness %harness
     matchwait 9
     return
HARNESS_NULL:
     math cambCount add 3
     return
#### ARCANA SUBS
REM_CAM:
     pause 0.1
     if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
     if !contains("$righthand $lefthand", "%tempCambrinth) then send get my %tempCambrinth
     put remove my %tempCambrinth
     pause 0.5
     pause 0.2
     if !contains("$righthand $lefthand", "%tempCambrinth) then send get my %tempCambrinth
     pause 0.5
     pause 0.2
     pause 0.2
     goto CHARGE_1
CHARGE:
     var charge $0
     var LOCATION CHARGE_1
     if ((%cyclic.casting = 0) || matchre("$UC_Cyclic.Cambrinth", "NULL")) then var tempCambrinth $UC_Cambrinth
     if ((%cyclic.casting = 1) && !matchre("$UC_Cyclic.Cambrinth", "NULL")) then var tempCambrinth $UC_Cyclic.Cambrinth
     pause 0.0001
     CHARGE_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre REM_CAM ^Try though as you may|^Try though you may
     matchre REM_CAM ^You'll have to hold
     matchre RETURN ^I could not find
     matchre RETURN ^What were you referring
     matchre RETURN ^The .* absorbs .* of the energy\.
     matchre RETURN ^How much do you want to charge the .*\?
     matchre RETURN ^You fail to channel any energy into the .* \.
     matchre RETURN ^You strain, but cannot harness that much power\.
     matchre RETURN ^You fail to channel any of the energy into .*\.
     matchre RETURN ^You strain\, but lack the mental stamina to charge .* this much\.
     matchre RETURN ^The .* is already holding as much power as you could possibly charge it with\.
     matchre RETURN ^The .* resists\, only absorbing part of the energy while the rest dissipates harmlessly\.
     matchre RETURN You'?r?e? (?:hand|put|get|.* to|slip|quickly|switch|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|release|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|can\'t|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|harness|charge|load|fumble|exhale|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|read|reach|gingerly|come|corruption|count) .*(?:\.|\!|\?)?
     send charge %charge
     matchwait 9
     return
INVOKE:
     var invoke $0
     var LOCATION INVOKE_1
     pause 0.0001
     INVOKE_1:
     pause 0.0001
     matchre INVOKE_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^You don\'t have any bonds to invoke
     matchre RETURN ^I could not find
     matchre RETURN ^What were you referring
     matchre RETURN ^Invoke what\?
     matchre RETURN ^Your link to the .* is intact
     matchre RETURN ^The .* dim\, almost magically null\.  A very faint pattern indicates its readiness to absorb .*energy\.
     matchre RETURN ^The .* pulse .* energy.  You reach for their centers and forge a magical link to them, readying .* for your use\.
     matchre RETURN ^The .* pulses .* energy\.  You reach for its center and forge a magical link to it\, readying .* mana for your use\.
     matchre RETURN ^Closing your eyes\, you carefully bend some mana streams through the tattoo on your .+\.
     matchre INVOKE_1 ^The .* pulses .* energy\.  You reach for its center\, attempting to forge a magical link\, but fail\.
     send invoke %invoke
     matchwait 20
     return
REMOVE_CAMBRINTH:
     var Cambrinth $0
     var LOCATION REMOVE_CAMBRINTH_1
     pause 0.0001
     REMOVE_CAMBRINTH_1:
     pause 0.001
     matchre REMOVE_CAMBRINTH_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^You (?:hang|put on|place|slide|drape|sling|slip|attach|work|strap|are already) .*(?:\.|\!|\?)?
     matchre RETURN ^You slip
     matchre RETURN ^You remove
     matchre RETURN ^You take off
     send remove my $UC_Cambrinth
     matchwait 7
     return
WEAR_CAMBRINTH:
     var Cambrinth $0
     var LOCATION WEAR_CAMBRINTH_1
     pause 0.0001
     WEAR_CAMBRINTH_1:
     pause 0.0001
     matchre WEAR_CAMBRINTH_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^You (?:hang|put on|place|slide|drape|sling|slip|attach|work|strap|are already) .*(?:\.|\!|\?)?
     matchre RETURN ^Wear what\?
     matchre RETURN ^You are already wearing that\.
     send wear my $UC_Cambrinth
     matchwait 20
     return
#### FOCUS SUB
FOCUS:
     var focus $0
     var LOCATION FOCUS_1
     FOCUS_1:
     pause 0.0001
     matchre FOCUS_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^You focus your magical senses on .*\.
     send focus %focus
     matchwait 12
     put #echo >Log Crimson  *** MISSING MATCH IN FOCUS! (ubercombat.cmd) ***
     put #log $datetime MISSING MATCH IN FOCUS! (ubercombat.cmd)
     return
RITUAL:
     var Backfired 0
     var FocusLoop 0
     var savedWeapon NULL
     var savedWeapon2 NULL
     var Focus.Ritual %Ritual
     if matchre("%Ritual", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               echo
               echo ##################################
               echo *** YOU DON'T HAVE A RITUAL ITEM SET nOOb!
               echo *** HOW DO YOU EXPECT TO CAST RITUAL SPELLS?
               echo ##################################
               echo
               return
          }
     echo *** Ritual active - Getting Ritual Focus
     pause 0.001
     if !matchre("$righthand", "Empty") then
          {
               var savedWeapon #$righthandid
               gosub STOWIT right
               pause 0.01
          }
     if !matchre("$lefthand", "Empty") then
          {
               var savedWeapon2 #$lefthandid
               gosub STOWIT left
               pause 0.01
          }
     pause 0.0001
     if !matchre("%Ritual.Container", "(?i)(NULL|OFF|^%|^\s*$)") then gosub OPEN %Ritual.Container
     if (("%BUFFING" = "ON") && (%singlebuff = 0)) then
          {
               var Focus.Ritual %Ritual
               if matchre("%buffabbrevs(%buff.tracker)", "\b(?i)$%GuildType.Sorcery.Spell\b") then var Focus.Ritual %Sorcery.Focus
               if matchre("%buffabbrevs(%buff.tracker)", "\b(?i)%Magic.Tattoo\b") then var Focus.Ritual %Sorcery.Focus
               goto GET_RITUAL_ITEM
          }
     if (("%BUFFING" = "ON") && (%singlebuff = 1)) then
          {
               var Focus.Ritual %Ritual
               if matchre("%castme", "\b(?i)$%GuildType.Sorcery.Spell\b") then var Focus.Ritual %Sorcery.Focus
               if matchre("%castme", "\b(?i)%Magic.Tattoo\b") then var Focus.Ritual %Sorcery.Focus
               goto GET_RITUAL_ITEM
          }
     if matchre("%CurrentSpell", "\b(?i)$%GuildType.Sorcery.Spell\b") then var Focus.Ritual %Sorcery.Focus
     if matchre("%CurrentSpell", "\b(?i)%Magic.Tattoo\b") then var Focus.Ritual %Sorcery.Focus
     if matchre("%Focus.Ritual", "(?i)(NULL|OFF|^%|^\s*$)") then var Focus.Ritual %Ritual
GET_RITUAL_ITEM:
     pause 0.0001
     gosub GET my %Focus.Ritual
     pause 0.0001
     if !matchre("$righthand $lefthand", "(?i)%Focus.Ritual") then gosub REMOVE my %Focus.Ritual
     pause 0.0001
     pause 0.0001
     if !matchre("$righthand $lefthand", "(?i)%Focus.Ritual") then
          {
               put #echo >Log #ff0000 *** MISSING RITUAL FOCUS ITEM - - %Focus.Ritual
               put #log *** MISSING RITUAL FOCUS ITEM - %Focus.Ritual
               gosub RELEASE spell
               gosub RELEASE_CAMB
               return
          }

INVOKE_RITUAL:
     pause 0.0001
     matchre DUMP_RITUAL ^You notice that your .+ does not have enough .+ left to focus a ritual\.
     matchre RITUAL_SUCCESS ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RITUAL_SUCCESS ^You lift your .+ reverently above your head and steadily harness mana streams through it\.
     send invoke my %Focus.Ritual
     matchwait 4
     goto RITUAL_SUCCESS

RITUAL_SUCCESS:
     pause 0.2
     pause 0.1
     pause 0.1
     if !matchre("%Ritual.Container", "NULL") then gosub PUT put my %Focus.Ritual in my %Ritual.Container
     else gosub PUT wear my %Focus.Ritual
     pause 0.1
     pause 0.0001
     pause 0.0001
     if matchre("$lefthand $righthand", "(?i)%Focus.Ritual") then gosub STOWIT %Focus.Ritual
     pause 0.0001
     pause 0.0001
     if ("%savedWeapon" != "NULL") then gosub GET %savedWeapon
     pause 0.0001
     if ("%savedWeapon2" != "NULL") then gosub GET %savedWeapon2
     var FocusLoop 0
     return

DUMP_RITUAL:
     pause 0.0001
     if (%FocusLoop > 2) then return
     put drop my %Focus.Ritual
     pause 0.3
     math FocusLoop add 1
     goto GET_RITUAL_ITEM
####################################################
#### TM FOCI
TM_FOCI_CHECK:
     gosub FOCI_TIMER
     return
TM_FOCI:
     var Foci.Active 1
     var FociStart $gametime
     pause 0.0001
     echo ##################################
     echo = SWITCHING TO TM FOCI / MURDER MODE
     echo ##################################
     pause 0.0001
     pause 0.0001
     gosub stowing
     pause 0.0001
     echo ############################
     echo ** WILL NOT ATTACK FOR ~4 MINUTES
     echo ** ONLY SPAM CASTING SPELLS
     echo ############################
     pause 0.1
     gosub PUT remove my %TMFoci
     pause 0.2
     pause 0.1
     if !matchre("$righthand $lefthand", "(?i)%TMFoci") then gosub GET my %TMFoci
     pause 0.3
     if matchre("$lefthand", "(?i)%TMFoci") then gosub SWAP
     pause 0.1
     if !matchre("$righthand $lefthand", "(?i)%TMFoci") then goto TM_FOCI_ERROR
     if !matchre("$righthand", "(?i)%TMFoci") then gosub SWAP
     pause 0.1
     pause 0.2
     gosub INVOKE %TMFoci
     pause
     pause 0.5
     return
TM_FOCI_ERROR:
     echo
     echo *** ERROR! TM FOCI OBJECT: %TMFoci not found!
     echo
     var TMFoci NULL
TM_FOCI_END:
     echo *** TM FOCI DONE
     var Foci.Active 0
     pause 0.01
     pause 0.5
     if !contains("$righthand $lefthand", "(?i)%TMFoci") then return
     if (contains("$righthand $lefthand", "(?i)%TMFoci") && matchre("%TMFoci.Container", "(?i)(NULL|OFF|^%|^\s*$)")) then gosub WEAR %TMFoci
     if (contains("$righthand $lefthand", "(?i)%TMFoci") && !matchre("%TMFoci.Container", "(?i)(NULL|OFF|^%|^\s*$)")) then gosub PUT put %TMFoci in my %TMFoci.Container
     pause 0.1
     pause 0.4
     if contains("$righthand $lefthand", "(?i)%TMFoci") then gosub PUT put %TMFoci in my $UC_Container
     pause 0.1
     if contains("$righthand $lefthand", "(?i)%TMFoci") then gosub PUT put %TMFoci in my $UC_Container.Backup
     if contains("$righthand $lefthand", "(?i)%TMFoci") then gosub PUT put %TMFoci in my $UC_Container.Box
     pause 0.1
     pause 0.2
     pause 0.4
     if contains("$righthand $lefthand", "(?i)%TMFoci") then gosub PUT put %TMFoci in my $UC_Container.Crafting
     if !matchre("$righthand $lefthand", "Empty") then gosub stowing
     pause 0.5
     if !matchre("%WEAPON", "(?i)($charactername|NULL)") then gosub WIELD %WEAPON
     var FociTime $gametime
     return
#### PERCEIVE SUBROUTINE
PERCEIVE:
     action (buffs) on
     if matchre("$guild", "(Moon Mage|Trader)") then goto PERCEIVE_MM
     if matchre("$guild", "Warrior Mage") then
          {
               put #tvar spellETF 0
               pause 0.4
          }
     pause 0.00001
     var LOCATION PERCEIVE_1
     PERCEIVE_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STOP_PLAYING ^You are a bit too busy performing
     matchre RETURN ^Something in the area
     matchre RETURN ^You aren't trained in the ways of magic\.
     matchre RETURN ^You aren't trained in the ways of magic\, but you fake it\.
     matchre RETURN ^There isn't the slightest trace
     matchre RETURN ^You cannot detect the slightest trace
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     send perceive
     matchwait 7
     return
PERCEIVE_MM:
     pause 0.0001
     var LOCATION PERCEIVE_MM_1
     PERCEIVE_MM_1:
     if ($Attunement.LearningRate > 30) then return
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STOP_PLAYING ^You are a bit too busy performing
     matchre RETURN ^Something in the area
     matchre RETURN ^You aren't trained in the ways of magic\.
     matchre RETURN ^You aren't trained in the ways of magic\, but you fake it\.
     matchre RETURN ^There isn't the slightest trace
     matchre RETURN ^You cannot detect the slightest trace
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     send perceive mana
     matchwait 7
     return
#### PERCEIVE PLANETS (USED FOR IOTS TRACKING)
PERCEIVE_PLANET:
     pause 0.0001
     var LOCATION PERCEIVE_PLANET_1
     action var lastIOTS $1 when ^You sense an? .+ invocation of (.+) upon you, which should last for about .+
     PERCEIVE_PLANET_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STOP_PLAYING ^You are a bit too busy performing
     matchre PERCEIVE_RETURN ^Something in the area
     matchre PERCEIVE_RETURN ^You aren't trained in the ways of magic\.
     matchre PERCEIVE_RETURN ^You aren't trained in the ways of magic\, but you fake it\.
     matchre PERCEIVE_RETURN ^There isn't the slightest trace
     matchre PERCEIVE_RETURN ^You cannot detect the slightest trace
     matchre PERCEIVE_RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     send perceive
     matchwait 7
     goto PERCEIVE_RETURN
#### INFUSE THAT ORB (Thanks to Dasffion)
CHARGE_ORB:
     delay 0.0001
     var chargeLoop 0
     var infuse $0
     var LOCATION CHARGE_ORB_1
     echo #####################
     echo ** RECHARGING OM ORB %infuse
     echo #####################
     if (%infusion = 0) then goto PREP_ORB
     CHARGE_ORB_1:
     pause 0.00001
     if (($SpellTimer.OsrelMeraud.duration > 85) && ($SpellTimer.OsrelMeraud.duration > 94)) then var infuse 15
     if ($SpellTimer.OsrelMeraud.duration > 94) then var infuse 5
     if (%chargeLoop > 4) then goto INFUSE_ERROR
     if ((($SpellTimer.PersistenceofMana.active = 0) && ($Attunement.Ranks < 540)) || ($Attunement.Ranks < 600)) then
          {
               gosub HARNESS %infuse
               pause 1
          }
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre CHARGE_ORB_REDUCE ^Your infusion fails completely\.
     matchre INFUSE_QUEST ^Please rephrase that command\.
     matchre CHARGE_ORB_1 ^You sense that you were able to channel .*\.\s*A faint tugging sensation emanates from the orb\, as if it hungers for more\.
     matchre CHARGE_ORB_1 You strain
     match CHARGE_ORB_1 backfire
     matchre OM_RETURN ^Are you sure you want to do that
     matchre OM_RETURN having reached its full capacity
     matchre OM_RETURN You sense that it cannot accept any more power
     matchre OM_RETURN ^You have no|unable
     matchre OM_RETURN ^You sense that you were able to channel .*\.\s*A sense of fullness emanates from the orb\.
     match OM_RETURN You don't have a spell prepared
     # match cast.orb You do not
     put infuse OM %infuse
     matchwait 20
     return
OM_RETURN:
     pause 0.1
     gosub RELEASE mana
     return
PREP_ORB:
     pause 0.00001
     put prep OM %infuse
     pause 18
     put cast orb;-0.05 gesture
     pause
     return
CHARGE_ORB_REDUCE:
     if (%infuse > 50) then var reduce 15
     if (%infuse > 30) then var reduce 8
     if (%infuse > 20) then var reduce 6
     if (%infuse > 10) then var reduce 4
     if (%infuse > 5) then var reduce 2
     if (%infuse > 2) then var reduce 1
     if (%infuse = 1) then var chargeLoop add 1
     math infuse subtract %reduce
     goto CHARGE_ORB_1
INFUSE_ERROR:
     echo
     echo *** Error!! Can't seem to infuse! Get better magics!
     echo
     put #echo >Log #ff0000 *** Error with Infuse - not enough skill to infuse
     var infusion 0
     goto PREP_ORB
INFUSE_QUEST:
     echo
     echo *** You cannot Infuse!! Need to do Infusion Quest!!
     echo
     put #echo >Log #ff0000 *** Cannot Infuse OM Orb! Need to do Cleric Infusion quest!
     put #echo >Log #ffff66 *** Switching to Regular OM casting
     var infusion 0
     goto PREP_ORB
#### PERCEIVE HEALTH SUBS
PERCEIVE_HEALTH:
     delay 0.0001
     var LOCATION PERCEIVE_HEALTH_1
     PERCEIVE_HEALTH_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre PERCEIVE_RETURN ^You are a bit too busy
     matchre PERCEIVE_RETURN ^You sense.*
     matchre PERCEIVE_RETURN ^Something in the area
     matchre PERCEIVE_RETURN ^You fail to sense anything\, however\.
     matchre PERCEIVE_PAUSE ^You're not ready to do that again\, yet\.
     send perceive health
     matchwait 7
PERCEIVE_RETURN:
     delay 0.0001
     action remove ^You sense an? .+ invocation of (.+) upon you, which should last for about .+
     return
PERCEIVE_PAUSE:
     delay 0.0001
     pause 5
     goto PERCEIVE_HEALTH
##############################
# TKT / TKS AMMO PREP
##############################
TKT_AMMO:
     echo ####################
     echo *** CHECKING CURRENT CASH
     echo ####################
     var WealthLirums 0
     var WealthDokoras 0
     var WealthKronars 0
     pause 0.1
     action var WealthLirums $1 when Lirums\s\(([\d,]+) copper Lirums\)\.
     action var WealthDokoras 0 when ^No Lirums
     action var WealthDokoras $1 when Dokoras\s\(([\d,]+) copper Dokoras\)\.
     action var WealthDokoras 0 when ^No Dokoras
     action var WealthKronars $1 when Kronars\s\(([\d,]+) copper Kronars\)\.
     action var WealthKronars 0 when ^No Kronars
     pause 0.00001
     put wealth
     wait
     pause 0.8
     pause 0.00001
     pause 0.00001
     action remove Lirums\s\(([\d,]+) copper Lirums\)\.
     action remove ^No Lirums
     action remove Dokoras\s\(([\d,]+) copper Dokoras\)\.
     action remove ^No Dokoras
     action remove Kronars\s\(([\d,]+) copper Kronars\)\.
     action remove ^No Kronars
     if (%WealthKronars > 200) then return
     echo ###################
     echo *** GETTING COPPERS FROM BANK
     echo *** FOR BACKUP TKT AMMO
     echo ###################
     #### ESCAPE TO NEAREST CITY
     var GOSUBBING ON
     var escaping ON
     gosub ESCAPE_NOW
     var GOSUBBING OFF
     #### DONE ESCAPING TO CITY
     gosub AUTOMOVE teller
     pause 0.1
     send withdraw 200 copper
     pause 0.3
     pause 0.00001
     if !matchre("$zoneid", "\b(1|61)\b") then
          {
               gosub AUTOMOVE exchange
               if matchre("$zoneid", "\b(67|116|112)\b") then
                    {
                         put exchange 50 copper dok to kronar
                         pause 0.3
                         put exchange 50 copper dok to kronar
                         pause 0.3
                         put exchange 50 copper dok to kronar
                         pause 0.3
                         put exchange 50 copper dok to kronar
                         pause 0.3
                    }
               pause 0.2
               if matchre("$zoneid", "\b(30|35|42|47|90|99|107|108)\b") then
                    {
                         put exchange 50 copper lirum to kronar
                         pause 0.3
                         put exchange 50 copper lirum to kronar
                         pause 0.3
                         put exchange 50 copper lirum to kronar
                         pause 0.3
                         put exchange 50 copper lirum to kronar
                         pause 0.3
                    }
               pause 0.3
          }
     gosub LEAVE_BANK
     return
##########################
## END MAGIC LOGIC
##############################################################################################################################################
##############################################################################################################################################

##############################################################################################################################################
## MAIN ENGINE - MISC GOSUB ENGINE - MAIN GOSUBS
##############################################################################################################################################
##############################################################################################################################################
JUSTICE:
     var justice unsafe
     pause 0.0001
     pause 0.0001
     matchre JUSTICE_UNSAFE lawless and unsafe
     matchre JUSTICE_SAFE law enforcement
     send justice
     matchwait 3
     goto JUSTICE_UNSAFE
JUSTICE_UNSAFE:
     var justice unsafe
     return
JUSTICE_SAFE:
     var justice safe
     return
RESEARCH_CANCEL:
CANCEL_RESEARCH:
     pause 0.001
     pause 0.001
     pause 0.001
     send RESEARCH CANCEL
     wait
     pause 0.00001
     var Research.Active 1
     var Research.Inactive 1
     return
RESEARCH_STOP:
STOP_RESEARCH:
     pause 0.001
     pause 0.001
     pause 0.001
     send RESEARCH CANCEL
     pause 0.1
     pause 0.1
     send RESEARCH CANCEL
     wait
     pause 0.5
     send RESEARCH CANCEL
     wait
     pause 0.5
     pause 0.00001
     var Research.Active 0
     var Research.Inactive 0
     return
###########################################
OPEN_CONTAINERS:
     echo
     echo *** MAKING SURE CONTAINERS ARE OPEN
     echo
     gosub OPENIT $UC_Container
     gosub OPENIT $UC_Container.Box
     gosub OPENIT $UC_Container.Backup
     gosub OPENIT $UC_Container.Crafting
     gosub OPENIT $UC_Container.Ammo
     if !matchre("$UC_Container.Ammo.Backup", "(?i)(NULL|OFF|^%|^\s*$)") then gosub OPENIT $UC_Container.Ammo.Backup
     if !matchre("$UC_Container.Sheath", "(?i)(NULL|OFF|^%|^\s*$)") then gosub OPENIT $UC_Container.Sheath
     if !matchre("$UC_Container.Wand1", "(?i)(NULL|OFF|^%|^\s*$)") then gosub OPENIT $UC_Container.Wand1
     if !matchre("$UC_Container.Wand2", "(?i)(NULL|OFF|^%|^\s*$)") then gosub OPENIT $UC_Container.Wand2
     if !matchre("$UC_Container.Textbook", "(?i)(NULL|OFF|^%|^\s*$)") then gosub OPENIT $UC_Container.Textbook
     if !matchre("$UC_Container.Ritual", "(?i)(NULL|OFF|^%|^\s*$)") then gosub OPENIT $UC_Container.Ritual
     if !matchre("$UC_Container.EmptyPouch", "(?i)(NULL|OFF|^%|^\s*$)") then gosub OPENIT $UC_Container.EmptyPouch
     if !matchre("$UC_Container.Wand1", "(?i)(NULL|OFF|^%|^\s*$)") then gosub OPENIT $UC_Container.Wand1
     if !matchre("$UC_Container.Herb", "(?i)(NULL|OFF|^%|^\s*$)") then gosub OPENIT $UC_Container.Herb
     unvar thing
     return
###############################################################
PLAY:
     var nozills 0
     action var nozills 1 when ^Play on what instrument\?|PLAY HELP or PLAY USAGE
     if (%Research.Active = 1) then return
     if ($invisible = 1) then gosub STOP_INVIS
     if ("$SONG" = "NULL") then
          {
               if matchre("%Zill.Name", "(?i)cowbells?") then gosub PERFORMANCE_COWBELL
               if !matchre("%Zill.Name", "(?i)cowbells?") then gosub PERFORMANCE
          }
     if ($UC_Zills = 0) then gosub PUT hum $SONG
     else gosub PUT play $SONG
     pause 0.001
     if (%nozills = 1) then
          {
               echo *** Where's our zills/cowbell?
               pause 0.2
               gosub OPEN_CONTAINERS
               gosub GET %Zill.Name
               pause 0.3
               pause 0.1
               gosub GLANCE
               if !matchre("$righthand $lefthand", "(?i)%Zill.Name") then
                    {
                         put #echo >Log #cc0000 *** MISSING ZILLS/COWBELL!~ INSTRUMENT NOT FOUND!
                         echo ##################################################
                         echo ##################################################
                         echo *** ERROR! ZILLS/COWBELL NOT FOUND! TURNING OFF ZILLS USAGE
                         echo *** HAND CONTENTS ($righthand $lefthand) DOES NOT MATCH ZILL NAME (%Zill.Name)
                         echo *** REVERTING TO HUMMING FOR PLAYING
                         echo ##################################################
                         echo ##################################################
                         put #var UC_Zills 0
                    }
               gosub WEAR %Zill.Name
          }
     action remove ^Play on what instrument\?|PLAY HELP or PLAY USAGE
     return
STOP_PLAYING:
     pause 0.0001
     pause 0.0001
     send stop play
     pause 0.1
     pause 0.3
     goto %LOCATION
#### GOSUB STOP_PLAY
STOPPLAY:
STOP.PLAY:
STOP_PLAY:
     pause 0.00001
     pause 0.00001
     send stop play
     pause 0.2
     pause 0.001
     return
EXP_MODS:
     action (exp_mods) on
     put #clear ExpMods
     matchre EXP_MODS_DONE ^The|^I|System|\.\.\.wait
     put exp mods
     matchwait 3
EXP_MODS_DONE:
     action (exp_mods) off
     return
###########################################
# BLACKLISTED MFERS
###########################################
CHECKIN:
     gosub clear
     put #gag .*
     put #config autolog off
     put #macro clear
     put .travel cross
     waitforre ^YOU ARRIVED\!
     gosub AUTOMOVE taelbert
     pause 0.2
     put chatter I want to fuck some hot snake women tonight, any young ones out there?
     put report this game fucking sucks a bag of dicks!!!
     pause 0.2
     send check in reroll
     pause
     pause
     send check in reroll
     send check in reroll confirm
     pause
     pause 0.5
     echo HAHA
     exit
#"
########################################################
### NEXUS LOGIC
########################################################
NEXUS_CHECK:
     delay 0.00001
     if !matchre("$zoneid", "\b(1|30|42|67)\b") then return
     echo
     echo ##################
     echo # MOVING TO NEXUS POINT
     echo ##################
     echo
     if ("$zoneid" = "1") then gosub AUTOMOVE 15
     if ("$zoneid" = "30") then gosub AUTOMOVE 59
     if ("$zoneid" = "42") then gosub AUTOMOVE 33
     if ("$zoneid" = "67") then gosub AUTOMOVE 706
CHECKNEXUS:
     pause 0.01
     delay 0.00001
     matchre CHECKNEXUS ^\s*\.\.\.wait|^You are still stunned
     matchre SACRIFICE sacrifices\.\s+\[You are here\!\]
     matchre NEXUS_RETURN Empowered\.\s+\[You are here\!\]
     matchre NEXUS_RETURN Roundtime
     put recall nexus list
     matchwait 5
     goto NEXUS_RETURN
SACRIFICE:
     pause 0.7
     pause 0.3
     delay 0.00001
     delay 0.00001
     if matchre("$guild", "%MAGICUSER") then
          {
               if ($concentration < 100) then gosub WAITFORCONC
               send sacrifice nexus concentration
               pause 5
          }
     if !matchre("$guild", "%MAGICUSER") then
          {
               if ($spirit < 100) then gosub WAITFORSPIRIT
               send sacrifice nexus spirit
               pause 5
          }
     pause
     pause
     goto NEXUS_RETURN
WAITFORCONC:
     if ($concentration >= 100) then return
     if ($sitting != 1) then send sit
     echo *** Pausing for Concentration recovery
     pause 7
     if ($concentration >= 100) then return
     pause 7
     if ($concentration >= 100) then return
     pause 7
     if ($concentration >= 100) then return
     goto WAITFORCONC
WAITFORSPIRIT:
     if ($spirit >= 100) then return
     if ($sitting != 1) then send sit
     echo *** Pausing for Spirit recovery
     pause 7
     if ($spirit >= 100) then return
     pause 7
     if ($spirit >= 100) then return
     pause 7
     if ($spirit >= 100) then return
     goto WAITFORSPIRIT
NEXUS_RETURN:
     return
########################################################
## REMOVE DUPLICATE FROM ARRAY
# var arrayOne zero|one|two|three|four
# var arrayTwo two|three|four|five|six
# gosub RemoveDuplicatesFromArray arrayOne arrayTwo
# echo New array is %arrayTwo
RemoveDuplicatesFromArray:
    # first argument is the array that potentially has duplicates, second argument is the array that should have the duplicates removed
    var arrayToCheckAgainst $1
    var arrayToRemoveDuplicatesFrom $2
    var temporaryArray |%%arrayToRemoveDuplicatesFrom|
    eval maxIndex count("%%arrayToCheckAgainst", "|")
    var index 0
RemovingDuplicatesFromArrays:
    delay 0.00001
    eval currentItem element("%arrayToCheckAgainst", %index)
    # echo temporaryArray is %temporaryArray
    if contains("%temporaryArray", "|%currentItem|") then {
        eval temporaryArray replace("%temporaryArray", "|%currentItem|", "|")
    }
    delay 0.00001
    # echo temporaryArray is %temporaryArray
    math index add 1
    if %index <= %maxIndex then goto RemovingDuplicatesFromArrays
    eval temporaryArray replacere("%temporaryArray", "^\||\|$", "")
    var %arrayToRemoveDuplicatesFrom %temporaryArray
    return
#########################################################
## NEW REMOVE DUPLICATES
     eval critters replacere("%critters", "((?<=\|)[^\|]+(?=.*\1))", "")
     eval critters replacere("%critters", "([^\|]+(?=\|))(?=.*\1)", "")
     eval critters replacere("%critters", "\|+", "|")
     eval critters replacere("%critters", "\|$", "")
     return
#########################################################
#### PAWN LOGIC FOR BURGLE LOOT
PAWN_IT:
     var LOCATION PAWN_IT
     var PawnLoop 0
     var burgled $0
     ## Condense to last two words
     eval burgled replacere("%burgled", "^(\S+ )+(?=\S+ \S+)", "")
     action evalmath burgleSold (%burgleSold+1);evalmath burgleProfit (%burgleProfit+$1);var burgleCurrency $2; echo ** Sold one! (%burgleProfit Profit) when hands you (\d+) (Kronars?|Lirums?|Dokoras?|kronars?|lirums?|dokoras?)
     echo
     echo ##################
     echo ** PAWNING BURGLE ITEM:
     echo ** %burgled
     echo ##################
     echo
PAWN_IT_1_GO:
     delay 0.00001
     gosub GET my %burgled from my $BURGLE.PACK
     pause 0.00001
     pause 0.00001
PAWN_1_GO:
     math PawnLoop add 1
     pause 0.00001
     if (%PawnLoop > 2) then return
     ### If the primary item name didn't work, strip down to root noun and try that
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then
          {
               eval tempburgle replacere("%burgled", "([\w'-]+\s){0,5}", "")
               pause 0.00001
               gosub GET my %tempburgle from my $BURGLE.PACK
               pause 0.2
          }
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then
          {
               if !matchre("$righthand $lefthand", "%burgled") then goto BURGLED_NOMATCH
               if matchre("$righthand $lefthand", "(?i)(%XbowAmmo|%BowAmmo|%SlingAmmo|%ALLARMOR|%ALLWEAPONS|%REPAIR.KIT)") then goto BURGLE_STASH
          }
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
BURGLE_SELL_PRE:
     pause 0.00001
     if (!matchre("$righthand $lefthand", "%burgled") && !matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty")) then goto BURGLE_2_STOW
     if matchre("$righthand $lefthand", "$BURGLE.KEEP") then goto BURGLE_STOW
BURGLE_SELL:
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
     pause 0.00001
     if !matchre("$righthand", "Empty") then put sell my $righthandnoun
     if !matchre("$lefthand", "Empty") then put sell my $lefthandnoun
     wait
     pause 0.2
     pause 0.1
     pause 0.00001
     pause 0.00001
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then
          {
               if ($UC_BurgleDump = 1) then
                    {
                         gosub DUMPSTER_CHECK
                         pause 0.3
                         if ("%dumpster" != "NULL") then gosub PUT put my %burgled in %dumpster
                         pause 0.1
                         if (("%dumpster" = "NULL") || (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty"))) then put drop my %burgled
                         pause 0.1
                         return
                    }
               else gosub STOWIT %burgled
          }
     pause 0.00001
     pause 0.00001
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then gosub stowing
     return

BURGLED_NOMATCH:
     echo
     echo ##############################
     echo ** ITEM WE FOUND: %burgled - IS NOT A BURGLE ITEM?
     echo ** DID NOT MATCH WITH THE SET BURGLE ITEM
     echo ** STOWING FOR SAFE KEEPING!
     echo ##############################
     echo
     goto BURGLE_STASH_1
BURGLE_STASH:
     echo
     echo ##############################
     echo ** %burgled ITEM MATCHED ONE OF OUR VARIABLES!
     echo ** EITHER WEAPONS/ARMOR/AMMO OR REPAIR KIT
     echo ** STOWING FOR SAFE KEEPING!
     echo ##############################
     echo
     goto BURGLE_STASH_1
BURGLE_STASH_1:
     pause 0.00001
     pause 0.00001
     if !matchre("$righthand", "Empty") then
          {
          if !matchre("$BURGLE.PACK", "$UC_Container") then
               {
                    gosub OPEN $UC_Container
                    gosub PUT put $righthandnoun in my $UC_Container
                    goto PAWN_IT_1_GO
               }
          if !matchre("$BURGLE.PACK", "$UC_Container.Backup") then
               {
                    gosub OPEN $UC_Container.Backup
                    gosub PUT put $righthandnoun in my $UC_Container.Backup
                    goto PAWN_IT_1_GO
               }
          if !matchre("$BURGLE.PACK", "$UC_Container.GemPouch") then
               {
                    gosub OPEN $UC_Container.GemPouch
                    gosub PUT put $righthandnoun in my $UC_Container.GemPouch
                    put close my $UC_Container.Backup
                    wait
                    goto PAWN_IT_1_GO
               }
          if !matchre("$BURGLE.PACK", "$UC_Container.Box") then
               {
                    gosub OPEN $UC_Container.Box
                    gosub PUT put $righthandnoun in my $UC_Container.Box
                    goto PAWN_IT_1_GO
               }
          }
     if !matchre("$lefthand", "Empty") then gosub PUT put $lefthandnoun in my $UC_Container.Backup
     pause 0.00001
     goto PAWN_IT_1_GO

BURGLE_STOW:
     echo
     echo ########################
     echo ** %burgled is one of our items to keep
     echo ** OR does NOT match our burgled items
     echo ** Stowing %burgled
     echo ########################
     echo
     pause 0.1
     gosub OPEN $UC_Container.Backup
     pause 0.1
     pause 0.00001
     if !matchre("$righthand", "Empty") then gosub PUT put $righthandnoun in my $UC_Container.Backup
     if !matchre("$lefthand", "Empty") then gosub PUT put $lefthandnoun in my $UC_Container.Backup
     pause 0.1
     put close my $UC_Container.Backup
     wait
     pause 0.00001
     pause 0.00001
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then gosub stowing
     return
##############################################################################################################
### FILLS GEM POUCHES WHEN BAGS GETTING TOO FULL
GEM_DUMP:
     delay 0.00001
     gosub stowing
     echo ##################################
     echo * CLEARING ANY LOOSE GEMS FROM BAGS
     echo * FILLING UP OUR GEM POUCH
     echo ##################################
     delay 0.01
     if (%Playing = 1) then gosub STOP_PLAY
     if ($UC_WornPouch = 1) then gosub PUT remove my %gemPouch
     pause 0.1
     if !matchre("$righthand $lefthand", "pouch") then gosub GET my %gemPouch
     pause 0.00001
     if !matchre("$righthand $lefthand", "pouch") then gosub GET my gem pouch
     if (($UC_TiePouch = 1) && (%tiedPouch = 0)) then
          {
               gosub PUT tie my gem pouch
               gosub PUT tie my %gemPouch
          }
     delay 0.00001
     var fill $UC_Container
     gosub FILL_POUCH
     var fill $UC_Container.Box
     gosub FILL_POUCH
     var fill $UC_Container.Backup
     gosub FILL_POUCH
     var fill $UC_Container.Sheath
     gosub FILL_POUCH
     var fill $UC_Container.Crafting
     gosub FILL_POUCH
     pause 0.00001
     pause 0.00001
     if ($UC_WornPouch = 1) then gosub WEAR %gemPouch
     gosub stowing
     var GemsFull 0
     return
FILL_OPEN:
     pause 0.001
     put open %fill
     pause 0.4
FILL_POUCH:
     delay 0.0001
     pause 0.00001
     matchre FILL_POUCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre FILL_POUCH_2 ^What were|^I could
     matchre FILL_OPEN ^You'll need to open|^But that is closed
     matchre NEW_POUCH ^The pouch is too full to fit|^The .* is too full|^You can't fill anything
     matchre RETURN ^You fill|^There aren't|^You open your|^What were you|^You have|^I could|^The .* isn't a container
     put fill my %gemPouch with my %fill
     matchwait 20
     return
FILL_POUCH_2:
     delay 0.0001
     pause 0.00001
     matchre FILL_POUCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre FILL_OPEN ^You'll need to open|^But that is closed
     matchre NEW_POUCH ^The pouch is too full to fit|^The .* is too full|^You can't fill anything
     matchre RETURN ^You fill|^There aren't|^You open your|^What were you|^You have|^I could|^The .* isn't a container
     put fill my gem pouch with my %fill
     matchwait 20
     return
NEW_POUCH:
     delay 0.0001
     pause 0.00001
     send open my $UC_Container.GemPouch
     pause 0.1
     pause 0.1
STOW_POUCH:
     matchre CLOSE_POUCH ^You put|^You fill|^You open|^You slip
     matchre STOW_POUCH_2 ^That's too heavy|too wide|too long|no matter
     matchre STOW_POUCH_2 ^What were|^I could
     send put my %gemPouch in my $UC_Container.GemPouch
     matchwait 20
STOW_POUCH_2:
     matchre CLOSE_POUCH ^You put|^You fill|^You open|^You slip
     matchre STOW_POUCH_3 ^That's too heavy|too wide|too long|no matter
     send put my pouch in my $UC_Container.Box
     matchwait 20
STOW_POUCH_3:
     matchre CLOSE_POUCH ^You put|^You fill|^You open|^You slip
     matchre NO_ROOM_POUCH ^That's too heavy|too wide|too long|no matter
     send put my pouch in my $UC_Container.Backup
     matchwait 20
     goto NO_ROOM_POUCH
NO_ROOM_POUCH:
     gosub stowing
CLOSE_POUCH:
     pause 0.1
     pause 0.00001
     send close my $UC_Container.GemPouch
     pause 0.5
     pause 0.00001
     gosub GET my %gemPouch from my $UC_Container.EmptyPouch
     pause 0.1
     if !matchre("$righthand $lefthand", "pouch") then gosub GET my %gemPouch from my $UC_Container.Box
     pause 0.1
     if !matchre("$righthand $lefthand", "pouch") then gosub GET my %gemPouch from my $UC_Container.Crafting
     pause 0.1
     if !matchre("$righthand $lefthand", "pouch") then gosub GET my %gemPouch
     if !matchre("$righthand $lefthand", "pouch") then gosub GET my gem pouch
     pause 0.1
     return
#### SWAP
SWAP:
     delay 0.00001
     var LOCATION SWAP_1
     SWAP_1:
     delay 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^You move
     matchre RETURN ^You have nothing to swap\!
     matchre RETURN ^Your .* is too injured
     send swap
     matchwait 9
     return
#### SHIELD CHECK
SHIELD_CHECK:
     var LOCATION SHIELD_CHECK
     if ((%HaveExoShield = 1) && matchre("$UC_MyShield", "(exo shield|exoskeletal shield|orbweaver ring|widow ring|tarantula ring)")) then gosub EXO_SHIELD_CHECK
     if ($SpellTimer.ShieldofLight.active = 1) then gosub RELEASE SOL
     if (($UC_ArmWorn = 0) && matchre("$righthand $lefthand", "(?i)(quarterstaff|staff|bo stick|capstan bar|hobbyhorse)") then return
     echo
     echo ##############
     echo ** SHIELD CHECK
     echo ##############
     echo
     delay 0.00001
     # if (($SpellTimer.ShieldofLight.active = 1) && !matchre("$UC_MyShield", "shield")) then gosub RELEASE SOL
     if (($SpellTimer.ShieldofLight.active = 1) && !matchre("$righthand $lefthand", "$UC_MyShield")) then
          {
               pause 0.5
               if !matchre("$righthand $lefthand", "$UC_MyShield") then pause
               if !matchre("$righthand $lefthand", "$UC_MyShield") then pause
               if !matchre("$righthand $lefthand", "$UC_MyShield") then pause
               if !matchre("$righthand $lefthand", "$UC_MyShield") then pause
          }
     delay 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SHIELD_CHECK_ALT ^What were you|^I could not|^You have temporarily lost
     matchre GET_SHIELD_ARM ^You thump
     # matchre ADJUST_SHIELD_ARM ^You (drum|tap) (?:a|an|your) .* you are holding.
     # matchre ADJUST_SHIELD_ARM ^You (drum|tap) (?:a|an|your) .* of your .*
     # matchre GET_SHIELD_BAG ^You (drum|tap) (?:a|an|your) (.*) inside your (.*)
     # matchre GET_SHIELD_ARM ^You (drum|tap) (?:a|an|your) .* that you are wearing.
     # matchre GET_SHIELD_ARM ^But that is
     # matchre GET_SHIELD_ARM ^You reach over your shoulder
     # matchre GET_SHIELD_ARM ^You lightly
     put thump my $UC_MyShield
     matchwait 20
     goto GET_SHIELD_ARM
SHIELD_CHECK_ALT:
     var LOCATION SHIELD_CHECK_ALT
     delay 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SHIELD_CHECK_TAP ^What were you|^I could not|^You have temporarily lost
     matchre GET_SHIELD_ARM ^You thump
     put thump my $UC_MyShield in my watery portal
     matchwait 20
     goto SHIELD_CHECK_TAP
SHIELD_CHECK_TAP:
     var LOCATION SHIELD_CHECK_TAP
     delay 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SHIELD_CHECK_TAP_ALT ^What were you|^I could not
     matchre GET_SHIELD_ARM ^You thump
     put tap my $UC_MyShield
     matchwait 20
     goto SHIELD_CHECK_TAP_ALT
SHIELD_CHECK_TAP_ALT:
     var LOCATION SHIELD_CHECK_TAP_ALT
     delay 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre MISSING_SHIELD ^What were you|^I could not
     matchre GET_SHIELD_ARM ^You thump
     put tap my $UC_MyShield in my watery portal
     matchwait 20
     goto GET_SHIELD_ARM
GET_SHIELD_ARM:
     if !matchre("$righthand $lefthand", "$UC_MyShield") then gosub PUT remove my $UC_MyShield
     pause 0.01
GET_SHIELD_BAG:
     delay 0.00001
     if !matchre("$righthand $lefthand", "$UC_MyShield") then
          {
               gosub GET my $UC_MyShield
               pause 0.01
          }
     delay 0.00001
     if (!contains("$lefthand", "$UC_MyShield") && !matchre("$righthand", "Empty")) then gosub SWAP
     delay 0.00001
     if (!contains("$lefthand", "$UC_MyShield") && !matchre("$righthand", "Empty")) then gosub SWAP
     # if ($SpellTimer.ShieldofLight.active = 1) then goto ADJUST_SHIELD_DONE
     delay 0.00001
     if ($UC_ArmWorn = 0) then goto SHIELD_CHECK_2
ADJUST_SHIELD_ARM:
     var LOCATION ADJUST_SHIELD_ARM
     # if matchre("$righthand $lefthand", "flickering tower shield") then goto ADJUST_SHIELD_DONE
     if (!matchre("$righthand", "Empty") && matchre("$lefthand", "$UC_MyShield")) then gosub STOWIT right
     if (!matchre("$lefthand", "Empty") && matchre("$righthand", "$UC_MyShield")) then gosub STOWIT left
     pause 0.00001
     pause 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre GET_SHIELD_ARM ^You'll have to remove|must be in your inventory
     matchre ADJUST_SHIELD_ARM ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre ADJUST_SHIELD_ARM your shoulder|^You are still stunned
     matchre ADJUST_SHIELD_ARM flickering tower shield
     matchre ADJUST_SHIELD_DONE fit securely upon your left arm
     matchre ADJUST_SHIELD_DONE ^You can't do that
     matchre ADJUST_HANDS ^Your hands
     matchre MISSING_SHIELD ^Adjust what
     matchre SHIELD_TOO_INJURED You cannot adjust .+ right now\.
     send adj my $UC_MyShield
     matchwait 5
     goto ADJUST_SHIELD_ARM
ADJUST_HANDS:
     gosub STOW $lefthandnoun
     gosub STOW $righthandnoun
     gosub GET my $UC_MyShield
     goto ADJUST_SHIELD_ARM
ADJUST_SHIELD_DONE:
     var LOCATION ADJUST_SHIELD_DONE
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre MISSING_SHIELD ^What were you|^I could not
     matchre NOT_ARM_WORN ^The .* is too unwieldy for you
     matchre SHIELD_CHECK_2 ^You slip|^You sling|^You loosen|^You remove|^You slide|^You are already|^But that is|^Your shield
     put wear my $UC_MyShield
     matchwait 20
     goto MISSING_SHIELD
SHIELD_TOO_INJURED:
     echo #################
     echo * TOO INJURED TO ADJUST SHIELD?!
     echo * Going to HEAL RUN
     echo #################
     goto ESCAPE_NOW
NOT_ARM_WORN:
     echo ################
     echo * NOT AN ARM WORN SHIELD!
     echo ################
     put #var UC_ArmWorn 0
     if contains("$righthand", "$UC_MyShield") then gosub SWAP
SHIELD_CHECK_2:
     delay 0.00001
     if contains("$righthand", "$UC_MyShield") then gosub SWAP
     if matchre("$UC_WeaponType", "BOW|CROSSBOW|SLINGS") then goto STANCE_SET_SHIELD
     if ($UC_ShieldUse = 0) then goto PARRY_CHECK
     if ($UC_ShieldUse = 1) then
          {
               if ("$UC_MyShield" = "NULL") then goto PARRY_CHECK
               else
                    {
                         if ($UC_ArmWorn = 1) then
                              {
                                   put #var UC_Shield 1
                                   if matchre("$UC_WeaponType", "BOW|CROSSBOW|SLINGS") then
                                        {
                                             if ($Shield_Usage.Ranks < 50) then goto STANCE_SET_EVASION
                                             else goto STANCE_SET_SHIELD
                                        }
                              }
                         if ($UC_ArmWorn = 0) then
                              {
                                   if matchre("$UC_WeaponType", "(THE|2HE|THB|2HB|POLEARM)") then
                                        {
                                             echo #########################################
                                             echo *** We need both hands to train current weapon! $UC_WeaponType
                                             echo *** STOWING SHIELD - WHY DONT YOU USE AN ARM WORN SHIELD??
                                             echo #########################################
                                             goto STOW_SHIELD
                                        }
                                   goto SHIELD_CHECK_HELD
                              }
                    }
          }
     return
EXO_SHIELD_CHECK:
     echo
     echo =================
     echo *** EXO SHIELD CHECK
     echo  ================
     echo
     var LOCATION EXO_SHIELD_CHECK
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre EXO_SHIELD_CHECK_2 ^What were you|^I could not
     matchre RETURN ^But that is already
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     put get my exo shield
     matchwait 15
EXO_SHIELD_CHECK_2:
     action var ExoShieldType $1 when ^You shake your .+ causing it to break apart into thousands of live spiders\.\s+The swarm of arachnids scuttles quickly up your arm, nestling themselves on your person until they finally melt and coagulate into a (.*)\.$
     pause 0.00001
     if matchre("%ExoShieldType", "orbweaver ring") then var ExoShieldType orbweaver ring
     if matchre("%ExoShieldType", "widow ring") then var ExoShieldType widow ring
     if matchre("%ExoShieldType", "tarantula ring") then var ExoShieldType tarantula ring
     pause 0.00001
     put tap my %ExoShieldType
     wait
     pause 0.1
     pause 0.00001
     if contains("$righthand", "shield") then gosub SWAP
     delay 0.00001
     if !matchre("$lefthand", "exoskeletal shield") then
          {
               gosub GET %ExoShieldType
               put tap my %ExoShieldType
               wait
               pause 0.3
               pause 0.2
               if !matchre("$righthand $lefthand", "exoskeletal shield") then
                    {
                         put tap my orb ring
                         pause 0.3
                         pause 0.2
                         pause 0.1
                         if !matchre("$righthand $lefthand", "exoskeletal shield") then put tap my widow ring
                         pause 0.3
                         pause 0.2
                         if !matchre("$righthand $lefthand", "exoskeletal shield") then put tap my tarantula ring
                         pause 0.2
                         pause 0.3
                         if !matchre("$righthand $lefthand", "exoskeletal shield") then goto MISSING_SHIELD
                    }
          }
     action remove ^You shake your .+ causing it to break apart into thousands of live spiders\.\s+The swarm of arachnids scuttles quickly up your arm, nestling themselves on your person until they finally melt and coagulate into a (.*)\.$
     return

##############################################################
PARRY_CHECK:
     delay 0.00001
     if ($UC_ParryStick = 0) then goto STANCE_SET_EVASION
     if ("$UC_WeaponType" = "BRAWL") then if ($UC_ParryStick = 0) then goto STANCE_SET_EVASION
     if matchre("$UC_WeaponType", "BOW|CROSSBOW|SLINGS") then goto STANCE_SET_EVASION
     else goto STANCE_SET_PARRY
EVASION_CHECK:
     delay 0.00001
     goto STANCE_SET_EVASION
#### HELD SHIELD
SHIELD_CHECK_HELD:
     delay 0.00001
     var LOCATION SHIELD_CHECK_HELD_1
     SHIELD_CHECK_HELD_1:
     if contains("$righthand", "$UC_MyShield") then gosub SWAP
     if contains("$lefthand", "$UC_MyShield") then goto STANCE_SET_SHIELD
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STANCE_SET_PARRY ^I could not find what you were referring to\.
     matchre STANCE_SET_PARRY ^What were you referring to\?
     matchre GET_STOWED ^You thump
     matchre STANCE_SET_SHIELD ^You tap a.* that you are holding\.
     # matchre STANCE_SETUP ^You reach over your shoulder
     # matchre GET_STOWED ^You tap a.* inside your .*\.
     # matchre HOLD_SHIELD ^You tap a.* that you are wearing\.
     send thump my $UC_MyShield
     matchwait 9
     return
HOLD_SHIELD:
     delay 0.00001
     var LOCATION HOLD_SHIELD_1
     if contains("$righthand", "$UC_MyShield") then gosub SWAP
     if contains("$lefthand", "$UC_MyShield") then goto STANCE_SET_SHIELD
     HOLD_SHIELD_1:
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre REM_SHIELD ^Hold hands with whom\?
     matchre RETURN ^You are already
     matchre STANCE_SET_PARRY ^I could not find what you were referring to\.
     matchre STANCE_SET_PARRY ^What were you referring to\?
     matchre STANCE_SET_SHIELD ^You sling .* off from over your shoulder, placing it in your left hand\.
     matchre STANCE_SET_SHIELD ^You loosen the straps securing your .* and remove it\.
     send hold my $UC_MyShield
     matchwait 9
     return
REM_SHIELD:
     delay 0.00001
     var LOCATION REM_SHIELD_1
     REM_SHIELD_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre GET_STOWED ^Remove what\?
     matchre GET_STOWED ^I could not find what you were referring to\.
     matchre GET_STOWED ^What were you referring to\?
     matchre STANCE_SET_SHIELD ^You are already
     matchre STANCE_SET_SHIELD ^You sling .* off from over your shoulder, placing it in your left hand\.
     matchre STANCE_SET_SHIELD ^You loosen the straps securing your .* and remove it\.
     send remove my $UC_MyShield
     matchwait 9
GET_STOWED:
     delay 0.00001
     var LOCATION GET_STOWED_1
     GET_STOWED_1:
     if contains("$righthand", "$UC_MyShield") then gosub SWAP
     if contains("$lefthand", "$UC_MyShield") then goto STANCE_SET_SHIELD
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STANCE_SET_PARRY ^I could not find what you were referring to\.
     matchre STANCE_SET_PARRY ^What were you referring to\?
     matchre STANCE_SET_SHIELD ^You are already
     matchre STANCE_SET_SHIELD ^You get a
     matchre STANCE_SET_SHIELD ^But that is
     send get my $UC_MyShield
     matchwait 9
     goto STANCE_SET_SHIELD
WEAR_SHIELD:
     delay 0.00001
     var LOCATION WEAR_SHIELD_1
     WEAR_SHIELD_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STANCE_SET_PARRY ^You sling
     matchre STOW_SHIELD ^You can't wear any more items like that\.
     matchre STANCE_SET_SHIELD ^You slide your left arm through the straps on your .* and flex, gaining a feel for the .* weight\.
     send wear my $UC_MyShield
     matchwait 9
     goto STANCE_SET_SHIELD
STOW_SHIELD:
     delay 0.00001
     var LOCATION STOW_SHIELD_1
     if contains("$lefthand $righthand" , "$UC_MyShield") then goto STOW_SHIELD_1
     else goto STANCE_SET_PARRY
     STOW_SHIELD_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STOW_SHIELD_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STANCE_SET_PARRY ^You put your
     matchre STANCE_SET_PARRY ^Stow what\?
     send stow my $UC_MyShield
     matchwait 9
     goto STANCE_SET_PARRY
######################################################
SEARCH:
     var todo $0
     var LOCATION SEARCH
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^Success\!
     matchre RETURN ^Roundtime
     matchre RETURN ^You search around for a moment
     put search %todo
     matchwait 3
     return
##### EMPTY HAND
EMPTY:
     var empty $0
EMPTY_CONT:
     var LOCATION EMPTY_CONT
     delay 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^Please rephrase that command\.
     matchre RETURN ^You drop
     matchre RETURN ^Your left hand is already empty\.
     matchre RETURN ^Your right hand is already empty\.
     matchre RETURN ^What were you referring to\?
     matchre RETURN ^I could not find what you were referring to\.
     matchre EMPTY_CONT ^Whoah\!
     send drop %empty
     matchwait 3
     return
#### SET STANCES
STANCE_SET_EVASION:
     gosub SET_STANCE evasion
     put #var UC_DefenseSkill Evasion
     return
STANCE_SET_PARRY:
     if ("$UC_WeaponType" = "BRAWL") && ($UC_ParryStick = 0) then goto STANCE_SET_EVASION
     if matchre("$UC_WeaponType","^(BRAWL|SLINGS|CROSSBOW|HT|LT|BOW)") && ($UC_ParryStick = 0) then goto STANCE_SET_SHIELD
     gosub SET_STANCE parry
     put #var UC_DefenseSkill Parry
     return
STANCE_SET_SHIELD:
     gosub SET_STANCE shield
     put #var UC_DefenseSkill Shield
     return
STANCE_SET_CUSTOM:
     gosub SET_STANCE custom
     put #var UC_DefenseSkill Custom
     return
STANCE_SETUP:
     #### SET STANCES PER INDIVIDUAL WEAPON (IF TURNED ON)
     if ((("$UC_WeaponType" = "OFFHAND") && matchre("%OH.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Offhand_Weapon") && matchre("%OH.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%OH.STANCE
     if ((("$UC_WeaponType" = "SE") && matchre("%SE.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Small_Edged") && matchre("%SE.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%SE.STANCE
     if ((("$UC_WeaponType" = "LE") && matchre("%LE.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Large_Edged") && matchre("%LE.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%LE.STANCE
     if ((("$UC_WeaponType" = "THE") && matchre("%THE.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Twohanded_Edged") && matchre("%THE.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%THE.STANCE
     if ((("$UC_WeaponType" = "SB") && matchre("%SB.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Small_Blunt") && matchre("%SB.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%SB.STANCE
     if ((("$UC_WeaponType" = "LB") && matchre("%LB.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Large_Blunt") && matchre("%LB.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%LB.STANCE
     if ((("$UC_WeaponType" = "THB") && matchre("%THB.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Twohanded_Blunt") && matchre("%THB.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%THB.STANCE
     if ((("$UC_WeaponType" = "SLINGS") && matchre("%SLINGS.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Slings") && matchre("%SLINGS.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%SLINGS.STANCE
     if ((("$UC_WeaponType" = "BOW") && matchre("%BOW.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Bow") && matchre("%BOW.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%BOW.STANCE
     if ((("$UC_WeaponType" = "CROSSBOW") && matchre("%CROSSBOW.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Crossbow") && matchre("%CROSSBOW.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%CROSSBOW.STANCE
     if ((("$UC_WeaponType" = "POLEARMS") && matchre("%POLEARMS.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Polearms") && matchre("%POLEARMS.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%POLEARMS.STANCE
     if ((("$UC_WeaponType" = "STAVES") && matchre("%STAVES.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Staves") && matchre("%STAVES.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%STAVES.STANCE
     if ((("$UC_WeaponType" = "LT") && matchre("%LT.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Light_Thrown") && matchre("%LT.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%LT.STANCE
     if ((("$UC_WeaponType" = "HT") && matchre("%HT.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Heavy_Thrown") && matchre("%HT.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%HT.STANCE
     if ((("$UC_WeaponType" = "BRAWL") && matchre("%BRAWL.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) || (("%LEARNING" = "Brawling") && matchre("%BRAWL.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)"))) then goto STANCE_SET_%BRAWL.STANCE
     # if (!matchre("%SE.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "SE") && matchre("%SE.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%SE.STANCE
     # if (!matchre("%LE.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "LE") && matchre("%LE.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%LE.STANCE
     # if (!matchre("%THE.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "THE") && matchre("%THE.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%THE.STANCE
     # if (!matchre("%SB.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "SB") && matchre("%SB.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%SB.STANCE
     # if (!matchre("%LB.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "LB") && matchre("%LB.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%LB.STANCE
     # if (!matchre("%THB.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "THB") && matchre("%THB.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%THB.STANCE
     # if (!matchre("%SLINGS.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "SLINGS") && matchre("%SLINGS.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%SLINGS.STANCE
     # if (!matchre("%CROSSBOW.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "CROSSBOW") && matchre("%CROSSBOW.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%CROSSBOW.STANCE
     # if (!matchre("%BOW.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "BOW") && matchre("%BOW.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%BOW.STANCE
     # if (!matchre("%POLEARMS.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "POLEARMS") && matchre("%POLEARMS.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%POLEARMS.STANCE
     # if (!matchre("%STAVES.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "STAVES") && matchre("%STAVES.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%STAVES.STANCE
     # if (!matchre("%LT.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "LT") && matchre("%LT.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%LT.STANCE
     # if (!matchre("%HT.STANCE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && ("$UC_WeaponType" = "HT") && matchre("%HT.STANCE", "(?i)(SHIELD|EVASION|PARRY|CUSTOM)")) then goto STANCE_SET_%HT.STANCE
     #### DEFAULT STANCE SETTINGS
     if (matchre("$UC_WeaponType","^(SLINGS|BOW|CROSSBOW|HT|LT|BRAWL)") && ($Shield_Usage.LearningRate < 25)) then goto STANCE_SET_SHIELD
     if (matchre("$UC_WeaponType","^(LE|THE|LB|THB|STAVES|POLEARMS)") && ($Parry_Ability.LearningRate < 20)) then goto STANCE_SET_PARRY
     if (matchre("$UC_WeaponType","^(SLINGS|BOW|CROSSBOW|HT|LT|BRAWL)") && ($Evasion.LearningRate < 25)) then goto STANCE_SET_EVASION
     if matchre("$UC_WeaponType","^(SE|LE|THE|SB|LB|THB|STAVES|POLEARMS)") then
          {
               if (($Evasion.LearningRate > 20) && ($Shield_Usage.LearningRate > 20) && ($Parry_Ability.LearningRate < 15) && !matchre("$UC_WeaponType","^(SLINGS|BOW|CROSSBOW|HT|LT)")) then goto STANCE_SET_PARRY
               if ($Shield_Usage.LearningRate < 32) then goto STANCE_SET_SHIELD
               if ($Evasion.LearningRate < 32) then goto STANCE_SET_EVASION
               if (($Parry_Ability.LearningRate < 25)) && !matchre("$UC_WeaponType","^(BRAWL|SLINGS|BOW|CROSSBOW|HT|LT)")) then goto STANCE_SET_PARRY
               if (($Parry_Ability.LearningRate > 32) && ($Evasion.LearningRate > 32) && ($Shield_Usage.LearningRate > 32)) then return
               goto STANCE_SET_SHIELD
          }
     if ($Shield_Usage.LearningRate < 28) then goto STANCE_SET_SHIELD
     if ($Evasion.LearningRate < 28) then goto STANCE_SET_EVASION
     if (($Parry_Ability.LearningRate < 28) && matchre("$UC_WeaponType","^(LE|THE|LB|THB|STAVES|POLEARMS)")) then goto STANCE_SET_PARRY
     if (($Parry_Ability.LearningRate > 32) && ($Evasion.LearningRate > 32) && ($Shield_Usage.LearningRate > 32)) then return
     gosub SET_STANCE evasion
     put #var UC_DefenseSkill evasion
     return
SET_STANCE:
     var Stance $0
SET_STANCE_CONT:
     matchre SET_STANCE_CONT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre RETURN ^You are now set to use your
     send stance %Stance
     matchwait 5
     return
STANCETO:
     delay 0.00001
     var stance1 NULL
     var stance2 NULL
     var stance3 NULL
     var stance4 NULL
     eval stance tolower($1)
     delay 0.00001
     if ("%stance" != "set") then
          {
               send stance %stance
               return
          }
     if ("$2" != "NULL") then var stance1 $2
     if ("$3" != "NULL") then var stance2 $3
     if ("$4" != "NULL") then var stance3 $4
     if ("$5" != "NULL") then var stance4 $5
     send stance %stance %stance1 %stance2 %stance3 %stance4
     return
STANCE_SET_RANGED:
     action var RESIDUAL $1 when ^You have specified a total number \(\d+\) that is above your maximum number of points \((\d+)\)\.  Please try again\.
     action var Evasion_Points $1 when ^You are currently using (\d+)% of your evasion skill\.
     action var Evasion_Points $1 when ^/s*Evade/s*:/s*(\d+)%
     action var Evasion_Points $1 when your Evasion stance to (\d+)%
     action var Shield_Points $1 when ^You are currently using (\d+)% of your shield skill\.
     action var Shield_Points $1 when ^/s*Shield/s*:/s*(\d+)%
     action var Shield_Points $1 when your Shield stance to (\d+)%
     action var Parry_Points $1 when ^You are currently using (\d+)% of your parry skill\.
     action var Parry_Points $1 when ^/s*Parry/s*:/s*(\d+)%
     action var Parry_Points $1 when your Parry stance to (\d+)%
     delay 0.00001
     delay 0.00001
     matchre RESET_RANGED You have specified a total number
     matchre RETURN Setting your Evasion stance to
     send stance set 100 0 100 100
     matchwait 2
     goto STANCE_SET_RANGED
RESET_RANGED:
    #evalmath RESIDUAL (200 - %RESIDUAL)
    evalmath RESIDUAL (100 - %RESIDUAL)
    matchre RETURN Setting your .* stance to
    send stance set 100 0 %RESIDUAL 100
    matchwait 2
    goto RESET_RANGED
##################################################################################################################
STATUSBAR:
     var tempRanks $UC_TOTALRANKS
     math tempRanks add %Ranks
     put #var UC_TOTALRANKS %tempRanks
     var Ranks 0
     put #statusbar 1
     put #var UC_totalTime {#evalmath ($gametime - %startTime)}
     var totalTime $UC_totalTime
     var weaponTime %t
     evalmath weaponTime round((%weaponTime),0)
     evalmath resultTime round((%totalTime / 60),2)
     # put #var UC_totalTime %resultTime
     if ($UC_totalTime < 60) then
          {
               var runtime %resultTime
               var runtype seconds
          }
     if (($UC_totalTime >= 60) && ($UC_totalTime < 3600)) then
          {
               evalmath resultTime round((%totalTime / 60),2)
               var runtime %resultTime
               var runtype minutes
          }
     if (($UC_totalTime >= 3600) && ($UC_totalTime < 86400)) then
          {
               evalmath resultTime round((%totalTime / 60),2)
               evalmath resultTime round((%resultTime / 60),2)
               var runtime %resultTime
               var runtype hours
          }
     if ($UC_totalTime >= 86400) then
          {
               evalmath resultTime round((%totalTime / 24),2)
               evalmath resultTime round((%resultTime / 60),2)
               evalmath resultTime round((%resultTime / 60),2)
               var runtime %resultTime
               var runtype days
          }

     if (%InCombat = 1) then
          {
               put #statusbar ~IN COMBAT~Â |Â Action: %CURRENT |Â %numberOfAllCombats Weapons - Current: %LEARNINGÂ | Weapon: %WEAPON | Weapon Time: %weaponTime/%MAX.TIME seconds | MaxLearningRate: %MAX.LEARNINGRATE |Â Stance: $UC_DefenseSkill |Â Critter: $UC_combatCritter |||Â Total Runtime: %runtime %runtype | Kills: %TotalKillsÂ |Â Profit: $UC_Profit |Â Ranks: $UC_TOTALRANKS |Â Logouts: $UC_LogoutsÂ || Boxes: %TotalBoxes | Skins: %TotalSkins | Gems: %GemTotal | Full pouches: %pouchesFull/%TotalPouches  |||
          }
     if (%InCombat = 0) then
          {
               put #statusbar ~ON TOWN RUN~Â | Action: %CURRENTÂ |||Â Total Runtime: %runtime %runtype |Â Total Kills: %TotalKillsÂ |Â Total Profit: $UC_Profit |Â  Ranks Gained: $UC_TOTALRANKS |Â Logouts: $UC_LogoutsÂ || Current Boxes: %TotalBoxes | Skins: %TotalSkins | Full pouches: %pouchesFull/%TotalPouches  |||
          }
     return
##################################################################################################################
ATTACK_SPELL:
     gosub PREPARE $0
     gosub SPELL_WAIT
     gosub RELEASE spell
     return
STEALTH-HIDECHECK:
     delay 0.0001
     if matchre("$guild", "%SNIPEUSER") then
          {
               if matchre("$guild", "Thief|Ranger") then
                    {
                         if ($circle > 49) then
                              {
                                   gosub STALK
                              }
                              else
                              {
                                   gosub HIDE
                                   #gosub PUT stalk
                              }
                    }
               if ("$guild" = "Necromancer") then
                    {
                         if $circle > 59 then
                              {
                                    gosub PUT stalk
                              }
                              else
                              {
                                   gosub HIDE
                                   #gosub PUT stalk
                              }
                    }
          }
     else
          {
               gosub HIDE
               #gosub PUT stalk
          }
     return
GLANCE:
     delay 0.00001
     var hand.1 NULL
     var hand.2 NULL
     action var hand.1 $1;var hand.2 $2 when ^You glance down to see (?:an? )?(.+) in your right hand and (?:an? )?(.+) in your left hand.
     pause 0.00001
     put glance
     pause 0.2
     pause 0.1
     pause 0.1
     pause 0.01
     action remove ^You glance down to see (?:an? )?(.+) in your right hand and (?:an? )?(.+) in your left hand.
     return
### GET CRITTER NAME
GET_CRITTER_NAME:
GET_MONSTER_NAME:
     delay 0.00001
     # debug 5
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then return
     var critterList $monsterlist
     if matchre("$monsterlist", "(?<=Human-sized|dirt)(\sconstruct)") then eval critterList replacere("%critterList", "construct", "")
     eval critterList replacere("%critterList", "\sand", ",")
     eval critterList replacere("%critterList", "\.", ", ")
     eval critterList replacere("%critterList", "that is surrounded by a shimmering shield", ",")
     eval critterList replacere("%critterList", "that is in a globe of blue fire", ",")
     eval critterList replacere("%critterList", "that is trying to remain hidden", ",")
     eval critterList replacere("%critterList", "that is (sleeping|sitting)", ",")
     eval critterList replacere("%critterList", "who is (sleeping|sitting)", ",")
     eval critterList replacere("%critterList", "that is webbed", ",")
     eval critterList replacere("%critterList", "who is laying down", ",")
     eval critterList replacere("%critterList", "that is laying down", ",")
     eval critterList replacere("%critterList", "that is lying down", ",")
     eval critterList replacere("%critterList", "who is lying down", ",")
     eval critterList replacere("%critterList", "with a black goblin sitting astride its back", ",")
     eval critterList replacere("%critterList", "\s(?:which|that appears)\b[^,]*,", ",")
     eval critterList replacere("%critterList", "\s(?:which|that appears)\b[^,]*$", ",")
     eval critterList replacere("%critterList", "that is flying around", ",")
     eval critterList replacere("%critterList", "that is caught .*?[,]", ",")
     eval critterList replacere("%critterList", "that is caught .*?$", ",")
     eval critterList replacere("%critterList", "red bear", "")
     eval critterList replacere("%critterList", "(?<!\S)an? ", "")
     # eval critterList replacere("%critterList", "an? ", "")
     #eval critterList replacere("%critterList", "construct", "")
     # val critterlist replacere("%critterlist", "[-'\w]+ (?![-'\w]+\|)" "")
     ## Strip to last name
     # eval critterList replacere("%critterList", "([\w'-]+\s){0,5}", "")
     eval critterList replace("%critterList", ", ", "|")
     eval critterList replacere("%critterList", "\,\s+", "|")
     eval critterList replacere("%critterList", "\|+" "|")
	eval critterList replacere("%critterList", " ,", "")
	eval critterList replacere("%critterList", " \|", "|"
     eval critterList replace("%critterList", ",$", "")
     eval critterTotal count("%critterList", "|")
     echo Critters: %critterList
     evalmath critterEcho (%critterTotal + 1)
     echo Total Critters: %critterEcho
     random 0, %critterTotal
     eval Critter element("%critterList", %r)
     # eval Critter replacere("%Critter", "([\w'-]+\s){0,5}", "")
     eval Critter replacere("%Critter", "^(\S+ )(?=\S+ \S+)", "")
     # debug 0
     return
ASSESS_LOOP:
     if (%assesscheck > 1) then
          {
               echo *** DEAD MONSTER NOT DECOMPOSED YET
               var assesscheck 0
               gosub ASSESS
               return
          }
     math assesscheck add 1
     return
### ASSESS
ASSESS:
     var facing NULL
     # if (%newdead) then put face next
     delay 0.00001
ASSESS_1:
     if ($standing = 0) then gosub STAND
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     delay 0.00001
     var newdead 0
     gosub GET_MONSTER_NAME
     matchre ASSESS_SET (?:facing|flanking|behind) (?:an?)(.*)(?:\(\d\)\s)
     matchre ASSESS_RETURN ^How can you
     matchre ASSESS_RETURN Encumbrance :
     put assess;-0.05 encumbrance
     matchwait 3
     return
ASSESS_RETURN:
     eval facing replacere("%facing", "^(\S+ )(?=\S+ \S+)", "")
     if ("$guild" = "Empath") && ($UC_ConstructOnly = 1) && ("%facing" = "NULL") then
          {
               if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then return
               put face next
               wait
               pause 0.2
               goto ASSESS_1
          }
     return
ASSESS_SET:
     if ("$guild" != "Empath") then goto FACE_NEXT
     if matchre("%critterList", "(?i)(%Construct|%Undead)") then var Empath.Critter $1
     eval Empath.Critter replacere("%Empath.Critter", "^(\S+ )(?=\S+ \S+)", "")
     eval Attack.Critter replacere("%Empath.Critter", "([\w'-]+\s){0,5}", "")
     # eval Empath.Critter replacere("%Empath.Critter",".*\s((?:Endrus )?(\w+)).?$", "\$0")
     delay 0.00001
     if !matchre("%critterList", "(?i)(%Construct|%Undead)") then var Empath.Critter NULL
     # if (("%Empath.Critter" = "NULL") && (%Empath.Brawl = 1)) then goto ADVANCE
     # if (%Empath.Brawl = 1) then goto ADVANCE
     ### EMPATH CONSTRUCT CHECKS
     if matchre("%facing", "(?i)%Construct") then goto ADVANCE
     if (matchre("%facing", "(?i)%Undead") && ($spellABSOLUTION = 1)) then goto ADVANCE
     # if !matchre("$monsterlist", "(?i)%Construct|%Undead") then goto PREEMPATHBRAWLING
     if matchre("%facing", "(?i)%Undead|%Construct") then goto ADVANCE
     # if matchre("%Empath.Critter", "(?i)Endrus serpent") then goto FACE_IT
     # if !matchre("%Empath.Critter", "(?i)%Undead|%Construct") && matchre("$monsterlist", "%Construct|%Undead") then goto EMPATH_FACE
     # if !matchre("%Empath.Critter", "(?i)%Construct|%Undead") then goto EMPATH_FACE
FACE_IT:
     delay 0.00001
     var LOCATION FACE_IT
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then return
     if (("$guild" = "Empath") && matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
     if (("$guild" = "Empath") && matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION 250
     if (("$guild" = "Empath") && matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION 150
     if matchre("%critterList", "(?i)(%Construct|%Undead)") && !matchre("%facing", "(?i)%Undead|%Construct")) then goto CONSTRUCT_FACE
     if ($UC_ConstructOnly = 1) then
          {
               if (matchre("%facing", "%Undead") && ($spellABSOLUTION = 1)) then
                    {
                         echo ** FIGHTING UNDEAD!
                         echo ** FACING: %facing
                         goto ADVANCE
                    }
               if matchre("%facing", "%Construct") then
                    {
                         echo ** FIGHTING CONSTRUCT!
                         echo ** FACING: %facing
                         goto CONSTRUCT_FACE
                    }
                if matchre("%facing", "%noUndead") then
                    {
                         var Empath.Brawl 1
                         echo ** BRAWLING WITH LIVE CREATURE!
                         echo ** FACING: %facing
                         goto ADVANCE
                    }
          }
     return

FACE_NEXT:
     delay 0.00001
     var LOCATION FACE_NEXT
     var newdead 0
     if ($standing = 0) then gosub STAND
     if ($monstercount < 2) then return
     if (("$guild" = "Empath") && ($UC_ConstructOnly = 1)) then goto FACE_IT
     if ("$guild" = "Necromancer") then goto NECRO_FACE
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre ADVANCE You turn to face|You are already
     matchre EMPATH_ASSESS_RETURN nothing else to|Face what
     matchre EMPATH_ASSESS_RETURN ^What's the point in facing
     put face next
     matchwait 20
     return
EMPATH_FACE:
     var LOCATION EMPATH_FACE
     if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
     if (matchre("$monsterlist", "%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION 150
     delay 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre ASSESS You turn to face|You are already
     matchre EMPATH_ASSESS_RETURN nothing else to|Face what
     matchre ASSESS ^What's the point in facing
     put face next
     matchwait 20
CONSTRUCT_FACE:
     delay 0.00001
     var LOCATION CONSTRUCT_FACE
     if ($standing = 0) then gosub STAND
     if (($monstercount = 0) || !matchre("$roomobjs", "(?i)%critters")) then return
     if ("$guild" = "Necromancer") then goto NECRO_FACE
     if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
     if (matchre("$monsterlist", "%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1)) then gosub BUFF ABSOLUTION 150
     pause 0.01
     if (("$guild" = "Empath") && matchre("%facing", "%Undead|%Construct")) then goto CONSTRUCT_ADVANCE
     # if !matchre("$monsterlist", "\b(%Construct)\b") then return
     # if ("$guild" = "Empath") && matchre("$monsterlist", "%Construct") then goto EMPATH_FACE
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre CONSTRUCT_ADVANCE You turn to face|You are already
     matchre EMPATH_ASSESS_RETURN nothing else to|^Face what\?
     matchre EMPATH_FACE ^What's the point in facing
     matchre FACE_RETREAT ^You are too closely
     if !matchre("%Empath.Critter", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put face %Attack.Critter
     else put face %Critter
     matchwait 20
     return
CONSTRUCT_ADVANCE:
     if (("$guild" = "Empath") && (%Empath.Brawl = 0) && !matchre("%facing", "(%Undead|%Construct)")) then goto ASSESS
	else goto ADVANCE
FACE_RETREAT:
     delay 0.00001
     var LOCATION FACE_RETREAT
     matchre FACE_RETREAT ^You retreat back
     matchre FACE_RETREAT ^You stop advancing
     matchre CONSTRUCT_FACE ^You retreat from
     matchre FACE_RETREAT ^Roundtime
     send retreat
     matchwait 20
     goto CONSTRUCT_FACE
NECRO_FACE:
     delay 0.00001
     var LOCATION NECRO_FACE
     matchre CHECK_ROOM nothing else to|Face what|You turn to face .* construct
     matchre RETURN ^You turn to face
     matchre RETURN ^What's the point in facing
     put face next
     matchwait 20
     return
EMPATH_ASSESS_RETURN:
     if (("$guild" = "Empath") && ($UC_ConstructOnly = 1)) then
          {
               if (matchre("%CurrentSpell", "(?i)(%TM.Spell.List|%Debil.Spell.List)") && !matchre("%TM.Target", "(?i)(%Undead|%Construct)") && matchre("$monsterlist", "(?i)(%Undead|%Construct)")) then
                    {
                         if !matchre("%Empath.Critter", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put target %Empath.Critter
                         pause 6
                    }
               if (matchre("%CurrentSpell", "(?i)(%TM.Spell.List|%Debil.Spell.List)") && !matchre("$monsterlist", "(?i)(%Undead|%Construct)")) then
                    {
                         echo ###################################################
                         echo ** NOPE! %CurrentSpell SPELL WILL CAUSE EMPATHIC SHOCK!!! - SKIPPING
                         echo ###################################################
                         pause 0.2
                         gosub RELEASE spell
                    }
          }
     return
#### SINGLE ADVANCE
ADVANCE:
     delay 0.00001
     if ($standing = 0) then gosub STAND
     if (("$guild" = "Paladin") && ($hidden = 1)) then gosub UNHIDE
     if (($monstercount = 0) || !matchre("$roomobjs", "(?i)%critters")) then return
     var LOCATION ADVANCE_1
     ADVANCE_1:
     delay 0.00001
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if ("$guild" = "Necromancer") then goto ADVANCE_NECRO
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^You begin to advance
     matchre RETURN ^You begin to stealthily advance
     matchre RETURN ^.* stops you from advancing any farther\!
     matchre RETURN ^.* closes to melee range on you\!
     matchre RETURN ^You close to melee range on .*\.
     matchre RETURN ^You are already at melee with .*
     matchre RETURN You are already at melee
     matchre RETURN ^You are already advancing
     matchre RETURN \[You\'re
     matchre RETURN ^You turn
     matchre FACE_RETURN ^What do you want to advance towards\?
     matchre ASSESS ^You stop advancing|^You have lost sight
     send advance
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN ADVANCE! (%scriptname.cmd) ***
     put #log $datetime MISSING MATCH IN ADVANCE (%scriptname.cmd)
     goto ADVANCE_1
FACE_RETURN:
     if ("$guild" = "Empath") then gosub ASSESS
     if ("$guild" != "Empath") then put face next
     pause 0.1
     return
#### SINGLE ADVANCE
ADVANCE_NECRO:
     delay 0.00001
     if ($standing = 0) then gosub STAND
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then return
     var LOCATION ADVANCE_NECRO
     ADVANCE_NECRO_1:
     delay 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RET_ADV ^You begin to advance on a .+ dirt construct\.|^You are already advancing on a .+ dirt construct\.
     matchre RETURN ^You begin to advance
     matchre RETURN ^You begin to stealthily advance
     matchre RETURN ^.* stops you from advancing any farther\!
     matchre RETURN ^.* closes to melee range on you\!
     matchre RETURN ^You close to melee range on .*\.
     matchre RETURN ^You are already at melee with .*\.
     matchre RETURN ^You are already advancing
     matchre RETURN ^What do you want to advance towards\?
     matchre ASSESS ^You stop advancing|^You have lost sight
     send advance
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN ADVANCE! (%scriptname.cmd) ***
     put #log $datetime MISSING MATCH IN ADVANCE (%scriptname.cmd)
     return
RET_ADV:
     gosub retreat
     gosub retreat
     goto FACE_IT
#### ROOM CHECK
CHECK_ROOM:
     var LAST CHECK_ROOM
     if ($standing = 0) then gosub STAND
     if (($hidden = 1) && ("$guild" = "Paladin")) then put unhide
     if (("$guild" = "Necromancer") && matchre("$monsterlist", "dirt construct")) then return
     if matchre("$monsterlist", "\b(%nonskinnablecritters|%skinnablecritters|%invasioncritters)\b") then goto ADVANCE
     if ($monsterlist) then gosub ASSESS
     return
#### WAIT FOR STAMINA
STAMINA_WAIT:
     if ($stamina > 90) then return
     if ($standing = 0) then gosub STAND
     echo ############################
     echo **** STAMINA TOO LOW! ****
     echo **** WAITING TO REGAIN FATIGUE ****
     echo ############################
     pause 0.2
     pause 0.0001
     if ("$guild" = "Barbarian") then
          {
               put berserk avalanche
               pause 0.5
          }
     if (("$guild" = "Paladin") && ($circle >= 25)) then
          {
               put glyph ease $charactername
               pause 0.5
          }
     if (("$guild" = "Empath") && matchre("%abbrevs", "(?i)REFRESH") && ($SpellTimer.Refresh.active = 0)) then
          {
               gosub PREPARE refresh
               pause 16
               gosub SPELL_CAST
          }
     if ($stamina <= 90) then
          {
               gosub PUT bob
               gosub PUT circle
               gosub PUT bob
               gosub PUT bob
               gosub PUT circle
               gosub PUT bob
          }
     if (matchre("$roomobjs", "(?i)((?:which|that) appears dead|\(dead\)|pile of (rubble|broken ice)|icy blue crystal|small sand dune|smoldering bones)") then gosub CHECKDEAD
     if ($stamina > 90) then return
     pause 2
     if ($stamina <= 90) then
          {
               gosub PUT bob
               gosub PUT circle
               gosub PUT bob
               gosub PUT bob
               gosub PUT circle
               gosub PUT bob
          }
     pause 2
     if ($stamina > 90) then return
     pause 2
     if ($stamina > 90) then return
     goto STAMINA_WAIT
     return
#### OPEN CONTAINERS
OPEN:
     var thing $0
OPEN_1:
     if matchre("%thing", "(?i)(NULL|OFF)") then return
     matchre OPEN_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre RETURN (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre RETURN ^It would be a shame|It's already open\!|^Brushing your fingers|There are already openings|Sensing your intent
     matchre RETURN ^That is already|^I could not|^What were you|^The .* (is already|has been)|^Using|^This is probably not
     matchre RETURN ^That (?:is|has) already|^(.+) what\?
     matchre RETURN ^Your .* is already
     matchre RETURN ^The .* (is|has|are|slides|fades|hinges)
     matchre RETURN ^With a practiced flick of your wrist|The vines are already|The antique hinges|^Brushing your fingers|There are already openings|Sensing your intent
     put open my %thing
     matchwait 7
     ## put #echo >Log #ff0000 ** Missing Match in OPEN: (ubercombat.cmd)
     return
### SUPER QUICK OPEN AND RETURN NO MATCH
OPENIT:
     var thing $0
OPENIT_1:
     pause 0.0001
     if matchre("%thing", "(?i)(NULL|OFF)") then return
     put open my %thing
     pause 0.1
     pause 0.0001
     return
######################################################################
#### Swappable Weapon State
SWAPPABLE:
     delay 0.00001
     var swapcount 0
     var POSITION-DIRECTION null
     var POSITION-DIRECTION2 null
     var POSITION-DIRECTION3 null
     if matchre("$righthand", "icy-blue blade") then goto ICYBLADE_ASSESS
     if ("%LEARNING" = "Offhand_Weapon") then return
     if matchre("%WEAPON_EXP","Offhand_Weapon") then return
     action (buffs) off
SWAPPABLE_1:
     delay 0.00001
     var LOCATION SWAPPABLE_1
     # if ("$lefthand" = "(?i)%WEAPON") then gosub SWAP
     if !matchre("$lefthand", "Empty") then gosub STOW $lefthandnoun
     if !matchre("(?i)%WEAPON", "$charactername|NULL") && !matchre("$righthand", "(?i)%WEAPON") then gosub WIELD %WEAPON
     if ($standing = 0) then gosub STAND
     if matchre("$righthandnoun $lefthandnoun", "fan") then goto SWAPPABLE_OPEN
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.|you don't feel like fighting
     matchre SWAPPABLE_FAIL You move a .* to your left hand
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SWAPPABLE_OPEN ^You'll need to open or close
     matchre SWAPPABLE_SETPOSITION ^(?:Silver light kisses .*|(?:You (?:switch|deftly|turn|shift|fiercely))) .* (?:a)? (.*) (?:a|and) (.*)\.
     matchre SWAPPABLE_SETPOSITION ^(?:Poised) .* (?:it|a) (.*) and .*
     matchre SWAPPABLE_SETPOSITION ^(?:With|Your) .* (?:it|as?|and) (.*) (on|in front of) your (?:\S+) (?!so it can).
     matchre SWAPPABLE_SETPOSITION ^(?:The|You|With|Your(?! eyes blaze)|Stepping|Silver|switch|shift) (?!(feel|.+ is still a distance|glance|draw|web|begins)).* (?:to(?=.*weapon(?! range))(?! glide| grow)|it|a|and) (.*) (?:and) (.*)\.
     matchre SWAPPABLE_SETPOSITION ^(?:The|You|With|Your(?! eyes blaze)|Stepping|Silver|switch|shift) (?!feel).* (?:to(?=.*weapon(?! range))(?! glide| grow)|it|a|and) (.*) (?:while quietly paying homage to the war gods)\.
     matchre SWAPPABLE_SETPOSITION ^(?:The|You|With|Your(?! eyes blaze)|Stepping|Silver|switch|shift) (?!(feel|.+ is still a distance|glance|draw|web|begins)).* (?:to(?=.*weapon(?! range))(?! glide| grow)|it|a|and) (?!position )(.*)
     matchre SWAPPABLE_SETPOSITION ^(?:The|You|With|Your(?! eyes blaze)|Stepping|Silver|switch|shift) (?!(feel|.+ is still a distance|glance|draw|web|begins)).* (?:to(?=.*weapon(?! range))(?! glide| grow)|it|a|and) (?!position )(.*)(?:while quietly paying homage to the war gods)?
     matchre RETURN ^Will alone cannot conquer the paralysis that has wracked your body
     put swap my $righthandnoun
     matchwait
SWAPPABLE_OPEN:
     delay 0.0001
     matchre SWAPPABLE_SETPOSITION ^Your? .* grip .* a (.*)\.
     matchre SWAPPABLE_SETPOSITION ^You .* to a grip for using your .* as a (.*)\.
     matchre SWAPPABLE_SETPOSITION ^You switch your .* so that you can use it as a (.*)\.
     matchre SWAPPABLE_SETPOSITION ^You .* easily in your hands and end with it in position to be used as a (.*)\.
     matchre SWAPPABLE_SETPOSITION you adjust your grip on your fan so it can be used as a (.*)\.
     matchre SWAPPABLE_SETPOSITION grip your fan so it can be used as a (.*)\.
     matchre SWAPPABLE_CLOSE ^Your .* is already open\.
     # matchre SWAPPABLE_CLOSE ^With a practiced flick of your wrist\, you snap open your .*
     put open my $righthandnoun
     matchwait 20
     goto SWAPPABLE_CLOSE
SWAPPABLE_CLOSE:
     delay 0.0001
     matchre SWAPPABLE_SETPOSITION ^Your? .* grip .* a (.*)\.
     matchre SWAPPABLE_SETPOSITION ^You .* to a grip for using your .* as a (.*)\.
     matchre SWAPPABLE_SETPOSITION ^You switch your .* so that you can use it as a (.*)\.
     matchre SWAPPABLE_SETPOSITION ^You .* easily in your hands and end with it in position to be used as a (.*)\.
     matchre SWAPPABLE_SETPOSITION you adjust your grip on your fan so it can be used as a (.*)\.
     matchre SWAPPABLE_SETPOSITION grip your fan so it can be used as a (.*)\.
     matchre SWAPPABLE_OPEN Your .* is already closed\.
     # matchre SWAPPABLE_OPEN ^With a practiced flick of your wrist\, you snap your .* closed\.
     put close my $righthandnoun
     matchwait 20
     goto SWAPPABLE_OPEN
SWAPPABLE_SETPOSITION:
     var POSITION-DIRECTION $1
     var POSITION-DIRECTION2 $2
     var POSITION-DIRECTION3 $2
     var POSITIONS %POSITION-DIRECTION|%POSITION-DIRECTION2|%POSITION-DIRECTION3
     math swapcount add 1
     echo *** SWAPPABLE POSITION: %POSITION-DIRECTION
     echo *** Positions: %POSITIONS
     delay 0.0001
     pause 0.0001
     if matchre("%WEAPON_EXP","^(Heavy_Thrown|Light_Thrown)") then goto SWAPPABLE_THROWNCHECK
     if matchre("%POSITIONS", "two-handed\.") then put #tvar UC_swappable-state Twohanded_Edged
     if matchre("%POSITIONS", "one-handed\.") then put #tvar UC_swappable-state Large_Edged
     if matchre("%POSITIONS", "two-handed blunt(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Twohanded_Blunt
     if matchre("%POSITIONS", "two-handed edged(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Twohanded_Edged
     if matchre("%POSITIONS", "heavy blunt(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Large_Blunt
     if matchre("%POSITIONS", "short staff(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Staves
     if matchre("%POSITIONS", "staves?(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Staves
     if matchre("%POSITIONS", "quarter staff(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Staves
     if matchre("%POSITIONS", "pike(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Polearms
     if matchre("%POSITIONS", "halberds?(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Polearms
     if matchre("%POSITIONS", "heavy edged(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Large_Edged
     if matchre("%POSITIONS", "medium edged(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Small_Edged
     if matchre("%POSITIONS", "light edged(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Small_Edged
     if matchre("%POSITIONS", "light thrown(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Small_Edged
     if matchre("%POSITIONS", "light blunt(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Small_Blunt
     if matchre("%POSITIONS", "medium blunt(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Small_Blunt
     goto SWAPPABLE_RETURN
SWAPPABLE_THROWNCHECK:
     if matchre("%POSITIONS", "two-handed\.") then put #tvar UC_swappable-state Heavy_Thrown
     if matchre("%POSITIONS", "one-handed\.") then put #tvar UC_swappable-state Light_Thrown
     if matchre("%POSITIONS", "heavy edged(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Heavy_Thrown
     if matchre("%POSITIONS", "medium edged(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Heavy_Thrown
     if matchre("%POSITIONS", "light edged(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Light_Thrown
     if matchre("%POSITIONS", "light thrown(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Light_Thrown
     if matchre("%POSITIONS", "heavy thrown(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Heavy_Thrown
     if matchre("%POSITIONS", "light blunt(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Light_Thrown
     if matchre("%POSITIONS", "heavy blunt(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Heavy_Thrown
     if matchre("%POSITIONS", "medium blunt(?: weapon| grip)?\.?") then put #tvar UC_swappable-state Heavy_Thrown
SWAPPABLE_RETURN:
     delay 0.00001
     if (("$guild" != "Barbarian") && ("%LEARNING" = "Offhand_Weapon") && matchre("$UC_swappable-state", "(Twohanded_Edged|Twohanded_Blunt|Large_Blunt|Large_Edged)") && (%swapcount > 1)) then goto OFFHAND_ERROR
     if (("$guild" = "Barbarian") && ("%LEARNING" = "Offhand_Weapon") && matchre("$UC_swappable-state", "(Twohanded_Edged|Twohanded_Blunt)") && (%swapcount > 1)) then goto OFFHAND_ERROR
     if (%swapcount > 5) then debug 5
     if (%swapcount > 11) then goto SWAPPABLE_ERROR_2
     if ("%LEARNING" = "Offhand_Weapon") then return
     if ("$UC_swappable-state" != "%LEARNING") then goto SWAPPABLE_1
     action (buffs) on
     return
SWAPPABLE_ERROR_2:
     delay 0.0001
     echo ###############################
     echo *** SWAP ERROR! UNKNOWN SWAPPABLE WEAPON TEXT!
     echo *** ~OR~ YOU SET THE WRONG WEAPON FOR THIS WEAPON SKILL!
     echo *** TARGET WEAPON SKILL: %LEARNING | WEAPON: %WEAPON
     echo ###############################
     echo *** CHECK YOUR VARIABLES TO MAKE SURE
     echo *** YOU HAVE THE CORRECT WEAPON SET FOR EACH SKILL!
     echo *** SEND THE WEAPON SWAPPING DEBUG LOG IF IT PERSISTS
     echo ###############################
     put #echo >Log #FF1192 *** Swappable Weapon Error! Check variables are correct
     pause 3
     goto SWITCH
SWAPPABLE_FAIL:
     delay 0.0001
     pause 0.1
     pause 0.1
     put #echo Crimson  Non-swappable Weapon!
     put #echo >Log Crimson *** Non-swappable Weapon!
     put #log $datetime Non-swappable Weapon!
     send swap
     pause 0.3
     pause 0.3
     action (buffs) on
     return

ICYBLADE_ASSESS:
     var icyblade large edged
     delay 0.0001
     delay 0.0001
     matchre ICYBLADE_ASSESS ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre ICYBLADE_MAX ^It resists\, since it\'s extended
     matchre ICYBLADE_ASSESS ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre ICYBLADE_ASSESS ^A sound like
     matchre RETURN ^I could not|^What were
     put pull my icy-blue blade
     matchwait 20
     goto ICYBLADE_ASSESS
ICYBLADE_MAX:
     pause 0.0001
     if ("%LEARNING" = "Small_Edged") then
          {
               var icyblade small edged
               send push my icy-blue blade
               pause
               pause 0.5
          }
ICYBLADE_DONE:
     echo #################
     echo ** SWAPPED ICY-BLUE BLADE
     echo ** TO: %icyblade
     echo #################
     return
#### KATAVDAR TAILBAND RESET
KAT_RESET:
if matchre("$lefthand", "katavdar") then
     {
          send swap
          pause 0.5
          pause 0.2
     }
if !matchre("$lefthand", "Empty") then gosub STOWIT left
delay 0.0001
delay 0.0001
if matchre("$righthand $lefthand", "(heavy steel|polished brass|thick copper|brushed bronze|(?<!dark |rippled |desert-tan )steel) katavdar") then
     {
          if matchre("%TRAINING", "Heavy_Thrown") then
               {
                    var HTWEAPON tailband
                    put #var UC_WEAPON_HT tailband
               }
          if matchre("%TRAINING", "Large_Edged") then
               {
                    var LEWEAPON tailband
                    put #var UC_WEAPON_LE tailband
               }
     }
if matchre("$righthand $lefthand", "(golden|(dark |rippled )steel|bark|coral) katavdar") then
     {
          if matchre("%TRAINING", "Light_Thrown") then
               {
                    var LTWEAPON tailband
                    put #var UC_WEAPON_LT tailband
               }
          if matchre("%TRAINING", "Large_Blunt") then
               {
                    var LBWEAPON tailband
                    put #var UC_WEAPON_LB tailband
               }
     }
if matchre("$righthand $lefthand", "(gloomwood|haralun|pink|desert-tan steel|platinum-washed) katavdar") then
     {
          if matchre("%TRAINING", "Heavy_Thrown") then
               {
                    var HTWEAPON tailband
                    put #var UC_WEAPON_HT tailband
               }
          if matchre("%TRAINING", "Large_Blunt") then
               {
                    var LBWEAPON tailband
                    put #var UC_WEAPON_LB tailband
               }
     }
     var WEAPON tailband
     echo ##########################
     echo ** Shifting Katavdar back to Tailband
     echo ##########################
     delay 0.0001
     delay 0.0001
     put turn my katav
     pause 0.2
     pause 0.1
     pause 0.1
     delay 0.0001
     gosub WEAR tailband
     delay 0.0001
     return
#### EXOSKELETAL WEAPONS RESET
EXO_RESET:
    action var Exo.Type $1 when ^You shake your .+ causing it to break apart into thousands of live spiders\.\s+The swarm of arachnids scuttles quickly up your arm, nestling themselves on your person until they finally melt and coagulate into a (.*)\.$
    if matchre("$righthand $lefthand", "exoskeletal (ritual dagger|sword|mace|rapier|maul|scimitar|longsword|katar|claymore|broadsword|axe|bludgeon|hammer|nightstick|pike|halberd|morning star|battle axe)") then var morph $1
         {
          pause 0.00001
          put shake my %morph
          pause 0.3
          pause 0.2
          pause 0.00001
          pause 0.00001
          pause 0.00001
          echo **** EXO JEWELRY TYPE: %Exo.Type
          pause 0.00001
          if matchre("%Exo.Type", "eyebrow ring") then
               {
                    var WEAPON eyebrow ring
                    var THBWEAPON eyebrow ring
                    put #var UC_WEAPON_THB %THBWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "ebony anklet") then
               {
                    var WEAPON ebony anklet
                    var HBWEAPON ebony anklet
                    put #var UC_WEAPON_HB %HBWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "ear stud") then
               {
                    var WEAPON ear stud
                    var HEWEAPON ear stud
                    put #var UC_WEAPON_HE %HEWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "spider ring") then
               {
                    var WEAPON spider ring
                    var STAVES spider ring
                    put #var UC_WEAPON_STAVES %STAVES
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "bone torque") then
               {
                    var WEAPON bone torque
                    var STAVES bone torque
                    put #var UC_WEAPON_STAVES %STAVES
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "ebony hairpin") then
               {
                    var WEAPON ebony hairpin
                    var THEWEAPON ebony hairpin
                    put #var UC_WEAPON_THE %THEWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "ebony thighband") then
               {
                    var WEAPON ebony thighband
                    var SBWEAPON ebony thighband
                    put #var UC_WEAPON_SB %SBWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "ebony earcuff") then
               {
                    var WEAPON ebony earcuff
                    var SEWEAPON ebony earcuff
                    put #var UC_WEAPON_SE %SEWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "ebony amulet") then
               {
                    var WEAPON ebony amulet
                    var SBWEAPON ebony amulet
                    put #var UC_WEAPON_SB %SBWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "thick armband") then
               {
                    var WEAPON thick armband
                    var SEWEAPON thick armband
                    put #var UC_WEAPON_SE %SEWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "thin anklet") then
               {
                    var WEAPON thin anklet
                    var SBWEAPON thin anklet
                    put #var UC_WEAPON_SB %SBWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "ebony skull") then
               {
                    var WEAPON ebony skull
                    var LEWEAPON ebony skull
                    put #var UC_WEAPON_LE %LEWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "ebony ring") then
               {
                    var WEAPON ebony ring
                    var THEWEAPON ebony ring
                    put #var UC_WEAPON_THE %THEWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "silver pendant") then
               {
                    var WEAPON silver pendant
                    var LBWEAPON silver pendant
                    put #var UC_WEAPON_LB %LBWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "scarab amulet") then
               {
                    var WEAPON scarab amulet
                    var SEWEAPON scarab amulet
                    put #var UC_WEAPON_SE %SEWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "snake ring") then
               {
                    var WEAPON snake ring
                    var LEWEAPON snake ring
                    put #var UC_WEAPON_LE %LEWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "black armband") then
               {
                    var WEAPON black armband
                    var THBWEAPON black armband
                    put #var UC_WEAPON_THB %THBWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "lizard wristcuff") then
               {
                    var WEAPON lizard wristcuff
                    var SEWEAPON lizard wristcuff
                    put #var UC_WEAPON_SE %SEWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "cascading earrings") then
               {
                    var WEAPON carcading earrings
                    var POLEARMS cascading earrings
                    put #var UC_WEAPON_POLEARMS %POLEARMS
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "crudely-hewn band") then
               {
                    var WEAPON crudely-hewn band
                    var POLEARMS crudely-hewn band
                    put #var UC_WEAPON_POLEARMS %POLEARMS
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "iron armband") then
               {
                    var WEAPON iron armband
                    var THBWEAPON iron armband
                    put #var UC_WEAPON_THB %THBWEAPON
                    goto EXO_RESET_END
               }
          if matchre("%Exo.Type", "diacan ring") then
               {
                    var WEAPON diacan ring
                    var THBWEAPON diacan ring
                    put #var UC_WEAPON_THB %THBWEAPON
                    goto EXO_RESET_END
               }
          }
EXO_RESET_END:
     unvar morph
     return
####################################################################
STAND_RET:
     pause 0.00001
     pause 0.00001
     pause 0.00001
     pause 0.00001
     put stand
     pause 0.1
     pause 0.0001
RETREAT_PAUSE:
     pause 0.2
     pause 0.1
     pause 0.00001
RETREAT:
     var retreatloop 0
1RETREAT:
     delay 0.00001
     math retreatloop add 1
     var LOCATION RETREAT
     if (%retreatloop > 5) then goto RETREAT_RETURN
     if ($standing = 0) then gosub STAND
     matchre RETREAT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETREAT ^You stop advancing
     matchre 2RETREAT ^You retreat back to pole range\.
     matchre 2RETREAT ^You sneak back out
     matchre STAND_RET ^You must stand first\.
     matchre RETURN ^You retreat from combat\.
     matchre RETURN ^You are already as far away as you can get\!
     matchre RETURN ^You stop
     matchre 1RETREAT ^You try to
     matchre 1RETREAT revealing your hiding place\!
     put retreat
     matchwait 20
     put #echo >Log Crimson *** MISSING MATCH IN RETREAT! (ubercombat.cmd) ***
     put #log $datetime MISSING MATCH IN RETREAT (ubercombat.cmd)
2RETREAT:
     delay 0.00001
     var LOCATION 2RETREAT
     math retreatloop add 1
     if ($standing = 0) then gosub STAND
     if (%retreatloop > 6) then goto RETREAT_RETURN
     matchre 2RETREAT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^You stop advancing
     matchre RETURN ^You retreat from combat\.
     matchre RETURN ^You retreat back to pole range\.
     matchre RETURN ^You sneak back out
     matchre RETURN ^You are already as far away as you can get\!
     matchre RETURN ^You stop
     matchre 2RETREAT ^You try to
     matchre 2RETREAT revealing your hiding place\!
     put retreat
     matchwait 20
     goto retry
     put #echo >Log Crimson *** MISSING MATCH IN RETREAT! (ubercombat.cmd) ***
     put #log $datetime MISSING MATCH IN RETREAT (ubercombat.cmd)
     return
RETREAT_RETURN:
     pause 0.0001
     unvar retreatloop
     return
RETREAT_FLEE:
     var retreatloop 0
RETREAT_FLEE_1:
     var LOCATION RETREAT_FLEE_1
     math retreatloop add 1
     delay 0.00001
     if ($standing = 0) then gosub STAND
     if (%retreatloop > 6) then goto FLEE_NOW
     matchre RETREAT_FLEE_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETREAT_FLEE_1 ^You stop advancing
     matchre RETREAT_FLEE_1 ^You retreat back to pole range\.
     matchre RETREAT_FLEE_1 ^You sneak back out
     matchre RETREAT_FLEE_1 ^You must stand first\.
     matchre RETREAT_FLEE_1 ^You stop
     matchre RETREAT_FLEE_1 ^You try to
     matchre RETREAT_FLEE_1 revealing your hiding place\!
     matchre RETURN ^You retreat from combat\.
     matchre RETURN ^You are already as far away as you can get\!
     put retreat
     matchwait 20
     put #echo >Log Crimson *** MISSING MATCH IN RETREAT_FLEE_1! (ubercombat.cmd) ***
     put #log $datetime MISSING MATCH IN RETREAT_FLEE_1 (ubercombat.cmd)
FLEE_NOW:
     delay 0.00001
     unvar retreatloop
     if ($standing = 0) then gosub STAND
     pause 0.0001
     matchre RETURN ^Obvious|Roundtime|^A master|^Your?
     put flee
     matchwait 5
     return
### DUMP JUNK #####
DUMP_JUNK:
     delay 0.00001
     if ($standing = 0) then gosub STAND
     matchre DUMP_JUNK ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre RETURN ^You should just kick yourself in the shin\.  There is no junk here\.
     matchre RETURN ^The janitor was recently summoned to this room\.\s+Please wait \d+ seconds\.
     matchre RETURN ^\[You have marked this room to be cleaned by the janitor\.  It should arrive shortly\.\]
     matchre RETURN ^You should reveal yourself first\.
     send dump junk
     matchwait 5
     return
HUNT:
     delay 0.00001
     var LOCATION HUNT_1
     HUNT_1:
     if ($standing = 0) then gosub STAND
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^You take note of all the tracks in the area\, so that you can hunt anything nearby down\.
     matchre RETURN ^You find yourself unable to hunt in this area\.
     send hunt
     matchwait 5
     return
APP:
APPRAISE:
APPRAISE_CRITTER:
     delay 0.0001
     if ($standing = 0) then gosub STAND
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then return
     gosub GET_MONSTER_NAME
APPRAISE_CRITTER_1:
     delay 0.00001
     var LOCATION APPRAISE_CRITTER_2
     eval Critter.Noun replacere("%Critter", "([\w'-]+\s){0,5}", "")
     if ($Appraisal.Ranks > 1749) then return
     if ("$guild" = "Thief") then
          {
               send mark all %Critter.Noun
               pause 1
               pause 0.1
          }
APPRAISE_CRITTER_2:
     if ($Appraisal.LearningRate > 32) then return
     if ($Appraisal.Ranks < 76) then
          {
               put appraise my %CHEST.ARMOR
               pause 0.5
               pause 0.3
               return
          }
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^It's dead\!
     matchre RETURN ^Appraise what\?
     matchre RETURN ^You cannot appraise that when you are in combat\!
     matchre RETURN ^You can't determine anything about this creature\.
     matchre RETURN ^You ponder that\, briefly\, but decide to let it go for now\.
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     send appraise %Critter.Noun quick
     matchwait 20
     return
STEADY_UP:
     pause 0.0001
     if ("$guild" = "Thief") then
          {
               put khri steady
               pause 2
               pause 0.1
          }
     if ("$guild" = "Ranger") then gosub BUFF STW 20
     goto LOAD
STOW_LOAD:
     gosub STOWIT left
LOAD:
     action (retreat) on
     var LOCATION LOAD_1
     var loadfail 0
     delay 0.00001
     if ("$guild" = "Barbarian") then
     {
          if (matchre("%barbEagle", "(ON|1|YES)") && ($barbEagle = 0) && ($mana > 2)) then
               {
                    put form eagle
                    pause 0.5
                    put #var barbEagle 1
               }
     }
     if matchre("$lefthand", "%WEAPON_NOUN") then gosub SWAP
     if (matchre("$righthand", "(?i)%WEAPON_NOUN") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
     if matchre("$righthand", "\b(bolt|arrow|rock|shard)\b") then gosub STOWIT $righthand
     if !matchre("$righthand", "%WEAPON_NOUN") then gosub WIELD %WEAPON
     delay 0.00001
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if ($standing = 0) then gosub STAND
     gosub RETRIEVE_CHECK
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if matchre("$righthand", "(repeating crossbow|repeating arbalest|marksman's arbalest|riot crossbow)") then goto AIM_PREP
     pause 0.0001
     LOAD_1:
     matchre LOAD_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STOW_LOAD ^You can not load the .* in your left hand\!
     matchre LOAD_STOW_ARM_WORN ^You cannot manage to load your
     matchre LOAD_2 ^What weapon are you
     matchre LOAD_ALT ^You can't load the .* silly\!
     matchre STEADY_UP ^Such a feat
     matchre LOAD_2 ^You are not skilled enough
     matchre AIM ^You (reach|carefully|load)
     matchre AIM ^Your .* makes the task more difficult
     matchre AIM ^You load .* in your hand\.
     matchre AIM ^.* is already loaded with
     matchre AIM ^\[Roundtime|^Roundtime|^\(Roundtime
     matchre LOAD_ALT ^You can not load the .* with
     matchre LOAD2 ^The .*  must be in your inventory
     matchre LOAD_RETRIEVE ^You don't have the (?:right|proper) ammunition
     matchre LOAD_RETRIEVE ^As you try to
     matchre LOAD_RETRIEVE ^You must be|your hand jams|^You can not load
     matchre LOAD_STOW ^.* in your left hand
     if (matchre("$righthand", "(spiritwood|reflex|sandstone|quartz) (longbow|bow|shortbow|short bow)") && !matchre("$righthandnoun", "(lockbow|crossbow|stonebow|pelletbow|arbalest|slurbow)")) then
          {
               send load my $righthand
               matchwait 4
          }
     if (("$guild" = "Ranger") && matchre("$righthandnoun", "(bow|shortbow|longbow|short bow|long bow)") && !matchre("$righthandnoun", "(lockbow|crossbow|stonebow|pelletbow|latchbow|arbalest|slurbow)") && ($Bow.Ranks > 200)) then
          {
          if ($spellSTW = 1) then
               {
                    send load arrows
                    matchwait 4
               }
          }
     if (("$guild" = "Barbarian") && matchre("$righthandnoun", "(bow|shortbow|longbow|short bow|long bow)") && !matchre("$righthandnoun", "(lockbow|crossbow|stonebow|pelletbow|latchbow|arbalest|slurbow)") && ($Bow.Ranks > 200)) then
          {
          if ($barbEagle = 1) then
               {
                    send load arrows
                    matchwait 4
               }
          }
     if (("$guild" = "Thief") && matchre("$righthandnoun", "\b(bow|shortbow|longbow|short bow|long bow)\b") && !matchre("$righthandnoun", "(lockbow|crossbow|stonebow|pelletbow|latchbow|arbalest|slurbow)") && ($Bow.Ranks > 200)) then
          {
          if ($khriSTEADY = 1) then
               {
                    send load arrows
                    matchwait 4
               }
          }
LOAD_2:
     var LOCATION LOAD_2
     matchre LOAD_2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre LOAD_STOW_ARM_WORN ^You cannot manage to load your
     matchre STEADY_UP ^Such a feat
     matchre LOAD_2 ^You are not skilled enough
     matchre AIM ^You (reach|carefully|load)
     matchre AIM ^You load .* in your hand\.
     matchre AIM ^.* is already loaded with
     matchre AIM ^\[Roundtime|^Roundtime|^\(Roundtime
     matchre AIM makes the task more difficult
     matchre LOAD_3 ^What weapon are you
     matchre LOAD_3 ^You can not load the .* with
     matchre LOAD_3 ^You can't load the .*
     matchre LOAD_3 ^You don't have the (?:right|proper) ammunition
     matchre LOAD_3 ^Please rephrase that command\.|^I could not find|^Perhaps you should|^I don't|^Weirdly\,
     matchre LOAD_RETRIEVE ^As you try to
     matchre LOAD_RETRIEVE ^You must be|your hand jams|^You can not load
     matchre LOAD_STOW ^.* in your left hand
     if (matchre("$righthand", "(spiritwood longbow|spiritwood bow|spiritwood shortbow|spiritwood reflex longbow|spiritwood short bow)") && !matchre("$righthandnoun", "crossbow|stonebow|latchbow|arbalest|slurbow")) then
          {
               send load my $righthand
               matchwait 4
          }
     if !matchre("%CurrentAmmo", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then send load my %CurrentAmmo
     if matchre("%CurrentAmmo", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto LOAD_3
     matchwait 10
LOAD_3:
     var LOCATION LOAD_3
     matchre LOAD_3 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre LOAD_STOW_ARM_WORN ^You cannot manage to load your
     matchre DROPPED_RANGED ^What weapon are you
     matchre STEADY_UP ^Such a feat
     matchre LOAD_3 ^You are not skilled enough
     matchre AIM ^You (reach|carefully|load)
     matchre AIM ^You load .* in your hand\.
     matchre AIM ^.* is already loaded with
     matchre AIM ^\[Roundtime|^Roundtime|^\(Roundtime
     matchre AIM makes the task more difficult
     matchre LOAD_ALT ^You can not load the .* with
     matchre LOAD_ALT ^You can't load the .*
     matchre LOAD_ALT ^You don't have the (?:right|proper) ammunition
     matchre LOAD_ALT ^The .+ seems different than a standard weapon
     matchre LOAD_ALT ^Please rephrase that command\.|^I could not find|^Perhaps you should|^I don't|^Weirdly\,
     matchre LOAD_RETRIEVE ^As you try to
     matchre LOAD_RETRIEVE ^You must be|your hand jams|^You can not load
     matchre LOAD_STOW ^.* in your left hand
     send load
     matchwait 15
     goto RANGE_ERROR
LOAD_REPEAT:
     var LOCATION LOAD_REPEAT
     delay 0.0001
     if matchre("$righthand", "(?i)%WEAPON") && !matchre("$lefthand", "Empty") then gosub STOWIT left
     if !matchre("$righthand", "(?i)%WEAPON") then gosub GET my %WEAPON
     if ($standing = 0) then gosub STAND
     gosub RETRIEVE_CHECK
     pause 0.0001
     if ((%Melee.Range = 1) && ($UC_Retreat = 1)) then gosub RETREAT
     if ((%Pole.Range = 1) && ($UC_Retreat = 1)) then gosub RETREAT
     LOAD_REPEAT_1:
     pause 0.0001
     if ((%Melee.Range = 1) && ($UC_Retreat = 1)) then gosub RETREAT
     if ((%Pole.Range = 1) && ($UC_Retreat = 1)) then gosub RETREAT
     pause 0.0001
     matchre LOAD_REPEAT_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre AIM_PREP ^.* is already loaded with
     matchre STOW_LOAD ^You can not load the .* in your left hand\!
     matchre LOAD_STOW_ARM_WORN ^You cannot manage to load your
     matchre DROPPED_RANGED ^What weapon are you
     matchre LOAD_ALT ^You can't load the .* silly\!
     matchre STEADY_UP ^Such a feat
     matchre LOAD_2 ^You are not skilled enough
     matchre LOAD_REPEAT_1 ^You (reach|carefully|load)
     matchre LOAD_REPEAT_1 ^You load .* in your hand\.
     matchre LOAD_REPEAT_1 ^\[Roundtime|^Roundtime|^\(Roundtime
     matchre LOAD_ALT ^You can not load the .* with
     matchre LOAD2 ^The .*  must be in your inventory
     matchre LOAD_RETRIEVE ^You don't have the (?:right|proper) ammunition
     matchre LOAD_RETRIEVE ^As you try to
     matchre LOAD_RETRIEVE ^You must be|your hand jams|^You can not load
     matchre LOAD_STOW ^.* in your left hand
     send load my $righthandnoun
     matchwait 20
     goto RANGE_ERROR
AIM_PREP:
     var LOCATION AIM_PREP
     if ($standing = 0) then gosub STAND
     if ((%Melee.Range = 1) && ($UC_Retreat = 1)) then gosub RETREAT
     if ((%Pole.Range = 1) && ($UC_Retreat = 1)) then gosub RETREAT
     pause 0.0001
     pause 0.0001
     matchre AIM_PREP ^\.\.\.wait|^Sorry\,
     matchre STUNNED ^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre AIM ^Please rephrase that command\.|^I could not find|^Perhaps you should|^I don't|^Weirdly\,
     matchre AIM ^A rapid series of clicks emanate from your .* firing position
     matchre AIM ^You realize readying more than one
     matchre LOAD_REPEAT ^You attempt to ready your .* but a sharp click signals that you\'ve exhausted .* ammunition store\.
     put push my $righthandnoun
     matchwait 20
     goto RANGE_ERROR
LOAD_ALT:
     var LOCATION LOAD_ALT
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,
     matchre STUNNED ^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre LOAD_STOW_ARM_WORN ^You cannot manage to load your
     matchre DROPPED_RANGED ^What weapon are you
     matchre BAD_WEAPON ^You can't load the .* silly\!
     matchre STEADY_UP ^Such a feat
     matchre AIM ^You (reach|carefully|load)
     matchre AIM ^You load .* in your hand\.
     matchre AIM ^.* is already loaded with
     matchre AIM ^\[Roundtime|^Roundtime|^\(Roundtime
     matchre AIM makes the task more difficult
     matchre LOAD_RETRIEVE ^You don't have the (?:right|proper) ammunition
     matchre LOAD_RETRIEVE ^As you try to
     matchre LOAD_RETRIEVE ^You must be|your hand jams|^You can not load
     matchre LOAD_STOW ^.* in your left hand
     send load $righthand
     matchwait 20
     goto RANGE_ERROR
RANGE_ERROR:
     echo
     echo **** RANGED ERROR AT LOAD
     echo
     put #echo >Log Crimson *** GENERAL RANGED ERROR IN LOAD! (heavy lag??) ***
     put #log $datetime GENERAL RANGED ERROR IN LOAD! (heavy lag??)
     return
LOAD_STOW:
     delay 0.0001
     if !matchre("$lefthand", "Empty") then gosub STOW $lefthandnoun
     goto LOAD
DROPPED_RANGED:
     pause 0.0001
     echo *** DROPPED WEAPON?
     gosub stowing
     gosub stowAmmo
     matchre LOAD_RETRIEVE ^What were you|^I could not
     put tap my %CurrentAmmo
     matchwait 3
     gosub GET my %WEAPON
     pause 0.4
     goto $UC_WeaponType
LOAD_RETRIEVE:
     delay 0.0001
     math loadfail add 1
     gosub RETRIEVE_CHECK
     gosub stowammo
     if (%loadfail > 3) then goto SHIT_NO_AMMO
     goto LOAD_1
SHIT_NO_AMMO:
     put #parse OUT.OF.AMMO!
     put #parse OUT OF AMMO!
     echo ##################################
     echo *** RUNNING LOW OR OUT OF AMMO!
     echo *** No %CurrentAmmo! Restock!
     echo ##################################
     if ($UC_RestockAmmo = 0) then
                    {
                         if ("%LEARNING" = "Bow") then var RANGED.BOW NULL
                         if ("%LEARNING" = "Crossbow") then var RANGED.CROSSBOW NULL
                         if ("%LEARNING" = "Slings") then var RANGED.SLING NULL
                         echo *** TURNING OFF %LEARNING
                         goto SWITCH
                    }
     if matchre("%CurrentAmmo", "\brock\b|\bshard\b|\bclump\b|\bstone\b") then var BuyRocks 1
     if matchre("%CurrentAmmo", "\barrow\b") then var BuyArrows 1
     if matchre("%CurrentAmmo", "\bbolt\b|pulzone|quadrello") then var BuyBolts 1
     if !matchre("%CurrentAmmo", "\brock\b|\bshard\b|\bclump\b|\bstone\b|\barrow\b|\bbolt\b|pulzone|quadrello") then
          {
               put #echo >Log #ff0000 *** RAN OUT OF AMMO - %CurrentAmmo! DID NOT RECOGNIZE YOUR AMMO FOR RESTOCK
               echo ###################################################
               echo *** ESCAPING DUE TO LACK OF AMMO - Did not recognize your %CurrentAmmo
               echo *** PLEASE SEND ME THE NAME OF YOUR AMMO
               echo ###################################################
               pause
               goto ESCAPE_AMMO
          }
     var AmmoRestock 1
     put #echo >Log #ff0000 *** RAN OUT OF AMMO - %CurrentAmmo! Restocking!
     goto ESCAPE_AMMO
AIM:
     delay 0.0001
     var fullAim 0
     var loadfail 0
     action (retreat) on
     action var fullAim 1 when ^You think you have your best shot possible now
     if ($standing = 0) then gosub STAND
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if ($hidden = 1) && ("$guild" = "Paladin") then gosub UNHIDE
     if (%maneuverLast > 300) then
          {
               gosub MANEUVER_GO
               return
          }
     var LOCATION AIM_1
     gosub AIM_TIMER
     AIM_1:
     delay 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre AIM_WAIT ^You begin to target
     matchre AIM_WAIT ^You are already targetting that\!
     matchre CALMED ^Strangely\, you don\'t feel like fighting right now\.
     matchre RETURN ^I could not find what you were referring to\.
     matchre RETURN ^\[You're .*balanced?\]
     matchre ASSESS ^There is nothing else to face
     matchre LOAD ^But your .* isn\'t loaded
     matchre RETURN In one frozen moment
     matchre RETURN ^You aren't close enough to attack
     matchre RETURN ^You turn to face
     matchre RETURN ^You spin around to face
     matchre RETURN ^You stop advancing because
     matchre RETURN ^You shift
     matchre RETURN begin to aim
     send aim
     matchwait 20
     return
AIM_WAIT:
     var aimcount 0
     delay 0.0001
     evalmath AimLast ($gametime - %AimTime)
     eval temp count("%AimActions", "|")
     if (($Stealth.LearningRate < 29) && ($UC_TrainStealth = 1)) then gosub HIDE
AIM_ACTIONS:
     delay 0.0001
     if ($UC_Snap.Fire > 0) && (%AimLast >= $UC_Snap.Fire) then goto FIRE
     if (%aimcount > %temp) then goto AIM_WAIT_2
     if matchre("%AimActions", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto AIM_WAIT_2
     if ("$preparedspell" != "None") then gosub CAST_TIMER
     if (%fullAim = 1) then goto FIRE
     delay 0.00001
     if (($monstercount > 0) && ($hidden = 0)) then
          {
               if matchre("%AimActions(%aimcount)", "(?i)(throw|lob|hurl) (.*)") then
                    {
                         var ThrowStyle $1
                         var aimthrow $2
                         gosub GET_IT %aimthrow
                         pause 0.1
                         if (matchre("$righthand", "%aimthrow") && !matchre("$righthand", "(?i)%WEAPON")) then
                              {
                                   put swap
                                   pause 0.3
                              }
                         gosub PUT %ThrowType left
                         pause 0.2
                         pause 0.1
                         if (($UC_Bonded = 1) && (%ammolodged = 1)) then
                              {
                                   pause 0.2
                                   gosub PUT invoke
                                   if matchre("$righthand $lefthand", "%aimthrow") then var ammolodged 0
                              }
                         if !matchre("$righthand $lefthand", "%aimthrow") then gosub STOWIT %aimthrow
                    }
               if matchre("%AimActions(%aimcount)", "(?i)attack\b") then
                    {
                         if matchre("$righthand", "(?i)(shortbow|bow|crossbow|sling|slurbow|arbalest|longbow)") then
                              {
                                   if ($monstercount > 0) then gosub PUT attack left
                              }
                         else if ($monstercount > 0) then gosub PUT attack
                    }
               else send %AimActions(%aimcount)
          }
     pause 0.3
     pause 0.0001
     pause 0.0001
     math aimcount add 1
     goto AIM_ACTIONS
AIM_WAIT_2:
     var aimcount 0
     if ((($UC_Snipe = 1) && ($hidden = 0)) || (($UC_Poach = 1) && ($hidden = 0))) then gosub HIDE
     if matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (%fullAim = 1) then goto FIRE
     if ($UC_Snap.Fire > 0) then
          {
               evalmath AimLast ($gametime - %AimTime)
               if (%AimLast >= $UC_Snap.Fire) then goto FIRE
               pause 0.5
               pause 0.3
               goto AIM_WAIT_2
          }
     if (%fullAim = 1) then goto FIRE
     if ((%Melee.Range = 1) && ($UC_Retreat = 1)) then put RETREAT
     if ((%Pole.Range = 1) && ($UC_Retreat = 1)) then put RETREAT
     if (%fullAim = 1) then goto FIRE
     matchre FIRE ^You think you have your best shot possible
     matchre AIM ^You stop concentrating on aiming your weapon\.
     matchwait 15
     goto FIRE
SNIPE_OFF:
     put #var UC_Snipe 0
     put #var UC_Poach 1
FIRE:
     delay 0.00001
     var firetype fire
     action remove ^You think you have your best shot possible now\.
     if ($standing = 0) then gosub STAND
     if matchre("$righthand", "(?i)lirisan shortbow") then
          {
               gosub BOS_TIMER
               if (%BOSLast > 300) then
                    {
                         pause 0.1
                         var BOSTime $gametime
                         if ("$guild" != "Empath") then put point shortbow at %Critter
                         if ("$guild" = "Empath") then put point shortbow at %Empath.Critter
                         pause 0.5
                         pause 0.3
                         pause 0.2
                    }
          }
     if ((($UC_Snipe = 1) && ($hidden = 0)) || (($UC_Poach = 1) && ($hidden = 0))) then gosub HIDE
     var LOCATION FIRE_1
     FIRE_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned\.
     matchre WEBBED ^You can't do that while entangled in a web\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre CALMED ^Strangely\, you don\'t feel like fighting right now\.
     matchre FIRE ^How can you (snipe|poach) if you are not hidden\?
     matchre LOAD ^But your .* isn't loaded\!
     matchre SNIPE_OFF ^You are not trained to properly use the deadly skill of sniping\.
     matchre RETURN ^Please rephrase that command\.|^I could not find|^Perhaps you should|^I don't|^Weirdly\,
     matchre RETURN ^You were aiming at a different target\, but you fire anyway\.
     matchre RETURN ^I could not find what you were referring to\.
     matchre RETURN ^\[You're .*balanced?\]
     matchre RETURN ^There is nothing else to face
     matchre RETURN ^You aren't close enough to attack
     matchre RETURN ^You turn to face
     matchre RETURN ^You spin around to face
     matchre RETURN ^You stop advancing because
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     if ($hidden = 1) then
          {
               if (matchre("$guild", "Thief|Ranger|Necromancer") && ($circle > 39) && ($UC_Snipe = 1)) then var firetype snipe
               if (!matchre("$guild", "Thief|Ranger|Necromancer") || ($circle < 39) || (!$UC_Snipe)) then var firetype poach
          }
     put %firetype
     matchwait 20
     return
#### HIDING SUB
HIDE:
     delay 0.00001
     var hideCounter 0
     if ($hidden = 1) then return
     if ($standing = 0) then gosub STAND
     var LOCATION HIDE_1
     HIDE_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre HIDE_INCREMENT ^.* notices your attempt to hide\!
     matchre HIDE_INCREMENT ^.* reveals you\, ruining your hiding attempt\!
     matchre HIDE_INCREMENT ^.* discovers you\, ruining your hiding place\!
     matchre HIDE_RETURN ^You slip into a hiding
     matchre HIDE_RETURN ^You melt into the background
     matchre HIDE_RETURN ^Eh\?  But you're already hidden\!
     matchre HIDE_RETURN ^You blend in with your surroundings
     matchre HIDE_RETURN ^Please rephrase that command\.|^I could not find|^Perhaps you should|^I don't|^Weirdly\,
     send hide
     matchwait 20
     return
HIDE_RETURN:
     unvar hideCounter
     return
HIDE_INCREMENT:
     delay 0.00001
     if ("$guild" = "Barbarian") then
          if ((%barbPanther) && ($barbPanther = 0) && ($UC_innerFire > 2)) then
               {
                    var abilityStarted 0
                    gosub PUT form panther
                    pause 0.5
                    if (%abilityStarted) then put #var barbPanther 1
                    var hideCounter 0
               }
     math hideCounter add 1
     if (%hideCounter > 4) then
          {
               echo ##################################
               echo ** CANNOT HIDE! TURNING OFF STEALTH
               echo ##################################
               put #var UC_TrainStealth 0
               put #var UC_Poach 0
               put #var UC_Snipe 0
               unvar hideCounter
               return
          }
     goto HIDE_1
#### UNHIDING SUB
UNHIDE:
     delay 0.00001
     if ($standing = 0) then gosub STAND
     if ($hidden = 0) then return
     var LOCATION UNHIDE_1
     UNHIDE_1:
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^But you are not hidden\!
     matchre RETURN ^You come out of hiding\.
     matchre RETURN ^Please rephrase that command\.|^I could not find|^Perhaps you should|^I don't|^Weirdly\,
     matchre RETURN (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     send unhide
     matchwait 5
     return
#### STALKING SUB
STALK:
     delay 0.0001
     var hideCounter 0
     var LOCATION STALK_1
     if ($standing = 0) then gosub STAND
     STALK_1:
     if (($circle < 50) && ($hidden = 0)) then gosub HIDE
     pause 0.0001
     pause 0.0001
     matchre STALK_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre HIDE ^Stalking is an inherently stealthy
     matchre RETURN Stalk what|Face what|^There is nothing else to face|trying to stalk
     matchre AMBUSH_STALK_FAIL reveals|try being out of sight|discovers you|^You think|^You fail
     matchre RETURN ^You move into position|^You are already stalking|^You quickly slip|^You're already stalking
     matchre RETURN ^Please rephrase that command\.|^I could not find|^Perhaps you should|^I don't|^Weirdly\,
     matchre RETURN (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     send stalk
     matchwait 5
     return
AMBUSH_STALK_FAIL:
     delay 0.0001
     math hideCounter add 1
     if %hideCounter > 1 then return
     goto STALK_1
############################################################
GUILD_CHECK:
     action put #var race $2;put #var guild $3 when ^Name\:\s*(.*)\s*Race\:\s*(.*)\s*Guild\:\s*(.*)
     action put #var circle $3 when ^Gender\:\s*(.*)\s*Age\:\s*(\d+)\s*Circle\:\s*(\d+)
     action put #var favors $1 when ^\s*Favors\s*\:\s*(\d*)
     action put #var pirps $1 when ^\s*PIRP Points\s*\:\s*(\d*)
     send info;-0.05 encumbrance
     matchre GUILD_CHECK_2 ^\s*Encumbrance\s*\:
     matchwait 8
     goto GUILD_CHECK
GUILD_CHECK_2:
     var LOCATION GUILD_CHECK_2
     delay 0.00001
     delay 0.00001
     action remove ^Name\:\s*(.*)\s*Race\:\s*(.*)\s*Guild\:\s*(.*)
     action remove ^Gender\:\s*(.*)\s*Age\:\s*(\d+)\s*Circle\:\s*(\d+)
     action remove ^\s*Favors\s*\:\s*(\d*)
     action remove ^\s*PIRP Points\s*\:\s*(\d*)
     if ("$guild" = "Warrior") then put #var guild Warrior Mage
     if ("$guild" = "Moon") then put #var guild Moon Mage
     delay 0.00001
     if ("$guild" = "Warrior") then put #var guild Warrior Mage
     if ("$guild" = "Moon") then put #var guild Moon Mage
     if !matchre("$guild","(Thief|Ranger|Necromancer)") then var SNIPE OFF
     if (matchre("$guild", "(Thief|Ranger|Necromancer)") && ($circle < 40)) then var SNIPE OFF
     if ("$guild" != "Thief") then var UC_WEAPON_BS NULL
     if ("$guild" = "Warrior Mage") then var GuildType WM
     if ("$guild" = "Moon Mage") then var GuildType MM
     if ("$guild" = "Trader") then var GuildType Trader
     if ("$guild" = "Paladin") then var GuildType Paladin
     if ("$guild" = "Cleric") then var GuildType Cleric
     if ("$guild" = "Ranger") then var GuildType Ranger
     if ("$guild" = "Empath") then var GuildType Empath
     if ("$guild" = "Bard") then var GuildType Bard
     if ("$guild" = "Necromancer") then var GuildType Necro
     if ("$guild" = "Thief") then var GuildType Thief
     if ("$guild" = "Barbarian") then var GuildType Barb
     var MAGICUSER Warrior Mage|Moon Mage|Bard|Ranger|Paladin|Empath|Cleric|Trader|Necromancer
     echo
     echo ##########
     echo * Guild: $guild
     echo * Circle: $circle
     echo * Favors: $favors
     echo * Pirps: $pirps
     echo ##########
     echo
     return
############################################################
#### PUT SUB
PUT_ROLL_IT:
     delay 0.00001
     put roll my %putaction
     pause 0.4
     goto PUT_1
PUT_UNTIE:
     delay 0.00001
     eval putaction replacere("%putaction", "\bget\b", "")
     eval putaction replacere("%putaction", "\bmy\b", "")
     put untie %putaction
     pause 0.4
     return
PUT_STOW:
     gosub EMPTY_HANDS
     goto PUT_1
PUT_STAND:
     gosub stand
     goto PUT_1
PUT:
     delay 0.00001
     var putaction $0
     var LOCATION PUT_1
     PUT_1:
     matchre PUT_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre RETURN_HEAL ^You can't pick that up with your hands that damaged\.|^Both your hands are missing\!
     matchre PUT_UNTIE ^You should untie
     matchre PUT_ROLL_IT ^You should roll it up
     matchre PUT_STOW ^You need a free hand|^Free one of your hands
     matchre PUT_STAND ^You should stand up first\.|^Maybe you should stand up\.
     matchre WAIT ^\[Enter your command again if you want to\.\]
     matchre RETURN (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|cut|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|carefully|cautiously|chop|circle|close|collect|collector's|corruption|count|combine|come|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|prepare|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|should|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre RETURN ^Brother Durantine|^Durantine|^Mags|^Ylono|^Malik|^Kilam|^Ragge|^Randal|^Catrox|^Kamze|^Unspiek|^Wyla|^Ladar|^Dagul|^Granzer|^Fekoeti|^Diwitt|(?:An|The|A) attendant|^The clerk|A Dwarven|^.*He says\,
     matchre RETURN ^Sensing your intent, a swarm of tiny spiders suddenly appears from beneath the folds of your spidersilk cloak and weaves an opening in the silk\.
     matchre RETURN ^With a practiced flick of your wrist|The vines are already|The antique hinges|^Brushing your fingers|There are already openings|Sensing your intent
     matchre RETURN ^The (?: clerk|teller|attendant|mortar|pestle|tongs|bowl|riffler|hammer|gem|book|page|lockpick|sconce|voice|waters|contours|person) .*(?:\.|\!|\?)?
     matchre RETURN ^Quietly touching your lips with the tips of your fingers as you kneel\, you make the Cleric's sign with your hand\.
     matchre RETURN ^You sense that you are as pure of spirit as you can be\, and you are ready for whatever rituals might face you\.
     matchre RETURN ^You don't have a (.+) coin on you\!\s*The (.+) spider looks at you in forlorn disappointment\.|^The (.+) spider turns away
     matchre RETURN ^It would be a shame|It's already open\!|^Brushing your fingers|There are already openings|Sensing your intent
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime|\[Roundtime
     matchre RETURN That will cost .* to repair\.\s*Just give it to me again if you want\, and I'll have it ready in .*\.
     matchre RETURN It will cost .* and take .* to repair .*\.\s*Just ask me again and I can get started\.
     matchre RETURN Lucky for you\!\s*That isn't damaged\!|I will not repair something that isn't broken\.
     matchre RETURN I'm sorry\, but I don't work on those|There isn't a scratch on that\, and I'm not one to rob you\.
     matchre RETURN I don't work on those here\.|I don\'t repair those here|Please don't lose this ticket\!
     matchre RETURN This is an exclusive item reserved for a certain subset of the population
     matchre RETURN suddenly leaps toward you|and flies towards you|with a flick
     matchre RETURN ^Please rephrase that command\.|^I could not find|^Perhaps you should|^I don\'t|^Weirdly\,|That can't
     matchre RETURN ^That (?:is|has) already|^(.+) what\?
     matchre RETURN ^It's kind of wet out here\.
     matchre RETURN ^The .*(is|has|are|slides|fades|hinges)
     matchre RETURN ^Obvious (?:exits|paths)
     matchre RETURN \[You're|\[This is|too injured
     matchre RETURN ^Moving|Brushing|Recalling|Unaware
     matchre RETURN ^.*\[Praying for \d+ sec\.\]
     matchre RETURN ^You cannot do that while engaged\!
     matchre RETURN ^.+ is not in need|^That is closed\.
     matchre RETURN ^This is a .* spell|The spell requires
     matchre RETURN ^But (?:that|you|the)
     matchre RETURN ^What (?:were you|is it)
     matchre RETURN ^There (?:is|is not|isn't|doesn\'t)
     matchre RETURN ^In the name of love\?|^Play on
     matchre RETURN ^That (?:cannot|area|can't|won't|would)
     matchre RETURN ^With a (?:keen|practiced|graceful|stealthy)
     matchre RETURN ^Some (?:polished|people|tarnished|.* zills)
     matchre RETURN ^(\S+) has accepted
     matchre RETURN ^Subservient type|^The shadows|^Close examination|^Try though
     matchre RETURN ^USAGE\:|^Using your|^You.*analyze
     matchre RETURN ^Allows a Moon Mage|^Smoking commands are
     matchre RETURN ^A (?:slit|pair|shadow) .*(?:\.|\!|\?)?
     matchre RETURN ^Your (?:actions|dance|nerves) .*(?:\.|\!|\?)?
     matchre RETURN ^Having no further use for .*\, you discard it\.
     matchre RETURN ^After a moment\, .*\.
     matchre RETURN ^.* (?:is|are) not in need of cleaning\.
     matchre RETURN ^The .* is not damaged enough to warrant repair\.
     matchre RETURN \[Type INVENTORY HELP for more options\]|\[Use INVENTORY HELP for more options\.\]
     matchre RETURN ^A vortex|^A chance for|^In a flash|^It is locked|^An aftershock
     matchre RETURN ^In the .* you see .*\.
     matchre RETURN .* (?:Dokoras|Kronars|Lirums)
     matchre RETURN ^This spell cannot be targeted\.|^You cannot figure out how to do that\.S
     matchre RETURN ^You will now store .* in your .*\.
     matchre RETURN ^That tool does not seem suitable for that task\.
     matchre RETURN ^There (isn\'t|doesn\'t seem to be) any more room in .*
     matchre RETURN ^\[Ingredients can be added by using ASSEMBLE Ingredient1 WITH Ingredient2\]
     matchre RETURN ^\s*LINK ALL CANCEL\s*\- Breaks all links
     matchre RETURN ^This ritual may only be performed on a corpse\.
     matchre RETURN ^There is nothing else to face\!
     matchre RETURN ^Stalking is an inherently stealthy endeavor\, try being out of sight\.
     matchre RETURN ^You're already stalking|^There aren't any
     matchre RETURN ^You don't think you have enough focus to do that\.
     matchre RETURN ^You have no idea how to cast that spell\.
     matchre RETURN ^An offer|shakes (his|her) head
     matchre RETURN ^Tie it off when it's empty\?
     matchre RETURN ^But the merchant can't see you|are invisible
     matchre RETURN Page|^As the world|^Obvious|^A ravenous energy
     matchre RETURN ^In the|^The attendant|^That is already open\.|^Your inner
     matchre RETURN ^(\S+) hands you|^Searching methodically|^But you haven\'t prepared a symbiosis\!
     matchre RETURN ^Illustrations of complex\,|^It is labeled|^Your nerves
     matchre RETURN ^The lockpick|^Doing that|is not required to continue crafting
     matchre RETURN ^Without (any|a|the)
     matchre RETURN ^Weirdly, you can't manage
     matchre RETURN ^Hold hands with whom\?
     send %putaction
     matchwait 20
     echo *** MISSING MATCH IN PUT! ***
     put #echo >Log Crimson *** MISSING MATCH IN PUT! (%scriptname.cmd) ***
     put #echo >Log Crimson Command = %putaction
     put #log $datetime MISSING MATCH IN PUT! Command = %putaction (%scriptname.cmd)
     return
##########################################################
## STOWING AMMO ROUTINE
## CHECKS GROUND AND PICKS UP AMMO
## ALSO CHECKS IF ANY OF OUR WEAPONS ARE ON GROUND
## ALSO CHECKS FOR ANY EXTRA SPECIAL RARE WEAPONS (HARD CODED)
##########################################################
STOWAMMO:
     var LOCATION STOWAMMO
     var arrowloop 0
     delay 0.00001
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     ### MAIN CHECK FOR ANY OF OUR WEAPONS LAYING ON GROUND (REMOVES MOST FALSE POSITIVES FROM CRITTER WEAPONS)
     if ("$guild" = "Warrior Mage") then gosub SUMMONDROP_TIMER
     if (matchre("$roomobjs", "\b(?<!pike |pitted bronze |[Rr]usted |rusty |spindly short |dull iron |battered |beaten )(%MYWEAPONS)(?!(\-toothed| bolt| arrow| shard| stuck in the ground))\b") && !matchre("$roomname", "Zaulfung") && (%SummonDropLast > 30)) then
          {
               if ($UC_SummonWeapons = 1) then
                    {
                         if (matchre("$righthand", "%WM.Weapon") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
                         if (matchre("$lefthand", "%WM.Weapon") && !matchre("$righthand", "Empty")) then gosub STOWIT right
                    }
               if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
               if (($UC_Bonded = 1) && (%ammolodged = 1)) then
                    {
                         send invoke
                         pause 0.2
                         pause 0.1
                         if matchre("$righthand", "Empty") then send invoke
                         pause 0.2
                         pause 0.1
                    }
               pause 0.001
               if (matchre("$roomobjs", "\b(?<!pike |pitted bronze |[Rr]usted |rusty |spindly short |dull iron |battered |beaten )(%MYWEAPONS)(?!(\-toothed| bolt| arrow| shard| stuck in the ground))\b") && !matchre("$roomname", "Zaulfung")) then gosub GET $1
               pause 0.0001
               delay 0.00001
               if matchre("$lefthand $righthand", "%Sheath.Weapons") then gosub SHEATH_CHECK
               if matchre("$lefthand $righthand", "(%MYWEAPONS)") then gosub STOWIT $1
          }
     if (matchre("$roomobjs", "\b(?<!pike |pitted bronze |[Rr]usted |rusty |spindly short |dull iron |battered |beaten )(%MYWEAPONS)(?!(\-toothed| bolt| arrow| shard| stuck in the ground))\b") && !matchre("$roomname", "Zaulfung")) then
          {
               if !matchre("$roomobjs","(?<![Dd]ull iron )hurling axe") then gosub STOWIT %WEAPON
               if matchre("$roomobjs","(?<![Dd]ull iron )hurling axe") && matchre("$roomobjs","(?i)%WEAPON") then gosub STOWIT %WEAPON
          }
     if matchre("$righthand","(?i)(%Long.Weapons)") && !matchre("$lefthand", "Empty") then gosub WEAR $1
     if matchre("$lefthand","(?i)(%Long.Weapons)") && !matchre("$righthand", "Empty") then gosub WEAR $1
     if (%RangedWeapons = 0) then return
     ### CHECKS FOR RANGED WEAPONS
     if ((%HaveBandolier = 1) && matchre("$roomobjs", "icicle")) then gosub STOWICE
     if matchre("$roomobjs", "\b$UC_WEAPON_HT\b") then gosub STOWIT $UC_WEAPON_HT
     if matchre("$roomobjs", "\b$UC_WEAPON_LT\b") then gosub STOWIT $UC_WEAPON_LT
     #### MAIN CHECK FOR PRIMARY AMMO ON GROUND
     if matchre("$roomobjs", "\b%MAINARROW\b") then gosub STOWIT %MAINARROW
     if (matchre("$roomobjs", "\b%BowAmmo\b") && !matchre("$UC_WEAPON_BOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWMYBOLT
     if (matchre("$roomobjs", "\b%XbowAmmo\b") && !matchre("$UC_WEAPON_CROSSBOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWMYARROW
     if (matchre("$roomobjs", "\b%SlingAmmo(?! guardian| fall)\b") && !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWMYROCK
     #### CHECK FOR OTHER RARE / PERSONAL WEAPONS
     if matchre("$roomobjs","(?i)(?<!shimmering )$UC_MyShield") then gosub STOWIT $UC_MyShield
     if matchre("$roomobjs","(?i)(ironwood shield|(?<![Bb]attered )wooden shield|dragonwood shield|small shield|azure-scale shield)") then gosub STOWIT shield
     if matchre("$roomobjs","(?i)T'Kashi mirror flamberge") then gosub STOWIT mirror flamberge
     if matchre("$roomobjs","(?i)T'Kashi mirror flail") then gosub STOWIT mirror flail
     if matchre("$roomobjs","(?i)mirror blade") then gosub STOWIT mirror blade
     if matchre("$roomobjs","(?i)mirror knife") then gosub STOWIT mirror knife
     if matchre("$roomobjs","(?i)assassin bow") then gosub STOWIT ass bow
     if matchre("$roomobjs","(?i)damascus steel sabre") then gosub STOWIT sabre
     if matchre("$roomobjs","(?i)katana") then gosub STOWIT katana
     if matchre("$roomobjs","(?i)(double-stringed crossbow|repeating crossbow|bloodwood dako'gi crossbow|forester's crossbow|bamboo crossbow|forester's bow|battle bow|assassin's crossbow)") then gosub STOWIT $1
     #### HARD CHECK FOR RARE AMMO - IF THAT WEAPON IS ON
     if (matchre("$roomobjs","(?i)throwing blade") && !matchre("$UC_WEAPON_LT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWBLADE
     if (matchre("$roomobjs","(?i)steelstar") && !matchre("$UC_WEAPON_LT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWSTEELSTAR
     if matchre("$roomobjs","(?i)sleek quadrello") && !matchre("$UC_WEAPON_CROSSBOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWIT quadrello
     if (matchre("$roomobjs","(?i)telothian bola") && !matchre("$UC_WEAPON_LT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWIT bola
     if matchre("$roomobjs","(?i)\bdart\b") && matchre("$UC_WEAPON_BRAWL", "\b(?i)(blowgun dart|dart|blowgun)\b")) then gosub STOWIT dart
     if matchre("$roomobjs","(?i)(silver-edged star|throwing star)") && !matchre("$UC_WEAPON_LT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWSTARS
     #### CHECK FOR OTHER RANDOM AMMO
     # if (matchre("$roomobjs","(?i)(basilisk head arrow\b|cane arrow\b|bone-tipped arrow\b|barbed arrow\b|stone-tipped arrow\b|serrated-bodkin arrow\b|blunt-tipped arrow|razor-edged arrow|claw-tipped arrow|razor-tipped arrow\b|cougar-claw arrow|boar tusk arrow|blunt tip arrow|serrated bone arrow)") && !matchre("$UC_WEAPON_BOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWARROW
     # if (matchre("$roomobjs","(?i)(pyrite clump|smoky-quartz clump|obsidian clump)") && !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWIT clump
     # if (matchre("$roomobjs","(?i)(elongated stones|granite stone|panther-carved stone|goblin-carved stones|unicorn-carved stone)") && !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWIT stone
     # if (matchre("$roomobjs","(?i)(river rock|spider-carved rock|heavy quartz rock|boggle-shaped rock|pumpkin-shaped rock|granite rock)") && !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWROCK
     # if (matchre("$roomobjs","(?i)(smooth rock)") && !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$roomname", "Zaulfung")) then gosub STOWROCK
     # if (matchre("$roomobjs","(?i)(small rock)") && matchre("\b%SlingAmmo(?! guardian| fall)\b", "(?i)small rock")) then gosub STOWROCK
     # if (matchre("$roomobjs","(?i)(quartzite stone shard|obsidian stone shard|glaes stone shard|tyrium stone shard|onyx stone shard|senci stone shard|belzune stone shard|sunderstone shard)") && !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWIT shard
     # if (matchre("$roomobjs","(?i)(frog-crotch bolt|angiswaerd bolt|basilisk bolt|ice-adder bolt|drake-fang bolt|jagged-horn bolt|leafhead bolt|barbed bolt|flint-tip bolt|blunt tip bolt|hele'la bolt|sabertooth bolt|elsralael bolts|serrated bone bolt)") && !matchre("$UC_WEAPON_CROSSBOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub STOWBOLT
     ### MAIN CHECK FOR CERTAIN WEAPONS
     if !matchre("$roomobjs","(?i)((?<![Rr]usted |battered |beaten )throwing (axe|club|spike|dagger|blade)|mirror (axe|blade|flamberge|dagger|ava|coresca|mallet|riste|halberd)|stonebow|indurium sphere|pasabas|battle bow|thrusting blade|bone club|tago|quarrel|\btelo\b|(?<![Rr]usted |battered |beaten )flamberge|nightstick|katana|shadowy-black sling|sniper's crossbow|(?<![Rr]usted |deed for an |deed for a )bastard sword|\bbola\b)") then return
     gosub STOWIT $1
     pause 0.0001
     goto STOWAMMO
STOWICE:
     math arrowloop add 1
     delay 0.0001
     pause 0.00001
     if matchre("$roomobjs","icicle") then
          {
               send get icicle
               pause 0.001
               send stow icicle
               pause 0.1
               send stow icicle
               wait
          }
     pause 0.0001
     if (%arrowloop > 10) then return
     if contains("$roomobjs","icicle") then goto STOWICE
     var ammolodged 0
     return
STOWSTEELSTAR:
     math arrowloop add 1
     delay 0.0001
     pause 0.0001
     if matchre("$roomobjs","steelstar") then
          {
               send get steelstar
               pause 0.001
               send stow steelstar
               pause 0.1
               send stow steelstar
               wait
          }
     pause 0.0001
     if (%arrowloop > 10) then return
     if contains("$roomobjs","steelstar") then goto STOWSTEELSTAR
     var ammolodged 0
     return
STOWSTARS:
     math arrowloop add 1
     delay 0.0001
     pause 0.0001
     if matchre("$roomobjs","(silver-edged star|throwing star)") then
          {
               send stow star
               pause 0.1
               send stow star
               pause 0.1
               send stow star
               pause 0.1
               send stow star
               wait
          }
     pause 0.0001
     if (%arrowloop > 10) then return
     if matchre("$roomobjs","(silver-edged star|throwing star)") then goto STOWSTARS
     var ammolodged 0
     return
STOWBLADE:
     math arrowloop add 1
     delay 0.0001
     pause 0.0001
     if matchre("$roomobjs","throwing blade") then
          {
               send get throwing blade
               pause 0.001
               pause 0.001
               send stow throwing blade
               pause 0.1
               pause 0.1
               send stow throwing blade
               wait
          }
     pause 0.0001
     if (%arrowloop > 10) then return
     if contains("$roomobjs","throwing blade") then goto STOWBLADE
     var ammolodged 0
     return
STOWMYARROW:
     math arrowloop add 1
     delay 0.0001
     pause 0.0001
     if matchre("$roomobjs","(?i)\b%BowAmmo\b") then
          {
               send stow %BowAmmo
               pause 0.1
               pause 0.1
               send stow %BowAmmo
               pause 0.1
          }
     pause 0.0001
     if (%arrowloop > 10) then return
     if matchre("$roomobjs","(?i)\b%BowAmmo\b") then goto STOWMYARROW
     var ammolodged 0
     return
STOWARROW:
     math arrowloop add 1
     delay 0.0001
     pause 0.0001
     if matchre("$roomobjs","(?i)(basilisk head arrow\b|cane arrow\b|bone-tipped arrow\b|barbed arrow\b|stone-tipped arrow\b|serrated-bodkin arrow\b|blunt-tipped arrow|razor-edged arrow|claw-tipped arrow|razor-tipped arrow\b|cougar-claw arrow|boar tusk arrow|blunt tip arrow|serrated bone arrow)") then
          {
               send stow arrow
               pause 0.1
               pause 0.1
               send stow arrow
               pause 0.1
          }
     pause 0.0001
     if (%arrowloop > 10) then return
     if matchre("$roomobjs","(?i)(basilisk head arrow\b|cane arrow\b|bone-tipped arrow\b|barbed arrow\b|stone-tipped arrow\b|serrated-bodkin arrow\b|blunt-tipped arrow|razor-edged arrow|claw-tipped arrow|razor-tipped arrow\b|cougar-claw arrow|boar tusk arrow|blunt tip arrow|serrated bone arrow)") then goto STOWARROW
     var ammolodged 0
     return
STOWMYBOLT:
     math arrowloop add 1
     delay 0.0001
     pause 0.0001
     if matchre("$roomobjs","(?i)\b%XbowAmmo\b") then
          {
               send stow %XbowAmmo
               pause 0.1
               pause 0.1
               send stow %XbowAmmo
               pause 0.1
          }
     pause 0.0001
     if (%arrowloop > 10) then return
     if matchre("$roomobjs","(?i)\b%XbowAmmo\b") then goto STOWMYBOLT
     var ammolodged 0
     return
STOWBOLT:
     math arrowloop add 1
     delay 0.0001
     pause 0.0001
     if matchre("$roomobjs","(?i)(frog-crotch bolt|angiswaerd bolt|basilisk bolt|ice-adder bolt|drake-fang bolt|jagged-horn bolt|leafhead bolt|barbed bolt|flint-tip bolt|blunt tip bolt|hele'la bolt|sabertooth bolt|elsralael bolts|serrated bone bolt)") then
          {
               send stow bolt
               pause 0.1
               pause 0.1
               send stow bolt
               pause 0.1
               pause 0.0001
          }
     pause 0.0001
     if (%arrowloop > 10) then return
     if matchre("$roomobjs","(?i)(frog-crotch bolt|angiswaerd bolt|basilisk bolt|ice-adder bolt|drake-fang bolt|jagged-horn bolt|leafhead bolt|barbed bolt|flint-tip bolt|blunt tip bolt|hele'la bolt|sabertooth bolt|elsralael bolts|serrated bone bolt)") then goto STOWBOLT
     var ammolodged 0
     return
STOWMYROCK:
     math arrowloop add 1
     delay 0.0001
     pause 0.0001
     if matchre("$roomobjs","(?i)\b%XbowAmmo\b") then
          {
               send stow %XbowAmmo
               pause 0.1
               pause 0.1
               send stow %XbowAmmo
               pause 0.1
          }
     pause 0.0001
     if (%arrowloop > 10) then return
     if matchre("$roomobjs","(?i)\b%XbowAmmo\b") then goto STOWMYROCK
     var ammolodged 0
     return
STOWROCK:
     math arrowloop add 1
     delay 0.0001
     pause 0.0001
     if matchre("$roomobjs","(?i)(river rock|spider-carved rock|heavy quartz rock|smooth rock|boggle-shaped rock|fist-sized rock|pumpkin-shaped rock|granite rock|small rock)") then
          {
               send stow rock
               pause 0.01
               pause 0.01
               send stow rock
               pause 0.0001
               pause 0.0001
          }
     pause 0.0001
     pause 0.0001
     if (%arrowloop > 10) then return
     if matchre("$roomobjs","(?i)(river rock|spider-carved rock|heavy quartz rock|smooth rock|boggle-shaped rock|fist-sized rock|pumpkin-shaped rock|granite rock)") then goto STOWROCK
     var ammolodged 0
     return
#### MAIN STOW ROUTINE
STOWING:
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
     delay 0.00001
     var LOCATION STOWING
     if matchre("$righthand $lefthand", "(?i)(%ALLCONTAINERS)") then gosub WEAR $1
     if matchre("$righthand $lefthand", "((?<=glittering )sun|(?<=dreamstone )moon|(?<=glistening )star|(?<=bloodfire )shell) idol") then gosub WEAR idol
     if matchre("$righthand $lefthand", "(?i)damaris") then gosub DAMARIS_RESET
     if matchre("$righthand $lefthand", "(?i)apparatus") then
          {
               put drop apparatus
               pause 0.4
          }
     if matchre("$righthand $lefthand", "torch") then
          {
               put snuff my torch
               pause 0.4
          }
     if matchre("$righthand $lefthand", "((?!:a |braided )vines?|(?<!hulnik )grass)") then
          {
               put drop my $1
               pause 0.1
               put drop my $1
               pause 0.2
          }
     if (matchre("$lefthandnoun $righthandnoun", "bundle") && (%Bundle.Wear = 1)) then gosub WEAR_BUNDLE
     if matchre("$lefthand $righthand", "%Sheath.Weapons") then gosub SHEATH_CHECK
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then goto RETURN_CLEAR
     if matchre("$lefthand $righthand", "%TEXTBOOK.TYPE") then
          {
               if !matchre("$UC_Container.Textbook", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put %TEXTBOOK.TYPE in my $UC_Container.Textbook
               if matchre("$lefthand $righthand", "%TEXTBOOK.TYPE") then gosub STOWIT %TEXTBOOK.TYPE
          }
     if matchre("$lefthand", "(codex|logbook|(?!:remedies|blacksmithing|weaponsmithing|armorsmithing|tailoring|artificing|carving|shaping) book)") then
          {
               if !matchre("$UC_Container.Crafting", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put $lefthand in my $UC_Container.Crafting
          }
     if matchre("$righthand", "(codex|logbook|(?!:remedies|blacksmithing|weaponsmithing|armorsmithing|tailoring|artificing|carving|shaping) book)") then
          {
               if !matchre("$UC_Container.Crafting", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put $righthand in my $UC_Container.Crafting
          }
     if matchre("$lefthand $righthand", "$UC_Cambrinth") then gosub WEAR $UC_Cambrinth
     if matchre("$lefthand $righthand", "flickering tower shield") then gosub WEAR shield
     if (matchre("$righthand $lefthand", "(?i)%TMFoci") && matchre("%TMFoci.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub WEAR %TMFoci
     if (matchre("$righthand $lefthand", "(?i)%TMFoci") && !matchre("%TMFoci.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub PUT put %TMFoci in my %TMFoci.Container
     if (matchre("$righthand $lefthand", "(?i)%Ritual") && matchre("%Ritual.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub WEAR %Ritual
     if (matchre("$righthand $lefthand", "(?i)%Ritual") && !matchre("%Ritual.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub PUT put %Ritual in my %Ritual.Container
     if (matchre("$righthand $lefthand", "(?i)%Ritual") then gosub WEAR %Ritual
     if (matchre("$righthand $lefthand", "(?i)%TMFoci") then gosub WEAR %TMFoci
     if matchre("$righthand $lefthand", "(heavy steel|polished brass|thick copper|bronze|steel|dark|rippled|desert-tan steel|washed|pink|gloomwood|haralun|bark|coral|golden) katavdar") then gosub KAT_RESET
     if matchre("$righthand $lefthand", "exoskeletal (ritual dagger|sword|mace|rapier|maul|scimitar|longsword|katar|claymore|broadsword|axe|bludgeon|hammer|nightstick|pike|halberd|morning star|battle axe)") then gosub EXO_RESET
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
     if matchre("$righthand $lefthand", "(\b%Wear.Weapons\b)") then gosub WEAR $1
     # if matchre("$righthand $lefthand", "(%Long.Weapons)") then gosub WEAR $1
     if matchre("$righthandnoun $lefthandnoun", "(?<!bundling )rope") then
          {
               put coil my rope
               pause 0.2
          }
     if matchre("$righthandnoun $lefthandnoun", "bundle") then put wear bund;drop bund
     if matchre("$lefthandnoun $righthandnoun", "(granite block|block)") then put drop block
     if matchre("$roomobjs", "almanac") then gosub STOW almanac
     if matchre("$roomobjs", "(%Wand1|%Wand2)") then gosub GET $1
     if matchre("$roomobjs", "(%TEXTBOOK.TYPE)") then gosub STOWIT %TEXTBOOK.TYPE
     if matchre("$roomobjs", "(%JOURNAL.TYPE)") then gosub STOWIT %JOURNAL.TYPE
     if matchre("$roomobjs", "(%ALMANAC.TYPE)") then gosub STOWIT %ALMANAC.TYPE
     if matchre("$roomobjs", "(%LOCKPICK.ITEM)") then gosub STOWIT %LOCKPICK.ITEM
     if matchre("$lefthand $righthand", "(%Wand1)") then
          {
               gosub PUT put $1 in my %Wand1.Container
               if matchre("$lefthand $righthand", "(%Wand1)") then gosub STOW $1
          }
     if matchre("$lefthand $righthand", "(%Wand2)") then
          {
               gosub PUT put $1 in my %Wand2.Container
               if matchre("$lefthand $righthand", "%Wand2") then gosub STOW $1
          }
     if matchre("$lefthand $righthand", "%TEXTBOOK.TYPE") then
          {
               gosub PUT put %TEXTBOOK.TYPE in my %Textbook.Container
               if matchre("$lefthand $righthand", "%TEXTBOOK.TYPE") then gosub STOW %TEXTBOOK.TYPE
          }
     if matchre("$lefthand $righthand", "%ALMANAC.TYPE") then
          {
               gosub PUT put %ALMANAC.TYPE in my %Almanac.Container
               if matchre("$lefthand $righthand", "%ALMANAC.TYPE") then gosub STOW %ALMANAC.TYPE
          }
     if matchre("$lefthand $righthand", "%LOCKPICK.ITEM") then
          {
               gosub WEAR %LOCKPICK.ITEM
               if matchre("$lefthand $righthand", "%LOCKPICK.ITEM") then gosub STOW %LOCKPICK.ITEM
          }
     if matchre("$lefthand $righthand", "(%JOURNAL.TYPE)") then gosub STOW $1
     if matchre("$righthandnoun", "(crossbow|bow|short bow|sling|arbalest|slurbow)") then gosub UNLOAD
     if matchre("$righthandnoun $lefthandnoun","(partisan|shield|buckler|halberd|staff|longbow|khuj|tower shield)") then gosub wear $1
     ## if matchre("$roomobjs", "lumpy bundle") && (%Bundle.Wear = 1) then send get bundle;-0.05 wear bundle
     if matchre("$lefthand $righthand", "\bfan\b") then send CLOSE my fan
     if matchre("$lefthandnoun $righthandnoun", "material") then gosub EMPTY material
     if matchre("$lefthandnoun $righthandnoun", "zills") then gosub PUT wear my zill
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
     # if contains("$lefthandnoun $righthandnoun", "(halberd|staff|longbow|khuj|spear)") then gosub PUT my $1 in my $UC_Container.Sheath
     delay 0.0001
     if (($UC_SummonWeapons = 1) && (%summoning = 1)) then
          {
               if (contains("$righthand", "%WM.Weapon") && ("$lefthand" = "Empty")) then return
               if (contains("$lefthand", "%WM.Weapon") && ("$righthand" = "Empty")) then return
               if (contains("$righthand", "%WM.Weapon") && !matchre("$lefthand", "Empty")) then gosub STOW left
               if (contains("$lefthand", "%WM.Weapon") && !matchre("$righthand", "Empty")) then gosub STOW right
               if contains("$lefthand", "%WM.Weapon") then gosub EMPTY left
               if contains("$righthand", "%WM.Weapon") then gosub EMPTY right
               return
          }
     if !matchre("$lefthand", "Empty") then gosub STOW left
     if (("$lefthand" = "Empty") && matchre("$righthand", "%TMFoci") && (%Foci.Active = 1)) then return
     if (!matchre("$righthand", "Empty") && (%Foci.Active = 0)) then gosub STOW right
     return
##### SINGLE STOW FUNCTION WITHOUT CHECKING FOR SHEATH WEAPONS (Unless using "STOWIT right" "STOWIT left")
STOW_REAL:
     if matchre("$righthand $lefthand", "(%Wear.Weapons)") then gosub WEAR $1
     if matchre("$righthand $lefthand", "(%Long.Weapons)") then gosub WEAR $1
     if !matchre("$righthand", "Empty") then gosub STOWIT right
     if !matchre("$lefthand", "Empty") then gosub STOWIT left
     return
SWAP_STOW:
     pause 0.0001
     gosub SWAP
     gosub STOWIT right
     gosub SWAP
     return
STOWIT:
     delay 0.00001
     var sheathed 0
     var LOCATION STOWIT_1
     var todo $0
STOWIT_1:
     if matchre("$righthand $lefthand", "(?i)(%ALLCONTAINERS)") then put WEAR $1
     if (matchre("$righthand $lefthand", "pouch") && matchre("%todo", "(?i)pouch")) then
          {
               send STOW %gemPouch
               pause 0.4
          }
     if (matchre("$righthand $lefthand", "(?i)tessera") && matchre("%todo", "(?i)tessera")) then
          {
               if !matchre("$UC_Container", "(?i)(portal|eddy)") then gosub PUT put tessera in my $UC_Container
               if (matchre("$righthand $lefthand", "(?i)tessera") && !matchre("$UC_Container.Box", "(?i)(portal|eddy)")) then gosub PUT put tessera in my $UC_Container.Box
               if (matchre("$righthand $lefthand", "(?i)tessera") && !matchre("$UC_Container.Crafting", "(?i)(portal|eddy)")) then gosub PUT put tessera in my $UC_Container.Crafting
               if (matchre("$righthand $lefthand", "(?i)tessera") && !matchre("$UC_Container.Sheath", "(?i)(portal|eddy)")) then gosub PUT put tessera in my $UC_Container.Sheath
               if (matchre("$righthand $lefthand", "(?i)tessera") && !matchre("$UC_Container.Backup", "(?i)(portal|eddy)")) then gosub PUT put tessera in my $UC_Container.Backup
          }
     if contains("$lefthand $righthand", "$UC_Cambrinth") then gosub WEAR $UC_Cambrinth
     if (contains("$righthand $lefthand", "(?i)%TMFoci") && matchre("%TMFoci.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub WEAR %TMFoci
     if (contains("$righthand $lefthand", "(?i)%TMFoci") && !matchre("%TMFoci.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub PUT put %TMFoci in my %TMFoci.Container
     if (contains("$righthand $lefthand", "(?i)%Ritual") && matchre("%Ritual.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub WEAR %Ritual
     if (contains("$righthand $lefthand", "(?i)%Ritual") && !matchre("%Ritual.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub PUT put %Ritual in my %Ritual.Container
     if (contains("$righthand $lefthand", "(?i)%Ritual") then gosub WEAR %Ritual
     if (contains("$righthand $lefthand", "(?i)%TMFoci") then gosub WEAR %TMFoci
     if (!contains("$righthand $lefthand", "%todo") && matchre("%todo", "(?i)($UC_Cambrinth|%TMFoci|%Ritual)")) then return
     if ((("$righthand" = "Empty") && matchre("%todo", "(?i)right")) || (("$lefthand" = "Empty") && matchre("%todo", "(?i)left"))) then return
     if matchre("%todo", "torch") then
          {
               put snuff my torch
               pause 0.4
          }
     # if matchre("$righthand $lefthand", "(heavy steel|polished brass|thick copper|bronze|steel|dark|rippled|desert-tan steel|washed|pink|gloomwood|haralun|bark|coral|golden) katavdar") then gosub KAT_RESET
     if matchre("%todo", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then return
     if matchre("%todo", "(?i)left") then
          {
          if matchre("$lefthand", "\b(hairpin|thighband|earcuff|amulet|wristcuff|ring|skull|anklet|armband|pendant|earrings|band|torque)\b") then
               {
                    put WEAR my $1
                    pause 0.4
                    pause 0.2
               }
          if matchre("$lefthand", "exoskeletal (sword|mace|rapier|maul|scimitar|longsword|katar|claymore|broadsword|axe|bludgeon|hammer|nightstick|pike|halberd)") then gosub EXO_RESET
          if matchre("$lefthand", "(?i)damaris") then gosub DAMARIS_RESET
          if matchre("$lefthand", "(%Long.Weapons|%Wear.Weapons)") then gosub WEAR $1
          if matchre("$lefthand", "(?i)%Sheath.Weapons") && (%sheathed = 0) then
               {
                    var sheathed 1
                    gosub SHEATH_CHECK_LEFT
                    pause 0.01
               }
          }
     if matchre("%todo", "(?i)right") then
          {
          if matchre("$righthand", "\b(hairpin|thighband|earcuff|amulet|wristcuff|ring|skull|anklet|armband|pendant|earrings|band|torque)\b") then
               {
                    put WEAR my $1
                    pause 0.4
                    pause 0.2
               }
          if matchre("$righthand", "exoskeletal (sword|mace|rapier|maul|scimitar|longsword|katar|claymore|broadsword|axe|bludgeon|hammer|nightstick|pike|halberd)") then gosub EXO_RESET
          if matchre("$righthand", "(?i)damaris") then gosub DAMARIS_RESET
          if matchre("$righthand", "(%Long.Weapons|\b%Wear.Weapons\b)") then gosub WEAR $1
          if matchre("$righthand", "(?i)%Sheath.Weapons") && (%sheathed = 0) then
               {
                    var sheathed 1
                    gosub SHEATH_CHECK_RIGHT
                    pause 0.01
               }
          }
     if matchre("$lefthand $righthand", "(vine|braided vine)") then gosub PUT drop my vine
     matchre STOWIT_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre ESCAPE_HEAL ^You can't pick that up with your hands that damaged\.|^Both your hands are missing\!
     matchre STUNNED ^You are still stunned
     matchre STOW_2 ^You think the .+ is too full to fit another gem into\.|have all been used\.|As you attempt to place your
     matchre STOW_2 ^There\'s no room|^There isn\'t any more room|no matter how you arrange|^What were you|^Where are you|^Weirdly\,
     matchre STOW_2 ^(That\'s|The .*) too (heavy|thick|long|wide)|not designed to carry|cannot hold any more|^(You|I) can't
     matchre STOWLEFT ^You need a free hand
     matchre STOWIT_UNROLL ^You should roll it up first\.
     matchre CLOSEIT ^You'll need to close the
     matchre LOCATION.unload ^You should unload the
     matchre LOCATION.unload ^You need to unload the
     matchre CURSED_ITEM ^Oddly\, when you attempt to stash it away safely\, the .+ clings to your palm
     matchre OPEN_BAGS ^But that's closed
     matchre SWAP_STOW ^You need to be holding the balanced tago in your right hand to sheath it\.
     matchre STOW_RETURN ^Wear what\?|^Stow what\?|Type 'STOW HELP'|^Please rephrase
     matchre STOW_RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre STOW_RETURN ^As you reach
     matchre STOW_RETURN ^You open
     matchre STOW_RETURN needs to be|^Perhaps you should
     matchre STOW_RETURN ^You stop as you realize
     matchre STOW_RETURN ^But that is already in your inventory\.
     matchre STOW_RETURN ^That can't be picked up
     matchre STOW_RETURN ^The %todo rapidly decays away\.
     put stow %todo
     matchwait 20
     echo *** MISSING MATCH IN STOWIT! ***
     put #echo >Log Crimson  *** MISSING MATCH IN STOWIT! (ubercombat.cmd) ***
     put #echo >Log Crimson  Stow = %todo
     put #log $datetime MISSING MATCH IN STOWIT (ubercombat.cmd)
     goto STOW_RETURN
STOWIT_UNROLL:
     pause 0.2
     put roll %todo
     pause 0.5
     goto STOWIT_1
STOWLEFT:
     gosub STOWIT left
     pause 0.3
ROLLIT:
     pause 0.0001
     put roll my %PrayerMat
     pause 0.2
     put roll %todo
     pause 0.5
     goto STOW_1
CLOSEIT:
     if !matchre("$righthand", "Empty") then send stow right
     pause 0.2
     if !matchre("$righthand", "Empty") then send close my $righthand
     if !matchre("$lefthand", "Empty") then send close my $lefthand
     pause 0.5
     goto STOW_1
STOW:
     delay 0.00001
     var stowloop 0
     var LOCATION STOW_1
     var todo $0
     if matchre("%todo", "ball and chain") then var todo ball
     if matchre("$righthand $lefthand", "(?i)(%ALLCONTAINERS)") then gosub WEAR $1
     if matchre("$righthand $lefthand", "(?i)damaris") then gosub DAMARIS_RESET
     if matchre("$lefthand $righthand", "$UC_Cambrinth") then gosub WEAR $UC_Cambrinth
     if (matchre("$righthand $lefthand", "(?i)%TMFoci") && matchre("%TMFoci.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub WEAR %TMFoci
     if (matchre("$righthand $lefthand", "(?i)%TMFoci") && !matchre("%TMFoci.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub PUT put %TMFoci in my %TMFoci.Container
     if (matchre("$righthand $lefthand", "(?i)%Ritual") && matchre("%Ritual.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub WEAR %Ritual
     if (matchre("$righthand $lefthand", "(?i)%Ritual") && !matchre("%Ritual.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub PUT put %Ritual in my %Ritual.Container
     if (matchre("$righthand $lefthand", "(?i)%Ritual") then gosub WEAR %Ritual
     if (matchre("$righthand $lefthand", "(?i)%TMFoci") then gosub WEAR %TMFoci
     if matchre("$righthand $lefthand", "\b(%Wear.Weapons)\b") then gosub WEAR $1
     if matchre("$righthand $lefthand", "(%Long.Weapons)") then gosub WEAR $1
     if (!contains("$righthand $lefthand", "%todo") && matchre("%todo", "(?i)($UC_Cambrinth|%TMFoci|%Ritual)")) then return
     if matchre("%todo", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then return
     if matchre("$righthand $lefthand", "(heavy steel|polished brass|thick copper|bronze|steel|dark|rippled|desert-tan steel|washed|pink|gloomwood|haralun|bark|coral|golden) katavdar") then
          {
               gosub KAT_RESET
               if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
          }
     if matchre("$righthand $lefthand", "exoskeletal (sword|mace|rapier|maul|scimitar|longsword|katar|claymore|broadsword|axe|bludgeon|hammer|nightstick|pike|halberd)") then
          {
               gosub EXO_RESET
               if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
          }
     if matchre("$righthand $lefthand", "\b(hairpin|thighband|earcuff|amulet|wristcuff|ring|skull|anklet|armband|pendant|earrings|band|torque)\b") then
          {
               put WEAR my $1
               pause 0.4
               pause 0.2
               if ((("$righthand" = "Empty") && matchre("%todo", "(?i)right")) || (("$lefthand" = "Empty") && matchre("%todo", "(?i)left"))) then return
          }
     if matchre("%todo", "(?i)%Sheath.Weapons") then gosub SHEATH_CHECK
     if (matchre("%todo", "(?i)right") && matchre("$righthand", "(?i)%Sheath.Weapons")) then gosub SHEATH_CHECK
     if (matchre("%todo", "(?i)left") && matchre("$lefthand", "(?i)%Sheath.Weapons")) then gosub SHEATH_CHECK
     if matchre("$lefthand $righthand", "(vine|braided vine)") then gosub PUT drop my vine
     # if ("$righthand" = "Empty") && ("$lefthand" = "Empty") then return
     # if ($UC_SummonWeapons = 1) && contains("$righthand", "%WM.Weapon") && !matchre("$lefthand", "Empty") then gosub STOW $lefthandnoun
     # if ($UC_SummonWeapons = 1) && contains("$lefthand", "%WM.Weapon") && !matchre("$righthand", "Empty") then gosub STOW $righthandnoun
     # if ($UC_SummonWeapons = 1) && contains("$righthand $lefthand", "%WM.Weapon") && !matchre("%NextSkill", "%nonSummonSkills") then return
STOW_1:
     math stowloop add 1
     if matchre("%todo", "ball and chain") then var todo ball
     if (%stowloop > 4) then
          {
               var stowloop 0
               return
          }
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre RETURN_HEAL ^You can't pick that up with your hands that damaged\.|^Both your hands are missing\!
     matchre OPEN_BAGS ^But that's closed
     matchre STOWLEFT ^You need a free hand
     matchre CLOSEIT ^You'll need to close the
     matchre ROLLIT ^You (should|need to) roll it up
     matchre LOCATION.unload ^You (should|need to) unload
     matchre CURSED_ITEM ^Oddly\, when you attempt to stash it away safely\, the .+ clings to your palm
	matchre TEND_LODGED ^That .* needs to be tended to be removed.
     matchre STOW_2 ^There\'s no room|^There isn\'t any more room|no matter how you arrange|^Where are you|^Weirdly\,|You can't put items|As you attempt to place your
     matchre STOW_2 ^(That\'s|The .*) too (heavy|thick|long|wide)|not designed to carry|cannot hold any more|^(You|I) can't|have all been used\.|^What were you
     matchre STOW_2 ^That stack of herbs is too large to add more to\.
     matchre STOW_RETURN ^Wear what\?|^Stow what\?|Type \'STOW HELP\'|^But that is already in your inventory\.
     matchre STOW_RETURN ^As you reach|^That can't be picked up|^Perhaps you should|^I could not
     matchre STOW_RETURN ^You stop as you realize|needs to be|^Please rephrase
     matchre STOW_RETURN You'?r?e? (?:hand|slip|put|get|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre GET1 ^But that is already
     put stow %todo
     matchwait 20
     echo *** MISSING MATCH IN STOW_1! ***
     put #echo >Log Crimson  *** MISSING MATCH IN STOW_1! (ubercombat.cmd) ***
     put #echo >Log Crimson  Stow = %todo
     put #log $datetime MISSING MATCH IN STOW_1 (ubercombat.cmd)
STOW2:
STOW_2:
     if matchre("$UC_Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto STOW_3
     if matchre("%todo", "(?i)right") then var todo $righthandnoun
     if matchre("%todo","(?i)left") then var todo $lefthandnoun
     if matchre("%todo", "(?i)%Sheath.Weapons") then gosub SHEATH_CHECK
     pause 0.00001
     var LOCATION STOW_2
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre RETURN_HEAL ^You can't pick that up with your hands that damaged\.|^Both your hands are missing\!
     matchre OPEN_BAGS ^But that's closed
     matchre CLOSEIT ^You'll need to close the
     matchre LOCATION.unload ^You (should|need to) unload
     matchre CURSED_ITEM ^Oddly\, when you attempt to stash it away safely\, the .+ clings to your palm
     matchre STOW_3 ^There\'s no room|^There isn\'t any more room|no matter how you arrange|^Where are you|^Weirdly\,|You can't put items|As you attempt to place your
     matchre STOW_3 ^(That\'s|The .*) too (heavy|thick|long|wide)|not designed to carry|cannot hold any more|^(You|I) can't|have all been used\.|^What were you
     matchre STOW_3 ^That stack of herbs is too large to add more to\.
     matchre STOW_RETURN ^Wear what\?|^Stow what\?|Type \'STOW HELP\'|^But that is already in your inventory\.
     matchre STOW_RETURN ^As you reach|^That can't be picked up|^Perhaps you should|^I could not
     matchre STOW_RETURN ^You stop as you realize|needs to be|^Please rephrase
     matchre STOW_RETURN You'?r?e? (?:hand|slip|put|get|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     put put %todo in my $UC_Container
     matchwait 20
     echo *** MISSING MATCH IN STOW_2! ***
     put #echo >Log Crimson  *** MISSING MATCH IN STOW2! (ubercombat.cmd) ***
     put #echo >Log Crimson  Stow = %todo
     put #log $datetime MISSING MATCH IN STOW2 (ubercombat.cmd)
STOW_3:
     delay 0.00001
     var LOCATION STOW_3
     if matchre("$UC_Container.Box", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto STOW_4
     gosub PUT open my $UC_Container.Box
     pause 0.00001
     if ("$righthand" = "Empty") && ("$lefthand" = "Empty") then goto STOW_RETURN
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre RETURN_HEAL ^You can't pick that up with your hands that damaged\.|^Both your hands are missing\!
     matchre OPEN_BAGS ^But that's closed
     matchre CLOSEIT ^You'll need to close the
     matchre LOCATION.unload ^You (should|need to) unload
     matchre CURSED_ITEM ^Oddly\, when you attempt to stash it away safely\, the .+ clings to your palm
     matchre STOW_4 ^There\'s no room|^There isn\'t any more room|no matter how you arrange|^Where are you|^Weirdly\,|You can't put items|As you attempt to place your
     matchre STOW_4 ^(That\'s|The .*) too (heavy|thick|long|wide)|not designed to carry|cannot hold any more|^(You|I) can't|have all been used\.|^What were you
     matchre STOW_4 ^That stack of herbs is too large to add more to\.
     matchre STOW_RETURN ^Wear what\?|^Stow what\?|Type \'STOW HELP\'|^But that is already in your inventory\.
     matchre STOW_RETURN ^As you reach|^That can't be picked up|^Perhaps you should|^I could not
     matchre STOW_RETURN ^You stop as you realize|needs to be|^Please rephrase
     matchre STOW_RETURN You'?r?e? (?:hand|slip|put|get|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     put put %todo in my $UC_Container.Box
     matchwait 20
     echo *** MISSING MATCH IN STOW_3! ***
     put #echo >Log Crimson  *** MISSING MATCH IN STOW3! (ubercombat.cmd) ***
     put #echo >Log Crimson  Stow = %todo
     put #log $datetime MISSING MATCH IN STOW3 (ubercombat.cmd)
STOW_4:
     delay 0.00001
     delay 0.00001
     var LOCATION STOW_4
     if matchre("$UC_Container.Sheath", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto STOW_5
     if ("$righthand" = "Empty") && ("$lefthand" = "Empty") then goto STOW_RETURN
     if matchre("$lefthandnoun $righthandnoun", "\b(skippet|coffer|trunk|chest|strongbox|crate|box|casket|caddy)\b") then goto DROP_BOX
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre RETURN_HEAL ^You can't pick that up with your hands that damaged\.|^Both your hands are missing\!
     matchre OPEN_BAGS ^But that's closed
     matchre CLOSEIT ^You'll need to close the
     matchre LOCATION.unload ^You (should|need to) unload
     matchre CURSED_ITEM ^Oddly\, when you attempt to stash it away safely\, the .+ clings to your palm
     matchre STOW_5 ^There\'s no room|^There isn\'t any more room|no matter how you arrange|^Where are you|^Weirdly\,|You can't put items|As you attempt to place your
     matchre STOW_5 ^(That\'s|The .*) too (heavy|thick|long|wide)|not designed to carry|cannot hold any more|^(You|I) can't|have all been used\.|^What were you
     matchre STOW_RETURN ^Wear what\?|^Stow what\?|Type \'STOW HELP\'|^But that is already in your inventory\.
     matchre STOW_RETURN ^As you reach|^That can't be picked up|^Perhaps you should|^I could not
     matchre STOW_RETURN ^You stop as you realize|needs to be|^Please rephrase
     matchre STOW_RETURN You'?r?e? (?:hand|slip|put|get|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     put put %todo in my $UC_Container.Sheath
     matchwait 20
     echo *** MISSING MATCH IN STOW_4! ***
     put #echo >Log Crimson  *** MISSING MATCH IN STOW4! (ubercombat.cmd) ***
     put #echo >Log Crimson  Stow = %todo
     put #log $datetime MISSING MATCH IN STOW4 (ubercombat.cmd)
STOW_5:
     delay 0.00001
     delay 0.00001
     var LOCATION STOW_4
     if matchre("$UC_Container.Backup", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto REM_WEAR
     if matchre("$lefthandnoun $righthandnoun", "bundle") then gosub PUT drop bundle
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre RETURN_HEAL ^You can't pick that up with your hands that damaged\.|^Both your hands are missing\!
     matchre OPEN_BAGS ^But that's closed
     matchre CLOSEIT ^You'll need to close the
     matchre LOCATION.unload ^You (should|need to) unload
     matchre REM_WEAR ^There\'s no room|^There isn\'t any more room|no matter how you arrange|^Where are you|^Weirdly\,|As you attempt to place your|^What were you
     matchre REM_WEAR ^(That\'s|The .*) too (heavy|thick|long|wide)|not designed to carry|cannot hold any more|^(You|I) can't|have all been used\.|You can't put items
     matchre STOW_RETURN ^Wear what\?|^Stow what\?|Type \'STOW HELP\'|^But that is already in your inventory\.
     matchre STOW_RETURN ^As you reach|^That can't be picked up|^Perhaps you should|^I could not|^Please rephrase
     matchre STOW_RETURN ^You stop as you realize|needs to be
     matchre STOW_RETURN You'?r?e? (?:hand|slip|put|get|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     put put %todo in my $UC_Container.Backup
     matchwait 20
     echo *** MISSING MATCH IN STOW_5! ***
     put #echo >Log Crimson  *** MISSING MATCH IN STOW5! (ubercombat.cmd) ***
     put #echo >Log Crimson  Stow = %todo
     put #log $datetime MISSING MATCH IN STOW5 (ubercombat.cmd)
STOW_RETURN:
     unvar sheathed
     return
OPEN_BAGS:
     gosub OPEN $UC_Container
     gosub OPEN $UC_Container.Box
     gosub OPEN $UC_Container.Backup
     gosub OPEN $UC_Container.Crafting
     gosub OPEN $UC_Container.Sheath
     gosub OPEN $UC_Container.Ammo
     gosub OPEN $UC_Container.Ammo.Backup
     goto STOW_1
TEND_LODGED:
	var LODGEDLOCATION %LOCATION
	gosub BLEEDERCHECK
	goto %LODGEDLOCATION
REM_WEAR:
     gosub SHEATH_CHECK
     pause 0.00001
     send wear my %todo
     wait
     pause 0.1
     pause 0.00001
     if ("$guild" = "Warrior Mage") then
          {
               if (($UC_SummonWeapons = 1) && contains("$righthand", "%WM.Weapon")) || (matchre("$righthand", "%LongSummonWeapons")) then
                    {
                         echo *** No Room for Summoned Weapon - Dropping
                         var SummonedWeapon 0
                         var SummonDropTime $gametime
                         gosub EMPTY_RIGHT
                         pause 2
                    }
               if (($UC_SummonWeapons = 1) && contains("$lefthand", "%WM.Weapon")) || (matchre("$lefthand", "%LongSummonWeapons"))  then
                    {
                         echo *** No Room for Summoned Weapon - Dropping
                         var SummonedWeapon 0
                         var SummonDropTime $gametime
                         gosub EMPTY_LEFT
                         pause 2
                         pause 0.1
                    }
               if (($UC_SummonWeapons = 1) && !contains("$righthand $lefthand", "%WM.Weapon")) then return
          }
     if (%burgling = 1) then
          {
               if (!matchre("$lefthand", "Empty") && !matchre("$lefthand", "(%MyShield|%MYWEAPONS|%CHEST.ARMOR|%HEAD.ARMOR|%FACE.ARMOR|%HEAD.ARMOR|%ARM.ARMOR|%LEG.ARMOR|%HAND.ARMOR|%BACK.ARMOR|%ABDOMEN.ARMOR|%KNUCKLE|%PARRYSTICK|parry stick|pugilist's armguard)")) then gosub EMPTY_LEFT
               if (!matchre("$righthand", "Empty") && !matchre("$righthand", "(%MyShield|%MYWEAPONS|%CHEST.ARMOR|%HEAD.ARMOR|%FACE.ARMOR|%HEAD.ARMOR|%ARM.ARMOR|%LEG.ARMOR|%HAND.ARMOR|%BACK.ARMOR|%ABDOMEN.ARMOR|%KNUCKLE|%PARRYSTICK|parry stick|pugilist's armguard)")) then gosub EMPTY_RIGHT
               pause 0.2
               return
          }
     if (matchre("$righthand", "%todo") || matchre("$lefthand", "%todo")) then goto OUT_OF_SPACE
     return
FEET_CHECK:
     var LOCATION FEET_CHECK
     action var feet $1 when ^Lying at your feet (.*)\.
     echo
     echo ######################
     echo * CHECKING FOR ITEMS AT FEET
     echo ######################
     echo
     if ($standing = 0) then gosub STAND
     if ($standing = 0) then gosub STAND
     delay 0.00001
     if !matchre("$lefthand", "Empty") then gosub STOWIT left
     matchre FEET_CHECK ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_FOOT ^Lying at your feet
     matchre STOW_FOOT_2 INVENTORY HELP
     put inv weapon
     matchwait 10
     goto STOW_FOOT_2
STOW_FOOT:
     eval Feet.Weapons replacere("%ALLWEAPONS", "\|+", "|")
     eval Feet.Weapons replacere("%ALLWEAPONS", "\|$", "")
     if matchre("%feet", "(%Feet.Weapons)") then gosub STOW $0
     if matchre("($roomobjs|%feet)", "\b(?i)%PrayerMat\b") then
          {
               put roll %PrayerMat
               pause 0.5
               gosub stowing
          }
     gosub STOW feet
     gosub STOW feet
     if (!matchre("$lefthand", "Empty") || !matchre("$righthand", "Empty")) then gosub STOWIT left
     if matchre("$roomobjs", "\b(?<!pike |pitted bronze |[Rr]usted |rusty |spindly short |dull iron |battered |beaten )(%MYWEAPONS)(?!(\-toothed| bolt| arrow| shard| stuck in the ground))\b") then gosub STOW feet
     if matchre("$roomobjs", "(%Feet.Weapons)") then gosub STOW feet
     if matchre("$roomobjs", "(%Feet.Weapons)") then gosub STOW $1
     goto FEET_CHECK
STOW_FOOT_2:
     action remove ^Lying at your feet (.*)\.
     gosub stowAmmo
     return
#################################
### CLEAR HANDS - USED AFTER WEAPON IS DONE TRAINING
### SLIGHTLY DIFFERENT FROM STOWING ROUTINE
CLEARHANDS:
     var LOCATION CLEARHANDS
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
     if matchre("$righthand $lefthand", "(?i)(%ALLCONTAINERS)") then gosub WEAR $1
     if matchre("$righthand $lefthand", "(?i)damaris") then gosub DAMARIS_RESET
     if matchre("$righthand $lefthand", "(heavy steel|polished brass|thick copper|bronze|steel|dark|rippled|desert-tan steel|washed|pink|gloomwood|haralun|bark|coral|golden) katavdar") then gosub KAT_RESET
     if matchre("$righthand $lefthand", "exoskeletal (ritual dagger|sword|mace|rapier|maul|scimitar|longsword|katar|claymore|broadsword|axe|bludgeon|hammer|nightstick|pike|halberd|morning star|battle axe)") then gosub EXO_RESET
     if matchre("$righthand", "(?i)%Sheath.Weapons") then gosub SHEATH_CHECK
     if matchre("$lefthand", "(?i)%Sheath.Weapons") then gosub SHEATH_CHECK
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
     if matchre("$lefthand $righthand", "$UC_Cambrinth") then gosub WEAR $UC_Cambrinth
     if (matchre("$righthand $lefthand", "(?i)%TMFoci") && matchre("%TMFoci.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub WEAR %TMFoci
     if (matchre("$righthand $lefthand", "(?i)%TMFoci") && !matchre("%TMFoci.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub PUT put %TMFoci in my %TMFoci.Container
     if (matchre("$righthand $lefthand", "(?i)%Ritual") && matchre("%Ritual.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub WEAR %Ritual
     if (matchre("$righthand $lefthand", "(?i)%Ritual") && !matchre("%Ritual.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub PUT put %Ritual in my %Ritual.Container
     if (matchre("$righthand $lefthand", "(?i)%Ritual") then gosub WEAR %Ritual
     if (matchre("$righthand $lefthand", "(?i)%TMFoci") then gosub WEAR %TMFoci
     if matchre("$righthand $lefthand", "(%Wear.Weapons)") then gosub WEAR $1
     # if matchre("$righthand $lefthand", "(%Long.Weapons)") then gosub WEAR $1
     if (($UC_SummonWeapons = 1) && matchre("$righthand", "%WM.Weapon") && !matchre("$lefthand", "Empty")) then gosub STOW $lefthandnoun
     if (($UC_SummonWeapons = 1) && matchre("$lefthand", "%WM.Weapon") && !matchre("$righthand", "Empty")) then gosub STOW $righthandnoun
     if (($UC_SummonWeapons = 1) && matchre("$righthand $lefthand", "%WM.Weapon") && !matchre("%NextSkill", "%nonSummonSkills")) then return
     pause 0.00001
     if matchre("$righthand $lefthand", "$UC_WEAPON_BOW") then
          {
               gosub UNLOAD
               if matchre("$righthand $lefthand", "(%Wear.Weapons)") then gosub WEAR $UC_WEAPON_BOW
          }
     if matchre("$righthand $lefthand", "$UC_WEAPON_SLING") then
          {
               gosub UNLOAD
               if matchre("$righthand $lefthand", "(%Wear.Weapons)") then gosub WEAR $UC_WEAPON_SLING
          }
     if matchre("$righthand $lefthand", "$UC_WEAPON_CROSSBOW") then
          {
               gosub UNLOAD
               if matchre("$righthand $lefthand", "(%Wear.Weapons)") then gosub WEAR $UC_WEAPON_CROSSBOW
          }
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
     # if contains("$righthandnoun $lefthandnoun", "(partisan|shield|buckler|lumpy bundle|halberd|staff|longbow|khuj|spear|pilum)") then gosub WEAR $1
     if matchre("$righthand $lefthand", "%ALLWEAPONS") then if !matchre("%WEAPON", "(?i)($charactername|NULL)") then gosub SHEATH
     if matchre("$righthand $lefthand", "$UC_WEAPON_SB") then gosub STOW $UC_WEAPON_SB
     if matchre("$righthand $lefthand", "$UC_WEAPON_LB") then gosub STOW $UC_WEAPON_LB
     if matchre("$righthand $lefthand", "$UC_WEAPON_THB") then gosub STOW $UC_WEAPON_THB
     if matchre("$righthand $lefthand", "$UC_WEAPON_SE") then gosub STOW $UC_WEAPON_SE
     if matchre("$righthand $lefthand", "$UC_WEAPON_LE") then gosub STOW $UC_WEAPON_LE
     if matchre("$righthand $lefthand", "$UC_WEAPON_THE") then gosub STOW $UC_WEAPON_THE
     if matchre("$righthand $lefthand", "$UC_WEAPON_HT") then gosub STOW $UC_WEAPON_HT
     if matchre("$righthand $lefthand", "$UC_WEAPON_LT") then gosub STOW $UC_WEAPON_LT
     if matchre("$righthand $lefthand", "$UC_WEAPON_BOW") then gosub STOW $UC_WEAPON_BOW
     if matchre("$righthand $lefthand", "$UC_WEAPON_SLING") then gosub STOW $UC_WEAPON_SLING
     if matchre("$righthand $lefthand", "$UC_WEAPON_CROSSBOW") then gosub STOW $UC_WEAPON_CROSSBOW
     if matchre("$righthand $lefthand", "$UC_WEAPON_POLEARMS") then gosub STOW $UC_WEAPON_POLEARMS
     if matchre("$righthand $lefthand", "$UC_WEAPON_STAVES") then gosub STOW $UC_WEAPON_STAVES
     if matchre("$righthand $lefthand", "$UC_MyShield") then gosub WEAR $UC_MyShield
     if matchre("$righthand $lefthand", "$UC_WEAPON_POLEARMS") then gosub STOW $UC_WEAPON_POLEARMS
     if matchre("$righthand $lefthand", "$UC_WEAPON_STAVES") then gosub WEAR $UC_WEAPON_STAVES
     # if matchre("$roomobjs" , "%ALLWEAPONS") then gosub STOW $1
     if matchre("$roomobjs" , "\b$UC_WEAPON_LT\b") then gosub STOW $UC_WEAPON_LT
     if matchre("$roomobjs" , "\b$UC_WEAPON_HT\b") then gosub STOW $UC_WEAPON_HT
     if matchre("$roomobjs" , "\b%MAINARROW\b") then gosub STOW %MAINARROW
     if matchre("$roomobjs" , "\b%BowAmmo\b") then gosub STOW %BowAmmo
     if matchre("$roomobjs" , "\b%XbowAmmo\b") then gosub STOW %XbowAmmo
     if matchre("$roomobjs" , "\b%SlingAmmo(?! guardian| fall)\b") then gosub STOW %SlingAmmo
     if !matchre("$lefthand", "Empty") && !matchre("$lefthand", "%TMFoci") && (%Foci.Active = 0) then gosub STOWIT left
     if !matchre("$righthand", "Empty") && !matchre("$righthand", "%TMFoci") && (%Foci.Active = 0) then gosub STOWIT right
     # debuglevel 0
     return
##### RETRIEVE RANGED AMMO #####
##### GREEDY!!!!
AMMOCLEANUP:
RETRIEVE_CHECK:
     var RetrieveCheck 0
RETRIEVE_CHECK_1:
     var LOCATION RETRIEVE_CHECK_1
     math RetrieveCheck add 1
     if (%RetrieveCheck > 4) then goto RETRIEVE_DONE
     if (!$UC_Ammo) then goto RETRIEVE_DONE
     var Ammo NULL
     if (($UC_SummonWeapons = 1) && contains("$righthand", "%WM.Weapon") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
     if (($UC_SummonWeapons = 1) && contains("$lefthand", "%WM.Weapon") && !matchre("$righthand", "Empty")) then gosub STOWIT right
     if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
     if matchre("$roomobjs", "\b(?<!pike |pitted bronze |[Rr]usted |rusty |spindly short |dull iron |battered |beaten )(%MYWEAPONS)(?!(\-toothed| bolt| arrow| shard| stuck in the ground))\b") then
          {
               if (($UC_Bonded = 1) && (%ammolodged = 1)) then
                    {
                         send invoke
                         pause 0.2
                         pause 0.1
                         if matchre("$righthand", "Empty") then send invoke
                         pause 0.2
                         pause 0.1
                    }
               pause 0.001
               if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
               if matchre("$roomobjs", "\b(?<!pike |pitted bronze |[Rr]usted |rusty |spindly short |dull iron |battered |beaten )(%MYWEAPONS)(?!(\-toothed| bolt| arrow| shard| stuck in the ground))\b") then gosub GET $1
               pause 0.1
          }
     ## if matchre("$lefthand $righthand", "%Sheath.Weapons") then gosub SHEATH_CHECK
     ## if matchre("$lefthand $righthand", "%MYWEAPONS") then gosub STOWIT $1
     if matchre("$roomobjs","(?i)%WEAPON") then
          {
               if !matchre("$roomobjs","(?<![Dd]ull iron )hurling axe") then gosub STOWIT %WEAPON
               if matchre("$roomobjs","(?<![Dd]ull iron )hurling axe") && matchre("$roomobjs","(?i)%WEAPON") then gosub STOWIT %WEAPON
          }
     if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
     if (matchre("$roomobjs","(?i)throwing blade") && matchre("$UC_WEAPON_LT", "blade")) then gosub STOWBLADE
     if matchre("$roomobjs", "$UC_WEAPON_HT") then gosub STOWIT $UC_WEAPON_HT
     if matchre("$roomobjs", "$UC_WEAPON_LT") then gosub STOWIT $UC_WEAPON_LT
     if matchre("$roomobjs", "\b(%MAINARROW)\b(?! troll)") then var Ammo $1
     if (matchre("$roomobjs", "\b%SlingAmmo(?! guardian| fall)\b") && !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var Ammo $1
     if (matchre("$roomobjs", "\b(%XbowAmmo)\b(?! troll)") && !matchre("$UC_WEAPON_CROSSBOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var Ammo $1
     if (matchre("$roomobjs", "\b(%BowAmmo)\b(?! troll)") && !matchre("$UC_WEAPON_BOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var Ammo $1
     if (matchre("$roomobjs", "(?i)(river rock|river rocks|spider-carved rock)") && matchre("%SlingAmmo" "rock")) then var Ammo $1
     if (matchre("$roomobjs","(?i)(pyrite clump|smoky-quartz clump|obsidian clump)") && matchre("%SlingAmmo" "(?i)clump")) then var Ammo clump
     if (matchre("$roomobjs","(?i)(elongated stones|granite stone|panther-carved stone|goblin-carved stones|unicorn-carved stone)") && matchre("%SlingAmmo" "(?i)stone")) then var Ammo stone
     if (matchre("$roomobjs", "(?i)(basilisk\b|cane\b|bone-tipped\b|barbed\b|stone-tipped\b|serrated-bodkin\b|razor-edged\b|razor-tipped\b|blunt-tipped|boar-tusk\b|cougar-claw\b|claw-tipped\b|ice-adder|drake-fang|drake|jagged-horn|angiswaerd|hele'la) (?:head|tip)?\s?arrow") && !matchre("$UC_WEAPON_BOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var Ammo $1 arrow
     if (matchre("$roomobjs","(?i)(frog-crotch bolt|angiswaerd bolt|basilisk bolt|ice-adder bolt|drake-fang bolt|jagged-horn bolt|leafhead bolt|barbed bolt|flint-tip bolt|blunt tip bolt|hele'la bolt|sabertooth bolt|elsralael bolts|serrated bone bolt)") && !matchre("$UC_WEAPON_CROSSBOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var Ammo bolt
     if (matchre("$roomobjs", "(?i)(quadrello|pulzone|quarrel)") && !matchre("$UC_WEAPON_CROSSBOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var Ammo $1
     if (matchre("$roomobjs", "(?i)(basilisk\b|cane\b|bone-tipped\b|(?>!broad-)barbed\b|broad-barbed|stone-tipped\b|serrated-bodkin\b|razor-edged\b|razor-tipped\b|blunt|boar-tusk\b|cougar-claw\b|claw-tipped\b|ice-adder|drake-fang|drake|jagged-horn|angiswaerd|hele'la) (?:head|tip)?\s?arrow") && !matchre("$UC_WEAPON_BOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var Ammo $1 arrow
     if (matchre("$roomobjs", "(quartzite stone shard|obsidian stone shard|glaes stone shard|tyrium stone shard|onyx stone shard|senci stone shard|belzune stone shard|sunderstone shard)") && !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var Ammo shard
     if (matchre("$roomobjs", "(?i)(elongated stones|granite stone|panther-carved stone|goblin-carved stones|unicorn-carved stone)") && !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var Ammo stone
     if matchre("$roomobjs", "(?i)(mirror axe|mirror blade|mirror shiv|mirror flail|stonebow|battle bow|throwing spike|thrusting blade|tago|quarrel|\btelo\b|nightstick|katana|sniper's crossbow|(?<![Ll]eather bound )\btarge\b|throwing axe|throwing club|(?<![Rr]usted )bastard sword|throwing blade|\bbola\b)") then var Ammo $1
     if (matchre("$roomobjs", "(?i)(river rock|spider-carved rock|heavy quartz rock|boggle-shaped rock|fist-sized rock|pumpkin-shaped rock|granite rock)") && !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var Ammo rock
     if (("%Ammo" = "NULL") || ("%Ammo" = "")) then goto RETRIEVE_DONE

STOW_AMMO:
     var LOCATION STOW_AMMO
     if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
     pause 0.00001
     matchre STOW_AMMO_HANDS ^You need a free hand
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre RETURN_HEAL ^You can't pick that up with your hands that damaged\.|^Both your hands are missing\!
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
	matchre TEND_LODGED ^That .* needs to be tended to be removed.
     matchre STOW_AMMO_2 ^There\'s no room|any more room|no matter how you arrange|have all been used\.
     matchre STOW_AMMO_2 ^That\'s too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^(You|I) can't|^Where are you
     matchre STOW_AMMO_GET ^But that is already|^But that's closed
     matchre RETRIEVE_CHECK ^Perhaps you
     matchre RETRIEVE_CHECK ^You put
     matchre RETRIEVE_CHECK ^Stow what\?
     matchre RETRIEVE_CHECK ^What were you referring to\?
     matchre RETRIEVE_DONE ^You stop as you realize
     matchre RETRIEVE_DONE ^Please rephrase
     matchre RETRIEVE_DONE (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     send stow %Ammo
     matchwait 15
     echo *** MISSING MATCH IN STOW_AMMO! ***
     put #echo >Log Crimson  *** MISSING MATCH IN STOW_AMMO! (ubercombat.cmd) ***
STOW_AMMO_GET:
     var LOCATION STOW_AMMO
     pause 0.1
     put get %Ammo
     pause 0.2
STOW_AMMO_2:
     var LOCATION STOW_AMMO_2
     pause 0.0001
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STOW_AMMO_3 ^There\'s no room|any more room|no matter how you arrange|have all been used\.|^But that's closed
     matchre STOW_AMMO_3 ^That\'s too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^(You|I) can't|^Where are you
     matchre RETRIEVE_CHECK ^You put
     matchre RETRIEVE_CHECK ^Perhaps you
     matchre RETRIEVE_CHECK ^Stow what\?
     matchre RETRIEVE_CHECK ^What were you referring to\?
     matchre RETRIEVE_DONE ^You stop as you realize
     matchre RETRIEVE_DONE ^Please rephrase
     put put my %Ammo in my $UC_Container
     matchwait 9
     echo *** MISSING MATCH IN STOW_AMMO_2! ***
     put #echo >Log Crimson  *** MISSING MATCH IN STOW_AMMO_2! (ubercombat.cmd) ***
STOW_AMMO_3:
     var LOCATION STOW_AMMO_2
     pause 0.0001
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STOW_AMMO_4 ^There\'s no room|any more room|no matter how you arrange|have all been used\.|^But that's closed
     matchre STOW_AMMO_4 ^That\'s too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^(You|I) can't|^Where are you
     matchre RETRIEVE_CHECK ^You put
     matchre RETRIEVE_CHECK ^Perhaps you
     matchre RETRIEVE_CHECK ^Stow what\?
     matchre RETRIEVE_CHECK ^What were you referring to\?
     matchre RETRIEVE_DONE ^You stop as you realize
     matchre RETRIEVE_DONE ^Please rephrase
     if !matchre("%Container.Ammo.Backup", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then put put my %Ammo in my %Container.Ammo.Backup
     put put my %Ammo in my $UC_Container.Box
     matchwait 9
     echo *** MISSING MATCH IN STOW_AMMO_3! ***
     put #echo >Log Crimson  *** MISSING MATCH IN STOW_AMMO_3! (ubercombat.cmd) ***
STOW_AMMO_4:
     var LOCATION STOW_AMMO_2
     pause 0.0001
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre AMMO_STOW_ERROR ^There\'s no room|any more room|no matter how you arrange|have all been used\.|^But that's closed
     matchre AMMO_STOW_ERROR ^That\'s too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^(You|I) can't|^Where are you
     matchre RETRIEVE_CHECK ^You put
     matchre RETRIEVE_CHECK ^Perhaps you
     matchre RETRIEVE_CHECK ^Stow what\?
     matchre RETRIEVE_CHECK ^What were you referring to\?
     matchre RETRIEVE_DONE ^You stop as you realize
     matchre RETRIEVE_DONE ^Please rephrase
     put put my %Ammo in my $UC_Container.Backup
     matchwait 9
     echo *** MISSING MATCH IN STOW_AMMO_4! ***
     put #echo >Log Crimson  *** MISSING MATCH IN STOW_AMMO_4! (ubercombat.cmd) ***
AMMO_STOW_ERROR:
     put #echo >Log #ff0000 *** AMMO STOWING ERROR! NO ROOM IN BAGS????
     gosub stowing
RETRIEVE_DONE:
     return
STOW_AMMO_HANDS:
     if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
     pause 0.1
     if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty")) then gosub STOWIT right
     goto RETRIEVE_CHECK_1
DROPPED_WEAPON:
     pause 0.1
     echo ####################
     echo *** DROPPED OUR WEAPON??
     echo *** Checking Ground..
     echo ####################
     pause 0.2
     gosub CLEARHANDS
     gosub stowAmmo
     gosub GET my %WEAPON
     pause 0.4
     goto $UC_WeaponType
#### EMPTY HANDS SUB
EMPTY_HANDS:
     delay 0.0001
     gosub SHEATH_CHECK
     if !matchre("$lefthand", "Empty") then gosub STOWIT $lefthandnoun
     if !matchre("$righthand", "Empty") then gosub STOWIT $righthandnoun
     return
#### EMPTY LEFT HAND
EMPTY_LEFT:
     delay 0.0001
     var LOCATION EMPTY_LEFT_1
     gosub SHEATH_CHECK
     EMPTY_LEFT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^You drop
     matchre RETURN ^Having no further use for .*\, you discard it\.
     matchre RETURN ^Your left hand is already empty\.
     matchre RETURN ^What were you referring to\?
     matchre RETURN ^Please rephrase that command\.
     matchre RETURN ^I could not find what you were referring to\.
     send empty left
     matchwait 20
     return
#### EMPTY RIGHT HAND
EMPTY_RIGHT:
     delay 0.0001
     var LOCATION EMPTY_RIGHT_1
     gosub SHEATH_CHECK
     EMPTY_RIGHT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^You drop
     matchre RETURN ^Having no further use for .*\, you discard it\.
     matchre RETURN ^Your right hand is already empty\.
     matchre RETURN ^What were you referring to\?
     matchre RETURN ^Please rephrase that command\.
     matchre RETURN ^I could not find what you were referring to\.
     send empty right
     matchwait 20
     return
#### WEAR SUB
WEAR_UNLOAD:
     gosub unload
     pause 0.2
     goto WEAR_1
WEAR:
     delay 0.0001
     var todo $0
     var LOCATION WEAR_1
     if matchre("%todo", "ball and chain") then var todo ball
     if (matchre("%todo", "(?i)right") && matchre("$righthand", "(?i)%Sheath.Weapons")) then gosub SHEATH_CHECK
     if (matchre("%todo", "(?i)left") && matchre("$lefthand", "(?i)%Sheath.Weapons")) then gosub SHEATH_CHECK
     if matchre("%todo", "(?i)right") then var todo $righthandnoun
     if matchre("%todo","(?i)left") then var todo $lefthandnoun
     WEAR_1:
     pause 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre WEAR_UNLOAD ^You (should|need to) unload
     matchre STOW_1 ^You can't wear any more items like that\.
     matchre STOW_1 ^You can't wear that\!
     matchre STOW_1 ^You need at least one free hand for that\.
     matchre STOW_1 ^This .* can't fit over the .* you are already wearing which also covers and protects your .*\.
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre RETURN ^What were you referring to\?|^Please rephrase
     matchre RETURN ^Wear what\?
     matchre RETURN Roundtime
     matchre RETURN ^The .* (is|are|slides)
     matchre RETURN ^Without (any|a)
     send wear my %todo
     matchwait 20
     echo *** MISSING MATCH IN WEAR! ***
     put #echo >Log Crimson  *** MISSING MATCH IN WEAR! (ubercombat.cmd) ***
     put #echo >Log Crimson  Stow = %todo
     put #log $datetime MISSING MATCH IN WEAR (ubercombat.cmd)
     return
#### DOUBLE PUT SUB
PUT_IT:
     delay 0.0001
     var putit $0
     var LOCATION PUT_IT_1
     PUT_IT_1:
     pause 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre RETURN ^The .* (is|are|slides)
     matchre RETURN ^Without (any|a)
     matchre RETURN ^Please rephrase that command\.
     matchre RETURN ^.* what\?
     matchre RETURN ^What do you want
     matchre RETURN ^I could not find what you were referring to\.
     matchre RETURN ^What were you referring to\?
     send put %putit
     matchwait 20
     echo *** MISSING MATCH IN PUT_IT! ***
     put #echo >Log Crimson  *** MISSING MATCH IN PUT_IT! (ubercombat.cmd) ***
     put #echo >Log Crimson  PutIt = %putit
     put #log $datetime MISSING MATCH IN PUT_IT (ubercombat.cmd)
     return
#### UNTIE SUB
UNTIE_IT:
     delay 0.0001
     var LOCATION UNTIE_IT
     UNTIE_IT_1:
     pause 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^You struggle with .* great weight but can't quite lift it\!
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre HOLD_1 ^But that is already in your inventory\.
     matchre RETURN ^Get what\?|Brushing|^Please rephrase|That can't
     matchre RETURN ^Untie what\?
     matchre RETURN ^You carefully remove .* from the bundle\.
     matchre RETURN ^I could not find what you were referring to\.
     matchre RETURN ^What were you referring to\?
     matchre RETURN ^What do you want
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre RETURN ^As best it can\, .* moves in your direction\.
     matchre RETURN suddenly leaps toward you|and flies towards you|with a flick
     send untie %todo
     matchwait 20
     echo *** MISSING MATCH IN UNTIE! ***
     put #echo >Log Crimson  *** MISSING MATCH IN UNTIE! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %todo
     put #log $datetime MISSING MATCH IN UNTIE (ubercombat.cmd)
     return
#### GET SUB
GET:
     delay 0.0001
     pause 0.0001
     var todo $0
     var LOCATION GET1
     GET1:
     if matchre("%todo", "ball and chain") then var todo ball
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^You struggle with .* great weight but can't quite lift it\!
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre HOLD_1 ^But that is already in your inventory\.
     matchre RETURN_HEAL ^You can't pick that up with your hands that damaged\.|^Both your hands are missing\!
     matchre UNTIE_IT ^You should untie
     matchre GET_ROLL_IT ^You should roll it up
     matchre GET_OTHER ^You decide against it
     matchre GET_DOUBLECHECK ^Get what\?|Brushing
     matchre GET_DOUBLECHECK ^You carefully remove .* from the bundle\.
     matchre GET_DOUBLECHECK ^I could not find what you were referring to\.
     matchre GET_DOUBLECHECK ^What were you referring to\?
     matchre GET_DOUBLECHECK ^What do you want
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are(?! completely rested)|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre RETURN ^As best it can\, .* moves in your direction\.
     matchre RETURN ^The .* (is|are|slides)
     matchre RETURN ^Without (any|a)|Brushing|^Please rephrase|That can't
     matchre RETURN suddenly leaps toward you|and flies towards you|with a flick
     send get %todo
     matchwait 20
     echo *** MISSING MATCH IN GET! ***
     put #echo >Log Crimson  *** MISSING MATCH IN GET! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %todo
     put #log $datetime MISSING MATCH IN GET (ubercombat.cmd)
     return
GET_ROLL_IT:
     pause 0.1
     put roll %todo
     pause 0.4
     pause 0.1
     goto GET1
#### GET SUB
GET_IT:
     delay 0.0001
     var todo $0
     var LOCATION GET_IT_1
     GET_IT_1:
     pause 0.00001
     if matchre("%todo", "ball and chain") then var todo ball
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^You struggle with .* great weight but can't quite lift it\!
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre HOLD_1 ^But that is already in your inventory\.
     matchre UNTIE_IT ^You should untie
     matchre GET_DOUBLECHECK ^Get what\?
     matchre GET_DOUBLECHECK ^I could not find what you were referring to\.
     matchre GET_DOUBLECHECK ^What were you referring to\?
     matchre GET_DOUBLECHECK ^What do you want
     matchre RETURN_HEAL ^You can't pick that up with your hands that damaged\.|^Both your hands are missing\!
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre RETURN ^As best it can\, .* moves in your direction\.
     matchre RETURN ^The .* (is|are|slides)
     matchre RETURN ^Without (any|a)|Brushing|^Please rephrase
     matchre RETURN suddenly leaps toward you|and flies towards you|with a flick
     if (($UC_Bonded = 1) && (%ammolodged = 1)) then
          {
               send invoke
               pause 0.2
               pause 0.2
               if !matchre("$righthand $lefthand", "%todo") then send invoke
               pause 0.1
               if matchre("$righthand $lefthand", "%todo") then var ammolodged 0
          }
     send get %todo
     matchwait 20
     echo *** MISSING MATCH IN GET_IT! ***
     put #echo >Log Crimson  *** MISSING MATCH IN GET_IT! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %todo
     put #log $datetime MISSING MATCH IN GET_IT (ubercombat.cmd)
     return
GET_DOUBLECHECK:
     delay 0.0001
     var LOCATION GET_DOUBLECHECK_1
     GET_DOUBLECHECK_1:
     gosub LOOKPORTAL_TIMER
     if (%portalLast > 200) then
          {
               put look in my portal
               var portalTime $gametime
               pause 0.1
          }
     pause 0.00001
     if (!matchre("%ALLCONTAINERS", "(?i)(eddy|portal)") && !matchre("%todo", "(?i)fragment")) then goto RETURN_CLEAR
     pause 0.1
     pause 0.1
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^You struggle with .* great weight but can't quite lift it\!
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre HOLD_1 ^But that is already in your inventory\.
     matchre UNTIE_IT ^You should untie
     matchre RETURN_HEAL ^You can't pick that up with your hands that damaged\.|^Both your hands are missing\!
     matchre RETURN ^Get what\?|Brushing|^Please rephrase|That can't
     matchre RETURN ^You carefully remove .* from the bundle\.
     matchre RETURN ^I could not find what you were referring to\.
     matchre RETURN ^What were you referring to\?
     matchre RETURN ^What do you want
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre RETURN ^As best it can\, .* moves in your direction\.
     matchre RETURN ^The .* (is|are|slides)
     matchre RETURN ^Without (any|a)|Brushing
     matchre RETURN suddenly leaps toward you|and flies towards you|with a flick
     if (matchre("%todo", "(?i)fragment") && (%HaveFragSack = 1)) then
          {
               send get %todo from my black sack
          }
     # if matchre("%todo", "from my watery portal") then
          # {
               # eval todo replacere("%todo", "from my watery portal", "")
          # }
     send get %todo from my portal
     matchwait 20
     echo *** MISSING MATCH IN GET_DOUBLECHECK! ***
     put #echo >Log Crimson  *** MISSING MATCH IN GET_DOUBLECHECK! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %todo
     put #log $datetime MISSING MATCH IN GET_DOUBLECHECK (ubercombat.cmd)
     return
#### GET SUB
GET_OTHER:
     delay 0.0001
     pause 0.0001
     var LOCATION GET_OTHER
     GET_OTHER_1:
     if matchre("%todo", "ball and chain") then var todo ball
     pause 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^You struggle with .* great weight but can't quite lift it\!
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre HOLD_1 ^But that is already in your inventory\.
     matchre RETURN_HEAL ^You can't pick that up with your hands that damaged\.|^Both your hands are missing\!
     matchre UNTIE_IT ^You should untie
     matchre GET_ROLL_IT ^You should roll it up
     matchre RETURN ^You decide against it
     matchre GET_DOUBLECHECK ^Get what\?|Brushing
     matchre GET_DOUBLECHECK ^You carefully remove .* from the bundle\.
     matchre GET_DOUBLECHECK ^I could not find what you were referring to\.
     matchre GET_DOUBLECHECK ^What were you referring to\?
     matchre GET_DOUBLECHECK ^What do you want
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are(?! completely rested)|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre RETURN ^As best it can\, .* moves in your direction\.
     matchre RETURN ^The .* (is|are|slides)
     matchre RETURN ^Without (any|a)|Brushing|^Please rephrase|That can't
     matchre RETURN suddenly leaps toward you|and flies towards you|with a flick
     send get other %todo
     matchwait 20
     echo *** MISSING MATCH IN GET_OTHER! ***
     put #echo >Log Crimson  *** MISSING MATCH IN GET_OTHER! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %todo
     put #log $datetime MISSING MATCH IN GET_OTHER (ubercombat.cmd)
     return
#### HOLD SUB
HOLD:
     delay 0.0001
     var todo $0
     var LOCATION HOLD_1
     HOLD_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^You struggle with .* great weight but can't quite lift it\!
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre REMOVE_1 ^You are not experienced
     matchre RETURN (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre RETURN ^Without any effort|the .* slide off|tug the .* free|Shaking your head|^Wiggling
     matchre RETURN ^You have nothing of that|^Remove what|^What
     matchre RETURN ^The .* (is|are|slides)
     matchre RETURN ^Without (any|a)
     matchre RETURN ^Get what\?|^Please rephrase|That can't
     matchre RETURN ^Hold hands with whom\?
     matchre RETURN ^What were you referring to\?
     matchre RETURN ^I could not find what you were referring to\.
     matchre RETURN suddenly leaps toward you|and flies towards you|with a flick
     send hold %todo
     matchwait 20
     echo *** MISSING MATCH IN HOLD! ***
     put #echo >Log Crimson  *** MISSING MATCH IN HOLD! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %todo
     put #log $datetime MISSING MATCH IN HOLD (ubercombat.cmd)
     return
RETURN_HEAL:
     var NoHands 1
     echo
     echo ###################################
     echo *** HANDS TOO DAMAGED TO PICK UP %todo!!!
     echo ###################################
     echo
     put #echo >Log ** HANDS TOO DAMAGED TO PICK UP %todo!!!
     pause 0.4
     put stow %todo
     pause 0.1
     pause 0.1
     goto ESCAPE_HEAL
REM_STOW:
gosub stowing
goto REMOVE_1
REM:
REMOVE:
     var LOCATION REMOVE_1
     var todo $0
     REMOVE_1:
     pause 0.0001
     matchre REMOVE_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre REM_STOW ^You need a free hand
     matchre RETURN (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre RETURN ^The .* (is|are|slides)|^Please rephrase|That can't
     matchre RETURN ^Without (any|a)
     matchre RETURN ^Roundtime
     matchre RETURN ^Remove what\?
     matchre RETURN ^What were you referring to\?
     put remove %todo
     matchwait 10
     echo *** MISSING MATCH IN REMOVE! ***
     put #echo >Log Crimson  *** MISSING MATCH IN REMOVE! (ubercombat.cmd) ***
     put #echo >Log Crimson  Remove = %todo
     put #log $datetime MISSING MATCH IN Remove (ubercombat.cmd)
     return
#### SHEATH MODULE FOR SPECIFIC SHEATHS (TOOLSTRAPS/BANDOLIER etc)
SHEATH_IT:
     var SHEATH.WEAPON $1
     var SHEATH.CONTAINER $2
     var LOCATION SHEATH_IT_1
     SHEATH_IT_1:
     pause 0.0001
     if ("%SHEATH.WEAPON" = "") then return
     if ("%SHEATH.WEAPON" = "Empty") then return
     if matchre("%SHEATH.CONTAINER", "(?i)(sigil ring|sigilated ring)") then gosub SIGIL_RING
     if matchre("%SHEATH.WEAPON", "(bow|crossbow|arbalest|sling)") then gosub UNLOAD
     if (!matchre("$righthand", "%SHEATH.WEAPON") && !matchre("$lefthand", "%SHEATH.WEAPON")) then return
     if matchre("$righthand", "%SHEATH.WEAPON") then var SHEATH.WEAPON $righthandnoun
     if matchre("$lefthand", "%SHEATH.WEAPON") then var SHEATH.WEAPON $lefthandnoun
     if matchre("%SHEATH.WEAPON", "ball and chain") then var SHEATH.WEAPON ball
     matchre SHEATH_IT_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SHEATH_PUT ^You can only sheathe a weapon or shield\!
     matchre SHEATH_UNLOAD ^You should unload the
     matchre SHEATH_DROPPED ^You need to be holding
     matchre STOW_REAL ^Sheathe what\?
     matchre STOW_REAL ^You just can't get
     matchre SHEATH_PUT ^You must be wearing
     matchre TIE_IT ^Sheathe your.*where\?
     matchre TIE_IT ^The .* cannot hold any more\.
     matchre TIE_IT ^A .* is too long to fit in .*\.
     matchre TIE_IT ^The .* is too long to fit in .*\.
     matchre TIE_IT ^The .* doesn\'t seem to fit\.
     matchre TIE_IT ^A strange force
     matchre TIE_IT have all been used\.
     matchre TIE_IT ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre RETURN (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre RETURN ^The .* (is|are|slides)
     matchre RETURN ^Sheathing|quickly tie|^Please rephrase
     matchre RETURN ^Without (any|a)
     send sheath %SHEATH.WEAPON in my %SHEATH.CONTAINER
     matchwait 20
     return
SHEATH_PUT:
     var LOCATION SHEATH_PUT
     pause 0.0001
     SHEATH_PUT_1:
     matchre SHEATH_PUT_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SHEATH_RIGHT_SHEATH ^You can only sheathe a weapon or shield\!
     matchre SHEATH_UNLOAD ^You should unload the
     matchre SHEATH_DROPPED ^You need to be holding
     matchre STOW_REAL ^Sheathe what\?
     matchre STOW_REAL ^You just can't get
     matchre TIE_IT ^Sheathe your.*where\?
     matchre TIE_IT ^The .* cannot hold any more\.
     matchre TIE_IT ^A .* is too long to fit in .*\.
     matchre TIE_IT ^The .* is too long to fit in .*\.
     matchre TIE_IT ^The .* doesn\'t seem to fit\.
     matchre TIE_IT ^A strange force
     matchre TIE_IT have all been used\.
     matchre TIE_IT ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre RETURN (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre RETURN ^The .* (is|are|slides)
     matchre RETURN ^Sheathing|quickly tie|^Please rephrase
     matchre RETURN ^Without (any|a)
     send put %SHEATH.WEAPON in my %SHEATH.CONTAINER
     matchwait 20
     return
TIE_IT:
     var LOCATION TIE_IT
     pause 0.0001
     TIE_IT_1:
     if ("%SHEATH.WEAPON" = "") then return
     if ("%SHEATH.WEAPON" = "Empty") then return
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SHEATH_RIGHT_SHEATH ^You can only sheathe a weapon or shield\!
     matchre SHEATH_UNLOAD ^You should unload the
     matchre SHEATH_DROPPED ^You need to be holding
     matchre STOW_REAL ^Sheathe what\?
     matchre STOW_REAL ^You just can't get
     matchre SHEATH_1 ^Sheathe your.*where\?
     matchre SHEATH_1 ^The .* cannot hold any more\.
     matchre SHEATH_1 ^A .* is too long to fit in .*\.
     matchre SHEATH_1 ^The .* is too long to fit in .*\.
     matchre SHEATH_1 ^The .* doesn\'t seem to fit\.
     matchre SHEATH_1 ^A strange force
     matchre SHEATH_1 ^Tie what\?
     matchre SHEATH_1 have all been used\.
     matchre SHEATH_1 ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre RETURN ^The .* (is|are|slides)
     matchre RETURN ^Sheathing|quickly tie|^Please rephrase
     matchre RETURN ^Without (any|a)
     send tie %SHEATH.WEAPON to my %SHEATH.CONTAINER
     matchwait 20
     return
SIGIL_RING:
     var LOCATION SIGIL_RING
     pause 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SIGIL_FAIL The magical energy within your sigilated ring has yet to replenish since the last time it was evoked\.
     matchre SIGIL_RETURN You touch your sigilated ring and feel a surge of elemental power course through you\.
     matchre SIGIL_RETURN ^You touch your sigilated ring and the .+ suddenly liquifies and boils away\, dispersing into a fine mist\.
     matchre SIGIL_RETURN ^You touch your sigilated ring and vaporous mist forms in the air around you\.
     put touch my %SHEATH.CONTAINER
     matchwait 3
     goto SIGIL_RETURN
SIGIL_RETURN:
     var tempSheath %SHEATH.CONTAINER
     pause 0.00001
     if (!matchre("$righthand", "Empty") && !matchre("$righthand $lefthand", "%SHEATH.WEAPON")) then
          {
               eval tempSheath replacere("%SHEATH.CONTAINER", "other ", "")
               put touch my %tempSheath
               wait
               pause 0.3
          }
     if (!matchre("$righthand", "Empty") && !matchre("$righthand $lefthand", "%SHEATH.WEAPON")) then
          {
               put touch my other %tempSheath
               wait
               pause 0.3
          }
     if (!matchre("$righthand", "Empty") && !matchre("$righthand $lefthand", "%SHEATH.WEAPON")) then gosub stowing
     return
SIGIL_FAIL:
     pause 0.1
     echo #################
     echo ** SIGIL ON COOLDOWN?
     echo #################
     put touch my other %SHEATH.CONTAINER
     wait
     pause 0.3
     if (!matchre("$righthand", "Empty") && !matchre("$righthand $lefthand", "%SHEATH.WEAPON")) then gosub stowing
     return
#### SHEATH CHECK
SHEATH_CHECK:
     var LOCATION SHEATH_CHECK
     if contains("$righthandnoun $lefthandnoun", "fan") then gosub PUT close my fan
     # if !contains("$righthand $lefthand", "%Sheath.Weapons") then return
     if contains("$righthand $lefthand", "large sack") then return
     if matchre("$righthand $lefthand", "(heavy steel|polished brass|thick copper|bronze|steel|dark|rippled|desert-tan steel|washed|pink|gloomwood|haralun|bark|coral|golden) katavdar") then gosub KAT_RESET
     if matchre("$righthand $lefthand", "exoskeletal (ritual dagger|sword|mace|rapier|maul|scimitar|longsword|katar|claymore|broadsword|axe|bludgeon|hammer|nightstick|pike|halberd|morning star|battle axe)") then gosub EXO_RESET
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
     if (!matchre("$UC_Sheath1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$righthand", "Empty") && matchre("$righthand","(?i)$UC_Sheath.1.Weapons")) then gosub SHEATH_IT "$righthandnoun" "$UC_Sheath1"
     if (!matchre("$UC_Sheath2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$righthand", "Empty") && matchre("$righthand","(?i)$UC_Sheath.2.Weapons")) then gosub SHEATH_IT "$righthandnoun" "$UC_Sheath2"
     if (!matchre("$UC_Sheath3", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$righthand", "Empty") && matchre("$righthand","(?i)$UC_Sheath.3.Weapons")) then gosub SHEATH_IT "$righthandnoun" "$UC_Sheath3"
     if (!matchre("$UC_Sheath4", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$righthand", "Empty") && matchre("$righthand","(?i)$UC_Sheath.4.Weapons")) then gosub SHEATH_IT "$righthandnoun" "$UC_Sheath4"
     if (!matchre("$UC_Sheath5", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$righthand", "Empty") && matchre("$righthand","(?i)$UC_Sheath.5.Weapons")) then gosub SHEATH_IT "$righthandnoun" "$UC_Sheath5"
     if (!matchre("$UC_Sheath6", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$righthand", "Empty") && matchre("$righthand","(?i)$UC_Sheath.6.Weapons")) then gosub SHEATH_IT "$righthandnoun" "$UC_Sheath6"
     if (!matchre("$UC_Sheath1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$lefthand", "Empty") && matchre("$lefthand","(?i)$UC_Sheath.1.Weapons")) then gosub SHEATH_IT "$lefthandnoun" "$UC_Sheath1"
     if (!matchre("$UC_Sheath2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$lefthand", "Empty") && matchre("$lefthand","(?i)$UC_Sheath.2.Weapons")) then gosub SHEATH_IT "$lefthandnoun" "$UC_Sheath2"
     if (!matchre("$UC_Sheath3", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$lefthand", "Empty") && matchre("$lefthand","(?i)$UC_Sheath.3.Weapons")) then gosub SHEATH_IT "$lefthandnoun" "$UC_Sheath3"
     if (!matchre("$UC_Sheath4", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$lefthand", "Empty") && matchre("$lefthand","(?i)$UC_Sheath.4.Weapons")) then gosub SHEATH_IT "$lefthandnoun" "$UC_Sheath4"
     if (!matchre("$UC_Sheath5", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$lefthand", "Empty") && matchre("$lefthand","(?i)$UC_Sheath.5.Weapons")) then gosub SHEATH_IT "$lefthandnoun" "$UC_Sheath5"
     if (!matchre("$UC_Sheath6", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$lefthand", "Empty") && matchre("$lefthand","(?i)$UC_Sheath.6.Weapons")) then gosub SHEATH_IT "$lefthandnoun" "$UC_Sheath6"
     return
SHEATH_CHECK_RIGHT:
     var LOCATION SHEATH_CHECK_RIGHT
     if contains("$righthandnoun $lefthandnoun", "fan") then gosub PUT close my fan
     # if (!matchre("$righthand $lefthand", "%Sheath.Weapons") then return
     if contains("$righthand $lefthand", "large sack") then return
     if (!matchre("$UC_Sheath1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$righthand", "Empty") && matchre("$righthand","(?i)$UC_Sheath.1.Weapons")) then gosub SHEATH_IT "$righthandnoun" "$UC_Sheath1"
     if (!matchre("$UC_Sheath2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$righthand", "Empty") && matchre("$righthand","(?i)$UC_Sheath.2.Weapons")) then gosub SHEATH_IT "$righthandnoun" "$UC_Sheath2"
     if (!matchre("$UC_Sheath3", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$righthand", "Empty") && matchre("$righthand","(?i)$UC_Sheath.3.Weapons")) then gosub SHEATH_IT "$righthandnoun" "$UC_Sheath3"
     if (!matchre("$UC_Sheath4", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$righthand", "Empty") && matchre("$righthand","(?i)$UC_Sheath.4.Weapons")) then gosub SHEATH_IT "$righthandnoun" "$UC_Sheath4"
     if (!matchre("$UC_Sheath5", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$righthand", "Empty") && matchre("$righthand","(?i)$UC_Sheath.5.Weapons")) then gosub SHEATH_IT "$righthandnoun" "$UC_Sheath5"
     if (!matchre("$UC_Sheath6", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$righthand", "Empty") && matchre("$righthand","(?i)$UC_Sheath.6.Weapons")) then gosub SHEATH_IT "$righthandnoun" "$UC_Sheath6"
     return
SHEATH_CHECK_LEFT:
     var LOCATION SHEATH_CHECK_LEFT
     if contains("$righthandnoun $lefthandnoun", "fan") then gosub PUT close my fan
     # if (!matchre("$righthand $lefthand", "%Sheath.Weapons") then return
     if contains("$righthand $lefthand", "large sack") then return
     if (!matchre("$UC_Sheath1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$lefthand", "Empty") && matchre("$lefthand","(?i)$UC_Sheath.1.Weapons")) then gosub SHEATH_IT "$lefthandnoun" "$UC_Sheath1"
     if (!matchre("$UC_Sheath2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$lefthand", "Empty") && matchre("$lefthand","(?i)$UC_Sheath.2.Weapons")) then gosub SHEATH_IT "$lefthandnoun" "$UC_Sheath2"
     if (!matchre("$UC_Sheath3", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$lefthand", "Empty") && matchre("$lefthand","(?i)$UC_Sheath.3.Weapons")) then gosub SHEATH_IT "$lefthandnoun" "$UC_Sheath3"
     if (!matchre("$UC_Sheath4", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$lefthand", "Empty") && matchre("$lefthand","(?i)$UC_Sheath.4.Weapons")) then gosub SHEATH_IT "$lefthandnoun" "$UC_Sheath4"
     if (!matchre("$UC_Sheath5", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$lefthand", "Empty") && matchre("$lefthand","(?i)$UC_Sheath.5.Weapons")) then gosub SHEATH_IT "$lefthandnoun" "$UC_Sheath5"
     if (!matchre("$UC_Sheath6", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$lefthand", "Empty") && matchre("$lefthand","(?i)$UC_Sheath.6.Weapons")) then gosub SHEATH_IT "$lefthandnoun" "$UC_Sheath6"
     return
SHEATH_DROPPED:
     gosub stowAmmo
     gosub GET %SHEATH.WEAPON
     goto SHEATH_IT_1
#### WEAPON SHEATH
CLOSE_IT:
     pause 0.1
     put close my $righthand
     pause 0.2
SHEATH:
SHEATH_RIGHT:
     var LOCATION SHEATH_1
     pause 0.0001
     # gosub SHEATH_CHECK
     if matchre("$righthand", "(heavy steel|polished brass|thick copper|bronze|steel|dark|rippled|desert-tan steel|washed|pink|gloomwood|haralun|bark|coral|golden) katavdar") then gosub KAT_RESET
     if matchre("$righthand", "exoskeletal (ritual dagger|sword|mace|rapier|maul|scimitar|longsword|katar|claymore|broadsword|axe|bludgeon|hammer|nightstick|pike|halberd|morning star|battle axe)") then gosub EXO_RESET
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then return
     if (matchre("$righthand", "%TMFoci") && (%Foci.Active = 1)) then return
     if ("$righthand" = "Empty") then return
     if (("$righthandnoun" = "fan") && ("$lefthandnoun" = "fan")) then send close my fan
     if (("$righthand" = "Empty") && !matchre("$lefthand", "Empty")) then goto SHEATH_LEFT
     if (("$UC_WeaponType" = "BRAWL") && !matchre("$righthand", "Empty")) then goto SHEATH_1
     if (("$UC_WeaponType" = "BRAWL") && !matchre("$lefthand", "Empty")) then goto SHEATH_LEFT
     pause 0.00001
     SHEATH_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre CLOSE_IT ^You'll need to close the
     matchre SHEATH_RIGHT_SHEATH ^You can only sheathe a weapon or shield\!
     matchre SHEATH_UNLOAD ^You should unload the
     matchre SHEATH_UNLOAD ^You need to unload
     matchre SHEATH_RIGHT_SHEATH ^Sheathe what\?
     matchre SHEATH_RIGHT_SHEATH As you attempt to place your
     matchre SHEATH_RIGHT_SHEATH ^What were
     matchre SHEATH_RIGHT_SHEATH ^You just can't get
     matchre SHEATH_RIGHT_SHEATH ^Sheathe your.*where\?
     matchre SHEATH_RIGHT_SHEATH ^A .* is too long to fit in .*\.
     matchre SHEATH_RIGHT_SHEATH ^The .* is too long to fit in .*\.
     matchre SHEATH_RIGHT_SHEATH ^The .* doesn\'t seem to fit\.
     matchre SHEATH_RIGHT_SHEATH ^A strange force
     matchre SHEATH_RIGHT_SHEATH have all been used\.
     matchre SHEATH_RIGHT_SHEATH ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were|^Perhaps you should
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     send sheath right
     matchwait 20
SHEATH_RIGHT_SHEATH:
     var LOCATION SHEATH_RIGHT_SHEATH_1
     pause 0.0001
     SHEATH_RIGHT_SHEATH_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SHEATH_UNLOAD ^You should unload the
     matchre SHEATH_UNLOAD ^You need to unload
     matchre SHEATH_RIGHT_SHEATH_2 ^You can only sheathe a weapon or shield\!
     matchre SHEATH_RIGHT_SHEATH_2 ^Sheathe what\?
     matchre SHEATH_RIGHT_SHEATH_2 As you attempt to place your
     matchre SHEATH_RIGHT_SHEATH_2 ^Sheathe your.*where\?
     matchre SHEATH_RIGHT_SHEATH_2 ^What were
     matchre SHEATH_RIGHT_SHEATH_2 ^A .* is too long to fit in .*\.
     matchre SHEATH_RIGHT_SHEATH_2 ^The .* is too long to fit in .*\.
     matchre SHEATH_RIGHT_SHEATH_2 ^You just can't get
     matchre SHEATH_RIGHT_SHEATH_2 ^Sheathe your.*where\?
     matchre SHEATH_RIGHT_SHEATH_2 ^The .* doesn\'t seem to fit\.
     matchre SHEATH_RIGHT_SHEATH_2 ^A strange force
     matchre SHEATH_RIGHT_SHEATH_2 have all been used\.
     matchre SHEATH_RIGHT_SHEATH_2 ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were|^Perhaps you should
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     if !matchre("$righthand", "ball and chain") then send sheath $righthandnoun in my $UC_Container.Sheath
     else send sheath ball in my $UC_Container.Sheath
     matchwait 20
SHEATH_RIGHT_SHEATH_2:
     var LOCATION SHEATH_RIGHT_SHEATH_22
     pause 0.0001
     SHEATH_RIGHT_SHEATH_22:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SHEATH_UNLOAD ^You should unload the
     matchre SHEATH_UNLOAD ^You need to unload
     matchre SHEATH_RIGHT_SHEATH_3 ^You can only sheathe a weapon or shield\!
     matchre SHEATH_RIGHT_SHEATH_3 ^Sheathe what\?
     matchre SHEATH_RIGHT_SHEATH_3 As you attempt to place your
     matchre SHEATH_RIGHT_SHEATH_3 ^A .* is too long to fit in .*\.
     matchre SHEATH_RIGHT_SHEATH_3 ^The .* is too long to fit in .*\.
     matchre SHEATH_RIGHT_SHEATH_3 ^You just can't get
     matchre SHEATH_RIGHT_SHEATH_3 ^The .* doesn\'t seem to fit\.
     matchre SHEATH_RIGHT_SHEATH_3 ^A strange force
     matchre SHEATH_RIGHT_SHEATH_3 have all been used\.
     matchre SHEATH_RIGHT_SHEATH_3 ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre WEAR_WEAPON ^Sheathe your.*where\?
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were|^Perhaps you should
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     if !matchre("$righthand", "ball and chain") then send put $righthandnoun in my $UC_Container.Box
     else send put ball in my $UC_Container.Box
     matchwait 20
SHEATH_RIGHT_SHEATH_3:
     var LOCATION SHEATH_RIGHT_SHEATH_33
     pause 0.0001
     SHEATH_RIGHT_SHEATH_33:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SHEATH_UNLOAD ^You should unload the
     matchre SHEATH_UNLOAD ^You need to unload
     matchre WEAR_WEAPON ^You can only sheathe a weapon or shield\!
     matchre WEAR_WEAPON ^A .* is too long to fit in .*\.
     matchre WEAR_WEAPON ^The .* is too long to fit in .*\.
     matchre WEAR_WEAPON ^You just can't get
     matchre WEAR_WEAPON ^The .* doesn\'t seem to fit\.
     matchre WEAR_WEAPON ^A strange force
     matchre WEAR_WEAPON have all been used\.
     matchre WEAR_WEAPON ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre WEAR_WEAPON ^Sheathe your.*where\?
     matchre WEAR_WEAPON As you attempt to place your
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     if !matchre("$righthand", "ball and chain") then send put $righthandnoun in my $UC_Container.Backup
     else send put ball in my $UC_Container.Backup
     matchwait 20
WEAR_WEAPON:
     var LOCATION WEAR_WEAPON_1
     pause 0.0001
     WEAR_WEAPON_1:
     if (($UC_SummonWeapons = 1) && contains("$righthand", "%WM.Weapon")) then
          {
               echo *** No Room for Summoned Weapon - Dropping
               var SummonedWeapon 0
               var SummonDropTime $gametime
               gosub EMPTY_RIGHT
               pause 3
          }
     if (($UC_SummonWeapons = 1) && !contains("$righthand $lefthand", "%WM.Weapon")) then return
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STOW_WEAPON_RIGHT ^What were
     matchre STOW_WEAPON_RIGHT ^Wear what\?
     matchre STOW_WEAPON_RIGHT ^You can't
     matchre STOW_WEAPON_RIGHT ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre STOW_WEAPON_RIGHT ^A .* is too long to fit in .*\.
     matchre STOW_WEAPON_RIGHT ^The .* is too long to fit in .*\.
     matchre STOW_WEAPON_RIGHT ^You just can't get
     matchre STOW_WEAPON_RIGHT ^A strange force
     matchre STOW_WEAPON_RIGHT have all been used\.
     matchre STOW_WEAPON_RIGHT As you attempt to place your
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were|^Perhaps you should
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     send wear my $righthandnoun
     matchwait 20
STOW_WEAPON_RIGHT:
     var LOCATION STOW_WEAPON_RIGHT
     pause 0.0001
     STOW_WEAPON_RIGHT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre OUT_OF_SPACE ^You just can't get
     matchre OUT_OF_SPACE ^The .* is too long to fit in .*\.
     matchre OUT_OF_SPACE ^A .* is too long to fit in .*\.
     matchre OUT_OF_SPACE ^Sheathe your.*where\?
     matchre OUT_OF_SPACE ^The .* doesn\'t seem to fit\.
     matchre OUT_OF_SPACE ^A strange force
     matchre OUT_OF_SPACE have all been used\.
     matchre OUT_OF_SPACE As you attempt to place your
     matchre OUT_OF_SPACE ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre RETURN ^Stow what\?  Type 'STOW HELP' for details\.
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were|^Perhaps you should
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     send stow right
     matchwait 20
     goto OUT_OF_SPACE
SHEATH_UNLOAD:
     pause 0.1
     pause 0.1
     gosub UNLOAD
     pause 0.2
     goto %LOCATION
SHEATH_SKINNER:
     var LOCATION SHEATH_SKINNER_1
     pause 0.0001
     SHEATH_SKINNER_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre SHEATH_UNLOAD ^You should unload the
     matchre SHEATH_RIGHT_SHEATH ^You just can't get
     matchre SHEATH_RIGHT_SHEATH ^Sheathe your.*where\?
     matchre SHEATH_RIGHT_SHEATH ^A .* is too long to fit in .*\.
     matchre SHEATH_RIGHT_SHEATH ^The .* is too long to fit in .*\.
     matchre SHEATH_RIGHT_SHEATH have all been used\.
     matchre SHEATH_RIGHT_SHEATH ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!|As you attempt to place your
     matchre RETURN ^Sheathe what\?|^Stow what\?
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were|^Perhaps you should
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     send stow $UC_Skinner
     matchwait 20
     return
#### WEAPON SHEATH LEFT
SHEATH_LEFT:
     var LOCATION SHEATH_LEFT_1
     pause 0.0001
     if ($standing = 0) then gosub STAND
     gosub SHEATH_CHECK_LEFT
     # if matchre("$righthandnoun $lefthandnoun", "fan") then gosub PUT close my fan
     if ("$lefthand" = "Empty") then return
     if matchre("$lefthand", "(heavy steel|polished brass|thick copper|bronze|steel|dark|rippled|desert-tan steel|washed|pink|gloomwood|haralun|bark|coral|golden) katavdar") then gosub KAT_RESET
     if matchre("$lefthand", "exoskeletal (ritual dagger|sword|mace|rapier|maul|scimitar|longsword|katar|claymore|broadsword|axe|bludgeon|hammer|nightstick|pike|halberd|morning star|battle axe)") then gosub EXO_RESET
     SHEATH_LEFT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STOWING ^You can only sheathe a weapon or shield\!
     matchre SHEATH_UNLOAD ^You should unload the
     matchre SHEATH_UNLOAD ^You need to unload
     matchre WEAR_WEAPON_LEFT ^Sheathe what\?
     matchre WEAR_WEAPON_LEFT ^A .* is too long to fit in .*\.
     matchre WEAR_WEAPON_LEFT ^The .* is too long to fit in .*\.
     matchre SHEATH_LEFT_SHEATH ^You just can't get
     matchre SHEATH_LEFT_SHEATH ^Sheathe your.*where\?
     matchre SHEATH_LEFT_SHEATH ^The .* doesn\'t seem to fit\.
     matchre SHEATH_LEFT_SHEATH have all been used\.
     matchre SHEATH_LEFT_SHEATH ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!|As you attempt to place your
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were|^Perhaps you should
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     send sheath left
     matchwait 20
     return
SHEATH_LEFT_SHEATH:
     var LOCATION SHEATH_LEFT_SHEATH_1
     pause 0.0001
     SHEATH_LEFT_SHEATH_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STOWING ^You can only sheathe a weapon or shield\!
     matchre SHEATH_UNLOAD ^You should unload the
     matchre SHEATH_UNLOAD ^You need to unload
     matchre WEAR_WEAPON_LEFT ^Sheathe what\?
     matchre SHEATH_LEFT_SHEATH_2 ^A .* is too long to fit in .*\.
     matchre SHEATH_LEFT_SHEATH_2 ^The .* is too long to fit in .*\.
     matchre SHEATH_LEFT_SHEATH_2 ^You just can't get
     matchre SHEATH_LEFT_SHEATH_2 ^Sheathe your.*where\?
     matchre SHEATH_LEFT_SHEATH_2 ^The .* doesn\'t seem to fit\.
     matchre SHEATH_LEFT_SHEATH_2 have all been used\.
     matchre SHEATH_LEFT_SHEATH_2 ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were|^Perhaps you should
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     if !matchre("$lefthand", "ball and chain") then send put $lefthandnoun in my $UC_Container.Sheath
     else send put ball in my $UC_Container.Sheath
     matchwait 20
     return
SHEATH_LEFT_SHEATH_2:
     var LOCATION SHEATH_LEFT_SHEATH_22
     pause 0.0001
     SHEATH_LEFT_SHEATH_22:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STOWING ^You can only sheathe a weapon or shield\!
     matchre SHEATH_UNLOAD ^You should unload the
     matchre SHEATH_UNLOAD ^You need to unload
     matchre SHEATH_LEFT_SHEATH_3 ^Sheathe what\?
     matchre SHEATH_LEFT_SHEATH_3 ^A .* is too long to fit in .*\.
     matchre SHEATH_LEFT_SHEATH_3 ^The .* is too long to fit in .*\.
     matchre SHEATH_LEFT_SHEATH_3 ^You just can't get
     matchre SHEATH_LEFT_SHEATH_3 ^The .* doesn\'t seem to fit\.
     matchre SHEATH_LEFT_SHEATH_3 have all been used\.
     matchre SHEATH_LEFT_SHEATH_3 ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre WEAR_WEAPON_LEFT ^Sheathe your.*where\?
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were|^Perhaps you should
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     if !matchre("$lefthand", "ball and chain") then send put $lefthandnoun in my $UC_Container.Box
     else send put ball in my $UC_Container.Box
     matchwait 20
     return
SHEATH_LEFT_SHEATH_3:
     var LOCATION SHEATH_LEFT_SHEATH_33
     pause 0.0001
     SHEATH_LEFT_SHEATH_33:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STOWING ^You can only sheathe a weapon or shield\!
     matchre SHEATH_UNLOAD ^You should unload the
     matchre SHEATH_UNLOAD ^You need to unload
     matchre STOW_WEAPON_LEFT ^Sheathe what\?
     matchre STOW_WEAPON_LEFT ^A .* is too long to fit in .*\.
     matchre STOW_WEAPON_LEFT ^The .* is too long to fit in .*\.
     matchre STOW_WEAPON_LEFT ^You just can't get
     matchre STOW_WEAPON_LEFT ^The .* doesn\'t seem to fit\.
     matchre STOW_WEAPON_LEFT have all been used\.
     matchre STOW_WEAPON_LEFT ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre WEAR_WEAPON_LEFT ^Sheathe your.*where\?
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were|^Perhaps you should
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     if !matchre("$lefthand", "ball and chain") then send put $lefthandnoun in my $UC_Container.Backup
     else send put ball in my $UC_Container.Backup
     matchwait 20
     return
WEAR_WEAPON_LEFT:
     var LOCATION WEAR_WEAPON_LEFT_1
     pause 0.0001
     WEAR_WEAPON_LEFT_1:
     if (($UC_SummonWeapons = 1) && contains("$lefthand", "%WM.Weapon")) then gosub EMPTY_LEFT
     if (($UC_SummonWeapons = 1) && !contains("$righthand $lefthand", "%WM.Weapon")) then return
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^You attach .* to your belt\.
     matchre STOW_WEAPON_LEFT ^Wear what\?
     matchre STOW_WEAPON_LEFT ^You can't
     matchre STOW_WEAPON_LEFT have all been used\.
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were|^Perhaps you should
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     send wear my $lefthandnoun
     matchwait 20
     goto STOW_WEAPON_LEFT
STOW_WEAPON_LEFT:
     var LOCATION STOW_WEAPON_LEFT_1
     pause 0.0001
     STOW_WEAPON_LEFT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^Stow what\?  Type 'STOW HELP' for details\.
     matchre OUT_OF_SPACE ^You just can't get
     matchre OUT_OF_SPACE ^The .* is too long to fit in .*\.
     matchre OUT_OF_SPACE ^A .* is too long to fit in .*\.
     matchre OUT_OF_SPACE ^Sheathe your.*where\?
     matchre OUT_OF_SPACE have all been used\.
     matchre OUT_OF_SPACE ^There\'s no (room|more)|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^You can\'t put that there\!
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing a|^What were|^Perhaps you should
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     send stow left
     matchwait 20
     return
##### STANDING SUB
STAND:
     delay 0.0001
     var LOCATION STAND_1
     STAND_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre WAIT ^The weight of all your possessions prevents you from standing\.
     matchre WAIT ^You are overburdened and cannot manage to stand\.
     matchre WAIT ^You\'re unconscious\!
     matchre EXIT_DEATH ^You are a ghost\!
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STAND_RETURN ^You stand (?:back )?up\.
     matchre STAND_RETURN ^You stand up in the water
     matchre STAND_RETURN ^You are already standing\.
     matchre STAND_RETURN ^As you stand
     send stand
     matchwait 20
     STAND_RETURN:
     pause 0.1
     pause 0.1
     if ($standing = 0) then goto STAND
     return
UNLOAD_STOP:
     send stop play
     pause
#### UNLOAD RANGED SUB
UNLOAD:
     delay 0.0001
     var LOCATION UNLOAD_1
     if ($standing = 0) then gosub STAND
     UNLOAD_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre LOCATION1 ^You are a bit too busy performing
     matchre RETURN ^But your .* isn't loaded\!
     matchre RETURN ^Your .* falls
     matchre RETURN ^You must be holding the weapon to do that\.
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     if (!matchre("$lefthand", "Empty") && matchre("$lefthand", "(bow|crossbow|arbalest|sling)")) then send unload my $lefthandnoun
     if !matchre("$righthand", "Empty") then send unload my $righthandnoun
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN UNLOAD! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %item
     put #log $datetime MISSING MATCH IN UNLOAD (ubercombat.cmd)
     return
#### SECONDARY GET FAILSAFE
GET_IT1:
     delay 0.0001
     var LOCATION GET_IT2
     GET_IT2:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^You struggle with .* great weight but can't quite lift it\!
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre HOLD_1 ^But that is already in your inventory\.
     matchre ESCAPE_HEAL ^You can't pick that up with your hands that damaged\.
     matchre RETURN ^Get what\?
     matchre RETURN ^You carefully remove .* from the bundle\.
     matchre RETURN ^I could not find what you were referring to\.
     matchre RETURN ^What were you referring to\?
     matchre RETURN ^As best it can\, .* moves in your direction\.
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     send get %item
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN GET_IT1! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %item
     put #log $datetime MISSING MATCH IN GET_IT1 (ubercombat.cmd)
     return
##################################################################################
#### WIELD SPECIFIC WEAPONS FROM SPECIAL SHEATHS (TOOLSTRAP/BANDOLIER/HARNESS/ETC)
WIELD_CHECK:
     var LOCATION WIELD_CHECK
     action (buffs) off
     if matchre("$lefthand", "%item") then
          {
               gosub SWAP
               pause 0.2
          }
     if (!matchre("$UC_Sheath1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%item","(?i)$UC_Sheath.1.Weapons") && !matchre("$righthand", "%item")) then gosub WIELD_IT "%item" "$UC_Sheath1"
     if (!matchre("$UC_Sheath2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%item","(?i)$UC_Sheath.2.Weapons") && !matchre("$righthand", "%item")) then gosub WIELD_IT "%item" "$UC_Sheath2"
     if (!matchre("$UC_Sheath3", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%item","(?i)$UC_Sheath.3.Weapons") && !matchre("$righthand", "%item")) then gosub WIELD_IT "%item" "$UC_Sheath3"
     if (!matchre("$UC_Sheath4", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%item","(?i)$UC_Sheath.4.Weapons") && !matchre("$righthand", "%item")) then gosub WIELD_IT "%item" "$UC_Sheath4"
     if (!matchre("$UC_Sheath5", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%item","(?i)$UC_Sheath.5.Weapons") && !matchre("$righthand", "%item")) then gosub WIELD_IT "%item" "$UC_Sheath5"
     if (!matchre("$UC_Sheath6", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%item","(?i)$UC_Sheath.6.Weapons") && !matchre("$righthand", "%item")) then gosub WIELD_IT "%item" "$UC_Sheath6"
     pause 0.00001
     action (buffs) on
     return
WIELD_LEFT_CHECK:
     var LOCATION WIELD_LEFT_CHECK
     if matchre("$righthand", "%item") then
          {
               gosub SWAP
               pause 0.2
          }
     if (!matchre("$UC_Sheath1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%item","(?i)$UC_Sheath.1.Weapons") && !matchre("$lefthand", "%item")) then gosub WIELD_IT_LEFT "%item" "$UC_Sheath1"
     if (!matchre("$UC_Sheath2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%item","(?i)$UC_Sheath.2.Weapons") && !matchre("$lefthand", "%item")) then gosub WIELD_IT_LEFT "%item" "$UC_Sheath2"
     if (!matchre("$UC_Sheath3", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%item","(?i)$UC_Sheath.3.Weapons") && !matchre("$lefthand", "%item")) then gosub WIELD_IT_LEFT "%item" "$UC_Sheath3"
     if (!matchre("$UC_Sheath4", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%item","(?i)$UC_Sheath.4.Weapons") && !matchre("$lefthand", "%item")) then gosub WIELD_IT_LEFT "%item" "$UC_Sheath4"
     if (!matchre("$UC_Sheath5", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%item","(?i)$UC_Sheath.5.Weapons") && !matchre("$lefthand", "%item")) then gosub WIELD_IT_LEFT "%item" "$UC_Sheath5"
     if (!matchre("$UC_Sheath6", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && matchre("%item","(?i)$UC_Sheath.6.Weapons") && !matchre("$lefthand", "%item")) then gosub WIELD_IT_LEFT "%item" "$UC_Sheath6"
     pause 0.00001
     action (buffs) on
     return
WIELD_IT_LEFT:
     delay 0.0001
     var item $1
     var SHEATH.WEAPON $1
     var SHEATH.CONTAINER $2
     eval item replacere("%item", "my ", "")
     if ($standing = 0) then gosub STAND
     if ("%item" = "NULL") then return
     if matchre("%SHEATH.WEAPON", "ball and chain") then var SHEATH.WEAPON ball
     var LOCATION WIELD_IT_LEFT_1
     WIELD_IT_LEFT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre GET_IT1 ^You find it difficult to wield
     matchre ESCAPE_HEAL ^You can't pick that up with your hands that damaged\.
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre RETURN ^You're already holding .*\!
     matchre WIELD_IT_LEFT_2 ^You're wearing a.*\!  You'll need to remove it first\!
     matchre WIELD_IT_LEFT_2 ^What were you referring to\?
     matchre WIELD_IT_LEFT_2 ^\s*Wield what\?
     matchre WIELD_IT_LEFT_2 ^I could not find
     send wield left my %SHEATH.WEAPON
     matchwait 20
     return
     return
WIELD_IT_LEFT_2:
     delay 0.0001
     if ($standing = 0) then gosub STAND
     if ("%item" = "NULL") then return
     var LOCATION WIELD_IT_LEFT_22
     WIELD_IT_LEFT_22:
     put look in my portal
     pause 0.2
     pause 0.1
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre GET_IT1 ^You find it difficult to wield
     matchre ESCAPE_HEAL ^You can't pick that up with your hands that damaged\.
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre RETURN ^You're already holding .*\!
     matchre REMOVE_WEAPON ^You're wearing a.*\!  You'll need to remove it first\!
     matchre REMOVE_WEAPON ^What were you referring to\?
     matchre REMOVE_WEAPON ^\s*Wield what\?
     matchre REMOVE_WEAPON ^I could not find
     send get my %SHEATH.WEAPON from my watery portal
     matchwait 20
     return
WIELD_IT:
     delay 0.0001
     var item $1
     var SHEATH.WEAPON $1
     var SHEATH.CONTAINER $2
     eval item replacere("%item", "my ", "")
     eval SHEATH.WEAPON replacere("%SHEATH.WEAPON", "my ", "")
     if matchre("%SHEATH.CONTAINER", "(?i)(sigil ring|sigilated ring)") then gosub SIGIL_WIELD
     if ("%item" = "NULL") then return
     if ($standing = 0) then gosub STAND
     if matchre("%SHEATH.WEAPON", "ball and chain") then var SHEATH.WEAPON ball
     if matchre("%WEAPON_EXP", "(Light_Thrown|Heavy_Thrown|LT|HT)") then
          {
               if (($UC_Bonded = 1) && (%ammolodged = 1)) then
                    {
                         pause 0.3
                         pause 0.2
                         send invoke
                         pause 0.3
                         pause 0.2
                         if matchre("$righthand", "Empty") then send invoke
                         pause 0.2
                         pause 0.1
                         if matchre("$righthand $lefthand", "%item") then var ammolodged 0
                         if !matchre("$righthand", "(%item|Empty)") then gosub STOWIT right
                         if !matchre("$lefthand", "(%item|Empty)") then gosub STOWIT left
                    }
               pause 0.3
               if matchre("$roomobjs", "\b(?<!pike |pitted bronze |[Rr]usted |rusty |spindly short |dull iron |battered |beaten )(%MYWEAPONS)(?!(\-toothed| bolt| arrow| shard| stuck in the ground))\b") then gosub GET $1
               pause 0.1
          }
     var LOCATION WIELD_IT_1
     WIELD_IT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre GET_IT1 ^You find it difficult to wield
     matchre REMOVE_WEAPON ^You're wearing
     matchre ESCAPE_HEAL ^You can't pick that up with your hands that damaged\.
     matchre WIELD_1 ^What were you referring to\?
     matchre WIELD_1 ^\s*Wield what\?
     matchre WIELD_1 ^I could not find
     matchre WIELD_RETURN ^You're already holding .*\!
     matchre WIELD_RETURN ^With fluid|With a flick|With a flick
     matchre WIELD_RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre WIELD_RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     send wield my %SHEATH.WEAPON
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN WIELD_IT! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %item
     put #log $datetime MISSING MATCH IN WIELD_IT (ubercombat.cmd)
     return
SIGIL_WIELD:
     pause 0.1
     put touch my %SHEATH.CONTAINER
     wait
     pause 0.5
     pause 0.1
     if !matchre("$righthand $lefthand", "(?i)%SHEATH.WEAPON") then
          {
               put touch my other %SHEATH.CONTAINER
               wait
               pause 0.5
          }
     return
##################################################################################
#### WEAPON WIELDING LOGIC
WIELD_STOW:
     gosub STOW_REAL
     pause 0.00001
     goto WIELD_1
WIELD_PAUSE:
     pause 4
     goto WIELD_1
WIELD:
     delay 0.0001
     var stowloop 0
     var item $0
     eval item replacere("%item", "my my", "my")
     eval item replacere("%item", "my", "")
     delay 0.00001
     if ($standing = 0) then gosub STAND
     if ("$UC_WeaponType" = "BRAWL") then return
     if ("%item" = "NULL") then return
     if matchre("%item", "ball and chain") then var SHEATH.WEAPON ball
     if matchre("$lefthand", "item") then gosub SWAP
     if (!matchre("$righthand", "item") && !matchre("$righthand", "Empty")) then gosub STOWIT right
     if matchre("$righthand $lefthand", "(?i)%item") then return
     if (matchre("%item", "(?i)damaris") && (%HaveDamaris = 1)) then var item %DamarisType
     if matchre("%item", "(?i)damaris") then
          {
               eval item replacere("%item", "(?i)(damaris throwing mallet|damaris mallet)", "throwing mallet")
               eval item replacere("%item", "(?i)(damaris battle bow|damaris bow)", "battle bow")
          }
WIELD1:
     gosub WIELD_CHECK
     delay 0.00001
     if matchre("%WEAPON_EXP", "(Light_Thrown|Heavy_Thrown|LT|HT)") then
          {
               if ($UC_Bonded = 1) then
                    {
                         pause 0.3
                         pause 0.2
                         send invoke
                         pause 0.3
                         pause 0.2
                         if matchre("$righthand", "Empty") then send invoke
                         pause 0.2
                         pause 0.1
                         if matchre("$righthand $lefthand", "%item") then var ammolodged 0
                         if !matchre("$righthand", "(%item|Empty)") then gosub STOWIT right
                         if !matchre("$lefthand", "(%item|Empty)") then gosub STOWIT left
                    }
               pause 0.3
               if matchre("$roomobjs", "\b(?<!pike |pitted bronze |[Rr]usted |rusty |spindly short |dull iron |battered |beaten )(%MYWEAPONS)(?!(\-toothed| bolt| arrow| shard| stuck in the ground))\b") then gosub GET $1
               pause 0.1
          }
     if (matchre("$righthand", "%item") || matchre("$lefthand", "%item")) then return
     var LOCATION WIELD_1
     WIELD_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WIELD_PAUSE ^You are too exhausted to be able to pick that up\!
     matchre WIELD_STOW ^You need to have a free hand
     matchre GET_IT1 ^You find it difficult to wield
     matchre ESCAPE_HEAL_CHECK ^You can't pick that up with your hands that damaged\.|^Your right hand is too injured to
     matchre REMOVE_WEAPON ^You're wearing
     matchre WIELD_GET ^You can only wield
     matchre WIELD_GET ^What were you referring to\?
     matchre WIELD_GET ^\s*Wield what\?
     matchre WIELD_GET ^\s*Remove what\?
     matchre WIELD_GET ^\s*But that is
     matchre WIELD_RETURN ^You're already holding
     matchre WIELD_RETURN ^With fluid|With a flick|With a flick
     matchre WIELD_RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre WIELD_RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     send wield my %item
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN WIELD! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %item
     put #log $datetime MISSING MATCH IN WIELD (ubercombat.cmd)
     return
WIELD_GET:
     delay 0.0001
     if matchre("$righthand", "%item") || matchre("$lefthand", "%item") then return
     var LOCATION WIELD_GET_1
     WIELD_GET_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre ESCAPE_HEAL_CHECK ^You can't pick that up with your hands that damaged\.|^Your right hand is too injured to
     matchre WIELD_DOUBLECHECK ^You find it difficult to wield
     matchre WIELD_DOUBLECHECK ^You can only wield
     matchre WIELD_DOUBLECHECK ^You're wearing a.*\!  You'll need to remove it first\!
     matchre WIELD_DOUBLECHECK ^What were you referring to\?
     matchre WIELD_DOUBLECHECK ^\s*Wield what\?
     matchre WIELD_DOUBLECHECK ^\s*Get what\?
     matchre WIELD_DOUBLECHECK ^\s*But that is
     matchre WIELD_DOUBLECHECK ^\s*Please rephrase
     matchre WIELD_RETURN ^You need a free hand
     matchre WIELD_RETURN ^You're already holding
     matchre WIELD_RETURN ^With fluid|With a flick|With a flick
     matchre WIELD_RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre WIELD_RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre WIELD_RETURN ^With fluid|With a flick
     send get %item
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN WIELD_GET! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %item
     put #log $datetime MISSING MATCH IN WIELD_GET (ubercombat.cmd)
     return
WIELD_LEFT:
     delay 0.0001
     var item $0
     var stowloop 0
     eval item replacere("%item", "my my", "my")
     eval item replacere("%item", "my", "")
     if ($standing = 0) then gosub STAND
     # if ("$UC_WeaponType" = "BRAWL") then goto RETURN
     gosub WIELD_LEFT_CHECK
     pause 0.00001
     if ("%item" = "NULL") then return
     if matchre("$righthand", "%item") || matchre("$lefthand", "%item") then return
     var LOCATION WIELD_LEFT_1
     WIELD_LEFT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre ESCAPE_HEAL_CHECK ^You can't pick that up with your hands that damaged\.|^Your left hand is too injured to
     matchre WIELD_LEFT_GET ^You find it difficult to wield
     matchre WIELD_LEFT_GET ^You can only wield
     matchre WIELD_LEFT_GET ^You're wearing a.*\!  You'll need to remove it first\!
     matchre WIELD_LEFT_GET ^What were you referring to\?
     matchre WIELD_LEFT_GET ^\s*Wield what\?
     matchre WIELD_LEFT_GET ^\s*Please rephrase
     matchre WIELD_RETURN ^You need a free hand
     matchre WIELD_RETURN ^You're already holding
     matchre WIELD_RETURN ^With fluid|With a flick|With a flick
     matchre WIELD_RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre WIELD_RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre WIELD_RETURN ^With fluid|With a flick
     send wield left my %item
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN WIELD_LEFT! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %item
     put #log $datetime MISSING MATCH IN WIELD_LEFT (ubercombat.cmd)
     return
WIELD_LEFT_GET:
     delay 0.0001
     if matchre("$righthand", "%item") || matchre("$lefthand", "%item") then return
     var LOCATION WIELD_LEFT_GET_1
     WIELD_LEFT_GET_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre ESCAPE_HEAL_CHECK ^You can't pick that up with your hands that damaged\.
     matchre WIELD_DOUBLECHECK_2 ^You find it difficult to wield
     matchre WIELD_DOUBLECHECK_2 ^You can only wield
     matchre WIELD_DOUBLECHECK_2 ^You're wearing a.*\!  You'll need to remove it first\!
     matchre WIELD_DOUBLECHECK_2 ^What were you referring to\?
     matchre WIELD_DOUBLECHECK_2 ^\s*Wield what\?
     matchre WIELD_DOUBLECHECK_2 ^\s*Get what\?
     matchre WIELD_DOUBLECHECK ^\s*But that is
     matchre WIELD_RETURN ^You need a free hand
     matchre WIELD_RETURN ^You're already holding
     matchre WIELD_RETURN ^With fluid|With a flick|With a flick
     matchre WIELD_RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre WIELD_RETURN You'?r?e? (?:hand|slip|put|get|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre WIELD_RETURN ^With fluid|With a flick
     send get %item
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN WIELD_LEFT_GET! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %item
     put #log $datetime MISSING MATCH IN WIELD_LEFT_GET (ubercombat.cmd)
     return

WIELD_DOUBLECHECK:
WIELD_DOUBLECHECK_2:
     delay 0.0001
     pause 0.00001
     # if !matchre("%ALLCONTAINERS", "(?i)(eddy|portal)") then goto REMOVE_WEAPON
     var LOCATION WIELD_DOUBLECHECK_1
     WIELD_DOUBLECHECK_1:
     gosub LOOKPORTAL_TIMER
     if (%portalLast > 200) then
          {
               put look in my portal
               var portalTime $gametime
               pause 0.2
          }
     pause 0.1
     pause 0.00001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WAIT ^You struggle with .* great weight but can't quite lift it\!
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre ESCAPE_HEAL_CHECK ^You can't pick that up with your hands that damaged\.
     matchre REMOVE_WEAPON ^But that is already in your inventory\.
     matchre REMOVE_WEAPON ^You should untie
     matchre REMOVE_WEAPON ^Get what\?|Brushing
     matchre REMOVE_WEAPON ^I could not find what you were referring to\.
     matchre REMOVE_WEAPON ^What were you referring to\?
     matchre REMOVE_WEAPON ^What do you want
     matchre WIELD_RETURN ^You carefully remove .* from the bundle\.
     matchre WIELD_RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre WIELD_RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre WIELD_RETURN ^As best it can\, .* moves in your direction\.
     matchre WIELD_RETURN ^The .* (is|are|slides)
     matchre WIELD_RETURN ^Without (any|a)|Brushing
     matchre WIELD_RETURN suddenly leaps toward you|and flies towards you|with a flick
     send get %item from my watery portal
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN WIELD_DOUBLECHECK! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %todo
     put #log $datetime MISSING MATCH IN WIELD_DOUBLECHECK (ubercombat.cmd)
     return

REMOVE_WEAPON:
     var LOCATION REMOVE_WEAPON_1
     pause 0.0001
     eval item replacere("%item", "my ", "")
     if ($standing = 0) then gosub STAND
     REMOVE_WEAPON_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre ESCAPE_HEAL_CHECK ^You can't pick that up with your hands that damaged\.
     matchre UNTIE_WEAPON ^You should untie
     matchre UNTIE_WEAPON ^But that is
     matchre UNTIE_WEAPON ^Remove what\?
     matchre UNTIE_WEAPON ^What were you referring to\?
     matchre WIELD_RETURN ^You're already holding
     matchre WIELD_RETURN ^You remove .* from your belt\.
     matchre WIELD_RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre WIELD_RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     send remove my %item
     matchwait 20
     return

UNTIE_WEAPON:
     delay 0.0001
     var LOCATION UNTIE_WEAPON_1
     eval item replacere("%item", "my ", "")
     UNTIE_WEAPON_1:
     matchre UNTIE_WEAPON ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre UNTIE_WEAPON ^You struggle with .* great weight but can't quite lift it\!
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre ESCAPE_HEAL_CHECK ^You can't pick that up with your hands that damaged\.
     matchre HOLD_1 ^But that is already in your inventory\.
     matchre WIELD_ERROR ^Get what\?
     matchre WIELD_ERROR ^Untie what\?
     matchre WIELD_ERROR ^I could not find what you were referring to\.
     matchre WIELD_ERROR ^What were you referring to\?
     matchre WIELD_ERROR ^What do you want
     matchre WIELD_RETURN ^As best it can\, .* moves in your direction\.
     matchre WIELD_RETURN suddenly leaps toward you|and flies towards you|with a flick
     matchre WIELD_RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre WIELD_RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|reverently|breathe|switch|deftly|swiftly|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     send untie my %item
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN UNTIE_WEAPON! (ubercombat.cmd) ***
     put #echo >Log Crimson  Get = %item
     put #log $datetime MISSING MATCH IN UNTIE_WEAPON (ubercombat.cmd)
     return
#############################################################
#### SPECIAL NECRO HEALING CHECK
#### IF CAN'T PICK UP WEAPON DUE TO HANDS BEING TOO DAMAGED
#### BUT WE ARE IN NECRO HEALING MODE - SWITCH TO BRAWLING
#############################################################
ESCAPE_HEAL_CHECK:
     if (%NecroHealing = 1) then
          {
               echo
               echo #######################
               echo *** HANDS TOO WOUNDED FOR WEAPON!!
               echo *** REVERTING TO BRAWLING FOR KILLS
               echo #######################
               echo
               goto BRAWLING
          }
     goto ESCAPE_HEAL
WIELD_ERROR:
     math stowloop add 1
     if (%stowloop > 4) then
          {
               var stowloop 0
               echo #############
               echo *** WEAPON ERROR!!
               echo *** COULD NOT FIND WEAPON!
               echo #############
               goto WEAPON_ERROR
          }
     if ((%HaveDamaris = 1) && matchre("%item", "(?i)(akabo|arbalest|bow|bludgeon|bola|broadsword|claymore|falchion|greathammer|halberd|latchbow|mace|maul|nightstick|oben|pike|quarterstaff|rapier|sabre|shortbow|sledgehammer|sling|slurbow|stonebow|mallet)")) then
          {
               var item damaris %item
               eval item replacere("%item", "(?i)(damaris throwing mallet|damaris mallet)", "throwing mallet")
               eval item replacere("%item", "(?i)(damaris battle bow|damaris bow)", "battle bow")
               goto WIELD1
          }
     if matchre("%item", "exoskeletal") then
          {
               if (matchre("%item", "nightstick") && (%stowloop = 1)) then var item spider ring
               if (matchre("%item", "nightstick") && (%stowloop = 2)) then var item bone torque
               if (matchre("%item", "maul") && (%stowloop = 1)) then var item ebony amulet
               if (matchre("%item", "maul") && (%stowloop = 2)) then var item eyebrow ring
               if matchre("%item", "sword") then var item ebony hairpin
               if matchre("%item", "mace") then var item ebony thighband
               if matchre("%item", "rapier") then var item ebony earcuff
               if matchre("%item", "scimitar") then var item lizard wristcuff
               if matchre("%item", "longsword") then var item snake ring
               if matchre("%item", "katar") then var item scarab amulet
               if matchre("%item", "pike") then var item cascading earrings
               if matchre("%item", "halberd") then var item hewn band
               if matchre("%item", "mattock") then var item black armband
               if matchre("%item", "claymore") then var item ebony ring
               if matchre("%item", "broadsword") then var item ebony skull
               if matchre("%item", "bludgeon") then var item thin anklet
               if matchre("%item", "axe") then var item thick armband
               goto WIELD1
          }
     if matchre("%item", "battle axe") then
          {
               var item ear stud
               goto WIELD1
          }
     if matchre("%item", "axe") then
          {
               var item thick armband
               goto WIELD1
          }
     if matchre("%item", "morning star") then
          {
               var item ebony anklet
               goto WIELD1
          }
     if matchre("%item", "(?i)tailband") then
          {
               var item katavdar
               var WEAPON katavdar
               goto WIELD1
          }
     if matchre("%item", "(?i)katavdar") then
          {
               var item tailband
               var WEAPON tailband
               goto WIELD1
          }
     if matchre("%item", "(hairpin|thighband|earcuff|amulet|wristcuff|\bring|\bskull|anklet|armband|pendant|earrings|\bband|torque|ear stud)") then
          {
              if matchre("%item", "spider ring") then var item exoskeletal nightstick
              if matchre("%item", "ear stud") then var item battle axe
              if matchre("%item", "ebony anklet") then var item morning star
              if matchre("%item", "eyebrow ring") then var item exoskeletal maul
              if matchre("%item", "ebony hairpin") then var item exoskeletal sword
              if matchre("%item", "ebony thighband") then var item exoskeletal mace
              if matchre("%item", "ebony earcuff") then var item exoskeletal rapier
              if matchre("%item", "ebony amulet") then var item exoskeletal maul
              if matchre("%item", "lizard wristcuff") then var item exoskeletal scimitar
              if matchre("%item", "snake ring") then var item exoskeletal longsword
              if matchre("%item", "scarab amulet") then var item exoskeletal katar
              if matchre("%item", "earrings") then var item exoskeletal pike
              if matchre("%item", "hewn band") then var item exoskeletal halberd
              if matchre("%item", "torque") then var item exoskeletal nightstick
              if matchre("%item", "black armband") then var item exoskeletal mattock
              if matchre("%item", "ebony ring") then var item exoskeletal claymore
              if matchre("%item", "ebony skull") then var item exoskeletal broadsword
              if matchre("%item", "thin anklet") then var item exoskeletal bludgeon
              if matchre("%item", "thick armband") then var item exoskeletal axe
              goto WIELD1
          }
     if (matchre("%item", "(?i)tailband") && !matchre("$righthand", "(?i)tailband") && !matchre("$lefthand", "(?i)tailband")) then
          {
               var item katavdar
               var WEAPON katavdar
               goto WIELD1
          }
     goto WIELD1
WIELD_RETURN:
     pause 0.00001
     if matchre("$righthandnoun", "\bfan\b") then gosub SWAPPABLE
EXO_CHECK:
     gosub GLANCE
     #### KATAVDAR / TAILBANDS / EXOSKELETAL WEAPON CHECKS
     #### THIS CHECKS AFTER WIELDING WEAPON, WHETHER IT'S A SPECIAL WEAPON THAT NEEDS TO BE SHIFTED
     if (matchre("$righthand", "tailband") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
     if matchre("$righthand", "tailband") then
          {
               pause 0.00001
               put turn my tail
               pause 0.4
               pause 0.3
               gosub GLANCE
               pause 0.3
               if matchre("$righthand $lefthand", "(heavy steel|polished brass|thick copper|brushed bronze|(?<!dark |rippled |desert-tan )steel) katavdar") then
                    {
                         if matchre("%TRAINING", "Heavy_Thrown") then
                              {
                                   var HTWEAPON katavdar
                                   put #var UC_WEAPON_HT katavdar
                              }
                         if matchre("%TRAINING", "Large_Edged") then
                              {
                                   var LEWEAPON katavdar
                                   put #var UC_WEAPON_LE katavdar
                              }
                    }
               if matchre("$righthand $lefthand", "(golden|(dark |rippled )steel|bark|coral) katavdar") then
                    {
                         if matchre("%TRAINING", "Light_Thrown") then
                              {
                                   var LTWEAPON katavdar
                                   put #var UC_WEAPON_LT katavdar
                              }
                         if matchre("%TRAINING", "Large_Blunt") then
                              {
                                   var LBWEAPON katavdar
                                   put #var UC_WEAPON_LB katavdar
                              }
                    }
               if matchre("$righthand $lefthand", "(gloomwood|haralun|pink|desert-tan steel|platinum\-washed) katavdar") then
                    {
                         if matchre("%TRAINING", "Heavy_Thrown") then
                              {
                                   var HTWEAPON katavdar
                                   put #var UC_WEAPON_HT katavdar
                              }
                         if matchre("%TRAINING", "Large_Blunt") then
                              {
                                   var LBWEAPON katavdar
                                   put #var UC_WEAPON_LB katavdar
                              }
                    }
                    var WEAPON_NOUN katavdar
                    var WEAPON katavdar
                    var ThrowType lob
                    var item katavdar
                    echo ###########################
                    echo ** Shifted Tailband to Katavdar
                    echo ** Setting CurrentWeapon to Katavdar
                    echo ###########################
                    pause 0.2
               if matchre("$righthand $lefthand", "katavdar") then return
          }
     #### EXOSKELETAL WEAPON HANDLING
     if matchre("$righthand $lefthand", "(hairpin|thighband|earcuff|amulet|wristcuff|ring|skull|anklet|armband|pendant|earrings|band|torque|ear stud)") then
          {
               var morph $1
               pause 0.01
               put tap my %morph
               pause 0.3
               pause 0.1
               gosub GLANCE
               if matchre("$righthand $lefthand", "exoskeletal morning star") then
                    {
                         var HBWEAPON morning star
                         put #var UC_WEAPON_HB %HBWEAPON
                         var WEAPON %HBWEAPON
                         var WEAPON_NOUN star
                    }
               if matchre("$righthand $lefthand", "exoskeletal battle axe") then
                    {
                         var HEWEAPON battle axe
                         put #var UC_WEAPON_HE %HEWEAPON
                         var WEAPON %HEWEAPON
                         var WEAPON_NOUN battle axe
                    }
               if matchre("$righthand $lefthand", "exoskeletal sword") then
                    {
                         var THEWEAPON exoskeletal sword
                         put #var UC_WEAPON_THE %THEWEAPON
                         var WEAPON %THEWEAPON
                         var WEAPON_NOUN sword
                    }
              if matchre("$righthand $lefthand", "exoskeletal mace") then
                    {
                         var SBWEAPON exoskeletal mace
                         put #var UC_WEAPON_SB %SBWEAPON
                         var WEAPON %SBWEAPON
                         var WEAPON_NOUN mace
                    }
              if matchre("$righthand $lefthand", "exoskeletal rapier") then
                    {
                         var SEWEAPON exoskeletal rapier
                         put #var UC_WEAPON_SE %SEWEAPON
                         var WEAPON %SEWEAPON
                         var WEAPON_NOUN rapier
                    }
              if matchre("$righthand $lefthand", "exoskeletal maul") then
                    {
                         var THBWEAPON exoskeletal maul
                         put #var UC_WEAPON_SE %THBWEAPON
                         var WEAPON %THBWEAPON
                         var WEAPON_NOUN maul
                    }
               if matchre("$righthand $lefthand", "exoskeletal scimitar") then
                    {
                         var SEWEAPON exoskeletal scimitar
                         put #var UC_WEAPON_SE %SEWEAPON
                         var WEAPON %SEWEAPON
                         var WEAPON_NOUN scimitar
                    }
               if matchre("$righthand $lefthand", "exoskeletal longsword") then
                    {
                         var LEWEAPON exoskeletal longsword
                         put #var UC_WEAPON_LE %LEWEAPON
                         var WEAPON %LEWEAPON
                         var WEAPON_NOUN longsword
                    }
               if matchre("$righthand $lefthand", "exoskeletal katar") then
                    {
                         var SEWEAPON exoskeletal katar
                         put #var UC_WEAPON_SE %SEWEAPON
                         var WEAPON %SEWEAPON
                         var WEAPON_NOUN katar
                    }
               if matchre("$righthand $lefthand", "exoskeletal axe") then
                    {
                         var SEWEAPON exoskeletal axe
                         var LTWEAPON exoskeletal axe
                         put #var UC_WEAPON_SE %SEWEAPON
                         put #var UC_WEAPON_LT %LTWEAPON
                         var WEAPON %SEWEAPON
                         var WEAPON_NOUN axe
                    }
               if matchre("$righthand $lefthand", "exoskeletal bludgeon") then
                    {
                         var SBWEAPON exoskeletal bludgeon
                         put #var UC_WEAPON_SB %SBWEAPON
                         var WEAPON %SBWEAPON
                         var WEAPON_NOUN bludgeon
                    }
               if matchre("$righthand $lefthand", "exoskeletal broadsword") then
                    {
                         var LEWEAPON exoskeletal broadsword
                         put #var UC_WEAPON_LE %LEWEAPON
                         var WEAPON %LEWEAPON
                         var WEAPON_NOUN broadsword
                    }
               if matchre("$righthand $lefthand", "exoskeletal claymore") then
                    {
                         var THEWEAPON exoskeletal claymore
                         put #var UC_WEAPON_THE %THEWEAPON
                         var WEAPON %THEWEAPON
                         var WEAPON_NOUN claymore
                    }
               if matchre("$righthand $lefthand", "exoskeletal nightstick") then
                    {
                         var STAVES exoskeletal nightstick
                         put #var UC_WEAPON_STAVES %STAVES
                         var WEAPON %STAVES
                         var WEAPON_NOUN nightstick
                    }
               if matchre("$righthand $lefthand", "exoskeletal pike") then
                    {
                         var POLEARMS exoskeletal pike
                         put #var UC_WEAPON_POLEARMS %POLEARMS
                         var WEAPON %POLEARMS
                         var WEAPON_NOUN pike
                    }
               if matchre("$righthand $lefthand", "exoskeletal halberd") then
                    {
                         var POLEARMS exoskeletal halberd
                         put #var UC_WEAPON_POLEARMS %POLEARMS
                         var WEAPON %POLEARMS
                         var WEAPON_NOUN halberd
                    }
               if matchre("$righthand $lefthand", "exoskeletal mattock") then
                    {
                         var THBWEAPON exoskeletal mattock
                         put #var UC_WEAPON_THB %THBWEAPON
                         var WEAPON %THBWEAPON
                         var WEAPON_NOUN mattock
                    }
               if matchre("$righthand $lefthand", "exoskeletal hammer") then
                    {
                         var SBWEAPON exoskeletal hammer
                         put #var UC_WEAPON_SB %SBWEAPON
                         var WEAPON %SBWEAPON
                         var WEAPON_NOUN hammer
                    }
               if matchre("$righthand $lefthand", "exoskeletal ritual dagger") then
                    {
                         var SEWEAPON ritual dagger
                         put #var UC_WEAPON_SE %SEWEAPON
                         var WEAPON %SEWEAPON
                         var WEAPON_NOUN dagger
                    }
               if matchre("$righthand $lefthand", "exoskeletal war hammer") then
                    {
                         var SBWEAPON war hammer
                         put #var UC_WEAPON_SB %SBWEAPON
                         var WEAPON %SBWEAPON
                         var WEAPON_NOUN hammer
                    }
                    var item %WEAPON_NOUN
                    echo ###################
                    echo ** Setting Weapon name:
                    echo ** %WEAPON
                    echo ###################
                    pause 0.1
          }
     #### DAMARIS WEAPON HANDLING
     # if matchre("$righthand $lefthand", "(?i)(damaris (.+)") then
     delay 0.0001
     if ((%HaveDamaris = 1) && matchre("$righthand %hand.1", "(?i)(damaris|damaris throwing mallet|damaris battle bow)")) then
     {
     #debug 10
     if (matchre("$UC_WeaponType", "\bHT\b") && matchre("$UC_WEAPON_HT", "(?i)damaris mallet") && !matchre("%DamarisType", "(?i)mallet")) then gosub DAMARIS_SHIFT mallet
     if (matchre("$UC_WeaponType", "\bLB\b") && matchre("$UC_WEAPON_LB", "(?i)damaris mallet") && !matchre("%DamarisType", "(?i)mallet")) then gosub DAMARIS_SHIFT mallet
     if (matchre("$UC_WeaponType", "\bLT\b") && matchre("$UC_WEAPON_LT", "(?i)damaris bola") && !matchre("%DamarisType", "(?i)bola")) then gosub DAMARIS_SHIFT bola
     if (matchre("$UC_WeaponType", "\bSB\b") && matchre("$UC_WEAPON_SB", "(?i)damaris bola") && !matchre("%DamarisType", "(?i)bola")) then gosub DAMARIS_SHIFT bola
     if (matchre("$UC_WeaponType", "\bBACKSTAB\b") && matchre("$UC_WEAPON_BS", "(?i)damaris sabre") && !matchre("%DamarisType", "(?i)sabre")) then gosub DAMARIS_SHIFT sabre
     if (matchre("$UC_WeaponType", "\bBACKSTAB\b") && matchre("$UC_WEAPON_BS", "(?i)damaris rapier") && !matchre("%DamarisType", "(?i)rapier")) then gosub DAMARIS_SHIFT rapier
     if (matchre("$UC_WeaponType", "\bBACKSTAB\b") && matchre("$UC_WEAPON_BS", "(?i)damaris pasabas") && !matchre("%DamarisType", "(?i)pasabas")) then gosub DAMARIS_SHIFT pasabas
     if (matchre("$UC_WeaponType", "\bBACKSTAB\b") && matchre("$UC_WEAPON_BS", "(?i)damaris oben") && !matchre("%DamarisType", "(?i)oben")) then gosub DAMARIS_SHIFT oben
     if (matchre("$UC_WeaponType", "CROSSBOW") && matchre("$UC_WEAPON_CROSSBOW", "(?i)damaris (arbalest|stonebow|latchbow|slurbow|lockbow)") && !matchre("%DamarisType", "(?i)(arbalest|stonebow|latchbow|slurbow|lockbow)")) then gosub DAMARIS_SHIFT $UC_WEAPON_CROSSBOW
     if (matchre("$UC_WeaponType", "\bBOW\b") && matchre("$UC_WEAPON_BOW", "(?i)damaris (shortbow|longbow|battle bow|bow)") && !matchre("%DamarisType", "(?i)\b(shortbow|longbow|battle bow|bow)")) then gosub DAMARIS_SHIFT $UC_WEAPON_BOW
     if (matchre("$UC_WeaponType", "SLINGS") && matchre("$UC_WEAPON_SLING", "(?i)damaris sling") && !matchre("%DamarisType", "(?i)sling")) then gosub DAMARIS_SHIFT $UC_WEAPON_SLING
     if (matchre("$UC_WeaponType", "POLEARMS") && matchre("$UC_WEAPON_POLEARMS", "(?i)damaris (halberd|pike)") && !matchre("%DamarisType", "(?i)(halberd|pike)")) then gosub DAMARIS_SHIFT $UC_WEAPON_POLEARMS
     if (matchre("$UC_WeaponType", "STAVES") && matchre("$UC_WEAPON_STAVES", "(?i)damaris (nightstick|quarterstaff)") && !matchre("%DamarisType", "(?i)(nightstick|quarterstaff)")) then gosub DAMARIS_SHIFT $UC_WEAPON_STAVES
     if (matchre("$UC_WeaponType", "\bTHB\b") && matchre("$UC_WEAPON_THB", "(?i)damaris (akabo|maul)") && !matchre("%DamarisType", "(?i)(akabo|maul)")) then gosub DAMARIS_SHIFT $UC_WEAPON_THB
     if (matchre("$UC_WeaponType", "\bLB\b") && matchre("$UC_WEAPON_LB", "(?i)damaris (sledgehammer|greathammer)") && !matchre("%DamarisType", "(?i)(sledgehammer|greathammer)")) then gosub DAMARIS_SHIFT $UC_WEAPON_LB
     if (matchre("$UC_WeaponType", "\bSB\b") && matchre("$UC_WEAPON_SB", "(?i)damaris (bludgeon|mace)") && !matchre("%DamarisType", "(?i)(bludgeon|mace)")) then gosub DAMARIS_SHIFT $UC_WEAPON_SB
     if (matchre("$UC_WeaponType", "\bTHE\b") && matchre("$UC_WEAPON_THE", "(?i)damaris (claymore|greatsword)") && !matchre("%DamarisType", "(?i)(claymore|greatsword)")) then gosub DAMARIS_SHIFT $UC_WEAPON_THE
     if (matchre("$UC_WeaponType", "\bLE\b") && matchre("$UC_WEAPON_LE", "(?i)damaris (falchion|broadsword)") && !matchre("%DamarisType", "(?i)(falchion|broadsword)")) then gosub DAMARIS_SHIFT $UC_WEAPON_LE
     if (matchre("$UC_WeaponType", "\bSE\b") && matchre("$UC_WEAPON_SE", "(?i)damaris (sabre|rapier|oben|pasabas)") && !matchre("%DamarisType", "(?i)(sabre|rapier|oben|pasabas)")) then gosub DAMARIS_SHIFT $UC_WEAPON_SE
     }
     #debug 0
     return
######################################################################
## DAMARIS WEAPON LOGIC
######################################################################
DAMARIS:
DAMARIS_SHIFT:
     var shifting $0
     pause 0.001
     pause 0.001
SHIFT_DECIDE:
     if matchre("$lefthand", "(?i)Damaris") then gosub SWAP
     pause 0.1
     pause 0.1
     eval shifting replacere("%shifting", "(?i)damaris throwing mallet", "throwing mallet")
     eval shifting replacere("%shifting", "(?i)damaris battle bow", "battle bow")
     eval shifting replacere("%shifting", "(?i)damaris battlebow", "battle bow")
     eval shifting replacere("%shifting", "(?i)damaris short bow", "damaris shortbow")
     eval shifting replacere("%shifting", "(?i)damaris ", "")
     pause 0.001
     if matchre("%shifting", "$righthandnoun") then
          {
               #debug 0
               return
          }
     pause 0.001
     matchre SHIFT_UNLOAD ^You should probably save|^You should unload
     matchre SHIFT_BAD ^Which weapon did you want to pull out of the shadows\?
     matchre SHIFT_BAD ^Turn what\?|^You attempt
     matchre SHIFT_GOOD ^Your .+ shifts and momentarily becomes a blurry mass of shadows before resolving itself into a Damaris (.+)\.
     put turn $righthandnoun to %shifting
     matchwait 10
SHIFT_GOOD:
     pause 0.1
     var DamarisType $1
     echo
     echo ##################
     echo *** Damaris Shift Success!
     echo *** %DamarisType
     echo ##################
     echo
     pause 0.001
     var item %DamarisType
     var WEAPON %DamarisType
     #debug 0
     return
SHIFT_BAD:
     echo
     echo ########################
     echo # BAD DAMARIS WEAPON SHIFT
     echo # DID NOT FIND %shifting
     echo # CHECK YOUR WEAPON VARS
     echo # SHOULD AUTO-CORRECT ITSELF NEXT WEAPON
     echo ########################
     echo
     put #echo >Log Crimson  *** ERROR - BAD DAMARIS WEAPON SHIFT - %shifting not found? ***
     pause 0.1
     #debug 0
     goto WEAPON_ERROR
SHIFT_UNLOAD:
     pause 0.0001
     send unload
     wait
     pause 0.3
     pause 0.5
     gosub STOWIT left
     goto SHIFT_DECIDE
#############################################################################
### SHIFT DAMARIS WEAPON BACK TO SLING BEFORE STOWING / WEARING
DAMARIS_RESET:
     if matchre("$righthand", "(?i)damaris sling") then return
     pause 0.1
     pause 0.1
     pause 0.0001
     pause 0.0001
     pause 0.0001
     matchre DAMARIS_RESET ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre DAMARIS_UNLOAD ^You should probably save|^You should unload
     matchre DAMARIS_DONE_2 ^Which weapon did you want to pull out of the shadows\?|^Turn what\?|^You attempt
     matchre DAMARIS_DONE ^Your .+ shifts and momentarily becomes a blurry mass of shadows before resolving itself into a Damaris (.+)\.
     put turn $righthandnoun to sling
     matchwait 10
     goto DAMARIS_DONE_2
DAMARIS_DONE:
     pause 0.001
     var DamarisType damaris sling
     delay 0.001
DAMARIS_DONE_2:
     delay 0.001
     echo
     echo *** SAVING LAST DAMARIS TYPE: %DamarisType
     echo
     var WEAPON %DamarisType
     pause 0.001
     pause 0.001
     #debug 0
     return
DAMARIS_UNLOAD:
     pause 0.1
     pause 0.001
     send unload
     wait
     pause 0.3
     pause 0.5
     gosub STOWIT left
     goto DAMARIS_RESET
#######################################################################

WIELD_SKINNER:
     var LOCATION WIELD_SKINNER_1
     pause 0.0001
     if ($standing = 0) then gosub STAND
     WIELD_SKINNER_1:
     matchre WIELD_SKINNER ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre ESCAPE_HEAL ^You can't pick that up with your hands that damaged\.
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre RETURN You'?r?e? (?:hand|slip|put|get|.+ to|.+ fan|can't|leap|tug|quickly|dance|gracefully|reverently|breathe|switch|deftly|swiftly|untie|sheathe|strap|slide|desire|raise|sling|pull|drum|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|mind|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|already|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|yank|allow|have|are|wring|icesteel|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|tap|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel(?! fully rested)|read|reach|gingerly|come|effortlessly|corruption|count|secure|detach|unload|briefly|zills|remain|release|shield) .*(?:\.|\!|\?)?
     matchre RETURN ^You're already holding .*\!
     matchre RETURN ^You're wearing
     matchre RETURN Wield what\?
     send wield my $UC_Skinner
     matchwait 7
     return
##################################################################################
#### COMBAT ATTACK SUBS
LEUCRO_ACTION:
     pause 0.001
     pause 0.001
     pause 0.1
     pause 0.01
     echo *** LEUCRO ACTION: %LeucroAction
     pause 0.1
     send %LeucroAction leucro
     pause 0.2
     pause 0.2
     pause 0.001
     var LeucroAction NULL
     return
BLESS_IT:
     pause 0.00001
     pause 0.00001
     math blessloop add 1
     if (%blessloop > 3) then goto BLESS_ERROR_2
     var bless.mana 5
     if !matchre("%abbrevs", "(?i)bless") then goto BLESS_ERROR
     echo ######################
     echo *** BLESSING OUR WEAPON: %WEAPON
     echo ######################
     pause 0.00001
     if ("$preparedspell" != "None") then
     {
          gosub RELEASE spell
          gosub RELEASE_CAMB
     }
     pause 0.00001
     if !matchre("$righthand $lefthand", "(?i)%WEAPON_NOUN") then gosub GET_IT %WEAPON
     if ($Utility.Ranks < 30) then var bless.mana 1
     if (($Utility.Ranks > 30) && ($Utility.Ranks <= 50)) then var bless.mana 2
     if (($Utility.Ranks > 50) && ($Utility.Ranks <= 100)) then var bless.mana 4
     if (($Utility.Ranks > 100) && ($Utility.Ranks <= 200)) then var bless.mana 5
     if (($Utility.Ranks > 200) && ($Utility.Ranks <= 300)) then var bless.mana 10
     if (($Utility.Ranks > 300) && ($Utility.Ranks <= 500)) then var bless.mana 18
     if (($Utility.Ranks > 500) && ($Utility.Ranks <= 700)) then var bless.mana 27
     if (($Utility.Ranks > 700) && ($Utility.Ranks <= 1000)) then var bless.mana 40
     if (($Utility.Ranks > 1000) && ($Utility.Ranks <= 1300)) then var bless.mana 60
     if (($Utility.Ranks > 1300) && ($Utility.Ranks <= 2000)) then var bless.mana 75
     pause 0.00001
     gosub PREPARE bless %bless.mana
     pause 2
     if matchre("%WEAPON_EXP","^(Slings|Bow|Crossbow)") then
          {
               gosub stowing
               gosub GET my %CurrentAmmo
          }
     pause 14
     if matchre("%WEAPON_EXP","^(Slings|Bow|Crossbow)") then put cast %CurrentAmmo
     else put cast %WEAPON
     pause 0.5
     pause 0.1
     if ("$preparedspell" != "None") then gosub RELEASE spell
     goto %LAST

BLESS_ERROR:
     echo ############################
     echo ** BLESS WEAPON ERROR!
     echo ** We attacked an undead mob
     echo ** Our %WEAPON is not blessed!
     echo ** AND YOU DO NOT KNOW THE BLESS SPELL
     echo ** SWITCHING WEAPONS
     echo ############################
     put #echo >Log #FF4E01 *** BLESS ERROR! Attacked undead w/ no blessed weapon
     goto SWITCH
BLESS_ERROR_2:
     echo ############################
     echo ** BLESS WEAPON ERROR!
     echo ** WEAPON STILL NOT BLESSED AFTER MULTIPLE ATTEMPTS
     echo ** SWITCHING WEAPONS
     echo ############################
     put #echo >Log #FF4E01 *** BLESS ERROR! Weapon not blessed after multiple attempts
     goto SWITCH
#######################################
ATTACK_STOW_LEFT:
     pause 0.00001
     if matchre("$lefthand", "($UC_ALLSWAPPABLE)") then
          {
               math swapped add 1
               if (%swapped > 2) then goto ATTACK_STOW_LEFT_2
               put swap my $lefthandnoun
               pause 0.5
               goto ATTACK_1
          }
ATTACK_STOW_LEFT_2:
     var swapped 0
     echo *** STOWING LEFTHAND
     gosub STOWIT left
     pause 0.0001
     pause 0.0001
     if !matchre("%WEAPON", "(?i)($charactername|NULL)") && !matchre("$righthand", "(?i)%WEAPON") then gosub WIELD %WEAPON
     if matchre("$lefthand", "(?i)%WEAPON") && ("$UC_WeaponType" != "OFFHAND") then gosub SWAP
     if (matchre("$UC_WeaponType","(THE|THB|POLEARMS|CROSSBOW|SLINGS|BOW)") && !matchre("$lefthand", "Empty")) then gosub STOWIT left
     goto ATTACK_1
ATTACK_RETREAT:
     gosub RETREAT
     var AttackRetreat 1
     if ("$guild" = "Empath") then put advance %Attack.Critter
     pause 8
     goto ATTACK_1
ATTACK_NEXT:
     if ("$guild" = "Empath") then goto FACE_IT
     put face next
     pause 0.5
ATTACK_WAIT:
     if (("$guild" = "Empath") && (%AttackRetreat = 0)) then goto ATTACK_RETREAT
     pause
     pause 0.2
     pause 0.2
     matchre ATTACK_WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre ATTACK_1 to melee range|\[You're
     matchre ATTACK_1 already at melee|stops you from advancing any farther\!
     matchre ATTACK_NEXT stop advancing|You have lost sight
     put advance
     matchwait 12
ATTACK:
     delay 0.00001
     var swapped 0
     var AttackRetreat 0
ATTACK_1:
     var ACTION attack
     var LOCATION ATTACK_1
     if ($stamina < 35) then gosub STAMINA_WAIT
     if ($standing = 0) then gosub STAND
     if (%spellPrepped = 1) then gosub SPELL_CAST
     if (("$guild" = "Paladin") && ($hidden = 1)) then gosub UNHIDE
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     if ("$guild" = "Empath") then
          {
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION $Mana.ABSOLUTION
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION 250
               if (matchre("$monsterlist", "(?i)%Undead") && ($spellABSOLUTION = 0) && (%ABSOLUTION = 1) && ("$monsterlist" != "")) then gosub BUFF ABSOLUTION 150
               if (matchre("$monsterlist", "(?i)%Undead") && (%ABSOLUTION = 1) && ($SpellTimer.Absolution.active = 0)) then gosub BUFF ABSOLUTION 150
               if ((matchre("$monsterlist", "%Undead") && ($spellABSOLUTION = 0)) || (matchre("$monsterlist", "(?i)%Undead") && ($SpellTimer.Absolution.active = 0))) then
                    {
                                   echo ##################################
                                   echo ** SHIT! NO ABSOLUTION UP???
                                   echo ** Something weird going on....
                                   echo ** Switching to Non-Damaging Empath Routine
                                   echo ##################################
                                   goto PREEMPATHBRAWLING
                    }
          if ((%Empath.Brawl = 0) && matchre("%facing", "%Undead") && ($SpellTimer.Absolution.duration > 1)) then goto ATTACK_2
          if ((%Empath.Brawl = 0) && matchre("%facing", "%Construct") then goto ATTACK_2
          if ((%Empath.Brawl = 1) && !matchre("%facing", "%Undead|%Construct")) then gosub EMPATH_FACE
          if ((%Empath.Brawl = 1) && !matchre("%facing", "%Undead|%Construct")) then goto PREEMPATHBRAWLING
          }
     ATTACK_2:
     pause 0.0001
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre CALMED ^Strangely\, you don\'t feel like fighting right now\.
     matchre ATTACK_1 ^You should stand
     matchre BLESS_IT ^Your ((?!frigid |blast |electric |flaming ).+)passes through the .+ with no effect
     matchre ATTACK_RETREAT ^You will have to retreat from your current melee first\.
     matchre ATTACK_STOW_LEFT ^You need two hands to wield this weapon\!|^You must free up your left hand first\.
     matchre ATTACK_WAIT ^You are already advancing|^You begin to advance|help if you were closer|aren't close enough
     matchre FACE_NEXT ^There is nothing else to face|^Face what\?
     matchre LOST_WEAPON ^Wouldn't it be better if you used a melee weapon\?
     matchre ATTACK_DEAD balanced\]|balance\]|already dead|very dead|pointlessly hack
     matchre FLYING flying too high for you to attack|flying far too high to hit
     matchre ATTACK_RETURN ^The .+ is
     matchre ATTACK_RETURN ^I could not
     matchre ATTACK_RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?
     matchre ATTACK_RETURN ^\[Roundtime\s\:?(\d)|\[Roundtime\S\:?
     matchre ATTACK_RETURN ^At what are you trying to .*\?
     matchre ATTACK_RETURN ^With your fist
     matchre ATTACK_RETURN ^Only skilled
     matchre ATTACK_RETURN \[You\'re .* balanced
     matchre ATTACK_RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre ATTACK_RETURN ^You are already in a position|But you are already dodging|You move into a position to|must be hidden|^What were you|^What are you
     matchre ATTACK_RETURN ^You (?:hand|put|get|slip|slide|raise|sling|pull|trace|wear|tap|recall|press|hang|gesture|push|move|whisper|lean|tilt|cannot|drop|drape|loosen|work|lob|spread|not|fill|will|now|slowly|quickly|spin|filter|need|shouldn't|pour|blow|twist|struggle|place|knock|toss|set|add|search|circle|fake|weave|shove|try|must|wave|sit|fail|turn|are already|can\'t|glance|bend|swing|chop|bash|dodge|feint|draw|parry|carefully|quietly|sense|begin|rub|sprinkle|stop|combine|take|decide|insert|lift|retreat|load|fumble|exhale|allow|have|are|wring|scan|vigorously|adjust|bundle|ask|form|lose|remove|accept|pick|silently|realize|open|grab|fade|offer|aren't|kneel|don\'t|close|let|find|attempt|tie|roll|attach|feel|read|reach|gingerly|come|count) .*(?:\.|\!|\?)?
     if matchre("$roomobjs", "large dark orb") || ("%Juggernaut.Orb" = "ON") then
          {
               echo #####################################
               echo *** JUGGERNAUT ORB DETECTED!! DISARMING!!
               echo #####################################
               pause 0.1
               send disarm orb
               pause 3
               pause
               var Juggernaut.Orb OFF
          }
     if (("%WEAPON_EXP" = "Brawling") && ($UC_WeakAttack)) then var ACTION punch
     if (("%WEAPON_EXP" = "Brawling") && (%ATTACKNUMBER = 1)) then var ACTION attack
     if (("%WEAPON_EXP" != "Brawling") && ($UC_WeakAttack)) then var ACTION feint
     if (("%WEAPON_EXP" != "Brawling") && ("$UC_WeaponType" != "BRAWL") && (%ATTACKNUMBER = 2)) then var ACTION jab
     if (("$guild" = "Barbarian") && ($UC_balance <= 5)) then
          {
               if (($UC_Whirlwind = 1) && ($stamina > 80)) then
                    {
                         if (($%WEAPON_EXP.Ranks >= 350) && !matchre("%WEAPON_EXP","^(Brawling|Slings|Bow|Crossbow)")) then var ACTION whirlwind
                    }
          }
     if (("$guild" = "Empath") && ($UC_ConstructOnly = 1)) then
          {
               if (matchre("%Empath.Critter", "%Construct") && (!$UC_WeakAttack)) then var ACTION attack %Attack.Critter
               if (matchre("%Empath.Critter", "%Construct") && ($UC_WeakAttack)) then var ACTION feint %Attack.Critter
               if (matchre("%Empath.Critter", "%Undead") && ($spellABSOLUTION = 1) && (!$UC_WeakAttack)) then var ACTION attack %Attack.Critter
               if (matchre("%Empath.Critter", "%Undead") && ($spellABSOLUTION = 1) && ($UC_WeakAttack) && ("%WEAPON_EXP" != "Brawling")) then var ACTION feint %Attack.Critter
               if !matchre("$monsterlist", "%Empath.Critter") && matchre("$monsterlist", "(%Construct)") then var Attack.Critter $1
               if (!matchre("$monsterlist", "%Empath.Critter") && matchre("$monsterlist", "(%Undead)") && (!$SpellTimer.Absolution.active = 1)) then var Attack.Critter $1
               if matchre("%critterList", "(?i)(%Construct|%Undead)") then var Empath.Critter $1
               eval Empath.Critter replacere("%Empath.Critter", "^(\S+ )(?=\S+ \S+)", "")
               eval Attack.Critter replacere("%Empath.Critter", "([\w'-]+\s){0,5}", "")
               if (matchre("%Empath.Critter", "%Undead") && (!$SpellTimer.Absolution.active = 1)) then goto ATTACK_RETURN
          }
     if (("$guild" = "Empath") && ($UC_ConstructOnly = 0)) then
          {
               if ($UC_WeakAttack = 1) then var ACTION feint
               if (($SpellTimer.IcutuZaharenela.active = 1) && (%ATTACKNUMBER = 3) && ($Empathy.LearningRate < 34)) then var ACTION touch
               if (($SpellTimer.IcutuZaharenela.active = 1) && (%ATTACKNUMBER = 5) && ($Empathy.LearningRate < 34)) then var ACTION touch
          }
     if (("$guild" = "Paladin") && (%ATTACKNUMBER > 3)) then
          {
               if (($UC_Smite = 1) && !matchre("$UC_WeaponType", "^(BRAWL|BOW|CROSSBOW|SLINGS)")) then
                    {
                         if (matchre("$righthand", "(?i)%WEAPON") && ($Conviction.LearningRate < 34)) then
                              {
                                   var ACTION smite
                                   put #var UC_Smite 0
                              }
                    }
          }
     send %ACTION
     matchwait 20
     # put #echo >Log Crimson  *** MISSING MATCH IN ATTACK! (ubercombat.cmd) ***
     put #log $datetime MISSING MATCH IN ATTACK (ubercombat.cmd)
     return
ATTACK_DEAD:
     var newdead 1
ATTACK_RETURN:
     var swapped 0
     return
LOST_WEAPON:
     if matchre("%WEAPON", "$charactername|NULL") then return
     if ("$guild" = "Empath") then gosub BRAWL_TOGGLE
     if (("%WEAPON_EXP" = "Brawling") || ("$UC_WeaponType" = "BRAWL")) then
          {
               math ATTACKNUMBER add 1
               var ACTION attack
               goto ATTACK_1
          }
     echo
     echo *** Where did our weapon go???
     echo *** Looking for it....
     echo
     gosub FEET_CHECK
     gosub stowing
     if ($UC_Ammo = 1) then gosub stowammo
     if (($UC_Bonded = 1) && (%ammolodged = 1)) then
          {
               pause 0.3
               pause 0.2
               send invoke
               pause 0.3
               pause 0.2
               if !matchre("$righthand $lefthand", "(?i)%WEAPON") then send invoke
               pause 0.3
               pause 0.1
               if matchre("$righthand $lefthand", "(?i)%WEAPON") then var ammolodged 0
          }
     if (!matchre("$righthand $lefthand", "(?i)%WEAPON") && !matchre("$UC_WeaponType","BRAWL")) then gosub WIELD %WEAPON
     if matchre("$righthandnoun $lefthandnoun", "\bfan\b") then gosub SWAPPABLE
     return
FLYING:
     echo
     echo *** FLYING MONSTER! Unable to attack! Retrying..
     echo
     if ($hidden = 1) then gosub UNHIDE
     pause 2
     goto ATTACK
FEINTLEFTEYE:
     delay 0.0001
     if ($stamina < 35) then gosub STAMINA_WAIT
     if (("$guild" = "Paladin") && ($hidden = 1)) then gosub UNHIDE
     if ($standing = 0) then gosub STAND
     var LOCATION FEINTLEFTEYE_1
     FEINTLEFTEYE_1:
     pause 0.00001
     if ((("$guild" = "Empath") && ($UC_ConstructOnly = 1)) || (%newdead)) then gosub ASSESS
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre CALMED ^Strangely\, you don\'t feel like fighting right now\.
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RETURN ^You (?:put|must|need|can|turn|aren't|stop|spin|drop|set|are|slip|carefully) .*\.
     matchre ASSESS ^There is nothing else to face
     matchre ASSESS ^At what are you trying to .*\?
     matchre RETURN ^Wouldn't it be better
     matchre FLYING flying too high for you to attack|flying far too high to hit
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     send feint left eye
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN FEINTLEFTEYE! (ubercombat.cmd) ***
     put #log $datetime MISSING MATCH IN FEINTLEFTEYE (ubercombat.cmd)
     goto FEINTLEFTEYE
BACKSTABING:
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then RETURN
     delay 0.0001
     #if ($stamina < 35) then gosub STAMINA_WAIT
     var LOCATION BACKSTAB_1
     if ($standing = 0) then gosub STAND
     if ($hidden = 0) then gosub hide
     pause 0.0001
     BACKSTAB_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre CALMED ^Strangely\, you don\'t feel like fighting right now\.
     matchre FEINTLEFTEYE It would help if you were closer to the .*\.
     matchre FEINTLEFTEYE ^You can\'t backstab that\.
     matchre FEINTLEFTEYE ^You can\'t blindside that\.
     matchre RETURN ^This type of weapon is entirely unsuitable
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RETURN ^You (?:put|must|need|can|turn|aren't|stop|spin|drop|set|are|slip|carefully) .*\.
     matchre RETURN ^There is nothing else to face
     matchre RETURN ^It's flying
     matchre RETURN ^At what are you trying to .*\?
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre ASSESS ^Backstab what\?|Face what\?
     matchre FLYING flying too high for you to attack|flying far too high to hit
     send backstab
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN BACKSTAB! (ubercombat.cmd) ***
     put #log $datetime MISSING MATCH IN BACKSTAB (ubercombat.cmd)
     return
BACKSTABING_LEFT:
     if (($monstercount = 0) && !matchre("$roomobjs", "(?i)%critters")) then RETURN
     delay 0.0001
     if ("$lefthand" = "Empty") then goto BACKSTABING
     #if ($stamina < 35) then gosub STAMINA_WAIT
     var LOCATION BACKSTABING_LEFT_1
     if ($standing = 0) then gosub STAND
     if ($hidden = 0) then gosub hide
     pause 0.0001
     BACKSTABING_LEFT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre CALMED ^Strangely\, you don\'t feel like fighting right now\.
     matchre FEINTLEFTEYE It would help if you were closer to the .*\.
     matchre FEINTLEFTEYE ^You can\'t backstab that\.
     matchre FEINTLEFTEYE ^You can\'t blindside that\.
     matchre RETURN ^This type of weapon is entirely unsuitable
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RETURN ^You (?:put|must|need|can|turn|aren't|stop|spin|drop|set|are|slip|carefully) .*\.
     matchre RETURN ^You\'ll need something
     matchre RETURN ^There is nothing else to face
     matchre RETURN ^It's flying
     matchre RETURN ^At what are you trying to .*\?
     matchre RETURN ^Sheathe what\?|^Please rephrase|^Sheathing|^What were
     matchre ASSESS ^Backstab what\?|Face what\?
     matchre FLYING flying too high for you to attack|flying far too high to hit
     matchre RETURN (Blindsiding|Backstabbing|Backstabing) is much more effective
     send backstab left
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN BACKSTAB_LEFT! (ubercombat.cmd) ***
     put #log $datetime MISSING MATCH IN BACKSTAB_LEFT (ubercombat.cmd)
     return
DRAW:
     delay 0.0001
     var LOCATION DRAW_1
     if (("$guild" = "Paladin") && ($hidden = 1)) then gosub UNHIDE
     if ($standing = 0) then gosub STAND
     if !matchre("%LeucroAction", "NULL") then gosub LEUCRO_ACTION
     DRAW_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RETURN ^There is nothing else to face
     matchre RETURN ^You (?:put|must|need|can|turn|aren't|stop|spin|drop|set|are|slip|carefully) .*\.
     matchre RETURN ^It's flying
     matchre RETURN ^At what are you trying to .*\?
     matchre RETURN ^Please rephrase|^Sheathing|^What were
     matchre FLYING flying too high for you to attack|flying far too high to hit
     send draw
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN DRAW! (ubercombat.cmd) ***
     put #log $datetime MISSING MATCH IN DRAW (ubercombat.cmd)
     goto DRAW
FEINT:
     delay 0.0001
     pause 0.0001
     if (("$guild" = "Paladin") && ($hidden = 1)) then gosub UNHIDE
     if ($stamina < 35) then gosub STAMINA_WAIT
     if ($standing = 0) then gosub STAND
     var LOCATION FEINT_1
     FEINT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre CALMED ^Strangely\, you don\'t feel like fighting right now\.
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RETURN ^There is nothing else to face
     matchre RETURN ^You (?:put|must|need|can|turn|aren't|stop|spin|drop|set|are|slip|carefully) .*\.
     matchre RETURN ^It's flying
     matchre RETURN ^At what are you trying to .*\?
     matchre RETURN You're
     matchre RETURN ^Please rephrase|^Sheathing|^What were
     matchre FLYING flying too high for you to attack|flying far too high to hit
     if (("$guild" = "Empath") && ($UC_ConstructOnly = 1)) then
          {
               if matchre("%Empath.Critter", "%Construct") then send feint %Attack.Critter
               if (matchre("%Empath.Critter", "%Undead") && ($SpellTimer.Absolution.active)) then send feint %Attack.Critter
               return
          }
     send feint
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN FEINT! (ubercombat.cmd) ***
     put #log $datetime MISSING MATCH IN FEINT (ubercombat.cmd)
     goto FEINT
CHOP:
     delay 0.0001
     var LOCATION CHOP_1
     if (("$guild" = "Paladin") && ($hidden = 1)) then gosub UNHIDE
     if ($standing = 0) then gosub STAND
     CHOP_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre CALMED ^Strangely\, you don\'t feel like fighting right now\.
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RETURN ^There is nothing else to face
     matchre RETURN ^You (?:put|must|need|can|turn|aren't|stop|spin|drop|set|are|slip|carefully) .*\.
     matchre RETURN ^It's flying
     matchre RETURN ^At what are you trying to .*\?
     matchre RETURN You're
     matchre RETURN ^Please rephrase|^Sheathing|^What were
     matchre FLYING flying too high for you to attack|flying far too high to hit
     send chop
     matchwait 20
     put #echo >Log Crimson  *** MISSING MATCH IN CHOP! (ubercombat.cmd) ***
     put #log $datetime MISSING MATCH IN CHOP (ubercombat.cmd)
     goto DRAW
#### DODGE AND PARRY
DODGE:
     delay 0.0001
     var LOCATION DODGE_1
     if ($standing = 0) then gosub STAND
     DODGE_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^Please rephrase|^Sheathing|^What were
     matchre RETURN ^But you are already dodging\!
     matchre RETURN ^You move into a position to dodge\.
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     # matchre DODGE ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     send dodge
     matchwait 10
     return
PARRY:
     delay 0.0001
     var LOCATION PARRY_1
     if ($standing = 0) then gosub STAND
     PARRY_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^Please rephrase|^Sheathing|^What were
     matchre RETURN ^You are already in a position to parry\.
     matchre RETURN ^You move into a position to parry\.
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     # matchre PARRY ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     send parry
     matchwait 10
     return
FORAGE_RETREAT:
     pause 0.1
     gosub RETREAT
     goto FORAGE_1
FORAGE:
     delay 0.0001
     var forage $0
     var LOCATION FORAGE_1
     FORAGE_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre FORAGE_RETREAT ^You cannot forage while in combat\!
     matchre RETURN ^Please rephrase|^Sheathing|^What were
     matchre RETURN ^You manage to find .*\.
     matchre RETURN ^The room is too cluttered to find anything here\!
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     send forage %forage
     matchwait 10
     return
### ORDERING SUB, FOR SHOPS
ORDER:
     delay 0.0001
     var order $0
     var LOCATION ORDER_1
     gosub stowing
     ORDER_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WEBBED ^You can't do that while entangled in a web
     matchre STUNNED ^You are still stunned
     matchre ORDER_1 ^The attendant says\,\s*\"You can purchase .*\.\s*Just order it again and we'll see it done\!\"
     matchre RETURN ^Please rephrase|^Sheathing|^What were
     matchre RETURN ^The attendant takes some coins from you and hands you .*\.
     send order %order
     matchwait 20
     put #echo >$Log Crimson $datetime *** MISSING MATCH IN ORDER! (ubercombat.inc) ***
     put #echo >$Log Crimson $datetime Order = %order
     put #log $datetime MISSING MATCH IN ORDER! (ubercombat.inc)
     return
### COLLECT ROUTINE
COLLECT_STOP:
     put stop play
     pause 0.3
     goto COLLECT_1
COLLECT:
     delay 0.0001
     var Collect $0
     var LOCATION COLLECT_1
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.1
     if ($standing = 0) then gosub STAND
     if matchre("$roomobjs", "origami|an Imperial dira|glass reservoir|steel striker|black cube|tiny chitinous leg|coiled spring|brown clay|bloated animal bladder|sharp blade|tiny hammer|sealed vial|stoppered vial|iron disc|metal spring|tiny metal lever|broken needle|short needle|short curved blade|silver studs|thin metal circle|steel pin|broken rune|runestone|bronze seal|glass sphere|tiny bronze face|cracked black crystal|capillary tube|some junk") then gosub DUMP_CHECK
     COLLECT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre COLLECT_STOP ^You are a bit too busy
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^Please rephrase|^Sheathing|^What were
     matchre RETURN ^You cannot collect anything while in combat\!
     matchre RETURN ^You manage to collect a pile of .*\.
     matchre RETURN ^You really need to have
     matchre RETURN ^The room is too cluttered to find anything here\!
     matchre RETURN ^You survey the area and realize that any collecting efforts would be futile\.
     matchre RETURN ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     send collect %Collect
     matchwait 20
     return
KICKEM:
KICK_PILE:
     delay 0.0001
     if ($standing = 0) then gosub STAND
     if matchre("$roomobjs" , "a pile of \S+") then gosub KICKIT
     if matchre("$roomobjs" , "a pile of \S+") then gosub KICKIT
     if matchre("$roomobjs" , "a pile of \S+") then gosub KICKIT
     if ($standing = 0) then gosub STAND
     return
KICKIT:
     delay 0.0001
     var LOCATION KICKIT_1
     if ($standing = 0) then gosub STAND
     KICKIT_1:
     matchre WAIT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre RETURN ^Please rephrase|^Sheathing|^What were
     matchre RETURN ^I could not find what you were referring to\.
     matchre RETURN ^You take a step back and run up to the pile of .*\.
     send kick pile
     matchwait 20
     return
####################################################
TIME_CHECK:
     echo
     echo **** TIME CHECK ****
     echo
     matchre TIME_CHECK ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre NIGHT_TIME early evening|mid-evening|late evening|evening|midnight|night|dawn|sunset|approaching sunrise|sunrise|you can't tell|believe it is
     matchre DAY_TIME early morning|mid-morning|midday|late morning|noon|early afternoon|mid-afternoon|late afternoon
     matchre ALMOST_NIGHT dusk
     send time
     matchwait 10
     goto NIGHT_TIME
TIME_CHECK_2:
     pause 0.0001
     pause 0.0001
     goto TIME_CHECK
DAY_TIME:
     var TIME DAY
     put #var Time.isDay 1
     echo ###########
     echo *** DAY TIME
     echo ###########
     echo
     var Skip.Repair 0
     return
ALMOST_NIGHT:
     var TIME DAY
     put #var Time.isDay 1
     echo ##############
     echo *** ALMOST NIGHT
     echo ##############
     echo
     var Skip.Repair 1
     return
NIGHT_TIME:
     var TIME NIGHT
     put #var Time.isDay 0
     var Skip.Repair 1
     echo ############
     echo *** NIGHT TIME
     echo ############
     echo
     return
####################################################
PREMIUM_CHECK:
     pause 0.0001
     matchre PREMIUM_CHECK ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre PREMIUM_NO ^You are not currently a Premium
     matchre PREMIUM_YES ^Your premium service has been continuous
     matchre PRETRAININGLOOP ^You need to concentrate
     put ltb info
     matchwait 20
     goto PREMIUM_NO
PREMIUM_NO:
     put #var UC_Premium 0
     return
PREMIUM_YES:
     put #var UC_Premium 1
     echo *** PREMIUM ACCOUNT ENABLED
     return
#############################################
# MONEY EXCHANGE
#############################################
LIRUM:
LIRUMS:
     if ($invisible = 1) then gosub STOP_INVIS
     var Target.Currency LIRUMS
     gosub EXCHANGE KRONARS
     gosub EXCHANGE DOKORAS
     goto EXCHANGE.FINISH
KRONAR:
KRONARS:
     if ($invisible = 1) then gosub STOP_INVIS
     var Target.Currency KRONARS
     gosub EXCHANGE LIRUMS
     gosub EXCHANGE DOKORAS
     goto EXCHANGE.FINISH
DOKORA:
DOKORAS:
     if ($invisible = 1) then gosub STOP_INVIS
     var Target.Currency DOKORAS
     gosub EXCHANGE KRONARS
     gosub EXCHANGE LIRUMS
     goto EXCHANGE.FINISH
EXCHANGE.INVIS:
     pause 0.1
     gosub STOP_INVIS
     pause 0.1
     goto EXCHANGE.CONTINUE
EXCHANGE:
     var Coin $0
EXCHANGE.CONTINUE:
     if ($invisible = 1) then gosub STOP_INVIS
     pause 0.00001
     matchre EXCHANGE.INVIS ^How can you .* when you can't be seen\?
     matchre EXCHANGE.CONTINUE ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre RETURN Enjoy the holiday, friend\!
     matchre RETURN ^You hand your money to the money-changer\.\s*After collecting a.* fee, .* hands you .*\.
     matchre RETURN ^The money-changer says crossly, \"A transaction that small isn't worth my time\.\s*The minimum is one bronze or ten coppers\.\"
     matchre RETURN ^You count out all of your .* and drop them in the proper jar\.\s*After figuring a .* fee in the ledger beside the jar\, you reach into the one filled with .* and withdraw .*\.
     matchre RETURN ^One of the guards mutters\, \"None of that\, $charactername\.\s*You'd be lucky to get anything at all with an exchange that small\.\"
     matchre RETURN ^But you don't have any .*\.
     matchre RETURN ^As you speak up to use the facilities\, the clerk scowls at you\.\s+\"We don\'t serve necromancers or sorcerers here\.\s+Leave\, now\, before I call the guards\.\"
     matchre EXCHANGE.SMALLER transactions larger than a thousand
     matchre EXCHANGE.FINISH ^There is no money-changer here\.
     put EXCHANGE ALL %Coin FOR %Target.Currency
     matchwait 20
     return
EXCHANGE.SMALLER:
     pause 0.00001
     pause 0.00001
     pause 0.00001
     matchre EXCHANGE.SMALLER ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre EXCHANGE.SMALLER ^You hand your .* to the money-changer\.\s*After collecting a.* fee, .* hands you .*\.
     matchre RETURN ^The money-changer says crossly, \"A transaction that small isn't worth my time\.\s*The minimum is one bronze or ten coppers\.\"
     matchre RETURN ^One of the guards mutters\, \"None of that\, $charactername\.\s*You'd be lucky to get anything at all with an exchange that small\.\"
     matchre RETURN ^As you speak up to use the facilities\, the clerk scowls at you\.\s+\"We don\'t serve necromancers or sorcerers here\.\s+Leave\, now\, before I call the guards\.\"
     matchre EXCHANGE.CONTINUE Enjoy the holiday, friend\!
     matchre EXCHANGE.CONTINUE ^You count out all of your .* and drop them in the proper jar\.\s*After figuring a .* fee in the ledger beside the jar\, you reach into the one filled with .* and withdraw .*\.
     matchre EXCHANGE.CONTINUE ^But you don't have any .*\.
     matchre EXCHANGE.CONTINUE ^You don't have that many
     matchre EXCHANGE.FINISH ^There is no money-changer here\.
     put EXCHANGE 1000 plat %Coin FOR %Target.Currency
     matchwait 20
     return
EXCHANGE.FINISH:
     put #parse EXCHANGE DONE!
     return
################################################################################
# SONG PERFORMANCE ASSESSMENT
PERFORMANCE:
     if ($Performance.Ranks < 39) then put #var SONG SCALES
     if ($Performance.Ranks >= 39) && ($Performance.Ranks < 49) then put #var SONG ARPEGGIOS
     if ($Performance.Ranks >= 49) && ($Performance.Ranks < 58) then put #var SONG DITTY
     if ($Performance.Ranks >= 58) && ($Performance.Ranks < 69) then put #var SONG BALLAD
     if ($Performance.Ranks >= 69) && ($Performance.Ranks < 79) then put #var SONG WALTZ
     if ($Performance.Ranks >= 79) && ($Performance.Ranks < 99) then put #var SONG MARCH
     if ($Performance.Ranks >= 99) && ($Performance.Ranks < 115) then put #var SONG JIG
     if ($Performance.Ranks >= 115) && ($Performance.Ranks < 125) then put #var SONG LAMENT
     if ($Performance.Ranks >= 125) && ($Performance.Ranks < 179) then put #var SONG HYMN
     if ($Performance.Ranks >= 179) && ($Performance.Ranks < 219) then put #var SONG POLKA
     if ($Performance.Ranks >= 219) && ($Performance.Ranks < 249) then put #var SONG REEL
     if ($Performance.Ranks >= 249) && ($Performance.Ranks < 299) then put #var SONG SERENADE
     if ($Performance.Ranks >= 299) && ($Performance.Ranks < 349) then put #var SONG PSALM
     if ($Performance.Ranks >= 349) && ($Performance.Ranks < 449) then put #var SONG TANGO
     if ($Performance.Ranks >= 449) && ($Performance.Ranks < 474) then put #var SONG BOLERO
     if ($Performance.Ranks >= 474) && ($Performance.Ranks < 524) then put #var SONG NOCTURNE
     if ($Performance.Ranks >= 524) && ($Performance.Ranks < 549) then put #var SONG REQUIEM
     if ($Performance.Ranks >= 549) then put #var SONG CONCERTO
     return
PERFORMANCE_COWBELL:
     if ($Performance.Ranks < 200) then put #var SONG SCALES OFF
     if ($Performance.Ranks >= 200) && ($Performance.Ranks < 220) then put #var SONG ARPEGGIOS
     if ($Performance.Ranks >= 200) && ($Performance.Ranks < 215) then put #var SONG DITTY
     if ($Performance.Ranks >= 215) && ($Performance.Ranks < 225) then put #var SONG BALLAD
     if ($Performance.Ranks >= 225) && ($Performance.Ranks < 235) then put #var SONG WALTZ
     if ($Performance.Ranks >= 235) && ($Performance.Ranks < 250) then put #var SONG MARCH
     if ($Performance.Ranks >= 250) && ($Performance.Ranks < 300) then put #var SONG JIG
     if ($Performance.Ranks >= 300) && ($Performance.Ranks < 375) then put #var SONG LAMENT
     if ($Performance.Ranks >= 375) && ($Performance.Ranks < 420) then put #var SONG HYMN
     if ($Performance.Ranks >= 420) && ($Performance.Ranks < 479) then put #var SONG POLKA
     if ($Performance.Ranks >= 479) && ($Performance.Ranks < 500) then put #var SONG REEL
     if ($Performance.Ranks >= 500) && ($Performance.Ranks < 550) then put #var SONG SERENADE
     if ($Performance.Ranks >= 550) && ($Performance.Ranks < 620) then put #var SONG PSALM
     if ($Performance.Ranks >= 620) && ($Performance.Ranks < 680) then put #var SONG TANGO
     if ($Performance.Ranks >= 680) && ($Performance.Ranks < 750) then put #var SONG BOLERO
     if ($Performance.Ranks >= 750) && ($Performance.Ranks < 850) then put #var SONG NOCTURNE
     if ($Performance.Ranks >= 850) && ($Performance.Ranks < 900) then put #var SONG REQUIEM
     if ($Performance.Ranks >= 900) && ($Performance.Ranks < 1000) then put #var SONG CONCERTO
     if ($Performance.Ranks >= 1000) then put #var SONG CONCERTO MASTER
     return
     ### OLD PERFORMANCE
     if ($Performance.Ranks < 22) then put #var SONG SCALES OFF-KEY
     if ($Performance.Ranks >= 22) && ($Performance.Ranks < 29) then put #var SONG ARPEGGIOS
     if ($Performance.Ranks >= 29) && ($Performance.Ranks < 36) then put #var SONG DITTY
     if ($Performance.Ranks >= 36) && ($Performance.Ranks < 43) then put #var SONG FOLK
     if ($Performance.Ranks >= 43) && ($Performance.Ranks < 50) then put #var SONG BALLAD
     if ($Performance.Ranks >= 50) && ($Performance.Ranks < 59) then put #var SONG WALTZ
     if ($Performance.Ranks >= 59) && ($Performance.Ranks < 63) then put #var SONG LULLABY
     if ($Performance.Ranks >= 63) && ($Performance.Ranks < 76) then put #var SONG MARCH
     if ($Performance.Ranks >= 76) && ($Performance.Ranks < 90) then put #var SONG JIG
     if ($Performance.Ranks >= 90) && ($Performance.Ranks < 103) then put #var SONG LAMENT
     if ($Performance.Ranks >= 103) && ($Performance.Ranks < 117) then put #var SONG WEDDING
     if ($Performance.Ranks >= 117) && ($Performance.Ranks < 137) then put #var SONG HYMN
     if ($Performance.Ranks >= 137) && ($Performance.Ranks < 156) then put #var SONG RUMBA
     if ($Performance.Ranks >= 156) && ($Performance.Ranks < 175) then put #var SONG POLKA
     if ($Performance.Ranks >= 175) && ($Performance.Ranks < 192) then put #var SONG BATTLE
     if ($Performance.Ranks >= 192) && ($Performance.Ranks < 210) then put #var SONG REEL
     if ($Performance.Ranks >= 210) && ($Performance.Ranks < 229) then put #var SONG ELEGY
     if ($Performance.Ranks >= 229) && ($Performance.Ranks < 248) then put #var SONG SERENADE
     if ($Performance.Ranks >= 248) && ($Performance.Ranks < 270) then put #var SONG MINUET
     if ($Performance.Ranks >= 270) && ($Performance.Ranks < 325) then put #var SONG PSALM
     if ($Performance.Ranks >= 325) && ($Performance.Ranks < 358) then put #var SONG DIRGE
     if ($Performance.Ranks >= 358) && ($Performance.Ranks < 380) then put #var SONG GAVOTTE
     if ($Performance.Ranks >= 380) && ($Performance.Ranks < 410) then put #var SONG TANGO
     if ($Performance.Ranks >= 410) && ($Performance.Ranks < 460) then put #var SONG TARANTELLA
     if ($Performance.Ranks >= 460) && ($Performance.Ranks < 490) then put #var SONG BOLERO
     if ($Performance.Ranks >= 490) && ($Performance.Ranks < 540) then put #var SONG NOCTURNE
     if ($Performance.Ranks >= 540) && ($Performance.Ranks < 600) then put #var SONG REQUIEM
     if ($Performance.Ranks >= 600) && ($Performance.Ranks < 654) then put #var SONG FANTASIA
     if ($Performance.Ranks >= 654) && ($Performance.Ranks < 720) then put #var SONG RONDO
     if ($Performance.Ranks >= 720) && ($Performance.Ranks < 800) then put #var SONG SONATA
     if ($Performance.Ranks >= 800) then put #var SONG CONCERTO
     return
ATHLETICS_SONG:
     var song0 SCALES OFF
     var song1 SCALES
     var song2 ARPEGGIOS
     var song3 DITTY
     var song4 FOLK
     var song5 BALLAD
     var song6 WALTZ
     var song7 LULLABY
     var song8 JIG
     var song9 MARCH
     var song10 LAMENT
     var song11 HYMN
     var song12 RUMBA
     var song13 POLKA
     var song14 BATTLE
     var song15 REEL
     var song16 SERENADE
     var song17 MINUET
     var song18 PSALM
     var song19 DIRGE
     var song20 TANGO
     var song21 TARANTELLA
     var song22 BOLERO
     var song23 NOCTURNE
     var song24 REQUIEM
     var song25 FANTASIA
     var song26 RONDO
     var song27 ARIA
     var song28 SONATA
     var song29 CONCERTO
     var song30 CONCERTO MASTER
     if ($Athletics.Ranks <= 15) then put #var SONG SCALES OFF
     if (($Athletics.Ranks > 15) && ($Athletics.Ranks <= 22)) then put #var SONG SCALES
     if (($Athletics.Ranks > 22) && ($Athletics.Ranks <= 27)) then put #var SONG ARPEGGIOS
     if (($Athletics.Ranks > 27) && ($Athletics.Ranks <= 34)) then put #var SONG FOLK
     if (($Athletics.Ranks > 34) && ($Athletics.Ranks <= 45)) then put #var SONG WALTZ
     if (($Athletics.Ranks > 45) && ($Athletics.Ranks <= 80)) then put #var SONG LULLABY
     if (($Athletics.Ranks > 80) && ($Athletics.Ranks <= 90)) then put #var SONG MARCH
     if (($Athletics.Ranks > 90) && ($Athletics.Ranks <= 100)) then put #var SONG LAMENT
     if (($Athletics.Ranks > 100) && ($Athletics.Ranks <= 110)) then put #var SONG WEDDING
     if (($Athletics.Ranks > 110) && ($Athletics.Ranks <= 122)) then put #var SONG HYMN
     if (($Athletics.Ranks > 122) && ($Athletics.Ranks <= 150)) then put #var SONG RUMBA
     if (($Athletics.Ranks > 150) && ($Athletics.Ranks <= 180)) then put #var SONG POLKA
     if (($Athletics.Ranks > 180) && ($Athletics.Ranks <= 220)) then put #var SONG BATTLE
     if (($Athletics.Ranks > 220) && ($Athletics.Ranks <= 250)) then put #var SONG REEL
     if (($Athletics.Ranks > 250) && ($Athletics.Ranks <= 260)) then put #var SONG ELEGY
     if (($Athletics.Ranks > 260) && ($Athletics.Ranks <= 275)) then put #var SONG SERENADE
     if (($Athletics.Ranks > 275) && ($Athletics.Ranks <= 300)) then put #var SONG PSALM
     if (($Athletics.Ranks > 300) && ($Athletics.Ranks <= 320)) then put #var SONG DIRGE
     if (($Athletics.Ranks > 320) && ($Athletics.Ranks <= 350)) then put #var SONG TARANTELLA
     if (($Athletics.Ranks > 350) && ($Athletics.Ranks <= 380)) then put #var SONG BOLERO
     if (($Athletics.Ranks > 450) && ($Athletics.Ranks <= 475)) then put #var SONG BOLERO CONFIDENT
     if (($Athletics.Ranks > 475) && ($Athletics.Ranks <= 525)) then put #var SONG NOCTURNE
     if (($Athletics.Ranks > 525) && ($Athletics.Ranks <= 550)) then put #var SONG REQUIEM
     if (($Athletics.Ranks > 550) && ($Athletics.Ranks <= 650)) then put #var SONG FANTASIA
     if (($Athletics.Ranks > 650) && ($Athletics.Ranks <= 780)) then put #var SONG RONDO
     if (($Athletics.Ranks > 780) && ($Athletics.Ranks <= 850)) then put #var SONG ARIA
     if (($Athletics.Ranks > 850) && ($Athletics.Ranks <= 950) then put #var SONG SONATA
     if (($Athletics.Ranks > 950) && ($Athletics.Ranks <= 1200) then put #var SONG CONCERTO
     if ($Athletics.Ranks > 1200) then put #var SONG CONCERTO MASTER
     return
###########################################################################
#### TEXT TO NUMBER JS LOGIC (Thanks to Timbits!)
TEXT_TO_NUMBER:
   var number_as_string $0

   <%
      var map = {
         'zero': 0,
         'one': 1,
         'two': 2,
         'three': 3,
         'four': 4,
         'five': 5,
         'six': 6,
         'seven': 7,
         'eight': 8,
         'nine': 9,
         'ten': 10,
         'eleven': 11,
         'twelve': 12,
         'thirteen': 13,
         'fourteen': 14,
         'fifteen': 15,
         'sixteen': 16,
         'seventeen': 17,
         'eighteen': 18,
         'nineteen': 19,
         'twenty': 20,
         'thirty': 30,
         'forty': 40,
         'fifty': 50,
         'sixty': 60,
         'seventy': 70,
         'eighty': 80,
         'ninety': 90
      };

      var magnitude_map = {
         'thousand':     1000,
         'million':      1000000,
         'billion':      1000000000,
         'trillion':     1000000000000,
         'quadrillion':  1000000000000000,
         'quintillion':  1000000000000000000,
         'sextillion':   1000000000000000000000,
         'septillion':   1000000000000000000000000,
         'octillion':    1000000000000000000000000000,
         'nonillion':    1000000000000000000000000000000,
         'decillion':    1000000000000000000000000000000000
      };

      function textToNumber() {
         var numberAsString = getVar("number_as_string");
         var numberParts = numberAsString.toString().split(/[\s-]+/);
         var number = 0;
         var scale = 0;

         for(var i = 0; i < numberParts.length; i++) {
            var numberFromMap = map[numberParts[i]];
            if (numberFromMap !== undefined) {
               number += numberFromMap;
            } else if (numberParts[i] == "hundred") {
               number *= 100;
            } else {
               magnitude = magnitude_map[numberParts[i]];
               if (magnitude != null) {
                  scale = scale + (number * magnitude);
                  number = 0;
               }
            }
         }

         setVar("text_to_number", number + scale);
      }

      textToNumber();
   %>
   echo Received text string: %number_as_string, numeric value is: %text_to_number
   return
##################################################################################################################
### END OF MAIN GOSUB ENGINE
##################################################################################################################

############################################################################################################################################################################################################
############################################################################################################################################################################################################
####################################################################
### ESCAPING SECTION / ESCAPE MODULE / TOWN RUN
####################################################################
############################################################################################################################################################################################################
############################################################################################################################################################################################################
BACKFIRE_ESCAPE:
ESCAPE_BACKFIRE:
     action (escape) off
     gosub HEALTH_CHECK
     if (($needHealing = 0) && (%Incombat = 1)) then
          {
               echo ** BACKFIRE FALSE ALARM? NO HEALING NEEDED
               echo ** Returning to Combat
               var backfirecount 0
               goto TrainLoop2
          }
     gosub clear
     echo
     echo ##################################
     echo **** BACKFIRED TOO MUCH! GOING TO GET HEALED!
     echo ##################################
     echo
     var backfirecount 0
     put #echo >Log #ff4da6 **** TOO MANY BACKFIRES! GOING TO GET HEALED
     var LOCATION ESCAPE_REAL
     goto ESCAPE_REAL
ESCAPE:
     action (escape) off
     gosub clear
     echo
     echo ##################################
     echo **** TOO HURT! ATTEMPTING TO ESCAPE...
     echo ##################################
     echo
     put #echo >Log #ff4da6 **** ESCAPING COMBAT! TOO HURT!
     pause 0.0001
     gosub retreat
     var LOCATION ESCAPE_REAL
     goto ESCAPE_REAL
ESCAPE_SHIELD:
     action (escape) off
     var escaping ON
     gosub clear
     gosub retreat
     var LOCATION ESCAPE_REAL
     var TicketCheck 1
     pause 0.0001
     echo
     echo ##################################
     echo *** SHIELD MISSING!!
     echo *** ESCAPING TO CHECK FOR TICKETS
     echo ##################################
     echo
     put #echo >Log #ff4da6 **** ESCAPING COMBAT! MISSING SHIELD!!
     goto ESCAPE_REAL
ESCAPE_AMMO:
     action (escape) off
     var escaping ON
     gosub clear
     echo
     echo #################
     echo **** RAN OUT OF AMMO!
     echo #################
     echo
     put #echo >Log #ff0000 *** RAN OUT OF AMMO! RESTOCKING ON NEXT TOWN RUN
     put #parse OUT.OF.AMMO!
     var AmmoRestock 1
     goto ESCAPE_REAL
#######################################
ESCAPE_NOROOMS:
     ### HUNTING GROUND FULL
     action (escape) off
     gosub clear
     gosub retreat
     gosub stowing
     var LOCATION ESCAPE_REAL
     pause 0.0001
     echo
     echo ################
     echo **** ESCAPING COMBAT!
     echo **** NO OPEN HUNTING ROOMS!
     echo ################
     echo
     put #echo >Log #ff4da6 *** NO FREE HUNTING ROOMS @ %COMBAT.CRITTER
     gosub FEET_CHECK
     ###################################
     ### ESCAPE FROM COMBAT ZONE TO TOWN
     #### ESCAPE TO NEAREST CITY
     var GOSUBBING ON
     var escaping ON
     gosub ESCAPE_NOW
     var GOSUBBING OFF
     #### DONE ESCAPING TO CITY
     ##################################
     if !matchre("$UC_alternateCritter", "(?i)\b(NULL|OFF|0|^%|^\s*$)") then goto FIND_CRITTER_ALTERNATE
     goto HEALINGRUN
#######################################
ESCAPE_HEAL:
ESCAPE.HEAL:
     put #queue clear
     gosub clear
     action (escape) off
     var escaping ON
     var LOCATION ESCAPE_REAL
     echo
     echo ########################
     echo *** TOO HURT!!!
     echo *** ESCAPING COMBAT TO HEALING!
     echo #######################
     echo
     put #echo >Log #45C0FD *** TOO HURT!!! RUNNING TO GET HEALED!!!
     pause 0.0001
     goto ESCAPE_REAL
ESCAPE.TIMER:
TIME.CALC:
     action (escape) off
     var escaping ON
     var LOCATION ESCAPE_REAL
     echo
     echo ##################
     echo **** COMBAT TIMER COMPLETE!
     echo ##################
     echo
     put #echo >Log #45C0FD **** COMBAT TIMEOUT! MAX COMBAT TIME EXCEEDED! ( $UC_Combat.Last )
     pause 0.0001
     goto ESCAPE_REAL
ESCAPE.SKINS:
ESCAPE_SKINS:
     action (escape) off
     var escaping ON
     var LOCATION ESCAPE_REAL
     echo
     echo ###########################
     echo *** ESCAPING COMBAT!
     echo *** BUNDLE COUNT OVER MAX! SELLING SKINS!
     echo ###########################
     echo
     put #parse GO SELL SKINS!
     put #parse GO.SELL.SKINS!
     put #echo >Log #cc00ff **** ESCAPING COMBAT! BUNDLES FULL - SELLING SKINS!
     pause 0.0001
     goto ESCAPE_REAL
ESCAPE.BAGS:
ESCAPE_BAGS:
     action (escape) off
     var escaping ON
     var LAST ESCAPE.BAGS
     var LOCATION ESCAPE_REAL
     action (inventory) off
     put #var UC_bagsFull 1
     echo
     echo ########################
     echo *** ESCAPING COMBAT!
     echo *** BAGS TOO FULL!
     echo *** SELLING SKINS/GEMS/PICKING BOXES!
     echo ########################
     echo
     put #parse BAGS TOO FULL!
     put #echo >Log #ff4da6 **** ESCAPING COMBAT! - BAGS TOO FULL - Sell skins/pick boxes!
     pause 0.0001
     goto ESCAPE_REAL
ESCAPE.SHUTDOWN:
ESCAPE.SHUTDOWN.INSTANT:
     action (escape) off
     var escaping ON
     var LOCATION ESCAPE.SHUTDOWN
     echo
     echo ##################################
     echo *** WARNING! DR IS SHUTTING DOWN FOR MAINTENANCE
     echo *** COLLECTING WEAPONS AND ESCAPING!
     echo ##################################
     echo
     pause 0.2
     put #echo >Log #ff0000 **** ESCAPING COMBAT! - DR IS GOING DOWN FOR MAINTENANCE!
     pause 0.0001
     goto ESCAPE_REAL
ESCAPE_EMPATH:
     action (escape) off
     var escaping ON
     echo
     echo ##################################
     echo **** EMPATHY AT 0! ESCAPING TO TOWN RUN
     echo ##################################
     echo
     put #echo >Log #ff99bb **** ESCAPING COMBAT - EMPATHY AT 0
     pause 0.0001
     goto ESCAPE_REAL
BURDEN_HIGH:
     action (escape) off
     var escaping ON
     echo
     echo #############################
     echo **** BURDEN IS TOO HIGH! ESCAPING!
     echo #############################
     echo
     put #parse BURDEN TOO HIGH!
     put #parse BURDEN.TOO.HIGH!
     put #echo >Log #ff99bb **** ESCAPING COMBAT - BURDEN TOO HIGH!
     pause 0.0001
     goto ESCAPE_REAL
USER_ESCAPE:
     action (escape) off
     var escaping ON
     gosub clear
     echo
     echo #############################
     echo ** USER INITIATED TOWN RUN ROUTINE!
     echo ** PERFORMING A TOWN RUN ~~
     echo #############################
     echo
     put #echo >Log #ffff66 *** USER INITIATED ESCAPE ROUTINE! GOING ON TOWN RUN!
     pause 0.0001
     goto ESCAPE_REAL
F2P_ESCAPE:
     var escaping ON
     echo
     echo #############################
     echo * INVENTORY COUNT TOO HIGH!
     echo * RECEIVED %invcount INVENTORY COUNT WARNINGS
     echo * ESCAPING COMBAT TO CLEAR BAGS
     echo #############################
     echo
     put #echo >Log #e600e6 *** INVENTORY COUNT TOO HIGH!! ESCAPING COMBAT TO CLEAR BAGS
     var invcount 0
     pause 0.0001
     goto ESCAPE_REAL
ESCAPE_DC:
     action (escape) off
     gosub clear
     var escaping ON
     var LOCATION ESCAPE_REAL
     put #var UC_Combat.Time $gametime
     pause 0.0001
     echo
     echo ####################
     echo ** GOT DISCONNECTED!!
     echo ** RESTARTING FROM WHERE WE WERE LAST:
     echo ** %LAST
     echo ####################
     echo
     pause
     pause 0.001
     goto %LAST
     put #echo >Log #e600e6 **** DCed! ESCAPING TO TOWN!
     if (%InCombat = 1) then goto ESCAPE_REAL
     goto ESCAPE_REAL_2
ESCAPE_STARTLED:
     action (escape) off
     gosub clear
     var escaping ON
     var LOCATION ESCAPE_REAL
     pause 0.0001
     echo
     echo ##################################
     echo ** ESCAPING COMBAT -
     echo ** SOMEONE TALKED IN OUR ROOM OR TRIGGERED PVP TRIGGERS
     echo ** ESCAPING COMBAT FOR SAFETY
     echo ** TURN VAR NO.CONTACT OFF TO AVOID THIS
     echo ##################################
     echo
     pause 0.5
     goto ESCAPE_REAL
ESCAPE_REAL:
     put #mapper reset
     action (inventory) off
     if (%ammolodged) then gosub AMMO_CLEANUP
     if (($roomid = 0) && !matchre(%roomname, "(Clover Fields|Trackless Swamp|Velaka Desert|The Marsh|Fangs of Ushnish)")) then gosub RANDOMMOVE
ESCAPE_REAL_2:
     var LOCATION ESCAPE_REAL_2
     var InCombat 0
     action (inventory) off
     action (escape) off
     gosub clear
     gosub CLEAR_MATCHTABLE
     gosub STANCE_SET_EVASION
     if (%Backtraining = 0) then var Backtrained 0
     if (%Backtraining = 1) then var Backtrained 1
     if ("$roomname" = "The Marsh, In The Water") then var COMBAT.ROOM 10
     if ("$zoneid" = "150") then var hometown FANG
ESCAPING_NOW:
TOWN_RUN:
ESCAPE_NOW:
     ### ESCAPING PREP LOGIC
     var lastmoved NULL
     var LAST ESCAPE_NOW
     var LOCATION ESCAPE_NOW
     put #parse ESCAPING!
     if matchre("$scriptlist" , "disarm\.cmd") then put #script abort disarm
     if matchre("$scriptlist" , "armor\.cmd") then put #script abort armor
     if matchre("$scriptlist" , "braid\.cmd") then put #script abort braid
     if matchre("$scriptlist" , "climbcross\.cmd") then put #script abort climbcross
     if matchre("$scriptlist" , "steal\.cmd") then put #script abort steal
     if matchre("$scriptlist" , "climb\.cmd") then put #script abort climb
     if matchre("$scriptlist" , "automapper\.cmd") then put #script abort automapper
     if matchre("$scriptlist" , "burgle\.cmd") then put #script abort burgle
     if matchre("$scriptlist" , "travel\.cmd") then put #script abort travel
     if matchre("$scriptlist" , "mastercraft\.cmd") then put #script abort mastercraft
     if matchre("$scriptlist" , "MC_Carve\.cmd") then put #script abort MC_Carve
     if matchre("$scriptlist" , "MC_Enchant\.cmd") then put #script abort MC_Enchant
     if matchre("$scriptlist" , "MC_Grind\.cmd") then put #script abort MC_Grind
     if matchre("$scriptlist" , "MC_Knit\.cmd") then put #script abort MC_Knit
     if matchre("$scriptlist" , "MC_Mix\.cmd") then put #script abort MC_Mix
     if matchre("$scriptlist" , "MC_Pound\.cmd") then put #script abort MC_Pound
     if matchre("$scriptlist" , "MC_Setup\.cmd") then put #script abort MC_Setup
     if matchre("$scriptlist" , "MC_Sew\.cmd") then put #script abort MC_Sew
     if matchre("$scriptlist" , "MC_Shape\.cmd") then put #script abort MC_Shape
     if matchre("$scriptlist" , "MC_Smelt\.cmd") then put #script abort MC_Smelt
     if matchre("$scriptlist" , "MC_Spin\.cmd") then put #script abort MC_Spin
     if matchre("$scriptlist" , "MC_Tinker\.cmd") then put #script abort MC_Tinker
     if matchre("$scriptlist" , "MC_Weave\.cmd") then put #script abort MC_Weave
     action goto ESCAPE_NOW when ^You move along to follow your mark\.
     action remove You believe you could (.*) out of the way of the leucro, if you act quickly enough.
     action remove (\S+) (?<!bucca |shadow |shadowling |shadowcat |shadowpanther |shadowtabby |Cormyn |One |nyad |dryad |ruffian |footpad |thug |cuttthroat |adventurer |wraith |glances about and |(points at you |snarls |scans the area )and )(?:whispers|asks|says|exclaims)\,\s\"(?!(?:Foolisssh|Asketi|Tina mi|Please release me|Silence slave|Farewell|Welcome back|I like to (dance|play)|Siegery|Treasure hunting|Well I'll be dern|Me thinks|That's not worth|My eyes aren't|You can't see me|Visit a local dock|We heard the|Where are you/?\s+I will find you/!|This looks like a good|Is anyone (hunting|else|in|here).*\"))((.*)\"(?!"))
     if (%healrun = 0) then action (dead) on
     if (%healrun = 1) then action (dead) off
     if (%Backtraining = 0) then var Backtrained 0
     if (%Backtraining = 1) then var Backtrained 1
     action (PVPPLAYER) off
     action (stunned) off
     action (combat) off
     action (inventory) off
     action (retreat) off
     action (escape) off
     action (switch) off
     action (jail) on
     if matchre("%command", "(?i)heal") then
          {
               action (stunned) off
               action (combat) off
               action (escape) off
               action (dead) off
               var healrun 1
          }
     var combatcount 0
     var switchloop 0
     var summoning 0
     var ammolodged 0
     var indoor.check 0
     var Foci.Active 0
     # put #mapper reset
     var CURRENT Escaping Combat!
     if matchre("$roomobjs","(?i)torch") then gosub STOWIT torch
     if matchre("$roomobjs","(?i)gnome") then gosub STOWIT lantern
     if matchre("$roomobjs","(?i)gaezthen") then gosub STOWIT gaezthen
     if matchre("$roomobjs","(?i)bundle") then gosub STOWIT bundle
     gosub STATUSBAR
     gosub STOWING
     if ($UC_Ammo = 1) then gosub STOWAMMO
     gosub FEET_CHECK
     gosub CLEARHANDS
     pause 0.00001
     if ("$guild" = "Cleric") then
          {
               if matchre("$roomobjs", "\b(?i)%PrayerMat\b") then
                    {
                         pause 0.1
                         put roll %PrayerMat
                         pause 0.5
                         gosub STOWIT %PrayerMat
                         pause 0.1
                    }
               put #var UC_meraud 0
               put #var UC_tamsine 0
          }
     if ($circle < 29) then
          {
               put circle
               pause
               pause 0.1
          }
     if (("$guild" = "Thief") && ("%GOSUBBING" = "OFF")) then
          {
               put khri vanish
               pause
               pause 0.3
               if ($invisible = 0) then
                    {
                         put khri silence
                         pause 0.5
                    }
          }
     if (%debt = 1) then goto ESCAPE_SEARCH
##### EMPATH DOUBLE CHECK
     if (("$guild" = "Empath") && ($UC_NoCombat = 0) && !matchre("%command", "(?i)(heal|town)")) then
          {
               gosub EMPATH_HEALTH
               if (($needHealing = 0) && ("%escaping" = "OFF") && ($health > 79) && ("%GOSUBBING" = "OFF")) then
                    {
                         echo
                         echo *** False Alarm - Still healthy! - Returning to Combat
                         echo
                         put #echo >Log #C0FE7A *** Escape False Alarm - Still Healthy! Returning to Last
                         if matchre("%LAST", "MAGICALRESEARCH") then goto MAGICALRESEARCH
                         if matchre("%LAST", "CUSTOMCHECK") then goto CUSTOMCHECK
                         if (%InCombat = 0) then goto HEALTHDONE
                         goto TrainLoop2
                    }
               goto ESCAPE_SEARCH
          }
     if (matchre("$roomobjs" , "(lumpy|tight) bundle") && ($UC_SellSkins = 1)) then gosub GET bundle
     if (($bleeding = 1) && ($health < 75)) then
          {
               gosub HEALTH_CHECK
               gosub HERB_CHECK
          }
     if (($UC_TrainStealth = 1) || ($UC_Ambush = 1)) then
          {
               put stop stalk
               pause 0.01
          }
ESCAPE_SEARCH:
     if ($hidden = 1) then gosub UNHIDE
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if ("%GOSUBBING" = "ON") then goto TOWN_SEARCH
     if (%Backtraining = 0) then var Backtrained 0
     if (%Backtraining = 1) then var Backtrained 1
     gosub RETREAT_FLEE
     unvar retreatloop
ESCAPE_SEARCH_2:
     ### SET LAST COMBAT TIME
     put #var UC_Combat.Last {#evalmath ($gametime - $UC_Combat.Time)}
     evalmath Combat.Last ($UC_Combat.Last / 60)
     evalmath Combat.Last round(%Combat.Last,2)
     if ((%COMBAT.ZONE = 0) && (%COMBAT.ROOM = 0)) then
          {
               var COMBAT.ROOM $roomid
               var COMBAT.ZONE $zoneid
          }
     echo
     echo #######################################
     echo *** ESCAPING FROM COMBAT!! - Total Time: %Combat.Last minutes
     echo *** Combat location - Zoneid: %COMBAT.ZONE  Roomid: %COMBAT.ROOM
     echo *** Kills: %TotalKills | Boxes: %TotalBoxes | Skins: %TotalSkins
     echo #######################################
     echo
     put #echo >Log #00FF0F *** Combat Time: %Combat.Last mins | Zone: %COMBAT.ZONE  Room: %COMBAT.ROOM
     put #echo >Log #00FF0F *** Kills: %TotalKills | Boxes: %TotalBoxes | Skins: %TotalSkins
     #############################################################
ESCAPE_NOW_CONTINUED:
TOWN_SEARCH:
     if contains("$roomobjs" , "(%ALLWEAPONS)") then gosub STOW $0
     if matchre("$roomobjs" , "(%ALLWEAPONS)") then gosub STOW $0
     echo
     echo ##########################
     echo ** SEARCHING FOR THE NEAREST TOWN!
     echo ##########################
     echo
     if matchre("$guild", "%MAGICUSER") then gosub RELEASE cyclic
     if ($SpellTimer.HydraHex.active = 1) then gosub RELEASE HYH
     if ($SpellTimer.ShadowWeb.active = 1) then gosub RELEASE SHW
     if ($SpellTimer.UniversalSolvent.active = 1) then gosub RELEASE USOL
     if ($SpellTimer.QuickenEarth.active = 1) then gosub RELEASE QE
     if ($SpellTimer.ElectrostaticEddy.active = 1) then gosub RELEASE EE
     if ($SpellTimer.FireRain.active = 1) then gosub RELEASE FR
     if ($SpellTimer.PhoenixsPyre.active = 1) then gosub RELEASE PYRE
     if ($SpellTimer.DamarisLullaby.active = 1) then gosub RELEASE DALU
     if ($SpellTimer.RingofSpears.active = 1) then gosub RELEASE ROS
     if ($SpellTimer.FaenellasGrace.active = 1) then gosub RELEASE FAE
     if ($SpellTimer.AbandonedHeart.active = 1) then gosub RELEASE ABAN
     if ($SpellTimer.AlbredasBalm.active = 1) then gosub RELEASE ALB
     if ($SpellTimer.GlythtidesJoy.active = 1) then gosub RELEASE GJ
     if ($SpellTimer.SoulAttrition.active = 1) then gosub RELEASE SA
     ###############
     if ($invisible = 1) then gosub STOP_INVIS
     ### CHECK TO MAKE SURE WE ARE NOT IN A DARK ROOM - IF SO USE LIGHT SOURCE
     gosub DARK_CHECK_1
     if matchre("$roomobjs $roomdesc","(pitch black|pitch dark)") then gosub LIGHT_SOURCE
     if ($roomid = 0) then gosub RANDOMMOVE
     # debug 10
     pause 0.00001
     #### SPECIAL ESCAPE SECTION FOR MAZES/HARD TO ESCAPE AREAS
     if matchre("$roomname", "(Velaka, Slot Canyon|Yeehar's Graveyard|Heru Taipa)") then gosub AUTOMOVE 66
     delay 0.00001
     ## IF HUNTING CROCS - TAKE PATH THROUGH UNDERSHARD (FASTER THEN LONG SWIM TIME BACK TO SOUTH GATE)
     if ("$zoneid" = "68") && matchre("$roomname", "Sewer") then gosub AUTOMOVE 188
     ###############################################################################################
     if matchre("$roomname", "Ehhrsk Highway") then gosub EHHRSK_ESCAPE
     if (matchre("$roomname", "Zaulfung, Swamp") && matchre("$roomdesc", "Rancid mire")) then gosub ZAULFUNG_ESCAPE
     if matchre("$roomname", "Zaulfung, Trackless Swamp") then gosub ZAULFUNG_ESCAPE_2
     if (matchre("$roomname", "Velaka Desert") && ($roomid = 0)) then gosub VELAKA_ESCAPE
     if matchre("$roomname", "Undershard") then gosub WARRENS_ESCAPE
     if matchre("$roomname", "The Marsh, In The Water") then gosub CROC_ESCAPE
     if matchre("$roomname", "The Marsh, In The Water") then gosub CROC_ESCAPE
     if matchre("$roomname", "Maelshyve's Ascent") then gosub MAELSHYVE_ASCENT_ESCAPE
     if matchre("$roomname", "(Abyssal Descent|Abyssal Seed)") then gosub ABYSSAL_ESCAPE
     if matchre("$roomname", "Deadman's Confide, Beach") then gosub DEADMAN_ESCAPE
     if matchre("$roomname", "Adder's Nest") then gosub ADDERNEST_ESCAPE
     if matchre("$roomname", "Temple of the North Wind, Catacombs") then gosub NORTHWIND_ESCAPE
     if matchre("$roomname", "Temple of the North Wind, High Priestess' Sanctum") then gosub ASKETI_ESCAPE
     if matchre("$roomname", "Temple of the North Wind, Dark Sanctuary") then gosub ASKETI_ESCAPE
     if matchre("$roomname", "Temple of the North Wind, Last Sacrifice") then gosub ASKETI_ESCAPE
     if matchre("$roomname", "Asketi's Mount") then gosub ASKETI_ESCAPE
     if matchre("$roomname", "The Fangs of Ushnish") then gosub USHNISH_ESCAPE
     if matchre("$roomname", "Temple of Ushnish") then gosub USHNISH_ESCAPE_2
     if matchre("$roomname", "Beyond the Gate of Souls") then gosub USHNISH_ESCAPE_3
	if matchre("$roomname", "Clover Fields" then gosub BROCKET_ESCAPE
     if matchre("$roomname", "Undershard") then gosub WARRENS_ESCAPE
     if matchre("$roomname", "Maelshyve's Fortress, Inner Sanctum" then gosub MAELSHYVE_FORTRESS_ESCAPE
     if matchre("$roomname", "(Maelshyve's Fortress, Hall of Malice|Glutton's Rest|Fallen Altar|Great Dais)") then gosub MAELSHYVE_FORTRESS_ESCAPE_2
     if matchre("$roomname", "(Charred Caverns|Beneath the Zaulfung|Maelshyve's Threshold)") then gosub BENEATH_ZAULFUNG_ESCAPE
     if matchre("$roomname", "(Charred Caverns|Beneath the Zaulfung|Maelshyve's Threshold)") then gosub BENEATH_ZAULFUNG_ESCAPE
     if matchre("$roomname", "(Zaulfung, Dense Swamp|Kweld Gelvdael|Zaulfung, Urrem'tier's Spire)") then gosub ZAULFUNG_ESCAPE_0
     if matchre("$roomname", "(Zaulfung, Dense Swamp|Kweld Gelvdael|Zaulfung, Urrem'tier's Spire)") then gosub ZAULFUNG_ESCAPE_0
     if matchre("$roomname", "Zaulfung, Swamp") && matchre("$roomdesc", "Rancid mire") then gosub ZAULFUNG_ESCAPE
     if matchre("$roomname", "Zaulfung, Swamp") && matchre("$roomdesc", "Rancid mire") then gosub ZAULFUNG_ESCAPE
     if matchre("$roomname", "Zaulfung, Swamp") && matchre("$roomdesc", "Rancid mire") then gosub ZAULFUNG_ESCAPE
     if matchre("$roomname", "Zaulfung, Trackless Swamp") then gosub ZAULFUNG_ESCAPE_2
     if matchre("$roomname", "Zaulfung, Trackless Swamp") then gosub ZAULFUNG_ESCAPE_2
     if matchre("$roomname", "Zaulfung, Trackless Swamp") then gosub ZAULFUNG_ESCAPE_2
     if matchre("$roomname", "Velaka, Dunes") then gosub VELAKADUNES_ESCAPE
     if matchre("$roomname", "Velaka, Dunes") then gosub VELAKADUNES_ESCAPE
     # if matchre("$roomname", "Underground, A Dark Cavern") then gosub LIGHT_SOURCE
     ##############################################################################
     ### CHOOSE DIRECTION DEPENDING WHAT SIDE OF THE ICE ROAD
     if ("$zoneid" = "123") then
          {
               if matchre("$roomname", "(In the Crater|In the Mountain|Himineldar Shel|Abandoned Tunnels|Abandoned Mine|Underground Lake)") then
                    {
                         if ($invisible = 1) then gosub STOP_INVIS
                         gosub AUTOMOVE 168
                    }
          }
     if matchre("$roomname", "(Jeol'gelvmoraen|Seord'Kerwaith|Seord Kerwaith)") then gosub AUTOMOVE 11
     ##############################################################################
ESCAPE_SEARCH_3:
     # CHECK / RELEASE ANY HARMFUL AOE CYCLICS THAT ARE DANGEROUS FOR TOWN
     if ($SpellTimer.HydraHex.active = 1) then gosub RELEASE HYH
     if ($SpellTimer.ShadowWeb.active = 1) then gosub RELEASE SHW
     if ($SpellTimer.UniversalSolvent.active = 1) then gosub RELEASE USOL
     if ($SpellTimer.QuickenEarth.active = 1) then gosub RELEASE QE
     if ($SpellTimer.ElectrostaticEddy.active = 1) then gosub RELEASE EE
     if ($SpellTimer.FireRain.active = 1) then gosub RELEASE FR
     if ($SpellTimer.PhoenixsPyre.active = 1) then gosub RELEASE PYRE
     if ($SpellTimer.DamarisLullaby.active = 1) then gosub RELEASE DALU
     if ($SpellTimer.RingofSpears.active = 1) then gosub RELEASE ROS
     if ($SpellTimer.FaenellasGrace.active = 1) then gosub RELEASE FAE
     if ($SpellTimer.AbandonedHeart.active = 1) then gosub RELEASE ABAN
     if ($SpellTimer.AlbredasBalm.active = 1) then gosub RELEASE ALB
     if ($SpellTimer.GlythtidesJoy.active = 1) then gosub RELEASE GJ
     if ($SpellTimer.SoulAttrition.active = 1) then gosub RELEASE SA
     ###############
     if (("$guild" = "Empath") && matchre("$roomobjs", "alfar")) then
          {
               send command warrior to behavior passive
               pause 0.5
               pause 0.1
          }
     if ("$guild" = "Necromancer") then
          {
               if ($UC_Risen = 1) then gosub LEAVE_COMMAND
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               ## CHECK FOR ANY LEFTOVER TRANSCENDENTAL NECRO BUFFS
               # if ($SpellTimer.QuickenEarth.active = 1) then gosub RELEASE QE
               # if ($SpellTimer.UniversalSolvent.active = 1) then gosub RELEASE USOL
               # if ($SpellTimer.ButchersEye.active = 1) then gosub RELEASE BUE
               # if ($SpellTimer.CalcifiedHide.active = 1) then gosub RELEASE CH
               # if ($SpellTimer.Chirurgia.active = 1) then gosub RELEASE CHIR
               # if ($SpellTimer.CovetousRebirth.active = 1) then gosub RELEASE CRE
               # if ($SpellTimer.IvoryMask.active = 1) then gosub RELEASE IVM
               # if ($SpellTimer.KuraSilma.active = 1) then gosub RELEASE KS
               # if ($SpellTimer.PhilosophersPreservation.active = 1) then gosub RELEASE PHP
               # if ($SpellTimer.SpitefulRebirth.active = 1) then gosub RELEASE SRE
               # if ($SpellTimer.WormsMist.active = 1) then gosub RELEASE WORM
          }
     pause 0.00001
     if ($roomid = 0) then gosub RANDOMMOVE
     if ("$zoneid" = "150") then gosub AUTOMOVE 86
     if ("$zoneid" = "68a") then gosub AUTOMOVE shard
     if (("$zoneid" = "34") && ($roomid > 89) && ($roomid < 116)) then
          {
               gosub AUTOMOVE 49
               gosub AUTOMOVE 23
          }
     ## CROSSING AREA
     if ("$zoneid" = "10") then gosub AUTOMOVE NTR
     if ("$zoneid" = "11") then gosub AUTOMOVE NTR
     if ("$zoneid" = "1") then
          {
               if matchre("$roomname", "(?i)Sewer") then gosub AUTOMOVE 295
               if matchre("$roomname", "(?i)Warehouse") then gosub AUTOMOVE 437
               if matchre("$roomname", "(?i)Shipyard") then gosub AUTOMOVE 237
          }
     if ("$zoneid" = "1a") then gosub AUTOMOVE cross
     if ("$zoneid" = "2") then gosub AUTOMOVE 2
     if ("$zoneid" = "2d") then gosub AUTOMOVE temple
     if ("$zoneid" = "2a") then gosub AUTOMOVE cross
     if ("$zoneid" = "8a") then gosub AUTOMOVE cross
     if ("$zoneid" = "9b") then gosub AUTOMOVE NTR
     if ("$zoneid" = "10") then gosub AUTOMOVE NTR
     if ("$zoneid" = "10") then gosub AUTOMOVE NTR
     ## NTR TO XING
     if ("$zoneid" = "11") then gosub AUTOMOVE NTR
     if ("$zoneid" = "2d") then gosub AUTOMOVE temple
     if ("$zoneid" = "14b") then gosub AUTOMOVE NTR
     if ("$zoneid" = "14c") then gosub AUTOMOVE river
     if ("$zoneid" = "13") then gosub AUTOMOVE NTR
     if ("$zoneid" = "11") then gosub AUTOMOVE NTR
     if ("$zoneid" = "10") then gosub AUTOMOVE NTR
     if ("$zoneid" = "2a") then gosub AUTOMOVE crossing
     if ("$zoneid" = "4a") then gosub AUTOMOVE crossing
     if ("$zoneid" = "11") then gosub AUTOMOVE NTR
     if ("$zoneid" = "14b") then gosub AUTOMOVE NTR
     if ("$zoneid" = "7a") then gosub AUTOMOVE NTR
     if ("$zoneid" = "13") then gosub AUTOMOVE NTR
     if ("$zoneid" = "12a") then
          {
               gosub LIGHT_SOURCE
               gosub AUTOMOVE NTR
          }
     if ("$zoneid" = "10") then gosub AUTOMOVE NTR
     if ("$zoneid" = "10") then gosub AUTOMOVE NTR
     if ("$zoneid" = "10") then gosub AUTOMOVE NTR
     if ("$zoneid" = "11") then gosub AUTOMOVE NTR
     ## RIVERHAVEN / MISTWOOD
     if ("$zoneid" = "30a") then gosub AUTOMOVE 57
     if ("$zoneid" = "30b") then gosub AUTOMOVE 14
     if ("$zoneid" = "31b") then gosub AUTOMOVE 5
     if ("$zoneid" = "31a") then
          {
               gosub AUTOMOVE 121
               gosub ZAULFUNG_ESCAPE
          }
     if ("$zoneid" = "34a") then gosub AUTOMOVE mist
     if (("$zoneid" = "34") && ($roomid > 89) && ($roomid < 116)) then
          {
               gosub AUTOMOVE 49
               gosub AUTOMOVE 23
          }
     if ("$zoneid" = "34") then
          {
               gosub AUTOMOVE 5
               if ($Athletics.Ranks < 100) then gosub ARMOR_REMOVE
               gosub AUTOMOVE riverhaven
          }
     if ("$zoneid" = "32") then gosub AUTOMOVE 2
     if ("$zoneid" = "31") then gosub AUTOMOVE 2
     if ("$zoneid" = "33a") then gosub AUTOMOVE 30
     if ("$zoneid" = "33") then gosub AUTOMOVE 9
     delay 0.00001
     if ("$zoneid" = "10") then gosub AUTOMOVE NTR
     ## THEREN / LANG / MUSPARI / THRONE
     if ("$zoneid" = "48") then
          {
               put .travel muspari
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "47") then gosub AUTOMOVE 97
     if ("$zoneid" = "35") then gosub AUTOMOVE 149
     if ("$zoneid" = "41") then gosub AUTOMOVE theren
     if ("$zoneid" = "40a") then gosub AUTOMOVE lang
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "48") then gosub AUTOMOVE muspar
     if ("$zoneid" = "41") then
          {
               send .travel theren
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "40") then gosub AUTOMOVE 209
     delay 0.00001
     ## LETH / STR / AIN GHAZAL
     if ("$zoneid" = "50") then gosub AUTOMOVE south
     if ("$zoneid" = "58") then gosub AUTOMOVE leth
     if ("$zoneid" = "59") then gosub AUTOMOVE 12
     if ("$zoneid" = "63") then gosub AUTOMOVE STR
     if matchre("$zoneid","(112|62|60)") then
          {
               var hometown LETH
               gosub AUTOMOVE 2
          }
     delay 0.00001
     if ("$zoneid" = "4a") then gosub AUTOMOVE crossing
     if ("$zoneid" = "4") then
          {
               if (($UC_F2P = 1) || matchre("%FANGCOVE", "(?i)OFF")) then
               {
                    if (matchre("%PocketEmpath", "(?i)(NULL|OFF|0|^$|^%)") && matchre("%AUTOHEAL", "(?i)ON") && matchre("%GOSUBBING", "OFF")) then
                         {
                              echo *** Going to Dokt
                              gosub AUTOMOVE dokt
                              goto HEALINGRUN
                         }
               }
          }
     if ("$zoneid" = "4") then gosub AUTOMOVE 1
     ## RATHA / AESRY
     if ("$zoneid" = "90a") then gosub AUTOMOVE 2
     if ("$zoneid" = "92") then gosub AUTOMOVE 2
     if ("$zoneid" = "95") then gosub AUTOMOVE 2
     if ("$zoneid" = "98a") then gosub AUTOMOVE 97
     if ("$zoneid" = "98") then gosub AUTOMOVE 84
     ## HIB / BOAR CLAN
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then gosub AUTOMOVE 47
     if ("$zoneid" = "123") then gosub AUTOMOVE 168
     if ("$zoneid" = "114") then
          {
               send .travel hib
               waitforre ^YOU ARRIVED\!
          }
     if ($roomid = 0) then gosub RANDOMMOVE
     ## SHARD AREA
     if ("$zoneid" = "68") then gosub AUTOMOVE 3
     if ("$zoneid" = "62") then gosub AUTOMOVE leth
     if ("$zoneid" = "62") then gosub AUTOMOVE leth
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "68a") then gosub AUTOMOVE shard
     if ("$zoneid" = "68b") then gosub AUTOMOVE shard
     delay 0.00001
     if ("$zoneid" = "68a") then gosub AUTOMOVE shard
     if ("$zoneid" = "68b") then gosub AUTOMOVE shard
     if (("$zoneid" = "68") && ("$roomid" != "3")) then gosub AUTOMOVE 3
     delay 0.00001
     if ("$zoneid" = "66") then gosub AUTOMOVE 39
     if ("$zoneid" = "69") then gosub AUTOMOVE 15
     if (("$zoneid" = "68") && ("$roomid" != "3")) then gosub AUTOMOVE 3
     ################
     if ("$guild" = "Necromancer") then
          {
               gosub RELEASE cyclic
               if ($UC_Risen = 1) then gosub LEAVE_COMMAND
               if ($SpellTimer.QuickenEarth.active = 1) then gosub RELEASE QE
               if ($SpellTimer.UniversalSolvent.active = 1) then gosub RELEASE USOL
               pause 0.2
               gosub JUSTICE_CHECK
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
          }
     ## MRISS / MERKRESH
     if ("$zoneid" = "108") then
          {
          var hometown MRISS
          var CurrentCity MRISS
          if contains("$roomobjs", "arisen") then
               {
                    var arise_command release
                    gosub ARISE_COMMAND
               }
          if ($invisible = 1) then gosub STOP_INVIS
          if ($UC_Premium = 1) then
               {
                    gosub TO_SEACAVES
                    goto HEALINGRUN
               }
          if ("$roomid" != "151") then gosub AUTOMOVE 151
          pause 0.1
          if ("$roomid" != "151") then gosub AUTOMOVE 151
          if matchre("$guild", "%MAGICUSER") then gosub RELEASE cyclic
          waitforre glides into the dock|A loud voice
          if ($invisible = 1) then gosub STOP_INVIS
          put go galley
          pause
          waitforre reaches the dock
          put go dock
          pause 0.7
          pause 0.3
          }
     delay 0.00001
     if (("$zoneid" = "108") && ("$roomid" != "151")) then gosub AUTOMOVE 151
     if ("$zoneid" = "107") then gosub AUTOMOVE 90
### DOUBLE CHECK AND RELEASE ALL CYCLICS / BAD SPELLS BEFORE ENTERING TOWN
ESCAPE_NOW_1:
     var InCombat 0
     if matchre("$guild", "%MAGICUSER") then
          {
               if ((("$guild" = "Necromancer") && ($spellROC = 1)) || (("$guild" = "Necromancer") && ($spellROG = 1))) then goto ESCAPE_NOW_2
               gosub RELEASE cyclic
          }
     if ($SpellTimer.HydraHex.active = 1) then gosub RELEASE HYH
     if ($SpellTimer.ShadowWeb.active = 1) then gosub RELEASE SHW
     if ($SpellTimer.UniversalSolvent.active = 1) then gosub RELEASE USOL
     if ($SpellTimer.QuickenEarth.active = 1) then gosub RELEASE QE
     if ($SpellTimer.ElectrostaticEddy.active = 1) then gosub RELEASE EE
     if ($SpellTimer.FireRain.active = 1) then gosub RELEASE FR
     if ($SpellTimer.PhoenixsPyre.active = 1) then gosub RELEASE PYRE
     if ($SpellTimer.DamarisLullaby.active = 1) then gosub RELEASE DALU
     if ($SpellTimer.RingofSpears.active = 1) then gosub RELEASE ROS
     if ($SpellTimer.FaenellasGrace.active = 1) then gosub RELEASE FAE
     if ($SpellTimer.AbandonedHeart.active = 1) then gosub RELEASE ABAN
     if ($SpellTimer.AlbredasBalm.active = 1) then gosub RELEASE ALB
     if ($SpellTimer.GlythtidesJoy.active = 1) then gosub RELEASE GJ
     if ($SpellTimer.SoulAttrition.active = 1) then gosub RELEASE SA
     if ($SpellTimer.ShieldofLight.active = 1) then gosub RELEASE SOL
     if (("$guild" = "Thief") && ($invisible = 1)) then send khri stop silence vanish
     if (("$guild" = "Moon Mage") && ($invisible = 1)) then gosub RELEASE rf
     if (("$guild" = "Empath") && matchre("$roomobjs", "alfar")) then
          {
               send command warrior to behavior passive
               pause 0.2
          }
### FINAL ESCAPES TO ACTUAL TOWN
ESCAPE_NOW_2:
     var escaping OFF
     var TownTime $gametime
     var healthwalk 1
     put #parse GOING TO TOWN!
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then gosub AUTOMOVE 48
     if ("$zoneid" = "123") then gosub AUTOMOVE 168
     # if ("$guild" = "Necromancer") && ($invisible = 1) then send release eotb
     if ("$guild" = "Necromancer") then
          {
               if matchre("$zoneid","\b(7|66|68|69)\b") then
                    {
                         if ($invisible = 1) then gosub STOP_INVIS
                    }
               if ($UC_Risen = 1) then gosub LEAVE_COMMAND
               if ($SpellTimer.QuickenEarth.active = 1) then gosub RELEASE QE
               if ($SpellTimer.UniversalSolvent.active = 1) then gosub RELEASE USOL
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               ### CHECK FOR ANY LEFTOVER TRANSCENDENTAL NECRO BUFFS
               if ($SpellTimer.QuickenEarth.active = 1) then gosub RELEASE QE
               if ($SpellTimer.UniversalSolvent.active = 1) then gosub RELEASE USOL
               # if ($SpellTimer.ButchersEye.active = 1) then gosub RELEASE BUE
               # if ($SpellTimer.CalcifiedHide.active = 1) then gosub RELEASE CH
               # if ($SpellTimer.Chirurgia.active = 1) then gosub RELEASE CHIR
               # if ($SpellTimer.CovetousRebirth.active = 1) then gosub RELEASE CRE
               # if ($SpellTimer.IvoryMask.active = 1) then gosub RELEASE IVM
               # if ($SpellTimer.KuraSilma.active = 1) then gosub RELEASE KS
               # if ($SpellTimer.PhilosophersPreservation.active = 1) then gosub RELEASE PHP
               # if ($SpellTimer.SpitefulRebirth.active = 1) then gosub RELEASE SRE
               # if ($SpellTimer.WormsMist.active = 1) then gosub RELEASE WORM
          }
     if ($UC_Forsaken = 1) then
          {
               ### MAYBE EDIT THIS LATER TO INCLUDE ALTERNATE PLACES TO GO "TOWN RUN" INSTEAD OF TOWN
               ### goto ESCAPE_NOW_CONTINUED
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               if (($spellEOTB = 0) && matchre("%abbrevs", "(?i)EOTB") && !matchre("$zoneid","\b(7|66|68|69)\b")) then gosub EOTB
          }
     if matchre("$zoneid","(127|123)") then gosub AUTOMOVE hib
     if matchre("$zoneid","(127|123)") then gosub AUTOMOVE hib
     if matchre("$zoneid","(127|123)") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then
          {
               gosub AUTOMOVE hib
               pause 0.4
               send east
               pause 0.5
          }
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then gosub AUTOMOVE 49
     if ("$zoneid" = "123") then gosub AUTOMOVE 169
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "50") then gosub AUTOMOVE south
     if ("$zoneid" = "66") then
          {
               if (($Athletics.Ranks > 350) && (%Necro.Known = 0)) then
                    {
                         gosub AUTOMOVE 70
                         pause 0.01
                         send climb wall
                         pause 0.5
                         pause 0.3
                         gosub MOVE east
                         gosub MOVE climb ladder
                         pause 0.001
                         if ("$zoneid" = "67") then goto ESCAPE_NOW_3
                    }
          }
     if (("$zoneid" = "66") && ("$guild" = "Thief")) then
          {
               gosub AUTOMOVE 66
               send go trail
               pause 0.2
               pause 0.5
               gosub MOVE S
               pause 0.1
               gosub AUTOMOVE shard
          }
     if (("$zoneid" = "66") && ($UC_shardCitizen = 0) && ($Time.isDay = 0)) then gosub AUTOMOVE 43
     if ("$zoneid" = "66") then
          {
               if ((($Time.isDay = 1) && (%Necro.Known = 0)) || (($UC_shardCitizen = 1) && (%Necro.Known = 0))) then gosub AUTOMOVE north
          }
ESCAPE_NOW_3:
     if ("$zoneid" = "68") then
          {
               if (($Athletics.Ranks > 350) && (%Necro.Known = 0)) then
                    {
                         gosub AUTOMOVE 2
                         pause 0.01
                         send climb wall
                         pause 0.5
                         pause 0.3
                         if ("$zoneid" = "67") then goto ESCAPE_NOW_4
                    }
               if ((($UC_shardCitizen = 1) && (%Necro.Known = 0)) || (($Time.isDay = 1) && (%Necro.Known = 0))) then gosub AUTOMOVE shard
               if ((($UC_shardCitizen = 0) && ($Time.isDay = 0)) || (%Necro.Known = 1)) then
                    {
                         gosub AUTOMOVE 15
                         pause 0.2
                         pause 0.1
                         if ("$zoneid" = "66") then gosub AUTOMOVE 39
                    }
          }
     if ("$zoneid" = "68") then gosub AUTOMOVE 15
     if (("$zoneid" = "69") && (%Necro.Known = 1)) then gosub AUTOMOVE north
     if (("$zoneid" = "69") then
          {
               if (($Athletics.Ranks > 350) && (%Necro.Known = 0)) then
                    {
                         gosub AUTOMOVE 10
                         pause 0.01
                         send climb wall
                         pause 0.5
                         pause 0.3
                         gosub MOVE north
                         gosub MOVE climb ladder
                         pause 0.001
                         if ("$zoneid" = "67") then goto ESCAPE_NOW_4
                    }
               if ((($UC_shardCitizen = 1) && (%Necro.Known = 0)) || (($Time.isDay = 1) && (%Necro.Known = 0))) then gosub AUTOMOVE shard
               if ((($UC_shardCitizen = 0) && ($Time.isDay = 0)) || (%Necro.Known = 1)) then gosub AUTOMOVE north
          }
ESCAPE_NOW_4:
     if (("$zoneid" = "69") && ($UC_shardCitizen = 0)) then gosub AUTOMOVE north
     if ("$zoneid" = "68") then gosub AUTOMOVE 15
     if matchre("$zoneid","\b(90a|92|95)\b") then gosub AUTOMOVE ratha
     if matchre("$zoneid","\b(112|62|60)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(40|41)\b") then gosub AUTOMOVE theren
     if matchre("$zoneid","\b(34a|34|33a|32|31|33)\b") then gosub AUTOMOVE riverhaven
     if matchre("$zoneid","\b(34a|34|33a|32|31|33)\b") then gosub AUTOMOVE river
     delay 0.00001
     if matchre("$zoneid","\b(34a|34|33a|32|31|33)\b") then gosub AUTOMOVE river
     delay 0.00001
     if matchre("$zoneid","\b(2|2a|4|5|6|7|8|10)\b") then gosub AUTOMOVE crossing
     if matchre("$zoneid","\b(2|2a|4|5|6|7|8|10)\b") then gosub AUTOMOVE crossing
     if matchre("$zoneid","\b(2|2a|4|5|6|7|8|10)\b") then gosub AUTOMOVE crossing
     ## DOUBLE CHECKS!!
     if ("$zoneid" = "4") then
          {
               if (($UC_F2P = 1) || matchre("%FANGCOVE", "(?i)OFF") || (($health < 40) && ($bleeding = 1))) then
                    {
                         if ($roomid != 464) then gosub AUTOMOVE 464
                         goto HEALINGRUN
                    }
          }
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then
          {
               gosub AUTOMOVE hibarn
               pause 0.4
               send east
               pause 0.4
          }
     if ("$zoneid" = "126") then gosub AUTOMOVE 49
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "123") then gosub AUTOMOVE 169
     if ("%GOSUBBING" = "ON") then return
####################################################
###############################################################
## echo *** Searching for healer..
## TO THE HEALER!!!
HEALINGRUN:
     var NEXTSUB HEALTH_RUN_DONE
     var LAST HEALINGRUN
     var fire 0
     var TownTime $gametime
     action remove ^You move along to follow your mark\.
     action (PVPPLAYER) off
     action (combat) off
     action (stunned) off
     action (escape) off
     action (dead) on
     if ($hidden = 1) then gosub UNHIDE
     if ($roomid = 0) then gosub RANDOMMOVE
     if (("$guild" = "Thief")  && ($concentration < 40)) then
          {
               send khri stop
               pause 0.5
          }
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     if (("$guild" = "Thief") && ($invisible = 1)) then send khri stop silence vanish
     # if ("$guild" = "Necromancer") && ($invisible = 1) then send release eotb
     if (("$guild" = "Moon Mage") && ($invisible = 1)) then gosub RELEASE rf
     delay 0.00001
     if ($roomid = 0) then gosub RANDOMMOVE
     if ("$zoneid" = "7") then gosub AUTOMOVE crossing
     delay 0.00001
     gosub stowing
     if (matchre("%FANGCOVE", "(?i)ON") && ($UC_F2P = 0)) then
          {
               if (("$zoneid" = "4") && ($health > 40)) then gosub AUTOMOVE cross
               if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|112|114|116|127)\b") then
                    {
                         var Teleport 0
                         if ("$zoneid" = "30") then gosub AUTOMOVE 8
                         if ("$zoneid" = "42") then gosub AUTOMOVE gate
                         if ("$zoneid" = "67") then gosub AUTOMOVE east
                         gosub TO_SEACAVES
                    }
          }
     if (("$guild" = "Thief")  && ($invisible = 1)) then send khri stop silence vanish
     # if ("$guild" = "Necromancer") then
          # {
               # if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          # }
     if matchre("%command", "(?i)sell") then goto SKINRUN
     if (%townRun = 1) then goto HEALTH_RUN_DONE
     if matchre("%JumpJewelry", "(?i)(ON|1|YES)") then goto FANG_TELEPORT
     if ($UC_Autoheal = 0) then goto AUTOHEAL_EXIT
     goto HEALTH_RUN
############################################################################################################################################################################################################
############################################################################################################################################################################################################
####################################################
## TOWN MODULE
####################################################
############################################################################################################################################################################################################
############################################################################################################################################################################################################
FANG_TELEPORT:
     var CurrentCity NULL
     var LAST FANG_TELEPORT
     action (jail) on
     if ("$zoneid" = "150") then
          {
               var Teleport 0
               goto HEALTHRUN
          }
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "108") then var CurrentCity MRISS
     if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
          {
               if ((matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON")) || (($UC_Premium = 1) && ("%FANGCOVE" = "ON"))) then
                    {
                         var Teleport 0
                         echo *** No need to use Jump Jewelry... taking portal into FC..
                         if ("$zoneid" = "42") then gosub AUTOMOVE gate
                         if ("$zoneid" = "67") then gosub AUTOMOVE east
                         gosub TO_SEACAVES
                         goto HEALTH_RUN
                    }
          }
     var Teleport 1
     delay 0.00001
     echo ################################
     echo ** TELEPORTING TO FANG COVE USING PREMIE RING!
     echo ################################
     pause 0.5
     send push my %JewerlyVerb
     pause 2
     pause 0.00001
     pause 0.00001
     send #mapper reset
     pause 0.3
     pause 0.00001
     if ($roomid = 0) then gosub RANDOMMOVE
     if ($roomid = 0) then gosub RANDOMMOVE
     if ($zoneid != 150) then var Teleport 0
     pause 0.00001
     pause 0.00001
HEAL_RUN:
HEALTH_RUN:
HEALTHRUN:
     action (buffs) on
     action (dead) on
     action (skip) on
     action (PVPPLAYER) off
     action (combat) off
     action (stunned) off
     action (escape) off
     action (inventory) off
     echo
     echo #############
     echo ** HEALTH RUN!
     echo ** GETTING HEALED!
     echo #############
     echo
     var NEXTSUB HEALTH_RUN_DONE
     var LAST HEALINGRUN
     var CURRENT HEALTH RUN! - Getting Healed
     var CurrentCity NULL
     gosub STATUSBAR
     var InCombat 0
     delay 0.00001
     if ("$guild" = "Barbarian") then
          {
               put form stop all
               wait
               pause 0.3
               put berserk stop
               wait
               pause 0.3
               put meditation stop
               wait
               pause 0.3
          }
     if (($invisible = 1) && (%Necro.Known = 0)) then gosub STOP_INVIS
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && matchre("$roomobjs", "alfar warrior")) then send command warrior to behavior passive
     if ("$zoneid" = "108") then var CurrentCity MRISS
     delay 0.00001
##### HEAL LOGIC
     if ($UC_HealAll = 0) then
          {
               echo
               echo #################
               echo ** HEAL.ALL is ~OFF~
               echo ** IGNORING HEALING
               echo ** IF MINIMAL INJURIES
               echo #################
               echo
               gosub HEALTH_CHECK
          }
     if ($UC_HealAll = 1) then
          {
               echo
               echo ###################
               echo ** HEAL.ALL is ~ON~
               echo ** CHECKING FOR ~ANY~ WOUNDS
               echo ** GETTING HEALED IF ANY INJURIES
               echo ###################
               echo
               gosub HEALTH_CHECK_ALL
          }
     if ($needHealing = 0) then
          {
               echo
               echo *** NO WOUNDS! SKIPPING HEALING!
               echo
               goto HEALTH_RUN_DONE
          }
     if (%townRun = 1) then goto HEALTH_RUN_DONE
     if ("$guild" = "Necromancer") then
          {
               gosub DO_CHECK
               pause 0.1
               gosub NECRO_MATERIAL
               pause 0.1
               gosub HEALTH_CHECK_ALL
               if (($needHealing = 1) && !matchre("%abbrevs", "(?i)(CF|DEVOUR)") && (%Divine.Outrage < 2)) then goto HEALTH_NEXT
               if (($needHealing = 1) && !matchre("%NecroHeal.Critter", "(?i)(NULL|OFF|0|^$|^%)") && (%Divine.Outrage < 4) && matchre("%abbrevs", "(?i)(CF|DEVOUR)") && ($UC_NecroHeal = 1)) then
                    {
                         var NecroHealing 1
                         goto NECRO_HEAL_RUN
                    }
               if ($needHealing = 1) then
                    {
                         echo
                         echo ################
                         echo ** Attempting to finish
                         echo ** Healing with HERBS
                         echo ################
                         echo
                         pause
                         gosub HERB_HEALING
                    }
               if ($spellEOTB = 0) then gosub NECRO_PREP
               goto HEALTH_RUN_DONE
          }
HEALTH_NEXT:
     if !matchre("%HEAL.CITY", "(?i)(NULL|OFF|0|^$|^%)") then gosub HEAL_TOWN
     if (("$guild" = "Empath") && ($Utility.Ranks > 80)) then
          {
               gosub EMPATH_HEAL
               pause 0.2
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto HEALTH_RUN_DONE
          }
     if matchre("%PocketEmpath", "(?i)(ON|1|YES)") then goto HEALING
     if (("$game" = "DRF") || ("$gamename" = "DRF")) then goto TF_HEALING
     if (matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") && matchre("%FANGCOVE", "(?i)ON")) then
          {
               if (matchre("$game", "(DRF|DRX)") || ($UC_Premium = 1)) then
                    {
                         var Teleport 0
                         if ("$zoneid" = "42") then gosub AUTOMOVE gate
                         if ("$zoneid" = "67") then gosub AUTOMOVE east
                         gosub TO_SEACAVES
                    }
          }
     goto HEALING

HEAL_TOWN:
     put #parse GOING TO TOWN!
     if (("$zoneid" = "150") && !matchre("%HEAL.CITY", "\b(?i)(FC|FANG)\b")) then gosub LEAVE_SEACAVES
     if matchre("%HEAL.CITY", "(?i)(CROSS|XING)") then
          {
               if ("$zoneid" = "1") then return
               if (($bleeding = 1) && ($health < 35)) then goto HEAL_TOWN_BLEEDING
               if (matchre("$zoneid", "30") && ($Athletics.Ranks > 180)) then
                    {
                         echo *** TRAVELING TO HEAL TOWN - %HEAL.CITY
                         put .travel cross
                         waitforre ^YOU ARRIVED\!
                         return
                    }
               if (matchre("$zoneid", "\b(61|112)\b") && ("$guild" = "Thief")) then
                    {
                         echo *** TRAVELING TO HEAL TOWN - %HEAL.CITY
                         put .travel cross
                         waitforre ^YOU ARRIVED\!
                         return
                    }
               if (($bleeding = 1) && ($health < 50)) then goto HEAL_TOWN_BLEEDING
               if (matchre("$zoneid", "\b(61|112)\b") && ("$Athletics.Ranks" > "550")) then
                    {
                         echo *** TRAVELING TO HEAL TOWN - %HEAL.CITY
                         put .travel cross
                         waitforre ^YOU ARRIVED\!
                         return
                    }
               if (matchre("$zoneid", "\b(61|112)\b") && ($bleeding = 0)) then
                    {
                         echo *** TRAVELING TO HEAL TOWN - %HEAL.CITY
                         put .travel cross
                         waitforre ^YOU ARRIVED\!
                         return
                    }
          }
     if matchre("%HEAL.CITY", "\b(?i)(leth|deriel)\b") then
          {
               if ("$zoneid" = "61") then return
               if (($bleeding = 1) && ($health < 40)) then goto HEAL_TOWN_BLEEDING
               if (matchre("$zoneid", "\b(1)\b") && ("$guild" = "Thief")) then
                    {
                         echo *** TRAVELING TO HEAL TOWN - %HEAL.CITY
                         put .travel leth
                         waitforre ^YOU ARRIVED\!
                         return
                    }
               if matchre("$zoneid", "\b(112)\b") then
                    {
                         echo *** TRAVELING TO HEAL TOWN - %HEAL.CITY
                         put .travel leth
                         waitforre ^YOU ARRIVED\!
                         return
                    }
               if (($bleeding = 1) && ($health < 60)) then goto HEAL_TOWN_BLEEDING
               if matchre("$zoneid", "\b(1|67)\b") then
                    {
                         echo *** TRAVELING TO HEAL TOWN - %HEAL.CITY
                         put .travel leth
                         waitforre ^YOU ARRIVED\!
                         return
                    }
          }
     if matchre("%HEAL.CITY", "\b(?i)(river|haven)\b") then
          {
               if ("$zoneid" = "30") then return
               if (($bleeding = 1) && ($health < 40)) then goto HEAL_TOWN_BLEEDING
               if (matchre("$zoneid", "\b(42|40|1)\b") && ($Athletics.Ranks > 200)) then
                    {
                         echo *** TRAVELING TO HEAL TOWN - %HEAL.CITY
                         put .travel river
                         waitforre ^YOU ARRIVED\!
                         return
                    }
          }
     if matchre("%HEAL.CITY", "\b(?i)(theren)\b") then
          {
               if ("$zoneid" = "42") then return
               if (($bleeding = 1) && ($health < 40)) then goto HEAL_TOWN_BLEEDING
               if (matchre("$zoneid", "\b(40|30|34|34a)\b") && ($Athletics.Ranks > 200)) then
                    {
                         echo *** TRAVELING TO HEAL TOWN - %HEAL.CITY
                         put .travel theren
                         waitforre ^YOU ARRIVED\!
                         return
                    }
          }
     if matchre("%HEAL.CITY", "\b(?i)(shard)\b") then
          {
               if ("$zoneid" = "67") then return
               if (matchre("$zoneid", "\b(61|1)\b") && ($Athletics.Ranks > 540)) then
                    {
                         echo *** TRAVELING TO HEAL TOWN - %HEAL.CITY
                         put .travel shard
                         waitforre ^YOU ARRIVED\!
                         return
                    }
               if (($bleeding = 1) && ($health < 40)) then goto HEAL_TOWN_BLEEDING
               if matchre("$zoneid", "\b(1|61|116|127)\b") then
                    {
                         echo *** TRAVELING TO HEAL TOWN - %HEAL.CITY
                         put .travel shard
                         waitforre ^YOU ARRIVED\!
                         return
                    }
          }
     if matchre("%HEAL.CITY", "\b(?i)(hib)\b") then
          {
               if ("$zoneid" = "116") then return
               if (($bleeding = 1) && ($health < 40)) then goto HEAL_TOWN_BLEEDING
               if matchre("$zoneid", "\b(127|67)\b") then
                    {
                         echo *** TRAVELING TO HEAL TOWN - %HEAL.CITY
                         put .travel hib
                         waitforre ^YOU ARRIVED\!
                         return
                    }
          }
     echo ###########################################
     echo *** Too far from HEAL.CITY (%HEAL.CITY) to run there now
     echo *** Using the Local Healer instead
     echo ###########################################
     pause 0.2
     return
HEAL_TOWN_BLEEDING:
     echo ##########################################
     echo *** We are too injured to run to our HEAL CITY: %HEAL.CITY right now
     echo *** Running to the local healer instead
     echo ##########################################
     pause 0.2
     return
##########################################################################################################################
##########################################################################################################################
# AUTO-HEALING SUBROUTINE
##########################################################################################################################
##########################################################################################################################
###################################################################
###################################################################
# THE FALLEN - Fang Cove Healing
###################################################################
###################################################################
HEALTH.PAUSE:
     pause 6
TF_HEALING:
     var LOCATION TF_HEALING
     action (PVPPLAYER) off
     action (combat) off
     action (stunned) off
     action (escape) off
     action (dead) off
     if ($stunned) then goto HEALTH.PAUSE
     if ($standing = 0) then gosub STAND
     pause 0.00001
     math healingloop add 1
     if ($invisible = 1) then gosub STOP_INVIS
     if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
          {
               var Teleport 0
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "42") then gosub AUTOMOVE gate
               gosub TO_SEACAVES
          }
TF_PORTAL_GO:
     pause 0.00001
     if ("$zoneid" != "150") then
          {
               send go meeting portal
               pause 0.5
          }
     if (("$guild" = "Empath") && ($Utility.Ranks > 80)) then gosub EMPATH_HEAL
     gosub HEALTH_CHECK_ALL
     pause 0.00001
     if ($invisible = 1) then gosub STOP_INVIS
     if ($needHealing = 0) then goto HEALTH_RUN_DONE
     if matchre("$roomplayers","(Healbitch|Beerfest|Gwyddion|Marino|Sawbones|Bedlam|Skrillex|Odium|Spinebreaker|Thad|Bayndayd|Lackluster)") then
          {
               pause 0.00001
               send demeanor neutral
               waitforre ^You decide to take things as they come\.
               if matchre("$roomplayers", "Thad") then var Empath Thad
               if matchre("$roomplayers", "Marino") then var Empath Marino
               if matchre("$roomplayers", "Sawbones") then var Empath Sawbones
               if matchre("$roomplayers", "Skrillex") then var Empath Skrillex
               if matchre("$roomplayers", "Bedlam") then var Empath Bedlam
               if matchre("$roomplayers", "Spinebreaker") then var Empath Spinebreaker
               if matchre("$roomplayers", "Lackluster") then var Empath Lackluster
               if matchre("$roomplayers", "Odium") then var Empath Odium
               if matchre("$roomplayers", "Beerfest") then var Empath Beerfest
               if matchre("$roomplayers", "Bayndayd") then var Empath Bayndayd
               if matchre("$roomplayers", "Healbitch") then var Empath Healbitch
               gosub LEAN
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto HEALTH_RUN_DONE
          }
     echo ##################################
     echo *** No Empaths Found in Room 85
     echo *** Checking Alcove
     echo ##################################
     if (("$zoneid" = "150") && ($Athletics.Ranks > 45)) then gosub AUTOMOVE 45
     if (("$zoneid" = "150") && ($Athletics.Ranks < 46)) then
          {
               echo *** NOT ENOUGH ATHLETICS TO MAKE IT TO ALCOVE!!
               echo *** USING AUTO-EMPATH!
               goto AUTOHEAL
          }
     pause 0.00001
     pause 0.00001
     if ($invisible = 1) then gosub STOP_INVIS
     if matchre("$roomplayers","(Healbitch|Beerfest|Gwyddion|Marino|Sawbones|Bedlam|Skrillex|Odium|Spinebreaker|Thad|Bayndayd|Lackluster)") then
          {
               pause 0.00001
               send demeanor neutral
               waitforre ^You decide to take things as they come\.
               if matchre("$roomplayers", "Thad") then var Empath Thad
               if matchre("$roomplayers", "Marino") then var Empath Marino
               if matchre("$roomplayers", "Sawbones") then var Empath Sawbones
               if matchre("$roomplayers", "Skrillex") then var Empath Skrillex
               if matchre("$roomplayers", "Bedlam") then var Empath Bedlam
               if matchre("$roomplayers", "Spinebreaker") then var Empath Spinebreaker
               if matchre("$roomplayers", "Lackluster") then var Empath Lackluster
               if matchre("$roomplayers", "Odium") then var Empath Odium
               if matchre("$roomplayers", "Beerfest") then var Empath Beerfest
               if matchre("$roomplayers", "Bayndayd") then var Empath Bayndayd
               if matchre("$roomplayers", "Healbitch") then var Empath Healbitch
               gosub LEAN
               gosub HEALTH_CHECK_ALL
               if ($needHealing = 0) then goto HEALTH_RUN_DONE
          }
     echo ##################################
     echo *** No Empaths Found in Room 45
     echo *** Using NPC Empath!
     echo ##################################
     put #echo >Log #e600e6 **** No Empaths in Arch! Using Auto Puff****
     goto AUTOHEAL
LEAN:
     var leanCount 0
     action (empath) goto HEAL_DONE when ^%Empath nods to you\.|Your wounds are healed|%Empath coughs|^You are fully healed|You have leaned on me with|you are healed
     action put #parse ^%Empath nods to you. when ^%Empath whispers\, \"You have leaned on me with no wounds\.\"
     action (empath) on
LEAN_CONTINUE:
     math leanCount add 1
     pause 0.4
     send lean %Empath
     pause 0.5
     pause 0.00001
     pause 0.00001
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     gosub BLEEDERCHECK
     matchwait 65
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then return
     if (%leanCount > 5) then return
     goto LEAN_CONTINUE
###################################################################
# POCKET EMPATH
###################################################################
HEALING:
     if ($hidden = 1) then gosub UNHIDE
     if matchre("%PocketEmpath", "(?i)(OFF|NULL)") then goto AUTOHEAL
     pause 0.1
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then goto HEAL_DONE
     var Empath %PocketEmpath
     pause 0.2
POCKET_CHECK:
     pause 0.1
     matchre POCKET_CHECK ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre AUTOHEAL ^The syntax for this command is
     matchre AUTOHEAL FIND [player 1] [player 2]
     matchre POCKET_FIND %PocketEmpath
     put find %PocketEmpath
     matchwait 14
     echo ***** PERSONAL EMPATH NOT FOUND - USING AUTOHEALER
     goto AUTOHEAL
POCKET_FIND:
     echo
     echo *** Visiting Personal Empath
     echo
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     pause 0.2
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     pause 0.2
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ($invisible = 1) then gosub STOP_INVIS
POCKET_HEAL:
     pause
     gosub AUTOMOVE %EmpathRoom
     pause 0.5
     if ($invisible = 1) then gosub STOP_INVIS
     if !matchre("$roomplayers", "%PocketEmpath") then
          {
               echo
               echo *** PERSONAL EMPATH NOT FOUND!!!
               echo *** USING AUTO-HEALER
               echo
               goto AUTOHEAL
          }
     var leancount 0
LEAN_POCKET_EMPATH:
     if ($invisible = 1) then gosub STOP_INVIS
     math leancount add 1
     if matchre("$roomplayers", "%PocketEmpath") then
          {
               put lean %Empath
               gosub BLEEDERCHECK
               pause 30

          }
     gosub HEALTH_CHECK
     if ($needHealing = 0) then goto HEAL_DONE
     if (%leancount > 8) then goto AUTOHEAL
     goto LEAN_POCKET_EMPATH
## When in Crossing and health very low and bleeding, hit healer in Xing before Dok
CROSS_CHECKLOOP:
     pause 0.001
     if ("$zoneid" != "1") then goto CROSSCHECK_CONTINUE
     if matchre("%FANGCOVE", "(?i)ON") then
          {
               if (matchre("$game", "(DRF|DRX)") || ($UC_Premium = 1)) then
                    {
                         var Teleport 0
                         if ("$zoneid" = "42") then gosub AUTOMOVE gate
                         if ("$zoneid" = "67") then gosub AUTOMOVE east
                         gosub TO_SEACAVES
                         goto AUTOHEAL
                    }
          }
     gosub automove healer
     pause 0.01
     echo
     echo #####################
     echo * Low health & Bleeding!!
     echo * Stopping at Crossing Empath
     echo * For quick healing
     echo * Before hitting Dokt
     echo #####################
     echo
     put join list
     pause 0.1
     put lie
     pause 0.1
CROSS_CHECLOOP2:
     pause 5
     if (($health > 50) && ($bleeding = 0)) then goto CROSSCHECK_CONTINUE
     if (($health < 45) && ($bleeding = 1)) then goto CROSS_CHECLOOP2
     goto CROSSCHECK_CONTINUE
###################################################################
###################################################################
# AUTOHEALER / NPC HEALING SECTION
###################################################################
###################################################################
AUTOHEAL:
AUTOHEALER:
     ### TO HEALER
     var LOCATION AUTOHEAL
     var CurrentCity NULL
     var EmpathAlt 0
     var NoLoop 0
     action (empath) goto DONE_AUTOEMPATH when ^Kaiva crosses your name off|you look fine and healthy to me
     action (empath) goto DONE_AUTOEMPATH when ^Srela says, \"You're healthy|A little rest and exercise and you'll be good as new|Now move along\, I can't do anything more for you now\.
     action (empath) goto DONE_AUTOEMPATH when ^Dokt waves a large hand at you and says|Dokt give you a quick glance\, \"Look fine to me
     action (empath) goto DONE_AUTOEMPATH when ^You sit up|^Arthianne nudges you|I think you don't really need healing|you are well|Just between you and me and the Queen
     action (empath) goto DONE_AUTOEMPATH when Yrisa crosses $charactername's name from the list\.|What are you doing lying there with the wounded
     action (empath) goto DONE_AUTOEMPATH when ^Yrisa reaches into a pocket and produces a bite-sized piece of cebi root and a similar amount of hisan salve\.
     action (empath) var EmpathAlt 1;goto DONE_AUTOEMPATH when you and .+ (says|exclaims|mutters|whispers)\, \"You are not welcome here
     ##"
     action goto HEALER_DEBT when You start to join the list, but at unseen hand grips your shoulder
     action (empath) on
     action (PVPPLAYER) off
     action (combat) off
     action (stunned) off
     action (escape) off
     action (dead) off
     if ("$zoneid" = "108") then var CurrentCity MRISS
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     if (("$zoneid" = "1") && ($health < 50) && ($bleeding = 1) && ("%FANGCOVE" != "ON")) then goto CROSS_CHECKLOOP
     if (matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|112|114|116|127)\b") && matchre("%FANGCOVE", "(?i)ON")) then
          {
               if (matchre("$game", "(DRF|DRX)") || ($UC_Premium = 1)) then
                    {
                         var Teleport 0
                         if ("$zoneid" = "42") then gosub AUTOMOVE gate
                         if ("$zoneid" = "67") then gosub AUTOMOVE east
                         if ("$zoneid" = "112") then gosub AUTOMOVE leth
                         if ("$zoneid" = "127") then gosub AUTOMOVE south
                         gosub TO_SEACAVES
                    }
          }
CROSSCHECK_CONTINUE:
CROSSCHECK:
     if ("$zoneid" = "1") then gosub AUTOMOVE w gate
     if ("$zoneid" = "1") then gosub AUTOMOVE w gate
     if (("$zoneid" = "4") && ($roomid != 464)) then gosub AUTOMOVE 464
     if matchre("$zoneid","\b(34a|34|33a|32|31|33)\b") then gosub AUTOMOVE river
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "108") then
          {
               put .travel merk
               waitforre ^YOU ARRIVED\!
          }
     pause 0.001
     if ("$zoneid" = "1") then gosub AUTOMOVE w gate
     if ("$zoneid" = "4") then gosub AUTOMOVE 464
     if ("$zoneid" = "30") then gosub AUTOMOVE healer
     if ("$zoneid" = "42") then gosub AUTOMOVE healer
     if ("$zoneid" = "47") then gosub AUTOMOVE healer
     if ("$zoneid" = "61") then gosub AUTOMOVE healer
     if ("$zoneid" = "67") then
          {
               if ($UC_Premium = 1) then gosub AUTOMOVE premium healer
               if ($UC_Premium = 0) then gosub AUTOMOVE healer
          }
     if ("$zoneid" = "90") then gosub AUTOMOVE autopath
     if ("$zoneid" = "99") then gosub AUTOMOVE healer
     if ("$zoneid" = "106") then gosub AUTOMOVE healer
     if ("$zoneid" = "107") then gosub AUTOMOVE healer
     if ("$zoneid" = "116") then gosub AUTOMOVE healer
     if ("$zoneid" = "150") then gosub AUTOMOVE healer
     pause 0.001
     if ("$zoneid" = "1") then gosub AUTOMOVE w gate
     if (("$zoneid" = "4") && ($roomid != 464)) then gosub AUTOMOVE 464
     pause 0.001
     if (("$zoneid" = "4") && ($roomid != 464)) then gosub AUTOMOVE 464
     if (("$zoneid" = "4") && !matchre("$roomobjs", "dokt")) then gosub AUTOMOVE dokt
################################################################################################################
#### GO HERE AFTER GETTING BLACKLISTED FROM AN AUTO-HEALER - RECHECK LOCATION AND GO TO CORRECT EMPATH LOCATION
AT_EMPATH:
     if (("$zoneid" = "1") && ($roomid != 432)) then gosub AUTOMOVE healer
     if (("$zoneid" = "30") && ($roomid != 318)) then gosub AUTOMOVE healer
     if (("$zoneid" = "42") && ($roomid != 229)) then gosub AUTOMOVE healer
     if (("$zoneid" = "61") && ($roomid != 186)) then gosub AUTOMOVE healer
     if (("$zoneid" = "67") && !matchre($roomid, "(454|458)")) then gosub AUTOMOVE healer
     if (("$zoneid" = "116") && ($roomid != 380)) then gosub AUTOMOVE healer
     if (("$zoneid" = "150") && ($roomid != 17)) then gosub AUTOMOVE healer
EMPATHAT:
     ### SET HEALER NAME
     pause 0.001
     if ("$zoneid" = "150") then var Empath Yrisa
     if ("$zoneid" = "1") then var Empath Martyr Saedelthorp
     if ("$zoneid" = "4") then var Empath Dokt
     if ("$zoneid" = "30") then var Empath Fraethis
     if ("$zoneid" = "42") then var Empath Srela
     if ("$zoneid" = "47") then var Empath Gaktrhn
     if ("$zoneid" = "61") then var Empath Arthianna
     if (("$zoneid" = "67") && ($roomid = 458)) then var Empath Atladene
     if (("$zoneid" = "67") && ($roomid = 454)) then var Empath Quentin
     if ("$zoneid" = "90") then var Empath Onsuwayo
     if ("$zoneid" = "99") then var Empath Tanalae
     if ("$zoneid" = "116") then var Empath Shalvard
     if ("$zoneid" = "150") then var Empath Yrisa
     if ("$zoneid" = "107") then var Empath Yolesi
     if ($invisible = 1) then gosub STOP_INVIS
     if ($stunned) then waiteval (!$stunned)
     pause 0.001
     pause 0.001
     if ($invisible = 1) then gosub STOP_INVIS
     send join list
     wait
     pause 0.1
     pause 0.00001
     send demeanor neutral
     wait
     pause 0.1
     if ($UC_No.Contact = 1) then
          {
               put avoid !drag
               wait
          }
     pause 0.00001
     var WaitTime $gametime
FIRE_CHECK_NPC:
     var fire 0
     action var fire 1 when ^Your .+ is on fire
     gosub HEALTH_CHECK
     if (%fire = 1) then
          {
               put lie
               pause 0.5
               put roll
               pause 0.5
               pause 0.2
               put roll
               pause 0.5
               pause 0.2
               put roll
               pause 0.5
               pause 0.2
               goto FIRE_CHECK_NPC
          }
     var fire 0
     if ("$zoneid" = "4") then goto LIE_DOWN
     if ($prone = 1) then send sit
     if matchre ("$roomplayers", "(who is lying down|\(prone\))") then goto HEALTH_WAIT
     else goto AUTO_HEALER
HEALTH_ANYWAY:
     pause 0.1
     random 1 8
     goto HEALTH_%r
HEALTH_1:
     put 'Excuse me I'm bleeding out.. need to lay down
     goto LIE_DOWN
HEALTH_2:
     put 'Sorry very cut up, almost dead
     goto LIE_DOWN
HEALTH_3:
     put 'Must lie down.. dying
     goto LIE_DOWN
HEALTH_4:
     put wince
     goto LIE_DOWN
HEALTH_5:
     put 'Sorry in very bad shape, have to lie
     goto LIE_DOWN
HEALTH_6:
     put 'Sorry almost dead
     goto LIE_DOWN
HEALTH_7:
     put grimace
     goto LIE_DOWN
HEALTH_8:
     goto LIE_DOWN
AUTO_HEALER:
     var LAST AUTO_HEALER
     pause 0.1
     pause 0.2
     if matchre ("$roomplayers", "Kinoko who is lying down") then goto LIE_DOWN
     if matchre ("$roomplayers", "Aksel who is lying down") then goto LIE_DOWN
     if matchre ("$roomplayers", "(who is lying down|\(prone\))") then goto HEALTH_WAIT
LIE_DOWN:
     put avoid !drag
     if ((%healtotal > 0) && ($health > 50)) then goto HEAL_WAIT_PAUSE
LIE_DOWN_2:     
     var empathloop 0
     if matchre("$roomobjs", "(Shalvard|Dokt|Arthianna|Kaiva|Martyr Saedelthorp|Fraethis|Srela|Yrisa|Quentin|Elys)") then var Empath $1
     pause 0.001
     send lie
     pause 0.5
     pause 0.2
     gosub BLEEDERCHECK
     if ($standing = 1) then send lie
     pause 0.5
     if ($standing = 1) then send lie
     pause 0.2
EMPATH_WAIT:
     math empathloop add 1
     if (("$guild" = "Empath") && ($Utility.Ranks > 200)) then gosub EMPATH_HEAL
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then goto DONE_AUTOEMPATH
     if (%empathloop > 13) then goto EMPATH_HEALTH_CHECK
     if (%Playing = 0) then gosub PLAY
     if ($standing = 1) then send lie
     if ($sitting) then goto EMPATH_HEALTH_CHECK
     gosub BLEEDERCHECK
     if ($standing = 1) then send lie
     #if matchre ("$roomplayers", "who is lying down") && ($bleeding = 0) then goto HEALTH_WAIT
     put exp
     pause
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
     if ($UC_Crystal = 1) then gosub CRYSTAL_TIMER
     pause 0.2
     if (($UC_Textbook = 1) && !matchre("$righthand $lefthand", "%TEXTBOOK.TYPE")) then gosub GET my %TEXTBOOK.TYPE
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub TEXTBOOK_READ average
     pause 0.2
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub PUT put %TEXTBOOK.TYPE in my $UC_Container.Textbook
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub STOW my %TEXTBOOK.TYPE
     if ($standing = 1) then send lie
     if ($sitting) then goto EMPATH_HEALTH_CHECK
     pause
     put look
     pause 60
     goto EMPATH_WAIT
EMPATH_HEALTH_CHECK:
     gosub HEALTH_CHECK_ALL
     if (($sitting) && ($zoneid = 30)) then goto DONE_AUTOEMPATH
     if (%empathloop > 55) then goto DONE_AUTOEMPATH
     if ($needHealing = 0) then goto DONE_AUTOEMPATH
     if !matchre("$roomobjs", "(Shalvard|Dokt|Arthianna|Kaiva|Martyr Saedelthorp|Fraethis|Srela|Yrisa|Quentin|Elys)") then goto AUTOHEAL
     pause 5
     goto EMPATH_WAIT
HEALTH_WAIT:
HEALTH.WAIT:
     pause 0.01
     var WaitTime $gametime
     var healwaitloop 0
     var healcounter 0
     var healtotal 0
     if (("$zoneid" = "4") && ("$roomid" != "464")) then gosub AUTOMOVE 464
     if matchre("$roomplayers", "(who is lying down|\(prone\))") then var healtotal 1
     var healingwaitlist $roomplayers
     eval healingwaitlist replacere("%healingwaitlist", "Also here\: |\, |\.| and ", "|")
     eval healingwaitlist replacere("%healingwaitlist", "\|(.*?\s?)(?=\S+(\|| who|| \(\w+\)))", "|")
     eval healingwaitlist replacere("%healingwaitlist", "( who (?:is|has) .*?\|)", "|")
     eval healingwaitlist replacere("%healingwaitlist", "(\|Lord\||\|Bad\|)", "|")
	# eval players replace("%players", " and", ",")
	# eval players replace("%players", ".", ", ")
	eval healingwaitlist replacere("%healingwaitlist", " who is kneeling,", "|")
	eval healingwaitlist replacere("%healingwaitlist", " \(\w+\)", "")
     eval healingwaitlist replacere("%healingwaitlist", "Hitler Bad\,\s", "")
     eval healingwaitlist replacere("%healingwaitlist", "\sand", "|")
     eval healingwaitlist replacere("%healingwaitlist", "\swho\b[^,]*,", "|")
     eval healingwaitlist replacere("%healingwaitlist", "([\w'-]+\s){0,5}", "")
     eval healingwaitlist replacere("%healingwaitlist", "\,\s+", "|")
     eval healingwaitlist replacere("%healingwaitlist", "\.", ", ")
     eval healingwaitlist replacere("%healingwaitlist", " \|", "")
	eval healingwaitlist replace("%healingwaitlist", ", ", "|")
	eval healingwaitlist replacere("%healingwaitlist", "\|+", "|")
	eval healingwaitlist replacere("%healingwaitlist", "^\|", "")
     # eval healingwaitlist replacere("%healingwaitlist", "\|$", "")
     # eval healingwaitlist replacere("%healingwaitlist", "\(.*\)", "")
     # eval healingwaitlist replacere("%healingwaitlist", "(\|$)", "")
     eval healtotal count("%healingwaitlist", "|")
     echo
     echo ###############
     echo ** HEALING WAITLIST
     echo ** %healtotal people
     echo ** %healingwaitlist
     echo ###############
     echo
     pause 0.4
     # eval healtotal count("%healingwaitlist", "|%healingwaitlist")
     var Checked.%healingwaitlist(1) 0
     if (%healtotal > 1) then var Checked.%healingwaitlist(2) 0
     if (%healtotal > 2) then var Checked.%healingwaitlist(3) 0
     if (%healtotal > 3) then var Checked.%healingwaitlist(4) 0
     if (%healtotal > 4) then var Checked.%healingwaitlist(5) 0
     if (%healtotal > 5) then var Checked.%healingwaitlist(6) 0
     if (%healtotal > 6) then var Checked.%healingwaitlist(7) 0
     if (%healtotal > 7) then var Checked.%healingwaitlist(8) 0
     if (%healtotal > 8) then var Checked.%healingwaitlist(9) 0
     if (%healtotal > 9) then var Checked.%healingwaitlist(10) 0
     if (%healtotal > 10) then var Checked.%healingwaitlist(11) 0
     if (%healtotal > 11) then var Checked.%healingwaitlist(12) 0
     if (%healtotal > 12) then var Checked.%healingwaitlist(13) 0
     if (%healtotal > 13) then var Checked.%healingwaitlist(14) 0
     if (%healtotal > 14) then var Checked.%healingwaitlist(15) 0
     if (%healtotal > 15) then var Checked.%healingwaitlist(16) 0
     pause 0.02
     if (($UC_Herbs = 1) && ($bleeding = 1)) then gosub HERB_HEALING
     pause 0.02
     if ($sitting = 0) then send sit
     pause 0.2
     put look
     pause 0.2
     pause 0.2
HEAL_WAIT_PAUSE:
     gosub clear
     var healcounter 0
     math healwaitloop add 1
     pause 0.1
     # action math healtotal subtract 1 when sits up|stands up|leaps up
     gosub EMPATHWAIT_TIMER
     if (%EmpathWaitTime > 1500) then goto LIE_DOWN_2
     if (%healtotal < 1) then goto LIE_DOWN
     if ("$roomplayers" = "") then var healtotal 0
     gosub HEALING_ROOMCHECK
     if (%healtotal < 1) then goto LIE_DOWN
     echo
     echo ######################
     echo *** Healing Wait list: %healingwaitlist
     if (%healtotal > 1) then echo *** %healtotal people in line
     if (%healtotal = 1) then echo *** %healtotal person in line
     echo ######################
     echo
     pause 0.5
     gosub BLEEDERCHECK
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then goto DONE_AUTOEMPATH
     gosub stowing
     if matchre("$roomplayers", "(the body of .* who is lying down|\(dead\))") then goto LIE_DOWN_2
     if matchre("$roomplayers", "(Kinoko|Aksel) (who is lying down|\(prone\))") then goto LIE_DOWN_2
     if !matchre("$roomplayers", "(who is lying down|\(prone\))") then goto AUTO_HEALER
     if (($health < 50) && ($bleeding = 1)) then goto HEALTH_ANYWAY
     pause
     if (($UC_Textbook = 1) && !matchre("$righthand $lefthand", "%TEXTBOOK.TYPE")) then gosub GET my %TEXTBOOK.TYPE
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub TEXTBOOK_READ fast
     pause 0.1
     var healcounter 0
     if ("$roomplayers" = "") then var healtotal 0
     if (%healtotal < 1) then goto LIE_DOWN
     gosub HEALING_ROOMCHECK
     if (%healtotal < 1) then goto LIE_DOWN
     pause 3
     var healcounter 0
     gosub HEALING_ROOMCHECK
     if (%healtotal < 1) then goto LIE_DOWN
     pause 3
     var healcounter 0
     gosub HEALING_ROOMCHECK
     if (%healtotal < 1) then goto LIE_DOWN
     pause 3
     if (%healwaitloop > 5) then
          {
               send look
               var healwaitloop 0
          }
     pause
     goto HEAL_WAIT_PAUSE
HEALING_ROOMCHECK:
     pause 0.001
     if ("$roomplayers" = "") then
          {
               var healtotal 0
               return
          }
     if (%healcounter > %healtotal) then return
     if (%healcounter > 10) then return
     var healplayer %healingwaitlist(%healcounter)
     var %healplayer.guild NULL
     var %healplayer.wounds 0
     pause 0.001
     math healcounter add 1
     if ("%healplayer" = "") then goto HEALING_ROOMCHECK
     echo
     echo *** CHECKING %healplayer
     echo
     # if !contains("$roomplayers", "%healingwaitlist) then goto LIE_DOWN

     ### CHECKS IF THE PLAYER IS EMPATH OR NOT - REMOVES EMPATHS FROM LIST
     if (%Checked.%healplayer = 0) then gosub LOOK_CHECK %healplayer
     if matchre("%%healplayer.guild", "Empath") then goto HEALING_REPLACE

     ### CHECKS IF THE PLAYER HAS WOUNDS - REMOVES FROM LIST IF NO WOUNDS
     gosub WOUND_CHECK
     if (%%healplayer.wounds = 0) then goto HEALING_REPLACE

     ### SET A TIMER FOR THE PERSON - WILL REMOVE THEM FROM THE LIST AFTER CERTAIN TIME (8+ mins)
     gosub HEALPLAYER_TIMER
     ### matchre("$roomobjs", "%healplayer (who is sitting|\(sitting\))")
     if (!matchre("$roomplayers", "%healplayer") || matchre("%%healplayer.guild", "Empath") || (%%healplayer.timer > 480) || (%%healplayer.wounds = 0)) then
          {
               goto HEALING_REPLACE
          }
     if matchre("$roomplayers", "%healplayer who is lying down") then
          {
               pause 0.1
               goto HEALING_ROOMCHECK
          }
     pause 0.1
     goto HEALING_ROOMCHECK
HEALING_REPLACE:
     eval healingwaitlist replacere("%healingwaitlist", "%healplayer|", "")
     eval healingwaitlist replacere("%healingwaitlist", "|%healplayer", "")
     eval healingwaitlist replacere("%healingwaitlist", "\|+" "|")
     eval healingwaitlist replacere("%healingwaitlist", "^\|" "")
     math healtotal subtract 1
     math healcounter subtract 1
     echo
     echo #####################
     echo *** REMOVING: %healplayer from Waitlist
     echo *** New waitlist count: %healtotal
     echo *** Remaining list: %healingwaitlist
     echo #####################
     echo
     pause 0.5
     goto HEALING_ROOMCHECK
LOOK_CHECK:
     pause 0.001
     matchre EMPATH_YES ^You see .* Empath\.
     matchre EMPATH_NO ^You see .* (Cleric|Bard|Thief|Ranger|Paladin|Moon Mage|Warrior Mage|Barbarian|Trader|Necromancer)\.
     matchre EMPATH_NO .* is totally enveloped in a dark cloak
     put look %healplayer
     matchwait 2
     var Checked.%healplayer 1
     var %healplayer.guild NULL
     return
EMPATH_YES:
     echo ** %healplayer is an EMPATH
     var Checked.%healplayer 1
     var %healplayer.guild Empath
     return
EMPATH_NO:
     var Checked.%healplayer 1
     var %healplayer.guild NULL
     return
WOUND_CHECK:
     pause 0.0001
     matchre WOUNDS_YES scratches|scuffing|abrasions|bruises|cuts|(cracked|crushed) skull|pulpy stump|black and blue|bruised|swollen|slashes|gaping holes|shattered|difficulty
     matchre WOUNDS_YES ugly stump|skin rash|body rash|boils and sores|bleeding|twitching|twitch|clouded (right|left)|paralyzed|emaciated|starvation|painful|numbness
     matchre WOUNDS_NO in good shape\.|.* is totally enveloped in a dark cloak
     put look %healplayer
     matchwait 2
WOUNDS_YES:
     echo ** %healplayer HAS WOUNDS
     var %healplayer.wounds 1
     return
WOUNDS_NO:
     echo ** %healplayer HAS NO WOUNDS
     var %healplayer.wounds 0
     return
HEALPLAYER_TIMER:
     delay 0.0001
     if (matchre("%Time.%healplayer", "$^") || !matchre("%Time.%healplayer", "(\d+)")) then var Time.%healplayer $gametime
     evalmath %healplayer.timer ($gametime - %Time.%healplayer)
     # echo %healplayer Timer: %%healplayer.timer
     if (%%healplayer.timer < 5) then echo ** Timer started for %healplayer
     if (%%healplayer.timer > 480) then echo *** %healplayer has been in the room for over 8 minutes! Removing from HealingList!
     return
########################################
HEALER_DEBT:
     echo ############################
     echo ** DEBT TOO HIGH TO GET HEALED!!!!
     echo ** ATTEMPTING TO PAY DEBT
     echo ############################
     pause
     if ("$zoneid" = "150") then
          {
               gosub LEAVE_SEACAVE
               pause 0.2
               if ("$zoneid" = "66") then gosub AUTOMOVE east
               if ("$zoneid" != "67") then
                    {
                         put .travel shard
                         waitforre ^YOU ARRIVED\!
                    }
          }
     pause 0.1
     var debt 1
     gosub DEBT
     var debt 0
     goto AUTOHEAL
########################################
DONE_AUTOEMPATH:
HEAL_DONE:
HEALINGDONE:
     action (empath) off
     action (combat) off
     var empathloop 0
     if ($standing = 0) then gosub STAND
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub PUT put %TEXTBOOK.TYPE in my $UC_Container.Textbook
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub STOW my %TEXTBOOK.TYPE
     pause 0.1
     pause 0.01
     put avoid drag
     pause 0.01
     if ((%EmpathAlt = 1) && (%NoLoop = 0)) then
          {
               var NoLoop 1
               put #echo >Log #FF3399 ** BLACKLISTED FROM %Empath - Looking for Alternate!
               echo
               echo ###########################
               echo # BLACKLISTED FROM %Empath !!
               echo # LOOKING FOR ALTERNATE EMPATH
               echo ###########################
               echo
               pause 0.7
               if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
               if (("$zoneid" = "67") && ($roomid = 458)) then
                    {
                         gosub TO_SEACAVE
                         goto AT_EMPATH
                    }
               if ("$zoneid" = "67") then gosub TRAVEL hib
               pause 0.001
               if ("$zoneid" = "66") then gosub AUTOMOVE east
               pause 0.001
               if ("$zoneid" = "1") then gosub TRAVEL dokt
               if ("$zoneid" = "4") then gosub TRAVEL cross
               if ("$zoneid" = "30") then gosub TRAVEL theren
               if ("$zoneid" = "42") then gosub TRAVEL river
               if ("$zoneid" = "61") then gosub TRAVEL cross
               if ("$zoneid" = "116") then gosub TRAVEL shard
               pause 0.1
               if !matchre("$zoneid", "\b(1|30|42|61|67|116)\b") then
                    {
                         put #echo >Log #FF3399 ** NO ALTERNATE NEARBY EMPATHS!
                         echo
                         echo ###########################
                         echo # NO NEARBY ALTERNATIVE AUTO-EMPATHS!
                         echo # ON YOUR OWN FOR HEALING!
                         echo # CHECKING FOR ANY HERBS NEXT...
                         echo ###########################
                         echo
                         pause 0.7
                         goto HEAL_DONE_3
                    }
               goto AT_EMPATH
          }
HEAL_DONE_2:
     put #echo >Log Pink *** Healed by %Empath
HEAL_DONE_3:
     action remove You start to join the list, but at unseen hand grips your shoulder
     action remove ^%Empath nods to you\.|Your wounds are healed|%Empath coughs|^You are fully healed
     action remove sits up|stands up|leaps up
     var EmpathAlt 0
     var NoLoop 0
     unvar healingwaitlist
     unvar healwaitloop
     unvar healcounter
     unvar healtotal
     unvar healplayer
     ###############################################
     ### HERB CHECKING
HERBS:
     gosub HEALTH_CHECK_ALL
     if (($needHealing = 1) && ($UC_Herbs = 1)) then gosub HERB_HEALING
     ###############################################
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if matchre("%command", "(?i)heal") then
          {
               echo *** HEAL COMMAND WAS USED -
               echo *** SETTING UP OUR SPELLS NOW
               var buff.tracker 0
               gosub SPELL_SETUP_START
          }
     # if (("$game" = "DR") && ($zoneid = 30)) then gosub EYE_HERBS
     # if ("$zoneid" = "150") && ($roomid != 45) then gosub AUTOMOVE 45
     goto HEALTH_RUN_DONE
##############################################################################
##################################
#  EMPATH SELF-HEALING ROUTINE   #
##################################
EMPATH_HEAL:
     var empathloop 0
     pause 0.001
     if !matchre("%abbrevs", "(?i)HEAL") then goto HEAL_ERROR
     if ($Utility.Ranks < 80) then goto HEAL_ERROR
     echo
     echo ###############
     echo *** EMPATH SELF-HEALING
     echo ###############
     echo
EMPATH_HEAL_1:
     if (("$zoneid" = "4") && ("$roomid" = "464")) then gosub AUTOMOVE 460
     gosub BLEEDERCHECK
     if !matchre("%abbrevs", "(?i)REGEN") then
          {
               echo *** Regenerate spell unknown.. skipping to Heal
               goto EMPATH_HEAL_2
          }
     var regen.mana 5
     if (%Playing = 1) then gosub STOP_PLAY
     if ($Utility.Ranks < 300) then var regen.mana 5
     if (($Utility.Ranks >= 300) && ($Utility.Ranks < 400)) then var regen.mana 7
     if (($Utility.Ranks >= 400) && ($Utility.Ranks < 500)) then var regen.mana 9
     if (($Utility.Ranks >= 500) && ($Utility.Ranks < 700)) then var regen.mana 11
     if (($Utility.Ranks >= 700) && ($Utility.Ranks < 900)) then var regen.mana 17
     if ($Utility.Ranks >= 900) then var regen.mana 22
     if ($SpellTimer.Regenerate.active = 1) then goto EMPATH_HEAL_2
     pause 0.1
     gosub PREPARE REGENERATE %regen.mana
     pause 23
     gosub CAST
     pause
EMPATH_HEAL_2:
     var heal.mana 15
     pause 0.2
     gosub RELEASE spell
     pause 0.5
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then goto EMPATH_HEAL_DONE
     if ($SpellTimer.Heal.active = 1) then goto EMPATH_HEAL_3
     if ($Utility.Ranks < 240) then var heal.mana 15
     if (($Utility.Ranks > 240) && ($Utility.Ranks <= 400)) then var heal.mana 20
     if (($Utility.Ranks > 400) && ($Utility.Ranks <= 600)) then var heal.mana 23
     if (($Utility.Ranks > 600) && ($Utility.Ranks <= 750)) then var heal.mana 27
     if (($Utility.Ranks > 750) && ($Utility.Ranks <= 900)) then var heal.mana 32
     if (($Utility.Ranks > 900) && ($Utility.Ranks <= 1000)) then var heal.mana 40
     if ($Utility.Ranks > 1000) then var heal.mana 50
     gosub PREPARE HEAL %heal.mana
     pause 23
     gosub CAST
     pause 0.1
EMPATH_HEAL_3:
     pause 0.1
     pause 0.1
     math empathloop add 1
     if (%empathloop > 19) then goto EMPATH_HEAL_DONE
     if ($SpellTimer.Heal.active = 0) then goto HEAL_ERROR
     if ($SpellTimer.Heal.active = 1) then goto EMPATH_HEAL_2
     echo
     echo #################
     echo ** PAUSING NOW TO LET
     echo ** HEAL / REGEN TICK
     echo #################
     echo
     pause 0.5
     if ($health < 90) then
          {
               var vh.mana 5
               if ($Utility.Ranks < 240) then var vh.mana 5
               if (($Utility.Ranks > 240) && ($Utility.Ranks <= 400)) then var vh.mana 15
               if (($Utility.Ranks > 400) && ($Utility.Ranks <= 600)) then var vh.mana 30
               if ($Utility.Ranks > 600) then var vh.mana 40
               gosub PREPARE VH %vh.mana
               pause 18
               gosub CAST
               pause 0.5
          }
     pause 2
     if (%RawChanneling = 0) then
          {
               send harness 3
               pause 2
               pause 0.2
               send harness 3
               pause 2
          }
     pause 10
     gosub BLEEDERCHECK
     echo
     echo ################
     echo ** PAUSING TO LET
     echo ** HEAL / REGEN TICK
     echo ################
     echo
     pause 8
     if (%RawChanneling = 0) then
          {
               send harness 3
               pause 2
               pause 0.2
               send harness 3
               pause 2
          }
     pause 9
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then goto EMPATH_HEAL_DONE
     goto EMPATH_HEAL_3
HEAL_ERROR:
     echo
     echo #########################
     echo ** EMPATH SELF-HEAL ERROR!
     echo ** YOU DON'T KNOW THE HEAL SPELL
     echo ** OR NOT ENOUGH UTILITY RANKS!
     echo ** Getting Healed from other means
     echo #########################
     echo
     pause 0.2
     return
EMPATH_HEAL_DONE:
     pause 0.2
     echo
     echo #######################
     echo ** EMPATH SELF-HEALING COMPLETE!
     echo #######################
     echo
     pause 0.2
     gosub RELEASE spell
     return
#########################################################################################
### NECRO HEALING - MATERIAL HEALING
#########################################################################################
NECRO_MATERIAL:
     var materialloop 0
     if !matchre("%spelltimer", "(?i)Devour") then return
     if ("$guild" != "Necromancer") then return
     if !matchre("$UC_HomeCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub HOME_CITY_GO
     if matchre("$zoneid", "\b(1|30|40|42|61|66|67|99|106|107|108|112|114|116|127)\b") then
          {
               if (("$game" = "DRF") || (($UC_Premium = 1) && ("%FANGCOVE" = "ON"))) then gosub TO_SEACAVE
          }
     ### CHOOSING ROOM OUTSIDE OF TOWN
     if ("$zoneid" = "1") then gosub AUTOMOVE 170
     if ("$zoneid" = "1") then gosub AUTOMOVE east
     if ("$zoneid" = "8") then gosub AUTOMOVE 168
     if ("$zoneid" = "30") then gosub AUTOMOVE E gate
     if ("$zoneid" = "31") then gosub AUTOMOVE 6
     if ("$zoneid" = "33") then gosub AUTOMOVE 115
     if ("$zoneid" = "47") then gosub AUTOMOVE 376
     if ("$zoneid" = "42") then gosub AUTOMOVE gate
     if ("$zoneid" = "40") then gosub AUTOMOVE 216
     if ("$zoneid" = "61") then gosub AUTOMOVE cross
     if ("$zoneid" = "60") then gosub AUTOMOVE 39
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE 641
     if ("$zoneid" = "90") then gosub AUTOMOVE 662
     if ("$zoneid" = "95") then gosub AUTOMOVE 5
     if ("$zoneid" = "99") then gosub AUTOMOVE west
     if ("$zoneid" = "98") then gosub AUTOMOVE 325
     if ("$zoneid" = "106") then gosub AUTOMOVE pool
     if ("$zoneid" = "107") then gosub AUTOMOVE 259
     if ("$zoneid" = "116") then gosub AUTOMOVE boar
     if ("$zoneid" = "126") then gosub AUTOMOVE 56
     if ("$zoneid" = "127") then gosub AUTOMOVE 29
     if (("$zoneid" = "150") && ($Athletics.Ranks > 45)) then gosub AUTOMOVE 45
     pause 0.1
     pause 0.1
NECRO_MATERIAL_1:
     math materialloop add 1
     pause 0.5
     gosub stowing
     if !matchre("$righthand $lefthand", "material") then gosub GET my material
     pause 0.7
     pause 0.5
     if !matchre("$righthand $lefthand", "material") then goto NECRO_MATERIAL_NONE
     if matchre("$lefthand", "material") then gosub SWAP
     pause 0.2
     gosub DEVOUR
     pause
     if ("$preparedspell" != "None") then gosub RELEASE spell
     pause 0.5
     if !matchre("$righthand $lefthand", "material") then
          {
               math Necro.Material subtract 1
          }
     gosub HEALTH_CHECK
     if ($needHealing = 0) then goto NECRO_MATERIAL_DONE
     if (%materialloop > 6) then goto NECRO_MATERIAL_DONE
     pause 0.5
     goto NECRO_MATERIAL_1

NECRO_MATERIAL_NONE:
     echo #############################
     echo *** RAN OUT OF NECRO MATERIAL!
     echo #############################
     pause 0.5
     return
NECRO_MATERIAL_DONE:
     echo ##################################
     echo *** FINISHED HEALING VIA NECRO MATERIAL!
     echo ##################################
     put #echo >Log Pink *** Healed Self w/ Necro Material
     return

#########################################################################################
### HERB HEALING MODULE - ATTEMPTING SELF-HEALING WITH HERBS
#########################################################################################
HERB.HEAL:
HERB_HEAL:
     var herbloop 0
     if matchre("$zoneid", "\b(1|30|40|42|61|66|67|99|106|107|108|112|114|116|127)\b") then
          {
               if (("$game" = "DRF") || (($UC_Premium = 1) && ("%FANGCOVE" = "ON"))) then gosub TO_SEACAVE
          }
     if ("$guild" = "Necromancer") then
          {
               ### CHOOSING ROOM OUTSIDE OF TOWN
               if ("$zoneid" = "1") then gosub AUTOMOVE 170
               pause 0.1
               if ("$zoneid" = "8") then gosub AUTOMOVE 168
               if ("$zoneid" = "30") then gosub AUTOMOVE 203
               pause 0.1
               if ("$zoneid" = "31") then gosub AUTOMOVE 101
               if ("$zoneid" = "47") then gosub AUTOMOVE 376
               if ("$zoneid" = "42") then gosub AUTOMOVE gate
               pause 0.1
               if ("$zoneid" = "40") then gosub AUTOMOVE 288
               if ("$zoneid" = "61") then gosub AUTOMOVE cross
               if ("$zoneid" = "60") then gosub AUTOMOVE 39
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "66") then gosub AUTOMOVE 641
               if ("$zoneid" = "90") then gosub AUTOMOVE 662
               if ("$zoneid" = "95") then gosub AUTOMOVE 5
               if ("$zoneid" = "99") then gosub AUTOMOVE west
               if ("$zoneid" = "98") then gosub AUTOMOVE 325
               if ("$zoneid" = "106") then gosub AUTOMOVE 224
               if ("$zoneid" = "107") then gosub AUTOMOVE 259
               if ("$zoneid" = "116") then gosub AUTOMOVE boar
               if ("$zoneid" = "126") then gosub AUTOMOVE 56
               if ("$zoneid" = "127") then gosub AUTOMOVE 29
               if (("$zoneid" = "150") && ($Athletics.Ranks > 45)) then gosub AUTOMOVE 45
          }
HERB_HEAL_1:
     pause 0.2
     gosub INVENTORY_PRECHECK SKIP
     var nocheck NULL
HERB_HEAL_START:
     pause 0.5
     gosub HERB_HEALING
     pause
     gosub BLEEDERCHECK
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then goto HEALTH_RUN_DONE
     echo *** Letting the herbs run their course...
     pause 45
     gosub BLEEDERCHECK
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then goto HEALTH_RUN_DONE
     echo *** Letting the herbs run their course...
     pause 60
     gosub BLEEDERCHECK
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then goto HEALTH_RUN_DONE
     echo *** Letting the herbs run their course...
     pause 45
     gosub BLEEDERCHECK
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then goto HEALTH_RUN_DONE
     echo *** Letting the herbs run their course...
     pause 45
     gosub HEALTH_CHECK_ALL
     if ($needHealing = 0) then goto HEALTH_RUN_DONE
     math herbloop add 1
     if (%herbloop > 3) then goto HEALTH_RUN_DONE
     goto HERB_HEAL_START

HERB_HEAL_DONE:
     echo ##################################
     echo *** HEALED SELF WITH HERBS!
     echo ##################################
     put #echo >Log Pink *** Healed Self with Healing Herbs!
     goto HEALTH_RUN_DONE
#########################################################################################
#########################################################################################
DONE_NECROHEALING:
     pause 0.1
     var NecroHealing 0
     echo #################
     echo   DONE WITH NECRO HEALING
     echo #################
     gosub clear
     pause 0.001
     gosub stowing
     pause 0.1
     #### ESCAPE TO NEAREST CITY
     var GOSUBBING ON
     var escaping ON
     gosub ESCAPE_NOW
     var GOSUBBING OFF
     #### DONE ESCAPING TO CITY
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     put #var UC_Combat.Last 1500
HEALTH_RUN_DONE:
HEALTHDONE:
     var town 1
     var NEXTSUB DISARM_RUN
     var LAST HEALTH_RUN_DONE
     action (empath) off
     action (skip) on
     action (dead) on
     echo ############
     echo ***** HEALING DONE!
     echo ############
     pause 0.001
     if ($health < 80) then
          {
               echo
               echo **** HEALTH STILL LOW!
               echo **** PAUSING TO RECOVER HEALTH BEFORE CONTINUING!
               echo
               if ($health < 80) then waiteval ($health > 80)
          }
     action (combat) on
     action (stunned) on
     action (escape) on
     if ("$zoneid" = "4") then gosub AUTOMOVE crossing
     pause 0.1
     if ($UC_Armor.Noob = 1) then gosub ARMOR_REMOVE
     pause 0.001
     ### CHECK IF WE ENTERED FC IN MRISS - IF SO TAKE THE FERRY TO MERKRESH FOR TOWN RUN
     if (matchre("%CurrentCity", "(?i)MRISS") && ("$zoneid" = "150")) then
          {
               gosub LEAVE_SEACAVE
               var hometown MRISS
               if contains("$roomobjs", "arisen") then
                    {
                         var arise_command release
                         gosub ARISE_COMMAND
                    }
               if ("$roomid" != "151") then gosub AUTOMOVE 151
               waitforre glides into the dock|A loud voice
               if ($invisible = 1) then gosub STOP_INVIS
               put go galley
               pause
               waitforre reaches the dock
               put go dock
               pause 0.5
          }
     if (%TicketCheck = 1) then gosub INVENTORY_PRECHECK
     if matchre("$guild", "%MAGICUSER") then gosub PERCEIVE_TIMER
     pause 0.01
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
#################################################
### SPECIAL SECTION HERE TO RETURN TO LAST LABEL
### ~IF~ WE ESCAPED FOR HEALING DURING A TOWN RUN MODULE
     if matchre("%SAVED", "(MAGICALRESEARCH|CUSTOMCHECK)") then
          {
               echo
               echo ###############################################
               echo *** RETURNING TO LAST SAVED LABEL BEFORE HEALING: %SAVED
               echo ###############################################
               echo
               goto %SAVED
          }
     if (%burgleheal = 1) then
          {
               var burgleheal 0
               goto DISARM_RUN
          }
###############################
# BURGLING RUN
###############################
BURGLE:
BURGLE_CHECK:
     var NEXTSUB DONE_BURGLING
     var LAST BURGLE_CHECK
     var CURRENT Burgling
     gosub STATUSBAR
     var townRun 0
     ####
     if ($invisible = 1) then gosub STOP_INVIS
     gosub TOWNRUN_TIMERS
     ####
     if ($UC_bagsFull = 1) then goto DISARM_RUN
     if ($UC_Burgle = 0) then goto DISARM_RUN
     if ("$guild" = "Paladin") then goto DISARM_RUN
     if (($Thievery.Ranks = 1750) && ($Athletics.Ranks = 1750) && ($Locksmithing.Ranks = 1750)) then
          {
               echo
               echo #############################
               echo ** ALL BURGLE SKILLS ALREADY CAPPED!!
               echo ** (Thievery / Athletics / Locksmithing )
               echo ** SKIPPING BURGLE RUN!
               echo #############################
               echo
               pause 0.5
               goto DISARM_RUN
          }
     if ("$zoneid" = "34a") then
          {
               put .travel river
               waitforre ^YOU ARRIVED
          }
BURGLE_TIMER:
     gosub clear
     gosub CLEAR_MATCHTABLE
     pause 0.00001
     pause 0.00001
     pause 0.00001
     matchre BURGLE_TIMER \.\.\.wait|still stunned|^Sorry\, you may only
     matchre BURGLE_COOLDOWN ^You should wait at least (.+) roisaen for the heat to die down\.
	matchre BURGLE_START ^The heat has died down from your last caper\.
	put burgle recall
	matchwait 30
     goto DONE_BURGLING

BURGLE_COOLDOWN:
     var cooldown $1
     if (%cooldown < 5) then goto BURGLE_PAUSE
     echo #######################
     echo *** BURGLE STILL ON COOLDOWN
     echo *** MORE THAN 5 MINUTES LEFT ON TIMER
     echo *** SKIPPING BURGLE!
     echo #######################
     goto DONE_BURGLING
BURGLE_PAUSE:
     echo *** Waiting for Burgle Cooldown! - %cooldown minutes remaining
     if (%Playing = 0) then gosub PLAY
     pause 45
     goto BURGLE_TIMER

BURGLE_START:
     action (jail) on
     var LAST BURGLE_START
     echo ###########
     echo *** BURGLING RUN!
     echo ###########
     put #var BurgleItem1 NULL
     put #var BurgleItem2 NULL
     put #var BurgleItem3 NULL
     put #var BurgleItem4 NULL
     gosub stowing
     #### TO BURGLE LOCATION (Preferably w/ no guards)
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     pause 0.00001
     pause 0.00001
     if ("$zoneid" = "1") then
          {
               gosub AUTOMOVE 46
               gosub AUTOMOVE 172
          }
     if matchre("$zoneid", "(126|116|123)") then
          {
               gosub OPEN_CONTAINERS
               put .travel boar
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE w gate
     if ("$zoneid" = "4") then gosub AUTOMOVE 115
     if ("$zoneid" = "8") then gosub AUTOMOVE NTR
     if ("$zoneid" = "7") then gosub AUTOMOVE caravansary
     if ("$zoneid" = "30") then gosub AUTOMOVE W gate
     if ("$zoneid" = "30") then gosub AUTOMOVE W gate
     pause 0.00001
     pause 0.00001
     if ("$zoneid" = "30") then gosub AUTOMOVE W gate
     if ("$zoneid" = "33") then gosub AUTOMOVE 7
     if ("$zoneid" = "42") then gosub AUTOMOVE gate
     if ("$zoneid" = "40") then gosub AUTOMOVE 237
     if ("$zoneid" = "47") then gosub AUTOMOVE 336
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "68") then gosub AUTOMOVE 22
     if ("$zoneid" = "69") then gosub AUTOMOVE 205
     if ("$zoneid" = "66") then gosub AUTOMOVE 94
     if ("$zoneid" = "62") then gosub AUTOMOVE leth
     if ("$zoneid" = "61") then gosub AUTOMOVE ilaya
     if ("$zoneid" = "90") then gosub AUTOMOVE 25
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "99") then gosub AUTOMOVE 219
     if ("$zoneid" = "107") then gosub AUTOMOVE 4
     if ("$zoneid" = "108") then gosub AUTOMOVE 154
     if ("$zoneid" = "112") then gosub AUTOMOVE 16
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "116") then gosub AUTOMOVE boar
     if ("$zoneid" = "126") then gosub AUTOMOVE boar
     if ("$zoneid" = "127") then gosub AUTOMOVE 31
     if ("$zoneid" = "150") then gosub AUTOMOVE 45
     pause 0.00001
     pause 0.00001
     ### DOUBLE CHECKS FOR CORRECT BURGLE ROOM
     if (("$zoneid" = "66") && ("$roomid" != "94")) then gosub AUTOMOVE 94
     if (("$zoneid" = "33") && ("$roomid" != "7")) then gosub AUTOMOVE 7
     if matchre("$scriptlist" , "automapper\.cmd") then put #script abort automapper
BURGLE_PREP:
     pause 0.0001
     if ($SpellTimer.ShieldofLight.active = 1) then gosub RELEASE SOL
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     pause 0.0001
     if (%Playing = 1) then gosub STOP_PLAY
     gosub ARMOR_REMOVE
     pause 0.0001
     pause 0.0001
     if matchre("$scriptlist" , "automapper\.cmd") then put #script abort automapper
     pause 0.0001
     if (%Playing = 1) then gosub STOP_PLAY
     gosub HIDE
     action (escape) on
     pause 0.0001
BURGLEWAIT:
     var LAST BURGLEWAIT
     gosub clear
     gosub CLEAR_MATCHTABLE
     var burgling 1
     pause 0.0001
     pause 0.0001
     matchre BURGLE_DONE ^SCRIPT FINISHED|^BURGLE FINISHED
     put .burgle
     matchwait 320
     goto BURGLE_DONE

BURGLE_DONE:
     pause 0.1
     pause 0.0001
     if matchre("$roomname", "Someone Else's Home\,") then goto BURGLEWAIT
     put #echo >Log #7FFFD4 **** BURGLE RUN - Thievery: $Thievery.Ranks $Thievery.LearningRate / 34  ***
     put #script abort burgle
     pause 0.8
     pause 0.0001
     goto DONE_BURGLING

DONE_BURGLING:
     pause 0.0001
     gosub stowing
     var burgling 0
     var burgleheal 0
     if ($UC_NoCombat = 0) then gosub WEAR_ARMOR
     gosub BLEEDERCHECK
     if ($bleeding = 1) then
          {
               echo ######################
               echo ** FUCK DID OUR HANDS GET CHOPPED OFF??
               echo ** SEARCHING FOR A HEALER
               echo ######################
               var burgleheal 1
               goto TOWN_SEARCH
          }
     if ("$zoneid" = "33") then gosub AUTOMOVE river
     goto DISARM_RUN
###################################################################################
################################################################################################################################################
DISARM_RUN:
DISARMING:
     var NEXTSUB DISARM_DONE
     var LAST DISARM_RUN
     var CURRENT Disarming Boxes
     gosub STATUSBAR
     action (jail) on
     var townRun 0
     if matchre("$scriptlist" , "burgle\.cmd") then put #script abort burgle
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               gosub NECRO_PREP
          }
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.00001
     ####
     gosub TOWNRUN_TIMERS
     ####
     if ("$guild" = "Thief") then gosub KHRI
     if (("$guild" = "Thief") && ($circle > 100)) then gosub KHRI_START serenity sight sensing
     if (("$guild" = "Thief") && ($circle > 150) && ($concentration > 80)) then gosub KHRI_START steady avoidance flight elusion focus
     if (($invisible = 1) && (%Necro.Known = 0)) then gosub STOP_INVIS
     if ("$zoneid" = "4") then gosub AUTOMOVE crossing
     if (("$zoneid" = "150") && ("$game" = "DRF") && ($roomid != 85)) then gosub AUTOMOVE 85
     ### HOME CITY CHECK
     if !matchre("$UC_HomeCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub HOME_CITY_GO
               goto DISARM_REAL
          }
     #### TF OR PREMIUM AND FC ON - GO TO FANG COVE
     if ((matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON")) || (($UC_Premium = 1) && ("%FANGCOVE" = "ON"))) then
          {
               if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
                    {
                         gosub TO_SEACAVES
                         # if (($Athletics.Ranks > 45) && ("$game" != "DRF")) then gosub AUTOMOVE 45
                         if (($roomid != 85) && ("$game" = "DRF")) then gosub AUTOMOVE 85
                         goto DISARM_REAL
                    }
          }
     if ("$zoneid" = "108") then
          {
               var hometown MRISS
               if contains("$roomobjs", "arisen") then
                    {
                         var arise_command release
                         gosub ARISE_COMMAND
                    }
               if ("$roomid" != "151") then gosub AUTOMOVE 151
               waitforre glides into the dock|A loud voice
               if ($invisible = 1) then gosub STOP_INVIS
               put go galley
               pause
               waitforre reaches the dock
               put go dock
               pause 0.5
          }
     #### IF RANGER OR NECRO KNOWN - LEAVE TOWN
     if matchre("$guild", "(Ranger|Necromancer)") then
          {
               if (("$zoneid" = "1") && ("$guild" = "Necromancer")) then
                    {
                         gosub AUTOMOVE W gate
                         ## Siergelde's Regard (LAWLESS - NO HOUSES)
                         gosub AUTOMOVE 351
                    }
               if (("$zoneid" = "1") && ("$guild" = "Ranger")) then gosub AUTOMOVE 587
               if ("$zoneid" = "116") then
                    {
                         gosub AUTOMOVE boar
                         gosub AUTOMOVE 45
                    }
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "61") then
                    {
                         gosub AUTOMOVE shard
                         gosub AUTOMOVE 116
                    }
               if ("$zoneid" = "30") then
                    {
                         gosub AUTOMOVE e gate
                         gosub AUTOMOVE 78
                    }
               if (("$zoneid" = "31") && ($roomid != 102)) then gosub AUTOMOVE 102
               if (("$zoneid" = "47") && ($roomid != 401)) then gosub AUTOMOVE 401
               if ("$zoneid" = "42") then
                    {
                         gosub AUTOMOVE gate
                         gosub AUTOMOVE 222
                    }
               if (("$zoneid" = "90") && ($roomid != 42)) then gosub AUTOMOVE 42
               if ("$zoneid" = "99") then
                    {
                         gosub AUTOMOVE west
                         gosub AUTOMOVE 53
                    }
               if (("$zoneid" = "107") && ($roomid != 12)) then gosub AUTOMOVE 12
               if (("$zoneid" = "62") && ($roomid != 116)) then gosub AUTOMOVE 116
               if (("$zoneid" = "66") && ($roomid != 640)) then gosub AUTOMOVE 640
               if (("$zoneid" = "123") && ($roomid != 167)) then gosub AUTOMOVE 167
               if (("$zoneid" = "126") && ($roomid != 45)) then gosub AUTOMOVE 45
               if (("$zoneid" = "127") && ($roomid != 39)) then gosub AUTOMOVE 39
               # if (("$zoneid" = "150") && ($roomid != 45) && ($Athletics.Ranks > 45)) then gosub AUTOMOVE 45
               put #parse OUT OF TOWN!
               goto DISARM_REAL
          }
     #### NON RANGERS / NON-PREMIUM
     if ("$zoneid" = "1") then
          {
               echo *** CHOOSING RANDOM ROOM TO DISARM IN (1 out of 7 locations)
               random 1 7
               echo ** %r
               pause 0.3
               if (%r = 1) then gosub AUTOMOVE willow
               if (%r = 2) then gosub AUTOMOVE midton
               if (%r = 3) then gosub AUTOMOVE 661
               if (%r = 4) then gosub AUTOMOVE 327
               if (%r = 5) then gosub AUTOMOVE pond
               if (%r = 6) then gosub AUTOMOVE 331
               if (%r = 7) then gosub AUTOMOVE crofton
          }
     if (("$zoneid" = "30") && ($roomid != 243)) then gosub AUTOMOVE 243
     if (("$zoneid" = "31") && ($roomid != 101)) then gosub AUTOMOVE 101
     if (("$zoneid" = "42") && ($roomid != 3)) then gosub AUTOMOVE 3
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if ("$zoneid" = "61") then
          {
               echo *** CHOOSING RANDOM ROOM TO SCRIPT IN (1 out of 3 locations)
               random 1 3
               echo ** %r
               pause 0.3
               if (%r = 1) then gosub AUTOMOVE pool
               if (%r = 2) then gosub AUTOMOVE 119
               if (%r = 3) then gosub AUTOMOVE 216
          }
     if (("$zoneid" = "62") && ($roomid != 116)) then gosub AUTOMOVE 116
     if (("$zoneid" = "66") && ($roomid != 639)) then gosub AUTOMOVE 639
     if (("$zoneid" = "67") && ($roomid != 154)) then gosub AUTOMOVE 154
     if (("$zoneid" = "90") && ($roomid != 42)) then gosub AUTOMOVE 42
     if (("$zoneid" = "99") && ($roomid != 91)) then gosub AUTOMOVE 91
     if (("$zoneid" = "107") && ($roomid != 58)) then gosub AUTOMOVE 58
     if (("$zoneid" = "116") && ($roomid != 96)) then gosub AUTOMOVE 96
     if (("$zoneid" = "127") && ($roomid != 33)) then gosub AUTOMOVE 33
     ###########
     if (("$zoneid" = "150") && ($roomid != 85)) then gosub AUTOMOVE 85
     pause 0.2
DISARM_REAL:
DISARMREAL:
     var NEXTSUB DISARM_DONE
     pause 0.00001
     if (!matchre("%DISARM", "(?i)(ON|1|YES)")) then goto DISARMDONE2
     echo
     echo #################
     echo *** LOCKPICKING BOXES!
     echo #################
     echo
     if matchre("$roomplayers", "Bedlam") && ("$guild" != "Barbarian") then put whisper bedlam MEF
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     if (("$guild" = "Cleric") && ($SpellTimer.ShieldofLight.active = 1)) then
          {
               put release SOL
               pause 0.5
          }
     if ("$guild" = "Warrior Mage") then
          {
               if matchre("%abbrevs", "(?i)MOF") then
                    {
                         pause 0.1
                         gosub stowing
                         gosub PREPARE MOF
                         pause 2
                         gosub RITUAL
                         gosub SPELL_CAST
                    }
               if matchre("%abbrevs", "(?i)ES") then
                    {
                         pause 0.1
                         gosub PREPARE ES
                         pause 22
                         gosub SPELL_CAST
                    }
          }
     if ("$guild" = "Empath") then
          {
               if matchre("%abbrevs", "(?i)BS") then
                    {
                         pause 0.1
                         gosub stowing
                         gosub PREPARE BS
                         pause 20
                         gosub SPELL_CAST
                    }
               if matchre("%abbrevs", "(?i)AWAKEN") then
                    {
                         pause 0.1
                         gosub PREPARE AWAKEN
                         pause 20
                         gosub SPELL_CAST
                    }
          }
     if (("$guild" = "Moon Mage") && matchre("%abbrevs", "(?i)MT")) then
          {
               pause 0.1
               gosub stowing
               gosub PREPARE MT
               pause 22
               gosub CAST
          }
     if matchre("%abbrevs", "(?i)HOL") then
          {
               pause 0.1
               gosub stowing
               gosub PREPARE HOL
               pause 22
               gosub CAST
          }
     if ($invisible = 1) then gosub STOP_INVIS
     # if matchre ("$roomobjs" , "teardrinker") then goto DISARM_DONE
     action (combat) off
     action (escape) off
     action (dead) off
     action (stunned) off
AT_DISARM:
     gosub clear
     gosub CLEAR_MATCHTABLE
     pause 0.1
     matchre DISARM_DONE BOXES DONE\!
     matchre DISARM_DONE DONE BOXES\!
     matchre DISARM_DONE ^You have been idle
     put .disarm
     matchwait 3500
DISARM_DONE:
DISARMDONE:
     pause 0.00001
     pause 0.00001
     echo #############
     echo *** DONE WITH BOXES
     echo #############
DISARMDONE2:
     if matchre("$scriptlist" , "disarm\.cmd") then put #script abort disarm
     if ($standing = 0) then gosub STAND
     gosub clear
     gosub CLEAR_MATCHTABLE
     action (escape) on
     action (dead) on
     action (stunned) on
     pause 0.00001
     if ("$guild" = "Thief") then
          {
               if (($Khri.Town = 0) || ($concentration < 50)) then
                    {
                         send khri stop
                         pause 0.5
                    }
          }
     gosub stowing
     pause 0.00001
     send dump junk
     pause 0.5
     pause 0.00001
     if ($RestockLockpicks = 1) then gosub GET_LOCKPICKS
     pause 0.00001
     gosub OPEN_CONTAINERS
     if (($UC_SellGems = 1) || ($UC_SellMetals = 1)) then gosub GEM_DUMP
     pause 0.00001
     pause 0.00001
     if !matchre("$UC_HomeCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub HOME_CITY_GO
               goto LOCKPICK_ITEM_CHECK
          }
     #### TF OR PREMIUM AND FC ON - GO TO FANG COVE
     if ((matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON")) || (($UC_Premium = 1) && ("%FANGCOVE" = "ON"))) then
          {
               if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
                    {
                         gosub TO_SEACAVES
                         # if (($Athletics.Ranks > 45) && ("$game" != "DRF")) then gosub AUTOMOVE 45
                         if (($roomid != 85) && ("$game" = "DRF")) then gosub AUTOMOVE 85
                         goto LOCKPICK_ITEM_CHECK
                    }
          }
     if ("$zoneid" = "108") then
          {
               var hometown MRISS
               if contains("$roomobjs", "arisen") then
                    {
                         var arise_command release
                         gosub ARISE_COMMAND
                    }
               if ("$roomid" != "151") then gosub AUTOMOVE 151
               waitforre glides into the dock|A loud voice
               if ($invisible = 1) then gosub STOP_INVIS
               put go galley
               pause
               waitforre reaches the dock
               put go dock
               pause 0.5
          }
     #### IF RANGER OR NECRO KNOWN - LEAVE TOWN
     if matchre("$guild", "(Ranger|Necromancer)") then
          {
               if (("$zoneid" = "1") && ("$guild" = "Necromancer")) then
                    {
                         gosub AUTOMOVE NE gate
                         gosub AUTOMOVE 558
                    }
               if (("$zoneid" = "1") && ("$guild" = "Ranger")) then gosub AUTOMOVE 587
               if ("$zoneid" = "116") then
                    {
                         gosub AUTOMOVE boar
                         gosub AUTOMOVE 45
                    }
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "61") then
                    {
                         gosub AUTOMOVE shard
                         gosub AUTOMOVE 116
                    }
               if ("$zoneid" = "30") then
                    {
                         gosub AUTOMOVE e gate
                         gosub AUTOMOVE 78
                    }
               if (("$zoneid" = "31") && ($roomid != 102)) then gosub AUTOMOVE 102
               if (("$zoneid" = "47") && ($roomid != 401)) then gosub AUTOMOVE 401
               if ("$zoneid" = "42") then
                    {
                         gosub AUTOMOVE gate
                         gosub AUTOMOVE 222
                    }
               if (("$zoneid" = "90") && ($roomid != 42)) then gosub AUTOMOVE 42
               if ("$zoneid" = "99") then
                    {
                         gosub AUTOMOVE west
                         gosub AUTOMOVE 53
                    }
               if (("$zoneid" = "107") && ($roomid != 12)) then gosub AUTOMOVE 12
               if (("$zoneid" = "62") && ($roomid != 116)) then gosub AUTOMOVE 116
               if (("$zoneid" = "66") && ($roomid != 640)) then gosub AUTOMOVE 640
               if (("$zoneid" = "123") && ($roomid != 167)) then gosub AUTOMOVE 167
               if (("$zoneid" = "126") && ($roomid != 45)) then gosub AUTOMOVE 45
               if (("$zoneid" = "127") && ($roomid != 39)) then gosub AUTOMOVE 39
               if (("$zoneid" = "150") && ($roomid != 85)) then gosub AUTOMOVE 85
               put #parse OUT OF TOWN!
               goto LOCKPICK_ITEM_CHECK
          }
     #### NON RANGERS / NON-PREMIUM
     if ("$zoneid" = "1") then
          {
               echo *** CHOOSING RANDOM ROOM TO SCRIPT IN (1 out of 7 locations)
               random 1 7
               echo ** %r
               pause 0.3
               if (%r = 1) then gosub AUTOMOVE willow
               if (%r = 2) then gosub AUTOMOVE midton
               if (%r = 3) then gosub AUTOMOVE 661
               if (%r = 4) then gosub AUTOMOVE 327
               if (%r = 5) then gosub AUTOMOVE pond
               if (%r = 6) then gosub AUTOMOVE 331
               if (%r = 7) then gosub AUTOMOVE crofton
          }
     if (("$zoneid" = "30") && ($roomid != 243)) then gosub AUTOMOVE 243
     if (("$zoneid" = "31") && ($roomid != 101)) then gosub AUTOMOVE 101
     if (("$zoneid" = "42") && ($roomid != 3)) then gosub AUTOMOVE 3
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if ("$zoneid" = "61") then
          {
               echo *** CHOOSING RANDOM ROOM TO SCRIPT IN (1 out of 3 locations)
               random 1 3
               echo ** %r
               pause 0.3
               if (%r = 1) then gosub AUTOMOVE pool
               if (%r = 2) then gosub AUTOMOVE 218
               if (%r = 3) then gosub AUTOMOVE 216
          }
     if (("$zoneid" = "62") && ($roomid != 116)) then gosub AUTOMOVE 116
     if (("$zoneid" = "66") && ($roomid != 639)) then gosub AUTOMOVE 639
     if (("$zoneid" = "67") && ($roomid != 154)) then gosub AUTOMOVE 154
     if (("$zoneid" = "90") && ($roomid != 42)) then gosub AUTOMOVE 42
     if (("$zoneid" = "99") && ($roomid != 91)) then gosub AUTOMOVE 91
     if (("$zoneid" = "107") && ($roomid != 58)) then gosub AUTOMOVE 58
     if (("$zoneid" = "116") && ($roomid != 96)) then gosub AUTOMOVE 96
     if (("$zoneid" = "127") && ($roomid != 33)) then gosub AUTOMOVE 33
     ###########
     if (("$zoneid" = "150") && ($roomid != 85) && ("$game" = "DRF")) then gosub AUTOMOVE 85
###########################################################################################################
LOCKPICK_ITEM_CHECK:
     action (escape) on
     var secondLock 0
     var nopick 0
     var townRun 0
     var LAST LOCKPICK_ITEM_CHECK
     var NEXTSUB LOCKPICKDONE
     var CURRENT Magic Lockpick Item
     gosub STATUSBAR
     if matchre("$scriptlist" , "disarm\.cmd") then put #script abort disarm
     gosub stowing
     if ($Locksmithing.Ranks > 1749) then goto RUNESTONES
     if matchre("%LOCKPICK.ITEM", "(?i)(NULL|OFF|0|^$|^%)") then goto RUNESTONES
     if ($Locksmithing.LearningRate > 32) then goto RUNESTONES
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     ####
     gosub TOWNRUN_TIMERS
     ####
     echo ############################
     echo *** Training on magic lockpick item
     echo ############################
     var LockpickThing %LOCKPICK.ITEM
     if !matchre("$UC_Container.LockpickItem", "(?i)(NULL|OFF|0|^$|^%)") then gosub GET %LockpickThing from my $UC_Container.LockpickItem
     if !matchre("$lefthand", "Empty") then gosub SWAP
     pause 0.1
     if !matchre("$righthand", "(?i)%LockpickThing") then gosub PUT remove %LockpickThing
     if !matchre("$righthand", "(?i)%LockpickThing") then gosub PUT untie my %LockpickThing
     if !matchre("$righthand", "(?i)%LockpickThing") then gosub GET my %LockpickThing
     pause 0.2
     if !matchre("$lefthand", "Empty") then gosub SWAP
     pause 0.2
     if !matchre("$righthand", "(?i)%LockpickThing") then goto LOCKPICK_ITEM_MISSING
     var lockpickloop 0
     gosub clear
     gosub CLEAR_MATCHTABLE
LOCKPICK_ITEM:
     pause 0.5
     math lockpickloop add 1
     ## NEED TO ADD CHECK HERE FOR ITEMS OUT OF CHARGES
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then goto LOCKPICK_ITEM_DONE
     gosub PUT close my %LockpickThing
     pause 0.2
     gosub PUT lock my %LockpickThing
     pause 0.3
LOCKPICKING_ITEM:
     pause 0.1
     matchre LOCKPICKING_ITEM ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre LOCKPICKING_ITEM_CD ^The lock looks weak\, and rather than risk breaking it
     matchre LOCKPICKING_ITEM_CD ^The lock feels warm\, as if worked too often recently\, so you stop your attempt to pick it\.
     matchre LOCKPICKING_ITEM_CHECK ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre LOCKPICKING_GET_LOCKPICK ^You need some type of tool
     put pick my %LockpickThing
     matchwait 7
     echo ######################################
     echo *** UNKNOWN MATCH FOR LOCKPICKING_ITEM NOT RECOGNIZED!
     echo *** SEND ME THE IN-GAME TEXT WHEN YOU PICKED IT
     echo ######################################
     pause 0.5
LOCKPICKING_ITEM_CHECK:
     pause 0.4
     pause 0.2
     pause 0.1
     if ($Locksmithing.LearningRate > 31) then goto LOCKPICK_ITEM_DONE
     if (%lockpickloop > 20) then goto LOCKPICK_ITEM_DONE
     goto LOCKPICK_ITEM
LOCKPICKING_GET_LOCKPICK:
     if (%nopick = 1) then goto LOCKPICKING_NOPICK
     var nopick 1
     pause 0.1
     gosub GET lockpick
     pause 0.2
     if !matchre("$righthand $lefthand", "lockpick") then goto LOCKPICKING_NOPICK
     goto LOCKPICKING_ITEM

LOCKPICKING_NOPICK:
     echo ######################
     echo *** NO LOCKPICK/LOCKPICK RING??
     echo *** HOW THE FUCK DO YOU EXPECT TO PICK ANYTHING?
     echo ######################

LOCKPICKING_ITEM_CD:
     pause 0.2
     if (%secondLock = 1) then goto LOCKPICK_ITEM2_CD
     if matchre("%LOCKPICK.ITEM.2", "(?i)(NULL|OFF|0|^$|^%)") then goto LOCKPICK_ITEM2_CD
     echo #############################
     echo *** PRIMARY LOCKPICK ITEM OUT OF CHARGES!
     echo *** Checking for secondary one..
     echo #############################
     pause 0.3
     if !matchre("$UC_Container.LockpickItem", "(?i)(NULL|OFF|0|^$|^%)") then gosub PUT_IT my %LockpickThing in my $UC_Container.LockpickItem
     if matchre("$righthand", "%LockpickThing") then gosub WEAR %LockpickThing
     pause 0.2
     if matchre("$righthand", "%LockpickThing") then gosub stowing
     pause 0.4
SECOND_LOCKPICK_ITEM:
     if matchre("%LOCKPICK.ITEM.2", "(?i)(NULL|OFF|0|^$|^%)") then gosub PUT GET my second %LOCKPICK.ITEM from my $UC_Container.LockpickItem
     if !matchre("%LOCKPICK.ITEM.2", "(?i)(NULL|OFF|0|^$|^%)") then gosub GET my %LOCKPICK.ITEM.2 from my $UC_Container.LockpickItem
     pause 0.4
     var secondLock 1
     pause 0.1
     if !matchre("$righthand", "(?i)%LOCKPICK.ITEM.2") then
          {
               if (matchre("%LOCKPICK.ITEM.2", "(?i)(NULL|OFF|0|^$|^%)") || matchre("%LOCKPICK.ITEM.2", "%LOCKPICK.ITEM")) then gosub PUT GET my second %LOCKPICK.ITEM from my watery portal
               if !matchre("%LOCKPICK.ITEM.2", "(?i)(NULL|OFF|0|^$|^%)") then gosub GET my %LOCKPICK.ITEM.2 from my watery portal
               pause 0.4
          }
     if !matchre("$righthand", "(?i)%LOCKPICK.ITEM.2") then
          {
               if (matchre("%LOCKPICK.ITEM.2", "(?i)(NULL|OFF|0|^$|^%)") || matchre("%LOCKPICK.ITEM.2", "%LOCKPICK.ITEM")) then gosub PUT GET my second %LOCKPICK.ITEM
               if !matchre("%LOCKPICK.ITEM.2", "(?i)(NULL|OFF|0|^$|^%)") then gosub GET my %LOCKPICK.ITEM.2
               pause 0.4
          }
     if !matchre("$righthand", "(?i)%LOCKPICK.ITEM.2") then gosub PUT remove %LOCKPICK.ITEM.2
     pause 0.001
     if matchre("$lefthand", "(?i)%LOCKPICK.ITEM.2") then gosub SWAP
     if !matchre("$righthand", "(?i)%LOCKPICK.ITEM.2") then
          {
               put close my $UC_Container.LockpickItem
               pause 0.5
               pause 0.1
               gosub GET my %LOCKPICK.ITEM
               pause 0.4
               gosub OPEN $UC_Container.LockpickItem
          }
     if !matchre("$righthand", "(?i)%LOCKPICK.ITEM.2") then goto LOCKPICK_ITEM_2_MISSING
     var LockpickThing %LOCKPICK.ITEM.2
     goto LOCKPICK_ITEM
LOCKPICK_ITEM_MISSING:
     put #echo >Log #ffff66 *** Error - Magic Lockpick Item not found! %LockpickThing
     echo ########################
     echo *** LOCKPICK ITEM MISSING / NOT FOUND!!
     echo *** ITEM: %LOCKPICK.ITEM
     echo ########################
     goto LOCKPICKING_ITEM_CD
LOCKPICK_ITEM2_CD:
     echo #########################
     echo *** LOCKPICK ITEMS OUT OF CHARGES
     echo #########################
     goto LOCKPICK_ITEM_DONE
LOCKPICK_ITEM_2_MISSING:
     put #echo >Log #ffff66 *** Error - Magic Lockpick Item 2 not found! %LockpickThing
     echo ########################
     echo *** LOCKPICK ITEM 2 MISSING / NOT FOUND!!
     echo *** ITEM: %LockpickThing
     echo ########################
     goto LOCKPICK_ITEM_DONE
LOCKPICK_ITEM_DONE:
     put #echo >Log #7FFFD4 *** Trained Magic Lockpick Item - Locksmithing: $Locksmithing.Ranks $Locksmithing.LearningRate / 34  ***
     pause 0.1
     put unlock my %LockpickThing
     pause 0.2
     pause 0.2
     gosub PUT open my %LockpickThing
     pause 0.2
     if !matchre("$UC_Container.LockpickItem", "(?i)(NULL|OFF|0|^$|^%)") then gosub PUT put %LockpickThing in my $UC_Container.LockpickItem
     pause 0.3
     gosub WEAR %LockpickThing
     pause 0.3
LOCKPICKDONE:
     pause 0.1
     if !matchre("$UC_Container.LockpickItem", "(?i)(NULL|OFF|0|^$|^%)") then gosub PUT put %LockpickThing in my $UC_Container.LockpickItem
     pause 0.2
     gosub stowing
     goto RUNESTONES
###################################################################################
RUNESTONE:
RUNESTONES:
     var LAST RUNESTONES
     var NEXTSUB SKIN_RUN
     var CURRENT Runestone Training
     gosub STATUSBAR
     pause 0.00001
     ####
     gosub TOWNRUN_TIMERS
     ####
     pause 0.2
     if !matchre("$guild", "%MAGICUSER") then goto SKIN_RUN
     if (matchre("$guild", "%MAGICUSER") && ($Sorcery.Ranks > 60)) then goto SKIN_RUN
     if (matchre("$guild", "%MAGICUSER") && ($Sorcery.Ranks <= 60)) then
          {
               gosub GET my runestone
               wait
               pause 0.5
               pause 0.5
               if !matchre("$righthand $lefthand", "runestone") then goto NO_RUNESTONE
               gosub RUNE_LOOP
               gosub stowing
               if ($Sorcery.LearningRate > 33) then goto SKIN_RUN
               gosub GET my second runestone
               wait
               pause 0.5
               pause 0.5
               if !matchre("$righthand $lefthand", "runestone") then goto NO_RUNESTONE
               gosub RUNE_LOOP
          }
     put #echo >Log #7FFFD4 *** Trained Sorcery / Magic w/ Runestone! - Sorcery: $Sorcery.Ranks $Sorcery.LearningRate/34
     goto SKIN_RUN
RUNE_LOOP:
     var runeloop 0
     echo #########################
     echo ** TRAINING SORCERY w/ RUNESTONE
     echo #########################
RUNE_LOOP_1:
     math runeloop add 1
     if (%runeloop > 32) then return
     if ((%runeloop > 10) && ($Sorcery.LearningRate < 1)) then return
     if ($Sorcery.LearningRate > 33) then return
     pause 0.001
     if (%Playing = 1) then gosub STOP_PLAY
     put focus my rune
     pause
     pause
     pause 0.2
     goto RUNE_LOOP_1
NO_RUNESTONE:
     echo ################
     echo ** NO RUNESTONE FOUND
     echo ################
     pause
     goto SKIN_RUN
#########################################################################################################################
## SKIN SELLING RUN
##############################
SKIN_RUN:
SKINRUN:
SKIN.RUN:
SKIN_RUN_REAL:
     var bundles 0
     var skinsold 0
     var skinprofit 0
     var NEXTSUB ROPE_RESTOCK
     var LAST SKIN_RUN
     var CURRENT SELLING GEMS
     if matchre("$scriptlist" , "disarm\.cmd") then put #script abort disarm
     gosub STATUSBAR
     pause 0.0001
     gosub OPEN_CONTAINERS
     action (jail) on
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     ####
     gosub TOWNRUN_TIMERS
     gosub clear
     gosub CLEAR_MATCHTABLE
     ####
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if ("$zoneid" = "150") then gosub TIME_CHECK
     if ("$zoneid" = "4") then gosub AUTOMOVE crossing
#### CHECK FOR/USE FINESSE WAND HERE
     if (%HaveFinesse = 1) then
          {
               echo
               echo ###########################
               echo **** USING FINESSE WAND!
               echo **** FOR EXTRA PHAT GAINZ
               echo ###########################
               echo
               gosub STOWING
               gosub GET poppet
               if ($invisible = 1) then gosub STOP_INVIS
               pause 0.2
               put invoke my poppet
               pause 0.3
               pause 0.3
               gosub PUT put poppet in my $UC_Container.Wand1
               if matchre("$righthand $lefthand", "poppet") then gosub PUT put poppet in my $UC_Container.Wand2
          }
     if ($UC_Skin = 0) then goto GEM_RUN
     echo ######################
     echo * BUNDLE / SKIN SELLING RUN
     echo ######################
     pause 0.1
     ### BACK TO TOWN - FIND BUNDLE DUDE
     put #parse GOING TO TOWN!
     if ("$zoneid" = "4") then gosub AUTOMOVE crossing
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "68") then gosub AUTOMOVE 15
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(8|7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(8|7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(31|32|33|33a)\b") then gosub AUTOMOVE river
     pause 0.0001
     pause 0.0001
     if matchre("$zoneid","\b(31|32|33|33a)\b") then gosub AUTOMOVE river
     if ("$zoneid" = "42") then gosub AUTOMOVE lang
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if matchre("$zoneid","\b(7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     pause 0.0001
     pause 0.0001
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     pause 0.0001
     pause 0.0001
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(31|32|33|33a)\b") then gosub AUTOMOVE river
     if matchre("$zoneid","\b(8|7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     pause 0.0001
     pause 0.0001
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "33") then gosub AUTOMOVE river
     if ("$zoneid" = "42") then gosub AUTOMOVE lang
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     pause 0.0001
     if matchre("$zoneid","\b(31|32|33|33a)\b") then gosub AUTOMOVE river
     if ($UC_SellSkins = 0) then goto ROPE_RESTOCK
     gosub stowing
     pause 0.0001
     if ("$zoneid" = "108") then
          {
               if (($UC_Premium = 1) || matchre("$game", "(DRF|DRX)")) then gosub TO_SEACAVES
          }
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "33") then gosub AUTOMOVE river
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if !matchre("$zoneid", "\b(1|13|30|34a|40|42|47|61|66|90|99|107|116|123|127|150)\b") then
     {
          echo #########################
          echo *** NO TANNER HERE?? ZONEID:$zoneid
          echo *** SKIPPING SKIN SELLING
          echo #########################
          pause
          goto GEMRUN
     }
     if ("$zoneid" = "99") then
          {
               gosub AUTOMOVE tanner
               goto GET_BUNDLE
          }
     gosub AUTOMOVE bundle
     pause 0.0001
     if ($invisible = 1) then gosub STOP_INVIS
GET_BUNDLE:
     var skingrab null
     var LAST GET_BUNDLE
     pause 0.0001
     if matchre("$zoneid","\b(1|61)\b") then var skinCurrency Kronars
     if matchre("$zoneid","\b(66|67|68|116|112|150)\b") then var skinCurrency Dokoras
     if matchre("$zoneid","\b(30|42|90|99|107|108)\b") then var skinCurrency Lirums
     action math skinprofit add $1;var skinCurrency $2 when hands you (\d+)\s+(Kronars?|Lirums?|Dokoras?|kronars?|lirums?|dokoras?)
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.0001
GET_BUNDLE_2:
     pause 0.0001
     gosub PUT remove bundle
     pause 0.2
     if (!matchre("$righthand", "bundle") && !matchre("$lefthand", "bundle")) then
          {
               gosub GET bundle
               pause 0.5
          }
     pause 0.2
     if (!matchre("$righthand", "bundle") && !matchre("$lefthand", "bundle")) then
          {
               gosub GET bundle from my watery portal
               pause 0.5
          }
     pause 0.0001
     if (!matchre("$righthand", "bundle") && !matchre("$lefthand", "bundle")) then goto DONE_BUNDLE_SELL
     if ($UC_TieBundle = 1) then gosub BUNDLE_SELL
     if (matchre("$righthand", "bundle") || matchre("$lefthand", "bundle")) then
          {
               if ("%skingrab" != "null") then gosub BUNDLE_ASSESS
          }
     if (matchre("$righthand", "bundle") || matchre("$lefthand", "bundle")) then gosub BUNDLE_SELL
     gosub AUTOMOVE bundle
     goto GET_BUNDLE_2

BUNDLE_ASSESS:
     action var skingrab $1 when You rummage through a \S+ bundle and see an? .*and (?:an?).*\s(\S+).
     pause 0.0001
     pause 0.0001
     send rummage in my bundle
     wait
     pause 0.7
     pause 0.1
     pause 0.0001
     pause 0.0001
     action remove You rummage through a \S+ bundle and see an? .*and (?:an?).*\s(\S+).
     if ("%skingrab" != "null") then send get %skingrab from my bundle
     pause 0.3
     pause 0.2
BUNDLE_SELL:
     if ($invisible = 1) then gosub STOP_INVIS
     math bundles add 1
     pause 0.0001
     pause 0.0001
     pause 0.1
     send sell bundle
     wait
     pause 0.3
     pause 0.0001
     if matchre("$roomobjs", "rope") then send stow rope
     gosub stowing
     var BundleCount 0
     return

BUNDLE_SELL_CONTINUE:
     pause 0.1
     pause 0.0001
     put sell bundle
     pause 0.5
     pause 0.4
     pause 0.0001
     pause 0.0001
     put stow rope
     pause 0.5
     pause 0.2
     pause 0.0001
DONE_BUNDLE_SELL:
     var BundleTied 0
     pause 0.1
     pause 0.0001
     pause 0.0001
     if (($UC_Bundle = 1) && ("%skingrab" != "null")) then
          {
               if ("$righthandnoun" != "rope") then
                    {
                         send get bundling rope
                         wait
                    }
               pause 0.2
               if ("$righthandnoun" != "rope") then
                    {
                         send get bundling rope from my watery portal
                         wait
                    }
          }
     if ("%skingrab" != "null") then
          {
               send bundle
               pause 0.5
               if (($UC_TieBundle = 1) || ($UC_F2P = 1)) then
                    {
                         pause 0.1
                         put tie my bundle
                         pause 0.2
                         put tie my bundle
                         var BundleTied 1
                         wait
                         pause 0.1
                    }
          }
     pause 0.3
     if (matchre("$righthand $lefthand", "bundle") && (%Bundle.Wear != 0)) then gosub WEAR_BUNDLE
     if (("$righthandnoun" = "rope") || ("$lefthandnoun" = "rope")) then gosub STOW rope
     gosub stowing
     if (($invisible = 1) && (%Necro.Known = 0)) then gosub STOP_INVIS
     action remove hands you (\d+)\s+(Kronars?|Lirums?|Dokoras?|kronars?|lirums?|dokoras?)
     gosub BUNDLE_SET_ZERO
SELLMISCSKINS:
SELL_MISC_SKINS:
     echo
     echo #############################
     echo ** Checking Containers for loose skins
     echo #############################
     echo
     pause 0.001
     gosub SELL_SKINS $UC_Container
     math skinprofit add %total.sales.price
     math skinsold add %total.items.sold
     pause 0.001
     gosub SELL_SKINS $UC_Container.Box
     math skinprofit add %total.sales.price
     math skinsold add %total.items.sold
     pause 0.001
     gosub SELL_SKINS $UC_Container.Backup
     math skinprofit add %total.sales.price
     math skinsold add %total.items.sold
     pause 0.001
     gosub SELL_SKINS $UC_Container.Crafting
     math skinprofit add %total.sales.price
     math skinsold add %total.items.sold
     pause 0.001
     gosub SELL_SKINS $UC_Container.Sheath
     math skinprofit add %total.sales.price
     math skinsold add %total.items.sold
     pause 0.001
     if (%skinprofit = 0) then goto SKINSELL_DONE
CHECK_SKIN_PROFIT:
     var Plat 0
     var Gold 0
     var Silver 0
     var Bronze 0
     var Copper 0
     evalmath Plat floor(%skinprofit/10000)
     evalmath Gold floor((%skinprofit-(%Plat*10000))/1000)
     evalmath Silver floor((%skinprofit-(%Plat*10000)-(%Gold*1000))/100)
     evalmath Bronze floor((%skinprofit-(%Plat*10000)-(%Gold*1000)-(%Silver*100))/10)
     evalmath Copper floor((%skinprofit-(%Plat*10000)-(%Gold*1000)-(%Silver*100)-(%Bronze*10))/1)
     pause 0.0001
     if (%bundles = 1) then
          {
               if (%skinsold = 0) then
                    {
                         put #echo >Log #00FF00 * Sold %bundles bundle - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log #00FF00 * Sold %bundles bundle - %skinprofit %skinCurrencySold %bundles bundle - %skinprofit %skinCurrency (%Gold g/%Silver s/%Bronze b/%Copper c)
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log #00FF00 * Sold %bundles bundle - %skinprofit %skinCurrency (%Silver s/%Bronze b/%Copper c)
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log #00FF00 * Sold %bundles bundle - %skinprofit %skinCurrency (%Bronze b/%Copper c)
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log #00FF00 * Sold %bundles bundle - %skinprofit %skinCurrency (%Copper c)
                         goto SKINSELL_DONE
                    }
               if (%skinsold = 1) then
                    {
                         put #echo >Log #00FF00 * Sold %bundles bundle / %skinsold skin - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log #00FF00 * Sold %bundles bundle / %skinsold skin - %skinprofit %skinCurrencySold %bundles bundle - %skinprofit %skinCurrency (%Gold g/%Silver s/%Bronze b/%Copper c)
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log #00FF00 * Sold %bundles bundle / %skinsold skin - %skinprofit %skinCurrency (%Silver s/%Bronze b/%Copper c)
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log #00FF00 * Sold %bundles bundle / %skinsold skin - %skinprofit %skinCurrency (%Bronze b/%Copper c)
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log #00FF00 * Sold %bundles bundle / %skinsold skin - %skinprofit %skinCurrency (%Copper c)
                         goto SKINSELL_DONE
                    }
               if (%skinsold > 1) then
                    {
                         put #echo >Log #00FF00 * Sold %bundles bundle / %skinsold skins - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log #00FF00 * Sold %bundles bundle / %skinsold skins - %skinprofit %skinCurrencySold %bundles bundle - %skinprofit %skinCurrency (%Gold g/%Silver s/%Bronze b/%Copper c)
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log #00FF00 * Sold %bundles bundle / %skinsold skins - %skinprofit %skinCurrency (%Silver s/%Bronze b/%Copper c)
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log #00FF00 * Sold %bundles bundle / %skinsold skins - %skinprofit %skinCurrency (%Bronze b/%Copper c)
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log #00FF00 * Sold %bundles bundle / %skinsold skins - %skinprofit %skinCurrency (%Copper c)
                         goto SKINSELL_DONE
                    }
          }
     if (%bundles > 1) then
          {
               if (%skinsold = 0) then
                    {
                         put #echo >Log #00FF00 * Sold %bundles bundles - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log #00FF00 * Sold %bundles bundles - %skinprofit %skinCurrencySold %bundles bundle - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log #00FF00 * Sold %bundles bundles - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log #00FF00 * Sold %bundles bundles - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log #00FF00 * Sold %bundles bundles - %skinprofit %skinCurrency
                         goto SKINSELL_DONE
                    }
               if (%skinsold = 1) then
                    {
                         put #echo >Log #00FF00 * Sold %bundles bundles / %skinsold skin - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log #00FF00 * Sold %bundles bundles / %skinsold skin - %skinprofit %skinCurrencySold %bundles bundle - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log #00FF00 * Sold %bundles bundles / %skinsold skin - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log #00FF00 * Sold %bundles bundles / %skinsold skin - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log #00FF00 * Sold %bundles bundles / %skinsold skin - %skinprofit %skinCurrency
                         goto SKINSELL_DONE
                    }
               if (%skinsold > 1) then
                    {
                         put #echo >Log #00FF00 * Sold %bundles bundles / %skinsold skins - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log #00FF00 * Sold %bundles bundles / %skinsold skins - %skinprofit %skinCurrencySold %bundles bundle - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log #00FF00 * Sold %bundles bundles / %skinsold skins - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log #00FF00 * Sold %bundles bundles / %skinsold skins - %skinprofit %skinCurrency
                         # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log #00FF00 * Sold %bundles bundles / %skinsold skins - %skinprofit %skinCurrency
                         goto SKINSELL_DONE
                    }
          }
SKINSELL_DONE:
     math TotalProfit add %skinprofit
     pause 0.0001
     goto ROPE_RESTOCK
#################################################################################################
### BUNDLING ROPE RESTOCKING LOGIC
ROPE_RESTOCK:
     if (%NeedRope = 0) then goto GEM_RUN
ROPERESTOCK:
     var Furrier NULL
     if !matchre("$zoneid", "\b(1|13|30|34a|40|42|47|61|66|90|99|107|116|123|127|150)\b") then
          {
               echo ############################################
               echo *** NOT IN A RECOGNIZED LOCATION TO RESTOCK BUNDLING ROPES
               echo ############################################
               goto GEM_RUN
          }
     if ("$zoneid" = "1") then var Furrier falken
     if ("$zoneid" = "13") then var Furrier tromlyn
     if ("$zoneid" = "30") then var Furrier fara
     if ("$zoneid" = "34a") then var Furrier drinak
     if ("$zoneid" = "40") then var Furrier shalan
     if ("$zoneid" = "42") then var Furrier dartrise
     if ("$zoneid" = "47") then var Furrier ushikhh
     if ("$zoneid" = "61") then var Furrier assist
     if ("$zoneid" = "66") then var Furrier tremagis
     if ("$zoneid" = "90") then var Furrier lysskava
     if ("$zoneid" = "99") then var Furrier willow
     if ("$zoneid" = "106") then var Furrier assist
     if ("$zoneid" = "107") then var Furrier scrupp
     if ("$zoneid" = "116") then var Furrier vandorf
     if ("$zoneid" = "123") then var Furrier stedh
     if ("$zoneid" = "127") then var Furrier gudthar
     if (("$zoneid" = "150") && ("%TIME" = "DAY")) then var Furrier gorund
     if (("$zoneid" = "150") && ("%TIME" = "NIGHT")) then var Furrier clerk
     echo #################
     echo ** RESTOCKING BUNDLING ROPE
     echo #################
     pause 0.2
     pause 0.5
     put ask %Furrier for rope
     wait
     pause 0.5
     pause 0.1
     gosub STOWIT rope
     put ask %Furrier for rope
     wait
     pause 0.5
     pause 0.1
     gosub STOWIT rope
     if ($UC_F2P = 1) then goto GEM_RUN
     put ask %Furrier for rope
     wait
     pause 0.5
     pause 0.1
     gosub STOWIT rope
     put ask %Furrier for rope
     wait
     pause 0.5
     pause 0.1
     gosub STOWIT rope
     var NeedRope 0
     goto GEM_RUN
################################################################################################################################################
###################################################################################
SELLGEMS:
GEM_RUN:
GEM.RUN:
GEMRUN:
     var NEXTSUB BURGLE
     var LAST GEM_RUN
     var CURRENT Selling Gems
     gosub STATUSBAR
     var townRun 0
     action (inventory) off
     put #parse GOING TO TOWN!
     pause 0.0001
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if matchre("$scriptlist" , "disarm\.cmd") then put #script abort disarm
     pause 0.0001
     if matchre("$guild", "(Thief|Moon Mage)") && ($invisible)) then gosub STOP_INVIS
     gosub stowing
     ####
     gosub TOWNRUN_TIMERS
     gosub OPEN_CONTAINERS
     ####
     if (%Playing = 0) then gosub PLAY
     if (%TotalPouches < 2) then goto GEM_RUN_2
     if (($UC_SellGems = 0) && ($UC_SellMetals = 0)) then goto SELL_NUGS_COMPLETE
GEM_RUN_2:
     echo ################
     echo *** SELLING GEMS!
     echo *** GOING ON A GEM RUN!
     echo ################
     ## GO BACK TO TOWN
     if (("$zoneid" = "150") && ("$guild" != "Trader") && ($UC_TiePouch = 1) && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     if matchre("$zoneid","\b(8|7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(8|7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(31|32|33)\b") then gosub AUTOMOVE river
     if matchre("$zoneid","\b(31|32|33)\b") then gosub AUTOMOVE river
GEM_LETH:
     if (("$zoneid" = "61") && !matchre("$UC_HomeCity", "(?i)(CROSS|XING|RIVER|HAVEN|THEREN|MUSPARI)") && ($UC_F2P = 0)) then
          {
               # if ($Athletics.Ranks < 520) then goto GEM_CROSS
               var hometown LETH
               echo ######################
               echo ** Travel to SHARD to Sell Gems
               echo ######################
               put .travel shard
               waitforre ^YOU ARRIVED
               goto TO_GEM_RUN
          }
GEM_CROSS:
     if ("$zoneid" = "61") then
          {
               var hometown LETH
               echo ######################
               echo ** Traveling to CROSSING to Sell Gems
               echo ######################
               put .travel cross
               waitforre ^YOU ARRIVED
               goto TO_GEM_RUN
          }
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if (("$zoneid" = "66") then
          {
               if (($UC_Forsaken = 1) || (%Necro.Known = 1) || (($UC_SellGems = 1) && ($UC_TiePouch = 1))) then
                    {
                         gosub AUTOMOVE 3
                         pause 4
                    }
          }
     pause 0.0001
     if ("$zoneid" = "66") then gosub AUTOMOVE east
TO_GEM_RUN:
     if matchre("$zoneid","\b(7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     pause 0.0001
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     ### TRAVEL TO GEM SHOP
     if matchre("$zoneid","\b(124|126|127)\b") then
          {
               put .travel hib
               waitforre ^YOU ARRIVED
          }
     if (matchre("$zoneid", "\b(1|61|116)\b")  && ($UC_TiePouch = 1) && ($UC_SellGems = 1)) then
          {
               if (matchre("$zoneid", "\b(1|61)\b") && ($Athletics.Ranks < 500)) then goto TO_GEM_RUN_1
               echo
               echo ######################
               echo *** TIED POUCHES IS ON!
               echo *** MOVING TO SHARD TO SELL FULL POUCHES!!!
               echo ######################
               echo
               if (%Playing = 1) then gosub STOP_PLAY
               put .travel shard
               waitforre ^YOU ARRIVED
          }
TO_GEM_RUN_1:
     if (("$zoneid" = "150") && ("$guild" != "Trader") && ($UC_TiePouch = 1) && (%Teleport = 1)) then
          {
               echo #############################
               echo *** TELEPORTED INTO FC!
               echo *** UNABLE TO SELL TIED POUCHES IN FC!
               echo *** CONSIDER TURNING JUMP JEWELY OFF
               echo *** OR TURN OFF TIED POUCHES
               echo #############################
               put #echo >Log #FF6240 *** SKIPPED selling pouches - Teleported into FC!
               pause 0.5
          }
     if (("$zoneid" = "150") && ("$guild" != "Trader") && ($UC_TiePouch = 1) && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     pause 0.0001
     if matchre("$zoneid","\b(30|40|42)\b") then
          {
               if (($UC_SellGems = 1) && ($UC_TiePouch = 1) && ("$guild" != "Trader")) then
                    {
                         if (("$zoneid" = "30") && ($Athletics.Ranks < 190)) then
                              {
                                   echo ###############################
                                   echo ** Skipping going to Rossman to Sell Pouches
                                   echo ** Not enough Athletics ranks to Swim the Jantspyre!
                                   echo ** GET MORE ATHLETICS NOOOB
                                   echo ###############################
                                   put #echo >Log #FF6240 ** SKIPPED selling tied pouches - Not enough Athletics to make it to Rossman
                                   goto TO_GEM_RUN_2
                              }
                         if ($Athletics.Ranks < 250) then gosub ARMOR_REMOVE
                         send .travel ROSSMAN
                         waitforre ^YOU ARRIVED\!
                         if ($Athletics.Ranks < 250) then gosub WEAR_ARMOR
                    }
          }
     pause 0.0001
TO_GEM_RUN_2:
     ### GO TO SOUTH OF SHARD GEM SHOP (MHAR) IF NEAR SHARD AND TIE POUCH IS ON
     if (matchre("$zoneid","\b(66|67|65|68|69)\b") && ($UC_TiePouch = 1) && ($UC_SellGems = 1)) then
          {
               if ((($UC_shardCitizen = 1) && (%Necro.Known = 0)) || (($Time.isDay = 1) && (%Necro.Known = 0))) then
                    {
                         if ("$zoneid" = "66") then gosub AUTOMOVE east
                         pause 0.4
                         if ("$zoneid" = "67")  then gosub AUTOMOVE south
                         pause 0.2
                         if ("$zoneid" = "65") then gosub AUTOMOVE shard
                         if ("$zoneid" = "69") then gosub AUTOMOVE shard
                         pause 0.1
                         if ("$zoneid" = "66") then gosub AUTOMOVE east
                         pause 0.2
                         if ("$zoneid" = "66") then gosub AUTOMOVE east
                         if ("$zoneid" = "67")  then gosub AUTOMOVE south
                         pause 0.1
                         if ("$zoneid" = "67") then gosub AUTOMOVE south
                    }
                    else
                    {
                         if ("$zoneid" = "65") then gosub AUTOMOVE shard
                         if ("$zoneid" = "69") then gosub AUTOMOVE north
                         pause 0.1
                         if ("$zoneid" = "67") then gosub AUTOMOVE east
                         pause 0.1
                         if ("$zoneid" = "67") then gosub AUTOMOVE east
                         if ("$zoneid" = "66") then gosub AUTOMOVE 3
                         pause
                    }
          }
     if (matchre("$zoneid","\b(47|107)\b") && ($UC_SellGems = 1)) || (matchre("$zoneid","\b(47|107)\b") && ($UC_SellMetals = 1)) then
          {
               if ((matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON")) || (($UC_Premium = 1) && ("%FANGCOVE" = "ON"))) then gosub TO_SEACAVES
          }
     if (("$zoneid" = "107") || ("$zoneid" = "47")) then goto BURGLEPAWN
     if  then goto BURGLEPAWN
     pause 0.0001
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if (("$zoneid" = "67") && ($UC_SellGems = 1) && ($UC_TiePouch = 1) && ($UC_shardCitizen = 1)) then gosub AUTOMOVE south
     if (("$zoneid" = "67") && ($UC_SellGems = 1) && ($UC_TiePouch = 1)) then gosub AUTOMOVE east
     pause 0.0001
     if (("$zoneid" = "66") && ($UC_SellGems = 1) && ($UC_TiePouch = 1)) then
          {
               gosub AUTOMOVE 3
               pause 4
          }
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "68") then
          {
               gosub AUTOMOVE 62
               pause 0.3
               gosub AUTOMOVE 65
               pause 0.3
               gosub AUTOMOVE 68
          }
     gosub AUTOMOVE gem
     pause 0.2
     pause 0.0001
SELLINGGEMS:
     if ($invisible = 1) then gosub STOP_INVIS
     echo #############
     echo *** AT GEM SHOP!
     echo *** PREPARING TO SELL GEMS!
     echo #############
     pause 0.2
     if ("$guild" = "Thief") then
          {
               if ((%khriCUNNING = 1) && ($khriCUNNING = 0) && ($concentration > 55)) then gosub KHRI_START CUNNING
          }
     pause 0.0001
     if ($UC_SellGems = 0) then goto SELLMISC
     pause 0.0001
     if ($UC_WornPouch = 1) then put remove my %gemPouch
     pause 0.5
     if !matchre("$righthand $lefthand", "pouch") then
          {
               put get my %gemPouch
               wait
               pause 0.7
          }
     pause 0.0001
     if !matchre("$righthand $lefthand", "pouch") then
          {
               put get my %gemPouch from my watery portal
               wait
               pause 0.7
          }
     pause 0.0001
     if ((%TotalPouches < 1) || !matchre("$righthand $lefthand", "pouch")) then
          {
               var pouchman NULL
               if matchre("$roomobjs","(Fatimi|Veilex|Anthelorm|Gruk|Mhasulri|Magpie|Shoiya|Rasiya|Wickett|appraiser|clerk|gemsmith)") then var pouchman $1
               pause 0.2
               put ask %pouchman for %gemPouch
               wait
               pause 0.7
          }
     pause 0.0001
     if !matchre("$righthand $lefthand", "pouch")) then
          {
               var pouchman NULL
               if matchre("$roomobjs","(Fatimi|Veilex|Anthelorm|Gruk|Mhasulri|Magpie|Shoiya|Rasiya|Wickett|appraiser|clerk|gemsmith)") then var pouchman $1
               pause 0.2
               put ask %pouchman for black pouch
               var gemPouch black pouch
               wait
               pause 0.7
          }
     pause 0.0001
     if matchre("$righthandnoun $lefthandnoun", "pouch") then
          {
               pause 0.1
               var fill $UC_Container
               gosub FILL_POUCH
               var fill $UC_Container.Box
               gosub FILL_POUCH
               var fill $UC_Container.Backup
               gosub FILL_POUCH
               var fill $UC_Container.Sheath
               gosub FILL_POUCH
               var fill $UC_Container.Crafting
               gosub FILL_POUCH
               pause 0.1
               if !matchre("$UC_Container.Wand1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
                    {
                         var fill $UC_Container.Wand1
                         gosub FILL_POUCH
                    }
               if !matchre("$UC_Container.Wand2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
                    {
                         var fill $UC_Container.Wand2
                         gosub FILL_POUCH
                    }
          }
##################################################################################
#### GEM POUCH SELLING LOGIC BEGIN HERE
SELLING.GEMS:
SELLING_GEMS:
     action (gemprofit) on
     var gemShopMax 0
     var fullPouches 0
     var TotalGemProfit 0
     var TotalGemsSold 0
     var TotalPouchesSold 0
     var gemProfitCurrency 0
     var nonGems 0
     pause 0.01
     pause 0.01
     action var gemShopMax 1 when \"I'm sorry sir\, but we don't have the funds .+\.\"$
     action var nonGems 1 when I only deal in gems or metals here|I only deal with gems and precious metals
     if (matchre("$zoneid", "\b(68|69|34a)\b") || (("$guild" = "Trader") && ($Trading.Ranks >= 53) && ($Appraisal.Ranks >= 52))) then gosub SELL_POUCH
     if (!matchre("$zoneid", "\b(68|69|34a)\b") || (("$guild" = "Trader") && ($Trading.Ranks < 53) && ($Appraisal.Ranks < 52))) then gosub SELL_GEMS %gemPouch
     if ($UC_TiePouch = 1) then
          {
               if !matchre("$zoneid", "\b(68|69|34a)\b") then
                    {
                         echo
                         echo #########################################
                         echo *** ZONE $zoneid NOT A LOCATION TO SELL TIED GEM POUCHES!
                         echo *** Non-Traders can only sell full tied pouches in:
                         echo *** Map 68/69 (Shard area) and 34a (Rossman)
                         echo #########################################
                         echo
                         put #echo >Log #FF6240 ** SKIPPED selling pouches - Map $zoneid NOT location that supports tied gem pouches!
                    }
          }
SELLING_GEMS_2:
     pause 0.0001
     if ($UC_WornPouch = 1) then send wear my %gemPouch
     pause 0.0001
     gosub GET_SELL_POUCH $UC_Container.EmptyPouch
     pause 0.0001
     if (contains("$righthand $lefthand", "pouch") && ("$UC_Container.EmptyPouch" != "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then gosub PUT put %gemPouch in my $UC_Container.EmptyPouch
     pause 0.0001
     if contains("$righthand $lefthand", "pouch") then gosub PUT put %gemPouch in my $UC_Container
     if contains("$righthand $lefthand", "pouch") then gosub PUT put %gemPouch in my $UC_Container.Box
     pause 0.0001
     if contains("$righthand $lefthand", "pouch") then gosub STOW pouch
     # if ("$guild" = "Trader") then goto TRADER_POUCHES
     gosub GET_SELL_POUCH $UC_Container
     gosub GET_SELL_POUCH $UC_Container.Box
     gosub GET_SELL_POUCH $UC_Container.Backup
     gosub GET_SELL_POUCH $UC_Container.Crafting
     if (%fullPouches = 1) then
          {
               var TotalGemsSold 0
          }
     if ($Trading.LearningRate > 33) then goto TRADING_LOCKED
     if ((($UC_TiePouch = 1) && matchre("$zoneid", "\b(68|69|34a)\b")) || ("$guild" = "Trader")) then
          {
               echo
               echo **** Selling Tied Pouches from GemPouch Container
               echo
               pause 0.1
               send open my $UC_Container.GemPouch
               wait
               pause 0.2
               gosub GET_SELL_POUCH $UC_Container.GemPouch
               pause 0.0001
          }
     if ($UC_TiePouch = 0) then
          {
               send open my $UC_Container.GemPouch
               wait
               pause 0.2
               gosub GET_SELL_POUCH $UC_Container.GemPouch
               pause 0.0001
          }
     echo =================================
     echo *** Scanning containers for any loose gems
     echo =================================
     gosub SELL_GEMS $UC_Container
     gosub SELL_GEMS $UC_Container.Box
     gosub SELL_GEMS $UC_Container.Backup
     gosub SELL_GEMS $UC_Container.Crafting
     gosub SELL_GEMS $UC_Container.GemPouch
     if matchre("%ALLCONTAINERS", "(?i)(eddy|portal)") then gosub SELL_GEMS portal
     pause 0.3
     gosub PUT close my $UC_Container.GemPouch
     goto SELL_GEMS_DONE
TRADING_LOCKED:
     echo ########################
     echo  ** TRADING LOCKED!
     echo  ** SKIPPING REST OF POUCHES
     echo ########################
     gosub STOW pouch
     goto SELL_GEMS_DONE
####################################################
# Take out all pouches from EmptyPouch container to make sure only empty pouches go in and we sell all pouches with gems
GEMPOUCH_PREP:
     if matchre("$UC_Container.EmptyPouch", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then return
     var gempreploop 0
     echo #######################################
     echo * MAKING SURE ALL GEM POUCHES ARE IN EMPTY POUCH CONTAINER
     echo #######################################
     pause 0.4
     var TempContainer $UC_Container
     if (!matchre("$UC_Container.Box", "$UC_Container.EmptyPouch") && !matchre("$UC_Container.EmptyPouch", "(?i)$UC_Container.Box")) then
          {
               var gempreploop 0
               var TempContainer $UC_Container.Box
               gosub GEM_PREP1
          }
     if (!matchre("$UC_Container.Backup", "$UC_Container.EmptyPouch") && !matchre("$UC_Container.EmptyPouch", "(?i)$UC_Container.Backup")) then
          {
               var gempreploop 0
               var TempContainer $UC_Container.Backup
               gosub GEM_PREP1
          }
     if (!matchre("$UC_Container.Crafting", "$UC_Container.EmptyPouch") && !matchre("$UC_Container.EmptyPouch", "(?i)$UC_Container.Crafting")) then
          {
               var gempreploop 0
               var TempContainer $UC_Container.Crafting
               gosub GEM_PREP1
          }
     if (!matchre("$UC_Container", "$UC_Container.EmptyPouch") && !matchre("$UC_Container.EmptyPouch", "(?i)$UC_Container")) then
          {
               var gempreploop 0
               var TempContainer $UC_Container
               gosub GEM_PREP1
          }
     pause 0.0001
     return
GEM_PREP1:
     math gempreploop add 1
     gosub GET %gemPouch from my %TempContainer
     pause 0.0001
     if !matchre("$righthand $lefthand", "pouch") then gosub GET gem pouch from my %TempContainer
     pause 0.0001
     if (%gempreploop > 9) then return
     if matchre("$righthand $lefthand", "pouch") then gosub PUT put %gemPouch in my $UC_Container.EmptyPouch
     if !matchre("$righthand $lefthand", "pouch") then return
     if !matchre("$righthand $lefthand", "pouch") then return
     if (matchre("$righthand $lefthand", "pouch") && !matchre("%TempContainer", "$UC_Container") && !matchre("$UC_Container", "(?i)$UC_Container.EmptyPouch")) then gosub PUT put %gemPouch in my $UC_Container
     if !matchre("$righthand $lefthand", "pouch") then return
     if (matchre("$righthand $lefthand", "pouch") && !matchre("%TempContainer", "$UC_Container.Box") && !matchre("$UC_Container.Box", "(?i)$UC_Container.EmptyPouch")) then gosub PUT put %gemPouch in my $UC_Container.Box
     if (matchre("$righthand $lefthand", "pouch") && !matchre("%TempContainer", "$UC_Container.Backup") && !matchre("$UC_Container.Backup", "(?i)$UC_Container.EmptyPouch")) then gosub PUT put %gemPouch in my $UC_Container.Backup
     if !matchre("$righthand $lefthand", "pouch") then return
     if (matchre("$righthand $lefthand", "pouch") && !matchre("%TempContainer", "$UC_Container.Crafting") && !matchre("$UC_Container.Crafting", "(?i)$UC_Container.EmptyPouch")) then gosub PUT put %gemPouch in my $UC_Container.Crafting
     if matchre("$righthand $lefthand", "pouch") then
          {
               gosub PUT put %gemPouch in my $UC_Container.EmptyPouch
               echo ######################################################
               echo ** ERROR WITH GEM POUCH PREPPING
               echo ** YOUR CONTAINER.EMPTYPOUCH IS SET THE SAME AS YOUR MAIN CONTAINERS
               echo ** USE A DIFFERENT CONTAINER TO MAKE SURE THIS WORKS
               echo ** All this does is make sure you don't have a loose gem pouch with gems in that container - no big deal.
               echo ######################################################
          }
     return
#################
GET_SELL_POUCH:
     var number |first|second|third|fourth|fifth|sixth|seventh|eighth|ninth|tenth|eleventh|twelfth
     var sellingloop 0
     var pouchnumber 0
     var newreport 0
     var vessel $0
     echo
     echo #############################
     echo *** Checking: %vessel for gem pouches
     echo #############################
     echo
GET_SELL_POUCH_2:
     action (gemprofit) on
     math sellingloop add 1
     if (%sellingloop > 12) then return
     pause 0.1
     if ("$guild" = "Trader") then
          {
               if ($Trading.LearningRate > 33) then goto TRADING_LOCKED
          }
     # gosub GET %number(%pouchnumber) %gemPouch from my %vessel
     gosub GET %gemPouch from my %vessel
     pause 0.3
     pause 0.1
     if !matchre("$righthand $lefthand", "pouch") then
          {
               gosub GET gem pouch from my %vessel
               pause 0.5
               pause 0.3
          }
     pause 0.0001
     pause 0.0001
     ## CHECK HERE IF NOTHING IN HAND AFTER TRYING TO GET POUCHES FROM BAG THEN RETURN
     if (matchre("$righthand", "Empty") && matchre("$lefthand", "Empty")) then return
     ############
     if matchre("$righthand $lefthand", "pouch") then
          {
               if (("$guild" = "Trader") || matchre("$zoneid", "\b(68|69|34a)\b")) then
                    {
                         gosub SELL_POUCH
                    }
               if (("$guild" != "Trader") && !matchre("$zoneid", "\b(68|69|34a)\b")) then gosub SELL_GEMS %gemPouch
          }
     pause 0.0001
     ## if !matchre("$righthand $lefthand", "pouch") then return
     if (matchre("$righthand $lefthand", "pouch") && !matchre("$UC_Container.EmptyPouch", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%vessel", "(?i)$UC_Container.EmptyPouch") && !matchre("$UC_Container.EmptyPouch", "(?i)%vessel")) then gosub PUT put pouch in my $UC_Container.EmptyPouch
     pause 0.0001
     if (matchre("$righthand $lefthand", "pouch") && !matchre("%vessel", "(?i)$UC_Container") && !matchre("$UC_Container", "(?i)%vessel")) then gosub PUT put pouch in my $UC_Container
     pause 0.0001
     if (matchre("$righthand $lefthand", "pouch") && !matchre("%vessel", "(?i)$UC_Container.Backup") && !matchre("$UC_Container.Backup", "(?i)%vessel")) then gosub PUT put pouch in my $UC_Container.Backup
     if (matchre("$righthand $lefthand", "pouch") && !matchre("%vessel", "(?i)$UC_Container.Box") && !matchre("$UC_Container.Box", "(?i)%vessel")) then gosub PUT put pouch in my $UC_Container.Box
     pause 0.0001
     if (matchre("$righthand $lefthand", "pouch") && !matchre("%vessel", "(?i)$UC_Container.Crafting") && !matchre("$UC_Container.Crafting", "(?i)%vessel")) then gosub PUT put pouch in my $UC_Container.Crafting
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then
          {
                    echo #############################################
                    echo ** ERROR WITH GEM POUCH STOWING
                    echo ** YOU MUST HAVE ALL CONTAINERS SET THE SAME AS CONTAINER.EMPTYPOUCH
                    echo ** USE A DIFFERENT SEPARATE CONTAINER FOR CONTAINER.EMPTYPOUCH
                    echo ** GET SOME MORE BAGS!!!
                    echo #############################################
                    pause
                    gosub stowing
          }
     goto GET_SELL_POUCH_2
SELL_POUCH:
     var fullPouches 1
     var sellPouchLoop 0
SELL_POUCH_1:
     math pouchnumber add 1
     math sellPouchLoop add 1
     pause 0.0001
     send sell pouch
     pause 0.2
     pause 0.1
     send sell pouch
     pause 0.2
     pause 0.0001
     if (%sellPouchLoop > 5) then return
     if (%nonGems = 1) then
          {
               gosub NON_GEM_REMOVE
               goto SELL_POUCH_1
          }
     if (%TotalGemsSold != 0) then var TotalPouchesSold %TotalGemsSold
     if ((%pouchsold = 1) && (%newreport = 1)) then
          {
               var newreport 0
               echo
               echo *** POUCHES SOLD: %TotalPouchesSold
               echo
               pause 0.0001
          }
     return
NON_GEM_REMOVE:
     echo
     echo ################################
     echo # NON-GEMS IN OUR GEM POUCH!!!
     echo # ATTEMPTING TO REMOVE!!
     echo ################################
     echo
     pause 0.1
     pause 0.2
     put look in my %gemPouch
     pause 0.2
     pause 0.1
     gosub STONE_REMOVE tukai
     gosub STONE_REMOVE kyanite
     gosub STONE_REMOVE jadeite
     gosub STONE_REMOVE waermodi
     pause 0.1
     gosub NON_GEM_CHECK
     var nonGems 0
     return
##############################################
NON_GEM_CHECK:
     var nongemloop 0
     pause 0.001
NON_GEM_CHECK_1:
     math nongemloop add 1
     pause 0.1
     matchre REMOVE_BADITEM \b(ruby|potency crystal|infuser stone|runestone|(tukai|jadeite|waermodi) stone|nugget|ingot|fragment|sanowret crystal|crystal)\b
	matchre NON_GEM_CHECK_DONE In the|nothing|What
	put rumm in my %gemPouch
	matchwait 7
     return
REMOVE_BADITEM:
     var item $1
     pause 0.1
     pause 0.2
     gosub PUT get %item from my %gemPouch
     pause 0.5
     gosub STOWIT %item
     pause 0.1
     pause 0.1
     if (%nongemloop > 8) then goto NON_GEM_CHECK_DONE
	goto NON_GEM_CHECK_1
NON_GEM_CHECK_DONE:
     unvar nongemloop
     return
##############################################
STONE_REMOVE:
     var stonething $1
STONE_REMOVE_1:
     pause 0.001
     gosub PUT get %stonething stone from my %gemPouch
     pause 0.1
     pause 0.1
     if matchre("$righthand $lefthand", "stone") then
          {
               put drop my stone
               wait
               pause 0.2
               goto STONE_REMOVE_1
          }
     gosub GLANCE
     if matchre("$righthand $lefthand", "stone") then
          {
               put drop my stone
               wait
               pause 0.2
               goto STONE_REMOVE_1
          }
     return
##############################################
SELL_GEMS_DONE:
     action (gemprofit) off
     var pouchesFull 0
     if (%TotalGemProfit = 0) then goto SELL_MISC_GEMS
     var Plat 0
     var Gold 0
     var Silver 0
     var Bronze 0
     var Copper 0
     evalmath Plat floor(%TotalGemProfit/10000)
     evalmath Gold floor((%TotalGemProfit-(%Plat*10000))/1000)
     evalmath Silver floor((%TotalGemProfit-(%Plat*10000)-(%Gold*1000))/100)
     evalmath Bronze floor((%TotalGemProfit-(%Plat*10000)-(%Gold*1000)-(%Silver*100))/10)
     evalmath Copper floor((%TotalGemProfit-(%Plat*10000)-(%Gold*1000)-(%Silver*100)-(%Bronze*10))/1)
     pause 0.0001
     if (%fullPouches = 0) then
          {
               echo
               echo
               echo #########################
               echo #########################
               echo * Sold %TotalGemsSold gems
               echo * Profit: %TotalGemProfit %gemProfitCurrency
               echo * %Plat plat /%Gold gold /%Silver silver /%Bronze bronze /%Copper copper
               echo #########################
               echo #########################
               echo
               echo
               put #echo >Log #00FF00 * Sold %TotalGemsSold gems - %TotalGemProfit %gemProfitCurrency
               # if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log #00FF00 * Sold %TotalGemsSold gems - %TotalGemProfit %gemProfitCurrency
               # if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log #00FF00 * Sold %TotalGemsSold gems - %TotalGemProfit %gemProfitCurrency
               # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log #00FF00 * Sold %TotalGemsSold gems - %TotalGemProfit %gemProfitCurrency
               # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log #00FF00 * Sold %TotalGemsSold gems - %TotalGemProfit %gemProfitCurrency
          }
     if (%fullPouches = 1) then
          {
          if (%TotalGemsSold = 0) then
               {
                    echo
                    echo
                    echo #########################
                    echo #########################
                    if (%TotalPouchesSold != 1) then echo * Sold %TotalPouchesSold gem pouches
                    if (%TotalPouchesSold = 1) then echo * Sold %TotalPouchesSold gem pouch
                    echo * Profit: %TotalGemProfit %gemProfitCurrency
                    echo * %Plat plat /%Gold gold /%Silver silver /%Bronze bronze /%Copper copper
                    echo #########################
                    echo #########################
                    echo
                    echo
                    if (%TotalPouchesSold = 1) then
                         {
                              put #echo >Log #00FF00 * Sold %TotalPouchesSold gem pouch - %TotalGemProfit %gemProfitCurrency
                              # if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log #00FF00 * Sold %TotalPouchesSold pouch - %TotalGemProfit %gemProfitCurrency
                              # if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log #00FF00 * Sold %TotalPouchesSold pouch - %TotalGemProfit %gemProfitCurrency
                              # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log #00FF00 * Sold %TotalPouchesSold pouch - %TotalGemProfit %gemProfitCurrency
                              # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log #00FF00 * Sold %TotalPouchesSold pouch - %TotalGemProfit %gemProfitCurrency
                         }
                    if (%TotalPouchesSold != 1) then
                         {
                              put #echo >Log #00FF00 * Sold %TotalPouchesSold gem pouches - %TotalGemProfit %gemProfitCurrency
                              # if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log #00FF00 * Sold %TotalPouchesSold pouches - %TotalGemProfit %gemProfitCurrency
                              # if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log #00FF00 * Sold %TotalPouchesSold pouches - %TotalGemProfit %gemProfitCurrency
                              # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log #00FF00 * Sold %TotalPouchesSold pouches - %TotalGemProfit %gemProfitCurrency
                              # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log #00FF00 * Sold %TotalPouchesSold pouches - %TotalGemProfit %gemProfitCurrency
                         }
               }
          if (%TotalGemsSold != 0) then
               {
                    echo
                    echo
                    echo #########################
                    echo #########################
                    if (%TotalPouchesSold != 1) then echo * Sold %TotalPouchesSold gem pouches / %TotalGemsSold gems
                    if (%TotalPouchesSold = 1) then echo * Sold %TotalPouchesSold gem pouch / %TotalGemsSold gems
                    echo * Profit: %TotalGemProfit %gemProfitCurrency
                    echo * %Plat plat /%Gold gold /%Silver silver /%Bronze bronze /%Copper copper
                    echo #########################
                    echo #########################
                    echo
                    echo
                    if (%TotalPouchesSold = 1) then put #echo >Log #00FF00 * Sold %TotalPouchesSold gem pouch / %TotalGemsSold gems - Profit: %TotalGemProfit %gemProfitCurrency
                    if (%TotalPouchesSold != 1) then put #echo >Log #00FF00 * Sold %TotalPouchesSold gem pouches / %TotalGemsSold gems- Profit: %TotalGemProfit %gemProfitCurrency
               }
          }
     math TotalProfit add %TotalGemProfit
     pause 0.0001
SELLMISC:
SELL_MISC_GEMS:
     pause 0.0001
     var TotalGemsSold 0
     var TotalGemProfit 0
     var TotalPouchesSold 0
SELL_NUGS:
     pause 0.0001
     action (gemprofit) on
     if (%gemShopMax = 1) then
          {
          echo
          echo ##############################
          echo # GEM SHOP MAXED OUT! NEEDS TO BE FINANCED!
          echo # MOVING BACK TO REGULAR GEM SHOP IN TOWN
          echo # TO SELL METALS / NUGS / ETC
          echo ##############################
          echo
          if ("$zoneid" = "34a") then
               {
                    put .travel river
                    waitforre ^YOU ARRIVED
               }
          if ("$zoneid" = "68") then
               {
                    gosub AUTOMOVE 68
                    gosub AUTOMOVE 65
                    gosub AUTOMOVE 62
                    pause 0.1
                    if ($Athletics.Ranks > 350) then
                         {
                              gosub AUTOMOVE 2
                              pause 0.2
                              put climb wall
                              wait
                              pause 0.4
                         }
                    if (($UC_shardCitizen = 0) && ($Time.isDay = 0)) then
                         {
                              if ("$zoneid" = "68") then gosub AUTOMOVE 15
                              if ("$zoneid" = "68") then gosub AUTOMOVE 15
                         }
                    if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then
                         {
                              if ("$zoneid" = "68") then gosub AUTOMOVE shard
                              if ("$zoneid" = "68") then gosub AUTOMOVE shard
                         }
                    if ("$zoneid" = "66") then gosub AUTOMOVE east
                    pause 0.1
               }
               gosub AUTOMOVE gem
          }
     if (($UC_WornPouch = 1) && matchre("$righthandnoun $lefthandnoun", "pouch")) then send wear my pouch
     pause 0.1
     if matchre("$righthandnoun $lefthandnoun", "pouch") then gosub STOW my pouch
     pause 0.0001
     gosub GEMPOUCH_PREP
     pause 0.0001
     if ($UC_SellMetals = 1) then gosub SELL_NUGGETS
     gosub stowing
SELL_NUGS_DONE:
     action (gemprofit) off
     if (%TotalGemProfit = 0) then goto SELL_NUGS_COMPLETE
     var Plat 0
     var Gold 0
     var Silver 0
     var Bronze 0
     var Copper 0
     var gemShopMax 0
     evalmath Plat floor(%TotalGemProfit/10000)
     evalmath Gold floor((%TotalGemProfit-(%Plat*10000))/1000)
     evalmath Silver floor((%TotalGemProfit-(%Plat*10000)-(%Gold*1000))/100)
     evalmath Bronze floor((%TotalGemProfit-(%Plat*10000)-(%Gold*1000)-(%Silver*100))/10)
     evalmath Copper floor((%TotalGemProfit-(%Plat*10000)-(%Gold*1000)-(%Silver*100)-(%Bronze*10))/1)
     pause 0.0001
     math TotalProfit add %TotalGemProfit
     put #echo >Log #00FF00 * Sold %TotalGemsSold metals - %TotalGemProfit %gemProfitCurrency
     # if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log #00FF00 * Sold %TotalGemsSold metals - %TotalGemProfit %gemProfitCurrency
     # if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log #00FF00 * Sold %TotalGemsSold metals - %TotalGemProfit %gemProfitCurrency
     # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log #00FF00 * Sold %TotalGemsSold metals - %TotalGemProfit %gemProfitCurrency
     # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log #00FF00 * Sold %TotalGemsSold metals - %TotalGemProfit %gemProfitCurrency
     echo
     echo
     echo ##############################
     echo ##############################
     echo ** Sold: %TotalGemsSold nuggets/bars / Profit: %TotalGemProfit %gemProfitCurrency
     echo ** %Plat plat /%Gold gold /%Silver silver /%Bronze bronze /%Copper copper
     echo ##############################
     echo ##############################
     echo
     echo
     pause 0.5
     pause 0.1
     action remove \"I'm sorry sir\, but we don't have the funds .+\.\"$
     unvar TotalPouchesSold
     unvar TotalGemProfit
     unvar TotalGemsSold
     unvar gemProfitCurrency
     unvar gempreploop
     unvar TempContainer
     unvar vessel
     unvar pouchnumber
     unvar sellingloop
SELL_NUGS_COMPLETE:
     pause 0.0001
     # if (%TotalPouches < 2) then goto POUCHES
     if ($UC_SellMetals = 1) then
          {
               if (%TotalPouches < 2) then goto POUCHES
          }
     if ($UC_SellGems = 1) then goto POUCHES
     goto BURGLEPAWN
###########################################################################################
## GET NEW POUCHES
###########################################################################################
POUCH_RUN:
POUCHES:
     var NEXTSUB BURGLEPAWN
     var LAST POUCHES
     var CURRENT Gem Pouches
     gosub STATUSBAR
     pause 0.0001
     var LAST POUCHES
     if (($UC_F2P = 1) && (%TotalPouches > 0)) then goto BURGLEPAWN
     if (%TotalPouches < 5) then goto BUY_POUCHES
     goto BURGLEPAWN
BUY_POUCHES:
     pause 0.0001
     if ("$zoneid" = "34a") then
          {
               put .travel river
               waitforre ^YOU ARRIVED
          }
     if ("$zoneid" = "69") then
          {
               gosub AUTOMOVE north
               pause 0.2
               gosub AUTOMOVE east
               pause 0.2
               if ("$zoneid" = "66") then gosub AUTOMOVE east
               gosub AUTOMOVE gem
          }
     if ("$zoneid" = "68") then
          {
               gosub AUTOMOVE 68
               gosub AUTOMOVE 65
               gosub AUTOMOVE 62
               pause 0.1
               if ($Athletics.Ranks > 350) then
                    {
                         gosub AUTOMOVE 2
                         pause 0.2
                         put climb wall
                         wait
                         pause 0.4
                    }
               if (($UC_shardCitizen = 0) && ($Time.isDay = 0)) then
                    {
                         if ("$zoneid" = "68") then gosub AUTOMOVE 15
                         if ("$zoneid" = "68") then gosub AUTOMOVE 15
                    }
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then
                    {
                         if ("$zoneid" = "68") then gosub AUTOMOVE shard
                         if ("$zoneid" = "68") then gosub AUTOMOVE shard
                    }
               if ("$zoneid" = "66") then gosub AUTOMOVE east
               pause 0.1
               gosub AUTOMOVE gem
          }
     var pouchesbought 0
     evalmath pouchesneeded 6-%TotalPouches
     var pouchman nil
     gosub put look
     pause 0.5
     if matchre("$roomobjs","(Fatimi|Veilex|Anthelorm|Gruk|Mhasulri|Magpie|Shoiya|Rasiya|Wickett|appraiser|clerk)") then var pouchman $1
     if ("%pouchman" = "nil") then
          {
               echo ################################
               echo *** Error! No Pouch Giver found?!!?!
               echo *** SEND ME A FULL DESCRIPTION OF THE ROOM
               echo ################################
               goto BURGLEPAWN
          }
BUY_POUCH_GO:
     pause 0.0001
     pause 0.0001
     pause 0.0001
     gosub put ask %pouchman for %gemPouch
     pause 0.5
     pause 0.3
     send put %gemPouch in my $UC_Container.EmptyPouch
     wait
     pause 0.5
     gosub STOWING
     math pouchesneeded subtract 1
     if ($UC_F2P = 1) then goto BURGLEPAWN
     if (%pouchesneeded = 0) then goto BURGLEPAWN
     goto BUY_POUCH_GO
#############################################################################
## BURGLE PAWN - PAWN BURGLE ITEMS
#######################################
BURGLE_PAWN:
BURGLEPAWN:
     var LAST BURGLEPAWN
     var NEXTSUB BURGLE_PAWNDONE
     var CURRENT Burgle Pawn
     var burgleSold 0
     var burgleProfit 0
     var burgleCurrency Kronars
     gosub STATUSBAR
     if !def(BURGLE.KEEP) then put #var BURGLE.KEEP NULL
     pause 0.0001
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     ## GO BACK TO TOWN
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     pause 0.0001
     if ("$zoneid" = "34a") then
          {
               put .travel river
               waitforre ^YOU ARRIVED
          }
     if ("$zoneid" = "68") then
          {
               if (matchre("$roomname", "(Blackthorn Canyon|Corik's Wall|Stormfells|Shadow's Reach|Reach Forge|Darkling Wood, Trader Outpost)") || (($roomid > 65) && ($roomid < 75))) then
                    {
                         gosub AUTOMOVE 68
                         gosub AUTOMOVE 65
                         gosub AUTOMOVE 62
                         pause 0.1
                    }
               if ($Athletics.Ranks > 350) then
                    {
                         gosub AUTOMOVE 2
                         pause 0.2
                         put climb wall
                         wait
                         pause 0.4
                    }
               if ((($UC_shardCitizen = 1) && (%Necro.Known = 0)) || (($Time.isDay = 1) && (%Necro.Known = 0))) then
                    {
                         if ("$zoneid" = "68") then gosub AUTOMOVE shard
                         if ("$zoneid" = "68") then gosub AUTOMOVE shard
                    }
               if ((($UC_shardCitizen = 0) && ($Time.isDay = 0)) || (%Necro.Known = 1)) then
                    {
                         if ("$zoneid" = "68") then gosub AUTOMOVE 15
                         if ("$zoneid" = "68") then gosub AUTOMOVE 15
                    }
          }
     if matchre("$zoneid","\b(8|7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(8|7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(31|32|33)\b") then gosub AUTOMOVE river
     if (("$zoneid" = "61") && !matchre("$UC_HomeCity", "(?i)(CROSS|XING|RIVER|HAVEN|THEREN|MUSPARI)")) then
          {
               var hometown LETH
               put .travel shard
               waitforre ^YOU ARRIVED
               goto TO_BURGLE_PAWN
          }
     if ("$zoneid" = "61") then
          {
               var hometown LETH
               put .travel cross
               waitforre ^YOU ARRIVED
               goto TO_BURGLE_PAWN
          }
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     pause 0.0001
     if ("$zoneid" = "66") then gosub AUTOMOVE east
TO_BURGLE_PAWN:
     if ($UC_BurglePawn = 0) then goto BURGLE_PAWNDONE
     # if matchre("$zoneid","\b(61|150)\b") then goto NO_PAWN
     if !matchre("$zoneid","\b(47|61|150)\b") then gosub AUTOMOVE pawn
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     if ("$zoneid" = "61") then gosub AUTOMOVE gems
     if ("$zoneid" = "107") then gosub AUTOMOVE 243
     ## put #echo >Log #0093fb *** PAWNING/DUMPING BURGLE ITEMS
     echo
     echo ##################
     echo *** PAWNING BURGLED ITEMS!
     echo ##################
     echo
     pause 0.3
     var burgleTemp $BURGLE.KEEP
     eval burgleTemp replacere("%burgleTemp", "\|+", "|")
     eval burgleTemp replacere("%burgleTemp", "\|$", "")
     eval burgleTemp replacere("%burgleTemp", "^\|", "")
     pause 0.0001
     put #var BURGLE.KEEP %burgleTemp
     echo
     echo ########################
     echo *** BURGLE ITEMS SET TO KEEP:
     echo *** $BURGLE.KEEP
     echo ########################
     echo
     pause 0.3
     if ($invisible = 1) then gosub STOP_INVIS
     gosub stowing
     pause 0.0001
     if ("$BurgleItem1" != "NULL") then gosub PAWN_IT $BurgleItem1
     if ("$BurgleItem2" != "NULL") then gosub PAWN_IT $BurgleItem2
     if ("$BurgleItem3" != "NULL") then gosub PAWN_IT $BurgleItem3
     if ("$BurgleItem4" != "NULL") then gosub PAWN_IT $BurgleItem4
     goto BURGLE_PAWNDONE
NO_PAWN:
     echo
     echo ##################
     echo ** NO PAWN SHOP HERE - Skipping
     echo ##################
     echo
     goto BURGLE_PAWNDONE
BURGLE_PAWNDONE:
     pause 0.0001
     action remove hands you (\d+) (Kronars?|Lirums?|Dokoras?|kronars?|lirums?|dokoras?)
     var Plat 0
     var Gold 0
     var Silver 0
     var Bronze 0
     var Copper 0
     evalmath Plat floor(%burgleProfit/10000)
     evalmath Gold floor((%burgleProfit-(%Plat*10000))/1000)
     evalmath Silver floor((%burgleProfit-(%Plat*10000)-(%Gold*1000))/100)
     evalmath Bronze floor((%burgleProfit-(%Plat*10000)-(%Gold*1000)-(%Silver*100))/10)
     evalmath Copper floor((%burgleProfit-(%Plat*10000)-(%Gold*1000)-(%Silver*100)-(%Bronze*10))/1)
     pause 0.0001
     if (%burgleSold > 0) then
          {
               put #echo >Log #00FF00 * Sold %burgleSold burgle items - %burgleProfit %burgleCurrency
               # if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log #00FF00 * Sold %burgleSold burgle items - %burgleProfit %burgleCurrency
               # if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log #00FF00 * Sold %burgleSold burgle items - %burgleProfit %burgleCurrency
               # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log #00FF00 * Sold %burgleSold burgle items - %burgleProfit %burgleCurrency
               # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log #00FF00 * Sold %burgleSold burgle items - %burgleProfit %burgleCurrency
               echo
               echo ###########################
               echo *** SOLD %burgleSold BURGLE ITEMS!
               echo *** PROFIT: %burgleProfit %burgleCurrency (%Plat p/%Gold g/%Silver s/%Bronze b/%Copper c)
               echo ###########################
               echo
               pause 0.4
          }
     pause 0.0001
     gosub OPEN $UC_Container.Backup
     gosub clear
     goto INVENTORY_CHECK
###################################################################################
### INVENTORY CHECK - CHECK CURRENT STOCK OF ITEMS
INVENTORY_CHECK:
INVCHECK:
     var TotalRope 0
     var TotalPouches 0
     var AltPouches 0
     var TotalLead 0
     var TempPouch NULL
     var NEXTSUB BANK_RUN
     var LAST INVCHECK
     var CURRENT Inventory Check
     gosub STATUSBAR
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     # if ("$guild" = "Necromancer") then
          # {
               # if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          # }
     echo #############
     echo *** INVENTORY CHECK
     echo #############
     pause
     gosub INVENTORY_PRECHECK FULL
     var nocheck NULL
INVENTORY_CHECK_2:
     pause 0.5
     action remove braided lead rope
     action remove some bundling rope
     action remove black gem pouch
     action remove %TempPouch gem pouch
# TRASH REMOVAL / INVENTORY MANAGEMENT
MOVE_TO_TRASH:
DUMPING:
TRASHRUN:
TRASH_RUN:
PAWN_RUN:
PAWNRUN:
     var NEXTSUB BANK_RUN
     var LAST MOVE_TO_TRASH
     if matchre("$scriptlist" , "disarm\.cmd") then put #script abort disarm
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     gosub stowing
     echo
     echo ##########################
     echo *** LOOKING FOR A BUCKET
     echo *** OR PAWN SHOP TO DUMP TRASH
     echo ##########################
     echo
     pause 0.5
     ##### MOVE TO A PLACE WITH A BUCKET OR TRASH
     if ("$zoneid" = "69") then
          {
               if (($UC_shardCitizen = 0) || ($Time.isDay = 0)) then
                    {
                         gosub AUTOMOVE 1
                         if ("$zoneid" = "69") then gosub AUTOMOVE 1
                    }
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then
                    {
                         gosub AUTOMOVE shard
                         if ("$zoneid" = "69") then gosub AUTOMOVE shard
                    }
          }
     if ("$zoneid" = "68") then
          {
               if (matchre("$roomname", "(Blackthorn Canyon|Corik's Wall|Stormfells|Shadow's Reach|Reach Forge|Darkling Wood, Trader Outpost)") || (($roomid > 65) && ($roomid < 75))) then
                    {
                         gosub AUTOMOVE 68
                         gosub AUTOMOVE 65
                         gosub AUTOMOVE 62
                         pause 0.1
                    }
               if ($Athletics.Ranks > 250) then
                    {
                         gosub AUTOMOVE 2
                         pause 0.2
                         put climb wall
                         wait
                         pause 0.4
                    }
               if ((($UC_shardCitizen = 1) && (%Necro.Known = 0)) || (($Time.isDay = 1) && (%Necro.Known = 0))) then
                    {
                         if ("$zoneid" = "68") then gosub AUTOMOVE shard
                         if ("$zoneid" = "68") then gosub AUTOMOVE shard
                    }
               if ((($UC_shardCitizen = 0) && ($Time.isDay = 0)) || (%Necro.Known = 1)) then
                    {
                         if ("$zoneid" = "68") then gosub AUTOMOVE 15
                         if ("$zoneid" = "68") then gosub AUTOMOVE 15
                    }
          }
     pause 0.2
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "124") then gosub AUTOMOVE hib
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "1") then gosub AUTOMOVE pawn
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     if ("$zoneid" = "116") then gosub AUTOMOVE 44
     if ("$zoneid" = "67") then gosub AUTOMOVE pawn
     if ("$zoneid" = "61") then gosub AUTOMOVE 17
     if ("$zoneid" = "30") then gosub AUTOMOVE 8
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if ("$zoneid" = "42") then gosub AUTOMOVE pawn
     if ("$zoneid" = "90") then gosub AUTOMOVE 42
     if ("$zoneid" = "99") then gosub AUTOMOVE 91
     if ("$zoneid" = "107") then gosub AUTOMOVE 58
     if matchre("$guild", "%MAGICUSER") then gosub PERCEIVE_TIMER
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK

DUMP_EXCESS:
     var CURRENT Inventory clearing
     if !matchre("$UC_Container.GemPouch", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT close my $UC_Container.GemPouch
     pause 0.0001
     if (!matchre("$UC_Container.GemPouch", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("$UC_Container.GemPouch", "(?i)$UC_Container.RepairKit\b") then gosub PUT close my $UC_Container.RepairKit
     pause 0.0001
     if ($UC_InvCheck = 0) then goto TRASH_CHECK
     gosub DUMPSTER_CHECK
     echo
     echo #########################
     echo *** ~ INVENTORY MANAGEMENT MODULE ~
     echo *** CLEARING OUT JUNK/EXCESS ITEMS
     echo ##########################
     echo
     pause 0.5
     gosub STATUSBAR
     echo
     echo ####################
     echo *** %TotalRope bundling rope
     echo *** %TotalPouches gem pouches
     if (%AltPouches > 0) then echo *** ALT POUCHES!!! - %AltPouches %AltPouchColor gem pouches
     echo ####################
     echo
     pause 0.8
     pause 0.1
     ### DUMP LEAD ROPES
     if (%TotalLead > 1) then gosub DUMP_LEAD
     ### DUMP EXCESS BUNDLING ROPE
     if (%TotalRope > 4) then gosub DUMP_ROPE
     if ((%TotalRope > 1) && ($UC_F2P = 1)) then gosub DUMP_ROPE
     ### DUMP EXCESS GEM POUCHES
     if ($UC_PouchDump = 0) then goto TRASH_CHECK
     if (%TotalPouches > 10) then gosub DUMP_POUCH
     if ((%TotalPouches > 2) && ($UC_F2P = 1)) then gosub DUMP_POUCH_F2P
     if (%AltPouches > 0) then gosub DUMP_POUCH_ALT
     ### DUMP EXCESS NECRO MATERIAL
     if (%Necro.Material > 6) then gosub DUMP_MATERIAL

     ### CHECK IF WE HAVE TRASH RUN ON
     if ($UC_TrashDump = 0) then goto BANK_RUN
     goto TRASH_CHECK
#####################################################
DUMP_MATERIAL:
     pause 0.0001
     math Necro.Material subtract 1
     gosub GET my material
     pause 0.0001
     if ("%dumpster" != "NULL") then gosub PUT put my material in %dumpster
     pause 0.1
     pause 0.2
     if matchre("$righthand $lefthand", "material")) then put drop my material
     pause 0.2
     if (%Necro.Material > 6) then goto DUMP_MATERIAL
     return
DUMP_ROPE:
     pause 0.0001
     math TotalRope subtract 1
     gosub GET my second bundling rope
     pause 0.0001
     if ("%dumpster" != "NULL") then gosub PUT put my rope in %dumpster
     pause 0.1
     pause 0.2
     if matchre("$righthand $lefthand", "rope")) then put drop my rope
     pause 0.2
     if (%TotalRope > 4) then goto DUMP_ROPE
     if ((%TotalRope > 1) && ($UC_F2P = 1)) then goto DUMP_ROPE
     return
DUMP_POUCH:
     if ($UC_F2P = 1) then goto DUMP_POUCH_F2P
     pause 0.01
     math TotalPouches subtract 1
     gosub GET my eleventh %gemPouch
     pause 0.1
     if !matchre("$righthand $lefthand", "gem pouch")) then gosub GET my eleventh gem pouch
     pause 0.1
     pause 0.3
     if !matchre("$righthand $lefthand", "gem pouch")) then return
     if ("%dumpster" != "NULL") then gosub PUT put my pouch in %dumpster
     pause 0.1
     pause 0.2
     if matchre("$righthand $lefthand", "gem pouch")) then put drop my pouch
     pause 0.1
     if (%TotalPouches > 10) then goto DUMP_POUCH
     return
DUMP_POUCH_F2P:
     pause 0.01
     math TotalPouches subtract 1
     gosub GET my second %gemPouch
     pause 0.1
     if !matchre("$righthand $lefthand", "gem pouch")) then gosub GET my second gem pouch
     pause 0.1
     pause 0.3
     if !matchre("$righthand $lefthand", "gem pouch")) then return
     if ("%dumpster" != "NULL") then gosub PUT put my pouch in %dumpster
     pause 0.1
     pause 0.2
     if matchre("$righthand $lefthand", "gem pouch")) then put drop my pouch
     pause 0.1
     if (%TotalPouches > 2) then goto DUMP_POUCH_F2P
     return
DUMP_POUCH_ALT:
     pause 0.01
     echo
     echo ==========================
     echo *** %AltPouchColor gem pouches found in inventory
     echo *** DUMPING ALTERNATE COLOR GEM POUCHES
     echo *** THAT DON'T MATCH OUR GEM POUCH COLOR
     echo ==========================
     echo
     pause 0.2
     math AltPouches subtract 1
     gosub GET my %AltPouchColor pouch
     pause 0.1
     if !matchre("$righthand $lefthand", "gem pouch")) then gosub GET my gem pouch
     pause 0.1
     pause 0.3
     if !matchre("$righthand $lefthand", "gem pouch")) then return
     if ("%dumpster" != "NULL") then gosub PUT put my pouch in %dumpster
     pause 0.1
     pause 0.2
     if matchre("$righthand $lefthand", "gem pouch")) then put drop my pouch
     pause 0.1
     if (%AltPouches > 0) then goto DUMP_POUCH_ALT
     return
DUMP_LEAD:
     pause 0.01
     math TotalLead subtract 1
     gosub GET my lead rope
     pause 0.1
     if ("%dumpster" != "NULL") then gosub PUT put my rope in %dumpster
     pause 0.2
     if matchre("$righthand $lefthand", "rope") then put drop my rope
     pause 0.1
     if (%TotalLead > 1) then goto DUMP_LEAD
     return
#######################################################
## TRASH DUMP
#######################################################
TRASH_CHECK:
TRASH:
     action remove lead rope
     action remove some bundling rope
     action remove a black gem pouch
     action remove %gemPouch
     eval Trash replacere("%Trash", "\|+", "|")
     eval Trash replacere("%Trash", "\|$", "")
     if ($UC_TrashDump = 0) then goto BANK_RUN
     pause 0.0001
     echo
     echo ######################
     echo ** TRASH CHECK MODULE
     echo ** CHECKING CONTAINERS FOR TRASH ITEMS TO DUMP
     echo ** TRASH ITEMS: %Trash
     echo ######################
     echo
     pause 0.8
     gosub EMPTY_PACK_CHECK $UC_Container
     pause 0.5
     gosub EMPTY_PACK_CHECK $UC_Container.Box
     pause 0.5
     gosub EMPTY_PACK_CHECK $UC_Container.Backup
     pause 0.5
     gosub EMPTY_PACK_CHECK $UC_Container.Crafting
     pause 0.5
     # gosub EMPTY_PACK_CHECK $UC_Container.Sheath
     if (%HaveSmallSack = 1) then gosub SMALL_SACK_EMPTY
     if (%HaveLargeSack = 1) then gosub SACK_EMPTY
     pause 0.2
     pause 0.1
     put out
     pause 0.5
     unvar packcount
     unvar bag
     unvar TempItem
     unvar TempItem2
     unvar Count
     unvar item
     unvar number
     goto BANK_RUN
##################################################################################################################
## BANK
BANKRUN:
BANK.RUN:
BANK_RUN:
     var CurrentCity NULL
     var NEXTSUB HERBSTOCK
     var LAST BANK_RUN
     var CURRENT Bank Run
     gosub STATUSBAR
     put #parse GOING TO TOWN!
     pause 0.0001
     action (jail) on
     put #var UC_bagsFull 0
     if ("$zoneid" = "108") then var CurrentCity MRISS
     if (($invisible = 1) && (%Necro.Known = 0)) then gosub STOP_INVIS
     # if ("$guild" = "Necromancer") then
          # {
               # if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          # }
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     if ("$zoneid" = "127") then
          {
               put .travel hib
               waitforre ^YOU ARRIVED
          }
     if ("$zoneid" = "68") then
          {
               if (matchre("$roomname", "(Blackthorn Canyon|Corik's Wall|Stormfells|Shadow's Reach|Reach Forge|Darkling Wood, Trader Outpost)") || (($roomid > 65) && ($roomid < 75))) then
                    {
                         gosub AUTOMOVE 68
                         gosub AUTOMOVE 65
                         gosub AUTOMOVE 62
                         pause 0.1
                    }
               if ($Athletics.Ranks > 250) then
                    {
                         gosub AUTOMOVE 2
                         pause 0.2
                         put climb wall
                         wait
                         pause 0.4
                         if ("$zoneid" = "67") then goto BANK_RUN_1
                    }
               if ((($UC_shardCitizen = 1) && (%Necro.Known = 0)) || (($Time.isDay = 1) && (%Necro.Known = 0))) then gosub AUTOMOVE shard
               if ((($UC_shardCitizen = 0) && ($Time.isDay = 0)) || (%Necro.Known = 1)) then gosub AUTOMOVE 15
          }
BANK_RUN_1:
     echo
     echo #########
     echo * BANK RUN
     echo #########
     echo
     if (("$game" = "DRF") && ("$zoneid" = "150") && ("$guild" != "Necromancer") && (%Teleport = 0) && ("%FANGCOVE" != "ON")) then gosub LEAVE_SEACAVE
     if (matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON") || ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then
               {
                    if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
                         {
                              if ("$zoneid" = "67") then gosub AUTOMOVE east
                              if ("$zoneid" = "42") then gosub AUTOMOVE gate
                              gosub TO_SEACAVES
                         }
               }
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (("$zoneid" = "67") && ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then gosub AUTOMOVE east
               if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
               {
                    if (matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON") || ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then
                         {
                              if ("$zoneid" = "67") then gosub AUTOMOVE east
                              if ("$zoneid" = "42") then gosub AUTOMOVE gate
                              gosub TO_SEACAVES
                         }
               }
          }
     if ("$zoneid" = "34a") then
          {
               put .travel riverhaven
               waitforre ^YOU ARRIVED
          }
     if matchre("$zoneid", "\b(34|33a|33|32|31)\b") then gosub AUTOMOVE river
     if matchre("$zoneid", "\b(34|33a|33|32|31)\b") then gosub AUTOMOVE river
     if matchre("$zoneid", "\b(34|33a|33|32|31)\b") then gosub AUTOMOVE river
     if matchre("$zoneid","\b(8|7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(8|7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(31|32|33)\b") then gosub AUTOMOVE river
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     pause 0.0001
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "69") then
          {
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then gosub AUTOMOVE shard
               if (($UC_shardCitizen = 0) && ($Time.isDay = 0)) then
                    {
                         if ("$zoneid" = "68") then gosub AUTOMOVE north
                         pause 0.1
                         if ("$zoneid" = "66") then gosub AUTOMOVE east
                    }
          }
     if ("$zoneid" = "68") then gosub AUTOMOVE 15
     pause 0.1
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     pause 0.0001
     pause 0.0001
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if !matchre("%BANKRUN", "(?i)(ON|1|YES)") then goto HERBSTOCK
BANKING:
##### SET CURRENT PROVINCE CURRENCY
     # debug 10
    if matchre("$zoneid", "\b(1|61|13|112)\b") then var MoneyType KRONARS
    if matchre("$zoneid", "\b(30|41|42|35|47|34a|90|99|107|106)\b") then var MoneyType LIRUMS
    if matchre("$zoneid", "\b(116|127|114|67|123|150|66)\b") then var MoneyType DOKORAS
##### BANK EXCHANGE
     if (matchre("$zoneid", "\b(1|90|99|107|116)\b") && ($UC_Premium = 1)) then gosub AUTOMOVE premium exchange
     else gosub AUTOMOVE exchange
     if ($invisible = 1) then gosub STOP_INVIS
BANK_EXCHANGE:
     if ($invisible = 1) then gosub STOP_INVIS
     pause 0.1
     if ($invisible = 1) then gosub STOP_INVIS
     gosub %MoneyType
     pause 0.1
     pause 0.0001
###### DEPOSIT
     gosub AUTOMOVE teller
BANK_DEPOSIT:
     gosub BANK
     # var TempProfit $UC_Profit
     # math TempProfit add %TotalProfit
     # put #var UC_Profit %TempProfit
     # put #var save
     # var TotalProfit 0
     pause 0.0001
     if matchre("%CurrentCity", "(?i)MRISS") then
          {
               put withdraw 1 silver
               pause 0.5
               gosub AUTOMOVE exchange
               gosub LIRUMS
          }
####################################################
GETHERBS:
BUYHERBS:
HERBSTOCK:
     var NEXTSUB PAY_DEBT
     var LAST HERBSTOCK
     var CURRENT Herb Restock
     gosub STATUSBAR
     if ($UC_Herbs = 0) then goto PAY_DEBT
     if (((%have_junliar = 0) && (%have_blocil = 0)) || ((%have_hulnik = 0) || (%have_eghmok = 0) || (%have_georin = 0) || (%have_ithor = 0) || (%have_jadice = 0) || (%have_yelith = 0) || (%have_muljin = 0) || (%have_nemoih = 0) || (%have_nilos = 0) || (%have_plovik = 0) || (%have_riolur = 0) || (%have_sufil = 0) || (%have_hisan = 0) || (%have_cebi = 0))) then goto HERB_RESTOCK
     goto PAY_DEBT
HERB_RESTOCK:
     gosub stowing
     echo
     echo ##############
     echo ** RESTOCKING HERBS
     echo ** HERB NEEDED/MISSING:
     if (%have_nemoih = 0) then echo * Nemoih (ext head)
     if (%have_eghmok = 0) then echo * Eghmok (int head)
     if (%have_sufil = 0) then echo * Sufil (ext eye)
     if (%have_georin = 0) then echo * Georin (ext neck)
     if (%have_riolur = 0) then echo * Riolur (int neck)
     if (%have_plovik = 0) then echo * Plovik (ext chest)
     if (%have_ithor = 0) then echo * Ithor (int chest)
     if (%have_nilos = 0) then echo * Nilos (ext abdomen)
     if (%have_muljin = 0) then echo * Muljin (int abdomen)
     if (%have_hulnik = 0) then echo * Hulnik (ext back)
     if (%have_junliar = 0) then echo * Junliar (int back)
     if (%have_blocil = 0) then echo * Blocil (int back)
     if (%have_jadice = 0) then echo * Jadice (ext limb)
     if (%have_yelith = 0) then echo * Yelith (int limb)
     if (%have_cebi = 0) then echo * Cebi (ext scar)
     if (%have_hisan = 0) then echo * Hisan (int scar)
     echo ##############
     echo
     pause 0.8
     if (("$zoneid" = "150") && ("%Teleport" = "0")) then
          {
               gosub LEAVE_SEACAVE
               if ("$zoneid" = "66") then gosub AUTOMOVE east
               pause 0.4
          }
     if ("$zoneid" = "150") then
          {
               echo ##################
               echo ** Teleported into FC!
               echo ** Skipping Herb Restock!
               echo ##################
               goto PAY_DEBT
          }
     if ("$zoneid" = "108") then
          {
               put .travel merk
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     pause 0.3
     gosub AUTOMOVE teller
     if ($invisible = 1) then gosub STOP_INVIS
     ### ADD A MATCH HERE FOR NO MONEY IN BANK
     put withdraw 12 gold
     wait
     pause 0.2
HERBSTOCKGO:
     if ("$zoneid" = "42") then gosub AUTOMOVE gate
     pause 0.5
     pause 0.1
     gosub automove herb
     pause 0.5
     gosub stowing
     if (%have_junliar = 0) then gosub BUY_HERB junliar stem
     if (%have_hulnik = 0) then gosub BUY_HERB hulnik grass
     if (%have_jadice = 0) then gosub BUY_HERB jadice flower
     if (%have_yelith = 0) then gosub BUY_HERB yelith root
     if (%have_muljin = 0) then gosub BUY_HERB muljin sap
     if (%have_nemoih = 0) then gosub BUY_HERB nemoih root
     if (%have_plovik = 0) then gosub BUY_HERB plovik leaf
     if (%have_riolur = 0) then gosub BUY_HERB riolur leaf
     if (%have_sufil = 0) then gosub BUY_HERB sufil sap
     if ("$zoneid" = "47") then gosub AUTOMOVE tobrias
     pause 0.1
     if (%have_nilos = 0) then gosub BUY_HERB nilos salve
     if (%have_ithor = 0) then gosub BUY_HERB ithor potion
     if (%have_georin = 0) then gosub BUY_HERB georin salve
     if ((%have_eghmok = 0) && ($zoneid != 1)) then gosub BUY_HERB eghmok potion
     if (($zoneid = 1) && (%have_hisan = 0) || ($zoneid = 1) && (%have_cebi = 0)) then
          {
               gosub AUTOMOVE w gate
               pause 0.3
               gosub AUTOMOVE tiger
               pause 0.5
               gosub AUTOMOVE herb
          }
     if (%have_hisan = 0) then gosub BUY_HERB hisan salve
     if (("$zoneid" = "47") && (%have_cebi = 0)) then gosub AUTOMOVE jalabas
     pause 0.1
     if (%have_cebi = 0) then gosub BUY_HERB cebi root
     if ("$zoneid" = "4a") then
          {
               gosub AUTOMOVE cross
               pause 0.3
               gosub AUTOMOVE cross
          }
     goto HERB_STOCK_DONE

BUY_HERB:
     if ($invisible = 1) then gosub STOP_INVIS
     var herb $0
     var offer 250
BUYHERB1:
     pause 0.3
     matchre BUYHERB1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre NO_STOCK ^Buy what\?
     matchre BOUGHT_HERB ^The sales clerk hands you
     matchre OFFER_HERB (\d+) (Kronars?|Lirums?|Dokoras?|kronars?|lirums?|dokoras?)
     put buy %herb
     matchwait 6
     goto OFFER_HERB_1
OFFER_HERB:
     var offer $1
     pause 0.1
OFFER_HERB_1:
     pause 0.1
     math offer subtract 1
     pause 0.1
     put offer %offer
     pause 0.2
     put offer %offer
     wait
     pause 0.5
     pause 0.3
     if !matchre("$UC_Container.Herb", "(?i)(NULL|OFF|0|^$|^%)") then
          {
               if !matchre("$righthand", "Empty") then gosub PUT put $righthandnoun in my $UC_Container.Herb
               if !matchre("$lefthand", "Empty") then gosub PUT put $lefthandnoun in my $UC_Container.Herb
          }
     pause 0.2
     gosub stowing
     return
BOUGHT_HERB:
     pause 0.1
     gosub stowing
     return
NO_STOCK:
     echo *** %herb not found
     return
HERB_STOCK_DONE:
     pause 0.1
     action (debt) on
     echo *** DONE Stocking up on Herbs!
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "4a") then gosub AUTOMOVE cross
     if ($zoneid = 4) then gosub AUTOMOVE cross
     pause 0.3
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "4a") then gosub AUTOMOVE cross
     if ($zoneid = 4) then gosub AUTOMOVE cross
     pause 0.3
     if ($invisible = 1) then gosub STOP_INVIS
     gosub AUTOMOVE teller
     pause 0.5
     put deposit all
     pause 0.6
     pause 0.3
     action (debt) off
     goto PAY_DEBT
####################################################
## PAY OFF DEBT
PAY_DEBT:
PAYDEBT:
     var NEXTSUB TIP_BOT
     var LAST PAY_DEBT
     var CURRENT Paying Debt
     gosub STATUSBAR
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (("$zoneid" = "67") && ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then gosub AUTOMOVE east
               if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
               {
                    if (matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON") || ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then
                         {
                              if ("$zoneid" = "67") then gosub AUTOMOVE east
                              if ("$zoneid" = "42") then gosub AUTOMOVE gate
                              gosub TO_SEACAVES
                         }
               }
          }
     if (("$zoneid" = "150") && (%Teleport = 0) && (%Necro.Known = 0)) then gosub LEAVE_SEACAVE
     pause 0.1
     if ("$zoneid" = "108") then
          {
               put .travel merk
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     ## CHECK FINE
     gosub FINECHECKING
     if (%fine > 0) then
          {
               var debt 1
               if ("$zoneid" != "150") then gosub DEBT
               var debt 0
          }
     if matchre("$zoneid","\b(112|123)\b") then goto TIP_BOT
     if ($UC_Premium = 1) then gosub REMOTE_DEBT
####################################################
# BANK BOT / TIPPING MODULE
BANK_BOT:
BANKBOT:
TIP_BOT:
     var NEXTSUB ARMOR_REPAIR_CHECK
     var LAST TIP_BOT
     var CURRENT Tipping Bankbot
     gosub STATUSBAR
     gosub LEAVE_BANK
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if (("$guild" = "Necromancer") && ("%FANGCOVE" = "ON")) then
          {
               if (("$zoneid" = "67") then gosub AUTOMOVE east
               if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
               {
                    if ((matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON")) || (($UC_Premium = 1) && ("%FANGCOVE" = "ON"))) then
                         {
                              if ("$zoneid" = "67") then gosub AUTOMOVE east
                              if ("$zoneid" = "42") then gosub AUTOMOVE gate
                              gosub TO_SEACAVES
                         }
               }
          }
     if ($UC_Tipping = 0) then goto ARMOR_REPAIR_CHECK
     echo
     echo ####################
     echo # ~ BANK BOT MODULE ~
     echo # ~ TIPPING BANKBOT! ~
     echo ####################
     echo
     pause 0.5
     if ($invisible = 1) then gosub STOP_INVIS
     gosub AUTOMOVE $UC_TipRoom
     pause 3
     gosub TIP $UC_BankBot
     pause
     pause
     goto ARMOR_REPAIR_CHECK
#############################################################################################
####################################################
## ARMOR REPAIR LOGIC
REPAIRCHECK:
ARMOR_REPAIR_CHECK:
ARMORREPAIRCHECK:
     var noloop 0
     var NEXTSUB REPAIR_FINISHED_2
     var LAST ARMOR_REPAIR_CHECK
     var CURRENT Reparing Armor
     gosub STATUSBAR
     put #parse GOING TO TOWN!
     pause 0.1
     echo
     echo #######################
     echo ** Checking Armor Condition
     echo ** Seeing if we need repairs
     echo #######################
     echo
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if (matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON") || ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then
               {
                    if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
                         {
                              if ("$zoneid" = "67") then gosub AUTOMOVE east
                              if ("$zoneid" = "42") then gosub AUTOMOVE gate
                              gosub TO_SEACAVES
                         }
               }
     if ($invisible = 1) then gosub STOP_INVIS
     if (%Playing = 0) then gosub PLAY
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if ($UC_Repair = 0) then goto REPAIR_FINISHED_2
     gosub stowing
     pause 0.2
ARMOR_CHECK_CHEST:
     pause 0.5
     matchre ARMOR_CHECK_CHEST ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre ARMOR_DAMAGED practically destroyed|badly damaged|heavily scratched|unsightly notches|dents and dings|scratches|scuffed
     matchre REPAIR_CHECK_2 Roundtime|pristine condition|good condition|mint condition
     matchre ARMOR_CHECK_GETCHEST ^Appraise what\?|APPRAISE HELP
     put app my %ARMOR.CHEST quick
     matchwait 10
     put #echo >$Log Crimson $datetime *** MISSING MATCH IN ARMOR_CHECK_CHEST ***
     put #log $datetime MISSING MATCH IN ARMOR_CHECK_CHEST ***
     echo *** MISSING MATCH IN ARMOR_CHECK_CHEST ***
     goto REPAIR_CHECK_2
ARMOR_CHECK_GETCHEST:
     pause 0.1
     if (%noloop = 1) then goto REPAIR_CHECK_2
     gosub GET my %ARMOR.CHEST
     pause 0.3
     if matchre("$righthand $lefthand", "orb") then put rub my orb
     else gosub PUT wear my %ARMOR.CHEST
     var noloop 1
     goto ARMOR_CHECK_CHEST
REPAIR_CHECK_2:
     if !matchre("$righthand", "Empty") then gosub PUT wear my $righthandnoun
     if !matchre("$lefthand", "Empty") then gosub PUT wear my $lefthandnoun
     pause 0.1
     gosub GET my $UC_MyShield
     pause 0.1
     matchre REPAIR_CHECK_2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre ARMOR_DAMAGED practically destroyed|badly damaged|heavily scratched|unsightly notches|dents and dings|scratches|scuffed
     matchre REPAIR_CHECK_3 Roundtime|pristine condition|good condition|mint condition
     put app my $UC_MyShield quick
     matchwait 10
     put #echo >$Log Crimson $datetime *** MISSING MATCH IN REPAIR_CHECK_2 ***
     put #log $datetime MISSING MATCH IN REPAIR_CHECK_2 ***
     echo *** MISSING MATCH IN REPAIR_CHECK_2 ***
     goto REPAIR_CHECK_3
REPAIR_CHECK_3:
     if !matchre("$righthand", "Empty") then gosub PUT wear my $righthandnoun
     if !matchre("$lefthand", "Empty") then gosub PUT wear my $lefthandnoun
     pause 0.1
     pause 0.0001
     matchre REPAIR_CHECK_2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre ARMOR_DAMAGED practically destroyed|badly damaged|heavily scratched|unsightly notches|dents and dings|scratches|scuffed
     matchre REPAIR_FINISHED_2 Roundtime|pristine condition|good condition|mint condition
     matchre REPAIR_FINISHED_2 ^Appraise what\?|APPRAISE HELP
     put app my $UC_Armor.Head quick
     matchwait 10
     put #echo >$Log Crimson $datetime *** MISSING MATCH IN REPAIR_CHECK_3 ***
     put #log $datetime MISSING MATCH IN REPAIR_CHECK_3 ***
     echo *** MISSING MATCH IN REPAIR_CHECK_3 ***
     goto REPAIR_FINISHED_2
ARMOR_DAMAGED:
     var repairloop 0
     var LAST ARMOR_DAMAGED
     pause 0.5
     gosub stowing
##########################################################################
# MAGIC REPAIR KITS
REPAIR:
REPAIR_KIT:
     gosub stowing
     if (matchre("%REPAIR.KIT", "(?i)(NULL|OFF|0|^$|^%)") && matchre("%REPAIR.KIT.WEAPON", "(?i)(NULL|OFF|0|^$|^%)") && matchre("%REPAIR.KIT.ARMOR", "(?i)(NULL|OFF|0|^$|^%)")) then goto REPAIR_NORMAL
     if matchre("%REPAIR.KIT", "(?i)(NULL|OFF|0|^$|^%)") then goto SECONDARY_REPAIR
     pause 0.2
     gosub open $UC_Container.RepairKit
     if !matchre("%REPAIR.KIT.2.CONTAINER", "(?i)(NULL|OFF|0|^$|^%)") then gosub open %REPAIR.KIT.2.CONTAINER
     if !matchre("%REPAIR.KIT.3.CONTAINER", "(?i)(NULL|OFF|0|^$|^%)") then gosub open %REPAIR.KIT.3.CONTAINER
     pause
     gosub GET my %REPAIR.KIT from my $UC_Container.RepairKit
     pause 0.5
     if !matchre("$righthand", "%REPAIR.KIT") then goto REPAIR_NORMAL
     matchre SECONDARY_REPAIR ^Though you push on|^It seems it isn't ready yet
     matchre REPAIRED_KIT fully repaired|silver and red spiral
     put push my %REPAIR.KIT
     matchwait 20
SECONDARY_REPAIR:
     if matchre("$righthand", "%REPAIR.KIT") then gosub PUT put my %REPAIR.KIT in my $UC_Container.RepairKit
     pause 0.5
     if matchre("$UC_Container.RepairKit2", "(?i)(NULL|OFF|0|^$|^%)") then goto TERTIARY_REPAIR
     pause 0.2
     gosub GET my %REPAIR.KIT.2 from my $UC_Container.RepairKit2
     pause 0.5
     if !matchre("$righthand", "%REPAIR.KIT.2") then goto TERTIARY_REPAIR
REPAIRKIT_SECOND:
     matchre TERTIARY_REPAIR ^Though you push on|It seems it isn't ready
     matchre REPAIRED_KIT fully repaired|silver and red spiral
     put push my $UC_Container.RepairKit2
     matchwait 20
TERTIARY_REPAIR:
     if matchre("$righthand", "%REPAIR.KIT.2") then gosub PUT put my %REPAIR.KIT.2 in my $UC_Container.RepairKit2
     if matchre("%REPAIR.KIT.WEAPON", "(?i)(NULL|OFF|0|^$|^%)") then goto REPAIRKIT_ARMOR
     pause 0.5
     gosub GET my %REPAIR.KIT.WEAPON from my $UC_Container.RepairKit3
     pause 0.5
     if !matchre("$righthand", "%REPAIR.KIT.WEAPON") then goto REPAIRKITS_DOWN
REPAIRKIT_WEAPON:
     matchre REPAIRKITS_DOWN ^Though you push on|It seems it isn't ready
     matchre REPAIRKIT_ARMOR fully repaired|silver and red spiral
     put push my %REPAIR.KIT.WEAPON
     matchwait 20
REPAIRKIT_ARMOR:
     if matchre("$righthand", "%REPAIR.KIT.WEAPON") then gosub PUT put my %REPAIR.KIT.WEAPON in my $UC_Container.RepairKit3
     if matchre("%REPAIR.KIT.ARMOR", "(?i)(NULL|OFF|0|^$|^%)") then goto REPAIRKITS_DOWN
     pause
     pause 0.2
     gosub GET my %REPAIR.KIT.ARMOR from my $UC_Container.RepairKit3
     pause 0.5
     if !matchre("$righthand", "%REPAIR.KIT.ARMOR") then goto REPAIRKITS_DOWN
     matchre REPAIRKITS_DOWN ^Though you push on|It seems it isn't ready yet
     matchre REPAIRED_STAT fully repaired|silver and red spiral
     put push my %REPAIR.KIT.ARMOR
     matchwait 20
REPAIRED_KIT:
     pause 0.5
     put #echo >Log #00ff78 *** REPAIRED ALL ARMOR w/ $righthand ***
     if matchre("$righthand", "%REPAIR.KIT") then gosub PUT put my %REPAIR.KIT in my $UC_Container.RepairKit
     if matchre("$righthand", "%REPAIR.KIT.2") then gosub PUT put my %REPAIR.KIT.2 in my $UC_Container.RepairKit2
     pause 0.5
     goto REPAIR_KIT_DONE
REPAIRED_STAT:
     pause 0.5
     put #echo >Log #00ff78 *** REPAIRED ALL ARMOR w/ %REPAIR.KIT.ARMOR & %REPAIR.KIT.WEAPON! ***
     if matchre("$righthand", "%REPAIR.KIT.ARMOR") then gosub PUT put my %REPAIR.KIT.ARMOR in my $UC_Container.RepairKit3
     if matchre("$righthand", "%REPAIR.KIT.WEAPON") then gosub PUT put my %REPAIR.KIT.WEAPON in my $UC_Container.RepairKit3
     pause 0.5
     goto REPAIR_KIT_DONE
REPAIR_KIT_DONE:
     var REPAIR OFF
     pause 0.2
     if matchre("$righthand", "%REPAIR.KIT") then gosub PUT put my %REPAIR.KIT in my $UC_Container.RepairKit
     if matchre("$righthand", "%REPAIR.KIT.2") then gosub PUT put my %REPAIR.KIT.2 in my $UC_Container.RepairKit2
     if matchre("$righthand", "%REPAIR.KIT.ARMOR") then gosub PUT put my %REPAIR.KIT.ARMOR in my $UC_Container.RepairKit3
     if matchre("$righthand", "%REPAIR.KIT.WEAPON") then gosub PUT put my %REPAIR.KIT.WEAPON in my $UC_Container.RepairKit3
     pause 0.3
     put close my $UC_Container.RepairKit
     pause 0.8
REPAIR_KIT_CHECK:
     matchre REPAIR_NORMAL practically destroyed|badly damaged|heavily scratched|unsightly notches|dents and dings|scratches|scuffed
     matchre REPAIR_KIT_DONE_2 Roundtime|pristine condition|good condition
     put app my $UC_Armor.Chest quick
     matchwait 20
REPAIR_KIT_DONE_2:
     echo *** REPAIRED ARMOR / WEAPONS with Repair Kits!
     goto REPAIR_FINISHED_2
REPAIRKITS_DOWN:
     if matchre("$righthand", "%REPAIR.KIT") then gosub PUT put my %REPAIR.KIT in my $UC_Container.RepairKit
     if matchre("$righthand", "%REPAIR.KIT.2") then gosub PUT put my %REPAIR.KIT.2 in my $UC_Container.RepairKit2
     if matchre("$righthand", "%REPAIR.KIT.ARMOR") then gosub PUT put my %REPAIR.KIT.ARMOR in my $UC_Container.RepairKit3
     if matchre("$righthand", "%REPAIR.KIT.WEAPON") then gosub PUT put my %REPAIR.KIT.WEAPON in my $UC_Container.RepairKit3
     pause 0.5
     put close my $UC_Container.RepairKit
     echo *** REPAIR KITS ARE DOWN FOR NOW - USING NORMAL REPAIRS
     put #echo >Log Orange *** Repair Kit(s) on cooldown. Doing normal repairs
     goto REPAIR_NORMAL
############################################################################
## NORMAL REPAIRS
EXO_SHIELD_REPAIR:
     echo ###################
     echo # REPAIRING EXO SHIELD!
     echo ###################
     action var ExoShieldType $1 when ^You shake your .+ causing it to break apart into thousands of live spiders\.\s+The swarm of arachnids scuttles quickly up your arm, nestling themselves on your person until they finally melt and coagulate into a (.*)\.$
     pause 0.5
     gosub GET %ExoShieldType
     pause 0.4
     if !matchre("$righthand $lefthand", "exoskeletal shield") then
          {
               if matchre("%ExoShieldType", "orbweaver ring") then var ExoShieldType orbweaver ring
               if matchre("%ExoShieldType", "widow ring") then var ExoShieldType widow ring
               if matchre("%ExoShieldType", "tarantula ring") then var ExoShieldType tarantula ring
          }
     pause 0.3
     if !matchre("$righthand $lefthand", "(exoskeletal shield|%ExoShieldType)") then gosub GET %ExoShieldType
     pause 0.4
     put shake my shield
     wait
     pause 0.5
     pause 0.5
     put tap my %ExoShieldType
     wait
     pause 0.5
     pause 0.5
     if contains("$righthand", "shield") then gosub SWAP
     pause 0.1
     gosub SHIELD_CHECK
     action remove ^You shake your .+ causing it to break apart into thousands of live spiders\.\s+The swarm of arachnids scuttles quickly up your arm, nestling themselves on your person until they finally melt and coagulate into a (.*)\.$
     return
############################################################################################################################
REPAIR_ARMOR:
REPAIR.NORMAL:
REPAIR_NORMAL:
     action (inventory) off
     var moneyattempt 0
     var LAST REPAIR_NORMAL
     var NEXTSUB REPAIR_NORMAL
     pause 0.1
REPAIR_NORMAL_1:
     if (%Necro.Known = 1) then
          {
               echo *** SKIPPING REPAIR! KNOWN AS A NECRO!!!
               put #echo >Log Orange ** SKIPPING REPAIR! KNOWN AS A NECRO IN CITY Zoneid: $zoneid
               goto REPAIR_FINISHED_2
          }
     if matchre("$zoneid","(112|61)") then
          {
               var hometown LETH
               put .travel cross
               waitforre ^YOU ARRIVED\!
          }
     echo
     echo *** Getting money from bank for repairs
     echo
     if matchre("$guild", "%MAGICUSER") then gosub PERCEIVE_TIMER
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     # if matchre("$zoneid","\b(90|116)\b") then
          # {
               # gosub AUTOMOVE 1teller
               # goto ARMOR_REPAIR_MONEY
          # }
     gosub AUTOMOVE teller
     if (($invisible = 1) then gosub STOP_INVIS
ARMOR_REPAIR_MONEY:
     pause 0.5
     # debug 0
     matchre ARMOR_REPAIR_MONEY_2 You don\'t have that much money|we are not lending money|you do not seem to have an account with us
     matchre REPAIR_CONTINUE ^The clerk counts out|it looks like your current balance|^You count out|Searching methodically|^You find
     put withdraw 175 gold
     matchwait 25
     put #echo >Log #ff0000 ** MISSING MATCH IN ARMOR_REPAIR_MONEY
ARMOR_REPAIR_MONEY_2:
     pause 0.2
     matchre ARMOR_REPAIR_MONEY_3 You don\'t have that much money|we are not lending money|you do not seem to have an account with us
     matchre REPAIR_CONTINUE ^The clerk counts out|it looks like your current balance|^You count out|Searching methodically|^You find
     put withdraw 100 gold
     matchwait 25
     put #echo >Log #ff0000 ** MISSING MATCH IN ARMOR_REPAIR_MONEY_2
ARMOR_REPAIR_MONEY_3:
     pause 0.2
     matchre ARMOR_REPAIR_MONEY_4 You don\'t have that much money|we are not lending money|you do not seem to have an account with us
     matchre REPAIR_CONTINUE ^The clerk counts out|it looks like your current balance|^You count out|Searching methodically|^You find
     put withdraw 800 silver
     matchwait 25
     put #echo >Log #ff0000 ** MISSING MATCH IN ARMOR_REPAIR_MONEY_3
     goto NO_MONIES
ARMOR_REPAIR_MONEY_4:
     pause 0.2
     matchre ARMOR_REPAIR_MONEY_5 You don\'t have that much money|we are not lending money|you do not seem to have an account with us
     matchre REPAIR_CONTINUE ^The clerk counts out|it looks like your current balance|^You count out|Searching methodically|^You find
     put withdraw 100 silver
     matchwait 25
     put #echo >Log #ff0000 ** MISSING MATCH IN ARMOR_REPAIR_MONEY_3
     goto NO_MONIES
ARMOR_REPAIR_MONEY_5:
     pause 0.2
     matchre NO_MONIES You don\'t have that much money|we are not lending money|you do not seem to have an account with us
     matchre REPAIR_CONTINUE ^The clerk counts out|it looks like your current balance|^You count out|Searching methodically|^You find
     put withdraw 25 silver
     matchwait 25
     put #echo >Log #ff0000 ** MISSING MATCH IN ARMOR_REPAIR_MONEY_3
     goto NO_MONIES
REPAIR_CONTINUE:
REPAIRCONT:
     # debug 5
     var LAST REPAIR_CONTINUE
     if (($invisible = 1) && (%Necro.Known = 0)) then gosub STOP_INVIS
     echo
     echo ###############
     echo * REPAIRING ARMOR
     echo ###############
     echo
     if ($SpellTimer.ShieldofLight.active = 1) then gosub RELEASE SOL
     if ((%HaveExoShield = 1) && matchre("$UC_MyShield", "(exo shield|exoskeletal shield|orbweaver ring|widow ring|tarantula ring)")) then gosub EXO_SHIELD_REPAIR
     if ("$zoneid" = "112") then
          {
               send .travel cross
               waitforre ^YOU ARRIVED
          }
     if ("$zoneid" = "108") then
          {
               put .travel merk
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "1") then goto XING_REPAIR
     if ("$zoneid" = "30") then goto HAVEN_REPAIR
     if ("$zoneid" = "42") then goto THEREN_REPAIR
     if ("$zoneid" = "47") then goto MUSPARI_REPAIR
     if ("$zoneid" = "61") then goto LETH_REPAIR
     if ("$zoneid" = "66") then goto SHARD_REPAIR
     if ("$zoneid" = "67") then goto SHARD_REPAIR
     if ("$zoneid" = "90") then goto RATHA_REPAIR
     if ("$zoneid" = "99") then goto AESRY_REPAIR
     if ("$zoneid" = "107") then goto MERK_REPAIR
     if ("$zoneid" = "116") then goto HIB_REPAIR
     if ("$zoneid" = "150") then goto FANG_REPAIR
     echo
     echo *** UNRECOGNIZED / UNIMPLEMENTED ARMOR REPAIR AREA
     echo *** SKIPPING REPAIR
     echo
     echo
     put #echo >Log Orange ** Unrecognized armor area - Skipping Repair
     pause 2
     goto REPAIR_FINISHED_2
#####################
XING_REPAIR:
     var LAST XING_REPAIR
     var NEXTSUB DONE_REPAIR_XING
     gosub AUTOMOVE catrox
     pause 0.5
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS
     pause 0.5
     echo *** Moving to Repair Leather
     if ("$zoneid" = "1") then gosub AUTOMOVE west
     pause 0.2
     if ("$zoneid" = "1") then gosub AUTOMOVE west
     pause 0.2
     if ("$zoneid" = "1") then gosub AUTOMOVE west
     pause 0.2
     if ("$zoneid" = "4") then gosub AUTOMOVE repair
     pause 0.2
XING_REP:
     var LAST XING_REP
     var NEXTSUB DONE_REPAIR_XING
     if (("$zoneid" = "4") && ("$roomid" != "135")) then gosub AUTOMOVE 135
     pause 0.2
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS_2
     gosub REPAIR_WAIT
DONE_REPAIR_XING:
DONEREPAIRXING:
     gosub stowing
     if ("$zoneid" = "1") then gosub AUTOMOVE west
     if ("$zoneid" = "1") then gosub AUTOMOVE west
     pause 0.4
     if ("$zoneid" = "4") then gosub AUTOMOVE repair
     pause 0.5
     if (("$zoneid" = "4") && ("$roomid" != "135")) then gosub AUTOMOVE 135
     gosub REPAIR_DONE
     pause 0.5
     gosub AUTOMOVE cross
     pause 0.5
     if ("$zoneid" != "1") then gosub AUTOMOVE cross
DONEREPAIRXING2:
     pause 0.2
     if ("$zoneid" != "1") then gosub AUTOMOVE cross
     gosub AUTOMOVE catrox
     gosub REPAIR_DONE
     goto REPAIR_FINISHED
LETH_REPAIR:
     var LAST LETH_REPAIR
     var NEXTSUB DONE_REPAIR_XING
     var hometown LETH
     put .travel cross
     waitforre ^YOU ARRIVED
     pause 0.5
     goto XING_REPAIR
SHARD_REPAIR:
     var LAST SHARD_REPAIR
     var NEXTSUB DONE_REPAIR_SHARD
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     pause
     pause 0.5
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     pause 0.1
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     gosub AUTOMOVE ylono
     if ("$roomid" != "495") then gosub AUTOMOVE 495
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS
     gosub REPAIR_WEAPONS_2
     send out
     pause 0.5
     pause 0.4
     gosub REPAIR_WAIT
DONE_REPAIR_SHARD:
DONEREPAIRSHARD:
     gosub stowing
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     pause
     pause 0.5
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     pause 0.1
     gosub AUTOMOVE ylono
     if ("$roomid" != "495") then gosub AUTOMOVE 495
     gosub REPAIR_DONE
     send out
     pause 0.5
     send sw
     pause 0.5
     gosub AUTOMOVE east
     goto REPAIR_FINISHED
HAVEN_REPAIR:
     var LAST HAVEN_REPAIR
     var NEXTSUB DONE_REPAIR_HAVEN
     gosub AUTOMOVE unspiek
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS
     echo *** Moving to Repair Leather
     gosub AUTOMOVE repair leather
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS_2
     gosub REPAIR_WAIT
DONE_REPAIR_HAVEN:
     gosub stowing
     gosub AUTOMOVE repair leather
     if ("$roomid" != "370") then gosub AUTOMOVE 370
     gosub REPAIR_DONE
     gosub AUTOMOVE unspiek
     if ("$roomid" != "208") then gosub AUTOMOVE 208
     gosub REPAIR_DONE
     goto REPAIR_FINISHED
THEREN_REPAIR:
     var LAST THEREN_REPAIR
     var NEXTSUB DONE_REPAIR_THEREN
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     gosub AUTOMOVE dagul
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS
     echo *** Moving to Repair Leather
     gosub AUTOMOVE gate
     pause 0.5
     if ("$zoneid" = "42") then gosub AUTOMOVE gate
     gosub AUTOMOVE repair
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS_2
     gosub REPAIR_WAIT
DONE_REPAIR_THEREN:
     gosub stowing
     if ("$zoneid" = "42") then gosub AUTOMOVE gate
     gosub AUTOMOVE repair
     gosub REPAIR_DONE
     gosub AUTOMOVE theren
     pause 0.5
     pause 0.5
     if ("$zoneid" = "40") then gosub AUTOMOVE gate
     pause 0.2
     gosub AUTOMOVE dagul
     if ("$roomid" != "221") then gosub AUTOMOVE 221
     gosub REPAIR_DONE
     goto REPAIR_FINISHED
HIB_REPAIR:
     var LAST HIB_REPAIR
     var NEXTSUB DONE_REPAIR_HIB
     gosub AUTOMOVE ladar
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS
     gosub REPAIR_WEAPONS_2
     gosub REPAIR_WAIT
DONE_REPAIR_HIB:
     gosub stowing
     gosub AUTOMOVE ladar
     gosub REPAIR_DONE
     goto REPAIR_FINISHED
MUSPARI_REPAIR:
     var LAST MUSPARI_REPAIR
     var NEXTSUB DONE_REPAIR_MUSPARI
     gosub TIME_CHECK
     if (("%TIME" = "NIGHT") || (%Skip.Repair = 1)) then
          {
               put #echo >Log White ** Skipping Repair! Night time
               goto REPAIR_FINISHED_2
          }
     gosub AUTOMOVE repair metal
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS
     gosub REPAIR_WEAPONS_2
     gosub REPAIR_WAIT
DONE_REPAIR_MUSPARI:
     gosub stowing
     gosub AUTOMOVE repair metal
     gosub REPAIR_DONE
     goto REPAIR_FINISHED
MERK_REPAIR:
     var LAST MERK_REPAIR
     var NEXTSUB DONE_REPAIR_MERK
     if ("$roomid" != "204") then gosub AUTOMOVE repair
     if ("$roomid" != "204") then gosub AUTOMOVE repair
     pause 0.2
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS
     gosub REPAIR_WEAPONS_2
     pause 0.2
     gosub REPAIR_WAIT
DONE_REPAIR_MERK:
     gosub stowing
     gosub AUTOMOVE repair
     if ("$roomid" != "204") then gosub AUTOMOVE repair
     gosub REPAIR_DONE
     goto REPAIR_FINISHED
AESRY_REPAIR:
     var LAST RATHA_REPAIR
     var NEXTSUB DONE_REPAIR_AESRY
     gosub AUTOMOVE repair leather
     pause 0.2
     gosub AUTO_REPAIR
     pause 0.5
     gosub AUTOMOVE repair metal
     pause 0.2
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS
     gosub REPAIR_WEAPONS_2
     pause 0.2
     gosub REPAIR_WAIT
RATHA_REPAIR:
     var LAST RATHA_REPAIR
     var NEXTSUB DONE_REPAIR_RATHA
     gosub AUTOMOVE repair leather
     pause 0.2
     if ("$roomid" != "20") then gosub AUTOMOVE 20
     gosub AUTO_REPAIR
     pause 0.2
     gosub AUTOMOVE repair metal
     if ("$roomid" != "126") then gosub AUTOMOVE 126
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS
     gosub REPAIR_WEAPONS_2
     pause 0.2
     gosub REPAIR_WAIT
DONE_REPAIR_RATHA:
     gosub stowing
     gosub AUTOMOVE repair leather
     if ("$roomid" != "318") then gosub AUTOMOVE 318
     gosub REPAIR_DONE
     gosub AUTOMOVE repair metal
     if ("$roomid" != "319") then gosub AUTOMOVE 319
     gosub REPAIR_DONE
     goto REPAIR_FINISHED
FANG_REPAIR:
     var LAST FANG_REPAIR
     var NEXTSUB DONE_REPAIR_FANG
     gosub TIME_CHECK
     if ("%TIME" = "DAY") then goto FANG_DAY
     gosub AUTOMOVE lakyan
     if ("$roomid" != "55") then gosub AUTOMOVE 55
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS
     gosub REPAIR_WEAPONS_2
     pause 0.5
     gosub REPAIR_WAIT
     goto DONE_REPAIR_FANG
FANG_DAY:
     gosub AUTOMOVE lakyan
     if ("$roomid" != "55") then gosub AUTOMOVE 55
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS
     gosub REPAIR_WEAPONS_2
     pause 0.5
     gosub AUTOMOVE repair metal
     if ("$roomid" != "54") then gosub AUTOMOVE 54
     gosub AUTO_REPAIR
     gosub REPAIR_WEAPONS
     gosub REPAIR_WEAPONS_2
     pause 0.5
     gosub REPAIR_WAIT
DONE_REPAIR_FANG:
DONE.REPAIR.FANG:
     gosub stowing
     gosub AUTOMOVE lakyan
     if ("$roomid" != "55") then gosub AUTOMOVE 55
     gosub REPAIR_DONE
     gosub TIME_CHECK
     if ("%TIME" = "DAY") then
          {
               gosub AUTOMOVE repair metal
               if ("$roomid" != "54") then gosub AUTOMOVE 54
               gosub REPAIR_DONE
          }
     gosub AUTOMOVE lakyan
     gosub REPAIR_DONE
     goto REPAIR_FINISHED
#### WAITING FOR REPAIR COLLECTION LOOP
REPAIR_WAIT:
REPAIR_DEPOSIT:
REPAIRWAIT:
     action (debt) on
     echo
     echo #####################
     echo * DEPOSITING EXCESS REPAIR MONEY
     echo * WAITING FOR REPAIRS TO FINISH
     echo #####################
     echo
     pause 0.5
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     pause 0.001
     if ($invisible = 1) then gosub STOP_INVIS
     pause 0.2
     pause 0.1
     gosub AUTOMOVE teller
     pause 0.2
     put deposit all
     pause 0.8
     pause 0.1
     action (debt) off
     gosub LEAVE_BANK
REPAIR_WAIT_2:
     if (("$zoneid" = "1") && ("$guild" = "Ranger")) then gosub AUTOMOVE 587
     if (("$zoneid" = "1") && ("$guild" != "Ranger")) then gosub AUTOMOVE w gate
     if (("$zoneid" = "30") && ("$guild" = "Ranger")) then
          {
               gosub AUTOMOVE e gate
               gosub AUTOMOVE 78
          }
     if (("$zoneid" = "30") && ("$guild" != "Ranger")) then gosub AUTOMOVE 49
     if (("$zoneid" = "42") && ("$guild" = "Ranger")) then
          {
               gosub AUTOMOVE gate
               gosub AUTOMOVE 222
          }
     if (("$zoneid" = "42") && ("$guild" != "Ranger")) then gosub AUTOMOVE gate
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if ("$zoneid" = "61") then gosub AUTOMOVE gym
     if (("$zoneid" = "66") && ("$guild" = "Ranger")) then gosub AUTOMOVE 640
     if (("$zoneid" = "66") && ("$guild" != "Ranger")) then gosub AUTOMOVE 639
     if (("$zoneid" = "67") && ("$guild" = "Ranger")) then
          {
               gosub AUTOMOVE east
               gosub AUTOMOVE 640
          }
     if (("$zoneid" = "67") && ("$guild" != "Ranger")) then gosub AUTOMOVE 154
     if ("$zoneid" = "90") then gosub AUTOMOVE 42
     if (("$zoneid" = "99") && ("$guild" = "Ranger")) then
          {
               gosub AUTOMOVE west
               gosub AUTOMOVE 53
          }
     if (("$zoneid" = "99") && ("$guild" != "Ranger")) then gosub AUTOMOVE 91
     if ("$zoneid" = "107") then gosub AUTOMOVE 58
     if ("$zoneid" = "116") then gosub AUTOMOVE 96
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     if ("$zoneid" = "116") then gosub AUTOMOVE 114
     if ("$zoneid" = "107") then gosub AUTOMOVE 61
     if ("$zoneid" = "90") then gosub AUTOMOVE green
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE 639
     if ("$zoneid" = "40") then gosub AUTOMOVE 11
     if ("$zoneid" = "4") then gosub AUTOMOVE 119
REPAIRWAIT.3:
     var repairloop 0
     put #echo >Log #a3a3c2 *** Waiting for armor to be repaired
REPAIR_WAIT_3:
     action math repairloop add 1 when ^WTF\!
     pause 0.4
     if (%Playing = 1) then gosub STOP_PLAY
     # if (%Playing = 0) then gosub PLAY
     pause 0.4
     ####
     gosub TOWNRUN_TIMERS
     if ($SpellTimer.ShieldofLight.active = 1) then gosub RELEASE SOL
     ####
     if ($invisible = 1) then gosub STOP_INVIS
     echo
     echo #########################
     echo * WAITING FOR ARMOR TO BE REPAIRED
     echo * COLLECT LOOP: %repairloop / 4
     echo ##########################
     echo
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     if matchre("$guild", "%MAGICUSER") then gosub PERCEIVE_TIMER
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     gosub COLLECT %Collect
     gosub COLLECT %Collect
     gosub KICKEM
     if ($invisible = 1) then gosub STOP_INVIS
     echo
     echo ##########################
     echo * WAITING FOR ARMOR TO BE REPAIRED
     echo * COLLECT LOOP: %repairloop / 4
     echo ###########################
     echo
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     # if (%Playing = 0) then gosub PLAY
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     gosub COLLECT %Collect
     gosub COLLECT %Collect
     gosub KICKEM
     math repairloop add 1
     if (%repairloop > 3) then goto RETURN_REPAIR_WAIT
     goto REPAIR_WAIT_3
RETURN_REPAIR_WAIT:
     action remove ^WTF\!
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "107") then gosub AUTOMOVE repair
     return
NO_MONIES:
     if ((matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON")) || (($UC_Premium = 1) && ("%FANGCOVE" = "ON"))) then
     {
          if matchre("$zoneid", "(1|30|40|42|47|61|66|67|90|99|107|108|114|116)") then
               {
                    if (%moneyattempt = 1) then goto MONEY_ERROR
                    action (debt) on
                    var moneyattempt 1
                    echo
                    echo ########################
                    echo *** NO MONEY IN BANK!!
                    echo *** GOING TO FC TO ATTEMPT TO GET MONEY
                    echo ########################
                    echo
                    gosub TO_SEACAVES
                    pause 0.2
                    gosub AUTOMOVE teller
                    pause 0.1
                    put withdraw 5 plat
                    pause 0.5
                    pause 0.3
                    gosub LEAVE_SEACAVES
                    if ("$zoneid" = "66") then gosub AUTOMOVE east
                    if ("$zoneid" = "40") then gosub AUTOMOVE theren
                    pause 0.1
                    gosub AUTOMOVE exchange
                    if matchre("$zoneid","\b(1|13|61|112)\b") then gosub KRONARS
                    if matchre("$zoneid","\b(30|35|42|47|90|99|107|109)\b") then gosub LIRUMS
                    if matchre("$zoneid","\b(67|114|116|150)\b") then gosub DOKORAS
                    pause 0.3
                    gosub AUTOMOVE teller
                    pause 0.2
                    put deposit all
                    pause
                    pause 0.3
                    action (debt) off
                    goto REPAIR_NORMAL_1
               }
     }
     echo
     echo ##############################
     echo *** BANK ERROR!!
     echo *** NO MONEY IN THE BANK TO REPAIR ARMOR!!!
     echo *** PUT SOME MONEY IN $zonename BANK
     echo ##############################
     echo
     put #echo >Log #ff0000 *** ERROR! NO MONEY IN BANK FOR REPAIRS!! PUT SOME MONEY IN BANK!
     put #echo >Log #ff0000 *** Zone: $zonename / Zoneid: $zoneid
     pause 4
     goto REPAIR_FINISHED_2
MONEY_ERROR:
     echo ##############################
     echo *** BANK ERROR!!
     echo *** NO MONEY IN THE BANK TO REPAIR ARMOR!!!
     echo *** PUT SOME MONEY IN FC BANK AND $zonename BANK
     echo ##############################
     put #echo >Log #ff0000 *** ERROR! NO MONEY FOR REPAIRS IN ZONE $zoneid BANK OR FC BANK!!!!!
     put #echo >Log #ff0000 *** PUT SOME DAMN MONEY IN THE BANK - Zone: $zonename / Zoneid: $zoneid
     pause 4
     goto REPAIR_FINISHED_2
REPAIR_FINISHED:
     echo
     echo ##################
     echo * REPAIRED ALL ARMOR/WEAPONS!
     echo * Cost: $UC_repairCost $UC_repairCurrency
     echo ##################
     echo
     put #echo >Log #99ffc9 *** Repaired all Armor/Weapons! Cost - $UC_repairCost $UC_repairCurrency
     pause 0.5
REPAIR_FINISHED_2:
REPAIRDONE2:
     # debug 5
     pause 0.2
     action (debt) on
     gosub SHIELD_CHECK
     # if matchre("$zoneid","(90|116)") then gosub AUTOMOVE 1teller
     # if !matchre("$zoneid","(90|116)") then gosub AUTOMOVE teller
     if ("$zoneid" = "40a") then
          {
               put .travel haven
               waitforre ^YOU ARRIVED
          }
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     gosub AUTOMOVE teller
     pause 0.5
     send deposit all
     wait
     pause 0.5
     pause 0.2
     action (debt) off
     if (($UC_Zills = 1) && (%HaveCloth = 0)) then
          {
               if !matchre("%Zill.Name", "(?i)jug") then gosub RESTOCK_CLOTH
          }
     if ((%AmmoRestock = 1) && ($UC_RestockAmmo = 1)) then goto RESTOCKING_AMMO
     ### LEAVING BANK / EXIT BANK / LEAVE BANK
     if ("$zoneid" = "1") then gosub AUTOMOVE 38
     if ("$zoneid" = "30") then gosub AUTOMOVE 63
     if ("$zoneid" = "35") then gosub AUTOMOVE 60
     if ("$zoneid" = "42") then gosub AUTOMOVE 40
     if ("$zoneid" = "47") then gosub AUTOMOVE 38
     if ("$zoneid" = "61") then gosub AUTOMOVE 19
     if ("$zoneid" = "62") then gosub AUTOMOVE leth
     if ("$zoneid" = "67") then gosub AUTOMOVE 81
     if ("$zoneid" = "90") then gosub AUTOMOVE 48
     if ("$zoneid" = "99") then gosub AUTOMOVE 92
     if ("$zoneid" = "106") then gosub AUTOMOVE 88
     if ("$zoneid" = "107") then gosub AUTOMOVE 58
     if ("$zoneid" = "108") then gosub AUTOMOVE well
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "124") then gosub AUTOMOVE hib
     if ("$zoneid" = "112") then gosub AUTOMOVE 27
     if ("$zoneid" = "116") then gosub AUTOMOVE 14
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     gosub clear
     goto EMPATHHEALTHWALK
############################################################################################
## EMPATH PERCEIVE HEALTH WALKING
##################################
EMPATHWALKCHECK:
EMPATHHEALTHWALK:
     var LAST EMPATHWALKCHECK
     var NEXTSUB RETURN_FROM_RESTOCK
     var CURRENT Empath Health Walk
     gosub STATUSBAR
     if (matchre("$guild", "Empath") && matchre("%Empath.Walk", "(?i)(ON|1|YES)")) then gosub HEALTH_WALK
     if (matchre("$guild", "%MAGICUSER") && ($UC_PowerWalk = 1)) then gosub HEALTH_WALK
EMPATH_WALK_DONE:
##################################################################################
RETURN_FROM_RESTOCK:
     ## GO BACK TO TOWN
     ## INIIAL TOWN RUN COMPLETE
     ####
     var command NULL
     gosub clear
     gosub TOWNRUN_TIMERS
     ####
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     pause 0.1
     if (%TicketCheck = 1) then
          {
               put #var UC_Combat.Last 0
               var TicketCheck 0
               goto INIT_PREP
          }
     if (%Necro.Known = 1) then
          {
               if ("$zoneid" = "1") then gosub AUTOMOVE 170
               if ("$zoneid" = "30") then gosub AUTOMOVE 203
               if ("$zoneid" = "31") then gosub AUTOMOVE 101
               if ("$zoneid" = "42") then gosub AUTOMOVE gate
               if ("$zoneid" = "47") then gosub AUTOMOVE 98
               if ("$zoneid" = "61") then gosub AUTOMOVE cross
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "116") then gosub AUTOMOVE boar
               if ("$zoneid" = "90") then gosub AUTOMOVE 662
               if ("$zoneid" = "99") then gosub AUTOMOVE 390
               if (%Backtraining = 1) then
                    {
                         echo
                         echo ####################
                         echo *** BACKTRAIN LOOP OVER
                         echo *** MINI-TOWN RUN COMPLETE
                         echo *** GOING TO MAIN COMBAT!
                         echo ####################
                         echo
                         var Backtrained 1
                         var Backtraining 0
                         var command NULL
                         put #var UC_Combat.Last 0
                         goto INIT_PREP
                    }
               goto RETURN_MAIN_CHECK
          }
     if matchre("$zoneid","\b(7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(31|32|33)\b") then gosub AUTOMOVE river
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "66") then gosub AUTOMOVE east
RETURN_BACKTRAIN_CHECK:
     if ($UC_NoCombat = 1) then goto CLIMBING
     if ((%Backtraining = 1) || matchre("%command", "(?i)heal")) then
          {
               echo
               echo ####################
               echo *** BACKTRAIN LOOP OVER
               echo *** MINI-TOWN RUN COMPLETE
               echo *** GOING TO MAIN COMBAT!
               echo ####################
               echo
               if ("$guild" = "Thief") then
                    {
                         if ($concentration < 75) then send khri stop
                    }
               if ("$zoneid" = "1") then gosub AUTOMOVE 156
               if ("$zoneid" = "31") then gosub AUTOMOVE river
               if ("$zoneid" = "62") then gosub AUTOMOVE leth
               if ("$zoneid" = "66") then gosub AUTOMOVE east
               if ("$zoneid" = "150") then gosub AUTOMOVE 85
               if ("$zoneid" = "116") then gosub AUTOMOVE 14
               if ("$zoneid" = "67") then gosub AUTOMOVE 81
               if ("$zoneid" = "61") then gosub AUTOMOVE 19
               if ("$zoneid" = "30") then gosub AUTOMOVE 51
               if ("$zoneid" = "47") then gosub AUTOMOVE 38
               if ("$zoneid" = "40") then gosub AUTOMOVE theren
               if ("$zoneid" = "42") then gosub AUTOMOVE 41
               if ("$zoneid" = "90") then gosub AUTOMOVE 48
               if ("$zoneid" = "99") then gosub AUTOMOVE aesry
               if ("$zoneid" = "99") then gosub AUTOMOVE 74
               if ("$zoneid" = "107") then gosub AUTOMOVE 58
               var Backtrained 1
               var Backtraining 0
               var command NULL
               put #var UC_Combat.Last 0
               goto INIT_PREP
          }
RETURN_MAIN_CHECK:
     if !def(UC_Combat.Last) then put #tvar UC_Combat.Last 600
     if (($UC_Combat.Last < 400) && !matchre("%command", "(?i)(JUMP|SKIP)")) then
          {
               if ("$guild" = "Thief") then
                    {
                         if ($concentration < 75) then send khri stop
                    }
               put #echo >Log #00FF00 *** Last Run too Short - Returning to Combat!
               if (%Necro.Known = 0) then
                    {
                         if ("$zoneid" = "1") then gosub AUTOMOVE 156
                         if ("$zoneid" = "62") then gosub AUTOMOVE leth
                         if ("$zoneid" = "66") then gosub AUTOMOVE east
                         if ("$zoneid" = "150") then gosub AUTOMOVE 85
                         if ("$zoneid" = "116") then gosub AUTOMOVE 14
                         if ("$zoneid" = "67") then gosub AUTOMOVE 81
                         if ("$zoneid" = "61") then gosub AUTOMOVE 19
                         if ("$zoneid" = "30") then gosub AUTOMOVE 51
                         if ("$zoneid" = "47") then gosub AUTOMOVE 38
                         if ("$zoneid" = "42") then gosub AUTOMOVE 41
                         if ("$zoneid" = "90") then gosub AUTOMOVE 48
                         if ("$zoneid" = "99") then gosub AUTOMOVE 74
                         if ("$zoneid" = "107") then gosub AUTOMOVE 58
                    }
               var command NULL
               put #var UC_Combat.Last 0
               goto ONLINE_CHECK
          }
     goto CLIMB_RUN
###########################################################################################################
# CLIMBING RUN
###########################################################################################################
CLIMB_RUN:
CLIMBING:
     # debug 0
     var NEXTSUB MAGIC_ROPE
     var LAST CLIMB_RUN
     var CURRENT Athletics
     gosub STATUSBAR
     if ($UC_Climbing = 0) then goto CLIMBING_CHECK
     if (($invisible = 1) && (%Necro.Known = 0)) then gosub STOP_INVIS
     ####
     gosub TOWNRUN_TIMERS
     ####
     if ("$zoneid" = "108") then
          {
               put .travel merk
               waitforre ^YOU ARRIVED\!
          }
     if (%Playing = 0) then gosub PLAY
     if ("$guild" = "Thief") then gosub KHRI
     if (("$guild" = "Thief") && ($circle > 100)) then gosub KHRI_START serenity sight sensing
     if (("$guild" = "Thief") && ($circle > 150) && ($concentration > 80)) then gosub KHRI_START steady avoidance flight elusion focus
     if ("$guild" = "Necromancer") then
          {
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE 610
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     if ("$zoneid" = "116") then gosub AUTOMOVE 44
     if ("$zoneid" = "67") then gosub AUTOMOVE 154
     if ("$zoneid" = "61") then gosub AUTOMOVE pool
     if ("$zoneid" = "31") then gosub AUTOMOVE 1
     if ("$zoneid" = "33") then gosub AUTOMOVE 1
     if ("$zoneid" = "30") then gosub AUTOMOVE 8
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if ("$zoneid" = "42") then gosub AUTOMOVE 3
     if ("$zoneid" = "90") then gosub AUTOMOVE 42
     if ("$zoneid" = "99") then gosub AUTOMOVE 91
     if ("$zoneid" = "107") then gosub AUTOMOVE 58
##########
CLIMBING_CHECK:
     if ($UC_WindBoard = 1) then goto WINDBOARD_TRAIN
     if ($UC_MagicRope = 1) then goto MAGIC_ROPE
CLIMBING_NEXT:
     if ($Athletics.Ranks > 1749) then goto SKINNING_TRAINER
     if ($UC_Climbing = 0) then goto SKINNING_TRAINER
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if (("$zoneid" = "30") && ($Athletics.Ranks > 250)) then
          {
               echo ##############################
               echo *** GOING TO CROSSINGS TO TRAIN CLIMBING!
               echo ##############################
               put .travel cross
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "30") then goto HAVEN_CLIMB
     if ("$zoneid" = "67") then goto SHARD_CLIMBRUN
     goto CROSS_CLIMBRUN
#########
HAVEN_CLIMB:
     var havenloop 0
## Salt Yard / East Gate
HAVEN_CLIMB_1:
     if ($Athletics.Ranks > 50) then goto HAVEN_CLIMB_2
     math havenloop add 1
     if (%havenloop > 20) then goto HAVEN_CLIMB_DONE
     if ($Athletics.LearningRate > 30) then goto HAVEN_CLIMB_DONE
     echo
     echo ##########################
     echo *** Riverhaven Athletics Training
     echo *** ~ SALT YARD ~ ( $Athletics.Ranks Athletics Ranks )
     echo ##########################
     echo
     gosub TOWNRUN_TIMERS
     if ("$zoneid" = "31") then gosub AUTOMOVE 1
     if ("$zoneid" = "33") then gosub AUTOMOVE 1
     gosub AUTOMOVE 339
     pause 0.2
     gosub AUTOMOVE 81
     pause 0.2
     gosub AUTOMOVE 83
     pause 0.2
     gosub AUTOMOVE 266
     pause 0.2
     gosub AUTOMOVE 269
     pause 0.2
     gosub AUTOMOVE 1
     pause 0.2
     put collect rock
     pause 4
     pause
     gosub KICKEM
     goto HAVEN_CLIMB_1
## Underwharf Training
HAVEN_CLIMB_2:
     if ($Athletics.Ranks > 100) then goto HAVEN_CLIMB_3
     math havenloop add 1
     if (%havenloop > 20) then goto HAVEN_CLIMB_DONE
     if ($Athletics.LearningRate > 30) then goto HAVEN_CLIMB_DONE
HAVEN_UNDERWHARF:
     echo
     echo ###########################
     echo *** Riverhaven Athletics Training
     echo *** ~ UNDERWHARF ~ ( $Athletics.Ranks Athletics Ranks )
     echo ###########################
     echo
     gosub TOWNRUN_TIMERS
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if ("$zoneid" = "31") then gosub AUTOMOVE 1
     if ("$zoneid" = "33") then gosub AUTOMOVE 1
     gosub AUTOMOVE 184
     pause 0.2
     gosub AUTOMOVE 186
     pause 0.2
     gosub AUTOMOVE 175
     pause 0.2
     put collect rock
     pause 4
     pause
     gosub KICKEM
     pause 0.1
     goto HAVEN_CLIMB_2
## West Gate Boulder
HAVEN_CLIMB_3:
     if ($Athletics.Ranks > 140) then goto HAVEN_CLIMB_4
     math havenloop add 1
     if (%havenloop > 15) then goto HAVEN_CLIMB_DONE
     if ($Athletics.LearningRate > 30) then goto HAVEN_CLIMB_DONE
     echo
     echo ##############################
     echo *** Riverhaven Athletics Training
     echo *** ~ WEST GATE - BOULDERS ~ ( $Athletics.Ranks Athletics Ranks )
     echo ##############################
     echo
     gosub TOWNRUN_TIMERS
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if ($zoneid = 31) then gosub AUTOMOVE 1
     if ($zoneid = 30) then gosub AUTOMOVE 174
     pause 0.1
     if ($zoneid = 30) then gosub AUTOMOVE 174
     pause 0.1
     gosub AUTOMOVE 36
     pause 0.3
     if ($roomid != 36) then gosub AUTOMOVE 36
     matchre HAVEN_CLIMB_31 ^(The|This) climb is too difficult|^(The|This) climb is no challenge|^You stop|^You are engaged|^(The|This) climb is too easy
     put climb practice boulder
     matchwait 100
HAVEN_CLIMB_31:
     pause 0.1
     send stop climb
     pause 0.5
     pause 0.3
     gosub AUTOMOVE 42
     pause 0.3
     if ($roomid != 42) then gosub AUTOMOVE 42
     matchre HAVEN_CLIMB_32 ^(The|This) climb is too difficult|^(The|This) climb is no challenge|^You stop|^You are engaged|^(The|This) climb is too easy
     put climb practice boulder
     matchwait 120
HAVEN_CLIMB_32:
     pause 0.1
     send stop climb
     pause 0.5
     pause 0.2
     gosub AUTOMOVE 43
     pause 0.2
     if ($roomid != 43) then gosub AUTOMOVE 43
     matchre HAVEN_CLIMB_33 ^(The|This) climb is too difficult|^(The|This) climb is no challenge|^You stop|^You are engaged|^(The|This) climb is too easy
     put climb practice boulder
     matchwait 120
HAVEN_CLIMB_33:
     pause 0.3
     send stop climb
     pause 0.5
     gosub AUTOMOVE 133
     pause 0.2
     put collect rock
     pause 5
     pause
     gosub KICKEM
     put collect rock
     pause 5
     pause
     gosub KICKEM
     goto HAVEN_CLIMB_3
#### FALDESU TRAINING
HAVEN_CLIMB_4:
     if ($zoneid = 33) then gosub AUTOMOVE river
     gosub AUTOMOVE 203
     if ($zoneid = 30) then gosub AUTOMOVE 203
     gosub AUTOMOVE 79
HAVEN_FALDESU:
     if ($Athletics.Ranks > 260) then goto HAVEN_CLIMB_DONE
     math havenloop add 1
     if (%havenloop > 20) then goto HAVEN_CLIMB_DONE
     if ($Athletics.LearningRate > 30) then goto HAVEN_CLIMB_DONE
     gosub TOWNRUN_TIMERS
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     echo
     echo ###########################
     echo *** Riverhaven Athletics Training
     echo *** ~ FALDESU RIVER ~ ( $Athletics.Ranks Athletics Ranks )
     echo ###########################
     echo
     pause 0.5
     if ("$zoneid" = "33") then gosub AUTOMOVE 1
     pause 0.01
     if ("$zoneid" = "30") then gosub AUTOMOVE 203
     pause 0.01
     if ("$zoneid" = "33") then gosub AUTOMOVE 1
     pause 0.01
     if ("$zoneid" = "30") then gosub AUTOMOVE 203
     pause 0.01
     if ("$zoneid" = "31") then gosub AUTOMOVE 79
     pause 0.01
     gosub move south
     gosub move south
     gosub move south
     if ($Athletics.Ranks > 230) then
          {
               put west
               pause 2
               put west
               pause 2
               put northeast
               pause 2
               gosub move northeast
          }
     if ("$roomid" != "20") then gosub move north
     if ("$roomid" != "20") then gosub move north
     if ("$roomid" != "20") then gosub move north
     if ("$stamina" < "50") then
          {
               put climb bridge
               pause
               put collect rock
               pause 5
               pause
               gosub KICKEM
               gosub AUTOMOVE 79
          }
     goto HAVEN_FALDESU
HAVEN_CLIMB_DONE:
     if ("$zoneid" = "14c") then gosub AUTOMOVE river
     if ("$zoneid" = "14c") then gosub AUTOMOVE river
     if ("$zoneid" = "31") then gosub AUTOMOVE 1
     if ("$zoneid" = "32") then gosub AUTOMOVE 1
     if ("$zoneid" = "33") then gosub AUTOMOVE 1
     pause 0.4
     if ("$zoneid" = "14c") then gosub AUTOMOVE river
     if ("$zoneid" = "14c") then gosub AUTOMOVE river
     if ("$zoneid" = "31") then gosub AUTOMOVE 1
     if ("$zoneid" = "32") then gosub AUTOMOVE 1
     if ("$zoneid" = "33") then gosub AUTOMOVE 1
     pause 0.4
     if ("$zoneid" = "14c") then gosub AUTOMOVE river
     if ("$zoneid" = "14c") then gosub AUTOMOVE river
     if ("$zoneid" = "31") then gosub AUTOMOVE 1
     if ("$zoneid" = "32") then gosub AUTOMOVE 1
     if ("$zoneid" = "33") then gosub AUTOMOVE 1
     pause 0.4
     if ("$zoneid" != "30") then
          {
               put .travel haven
               waitforre ^YOU ARRIVED
          }
     pause 0.4
     gosub AUTOMOVE 8
     put #echo >Log #7FFFD4 *** Trained ATHLETICS - %havenloop loops of Haven - $Athletics.Ranks $Athletics.LearningRate / 34  ***
     unvar havenloop
     goto CLIMB_DONE
###########
ARTHE_CLIMB:
ARTHECLIMB:
     echo ####################
     echo * Lowbie Athletics
     echo * Noob Arthe Climb Run
     echo #####################
     pause
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     pause 0.1
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     var artheloop 0
     var artheswim 0
ARTHE_CLIMB_GO:
     pause 0.1
     if ($Athletics.LearningRate > 31) then goto ARTHE_CLIMB_DONE
     if (%artheloop > 7) then goto ARTHE_DIVE
     gosub TOWNRUN_TIMERS
     gosub AUTOMOVE 550
     pause 0.4
     pause 0.1
     gosub AUTOMOVE 551
     pause 0.4
     pause 0.1
     gosub AUTOMOVE 552
     pause 0.4
     pause 0.1
     gosub AUTOMOVE 549
     pause 0.4
     pause 0.1
     if (%artheswim > 3) then goto ARTHE_DIVE
     math artheswim add 1
     goto ARTHE_CLIMB_GO
ARTHE_DIVE:
     pause 0.3
     ### TREE HOUSE - DIVE
     var artheswim 0
     gosub AUTOMOVE 547
     pause 0.5
     pause 0.1
     gosub AUTOMOVE 548
     pause 0.5
     pause 0.3
     send dive hole
     pause 0.4
     pause 0.4
     math artheloop add 1
     goto ARTHE_CLIMB_GO
ARTHE_CLIMB_DONE:
     put #echo >Log #7FFFD4 *** Trained ATHLETICS - %artheloop loops of ARTHE - $Athletics.Ranks $Athletics.LearningRate / 34  ***
     unvar artheloop
     unvar artheswim
     pause 0.1
     pause 0.1
     gosub AUTOMOVE crossing
     goto CLIMB_DONE
###########################################
CLIMB_CROSSING:
CLIMB_CROSS:
CROSS_CLIMBRUN:
     if (($invisible = 1) && (%Necro.Known = 0)) then gosub STOP_INVIS
     if (%Playing = 0) then gosub PLAY
     if ($Athletics.Ranks < 60) then goto ARTHE_CLIMB
     if ("$zoneid" != "1") then goto SHARD_CLIMBRUN
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     put .climbcross
     matchre CLIMB_DONE ^DONE CLIMBING\!
     matchwait 640
     put #script abort climbcross
     pause 0.5
     pause 0.5
     send stop climb
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "6") then gosub AUTOMOVE cross
     if ("$zoneid" = "8") then gosub AUTOMOVE cross
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     put #echo >Log #7FFFD4 *** Trained ATHLETICS in Crossing - $Athletics.Ranks $Athletics.LearningRate / 34  ***
     goto CLIMB_DONE
SHARD_CLIMBRUN:
SHARDITT:
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "116") then
          {
               if (%Playing = 1) then gosub STOP_PLAY
               send .travel shard
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "123") then gosub AUTOMOVE crag
     if (("$zoneid" = "69") && ($UC_shardCitizen = 1)) then gosub AUTOMOVE shard
     if (("$zoneid" = "69") && ($UC_shardCitizen = 0)) then gosub AUTOMOVE n gate
     if (("$zoneid" = "66") then gosub AUTOMOVE e gate
     if ("$zoneid" != "67") then goto CLIMB_DONE
     goto CLIMB_SHARD
CLIMB_DONE:
CLIMBDONE:
     gosub clear
     put #queue clear
     var CURRENT Returning to Home City
     var NEXTSUB MAGICROPE
     gosub STATUSBAR
     ### HOME CITY CHECK
     if !matchre("$UC_HomeCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub HOME_CITY_GO
     if matchre("$UC_HomeCity", "(?i)\b(NULL|OFF|0)\b") then
          {
               if matchre("$zoneid", "\b(1|30|42|67)\b") then gosub NEXUS_CHECK
          }
     gosub TOWNRUN_TIMERS
##########################################################################################
WINDBOARD_TRAIN:
WINDBOARD:
     var LAST WINDBOARD
     var NEXTSUB WINDBOARD_DONE
     var CURRENT Windboard Training
     if ($Athletics.LearningRate > 33) then goto MAGICROPE
     if ($UC_WindBoard = 0) then goto MAGICROPE
     gosub STATUSBAR
     action var windcharge 0;goto WINDBOARD_DONE when ^Your.* makes a few sputtering noises as its magic runs out\.
     ### HOME CITY CHECK
     if !matchre("$UC_HomeCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub HOME_CITY_GO
     ####
     gosub TOWNRUN_TIMERS
     ####
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     echo ##########################
     echo ** TRAINING ATHLETICS w/ WINDBOARD!
     echo ##########################
     pause 0.3
     if (%Playing = 1) then gosub STOP_PLAY
     gosub stowing
     pause 0.3
     put get my windboard
     wait
     pause 0.5
     pause 0.3
     if !matchre("$righthand $lefthand", "windboard") then goto NO_WINDBOARD
     gosub CHECK_CHARGE
WINDBOARD_SET:
     var actionverb tap|pull|wave|rub|raise|jump|clean|toss|poke|turn|lick|hug|pinch|flip|tilt
     var actioncount 14
     var windboardloop 0
     var windcount 0
     put mount my windboard
     pause
WINDBOARD_LOOP:
     pause 0.1
     math windcount add 1
     if ($standing = 0) then gosub STAND
     if (%windcount > 45) then goto WINDBOARD_DONE
     if (%windboardloop > %actioncount) then
          {
               if ($Athletics.LearningRate > 32) then goto WINDBOARD_DONE
               var windboardloop 0
          }
     var WindAction %actionverb(%windboardloop)
     put %WindAction windboard
     pause
     pause
     pause 0.2
     math windboardloop add 1
     if ($Athletics.LearningRate > 32) then goto WINDBOARD_DONE
     goto WINDBOARD_LOOP
NO_WINDBOARD:
     echo ########################
     echo ** ERROR! NO WINDBOARD FOUND!!!
     echo ########################
     put #var UC_WindBoard 0
     pause 0.8
     goto CLIMBING_NEXT
WINDBOARD_DONE:
     action remove ^Your.* makes a few sputtering noises as its magic runs out\.
     if ($standing = 0) then gosub STAND
     echo ###############################
     echo ** DONE TRAINING WITH WINDBOARD!
     echo ** %windcount verbs to Athletics: $Athletics.Ranks $Athletics.LearningRate / 34
     echo ###############################
     put #echo >Log Aqua *** Trained ATHLETICS w/ Windboard! %windcount verbs to Athletics: $Athletics.Ranks $Athletics.LearningRate / 34
     pause 0.8
     put dismount windboard
     pause 0.5
     if ($standing = 0) then gosub STAND
     gosub CHECK_CHARGE
     goto WINDBOARD_STOW

CHECK_CHARGE:
     var windcharge 1
     matchre WIND_CHARGE It has (\d+) charges left
     put focus windboard
     matchwait 4
WIND_CHARGE:
     var windcharge $1
     pause 0.1
     echo *** Windboard has %windcharge charges left
     if !matchre("$guild", "(Bard|Warrior Mage|Warrior)") && (%windcharge < 10) then
          {
               echo #############################
               echo ** YOU ARE NOT A WM OR BARD!
               echo ** FIND SOMEONE TO RECHARGE WINDBOARD
               echo ** ONLY %windcharge charges left
               echo ##############################
               put #echo >Log Orange *** WINDBOARD CHARGES RUNNING LOW - Find WM or Bard to recharge it!
               pause 2
               return
          }
     if !matchre("$guild", "(Bard|Warrior Mage|Warrior)") then return
WINDBOARD_CHARGES_2:
     pause 0.1
     pause 0.0001
     var LOCATION WINDBOARD_CHARGES_2
     matchre WINDBOARD_CHARGES_2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STUNNED ^You are still stunned
     matchre WEBBED ^You can't do that while entangled in a web
     matchre IMMOBILE ^You don't seem to be able to move to do that
     matchre WINDBOARD_CHARGES_2 ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre RETURN ^The windboard is already fully charged
     matchre WINDBOARD_STOW too weak and feeble to be recharged
     put charge my wind 24
     matchwait 12
     goto WINDBOARD_CHARGES_2

WINDBOARD_STOW:
     gosub clear
     unvar windboardloop
     unvar windcount
     unvar windcharge
     pause 0.2
     gosub stowing
     goto MAGICROPE
##########################################################################################
MAGICROPE:
MAGIC_ROPE:
     var ZillsReset 0
     var NEXTSUB ROPE_FINISHED
     var LAST MAGIC_ROPE
     var CURRENT Magic Climbing Rope
     gosub STATUSBAR
     pause 0.0001
     put stop climb
     pause 0.0001
     pause 0.0001
     if !matchre("%MAGIC.ROPE", "(?i)(ON|1|YES)") then goto ROPE_DONE
     if ($Athletics.LearningRate > 32) then goto ROPE_DONE
     if ($Athletics.Ranks > 1749) then goto ROPE_DONE
     if matchre("%MAGIC.ROPE", "(?i)(OFF|NULL|NIL)") then goto ROPE_DONE
     ####
     gosub TOWNRUN_TIMERS
     ####
     echo
     echo ##########################
     echo ** TRAINING ATHLETICS w/ MAGIC ROPE
     echo ##########################
     echo
     if (%Playing = 1) then gosub STOP_PLAY
     ### HOME CITY CHECK
     if !matchre("$UC_HomeCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub HOME_CITY_GO
               if !matchre("$guild", "(Ranger|Necromancer)") then goto MAGIC_ROPE_TRAIN
          }
     pause 0.001
     if ((matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON")) || (($UC_Premium = 1) && ("%FANGCOVE" = "ON"))) then
          {
               if matchre("$zoneid", "(1|30|40|42|47|61|66|67|90|99|107|108|114|116)") then
                    {
                         gosub TO_SEACAVES
                         # if (($Athletics.Ranks > 45) && ("$game" != "DRF")) then gosub AUTOMOVE 45
                         if (($roomid != 85) && ("$game" = "DRF")) then gosub AUTOMOVE 85
                         goto MAGIC_ROPE_TRAIN
                    }
          }
     ### RANGERS AND NECROS
     if (("$guild" = "Ranger") || (%Necro.Known = 1)) then
          {
               if (("$zoneid" = "1") && (%Necro.Known = 1)) then
                    {
                         gosub AUTOMOVE NE gate
                         gosub AUTOMOVE 558
                    }
               if (("$zoneid" = "1") && ("$guild" = "Ranger")) then gosub AUTOMOVE 587
               if ("$zoneid" = "116") then
                    {
                         gosub AUTOMOVE boar
                         gosub AUTOMOVE 45
                    }
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "61") then
                    {
                         gosub AUTOMOVE shard
                         gosub AUTOMOVE 116
                    }
               if ("$zoneid" = "30") then
                    {
                         gosub AUTOMOVE e gate
                         gosub AUTOMOVE 78
                    }
               if ("$zoneid" = "31") then gosub AUTOMOVE 102
               if ("$zoneid" = "47") then gosub AUTOMOVE bucket
               if ("$zoneid" = "42") then
                    {
                         gosub AUTOMOVE gate
                         gosub AUTOMOVE 222
                    }
               if ("$zoneid" = "90") then gosub AUTOMOVE sprite
               if ("$zoneid" = "99") then
                    {
                         gosub AUTOMOVE west
                         gosub AUTOMOVE 53
                    }
               if ("$zoneid" = "107") then gosub AUTOMOVE 58
               if ("$zoneid" = "62") then gosub AUTOMOVE 116
               if ("$zoneid" = "66") then gosub AUTOMOVE 640
               if ("$zoneid" = "123") then gosub AUTOMOVE 167
               if ("$zoneid" = "126") then gosub AUTOMOVE 45
               if (("$zoneid" = "127") && ("$guild" = "Ranger")) then gosub AUTOMOVE 39
               if (("$zoneid" = "127") && ("$guild" = "Necromancer")) then gosub AUTOMOVE 32
               goto MAGIC_ROPE_TRAIN
          }
     ### NON-RANGERS/NECROS
     if ("$zoneid" = "1") then gosub AUTOMOVE 336
     if ("$zoneid" = "116") then gosub AUTOMOVE 101
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE 639
     if ("$zoneid" = "61") then gosub AUTOMOVE 216
     if ("$zoneid" = "30") then gosub AUTOMOVE e gate
     if ("$zoneid" = "31") then gosub AUTOMOVE 101
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if ("$zoneid" = "42") then gosub AUTOMOVE gate
     if ("$zoneid" = "90") then gosub AUTOMOVE sprite
     if ("$zoneid" = "99") then gosub AUTOMOVE west
     if ("$zoneid" = "107") then gosub AUTOMOVE 58
     if ("$zoneid" = "62") then gosub AUTOMOVE 116
     if ("$zoneid" = "127") then gosub AUTOMOVE 37
     if (("$zoneid" = "150") && ("$roomid" != "85")) then gosub AUTOMOVE 85
MAGIC_ROPE_TRAIN:
     var RopeShift 0
     var magicRopeLoop 0
     pause 0.1
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     gosub OPEN %Rope.Container
     gosub ATHLETICS_SONG
     pause 0.001
     if ($UC_Zills = 1) then gosub ZILL_MAINTAIN
     if ((%Playing = 0) && ($UC_Zills = 0)) then send hum $SONG
     if ((%Playing = 0) && ($UC_Zills = 1)) then send play $SONG
     # if ($UC_Zills = 0) then
          # {
               # echo *** ZILLS IS TURNED OFF!
               # echo *** YOU ARE EITHER MISSING A CHAMOIS CLOTH OR MISSING ZILLS
               # echo *** GET SOME ZILLS/COWBELL AND A CHAMOIS CLOTH
          # }
     pause 0.1
     pause 0.001
     pause 0.001
     gosub stowing
     pause 0.1
     if !matchre("%Rope.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub GET my %ROPE.NAME from my %Rope.Container
     pause 0.2
     if matchre("$righthand $lefthand", "rope") then goto MAGIC_ROPE_CLIMB
     pause 0.001
     if !matchre("$righthand $lefthand", "rope") then gosub GET my climbing rope from my %Rope.Container
     if matchre("$righthand $lefthand", "rope") then goto MAGIC_ROPE_CLIMB
     pause 0.4
     pause 0.001
     if !matchre("$righthand $lefthand", "rope") then gosub GET my rope from my %Rope.Container
     pause 0.3
     if matchre("$righthand $lefthand", "rope") then goto MAGIC_ROPE_CLIMB
     pause 0.001
     if !matchre("$righthand $lefthand", "rope") then gosub GET my %ROPE.NAME
     pause 0.1
     pause 0.001
     pause 0.001
     if !matchre("$righthand $lefthand", "rope") then
          {
               if matchre("%ALLCONTAINERS", "(?i)(eddy|portal)") then gosub GET my %ROPE.NAME from my watery portal
               pause 0.3
               if !matchre("$righthand $lefthand", "rope") then gosub GET my rope from my watery portal
          }
     pause 0.1
     pause 0.001
     pause 0.001
     if !matchre("$righthand $lefthand", "rope") then goto NO_ROPE_FOUND
MAGIC_ROPE_CLIMB:
     pause 0.001
     if ($invisible = 1) then gosub STOPINVIS
     if ($standing = 0) then gosub STAND
     if ((%Playing = 0) && ($UC_Zills = 0)) then send hum $SONG
     if ((%Playing = 0) && ($UC_Zills = 1)) then send play $SONG
     pause 0.1
     pause 0.001
     pause 0.001
     math magicRopeLoop add 1
     echo *** Practicing Climbing On Magic Rope ***
     if (%magicRopeLoop > 6) then goto ROPE_FINISHED
MAGIC_ROPE_CLIMB_1:
     pause 0.001
     pause 0.001
     matchre MAGIC_ROPE_CLIMB_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre MAGIC_ROPE_CHECK_1 ^You finish practicing|^This climb is no challenge|^The rope's will quickly fades
     matchre MAGIC_ROPE_HARD ^(The|This) climb is too difficult
     matchre MAGIC_ROPE_EASY ^(The|This) climb is too easy
     matchre CLIMB_ABORT ^You are engaged|^You can\'t climb
     matchre MAGIC_STAND ^You should probably
     put climb practice my rope
     matchwait 200
MAGIC_ROPE_CHECK:
     send stop climb
     pause 0.2
     if ($standing = 0) then gosub STAND
     pause 0.2
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.1
MAGIC_ROPE_CHECK_1:
     if (%magicRopeLoop > 4) then goto ROPE_FINISHED
     if ($Athletics.LearningRate = 0) then goto MAGIC_ROPE_HARD
     if ($Athletics.LearningRate > 30) then goto ROPE_FINISHED
     echo *** Magic Rope Loop: %magicRopeLoop
     goto MAGIC_ROPE_CLIMB
MAGIC_STAND:
     gosub STAND
     goto MAGIC_ROPE_CLIMB
################
MAGIC_ROPE_HARD:
     var hard 1
     math magicRopeLoop subtract 1
     pause 0.1
     pause 0.1
     put stop play
     pause 0.1
     echo ###################
     echo ** MAGIC ROPE SONG TOO HARD!
     echo ** Downshifting song..
     echo ** Current Song: $SONG
     echo ###################
     pause 0.2
     goto ROPE_SHIFT
MAGIC_ROPE_EASY:
     var hard 0
     math magicRopeLoop subtract 1
     pause 0.1
     pause 0.1
     put stop play
     pause 0.1
     echo #####################
     echo ** MAGIC ROPE SONG TOO EASY!!
     echo ** Upshifting song..
     echo ** Current Song: $SONG
     echo #####################
     pause 0.2
     goto ROPE_SHIFT
ROPE_SHIFT:
     var songs %song0|%song1|%song2|%song3|%song4|%song5|%song6|%song7|%song8|%song9|%song10|%song11|%song12|%song13|%song14|%song15|%song16|%song17|%song18|%song19|%song20|%song21|%song22|%song23|%song24|%song25|%song26|%song27|%song28|%song29|%song30
     var totalsongs 31
     var i 0
     if matchre("$SONG", "%song0") then var i 0
     if matchre("$SONG", "%song1") then var i 1
     if matchre("$SONG", "%song2") then var i 2
     if matchre("$SONG", "%song3") then var i 3
     if matchre("$SONG", "%song4") then var i 4
     if matchre("$SONG", "%song5") then var i 5
     if matchre("$SONG", "%song6") then var i 6
     if matchre("$SONG", "%song7") then var i 7
     if matchre("$SONG", "%song8") then var i 8
     if matchre("$SONG", "%song9") then var i 9
     if matchre("$SONG", "%song10") then var i 10
     if matchre("$SONG", "%song11") then var i 11
     if matchre("$SONG", "%song12") then var i 12
     if matchre("$SONG", "%song13") then var i 13
     if matchre("$SONG", "%song14") then var i 14
     if matchre("$SONG", "%song15") then var i 15
     if matchre("$SONG", "%song16") then var i 16
     if matchre("$SONG", "%song17") then var i 17
     if matchre("$SONG", "%song18") then var i 18
     if matchre("$SONG", "%song19") then var i 19
     if matchre("$SONG", "%song20") then var i 20
     if matchre("$SONG", "%song21") then var i 21
     if matchre("$SONG", "%song22") then var i 22
     if matchre("$SONG", "%song23") then var i 23
     if matchre("$SONG", "%song24") then var i 24
     if matchre("$SONG", "%song25") then var i 25
     if matchre("$SONG", "%song26") then var i 26
     if matchre("$SONG", "%song27") then var i 27
     if matchre("$SONG", "%song28") then var i 28
     if matchre("$SONG", "%song29") then var i 29
     if matchre("$SONG", "%song30") then var i 30
SONG_SHIFT:
     pause 0.0001
     math RopeShift add 1
     if ((%RopeShift > 10) && ($UC_Zills = 1)) then
          {
               echo #####################
               echo *** TOO MANY SHIFTS!
               echo *** REVERTING TO HUMMING INSTEAD OF ZILLS
               echo ######################
               var ZillsReset 1
               var RopeShift 0
               put #var UC_Zills 0
               goto MAGIC_ROPE_TRAIN
          }
     if ((%RopeShift > 8) && ($UC_Zills = 0)) then
          {
               echo
               echo #####################
               echo *** TOO MANY SHIFTS! CANNOT FIND SWEET SPOT!
               echo *** MAYBE YOU NEED SOME ZILLS/COWBELLS
               echo *** QUITTING MAGIC ROPE TRAIN
               echo ######################
               echo
               var ZillsReset 1
               var RopeShift 0
               put #var UC_Zills 0
               goto ROPE_FINISHED
          }
     if (%RopeShift > %totalsongs) then return
     var CurrentSong %songs(%i)
     pause 0.0001
     pause 0.0001
     if (%hard = 1) then goto SONG_DOWNSHIFT
     math i add 1
     pause 0.0001
     pause 0.0001
     if matchre("%CurrentSong", "%songs(%i)") then return
     if ("%CurrentSong" = "") then return
     put #var SONG %songs(%i)
     echo ** NEW SONG: $SONG
     pause 0.7
     goto MAGIC_ROPE_CLIMB
SONG_DOWNSHIFT:
     if (%i = 0) then var i 17
     math i subtract 1
     put #var SONG %songs(%i)
     echo
     echo ** NEW SONG: $SONG
     echo
     pause 0.5
     goto MAGIC_ROPE_CLIMB
NO_ROPE_FOUND:
CLIMB_ABORT:
     echo ##########################
     echo *** NO MAGIC CLIMBING ROPE FOUND!
     echo *** Did you set your variables properly??
     echo ##########################
     if matchre("$righthand $lefthand", "rope") then gosub PUT put my rope in my %Rope.Container
     goto ROPE_DONE
ROPE_FINISHED:
     pause 0.1
     pause 0.001
     send stop climb
     pause 0.5
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.0001
     pause 0.0001
     if !matchre("%Rope.Container", "(?i)(OFF|NULL|NIL)") then gosub PUT put my rope in my %Rope.Container
     pause 0.3
     gosub stowing
     put #echo >Log Aqua *** Trained ATHLETICS w/ Magic Climbing Rope! %magicRopeLoop loops to $Athletics.Ranks $Athletics.LearningRate / 34
ROPE_DONE:
     unvar i
     unvar magicRopeLoop
     if ($standing = 0) then gosub STAND
     if (%ZillsReset = 1) then put #var UC_Zills 1
     # put #echo >Log Aqua **** Climbing Run Completed!
     if matchre("%Zill.Name", "(?i)cowbells?") then gosub PERFORMANCE_COWBELL
     if !matchre("%Zill.Name", "(?i)cowbells?") then gosub PERFORMANCE
     gosub stowing
     goto SKINNING_TRAINER
######################################################################################################################
SKINNING_TRAINER:
SKINNINGTRAINER:
     var loop 0
     pause 0.0001
     var NEXTSUB SKINTRAIN_DONE
     var LAST SKINNING_TRAINER
     var CURRENT Skin/FA Trainer
     gosub STATUSBAR
     if (($invisible = 1) && (%Necro.Known = 0)) then gosub STOP_INVIS
     ####
     gosub TOWNRUN_TIMERS
     ####
     if ((matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON")) || (($UC_Premium = 1) && ("%FANGCOVE" = "ON"))) then
          {
               if matchre("$zoneid", "(1|30|40|42|47|61|66|67|90|99|107|108|114|116)") then
                    {
                         gosub TO_SEACAVES
                         if (($Athletics.Ranks > 45) && ("$game" != "DRF")) then gosub AUTOMOVE 45
                         if (($roomid != 85) && ("$game" = "DRF")) then gosub AUTOMOVE 85
                    }
          }
     ### HOME CITY CHECK
     if !matchre("$UC_HomeCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub HOME_CITY_GO
               if !matchre("$guild", "(Ranger|Necromancer)") then goto GET_TRAINER
          }
     ### RANGERS AND NECROS
     if (("$guild" = "Ranger") || (%Necro.Known = 1)) then
          {
               if (("$zoneid" = "1") && (%Necro.Known = 1)) then
                    {
                         gosub AUTOMOVE NE gate
                         gosub AUTOMOVE 558
                    }
               if (("$zoneid" = "1") && ("$guild" = "Ranger")) then gosub AUTOMOVE 587
               if ("$zoneid" = "116") then
                    {
                         gosub AUTOMOVE boar
                         gosub AUTOMOVE 45
                    }
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "61") then
                    {
                         gosub AUTOMOVE shard
                         gosub AUTOMOVE 116
                    }
               if ("$zoneid" = "30") then
                    {
                         gosub AUTOMOVE e gate
                         gosub AUTOMOVE 78
                    }
               if ("$zoneid" = "31") then gosub AUTOMOVE 102
               if ("$zoneid" = "47") then gosub AUTOMOVE bucket
               if ("$zoneid" = "42") then
                    {
                         gosub AUTOMOVE gate
                         gosub AUTOMOVE 222
                    }
               if ("$zoneid" = "90") then gosub AUTOMOVE sprite
               if ("$zoneid" = "99") then
                    {
                         gosub AUTOMOVE west
                         gosub AUTOMOVE 53
                    }
               if ("$zoneid" = "107") then gosub AUTOMOVE 58
               if ("$zoneid" = "62") then gosub AUTOMOVE 116
               if ("$zoneid" = "66") then gosub AUTOMOVE 640
               if ("$zoneid" = "123") then gosub AUTOMOVE 167
               if ("$zoneid" = "126") then gosub AUTOMOVE 45
               if (("$zoneid" = "127") && ("$guild" = "Ranger")) then gosub AUTOMOVE 39
               if (("$zoneid" = "127") && ("$guild" = "Necromancer")) then gosub AUTOMOVE 32
               goto GET_TRAINER
          }
     ### NON-RANGERS/NECROS
     if ("$zoneid" = "1") then
          {
               echo *** CHOOSING RANDOM ROOM TO SCRIPT IN (1 out of 7 locations)
               random 1 7
               echo ** %r
               pause 0.3
               if (%r = 1) then gosub AUTOMOVE 336
               if (%r = 2) then gosub AUTOMOVE midton
               if (%r = 3) then gosub AUTOMOVE 661
               if (%r = 4) then gosub AUTOMOVE 327
               if (%r = 5) then gosub AUTOMOVE pond
               if (%r = 6) then gosub AUTOMOVE 331
               if (%r = 7) then gosub AUTOMOVE crofton
          }
     if ("$zoneid" = "116") then gosub AUTOMOVE 65
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE 639
     if ("$zoneid" = "61") then
          {
               echo *** CHOOSING RANDOM ROOM TO SCRIPT IN (1 out of 3 locations)
               random 1 3
               echo ** %r
               pause 0.3
               if (%r = 1) then gosub AUTOMOVE pool
               if (%r = 2) then gosub AUTOMOVE 119
               if (%r = 3) then gosub AUTOMOVE 216
          }
     if ("$zoneid" = "30") then gosub AUTOMOVE 59
     if ("$zoneid" = "31") then gosub AUTOMOVE 101
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if ("$zoneid" = "42") then gosub AUTOMOVE gate
     if ("$zoneid" = "40") then gosub AUTOMOVE 288
     if ("$zoneid" = "90") then gosub AUTOMOVE 452
     if ("$zoneid" = "99") then gosub AUTOMOVE 144
     if ("$zoneid" = "107") then gosub AUTOMOVE 58
     if ("$zoneid" = "62") then gosub AUTOMOVE 116
     if ("$zoneid" = "127") then gosub AUTOMOVE 37
     if (("$zoneid" = "150") && ("$roomid" != "85")) then gosub AUTOMOVE 85
GET_TRAINER:
     if ($UC_SkinTrain = 0) then goto COLLECT_RUN
     pause 0.0001
     echo
     echo #######################
     echo ** SKINNING / FIRST AID TRAINER
     echo #######################
     echo
     pause 0.5
     if (%Playing = 1) then gosub STOP_PLAY
     gosub stowing
     gosub GET my %SKINTRAIN.NOUN from my %SKINTRAIN.CONTAINER
     pause 0.4
     pause 0.4
     if !matchre("$righthand $lefthand", "%SKINTRAIN.NOUN") then
          {
               gosub GET my %SKINTRAIN.NOUN
               pause
          }
     pause 0.0001
     pause 0.0001
     if !matchre("$righthand $lefthand", "%SKINTRAIN.NOUN") then goto NO_SKINTRAINER
     goto SKIN_TRAINER
SKIN_TRAINER:
     math loop add 1
     ####
     if !matchre("$righthand $lefthand", "%SKINTRAIN.NOUN") then
          {
               gosub GET my %SKINTRAIN.NOUN
               pause
          }
     echo
     echo ####################
     echo * Training Skin/FA on %SKINTRAIN.NOUN
     echo * Loop: %loop/14
     echo ####################
     echo
     if !matchre("$righthand $lefthand", "%SKINTRAIN.NOUN") then goto NO_SKINTRAINER
     if (%loop > 14) then goto SKINTRAIN_DONE
     pause 0.1
     matchre SKIN_TRAINER ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre SKINTRAIN_CD The .+ looks frayed\, as if worked too often recently\, so you stop your attempt to skin it\.
     matchre GET_TRAINER ^You must be holding a .+ to skin it\.
     matchre REPAIR_TRAINER ^You skillfully peel back the .+ from the frame underneath\.
     matchre REPAIR_TRAINER ^A .+ has already been sliced open\.\s+Maybe you should REPAIR it\.
     put skin my %SKINTRAIN.NOUN
     matchwait 15
REPAIR_TRAINER:
     pause 0.0001
     pause 0.0001
     matchre REPAIR_TRAINER ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre SKINTRAIN_CHECK ^With some needle and thread\, you quickly stitch a .+ back together\.
     matchre SKIN_TRAINER ^A .+ isn\'t in need of repair\.
     put repair my %SKINTRAIN.NOUN
     matchwait 15
     echo **** MISSING MATCH IN REPAIR_TRAINER
     goto SKINTRAIN_DONE
SKINTRAIN_CHECK:
     pause 0.2
     if (%loop > 19) then goto SKINTRAIN_DONE
     if (($Skinning.LearningRate > 29) && ($First_Aid.LearningRate > 29)) then goto SKINTRAIN_DONE
     if (($Skinning.Ranks >= 1750) && ($First_Aid.LearningRate > 32)) then goto SKINTRAIN_DONE
     if (($First_Aid.Ranks >= 1750) && ($Skinning.LearningRate > 32)) then goto SKINTRAIN_DONE
     if (($Skinning.Ranks < 1750) && ($Skinning.LearningRate < 32)) then goto SKIN_TRAINER
     if (($First_Aid.Ranks < 1750) && ($First_Aid.LearningRate < 32)) then goto SKIN_TRAINER
     goto SKINTRAIN_DONE
SKINTRAIN_CD:
     pause 0.2
     echo
     echo #########################
     echo *** SKIN/FA TRAINER ON COOLDOWN
     echo *** Checking for a secondary one..
     echo #########################
     echo
     pause 0.4
     gosub PUT_IT my %SKINTRAIN.NOUN in my %SKINTRAIN.CONTAINER
     pause 0.2
     if matchre("$righthand $lefthand", "%SKINTRAIN.NOUN") then gosub stowing
     pause 0.1
     gosub GET my second %SKINTRAIN.NOUN from my %SKINTRAIN.CONTAINER
     pause 0.4
     if !matchre("$righthand $lefthand", "%SKINTRAIN.NOUN") then
          {
               gosub GET my second %SKINTRAIN.NOUN
               pause 0.4
          }
     pause 0.001
     if !matchre("$righthand $lefthand", "%SKINTRAIN.NOUN") then
          {
               put close my %SKINTRAIN.CONTAINER
               pause 0.5
               pause 0.1
               gosub GET my %SKINTRAIN.NOUN
               pause 0.4
               gosub OPEN %SKINTRAIN.CONTAINER
          }
     if !matchre("$righthand $lefthand", "%SKINTRAIN.NOUN") then goto SKINTRAIN_DONE
     goto SKIN_TRAINER
NO_SKINTRAINER:
     put #echo >Log #ff0000 *** SKIN/FA TRAINER NOT FOUND. Check variables
     echo ###########################
     echo ** NO SKIN/FA TRAINER FOUND??
     echo ** CHECK THE VARIABLE TO MAKE SURE IT'S CORRECT
     echo ** OR NOT IN A CLOSED CONTAINER
     echo ############################
     pause 6
SKINTRAIN_DONE:
     echo
     echo ##########################
     echo ** FINISHED WITH SKIN/FA TRAINER
     echo ** Skinning: $Skinning.Ranks $Skinning.LearningRate/34
     echo ** First Aid: $First_Aid.Ranks $First_Aid.LearningRate/34
     echo ##########################
     echo
     if ($First_Aid.LearningRate > 5) then put #echo >Log #7FFFD4 **** Trained SKIN/FA w/ %SKINTRAIN.NOUN! FA- $First_Aid.Ranks $First_Aid.LearningRate/34 ****
     pause
     unvar loop
     gosub PUT_IT my %SKINTRAIN.NOUN in my %SKINTRAIN.CONTAINER
     pause 0.2
     if matchre("$righthand $lefthand", "%SKINTRAIN.NOUN") then gosub stowing
     goto MAGIC_DUMP
#########################################################################################################
#### DUMP MAGIC SCROLLS / TABLETS ETC ONTO SCROLL SHELF IF IN TF
MAGIC_DUMP:
MAGICDUMP:
     if matchre("$guild", "%MAGICUSER") then goto COLLECT_RUN
     if ((matchre("$game", "DRF") && ($zoneid = 150)) then
          {
               gosub AUTOMOVE 89
               echo
               echo *** DUMPING SCROLLS
               echo
               gosub SCROLL_DUMP scroll
               gosub SCROLL_DUMP vellum
               gosub SCROLL_DUMP tablet
               gosub SCROLL_DUMP bark
               gosub SCROLL_DUMP papyrus roll
          }
     goto COLLECT_RUN
SCROLL_DUMP:
     var dumping $0
     pause 0.001
SCROLL_DUMP_1:
     pause 0.01
     pause 0.01
     gosub GET my %dumping
     pause 0.1
     pause 0.01
     if !matchre("$righthand $lefthand", "(?i)%dumping") then
          {
               gosub GLANCE
               if !matchre("$righthand $lefthand", "(?i)%dumping") then return
          }
     gosub PUT put my %dumping on shelf
     pause 0.1
     pause 0.001
     goto SCROLL_DUMP_1
#########################################################################################################
#########################################################################################################
COLLECT_RUN:
     pause 0.0001
     var NEXTSUB BRAIDING
     var LAST COLLECT_RUN
     var CURRENT Outdoorsmanship
     gosub STATUSBAR
     if (($invisible = 1) && (%Necro.Known = 0)) then gosub STOP_INVIS
     if (%Playing = 1) then gosub STOP_PLAY
     ####
     gosub TOWNRUN_TIMERS
     ####
     if !matchre("%COLLECTING", "(?i)(ON|1|YES)") then goto BRAIDING
     if ($Outdoorsmanship.Ranks > 1749) then goto BRAIDING
     var CollectLoop 0
     ### HOME CITY CHECK
     if !matchre("$UC_HomeCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub HOME_CITY_GO
               if !matchre("$guild", "(Ranger|Necromancer)") then goto COLLECTING
          }
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ((matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON")) || (($UC_Premium = 1) && ("%FANGCOVE" = "ON"))) then
          {
               if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
                    {
                         gosub TO_SEACAVES
                         if (($Athletics.Ranks > 45) && ("$game" != "DRF")) then gosub AUTOMOVE 45
                         if (($roomid != 85) && ("$game" = "DRF")) then gosub AUTOMOVE 85
                         goto COLLECTING
                    }
          }
     if (("$guild" = "Ranger") || (%Necro.Known = 1)) then
          {
               if (("$zoneid" = "1") && (%Necro.Known = 1)) then
                    {
                         gosub AUTOMOVE NE gate
                         gosub AUTOMOVE 313
                    }
               if (("$zoneid" = "1") && ("$guild" = "Ranger")) then gosub AUTOMOVE 587
               if ("$zoneid" = "116") then gosub AUTOMOVE raven
               if ("$zoneid" = "65") then gosub AUTOMOVE shard
               if ("$zoneid" = "69") then gosub AUTOMOVE north
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "61") then
                    {
                         gosub AUTOMOVE shard
                         gosub AUTOMOVE 116
                    }
               if ("$zoneid" = "30") then
                    {
                         gosub AUTOMOVE e gate
                         gosub AUTOMOVE 78
                    }
               if ("$zoneid" = "31") then gosub AUTOMOVE 102
               if ("$zoneid" = "47") then gosub AUTOMOVE 88
               if ("$zoneid" = "42") then
                    {
                         gosub AUTOMOVE gate
                         gosub AUTOMOVE 222
                    }
               if ("$zoneid" = "90") then gosub AUTOMOVE 42
               if ("$zoneid" = "99") then
                    {
                         gosub AUTOMOVE west
                         gosub AUTOMOVE 53
                    }
               if ("$zoneid" = "107") then gosub AUTOMOVE 12
               if ("$zoneid" = "62") then gosub AUTOMOVE 116
               if ("$zoneid" = "66") then gosub AUTOMOVE 640
               if ("$zoneid" = "123") then gosub AUTOMOVE 167
               if (("$zoneid" = "127") && ("$guild" = "Ranger")) then gosub AUTOMOVE 39
               if (("$zoneid" = "127") && ("$guild" = "Necromancer")) then gosub AUTOMOVE 32
               goto COLLECTING
          }
     #### NON RANGERS / NON-PREMIUM
     if ("$zoneid" = "1") then
          {
               echo *** CHOOSING RANDOM ROOM TO COLLECT IN ( 1/6 locations )
               random 1 6
               echo ** %r
               pause 0.3
               if (%r = 1) then gosub AUTOMOVE willow
               if (%r = 2) then gosub AUTOMOVE midton
               if (%r = 3) then gosub AUTOMOVE rangers
               if (%r = 4) then gosub AUTOMOVE tgsw
               if (%r = 5) then gosub AUTOMOVE tgne
               if (%r = 6) then gosub AUTOMOVE crofton
          }
     if ("$zoneid" = "30") then gosub AUTOMOVE 8
     if ("$zoneid" = "31") then gosub AUTOMOVE 101
     if ("$zoneid" = "42") then gosub AUTOMOVE 3
     if ("$zoneid" = "47") then gosub AUTOMOVE 88
     if ("$zoneid" = "61") then gosub AUTOMOVE 17
     if ("$zoneid" = "62") then gosub AUTOMOVE 116
     if ("$zoneid" = "66") then gosub AUTOMOVE 638
     if ("$zoneid" = "67") then gosub AUTOMOVE 154
     if ("$zoneid" = "90") then gosub AUTOMOVE 42
     if ("$zoneid" = "99") then gosub AUTOMOVE 91
     if ("$zoneid" = "107") then gosub AUTOMOVE 12
     if ("$zoneid" = "116") then gosub AUTOMOVE 4
     if ("$zoneid" = "127") then gosub AUTOMOVE 36
     if (("$zoneid" = "150") && ("$roomid" != "85")) then gosub AUTOMOVE 85
     ###########
COLLECTING:
     var LAST COLLECTING
     var NEXTSUB BRAIDING
     # if (("$zoneid" = "150") && ($Athletics.Ranks > 45) && ($roomid != 45)) then gosub AUTOMOVE 45
     math CollectLoop add 1
     if (($invisible = 1) && (%Necro.Known = 0)) then gosub STOP_INVIS
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     ####
     gosub TOWNRUN_TIMERS
     ####
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if matchre ("$roomobjs" , "teardrinker") then goto BRAIDING
     if ((%CollectLoop > 6) || ($Outdoorsmanship.LearningRate > 25)) then
          {
               unvar CollectLoop
               put #echo >Log #7FFFD4 *** Trained OUTDOORSMANSHIP! - $Outdoorsmanship.Ranks $Outdoorsmanship.LearningRate / 34 ****
               goto BRAIDING
          }
     pause 0.0001
     if ($standing = 0) then gosub STAND
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     gosub COLLECT %Collect
     gosub KICKEM
     if ($standing = 0) then gosub STAND
     gosub COLLECT %Collect
     gosub KICKEM
     gosub COLLECT %Collect
     gosub KICKEM
     if ($standing = 0) then gosub STAND
     gosub COLLECT %Collect
     gosub KICKEM
     if ($standing = 0) then gosub STAND
     goto COLLECTING
#######################################################################
BRAIDING:
     var NEXTSUB BRAID_DONE
     var LAST BRAIDING
     var CURRENT Engineering
     gosub STATUSBAR
     pause 0.0001
     if (%Playing = 1) then gosub STOP_PLAY
     if (($invisible = 1) && (%Necro.Known = 0)) then gosub STOP_INVIS
     ####
     gosub TOWNRUN_TIMERS
     ####
     if ($Engineering.Ranks > 75) then goto CLERIC_RITUAL
     if ($UC_Braiding = 0) then goto CLERIC_RITUAL
     if !matchre("$zoneid","\b(1|150|116|67|61|30|47|42|90|99|107|108)\b") then goto CLERIC_RITUAL
BRAIDING_REAL:
     var LAST BRAIDING_REAL
     pause 0.0001
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
               if (%Necro.Known = 1) then goto BRAID_DONE
          }
     echo
     echo **** GOING TO BRAID GRASS
     echo
     gosub PUT remove my %HAND.ARMOR
     gosub stowing
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if ($UC_Teach = 1) then gosub TEACH_TIMER
     if (("$zoneid" = "150") && ($roomid != 45)) then
          {
               if ($Athletics.Ranks > 45) then gosub AUTOMOVE 45
               if (($Athletics.Ranks < 46) && (%Teleport = 0)) then gosub LEAVE_SEACAVES
          }
     if (("$zoneid" = "1") && (%Necro.Known = 1)) then
          {
               gosub AUTOMOVE NE gate
               gosub AUTOMOVE 313
          }
     if (("$zoneid" = "1") && ("$guild" = "Ranger")) then gosub AUTOMOVE 587
     if (("$zoneid" = "1") && ("$guild" != "Ranger")) then
          {
               echo *** CHOOSING RANDOM ROOM TO BRAID IN
               random 1 4
               if (%r = 1) then gosub AUTOMOVE willow
               if (%r = 2) then gosub AUTOMOVE midton
               if (%r = 3) then gosub AUTOMOVE rangers
               if (%r = 4) then gosub AUTOMOVE tgse
          }
     if ("$zoneid" = "116") then gosub AUTOMOVE boar
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE west
     pause 0.0001
     if (("$zoneid" = "69") && ($roomid != 11)) then gosub AUTOMOVE 11
     if (("$zoneid" = "61") && ($roomid != 17)) then gosub AUTOMOVE 17
     if (("$zoneid" = "30") && ($roomid != 239)) then gosub AUTOMOVE 239
     if (("$zoneid" = "42") && ($roomid != 3)) then gosub AUTOMOVE 3
     if (("$zoneid" = "99") && ($roomid != 214)) then gosub AUTOMOVE 214
     if (("$zoneid" = "107") && ($roomid != 171)) then gosub AUTOMOVE 171
     if (("$zoneid" = "108") && ($roomid != 154)) then gosub AUTOMOVE 154
     if (("$zoneid" = "112") && ($roomid != 12)) then gosub AUTOMOVE 12
     if (("$zoneid" = "126") && ($roomid != 40)) then gosub AUTOMOVE 40
     if (("$zoneid" = "127") && ("$guild" = "Ranger")) then gosub AUTOMOVE 39
     if (("$zoneid" = "127") && ("$guild" != "Ranger")) then gosub AUTOMOVE 33
     if (("$zoneid" = "90") then gosub AUTOMOVE green
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if matchre("$guild", "%MAGICUSER") then gosub PERCEIVE_TIMER
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     pause 0.0001
     if matchre ("$roomobjs" , "teardrinker") then goto BRAID_DONE
     if ("$guild" = "Thief") then gosub KHRI
     if (("$guild" = "Thief") && ($circle > 100)) then gosub KHRI_START serenity sight sensing
     if (("$guild" = "Thief") && ($circle > 150) && ($concentration > 80)) then gosub KHRI_START steady avoidance flight elusion focus
     gosub stowing
     if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
     pause 0.0001
     gosub BRAID
BRAID_DONE:
     var LAST BRAIDING_DONE
     # debug 5
     put #script abort braid
     pause 0.2
     pause 0.0001
     gosub DUMPSTER_SET
     pause 0.1
     if !matchre("%dumpster", "(NULL|gelapod)") then
          {
               pause 0.2
               if matchre("$righthand","(grass|vine|rope)") then put put my $1 in %dumpster
               if matchre("$lefthand","(grass|vine|rope)") then put put my $1 in %dumpster
               pause 0.5
          }
     if matchre("%dumpster", "gelapod") then
          {
               pause 0.2
               if matchre("$righthand","(grass|vine|rope)") then put feed my $1 to gelapod
               if matchre("$lefthand","(grass|vine|rope)") then put feed my $1 to gelapod
               pause 0.5
          }
     pause 0.0001
     pause 0.0001
     if matchre("$righthand","(grass|vine|rope)") then put drop my $righthand
     if matchre("$lefthand","(grass|vine|rope)") then put drop my $lefthand
     pause 0.2
     send dump junk
     pause 0.8
     gosub GET my %HAND.ARMOR
     gosub WEAR %HAND.ARMOR
     put #echo >Log #7FFFD4 *** Trained Engineering - $Engineering.Ranks $Engineering.LearningRate / 34 ****
     pause 0.5
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if matchre("$guild", "%MAGICUSER") then gosub PERCEIVE_TIMER
     if ($UC_Tarantula = 1) then gosub TARANTULA_TIMER
     if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "62") then gosub AUTOMOVE leth
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "126") then
          {
               gosub AUTOMOVE hibarn
               pause 0.4
               send east
               pause 0.4
          }
     pause 0.2
###################################################################################################
CLERIC_RITUAL:
CLERICRIT:
     gosub clear
     if !matchre("$guild","(Cleric|Paladin)") then goto PIRP_CHECK
     var NEXTSUB PILGRIM_BADGE_RUN
     var LAST CLERICRIT
     var CURRENT Cleric Rituals
     gosub STATUSBAR
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     pause 0.0001
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "62") then gosub AUTOMOVE leth
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if matchre("$zoneid", "(126|127)") then
          {
               put .travel hib
               waitforre ^YOU ARRIVED
          }
     if ("$zoneid" = "68") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ($UC_Crystal = 1) then gosub CRYSTAL_TIMER
     if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if (("$guild" = "Cleric") && ($UC_ClericRituals = 1)) then goto RITUAL_CHECK
     ####
     gosub TOWNRUN_TIMERS
     ####
     goto TITHE_CHECK
RITUAL_CHECK:
RITUALCHECK:
     var CURRENT Cleric Rituals
     gosub STATUSBAR
     # if ("$zoneid" != "1") then goto PILGRIM_BADGE_RUN
     action (communes) on
     gosub THEURGY
XING_RITUAL_LEAVE:
     if ($standing = 0) then gosub STAND
     put #echo >Log #7FFFD4 *** Trained THEURGY - $Theurgy.Ranks $Theurgy.LearningRate / 34 ****
     goto PILGRIMRUN
TITHE_CHECK:
     action (communes) off
     if matchre("$zoneid", "(68|69|65)") then gosub AUTOMOVE shard
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     pause 0.0001
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "2a") then gosub AUTOMOVE cross
     if matchre("$guild", "(Paladin|Cleric)") then
          {
               gosub AUTOMOVE teller
               put withdraw 6 silver
               pause 0.8
               gosub TITHE
               if ("$zoneid" = "67") then gosub AUTOMOVE 88
               pause 0.2
          }
PILGRIM_BADGE_RUN:
PILGRIMRUN:
     var NEXTSUB PIRP_CHECK
     if ($UC_Tarantula = 1) then gosub TARANTULA_TIMER
     if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
     if ($UC_Pilgrim = 0) then goto PIRP_CHECK
     if !matchre("$guild","(Cleric|Paladin)") then goto PIRP_CHECK
     gosub BADGE_IT
     pause 0.2
PRAY_IT:
     pause 0.0001
     pause 0.0001
     put remove my pilgrim badge
     pause 0.5
     send pray my badge
     pause 2
     pause 0.0001
     pause 0.0001
     send wear my badge
     pause 0.5
     goto RPA
################################################################################################
RPA:
RPA_CHECK:
PIRPS:
PIRP_CHECK:
     var LAST PIRPS
     var NEXTSUB ASTROLOGY
     var CURRENT PIRPS
     var bestowed 0
     gosub STATUSBAR
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     if ($UC_RPA = 0) then goto ASTROLOGY
     gosub GUILD_CHECK
     pause 0.0001
     echo
     echo #########
     echo # RPA CHECK!
     echo # Pirp: $pirps
     echo #########
     echo
     if ($pirps > 0) then goto PIRP_GIVE
     goto ASTROLOGY
PIRP_GIVE:
     echo
     echo #####################
     echo # GIVING OUT PIRP POINTS!
     echo # Pirp List: %PirpList
     echo #####################
     echo
     var pirploop 0
     eval PirpCount count("%PirpList", "|")
     pause 0.0001
     pause 0.0001
     if (("$charactername" != "Shroom") && ("$game" = "DRF")) then
          {
               put RPA bestow shroom 3
               pause 0.2
               pause 0.2
          }
     if (("$charactername" != "Shroom") && ("$game" = "DR")) then
          {
               put RPA bestow shroom 3
               pause 0.2
               pause 0.2
          }
PIRP_LOOP:
     pause 0.0001
     if !matchre("%PirpList(%pirploop)", "(?i)(NULL|%^)") then gosub BESTOW_RPA %PirpList(%pirploop)
     math pirploop add 1
     pause 0.0001
     if (%pirploop > %PirpCount) then goto PIRP_DONE
     if (%pirploop > 50) then goto PIRP_DONE
     goto PIRP_LOOP

BESTOW_RPA:
     var person $1
     pause 0.001
     matchre BESTOW_YES ^You just bestowed
     matchre BESTOW_NO ^You have already|^I could not
     if ($pirps < 3) then put RPA bestow %person 1
     else put RPA bestow %person 3
     matchwait 2
BESTOW_NO:
     pause 0.001
     return
BESTOW_YES:
     var bestowed 1
     pause 0.001
     return

PIRP_DONE:
     unvar pirploop
     put #echo >Log #00ff99 *** Bestowed RPA Points!
     goto ASTROLOGY
################################################################################################
RTR:
ASTROLOGY:
     var LAST RTR
     var NEXTSUB STUDY_RUN
     var CURRENT RTR Training
     gosub STATUSBAR
     if (("$guild" != "Moon Mage") || ($UC_RTR = 0)) then goto STUDY_RUN
     gosub TOWNRUN_TIMERS
     ####
RTR_SETUP:
     var celestial NULL
     action var celestial $1 when ^As your consciousness drifts amongst the currents of Fate,.* (\w+)\.
     action put #var spellRTR 0 when ^As your ritual ebbs away\, you find yourself returned to a world of immutable\, indisputable facts\.
     if (%Research.Active = 1) then gosub RESEARCH_CANCEL
     action (observe) on
     gosub stowing
     pause 0.0001
     var TempSchool Utility
     gosub SPELLMATH RTR
     if (%NOCAST) then goto RTR_FAIL
     put #var Mana.RTR %spellCMax
     put #var Camb.RTR 0
     if ($Camb.RTR > 100) then put #var Camb.RTR 30
     pause 0.1
     gosub PERCEIVE_MM
     pause 0.1
     put observe sky
     pause 2
     pause
RTR_1:
     echo
     echo #########################
     echo ** Casting RTR at $Mana.RTR mana
     echo #########################
     echo
     if (($spellCV = 0) || ($SpellTimer.ClearVision.active = 0)) then gosub BUFF CV $Mana.CV
     if (($spellPG = 0) || ($SpellTimer.PiercingGaze.active = 0)) then gosub BUFF PG $Mana.PG
     if (matchre("%abbrevs", "(?i)DC") && ($SpellTimer.DestinyCipher.active = 0)) then gosub BUFF DC 15
     if ($standing = 1) then put sit
     var spellExpired 0
     gosub PREPARE RTR $Mana.RTR
     gosub RITUAL
     put cast
     pause 0.5
     pause 0.4
     if (%Backfired = 1) then
          {
               echo
               echo *** BACKFIRED!!!
               echo *** REDUCING RTR MANA
               echo
               var mana $Mana.RTR
               math mana subtract 20
               put #var Mana.RTR %mana
               var Backfired 0
               goto RTR_1
          }
RTR_LOOP:
     pause 0.01
     if ($standing = 1) then put sit
     pause 0.1
     if ($spellRTR = 0) then goto RTR_END
     if !matchre("$righthand $lefthand", "telescope") then
          {
               gosub OPEN %Telescope.Container
               gosub GET my telescope
               pause 0.1
               put open my telescope
               pause 0.3
               pause 0.1
          }
     pause 0.2
     if !matchre("$righthand $lefthand", "telescope") then goto RTR_ERROR
     if (("%celestial" != "NULL") && !matchre("%celestial", "(?i)sun")) then
          {
               pause 0.1
               put center telescope on %celestial
               pause 0.5
               pause 0.2
               put peer telescope
               pause 2
               pause
               var celestial NULL
          }
     if matchre("%celestial", "(?i)sun") then
          {
               pause 0.1
               put observe sun in sky
               pause 2
               pause
               var celestial NULL
          }
     pause 0.2
     goto RTR_LOOP
RTR_END:
RTREND:
     action remove ^As your consciousness drifts amongst the currents of Fate,.* (\w+)\.
     if !matchre("%Telescope.Container", "NULL") then gosub PUT put telescope in my %Telescope.Container
     if matchre("$righthand $lefthand", "telescope") then gosub STOWIT telescope
     action (observe) on
     pause 0.1
     echo
     echo ########################
     echo *** Read the Ripples Complete!
     echo *** Analyzing Predictions..
     echo #########################
     echo
     pause 0.5
     put predict weather
     pause 5
     pause 0.5
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     put predict state all
     pause 5
     pause 0.5
     gosub OBJECT_ALIGN
     if matchre("%Pool.Magic", "(?i)complete") then
          {
               gosub ALIGN_MAGIC
               if !matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT
               if matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT_TOOL
               goto RTREND_2
          }
     if matchre("%Pool.Lore", "(?i)complete") then
          {
               gosub ALIGN_LORE
               if !matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT
               if matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT_TOOL
               goto RTREND_2
          }
     if matchre("%Pool.Survival", "(?i)complete") then
          {
               gosub ALIGN_SURVIVAL
               if !matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT
               if matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT_TOOL
               goto RTREND_2
          }
     if matchre("%Pool.Offense", "(?i)complete") then
          {
               gosub ALIGN_OFFENSE
               if !matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT
               if matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT_TOOL
               goto RTREND_2
          }
     if matchre("%Pool.Defense", "(?i)complete") then
          {
               gosub ALIGN_DEFENSE
               if !matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT
               if matchre("%Predict.Tool", "(?i)(PRISM|CHART|BONE|MIRROR|BOWL|DECK)") then gosub PREDICT_TOOL
               goto RTREND_2
          }
RTREND_2:
     pause 0.2
     gosub PREDICT_ANALYZE
     pause 0.2
     gosub STAND
     put #echo >Log #7FFFD4 *** Trained Astrology w/ RTR - $Astrology.Ranks $Astrology.LearningRate / 34 ****
     goto STUDY_RUN
RTR_FAIL:
     echo
     echo *** Can't Cast RTR???
     echo
     goto STUDY_RUN
RTR_ERROR:
     echo
     echo *** NO TELESCOPE?? TERRIBLE MOON MAGE!!!
     echo *** Skipping RTR..
     echo
     pause 0.5
     goto STUDY_RUN
#################################################################################################
STUDY_RUN:
STUDYRUN:
     var NEXTSUB JOURNAL_CHECK
     var LAST STUDY_RUN
     var CURRENT Scholarship
     gosub STATUSBAR
     if (($invisible = 1) && (%Necro.Known = 0)) then gosub STOP_INVIS
     gosub TOWNRUN_TIMERS
     ####
     if !matchre("%RAVEN", "(?i)(ON|1|YES)") then goto TEXTBOOK_STUDY
     if (%Playing = 0) then gosub PLAY
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     if ("$zoneid" != "1") then goto TEXTBOOK_STUDY
     gosub RAVEN_STUDY
     put #echo >Log #7FFFD4 *** Trained SCHOLARSHIP @ Raven's Court - $Scholarship.Ranks $Scholarship.LearningRate/34 ****
TEXTBOOK_STUDY:
TEXTBOOKYO:
     var NEXTSUB JOURNAL_CHECK
     if ($UC_Textbook = 0) then goto JOURNAL_CHECK
     if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
          {
               if (("$game" = "DRF") || ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then
                    {
                         if ("$zoneid" = "42") then gosub AUTOMOVE gate
                         gosub TO_SEACAVES
                         if (($Athletics.Ranks > 45) && ("$game" != "DRF")) then gosub AUTOMOVE 45
                         if (($roomid != 85) && ("$game" = "DRF")) then gosub AUTOMOVE 85
                         goto TEXTBOOK_TIME
                    }
          }
     if (("$guild" = "Ranger") || (%Necro.Known = 1)) then
          {
               if (("$zoneid" = "1") && (%Necro.Known = 1)) then
                    {
                         gosub AUTOMOVE NE gate
                         gosub AUTOMOVE 313
                    }
               if (("$zoneid" = "1") && ("$guild" = "Ranger")) then gosub AUTOMOVE 587
               if ("$zoneid" = "116") then gosub AUTOMOVE raven
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "61") then
                    {
                         gosub AUTOMOVE shard
                         gosub AUTOMOVE 116
                    }
               if ("$zoneid" = "30") then
                    {
                         gosub AUTOMOVE e gate
                         gosub AUTOMOVE 78
                    }
               if ("$zoneid" = "31") then gosub AUTOMOVE 102
               if ("$zoneid" = "47") then gosub AUTOMOVE 88
               if ("$zoneid" = "42") then
                    {
                         gosub AUTOMOVE gate
                         gosub AUTOMOVE 222
                    }
               if ("$zoneid" = "90") then gosub AUTOMOVE 42
               if ("$zoneid" = "99") then
                    {
                         gosub AUTOMOVE west
                         gosub AUTOMOVE 53
                    }
               if ("$zoneid" = "107") then gosub AUTOMOVE 12
               if ("$zoneid" = "62") then gosub AUTOMOVE 116
               if ("$zoneid" = "66") then gosub AUTOMOVE 640
               if ("$zoneid" = "123") then gosub AUTOMOVE 167
               if (("$zoneid" = "127") && ("$guild" = "Ranger")) then gosub AUTOMOVE 39
               if (("$zoneid" = "127") && ("$guild" = "Necromancer")) then gosub AUTOMOVE 32
               goto TEXTBOOK_TIME
          }
     if ("$zoneid" = "1") then
          {
               echo *** CHOOSING RANDOM ROOM TO SCRIPT IN (1 out of 7 locations)
               random 1 7
               echo ** %r
               pause 0.3
               if (%r = 1) then gosub AUTOMOVE 336
               if (%r = 2) then gosub AUTOMOVE midton
               if (%r = 3) then gosub AUTOMOVE 661
               if (%r = 4) then gosub AUTOMOVE 327
               if (%r = 5) then gosub AUTOMOVE pond
               if (%r = 6) then gosub AUTOMOVE 331
               if (%r = 7) then gosub AUTOMOVE crofton
          }
     if ("$zoneid" = "116") then gosub AUTOMOVE 65
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE 639
     if ("$zoneid" = "61") then
          {
               echo *** CHOOSING RANDOM ROOM TO SCRIPT IN (1 out of 3 locations)
               random 1 3
               echo ** %r
               pause 0.3
               if (%r = 1) then gosub AUTOMOVE pool
               if (%r = 2) then gosub AUTOMOVE 119
               if (%r = 3) then gosub AUTOMOVE 216
          }
     if ("$zoneid" = "30") then gosub AUTOMOVE 59
     if ("$zoneid" = "31") then gosub AUTOMOVE 101
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if ("$zoneid" = "42") then gosub AUTOMOVE gate
     if ("$zoneid" = "40") then gosub AUTOMOVE 288
     if ("$zoneid" = "90") then gosub AUTOMOVE 452
     if ("$zoneid" = "99") then gosub AUTOMOVE 144
     if ("$zoneid" = "107") then gosub AUTOMOVE 58
     if ("$zoneid" = "62") then gosub AUTOMOVE 116
     if ("$zoneid" = "127") then gosub AUTOMOVE 37
     if (("$zoneid" = "150") && ("$roomid" != "85")) then gosub AUTOMOVE 85
TEXTBOOK_TIME:
     if matchre("$guild", "(Empath|Moon Mage)") then gosub TEXTBOOK_READ long
     if !matchre("$guild", "(Empath|Moon Mage)") then gosub TEXTBOOK_READ normal
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub PUT put %TEXTBOOK.TYPE in my $UC_Container.Textbook
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub STOW my %TEXTBOOK.TYPE
     put #echo >Log #7FFFD4 *** Trained SCHOLARSHIP/FA w/ %Textbook.Noun - Scholarship: $Scholarship.Ranks $Scholarship.LearningRate/34 ****
     goto JOURNAL
####################################################################################################################################
#### EPISTEMIC JOURNAL STUDY
############################################
JOURNAL_CHECK:
JOURNAL:
     var LAST JOURNAL_CHECK
     var NEXTSUB PERFORMANCE_RUN
     var CURRENT Epistemic Journal
     gosub STATUSBAR
     if ($UC_Journal = 0) then goto PERFORMANCE_RUN
     gosub JOURNAL_TIMER
     if ($UC_Journal.Last < 86400) then goto PERFORMANCE_RUN
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     gosub TOWNRUN_TIMERS
     echo #########################
     echo *** STUDYING EPISTEMIC JOURNAL
     echo #########################
     pause 0.1
     gosub stowing
     pause 0.0001
     gosub GET %JOURNAL.TYPE
     pause 0.5
     if !matchre("$righthand $lefthand", "(?i)%JOURNAL.TYPE") then goto JOURNAL_ERROR
JOURNAL_WRITE:
     pause 0.0001
     pause 0.0001
     matchre JOURNAL_WRITE ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre JOURNAL_FAIL ^Having recently written
     matchre JOURNAL_FAIL \[You can do that again in about
     matchre JOURNAL_SUCCESS ^Flipping to a blank page
     matchre JOURNAL_SUCCESS The .+ has converted
     matchre JOURNAL_ERROR ^You need to be holding
     put write %JOURNAL.TYPE
     matchwait 10
JOURNAL_FAIL:
     put #var UC_Journal.Time {#evalmath ($gametime - 80000)}
     echo ################################
     echo *** EPISTEMIC JOURNAL STILL ON COOLDOWN
     echo ################################
     pause 0.5
     pause 0.2
     gosub stowing
     goto PERFORMANCE_RUN
JOURNAL_SUCCESS:
     echo ###########################
     echo *** EPISTEMIC JOURNAL SUCCESS!
     echo ###########################
     pause 0.1
     put read my %JOURNAL.TYPE
     pause 0.5
     pause 0.5
     gosub stowing
     put #echo >Log #BE03FF *** Wrote in Epistemic Journal!
     put #var UC_Journal.Time $gametime
     goto PERFORMANCE_RUN
JOURNAL_ERROR:
     echo ##############################
     echo *** EPISTEMIC JOURNAL NOT FOUND??
     echo *** Check Journal.Type Var - %JOURNAL.TYPE
     echo ###############################
     put #echo >Log #ff0000*** Epistemic Journal Not Found? Check Journal.Type var - %JOURNAL.TYPE
     pause
     gosub stowing
     goto PERFORMANCE_RUN
###############################################################
#### MUSIC PLAYING / PERFORMANCE
PERFORMANCE_RUN:
     var performanceloop 0
     var LAST PERFORMANCE_RUN
     var NEXTSUB PERFORMANCE_DONE
     var CURRENT Performance
     gosub STATUSBAR
     pause 0.0001
     if ($UC_Zills = 1) then gosub ZILL_MAINTAIN
     if ($UC_Performance = 0) then goto TOOLCHECK
     if ($UC_Zills = 0) then goto TOOLCHECK
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     gosub TOWNRUN_TIMERS
     echo
     echo ##################
     echo *** PERFORMANCE TRAINING
     echo ##################
     echo
     if ($invisible = 1) then gosub STOP_INVIS
     if matchre("%Zill.Name", "(?i)cowbells?") then gosub PERFORMANCE_COWBELL
     if !matchre("%Zill.Name", "(?i)cowbells?") then gosub PERFORMANCE
     if !matchre("$righthand $lefthand", "%Zill.Name") then
          {
               gosub stowing
               put remove my %Zill.Name
               pause 0.3
               put get my %Zill.Name
               pause 0.5
          }
PERFORMANCE_1:
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then gosub RESEARCH_CANCEL
     pause 0.0001
     if ($invisible = 1) then gosub STOP_INVIS
     math performanceloop add 1
     if (!matchre("$guild", "(Trader|Bard|Empath|Moon Mage)") && (%performanceloop > 6)) then goto PERFORMANCE_DONE
     if (matchre("$guild", "(Trader|Bard|Empath|Moon Mage)") && (%performanceloop > 15)) then goto PERFORMANCE_DONE
     if ($Performance.LearningRate > 32) then goto PERFORMANCE_DONE
     pause 0.0001
     pause 0.0001
     echo
     echo ####################
     echo *** Performance Training
     echo *** Current Song: $SONG
     echo *** Performance Ranks: $Performance.Ranks
     echo ####################
     echo
     pause 0.1
     put play $SONG
     pause 85
     if (%Playing = 1) then put stop play
     pause 0.3
     goto PERFORMANCE_1
PERFORMANCE_DONE:
     pause 0.1
     pause 0.0001
     put #echo >Log #7FFFD4 *** Trained PERFORMANCE - $Performance.Ranks $Performance.LearningRate / 34  ***
     if (%Playing = 1) then put stop play
     pause 0.1
     gosub ZILL_MAINTAIN
     if matchre("$righthand $lefthand", "%Zill.Name") then
          {
               put wear my %Zill.Name
               pause 0.5
          }
     unvar performanceloop
     gosub stowing
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then gosub RESEARCH_CANCEL
     pause 0.5
     goto TOOLCHECK
####################################################
ZILLS_MAINTAIN:
ZILL_MAINTAIN:
ZILLIES:
     var CURRENT Cleaning Zills
     gosub STATUSBAR
     pause 0.0001
     pause 0.0001
     if ($invisible = 1) then gosub STOP_INVIS
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if matchre("%Zill.Name", "(?i)jug") then goto CLEAN_JUG
     pause 0.0001
     pause 0.0001
     gosub GET my chamois cloth
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.3
     pause 0.1
     if !matchre("$righthand $lefthand", "cloth") then
          {
               gosub GET linen cloth
               pause 0.4
          }
     if !matchre("$righthand $lefthand", "cloth") then
          {
               gosub GET silk cloth
               pause 0.4
          }
     if !matchre("$righthand $lefthand", "cloth") then
          {
               gosub GET cotton cloth
               pause 0.3
          }
     if !matchre("$righthand $lefthand", "cloth") then
          {
               gosub GET needlework cloth
               pause 0.4
          }
     if !matchre("$righthand $lefthand", "cloth") then
          {
               gosub GET woven cloth
               pause 0.4
          }
     pause 0.0001
     pause 0.0001
     if !matchre("$righthand $lefthand", "cloth") then
          {
               echo
               echo **** NO CHAMOIS CLOTH??!
               echo **** WILL TRY RESTOCKING AT END OF RUN!
               echo
               pause
               return
          }
     pause 0.0001
     send remove my %Zill.Name
     wait
     pause 0.5
     pause 0.1
     if !matchre("$righthand $lefthand", "%Zill.Name") then
          {
               gosub GET my %Zill.Name
               pause 0.7
          }
     pause 0.0001
     pause 0.0001
     put assess my %Zill.Name
     pause 0.5
     pause 0.5
     gosub WRING_CLOTH
     pause 0.0001
     pause 0.0001
     gosub PUT wipe my %Zill.Name with my cloth
     gosub PUT wipe my %Zill.Name with my cloth
     pause 0.0001
     pause 0.0001
     gosub PUT wipe my %Zill.Name with my cloth
     pause 0.0001
     pause 0.0001
     gosub WRING_CLOTH
     gosub PUT clean my %Zill.Name with my cloth
     pause 0.0001
     pause 0.0001
     gosub PUT clean my %Zill.Name with my cloth
     pause 0.0001
     pause 0.0001
END_CLEANING:
     gosub WRING_CLOTH
     gosub STOWIT cloth
     gosub PUT wear my %Zill.Name
     pause 0.5
     return
WRING_CLOTH:
     pause 0.0001
     pause 0.0001
     matchre WRING_CLOTH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WRING_CLOTH water dribbling|water pouring|wet chamois cloth
     matchre RETURN squeezing out the last bit of water|then shake it out again|^I could not
     put wring my cloth
     matchwait 20
     return
CLEAN_JUG:
     send remove my %Zill.Name
     pause 0.5
     pause 0.2
     if !matchre("$righthand $lefthand", "%Zill.Name") then gosub GET my %Zill.Name
     pause 0.2
     put assess my %Zill.Name
     pause 0.5
     pause 0.5
     gosub PUT shake my %Zill.Name
     pause 0.2
     gosub PUT shake my %Zill.Name
     pause 0.2
     pause 0.2
     gosub PUT clean my %Zill.Name
     pause 0.2
     pause 0.1
     gosub PUT clean my %Zill.Name
     pause 0.2
     gosub PUT clean my %Zill.Name
     pause 0.2
     pause 0.3
     gosub PUT wear my %Zill.Name
     return
###############################
# CRAFTING TOOL REPAIR CHECK
###############################
TOOL_CHECK_PRE:
TOOLCHECK:
REPAIRTOOLS:
TOOLREPAIR:
     var LAST TOOLCHECK
     if matchre("$zoneid","\b(7|8|4)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(31|32|33)\b") then gosub AUTOMOVE river
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if !matchre("$charactername",  "(Shroom|Illuminati|Raidboss)") then goto VAULT_CITY_CHECK
     pause 0.1
     gosub OPEN $UC_Container.Crafting
     pause 0.2
     gosub stowing
     pause 0.2
     gosub TOOL_CHECK pestle
     gosub TOOL_CHECK saw
     gosub TOOL_CHECK mixing stick
     gosub TOOL_CHECK burin
     gosub TOOL_CHECK loop
     gosub TOOL_CHECK brazier
     pause 0.5
     goto VAULT_CITY_CHECK

TOOL_CHECK:
     var tool $0
     pause 0.0001
     gosub GET my %tool
     put untie my %tool
     pause 0.5
     pause 0.4
     if !matchre("$righthand $lefthand", "%tool") then return
     pause 0.001
     matchre TOOL_GOOD ^Analyze what\?|^What were
     matchre TOOL_GOOD pristine condition|mint condition|You can't|^You are unable
     matchre TOOL_REPAIR ^Roundtime
     put analyze my %tool
     matchwait 20
     goto TOOL_REPAIR

TOOL_GOOD:
     pause 0.01
     gosub PUT put my %tool in my $UC_Container.Crafting
     pause 0.3
     gosub stowing
     unvar tool
     return

TOOL_REPAIR:
     var LAST TOOL_REPAIR
     if ($roomid = 0) then gosub RANDOMMOVE
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVES
     pause 0.4
     if ("$zoneid" = "62") then gosub AUTOMOVE leth
     if ("$zoneid" = "69") then gosub AUTOMOVE shard
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     gosub stowing
     pause 0.2
     gosub AUTOMOVE teller
     put withd 7 plat
     pause 0.5
     pause 0.2
     gosub LEAVE_BANK
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     pause 0.5
     if ("$zoneid" = "1") then gosub AUTOMOVE catrox
     if ("$zoneid" = "30") then gosub AUTOMOVE unspi
     if ("$zoneid" = "42") then gosub AUTOMOVE smithy
     if ("$zoneid" = "66") then gosub AUTOMOVE ylono
     if ("$zoneid" = "116") then gosub AUTOMOVE ylono
     gosub AUTOMOVE ylono
REPAIRING_TOOLS:
     put .repairtools
     waitforre TOOL REPAIR COMPLETE
     gosub AUTOMOVE shard
     ##############################################################################
VAULT_CITY_CHECK:
     if (%Playing = 1) then gosub STOP_PLAY
     if ($UC_VaultSwap = 0) then goto ALCHEMY
     put #parse GOING TO TOWN!
     if matchre("$UC_VaultCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto VAULT_CHECK
     gosub OPEN_CONTAINERS
     pause 0.2
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVES
     gosub VAULT_CITY_GO
#################################
# VAULT CHECK FOR CRAFTING BAG  #
#################################
VAULTING:
VAULT_CHECK:
     if ($UC_VaultSwap = 0) then goto ALCHEMY
     echo
     echo ###################
     echo * RUNNING TO VAULT
     echo * TO SWAP FOR CRAFTING BAG
     echo ###################
     echo
     pause 0.2
     gosub stowing
     pause 0.2
     if contains("$roomname", "Carousel Chamber") then goto VAULT_LOOK
     pause 0.5
     gosub automove vault
     pause 0.5
     if contains("$roomname", "Carousel Desk") then put out
     pause 0.5
     if contains("$roomobjs", "Carousel Square") then put go square
     pause 0.3
     pause 0.1
     if contains("$roomname", "Carousel Desk") then put out
     pause 0.4
     if contains("$roomobjs", "vault") then put go vault
     pause 0.5
     pause 0.4
     put go door
     pause 0.4
     pause 0.3
1_ARCH:
     pause 0.3
     if matchre("$roomname", "Carousel Booth") then goto VAULT_GO
     matchre 1_ARCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre VAULT_GO escorts you|Pull the lever|Carousel Booth
     matchre PAY_VAULT_RENT rent
     matchre 2_ARCH blocks|someone|using|Sorry|halts you
     put go arch
     matchwait
2_ARCH:
     pause 0.3
     if matchre("$roomname", "Carousel Booth") then goto VAULT_GO
     matchre 2_ARCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre VAULT_GO escorts you|Pull the lever|Carousel Booth
     matchre PAY_VAULT_RENT rent
     matchre 3_ARCH blocks|someone|using|Sorry|halts you
     put go second arch
     matchwait
3_ARCH:
     pause 0.3
     if matchre("$roomname", "Carousel Booth") then goto VAULT_GO
     matchre 3_ARCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre VAULT_GO escorts you|Pull the lever|Carousel Booth
     matchre PAY_VAULT_RENT rent
     matchre NO_ARCH blocks|someone|using|Sorry|halts you
     put go third arch
     matchwait
NO_ARCH:
     echo ########################
     echo *** NO ARCH AVAILABLE! PAUSING....
     echo ########################
     pause 22
     goto VAULT_CHECK

PAY_VAULT_RENT:
     pause 0.5
     echo ########################
     echo ** PAYING VAULT RENT
     echo ########################
     pause 0.5
     if ("$zoneid" = "127") then gosub automove hib
     pause 0.4
     if ("$zoneid" = "126") then gosub automove hib
     pause 0.4
     if ("$zoneid" = "127") then gosub automove hib
     pause 0.4
     if ("$zoneid" = "126") then gosub automove hib
     pause 0.2
     gosub automove teller
     pause 0.5
     send withdraw 8 gold
     pause 0.2
     pause 0.2
     pause 0.2
     gosub automove exchange
     pause 0.5
     gosub KRONARS
     pause 0.1
     pause 0.1
     if ("$zoneid" = "67") then gosub automove 138
     if ("$zoneid" = "116") then gosub automove 288
     if ("$zoneid" = "61") then gosub automove 169
     if ("$zoneid" = "47") then gosub automove 273
     if ("$zoneid" = "42") then gosub automove 28
     if ("$zoneid" = "30") then gosub automove 362
     if ("$zoneid" = "1") then gosub automove 188
     if ("$zoneid" = "99") then gosub automove 141
     if ("$zoneid" = "107") then gosub automove 219
     if ("$zoneid" = "90") then gosub automove 261
     if matchre("$UC_VaultCity", "(?i)BOAR") then
          {
               put .travel boar
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "127") then gosub automove 532
     pause 0.5
     if ("$zoneid" = "67") then gosub automove 138
     put pay 5000
     pause 0.5
     pause 0.5
     move out
     pause 0.5
     goto VAULT_CHECK

VAULT_GO:
     pause 0.3
     put pull lever
     pause 0.4
     pause 0.2
     send go door
     pause 0.5
     pause 0.2
     pause 0.1
     send open vault
     pause 0.4
     pause 0.4
VAULT_LOOK:
     gosub stowing
     pause 0.1
     gosub GET $UC_VaultBag
     pause 0.5
     pause 0.2
     pause 0.4
     gosub REMOVE my $UC_Container
     pause 0.5
     pause 0.3
     gosub PUT put my $UC_Container in vault
     pause 0.5
     pause 0.5
     if (matchre("$righthand", "Empty") && matchre("$lefthand", "Empty")) then
          {
               gosub GET $UC_VaultBag from shelf
               pause 0.5
          }
     pause 0.2
     if (matchre("$righthand", "Empty") && matchre("$lefthand", "Empty")) then
          {
               put #echo >Log #fd0800 *** ERROR! CONTAINER NOT FOUND IN VAULT???! - $UC_VaultBag - DOUBLE CHECK VARIABLES
               goto VAULT_LEAVE
          }
     gosub WEAR $UC_VaultBag
     pause 0.4
     send STORE DEFAULT in $UC_VaultBag
     pause 0.1
     pause 0.1
     if (matchre("$righthand", "$UC_Container") || matchre("$lefthand", "$UC_Container")) then
          {
               put #echo >Log #fd0800 *** ERROR! MAIN CONTAINER TOO FULL TO FIT IN VAULT!! CLEAR OUT JUNK!
               echo
               echo ##################################################################
               echo ** ERROR! MAIN CONTAINER TOO FULL TO FIT BACK IN VAULT!! MAKE SOME ROOM!
               echo ** EMPTY SOME JUNK OUT OF YOUR MAIN BAG / VAULT - PROBABLY FULL OF CRAP
               echo ##################################################################
               echo
               exit
          }
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then
          {
               put #echo >Log #fd0800 *** ERROR!!!! VAULT BAG LOCATION DIDN'T MATCH $UC_Container LOCATION!!
               echo ########################################################################
               echo ** ERROR!!!! VAULT BAG LOCATION DIDN'T MATCH $UC_Container LOCATION!!
               echo ** UPDATE SCRIPT VARIABLES - MAKE SURE VAR CONTAINER FITS IN YOUR VAULT
               echo ** AND IS THE EXACT SAME WEAR LOCATION AS YOUR CRAFTING.BAG (BACK or SHOULDER)
               echo ** RESTART SCRIPT WITH - .ubercombat SKIP VAULTING2    - to skip right to this section
               echo ########################################################################
               exit
          }
     pause 0.2
     gosub stowing
     pause 0.5
     put #echo >Log #FF6B33 *** SWAPPED CONTAINERS FOR MASTERCRAFT - $UC_VaultBag
     pause 0.5
     goto VAULT_LEAVE

VAULT_LEAVE:
     echo ###############
     echo * LEAVING VAULT!
     echo ###############
     pause 0.1
     pause 0.1
     put close vault
     wait
     pause 0.4
     pause 0.2
     put go door
     wait
     pause 0.4
     pause 0.3
     put go arch
     wait
     pause 0.5
     pause 0.1
     move out
     pause 0.4
     pause 0.2
     put out
     pause 0.4
     pause 0.2
     goto ALCHEMY
###############################
# ALCHEMY MODULE              #
###############################
MC:
MASTERCRAFT:
ALCHEMY:
     var NEXTSUB ALCHEMY_DONE
     var LAST ALCHEMY
     var CURRENT Alchemy
     gosub STATUSBAR
     gosub TOWNRUN_TIMERS
     gosub clear
     gosub CLEAR_MATCHTABLE
     gosub OPEN $UC_Container.Crafting
     put #parse GOING TO TOWN!
     pause 0.3
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then gosub RESEARCH_CANCEL
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if ("$guild" = "Thief") then gosub KHRI
     if (("$guild" = "Thief") && ($circle > 100)) then gosub KHRI_START serenity sight sensing
     if (("$guild" = "Thief") && ($circle > 150) && ($concentration > 80)) then gosub KHRI_START steady avoidance flight elusion focus
     pause 0.1
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then gosub RESEARCH_CANCEL
     pause 0.3
     if (matchre("%ALCHEMY", "(?i)(NULL|OFF|0)") && matchre("%ENGINEERING", "(?i)(NULL|OFF|0)") && matchre("%FORGING", "(?i)(NULL|OFF|0)") && matchre("%OUTFITTING", "(?i)(NULL|OFF|0)") && matchre("%ENCHANTING", "(?i)(NULL|OFF|0)")) then goto VAULT_CHECK_2

     if ((%Necro.Known = 1) && ("$zoneid" != "150")) then
          {
               echo ################
               echo *** KNOWN AS A NECRO!!!
               echo *** SKIPPING CRAFTING
               echo *** TOO DANGEROUS!!
               echo ################
               pause
               goto VAULT_CHECK_2
          }
     if matchre("$zoneid", "\b(106|114)\b") then goto FORGING
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if ("$zoneid" = "126") then
          {
               gosub AUTOMOVE hibarn
               pause 0.4
               send east
               pause 0.4
          }
#### GET MONEY FOR CRAFTING
     if (%Necro.Known = 0) then
          {
               if ($invisible = 1) then gosub STOP_INVIS
               gosub AUTOMOVE teller
               if (!matchre("%ALCHEMY", "(?i)(NULL|OFF|0)") && !matchre("%ENGINEERING", "(?i)(NULL|OFF|0)") && !matchre("%FORGING", "(?i)(NULL|OFF|0)") && !matchre("%OUTFITTING", "(?i)(NULL|OFF|0)") && !matchre("%ENCHANTING", "(?i)(NULL|OFF|0)")) then put withdraw 4 plat
               else put withdraw 300 silver
               pause 0.5
               put out
               pause 0.5
          }
     if matchre("$zoneid", "\b(40|42|61|99|107|108|112|116|127)\b") then
          {
               if (("$game" = "DRF") || ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then
                    {
                    if ("$zoneid" = "42") then gosub AUTOMOVE gate
                    if ("$zoneid" = "112") then gosub AUTOMOVE leth
                    if ("$zoneid" = "127") then gosub AUTOMOVE south
                    pause 0.2
                    pause 0.2
                    gosub TO_SEACAVE
                    goto ALCHEMY_1
                    }
          echo *** NOT IN AN AREA THAT SUPPORTS THIS TYPE OF CRAFTING - GET FUCKED!
          if matchre("$zoneid", "116|107") then goto FORGING
          else goto VAULT_RETURN
          }
ALCHEMY_1:
     if matchre("%ALCHEMY", "(?i)(NULL|OFF|0)") then goto ENGINEERING
     if matchre("%ALCHEMY", "(?i)(ON|1|YES)") then
          {
               action (footitem) off
               if ($Alchemy.LearningRate > 20) then goto ENGINEERING
               if ($invisible = 1) then gosub STOP_INVIS
               gosub AUTOMOVE ALCHEMY supplies
               if ($UC_Teach = 1) then gosub TEACH_TIMER
               goto ALCHEMY_WAIT
          }
     goto ENGINEERING
ALCHEMY_WAIT:
     var LAST ALCHEMY_WAIT
     put .mastercraft
     waitforre ^MASTERCRAFT DONE|^YOU HAVE BEEN
     if matchre("$righthand", "(logbook|codex|book)") && !matchre("$UC_Container.Crafting", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put $righthandnoun in my $UC_Container.Crafting
     if matchre("$lefthand", "(logbook|codex|book)") && !matchre("$UC_Container.Crafting", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put $lefthandnoun in my $UC_Container.Crafting
     goto ALCHEMY_DONE
     action (footitem) on
ALCHEMY_DONE:
     put #script abort mastercraft
     pause 0.2
     put #echo >Log #7FFFD4 *** Trained ALCHEMY - $Alchemy.Ranks $Alchemy.LearningRate / 34 ****
     if !matchre("$righthand", "Empty") then gosub PUT_IT $righthand in my $UC_Container.Crafting
     if ("$UC_leftthand" != "Empty") then gosub PUT_IT $lefthand in my $UC_Container.Crafting
     pause 0.5
##############################
# ENGINEERING MODULE
##############################
ENGINEERING:
     var NEXTSUB OUTFITTING
     var LAST ENGINEERING
     var CURRENT Engineering
     gosub STATUSBAR
     pause 0.1
     if matchre("$scriptlist" , "remedy\.cmd") then put #script abort remedy
     gosub TOWNRUN_TIMERS
     gosub clear
     gosub CLEAR_MATCHTABLE
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then gosub RESEARCH_CANCEL
     pause 0.3
     if ("$guild" = "Thief") then gosub KHRI
     if (("$guild" = "Thief") && ($circle > 100)) then gosub KHRI_START serenity sight sensing
     if (("$guild" = "Thief") && ($circle > 150) && ($concentration > 80)) then gosub KHRI_START steady avoidance flight elusion focus
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if matchre("$zoneid", "\b(40|42|61|99|106|107|108|112|114|127)\b") then
          {
               if (("$game" = "DRF") || ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then
                    {
                    if ("$zoneid" = "42") then gosub AUTOMOVE gate
                    if ("$zoneid" = "112") then gosub AUTOMOVE leth
                    if ("$zoneid" = "127") then gosub AUTOMOVE south
                    pause 0.2
                    pause 0.2
                    gosub TO_SEACAVE
                    goto ENGINEERING_1
                    }
          echo *** NOT IN AN AREA THAT SUPPORTS THIS TYPE OF CRAFTING - GET FUCKED!
          if matchre("$zoneid", "116|107") then goto FORGING
          else goto VAULT_RETURN
          }
ENGINEERING_1:
     if matchre("%ENGINEERING", "(?i)(NULL|OFF|0)") then goto OUTFITTING
     if matchre("%ENGINEERING", "(?i)(ON|1|YES)") then
          {
          if $Engineering.LearningRate > 20 then goto OUTFITTING
          action (footitem) off
          if ($invisible = 1) then gosub STOP_INVIS
          gosub AUTOMOVE ENGINEERING supplies
          if ($UC_Teach = 1) then gosub TEACH_TIMER
          goto ENGINEERING_WAIT
          }
     goto OUTFITTING
ENGINEERING_WAIT:
     var LAST ENGINEERING_WAIT
     put .mastercraft
     waitforre ^MASTERCRAFT DONE|^YOU HAVE BEEN
     if matchre("$righthand", "(logbook|codex|book)") && !matchre("$UC_Container.Crafting", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put $righthandnoun in my $UC_Container.Crafting
     if matchre("$lefthand", "(logbook|codex|book)") && !matchre("$UC_Container.Crafting", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put $lefthandnoun in my $UC_Container.Crafting
     if (%Necro.Known = 1) then goto ENGINEERING_DONE
     action (footitem) on
     goto ENGINEERING_DONE
ENGINEERING_DONE:
     var LAST ENGINEERING_DONE
     if ($roomid = 0) then gosub RANDOMMOVE
     if ($roomid = 0) then gosub RANDOMMOVE
     pause 0.1
     put #echo >Log #7FFFD4 *** Trained ENGINEERING - $Engineering.Ranks $Engineering.LearningRate / 34 ****
     pause 0.5
##############################
# OUTFITTING MODULE
##############################
OUTFITTING:
     var NEXTSUB FORGING
     var LAST OUTFITTING
     var CURRENT Outfitting
     gosub STATUSBAR
     pause 0.5
     ####
     gosub TOWNRUN_TIMERS
     ####
     gosub clear
     gosub CLEAR_MATCHTABLE
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then gosub RESEARCH_CANCEL
     pause 0.3
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if matchre("$zoneid", "\b(40|42|61|99|106|107|108|112|114|127)\b") then
          {
               if (("$game" = "DRF") || ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then
                    {
                         if ("$zoneid" = "42") then gosub AUTOMOVE gate
                         if ("$zoneid" = "112") then gosub AUTOMOVE leth
                         if ("$zoneid" = "127") then gosub AUTOMOVE south
                         pause 0.2
                         pause 0.2
                         gosub TO_SEACAVE
                         goto OUTFITTING_1
                    }
          echo *** NOT IN AN AREA THAT SUPPORTS THIS TYPE OF CRAFTING - GET FUCKED!
          if matchre("$zoneid", "116|107") then goto FORGING
          goto VAULT_RETURN
          }
OUTFITTING_1:
     if matchre("%OUTFITTING", "(?i)(NULL|OFF|0)") then goto FORGING
     if matchre("%OUTFITTING", "(?i)(ON|1|YES)") then
          {
               if $Outfitting.LearningRate > 20 then goto FORGING
               action (footitem) off
               if ($invisible = 1) then gosub STOP_INVIS
               gosub AUTOMOVE OUTFITTING supplies
               if ($UC_Teach = 1) then gosub TEACH_TIMER
               goto OUTFITTING_WAIT
          }
     goto FORGING
OUTFITTING_WAIT:
     var LAST OUTFITTING_WAIT
     put .mastercraft
     waitforre ^MASTERCRAFT DONE|^YOU HAVE BEEN
     if matchre("$righthand", "(logbook|codex|book)") && !matchre("$UC_Container.Crafting", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put $righthandnoun in my $UC_Container.Crafting
     if matchre("$lefthand", "(logbook|codex|book)") && !matchre("$UC_Container.Crafting", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put $lefthandnoun in my $UC_Container.Crafting
     if (%Necro.Known = 1) then goto OUTFITTING_DONE
     action (footitem) on
     gosub stowing
     
OUTFITTING_DONE:
     put #echo >Log #7FFFD4 *** Trained OUTFITTING - $Outfitting.Ranks $Outfitting.LearningRate / 34 ****
##############################
# FORGING MODULE
##############################
FORGING:
     var NEXTSUB ENCHANTING
     var LAST FORGING
     var CURRENT Forging
     gosub STATUSBAR
     pause 0.5
     ####
     gosub TOWNRUN_TIMERS
     ####
     gosub clear
     gosub CLEAR_MATCHTABLE
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then gosub RESEARCH_CANCEL
     pause 0.3
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if matchre("$zoneid", "\b(40|42|99|106|108|112|114|127)\b") then
          {
               if (("$zoneid" = "61") && ($UC_Premium = 1)) then goto FORGING_1
               if (("$game" = "DRF") || ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then
                    {
                         if ("$zoneid" = "42") then gosub AUTOMOVE gate
                         if ("$zoneid" = "112") then gosub AUTOMOVE leth
                         if ("$zoneid" = "127") then gosub AUTOMOVE south
                         pause 0.2
                         pause 0.2
                         gosub TO_SEACAVE
                         goto FORGING_1
                    }
          echo *** NOT IN AN AREA THAT SUPPORTS THIS TYPE OF CRAFTING - GET FUCKED!
          goto VAULT_RETURN
          }
FORGING_1:
     if matchre("%FORGING", "(?i)(NULL|OFF|0)") then goto ENCHANTING
     if matchre("%FORGING", "(?i)(ON|1|YES)") then
          {
          if $Forging.LearningRate > 20 then goto ENCHANTING
          action (footitem) off
               pause 0.2
               if ($invisible = 1) then gosub STOP_INVIS
               gosub AUTOMOVE FORGING supplies
               pause 0.2
               goto FORGING_WAIT
          }
     goto ENCHANTING
FORGING_WAIT:
     var LAST FORGING_WAIT
     put .mastercraft
     waitforre ^MASTERCRAFT DONE|^YOU HAVE BEEN
     if matchre("$righthand", "(logbook|codex|book)") && !matchre("$UC_Container.Crafting", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put $righthandnoun in my $UC_Container.Crafting
     if matchre("$lefthand", "(logbook|codex|book)") && !matchre("$UC_Container.Crafting", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put $lefthandnoun in my $UC_Container.Crafting

     if (%Necro.Known = 1) then goto FORGING_DONE
     if ($zoneid = 7) then gosub AUTOMOVE cross
     if ($zoneid = 7) then gosub AUTOMOVE cross
     action (footitem) on

FORGING_DONE:
     put #echo >Log #7FFFD4 *** Trained FORGING - $Forging.Ranks $Forging.LearningRate / 34 ****
     goto ENCHANTING
##############################
# ENCHANTING MODULE
##############################
ENCHANTING:
     var NEXTSUB VAULTING2
     var LAST ENCHANTING
     var CURRENT Enchanting
     gosub STATUSBAR
     pause 0.1
     ####
     gosub TOWNRUN_TIMERS
     ####
     gosub clear
     gosub CLEAR_MATCHTABLE
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then gosub RESEARCH_CANCEL
     pause 0.3
     if ($zoneid = 7) then gosub AUTOMOVE cross
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 50)) then gosub CHARGE_ORB %OM.Mana
          }
     if matchre("$zoneid", "\b(40|42|61|99|106|107|108|112|114|127)\b") then
          {
               if (("$game" = "DRF") || ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then
                    {
                         if ("$zoneid" = "42") then gosub AUTOMOVE gate
                         if ("$zoneid" = "112") then gosub AUTOMOVE leth
                         if ("$zoneid" = "127") then gosub AUTOMOVE south
                         pause 0.2
                         pause 0.2
                         gosub TO_SEACAVE
                         goto ENCHANTING_1
                    }
          echo *** NOT IN AN AREA THAT SUPPORTS THIS TYPE OF CRAFTING - GET FUCKED!
          goto VAULT_CHECK_2
          }
ENCHANTING_1:
     if matchre("%ENCHANTING", "(?i)(NULL|OFF|0)") then goto VAULT_CHECK_2
     if matchre("%ENCHANTING", "(?i)(ON|1|YES)") then
          {
               if ($Enchanting.LearningRate > 20) then goto ENCHANTING_DONE
               action (footitem) off
               if ($invisible = 1) then gosub STOP_INVIS
               gosub AUTOMOVE ENCHANTING supplies
               if ($UC_Teach = 1) then gosub TEACH_TIMER
               goto ENCHANTING_WAIT
          }
     goto VAULT_RETURN
ENCHANTING_WAIT:
     var LAST ENCHANTING_WAIT
     put .mastercraft
     waitforre ^MASTERCRAFT DONE|^YOU HAVE BEEN
     if matchre("$righthand", "(logbook|codex|book)") && !matchre("$UC_Container.Crafting", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put $righthandnoun in my $UC_Container.Crafting
     if matchre("$lefthand", "(logbook|codex|book)") && !matchre("$UC_Container.Crafting", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put $lefthandnoun in my $UC_Container.Crafting
     action (footitem) on
     gosub stowing
ENCHANTING_DONE:
     put #echo >Log #7FFFD4 *** Trained ENCHANTING - $Enchanting.Ranks $Enchanting.LearningRate / 34 ****
#################################
# VAULT CHECK FOR CRAFTING BAG 2 #
#################################
VAULTING2:
VAULT_CHECK_2:
VAULT_RETURN:
     action (debt) on
     #### LEAVE CRAFTING AREAS FIRST
     if ($invisible = 1) then gosub STOP_INVIS
     if matchre("$scriptlist" , "disarm\.cmd") then put #script abort disarm
     if matchre("$scriptlist" , "braid\.cmd") then put #script abort braid
     if matchre("$scriptlist" , "climbcross\.cmd") then put #script abort climbcross
     if matchre("$scriptlist" , "steal\.cmd") then put #script abort steal
     if matchre("$scriptlist" , "climb\.cmd") then put #script abort climb
     if matchre("$scriptlist" , "automapper\.cmd") then put #script abort automapper
     if matchre("$scriptlist" , "burgle\.cmd") then put #script abort burgle
     if matchre("$scriptlist" , "travel\.cmd") then put #script abort travel
     if matchre("$scriptlist" , "mastercraft\.cmd") then put #script abort mastercraft
     if matchre("$scriptlist" , "MC_Carve\.cmd") then put #script abort MC_Carve
     if matchre("$scriptlist" , "MC_Enchant\.cmd") then put #script abort MC_Enchant
     if matchre("$scriptlist" , "MC_Grind\.cmd") then put #script abort MC_Grind
     if matchre("$scriptlist" , "MC_Knit\.cmd") then put #script abort MC_Knit
     if matchre("$scriptlist" , "MC_Mix\.cmd") then put #script abort MC_Mix
     if matchre("$scriptlist" , "MC_Pound\.cmd") then put #script abort MC_Pound
     if matchre("$scriptlist" , "MC_Setup\.cmd") then put #script abort MC_Setup
     if matchre("$scriptlist" , "MC_Sew\.cmd") then put #script abort MC_Sew
     if matchre("$scriptlist" , "MC_Shape\.cmd") then put #script abort MC_Shape
     if matchre("$scriptlist" , "MC_Smelt\.cmd") then put #script abort MC_Smelt
     if matchre("$scriptlist" , "MC_Spin\.cmd") then put #script abort MC_Spin
     if matchre("$scriptlist" , "MC_Tinker\.cmd") then put #script abort MC_Tinker
     if matchre("$scriptlist" , "MC_Weave\.cmd") then put #script abort MC_Weave
     pause 0.001
     if ("$zoneid" = "1") then gosub AUTOMOVE 17
     if ("$zoneid" = "30") then gosub AUTOMOVE 67
     if ("$zoneid" = "47") then gosub AUTOMOVE 47
     if ("$zoneid" = "67") then gosub AUTOMOVE 44
     if ("$zoneid" = "112") then gosub AUTOMOVE 100
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if (%Necro.Known = 1) then goto VAULTING22
     gosub AUTOMOVE teller
     put deposit all
     pause 0.5
     pause 0.3
     action (debt) off
     gosub LEAVE_BANK
VAULTING22:
     if ($UC_VaultSwap = 0) then goto STEALING_RUN
     echo
     echo ########################
     echo * RUNNING TO VAULT
     echo * TO SWAP BACK TO MAIN CONTAINER
     echo ########################
     echo
     pause 0.2
     gosub stowing
     pause 0.2
     if contains("$roomname", "Carousel Chamber") then goto VAULT2_LOOK
     pause 0.5
     gosub automove vault
     pause 0.5
     if contains("$roomname", "Carousel Desk") then put out
     pause 0.5
     if contains("$roomobjs", "Carousel Square") then put go square
     pause 0.3
     pause 0.1
     if contains("$roomname", "Carousel Desk") then put out
     pause 0.4
     if contains("$roomobjs", "vault") then put go vault
     pause 0.5
     pause 0.4
     put go door
     pause 0.4
     pause 0.3
VAULT2:
     pause 0.3
     if matchre("$roomname", "Carousel Booth") then goto VAULT2_GO
     matchre VAULT2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre VAULT2_GO escorts you|Pull the lever|Carousel Booth
     matchre PAY_VAULT2_RENT rent
     matchre 22_ARCH blocks|someone|using|Sorry|halts you
     put go arch
     matchwait
22_ARCH:
     pause 0.3
     if matchre("$roomname", "Carousel Booth") then goto VAULT2_GO
     matchre 22_ARCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre VAULT2_GO escorts you|Pull the lever|Carousel Booth
     matchre PAY_VAULT2_RENT rent
     matchre 33_ARCH blocks|someone|using|Sorry|halts you
     put go second arch
     matchwait
33_ARCH:
     pause 0.3
     if matchre("$roomname", "Carousel Booth") then goto VAULT2_GO
     matchre 33_ARCH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre VAULT2_GO escorts you|Pull the lever|Carousel Booth
     matchre PAY_VAULT2_RENT rent
     matchre NO_ARCH2 blocks|someone|using|Sorry|halts you
     put go third arch
     matchwait
NO_ARCH2:
     echo #############################
     echo *** NO ARCH AVAILABLE! PAUSING....
     echo #############################
     pause 22
     goto VAULT2

PAY_VAULT2_RENT:
     pause 0.5
     echo #####################
     echo ** PAYING VAULT RENT
     echo #####################
     pause 0.5
     gosub automove teller
     pause 0.5
     send withdraw 8 gold
     pause 0.2
     pause 0.2
     pause 0.2
     gosub automove exchange
     pause 0.5
     gosub KRONARS
     pause 0.1
     pause 0.1
     if ("$zoneid" = "67") then gosub automove 138
     if ("$zoneid" = "116") then gosub automove 288
     if ("$zoneid" = "61") then gosub automove 169
     if ("$zoneid" = "47") then gosub automove 273
     if ("$zoneid" = "42") then gosub automove 28
     if ("$zoneid" = "30") then gosub automove 362
     if ("$zoneid" = "1") then gosub automove 188
     if ("$zoneid" = "99") then gosub automove 141
     if ("$zoneid" = "107") then gosub automove 219
     if ("$zoneid" = "90") then gosub automove 261
     if ("$zoneid" = "127") then gosub automove 532
     pause 0.5
     put pay 5000
     pause 0.5
     pause 0.5
     move out
     pause 0.5
     goto VAULT2

VAULT2_GO:
     pause 0.3
     put pull lever
     pause 0.4
     pause 0.2
     send go door
     pause 0.5
     pause 0.2
     pause 0.1
     send open vault
     pause 0.4
     pause 0.4

VAULT2_LOOK:
     pause 0.4
     gosub REMOVE $UC_VaultBag
     pause 0.5
     pause 0.3
     gosub GET $UC_Container from vault
     pause 0.4
     pause 0.2
     gosub PUT put my $UC_VaultBag in vault
     pause 0.5
     if (matchre("$righthand", "Empty") && matchre("$lefthand", "Empty")) then
          {
               gosub GET $UC_Container from shelf
               pause 0.5
          }
     pause 0.2
     if (matchre("$righthand", "Empty") && matchre("$lefthand", "Empty")) then
          {
               put #echo >Log #fd0800 *** ERROR! CONTAINER NOT FOUND IN VAULT???! - $UC_Container - DOUBLE CHECK VARIABLES
               goto VAULT2_LEAVE
          }
     gosub WEAR $UC_Container
     pause 0.4
     send STORE DEFAULT in $UC_Container
     pause 0.1
     pause 0.1
     if (matchre("$righthand", "$UC_VaultBag") || matchre("$lefthand", "$UC_VaultBag")) then
          {
               put #echo >Log #fd0800 *** ERROR! CRAFTING BAG TOO FULL TO FIT BACK IN VAULT!! CLEAR OUT JUNK!
               echo
               echo ##################################################################
               echo ** ERROR! CRAFTING BAG TOO FULL TO FIT BACK IN VAULT!! MAKE SOME ROOM!
               echo ** EMPTY SOME JUNK OUT OF YOUR CRAFTING BAG - PROBABLY FULL OF CRAP
               echo ##################################################################
               echo
               exit
          }
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then
          {
               put #echo >Log #fd0800 *** ERROR!!!! VAULT BAG LOCATION DIDN'T MATCH $UC_Container LOCATION!!
               echo ########################################################################
               echo ** ERROR!!!! VAULT BAG LOCATION DIDN'T MATCH $UC_Container LOCATION!!
               echo ** UPDATE SCRIPT VARIABLES - MAKE SURE VAR CONTAINER FITS IN YOUR VAULT
               echo ** AND IS THE EXACT SAME WEAR LOCATION AS YOUR CRAFTING.BAG (BACK or SHOULDER)
               echo ** RESTART SCRIPT WITH - .ubercombat SKIP VAULTING2    - to skip right to this section
               echo ########################################################################
               exit
          }
     gosub stowing
     pause 0.5
     pause 0.2
     put #echo >Log #FF6B33 *** SWAPPED CONTAINERS BACK TO MAIN - $UC_Container
     pause 0.5
     goto VAULT2_LEAVE

VAULT2_LEAVE:
     echo ################
     echo * LEAVING VAULT!
     echo ################
     pause 0.1
     pause 0.1
     put close vault
     wait
     pause 0.4
     pause 0.2
     put go door
     wait
     pause 0.4
     pause 0.3
     put go arch
     wait
     pause 0.5
     pause 0.1
     move out
     pause 0.4
     pause 0.2
     put out
     pause 0.4
     pause 0.2
     if (%precheck = 1) then return
     goto STEALING_RUN
########################################################################
#### STEAL MODULE
STEALING:
STEALING_RUN:
STEALING.RUN:
     var NEXTSUB DONE_STEAL
     var LAST DONE_STEAL
     var CURRENT Thievery
     gosub STATUSBAR
     gosub stowing
     if matchre("$scriptlist" , "disarm\.cmd") then put #script abort disarm
     if matchre("$scriptlist" , "braid\.cmd") then put #script abort braid
     if matchre("$scriptlist" , "climbcross\.cmd") then put #script abort climbcross
     if matchre("$scriptlist" , "steal\.cmd") then put #script abort steal
     if matchre("$scriptlist" , "climb\.cmd") then put #script abort climb
     if matchre("$scriptlist" , "automapper\.cmd") then put #script abort automapper
     if matchre("$scriptlist" , "burgle\.cmd") then put #script abort burgle
     if matchre("$scriptlist" , "travel\.cmd") then put #script abort travel
     if matchre("$scriptlist" , "mastercraft\.cmd") then put #script abort mastercraft
     if matchre("$scriptlist" , "MC_Carve\.cmd") then put #script abort MC_Carve
     if matchre("$scriptlist" , "MC_Enchant\.cmd") then put #script abort MC_Enchant
     if matchre("$scriptlist" , "MC_Grind\.cmd") then put #script abort MC_Grind
     if matchre("$scriptlist" , "MC_Knit\.cmd") then put #script abort MC_Knit
     if matchre("$scriptlist" , "MC_Mix\.cmd") then put #script abort MC_Mix
     if matchre("$scriptlist" , "MC_Pound\.cmd") then put #script abort MC_Pound
     if matchre("$scriptlist" , "MC_Setup\.cmd") then put #script abort MC_Setup
     if matchre("$scriptlist" , "MC_Sew\.cmd") then put #script abort MC_Sew
     if matchre("$scriptlist" , "MC_Shape\.cmd") then put #script abort MC_Shape
     if matchre("$scriptlist" , "MC_Smelt\.cmd") then put #script abort MC_Smelt
     if matchre("$scriptlist" , "MC_Spin\.cmd") then put #script abort MC_Spin
     if matchre("$scriptlist" , "MC_Tinker\.cmd") then put #script abort MC_Tinker
     if matchre("$scriptlist" , "MC_Weave\.cmd") then put #script abort MC_Weave
     if ($out) then gosub MOVE out
     if ($out) then gosub MOVE out
     ####
     gosub TOWNRUN_TIMERS
     ####
     if ($SpellTimer.ShieldofLight.active = 1) then gosub RELEASE SOL
     # if ("$guild" = "Necromancer") then
          # {
               # gosub JUSTICE_TIMER
               # if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          # }
     pause 0.2
     if ("$guild" = "Paladin") then goto DONE_STEAL
     if ($Thievery.LearningRate > 34) then goto DONE_STEAL
     if ($UC_Stealing = 1) then goto STEAL
     if ($UC_Stealing = 0) then goto DONE_STEAL
     goto BURGLE_2
STEAL:
     var LAST DONE_STEAL
     pause 0.1
     echo ################
     echo * STEALING RUN!
     echo ################
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "62") then gosub AUTOMOVE leth
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "126") then
          {
               gosub AUTOMOVE hibarn
               pause 0.4
               send east
               pause 0.4
          }
WAITFORSTEAL:
     if (%Playing = 1) then gosub STOP_PLAY
     gosub clear
     gosub CLEAR_MATCHTABLE
     pause 0.1
     action (jail) off
     matchre DONE_STEAL STEALING DONE\!|DONE STEALING\!|STEALING DONE|STEAL DONE|STEALING LOCKED
     put .steal
     matchwait 2200
     goto DONE_STEAL
CALC_STEAL:
     pause 0.2
     var TempProfit $UC_Profit
     math TempProfit add $UC_StealingProfit
     put #var UC_Profit %TempProfit
DONE_STEAL:
     if matchre("$scriptlist" , "steal\.cmd") then put #script abort steal
     if matchre("$scriptlist" , "jail\.cmd") then put #script abort jail
     action (jail) on
     pause 0.2
     pause 0.2
     gosub stowing
     # debug 5
#########################################################################################################################################
###############################
# MAGICAL RESEARCH DEDICATED
###############################
MAGIC_RESEARCH:
MAGIC.RESEARCH:
MAGICRESEARCH:
MAGICALRESEARCH:
     var LAST MAGICALRESEARCH
     var SAVED MAGICALRESEARCH
     var NEXTSUB MAGIC_RESEARCH_TRAINING_DONE
     gosub clear
     gosub CLEAR_MATCHTABLE
     pause 0.0001
     action (dead) on
     action (escape) on
     if !matchre("%abbrevs", "(?i)GAF") then goto CUSTOM_CHECK
     if ($UC_MagicalResearch = 0) then goto CUSTOM_CHECK
     gosub TOWNRUN_TIMERS
     echo
     echo ###########################
     echo # Dedicated Magical Research Training
     echo ###########################
     echo
     pause 0.2
     if (%Playing = 1) then gosub STOP_PLAY
     #### TF OR PREMIUM AND FC ON - GO TO FANG COVE
     if ((matchre("$game", "(DRF|DRX)") && matchre("%FANGCOVE", "(?i)ON")) || (($UC_Premium = 1) && ("%FANGCOVE" = "ON"))) then
          {
               if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
                    {
                         gosub TO_SEACAVES
                         if (($Athletics.Ranks > 45) && ("$game" != "DRF")) then gosub AUTOMOVE 45
                         if (($roomid != 85) && ("$game" = "DRF")) then gosub AUTOMOVE 85
                         goto MAGIC_RESEARCH_GO
                    }
          }
     ### HOME CITY CHECK
     if !matchre("$UC_HomeCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub HOME_CITY_GO
               goto MAGIC_RESEARCH_GO
          }
     #### IF RANGER OR NECRO KNOWN - LEAVE TOWN
     if matchre("$guild", "(Ranger|Necromancer)") then
          {
               if (("$zoneid" = "1") && ("$guild" = "Necromancer")) then
                    {
                         gosub AUTOMOVE NE gate
                         gosub AUTOMOVE 558
                    }
               if (("$zoneid" = "1") && ("$guild" = "Ranger")) then gosub AUTOMOVE 587
               if ("$zoneid" = "116") then
                    {
                         gosub AUTOMOVE boar
                         gosub AUTOMOVE 45
                    }
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "61") then
                    {
                         gosub AUTOMOVE shard
                         gosub AUTOMOVE 116
                    }
               if ("$zoneid" = "30") then
                    {
                         gosub AUTOMOVE e gate
                         gosub AUTOMOVE 78
                    }
               if (("$zoneid" = "31") && ($roomid != 102)) then gosub AUTOMOVE 102
               if (("$zoneid" = "47") && ($roomid != 401)) then gosub AUTOMOVE 401
               if ("$zoneid" = "42") then
                    {
                         gosub AUTOMOVE gate
                         gosub AUTOMOVE 222
                    }
               if (("$zoneid" = "90") && ($roomid != 42)) then gosub AUTOMOVE 42
               if ("$zoneid" = "99") then
                    {
                         gosub AUTOMOVE west
                         gosub AUTOMOVE 53
                    }
               if (("$zoneid" = "107") && ($roomid != 12)) then gosub AUTOMOVE 12
               if (("$zoneid" = "62") && ($roomid != 116)) then gosub AUTOMOVE 116
               if (("$zoneid" = "66") && ($roomid != 640)) then gosub AUTOMOVE 640
               if (("$zoneid" = "123") && ($roomid != 167)) then gosub AUTOMOVE 167
               if (("$zoneid" = "126") && ($roomid != 45)) then gosub AUTOMOVE 45
               if (("$zoneid" = "127") && ($roomid != 39)) then gosub AUTOMOVE 39
               if (("$zoneid" = "150") && ($roomid != 45) && ($Athletics.Ranks > 45)) then gosub AUTOMOVE 45
               goto MAGIC_RESEARCH_GO
          }
     #### NON RANGERS / NON-PREMIUM
     if ("$zoneid" = "1") then
          {
               echo *** CHOOSING RANDOM ROOM (1 out of 7 locations)
               random 1 7
               echo ** %r
               pause 0.3
               if (%r = 1) then gosub AUTOMOVE willow
               if (%r = 2) then gosub AUTOMOVE midton
               if (%r = 3) then gosub AUTOMOVE 661
               if (%r = 4) then gosub AUTOMOVE 327
               if (%r = 5) then gosub AUTOMOVE pond
               if (%r = 6) then gosub AUTOMOVE 331
               if (%r = 7) then gosub AUTOMOVE crofton
          }
     if (("$zoneid" = "30") && ($roomid != 243)) then gosub AUTOMOVE 243
     if (("$zoneid" = "31") && ($roomid != 101)) then gosub AUTOMOVE 101
     if (("$zoneid" = "42") && ($roomid != 3)) then gosub AUTOMOVE 3
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if ("$zoneid" = "61") then
          {
               echo *** CHOOSING RANDOM ROOM (1 out of 3 locations)
               random 1 3
               echo ** %r
               pause 0.3
               if (%r = 1) then gosub AUTOMOVE pool
               if (%r = 2) then gosub AUTOMOVE 119
               if (%r = 3) then gosub AUTOMOVE 216
          }
     if (("$zoneid" = "62") && ($roomid != 116)) then gosub AUTOMOVE 116
     if (("$zoneid" = "66") && ($roomid != 639)) then gosub AUTOMOVE 639
     if (("$zoneid" = "67") && ($roomid != 154)) then gosub AUTOMOVE 154
     if (("$zoneid" = "90") && ($roomid != 42)) then gosub AUTOMOVE 42
     if (("$zoneid" = "99") && ($roomid != 91)) then gosub AUTOMOVE 91
     if (("$zoneid" = "107") && ($roomid != 58)) then gosub AUTOMOVE 58
     if (("$zoneid" = "116") && ($roomid != 96)) then gosub AUTOMOVE 96
     if (("$zoneid" = "127") && ($roomid != 33)) then gosub AUTOMOVE 33
     ###########
     if (("$zoneid" = "150") && ($roomid != 45) && ($Athletics.Ranks > 45)) then gosub AUTOMOVE 45
     pause 0.2
###############################
# MAGIC RESEARCH LOOP
###############################
MAGIC_RESEARCH_GO:
     var SAVED MAGIC_RESEARCH
     var LAST MAGIC_RESEARCH_GO
     var NEXTSUB MAGICRESEARCHDONE
     var CURRENT Magical Research
     var healthwalk 0
     gosub STATUSBAR
     action (research) on
     gosub clear
     gosub CLEAR_MATCHTABLE
     gosub RESEARCH_STOP
     var Research.Active 0
     var Research.Inactive 0
     var breakthroughcount 0
     echo
     echo #############################
     echo ## ~~~ DEDICATED MAGICAL RESEARCH ~~~
     echo ## TRAINING FOR 15-30 MINUTES
     echo ## DEPENDING ON TYPE TRAINED
     echo ## AIMING FOR 2-3 BREAKTHROUGHS
     echo #############################
     echo
     pause 0.2
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 75)) then gosub CHARGE_ORB %OM.Mana
          }
     var researchloop 0
     action math researchloop add 1;-0.05 goto MAGIC_RESEARCH_TRAINING when Breakthrough\!|^You have abandoned your research project|^You make definite progress in your .+ and decide to take a break|^You decide to stop researching
     pause 0.2
MAGIC_RESEARCH_TRAINING:
     gosub HEALTH_CHECK
     if ($needHealing = 1) then goto ESCAPE_HEAL
     #if ((%researchloop > 35) && (%breakthroughcount = 3)) then goto MAGIC_RESEARCH_TRAINING_DONE
     if ((%researchloop > 34) && (%breakthroughcount > 4)) then goto MAGIC_RESEARCH_TRAINING_DONE
     if (%researchloop > 42) then goto MAGIC_RESEARCH_TRAINING_DONE
     gosub MAGICAL_RESEARCH
     gosub PERCEIVE_TIMER
     if ($UC_Crystal = 1) then gosub CRYSTAL_TIMER
     echo
     echo #########################
     echo *** MAGICAL RESEARCH TRAINING ACTIVE
     echo *** RESEARCH TYPE: %RESEARCH
     echo #########################
     echo
     if ($Outdoorsmanship.LearningRate < 34) then put collect rock
     pause 15
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     if ($Outdoorsmanship.LearningRate < 34) then put collect rock
     pause 15
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     echo
     echo ##########################
     echo *** MAGICAL RESEARCH TRAINING ACTIVE
     echo *** RESEARCH TYPE: %RESEARCH
     echo *** LOOPS: %researchloop / 42(max)
     echo *** BREAKTHROUGHS: %breakthroughcount
     echo *** Active Research: %Research.Active
     echo *** Research Inactive: %Research.Inactive
     echo ##########################
     echo
     pause 0.2
     if ($UC_Crystal = 1) then gosub CRYSTAL_TIMER
     pause 0.1
     if matchre("%APP.ITEMS", "(?i)(ON|1|YES)") then
          {
               if !matchre("%app1", "(?i)(NULL|OFF|^%|^\s*$)") then put app my %app1 careful
               pause
               pause 0.7
               if !matchre("%app2", "(?i)(NULL|OFF|^%|^\s*$)") then put app my %app2
               pause
               pause 0.7
               if !matchre("%app3", "(?i)(NULL|OFF|^%|^\s*$)") then put app my %app3
          }
     if !matchre("%APP.ITEMS", "(?i)(ON|1|YES)") then
          {
               if ($Outdoorsmanship.LearningRate < 34) then put collect rock
               pause 15
               if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
               if ($Outdoorsmanship.LearningRate < 34) then put collect rock
               pause 15
          }
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     math researchloop add 1
     if (%researchloop > 42) then goto MAGIC_RESEARCH_TRAINING_DONE
     goto MAGIC_RESEARCH_TRAINING

MAGICRESEARCHDONE:
MAGIC_RESEARCH_TRAINING_DONE:
     echo
     echo ################
     echo ## MAGICAL RESEARCH
     echo ## TRAINING COMPLETE!
     echo ##
     echo ## %researchloop RESEARCH LOOPS
     echo ## %breakthroughcount BREATHROUGHS
     echo ################
     echo
     put #echo >Log #7FFFD4 *** Trained Magical Research - %breakthroughcount breakthroughs
     var healthwalk 1
     pause 0.1
     put exp magic
     pause
     pause 0.4
     var breakthroughcount 0
     if (%Research.Active = 1) then gosub RESEARCH_STOP
     action (research) off
     gosub HEALTH_CHECK
     if ($needHealing = 1) then
          {
               echo
               echo ###############
               echo ** GETTING HEALED!!
               echo ###############
               echo
               var SAVED CUSTOMCHECK
               goto TOWN_SEARCH
          }
###############################
# CUSTOM SCRIPT RUN
###############################
CUSTOM_CHECK:
CUSTOMCHECK:
     pause 0.0001
     var healthwalk 1
     var NEXTSUB BURGLE2
     var LAST CUSTOMCHECK
     var SAVED CUSTOMCHECK
     var CURRENT Custom Script
     gosub STATUSBAR
     if matchre("%Custom.Script", "(?i)(OFF|NULL)") then goto BURGLE2
     gosub TOWNRUN_TIMERS
     echo
     echo ##########################
     echo **** RUNNING USER CUSTOM SCRIPT!
     echo *** Scriptname: %Custom.Script
     echo *** WILL AUTO-CONTINUE/TIMEOUT AFTER: 9000 SECONDS (2.5 hours)
     echo *** OR WHEN WE SEE THE #PARSE SCRIPT FINISHED!
     echo ##########################
     echo
     pause
     gosub stowing
     ### HOME CITY CHECK
     if !matchre("$UC_HomeCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub HOME_CITY_GO
CUSTOM_GO:
     var LAST CUSTOM_GO
     gosub clear
     gosub CLEAR_MATCHTABLE
     pause 0.001
     matchre CUSTOM_DONE ^SCRIPT FINISHED\!|^BURGLE FINISHED\!|^SCRIPT COMPLETE\!|^SCRIPT DONE\!
     put .%Custom.Script.cmd
     matchwait 9000
CUSTOM_DONE:
     pause 0.2
     pause 0.001
     pause 0.001
     put #script abort %Custom.Script
     put #echo >Log #7FFFD4 **** Custom Script complete!
     echo
     echo #######################
     echo *** DONE CUSTOM SCRIPT! (%Custom.Script)
     echo #######################
     echo
     pause 0.1
     goto BURGLE2
###############################
# BURGLING RUN 2
###############################
BURGLE_2:
BURGLE2:
     var NEXTSUB DONE_BURGLE_2
     var LAST BURGLE_2
     var CURRENT Burgling
     var SAVED BURGLE_2
     var firstlaunch 0
     var townRun 0
     gosub STATUSBAR
     action (jail) on
     ####
     if ($invisible = 1) then gosub STOP_INVIS
     gosub TOWNRUN_TIMERS
     ####
     if (($Thievery.Ranks = 1750) && ($Athletics.Ranks = 1750) && ($Locksmithing.Ranks = 1750)) then
          {
               echo
               echo #############################
               echo ** ALL BURGLE SKILLS ALREADY CAPPED!!
               echo ** (Thievery / Athletics / Locksmithing )
               echo ** SKIPPING BURGLE RUN!
               echo #############################
               echo
               pause 0.5
               goto TELEPORT_BACK
          }
     if ("$guild" = "Paladin") then goto TELEPORT_BACK
     if ($UC_Burgle = 0) then goto TELEPORT_BACK
     if ("$zoneid" = "34a") then
          {
               put .travel river
               waitforre ^YOU ARRIVED
          }
BURGLE_2_TIMER:
     gosub clear
     gosub CLEAR_MATCHTABLE
     pause 0.1
     matchre BURGLE_2_TIMER ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre BURGLE_2_COOLDOWN ^You should wait at least (.+) roisaen for the heat to die down\.
	matchre BURGLE_2_START ^The heat has died down from your last caper\.
	put burgle recall
	matchwait 30
     goto TELEPORT_BACK

BURGLE_2_COOLDOWN:
     var cooldown $1
     if (%cooldown < 5) then goto BURGLE_2_PAUSE
     echo
     echo #####################
     echo *** BURGLE IS STILL ON COOLDOWN
     echo *** MORE THAN 5 MINUTES LEFT ON TIMER
     echo *** SKIPPING BURGLE RUN
     echo #####################
     echo
     pause 0.5
     goto TELEPORT_BACK
BURGLE_2_PAUSE:
     echo *** Waiting for Burgle Cooldown! - %cooldown minutes remaining
     if (%Playing = 0) then gosub PLAY
     pause 45
     goto BURGLE_2_TIMER

BURGLE_2_START:
     var LAST BURGLE_2_START
     echo
     echo #############
     echo *** BURGLING RUN #2!
     echo #############
     echo
     put #var BurgleItem1 NULL
     put #var BurgleItem2 NULL
     put #var BurgleItem3 NULL
     put #var BurgleItem4 NULL
     gosub stowing
     #### TO BURGLE LOCATION (Preferably w/ no guards)
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     pause 0.1
     if ("$zoneid" = "1") then
          {
               gosub AUTOMOVE 46
               gosub AUTOMOVE 172
          }
     if matchre("$zoneid", "(126|116|123)") then
          {
               gosub OPEN_CONTAINERS
               put .travel boar
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "4") then gosub AUTOMOVE 115
     if ("$zoneid" = "7") then gosub AUTOMOVE caravansary
     if ("$zoneid" = "30") then gosub AUTOMOVE W gate
     if ("$zoneid" = "30") then gosub AUTOMOVE W gate
     pause 0.0001
     pause 0.0001
     if ("$zoneid" = "30") then gosub AUTOMOVE W gate
     if ("$zoneid" = "33") then gosub AUTOMOVE 7
     if ("$zoneid" = "42") then gosub AUTOMOVE gate
     if ("$zoneid" = "40") then gosub AUTOMOVE 237
     if ("$zoneid" = "47") then gosub AUTOMOVE 336
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "68") then gosub AUTOMOVE 22
     if ("$zoneid" = "69") then gosub AUTOMOVE 205
     if ("$zoneid" = "66") then gosub AUTOMOVE 94
     if ("$zoneid" = "62") then gosub AUTOMOVE leth
     if ("$zoneid" = "61") then gosub AUTOMOVE ilaya
     if ("$zoneid" = "90") then gosub AUTOMOVE 25
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "99") then gosub AUTOMOVE 219
     if ("$zoneid" = "107") then gosub AUTOMOVE 4
     if ("$zoneid" = "108") then gosub AUTOMOVE 154
     if ("$zoneid" = "112") then gosub AUTOMOVE 16
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "116") then gosub AUTOMOVE boar
     if ("$zoneid" = "126") then gosub AUTOMOVE boar
     if ("$zoneid" = "127") then gosub AUTOMOVE 31
     if (("$zoneid" = "150") && ($Athletics.Ranks > 45)) then gosub AUTOMOVE 45
     pause 0.0001
     pause 0.0001
     if ("$zoneid" = "1") then gosub AUTOMOVE 172
     if ("$zoneid" = "4") then gosub AUTOMOVE 115
     if ("$zoneid" = "7") then gosub AUTOMOVE caravansary
     if ("$zoneid" = "30") then gosub AUTOMOVE W gate
     if ("$zoneid" = "33") then gosub AUTOMOVE 7
     if ("$zoneid" = "42") then gosub AUTOMOVE gate
     if ("$zoneid" = "40") then gosub AUTOMOVE 237
     if ("$zoneid" = "47") then gosub AUTOMOVE 336
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "69") then gosub AUTOMOVE 205
     if ("$zoneid" = "66") then gosub AUTOMOVE 94
     if ("$zoneid" = "62") then gosub AUTOMOVE leth
     if ("$zoneid" = "61") then gosub AUTOMOVE ilaya
     if ("$zoneid" = "90") then gosub AUTOMOVE 25
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "99") then gosub AUTOMOVE 219
     if ("$zoneid" = "107") then gosub AUTOMOVE 4
     if ("$zoneid" = "108") then gosub AUTOMOVE 154
     if ("$zoneid" = "112") then gosub AUTOMOVE 16
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "116") then gosub AUTOMOVE boar
     if ("$zoneid" = "126") then gosub AUTOMOVE boar
     if ("$zoneid" = "127") then gosub AUTOMOVE 31
     if (("$zoneid" = "150") && ($Athletics.Ranks > 45)) then gosub AUTOMOVE 45
     pause 0.2
     ### DOUBLE CHECKS FOR CORRECT BURGLE ROOM
     if (("$zoneid" = "66") && ("$roomid" != "94")) then gosub AUTOMOVE 94
     if (("$zoneid" = "33") && ("$roomid" != "7")) then gosub AUTOMOVE 7
     pause 0.1
     if matchre("$scriptlist" , "automapper\.cmd") then put #script abort automapper
BURGLE_2_PREP:
     pause 0.0001
     if ($SpellTimer.ShieldofLight.active = 1) then gosub RELEASE SOL
     pause 0.0001
     if (%Playing = 1) then gosub STOP_PLAY
     gosub OPEN_CONTAINERS
     gosub ARMOR_REMOVE
     pause 0.0001
     pause 0.0001
     if matchre("$scriptlist" , "automapper\.cmd") then put #script abort automapper
     if (%Playing = 1) then gosub STOP_PLAY
     gosub HIDE
     action (escape) on
     pause 0.0001
     pause 0.0001
BURGLE_2_WAIT:
     var LAST BURGLE_2_WAIT
     var burgling 1
     gosub clear
     gosub CLEAR_MATCHTABLE
     matchre BURGLE_2_DONE ^SCRIPT FINISHED|^BURGLE FINISHED
     put .burgle
     matchwait 320
     goto BURGLE_2_DONE
BURGLE_2_DONE:
DONE_BURGLE_2:
     pause 0.0001
     if matchre("$roomname", "Someone Else's Home\,") then goto BURGLE_2_WAIT
     put #echo >Log #7FFFD4 **** BURGLE RUN 2 - Thievery: $Thievery.Ranks $Thievery.LearningRate / 34  ***
     put #script abort burgle
     gosub stowing
     var burgling 0
     var burgleheal 0
     if ($UC_NoCombat = 0) then gosub WEAR_ARMOR
     gosub BLEEDERCHECK
     if ($bleeding = 1) then
          {
               echo
               echo #####################
               echo ** FUCK DID OUR HANDS GET CHOPPED OFF?
               echo ** SEARCHING FOR HEALER!
               echo ** REVERTING TO HEAL ROUTINE
               echo #####################
               echo
               var burgleheal 1
               goto TOWN_SEARCH
          }
     pause 0.0001
     goto BURGLE2PAWN
#########################################################################################################################################
BURGLE_2_PAWN:
BURGLE2PAWN:
     var LAST BURGLE_2_PAWN
     var NEXTSUB BURGLE_2_PAWNDONE
     var CURRENT Burgle 2 Pawn
     var burgleSold 0
     var burgleProfit 0
     var burgleCurrency Kronars
     gosub STATUSBAR
     gosub clear
     gosub CLEAR_MATCHTABLE
     if !def(BURGLE.KEEP) then put #var BURGLE.KEEP NULL
     pause 0.0001
     pause 0.0001
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     ## GO BACK TO TOWN
     put #parse BACK TO TOWN!
     put #parse GOING TO TOWN!
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     pause 0.0001
     if ("$zoneid" = "34a") then
          {
               put .travel river
               waitforre ^YOU ARRIVED
          }
     if ("$zoneid" = "68") then
          {
               gosub AUTOMOVE 68
               pause 0.2
               gosub AUTOMOVE 65
               pause 0.2
               gosub AUTOMOVE 62
               gosub AUTOMOVE 15
               pause 0.5
          }
     if matchre("$zoneid","\b(8|7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(8|7|8|4|4a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(124|126|127)\b") then gosub AUTOMOVE hib
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(62|58|59|60|112)\b") then gosub AUTOMOVE leth
     if matchre("$zoneid","\b(31|32|33)\b") then gosub AUTOMOVE river
     if (("$zoneid" = "61") && !matchre("$UC_HomeCity", "(?i)(CROSS|XING|RIVER|HAVEN|THEREN|MUSPARI)")) then
          {
               var hometown LETH
               put .travel shard
               waitforre ^YOU ARRIVED
               goto BURGLE_2_PAWNING
          }
     if ("$zoneid" = "61") then
          {
               var hometown LETH
               put .travel cross
               waitforre ^YOU ARRIVED
               goto BURGLE_2_PAWNING
          }
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     pause 0.1
     pause 0.2
     pause 0.1
     pause 0.001
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ($UC_BurglePawn = 0) then goto BURGLE_2_PAWNDONE
BURGLE_2_PAWNING:
     pause 0.1
     var burgleSold 0
     var burgleProfit 0
     var burgleCurrency Kronars
     # if matchre("$zoneid","\b(61|150)\b") then goto NO_PAWN_2
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     pause 0.1
     if !matchre("$zoneid","\b(1|30|42|47|61|67|90|99|107)\b") then goto NO_PAWN_2
     if !matchre("$zoneid","\b(47|61|150)\b") then gosub AUTOMOVE pawn
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     if ("$zoneid" = "61") then gosub AUTOMOVE gems
     if ("$zoneid" = "107") then gosub AUTOMOVE 243
     if ($invisible = 1) then gosub STOP_INVIS
     echo
     echo ##################
     echo *** PAWNING BURGLED ITEMS
     echo ##################
     echo
     pause 0.3
     var burgleTemp $BURGLE.KEEP
     eval burgleTemp replacere("%burgleTemp", "\|+", "|")
     eval burgleTemp replacere("%burgleTemp", "\|$", "")
     eval burgleTemp replacere("%burgleTemp", "^\|", "")
     pause 0.001
     gosub stowing
     pause 0.001
     put #var BURGLE.KEEP %burgleTemp
     pause 0.0001
     echo
     echo ######################
     echo ** BURGLE ITEMS SET TO KEEP:
     echo ** $BURGLE.KEEP
     echo ######################
     echo
     pause 0.3
     if ($invisible = 1) then gosub STOP_INVIS
     pause 0.0001
     var burgletwo 1
     if ("$BurgleItem1" != "NULL") then gosub PAWN_IT $BurgleItem1
     if ("$BurgleItem2" != "NULL") then gosub PAWN_IT $BurgleItem2
     if ("$BurgleItem3" != "NULL") then gosub PAWN_IT $BurgleItem3
     if ("$BurgleItem4" != "NULL") then gosub PAWN_IT $BurgleItem4
     goto BURGLE_2_PAWNDONE
NO_PAWN_2:
     echo
     echo ######################
     echo ** NO PAWN SHOP HERE - Skipping
     echo ######################
     echo
     goto BURGLE_2_PAWNDONE
#########################################
BURGLE_2_PAWNDONE:
     action remove hands you (\d+) (Kronars?|Lirums?|Dokoras?|kronars?|lirums?|dokoras?)
     gosub clear
     var Plat 0
     var Gold 0
     var Silver 0
     var Bronze 0
     var Copper 0
     var firstlaunch 0
     evalmath Plat floor(%burgleProfit/10000)
     evalmath Gold floor((%burgleProfit-(%Plat*10000))/1000)
     evalmath Silver floor((%burgleProfit-(%Plat*10000)-(%Gold*1000))/100)
     evalmath Bronze floor((%burgleProfit-(%Plat*10000)-(%Gold*1000)-(%Silver*100))/10)
     evalmath Copper floor((%burgleProfit-(%Plat*10000)-(%Gold*1000)-(%Silver*100)-(%Bronze*10))/1)
     pause 0.0001
     if (%burgleSold > 0) then
          {
               put #echo >Log #00FF00 * Sold %burgleSold burgle items - %burgleProfit %burgleCurrency
               # if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log #00FF00 * Sold %burgleSold burgle items - %burgleProfit %burgleCurrency
               # if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log #00FF00 * Sold %burgleSold burgle items - %burgleProfit %burgleCurrency
               # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log #00FF00 * Sold %burgleSold burgle items - %burgleProfit %burgleCurrency
               # if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log #00FF00 * Sold %burgleSold burgle items - %burgleProfit %burgleCurrency
               echo
               echo #######################
               echo *** SOLD %burgleSold BURGLE ITEMS!
               echo *** PROFIT: %burgleProfit %burgleCurrency (%Plat p/%Gold g/%Silver s/%Bronze b/%Copper c)
               echo #######################
               echo
               pause 0.4
          }
     pause 0.0001
     if ($out) then gosub MOVE out
     pause 0.1
     goto TELEPORT_BACK
#########################################################################################################################################
#########################################################################################################################################
#########################################################################################################################################
#########################################################################################################################################
TELEPORT_BACK:
TELEPORTBACK:
     var NEXTSUB ONLINE_CHECK
     var LAST TELEPORT_BACK
     gosub clear
     var firstlaunch 0
     action (skip) off
     action (jail) on
     if matchre("$scriptlist" , "braid\.cmd") then put #script abort braid
     if matchre("$scriptlist" , "carve\.cmd") then put #script abort carve
     if matchre("$scriptlist" , "steal\.cmd") then put #script abort steal
     if matchre("$scriptlist" , "burgle\.cmd") then put #script abort burgle
     if matchre("$scriptlist" , "travel\.cmd") then put #script abort travel
     if matchre("$scriptlist" , "automapper\.cmd") then put #script abort automapper
     var mcloop 0
     pause 0.001
     if ("$guild" = "Thief") then
          {
               if ($concentration < 75) then send khri stop
          }
MC_CHECK:
     math mcloop add 1
     pause 0.3
     pause 0.1
     if (%mcloop > 5) then goto LOOP_COMPLETED
     if matchre("$scriptlist", "((?:mc_\w+)|mastercraft)") then
          {
               put #script abort $1
               pause 1
               goto MC_CHECK
          }
LOOP_COMPLETED:
     unvar mcloop
     echo
     echo ###################
     echo *** UBER COMBAT LOOP COMPLETE!
     echo *** RESTARTING SCRIPT
     echo ###################
     echo
     pause 0.1
     pause 0.5
     gosub OPEN_CONTAINERS
     ### MOVE OUT OF THE BANK OR TO A NEUTRAL AREA FIRST BEFORE RESTARTING
     ### if (%Necro.Known = 1) then goto LOOP_COMPLETED_2
     if ("$zoneid" = "1") then gosub AUTOMOVE 156
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     if ("$zoneid" = "112") then gosub AUTOMOVE 27
     if ("$zoneid" = "116") then gosub AUTOMOVE 14
     if ("$zoneid" = "62") then gosub AUTOMOVE leth
     if ("$zoneid" = "67") then gosub AUTOMOVE 81
     if ("$zoneid" = "61") then gosub AUTOMOVE 19
     if ("$zoneid" = "30") then gosub AUTOMOVE 51
     if ("$zoneid" = "47") then gosub AUTOMOVE 38
     if ("$zoneid" = "42") then gosub AUTOMOVE 41
     if ("$zoneid" = "90") then gosub AUTOMOVE 48
     if ("$zoneid" = "99") then gosub AUTOMOVE 74
     if ("$zoneid" = "107") then gosub AUTOMOVE 58
     if (("$zoneid" = "150") && (%Teleport = 1)) then
          {
               if (%COMBAT.ZONE != 150) then
                    {
                         echo
                         echo ###################
                         echo * TELEPORTING BACK TO COMBAT ZONE
                         echo ###################
                         echo
                         pause 0.5
                         pause 0.1
                         send pull my %JewerlyVerb
                         pause 2
                         pause 0.5
                         send #mapper reset
                         pause 0.5
                         pause 0.2
                         send look
                         pause 0.5
                         pause 0.2
                         var Teleport 0
                         if ("$roomid" = "0") then gosub RANDOMMOVE
                    }
                    }
     if (("$zoneid" = "150") && (%COMBAT.ZONE != 150)) then gosub LEAVE_SEACAVE
LOOP_COMPLETED_2:
     gosub TOWNRUN_TIMERS
     pause 0.0001
     action var Teleport 0 when This particular .+ didn't bring you here
ONLINE_CHECK:
     var LAST ONLINE_CHECK
     echo
     echo #####################
     echo * CHECKING TOTAL TIME ONLINE...
     echo #####################
     echo
     pause 0.4
     ### CHECK TOWN RUN TIMER
     gosub TOWN_TIMER
     # evalmath TownyTime round((%TownTimeLast / 60),2)
     var TownyTime %TownTimeLast
     if (%TownTimeLast < 60) then put #echo >Log #FFC06F *** LAST TOWN RUN: %TownyTime seconds
     if ((%TownTimeLast >= 60) && (%TownTimeLast < 3600)) then
          {
               evalmath TownyTime round((%TownTimeLast / 60),2)
               put #echo >Log #FFC06F *** LAST TOWN RUN: %TownyTime minutes
               goto ONLINE_CHECK_2
          }
     if ((%TownTimeLast >= 3600) && (%TownTimeLast < 86400)) then
          {
               evalmath TownyTime round((%TownTimeLast / 60),2)
               evalmath TownyTime round((%TownyTime / 60),2)
               put #echo >Log #FFC06F *** LAST TOWN RUN: %TownyTime hours
               goto ONLINE_CHECK_2
          }
     if (%TownTimeLast >= 86400) then
          {
               evalmath TownyTime round((%TownTimeLast / 24),2)
               evalmath TownyTime round((%TownyTime / 60),2)
               evalmath TownyTime round((%TownyTime / 60),2)
               put #echo >Log #FFC06F *** LAST TOWN RUN: %TownyTime days
          }
     var TownTime 0
     ### CHECK TOTAL SCRIPT TIME
ONLINE_CHECK_2:
     put #var UC_totalTime {#evalmath ($gametime - %startTime)}
     var totalTime $UC_totalTime
     evalmath resultTime round((%totalTime / 60),2)
     # put #var UC_totalTime %resultTime
     if ($UC_totalTime < 60) then put #echo >Log #E0FF00 *** TOTAL SCRIPT RUN TIME: %resultTime seconds
     if (($UC_totalTime >= 60) && ($UC_totalTime < 3600)) then
          {
               evalmath resultTime round((%totalTime / 60),2)
               put #echo >Log #E0FF00 *** TOTAL SCRIPT RUN TIME: %resultTime minutes
               goto ONLINE_CHECK_3
          }
     if (($UC_totalTime >= 3600) && ($UC_totalTime < 86400)) then
          {
               evalmath resultTime round((%totalTime / 60),2)
               evalmath resultTime round((%resultTime / 60),2)
               put #echo >Log #E0FF00 *** TOTAL SCRIPT RUN TIME: %resultTime hours
               goto ONLINE_CHECK_3
          }
     if ($UC_totalTime >= 86400) then
          {
               evalmath resultTime round((%totalTime / 24),2)
               evalmath resultTime round((%resultTime / 60),2)
               evalmath resultTime round((%resultTime / 60),2)
               put #echo >Log #E0FF00 *** TOTAL SCRIPT RUN TIME: %resultTime days
          }
ONLINE_CHECK_3:
     echo
     echo #######################
     echo *** TOTAL SCRIPT RUN TIME ***
     if (($UC_totalTime >= 60) && ($UC_totalTime < 3600)) then echo ** $UC_totalTime seconds - ( %resultTime minutes )
     if (($UC_totalTime >= 3600) && ($UC_totalTime < 86400)) then echo ** $UC_totalTime seconds - ( %resultTime hours )
     if ($UC_totalTime >= 86400) then echo ** $UC_totalTime seconds - ( %resultTime days )
     echo **
     if (%TownTimeLast < 60) then echo ** LAST TOWN RUN TIME - %TownyTime seconds
     if ((%TownTimeLast >= 60) && (%TownTimeLast < 3600)) then echo ** LAST TOWN RUN TIME - %TownyTime minutes
     if ((%TownTimeLast >= 3600) && (%TownTimeLast < 86400)) then echo ** LAST TOWN RUN TIME - %TownyTime hours
     if (%TownTimeLast >= 86400) then echo ** LAST TOWN RUN TIME - %TownyTime days
     echo #######################
     echo
     pause 2
     pause 0.2
     if (%ONLINE.TIME = 0) then goto BACK_TO_COMBAT
     if ($UC_totalTime > %ONLINE.TIME) then goto AFK_TIME
     goto BACK_TO_COMBAT
#############################################################################
#### LOGOUT TIMER TO AVOID AFK CHECK
AFK_TIME:
     action (reconnect) off
     action (stunned) off
     action (combat) off
     action (escape) off
     var LAST AFK_TIME
     var CURRENT AFK TIME!
     var firstlaunch 0
     gosub STATUSBAR
     put #echo >Log #ff4da6 *** IDLING AND GOING OFFLINE FOR ~30+ MINS TO AVOID POTENTIAL AFK CHECK
SAFE_ROOM_GO:
     # put #script abort all except ubercombat
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if ("$guild" = "Necromancer") then
          {
               echo
               echo ###############################
               echo *** NECROMANCER! CHOOSING A SAFE ROOM TO AFK IN ***
               echo *** Outside of town...
               echo ###############################
               echo
               if ("$zoneid" = "1") then gosub AUTOMOVE 170
               if ("$zoneid" = "8") then gosub AUTOMOVE 142
               if ("$zoneid" = "30") then gosub AUTOMOVE E gate
               if ("$zoneid" = "31") then gosub AUTOMOVE 6
               if ("$zoneid" = "47") then gosub AUTOMOVE 376
               if ("$zoneid" = "42") then gosub AUTOMOVE gate
               if ("$zoneid" = "40") then gosub AUTOMOVE 216
               if ("$zoneid" = "61") then gosub AUTOMOVE cross
               if ("$zoneid" = "60") then gosub AUTOMOVE 109
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "66") then gosub AUTOMOVE 642
               if ("$zoneid" = "90") then gosub AUTOMOVE 662
               if ("$zoneid" = "95") then gosub AUTOMOVE 5
               if ("$zoneid" = "99") then gosub AUTOMOVE west
               if ("$zoneid" = "98") then gosub AUTOMOVE 325
               if ("$zoneid" = "106") then gosub AUTOMOVE 224
               if ("$zoneid" = "107") then gosub AUTOMOVE 259
               if ("$zoneid" = "116") then gosub AUTOMOVE boar
               if ("$zoneid" = "126") then gosub AUTOMOVE 56
               if ("$zoneid" = "127") then gosub AUTOMOVE 29
               if (("$zoneid" = "150") && ($Athletics.Ranks > 45)) then gosub AUTOMOVE 45
               goto SAFE_ROOM_CAMP
          }
     if ("$zoneid" = "69") then gosub AUTOMOVE shard
     if ("$zoneid" = "1") then
          {
               echo
               echo ###############################
               echo *** CROSSINGS! CHOOSING RANDOM SAFE ROOM TO AFK IN ***
               echo *** 1 out of 4 possible locations...
               echo ###############################
               echo
               random 1 4
               if (%r = 1) then gosub AUTOMOVE dance
               if (%r = 2) then gosub AUTOMOVE 660
               if (%r = 3) then gosub AUTOMOVE 663
               if (%r = 4) then gosub AUTOMOVE 739
          }
     if ("$zoneid" = "30") then gosub AUTOMOVE 244
     if ("$zoneid" = "47") then gosub AUTOMOVE 270
     if ("$zoneid" = "42") then gosub AUTOMOVE 304
     if ("$zoneid" = "61") then gosub AUTOMOVE 219
     if ("$zoneid" = "67") then gosub AUTOMOVE 469
     if ("$zoneid" = "90") then gosub AUTOMOVE 333
     if ("$zoneid" = "99") then gosub AUTOMOVE 405
     if ("$zoneid" = "106") then gosub AUTOMOVE 224
     if ("$zoneid" = "107") then gosub AUTOMOVE 259
     if ("$zoneid" = "116") then gosub AUTOMOVE 258
     if ("$zoneid" = "127") then gosub AUTOMOVE 29
     if (("$zoneid" = "150") && ($Athletics.Ranks > 45)) then gosub AUTOMOVE 45
     ############################
     # NEW SAFE ROOM - FIND AND CAMP AT NEXUS
     gosub NEXUS_CHECK
     ############################
SAFE_ROOM_CAMP:
     pause 0.2
     echo
     echo #######################
     echo *** NOW AT OUR SAFE ROOM!
     echo *** GOING TO SLEEP FOR RESTED XP
     echo *** AFK IDLE FOR A WHILE BEFORE LOGOUT
     echo #######################
     echo
     gosub HIDE
     pause 0.2
     send sleep
     wait
     pause 0.5
     var idle.timer 0
     random 1 4
     pause 0.4
     if (%r = 1) then var total.idle 25
     if (%r = 2) then var total.idle 30
     if (%r = 3) then var total.idle 45
     if (%r = 4) then var total.idle 50
     var current.idle %total.idle
AFK_IDLE:
     pause
     echo
     echo #############################
     echo ** IDLING FOR %current.idle MINUTES BEFORE LOG OUT
     echo #############################
     echo
     math idle.timer add 1
     math current.idle subtract 1
     pause 60
     put look
     if (%idle.timer > %total.idle) then goto LOGOUT.TIMER
     goto AFK_IDLE
LOGOUT.TIMER:
     action (reconnect) off
     put #parse LOGGING OUT TIMER
     math LOGOFF add 1
     send sleep
     pause 0.1
     echo
     echo #########################
     echo ** LOGGING OUT FOR ~20+ MINUTES!
     echo ** TO CLEAR ONLINE TIMER FROM GAME
     echo ** AND REDUCE CHANCE OF SCRIPT CHECK!
     echo ** GOING TO DEEP SLEEP FOR RESTED XP
     echo #########################
     echo
     pause 0.2
     pause 0.4
     action (stunned) off
     action (reconnect) off
     action (combat) off
     action (escape) off
     unvar idle.timer
     unvar current.idle
     put #var connected 0
     put #disconnect
     put quit
WAITING.LOGOUT.TIMER:
     var pausetime 1500
     echo
     echo ##################
     random 1 7
     echo *** Choosing Random Logout Time....
     if (%r = 1) then
          {
               var pausetime 1680
               goto LOGGEDOUT_AFKTIMER
          }
     if (%r = 2) then
          {
               var pausetime  1834
               goto LOGGEDOUT_AFKTIMER
          }
     if (%r = 3) then
          {
               var pausetime  1950
               goto LOGGEDOUT_AFKTIMER
          }
     if (%r = 4) then
          {
               var pausetime  2477
               goto LOGGEDOUT_AFKTIMER
          }
     if (%r = 5) then
          {
               var pausetime  2820
               goto LOGGEDOUT_AFKTIMER
          }
     if (%r = 6) then
          {
               var pausetime  3250
               goto LOGGEDOUT_AFKTIMER
          }
     if (%r = 7) then
          {
               var pausetime 3850
               goto LOGGEDOUT_AFKTIMER
          }
LOGGEDOUT_AFKTIMER:
     echo *** %pausetime seconds
     echo ##################
     echo
AFK.RECONNECTING:
     put #echo >Log #00FF00 *** Reconnecting and restarting!
     var startTime $gametime
     put #var UC_totalTime 0
     gosub CONNECT_NOW
     pause
     put look
     pause 5
     pause
     if ($connected = 0) then goto AFK.RECONNECTING
     action (reconnect) on
     echo
     echo #################
     echo # RECONNECTED
     echo # RESTARTING SCRIPT!
     echo #################
     echo
     pause 0.4
     timer clear
     timer start
     var reset 1
     if (($invisible = 1) && ("$guild" != "Necromancer")) then gosub STOP_INVIS
     if ($hidden = 1) then send shiver
     pause
     pause 0.1
     send awake
     pause 0.5
     pause 0.5
     send awake
     pause 2
     unvar idle.timer
     unvar current.idle
     var command NULL
     goto BACK_TO_COMBAT
##########################################################################################################################
####  RETURN TO COMBAT
##########################################################################################################################
RETURN_TO_COMBAT:
BACK_TO_COMBAT:
BACK_TO_COMBAT_REAL:
RETURNCOMBAT:
     # debug 10
     var LAST RETURNCOMBAT
     var TIMEOUT 0
     put #var UC_Combat.Last 0
     var command NULL
     var firstlaunch 0
     echo
     echo ################
     echo *** SCRIPT LOOP COMPLETE!
     echo *** RESTARTING SCRIPT
     echo ################
     echo
     pause 0.5
     gosub clear
     gosub CLEAR_MATCHTABLE
     action (reconnect) on
     action (inventory) on
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then gosub RESEARCH_CANCEL
     pause 0.1
     put awake
     pause 0.4
     put awake
     pause 0.4
     if ($UC_Tarantula = 1) then gosub TARANTULA_TIMER
     if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
     # if (($invisible = 1) && ("$guild" != "Necromancer")) then gosub STOP_INVIS
     if ($UC_getFavors = 1) then gosub ORB_RUB
     if ($UC_Loop = 0) then goto EXIT
     pause 0.8
     if (%Playing = 1) then gosub STOP_PLAY
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if ($UC_NoCombat = 1) then goto ESCAPE_NOW
     if (%Backtraining = 1) then
          {
               var Backtrained 1
               var Backtraining 0
               if (%Necro.Known = 0) then
                    {
                         if ("$zoneid" = "1") then gosub AUTOMOVE 156
                         if ("$zoneid" = "66") then gosub AUTOMOVE east
                         if ("$zoneid" = "150") then gosub AUTOMOVE 85
                         if ("$zoneid" = "116") then gosub AUTOMOVE 14
                         if ("$zoneid" = "67") then gosub AUTOMOVE 81
                         if ("$zoneid" = "61") then gosub AUTOMOVE 19
                         if ("$zoneid" = "30") then gosub AUTOMOVE 51
                         if ("$zoneid" = "47") then gosub AUTOMOVE 38
                         if ("$zoneid" = "42") then gosub AUTOMOVE 41
                         if ("$zoneid" = "90") then gosub AUTOMOVE 48
                         if ("$zoneid" = "99") then gosub AUTOMOVE 74
                         if ("$zoneid" = "107") then gosub AUTOMOVE 58
                    }
          }
     if (%Backtraining = 1) then goto RETURN_FROM_RESTOCK
     put #var UC_Combat.Last 0
     var command NULL
     if matchre("$charactername", "%MURDERERS") then goto HUNTNOOBS
     goto INIT_PREP
##############################################################################################
##############################################################################################
###################### END OF MAIN SCRIPT LOOP !!!! ##########################################
##############################################################################################
##############################################################################################


#####################################################
#####################################################
######  BEGIN MAIN UTILITY SUBROUTINES  #############
#####################################################
#####################################################


############################################################################################
############################################################################################
## HOME CITY TRAVEL / GO HOME CITY
#########################################################
HOME_CITY_GO:
     echo
     echo ##############
     echo *** HOME CITY CHECK
     echo ##############
     echo
     pause 0.1
     gosub CLEAR_MATCHTABLE
     if matchre("$UC_HomeCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then return
     if (matchre("$UC_HomeCity", "(?i)(CROSS|XING|CROSSING)") && ($zoneid = 1)) then goto AT_HOME_CITY
     if (matchre("$UC_HomeCity", "(?i)(HAVEN|RIVERHAVEN)") && ($zoneid = 30)) then goto AT_HOME_CITY
     if (matchre("$UC_HomeCity", "(?i)(THEREN|THERENBOROUGH)") && ($zoneid = 42)) then goto AT_HOME_CITY
     if (matchre("$UC_HomeCity", "(?i)SHARD") && ($zoneid = 67)) then goto AT_HOME_CITY
     if (matchre("$UC_HomeCity", "(?i)HIB") && ($zoneid = 116)) then goto AT_HOME_CITY
     if (matchre("$UC_HomeCity", "(?i)BOAR") && ($zoneid = 127)) then goto AT_HOME_CITY
     if (matchre("$UC_HomeCity", "(?i)(FC|FANG)") && ($zoneid = 150)) then goto AT_HOME_CITY
     pause 0.0001
     gosub OPEN_CONTAINERS
     if ("$guild" = "Necromancer") then
          {
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
          }
     if (matchre("$UC_HomeCity", "(?i)(CROSS|XING|CROSSING)") && ($zoneid != 1)) then
          {
               echo *** Travelling Back to Home City - $UC_HomeCity
               if ("$guild" = "Necromancer") then
                    {
                         if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
                    }
               put .travel cross
               waitforre ^YOU ARRIVED\!
               goto ARRIVED_HOME_CITY
          }
     if (matchre("$UC_HomeCity", "(?i)SHARD") && ($zoneid != 67)) then
          {
               if (%Playing = 1) then gosub STOP_PLAY
               echo *** Travelling Back to Home City - $UC_HomeCity
               if ("$guild" = "Necromancer") then
                    {
                         if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
                    }
               put .travel shard
               waitforre ^YOU ARRIVED\!
               goto ARRIVED_HOME_CITY
          }
     if (matchre("$UC_HomeCity", "(?i)HIB") && ($zoneid != 116)) then
          {
               if (%Playing = 1) then gosub STOP_PLAY
               echo *** Travelling Back to Home City - $UC_HomeCity
               if ("$guild" = "Necromancer") then
                    {
                         if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
                    }
               put .travel hib
               waitforre ^YOU ARRIVED\!
               goto ARRIVED_HOME_CITY
          }
     if (matchre("$UC_HomeCity", "(?i)(HAVEN|RIVERHAVEN)") && ($zoneid != 30)) then
          {
               echo *** Travelling Back to Home City - $UC_HomeCity
               if ("$guild" = "Necromancer") then
                    {
                         if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
                    }
               put .travel riverhaven
               waitforre ^YOU ARRIVED\!
               goto ARRIVED_HOME_CITY
          }
     if (matchre("$UC_HomeCity", "(?i)(THEREN|THERENBOROUGH)") && ($zoneid != 42)) then
          {
               echo *** Travelling Back to Home City - $UC_HomeCity
               put .travel theren
               waitforre ^YOU ARRIVED\!
               goto ARRIVED_HOME_CITY
          }
     if (matchre("$UC_HomeCity", "(?i)BOAR") && ($zoneid != 127)) then
          {
               echo *** Travelling Back to Home City - $UC_HomeCity
               if ("$guild" = "Necromancer") then
                    {
                         if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
                    }
               put .travel boar
               waitforre ^YOU ARRIVED\!
               goto ARRIVED_HOME_CITY
          }
     if (matchre("$UC_HomeCity", "(?i)(FC|FANG)") && ($zoneid != 150)) then
          {
               if (matchre("$game", "(DRF|DRX)") || ($UC_Premium = 1)) then
                    {
                         if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
                              {
                                   gosub TO_SEACAVES
                                   goto ARRIVED_HOME_CITY
                              }
                    }
          }
     echo #######################################
     echo *** $UC_HomeCity HOME CITY NOT SUPPORTED OR RECOGNIZED!!!
     echo #######################################
     return
AT_HOME_CITY:
     echo ##################
     echo *** ALREADY IN HOME CITY
     echo ##################
ARRIVED_HOME_CITY:
     if !matchre("$UC_HomeRoom", "(?i)(NULL|OFF|^%|^\s*$)" then gosub AUTOMOVE $UC_HomeRoom
     return
##################################################################
##############################################################################
VAULT_CITY_GO:
     if (%Playing = 1) then gosub STOP_PLAY
     if ($UC_VaultSwap = 0) then return
     if matchre("$UC_VaultCity", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then return
     put #parse GOING TO TOWN!
     gosub OPEN_CONTAINERS
     pause 0.2
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVES
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     pause 0.001
     if ("$guild" = "Necromancer") then
          {
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if (matchre("$UC_VaultCity", "(?i)(CROSS|XING)") && ($zoneid != 1)) then
          {
               echo *** Travelling Back to Vault City - $UC_VaultCity
               put .travel cross
               waitforre ^YOU ARRIVED\!
               return
          }
     if (matchre("$UC_VaultCity", "(?i)SHARD") && ($zoneid != 67)) then
          {
               echo *** Travelling Back to Vault City - $UC_VaultCity
               put .travel shard
               waitforre ^YOU ARRIVED\!
               return
          }
     if (matchre("$UC_VaultCity", "(?i)HIB") && ($zoneid != 116)) then
          {
               echo *** Travelling Back to Vault City - $UC_VaultCity
               put .travel hib
               waitforre ^YOU ARRIVED\!
               return
          }
     if (matchre("$UC_VaultCity", "(?i)(HAVEN|RIVERHAVEN)") && ($zoneid != 30)) then
          {
               echo *** Travelling Back to Vault City - $UC_VaultCity
               put .travel riverhaven
               waitforre ^YOU ARRIVED\!
               return
          }
     if (matchre("$UC_VaultCity", "(?i)(THEREN|THERENBOROUGH)") && ($zoneid != 42)) then
          {
               echo *** Travelling Back to Vault City - $UC_VaultCity
               put .travel theren
               waitforre ^YOU ARRIVED\!
               return
          }
     if (matchre("$UC_VaultCity", "(?i)BOAR") && ($zoneid != 127)) then
          {
               echo *** Travelling Back to Vault City - $UC_VaultCity
               put .travel boar
               waitforre ^YOU ARRIVED\!
               return
          }
     if (matchre("$UC_VaultCity", "(?i)(FC|FANG)") && ($zoneid != 150)) then
          {
               if (matchre("$game", "(DRF|DRX)") || ($UC_Premium = 1)) then
                    {
                         if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|114|116)\b") then
                              {
                                   gosub TO_SEACAVES
                                   return
                              }
                    }
          }
     return
#######################################
#### MAGIC RESEARCH
#######################################
MAGICAL_RESEARCH:
     if ($UC_MagicalResearch = 0) then return
     action (research) on
# if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     var townRun 0
     var GAF.MANA 5
     var CurrentSpell GAF
     var CurrentCambMana 5
     if ($Arcana.Ranks < 20) then
          {
               echo ** NOT ENOUGH ARCANA FOR MAGICAL RESEARCH (~20)
               echo ** Skipping
               pause 0.5
               return
          }
     if ($mana < 60) then
          {
               echo
               echo *** MANA IS LOW ($mana) - PAUSING TO RECOVER..
               echo
               waiteval ($mana > 80)
          }
     if ($invisible = 1) then gosub STOP_INVIS
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.0001
     pause 0.0001
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then return
     if ((%Research.Active = 0) && (%Research.Inactive = 1) && ($SpellTimer.GaugeFlow.duration > 30)) then goto RESEARCH_CHOOSE
     if ((%Research.Active = 0) && (%Research.Inactive = 0)) then goto MAGICAL_RESEARCH_PREP
     if ((%Research.Active = 1) && (%Research.Inactive = 1) && ($SpellTimer.GaugeFlow.duration < 5)) then goto MAGICAL_RESEARCH_PREP
     if ((%Research.Active = 1) && (%Research.Inactive = 1) && ($SpellTimer.GaugeFlow.active = 1)) then goto RESEARCH_CONTINUE
     if ((%Research.Active = 1) && ($SpellTimer.GaugeFlow.active = 1)) then goto RESEARCH_CHOOSE
MAGICAL_RESEARCH_PREP:
     pause 0.001
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then gosub RESEARCH_CANCEL
     if (%Research.Active = 1) then gosub RESEARCH_STOP
#### Gauge Flow: Min 5 - 100 Max mana / Skill Ranks = 10 - 600 Utility
     if ($Utility.Ranks < 150) then var GAF.MANA 5
     if (($Utility.Ranks >= 150) && ($Utility.Ranks < 200)) then var GAF.MANA 7
     if (($Utility.Ranks >= 200) && ($Utility.Ranks < 250)) then var GAF.MANA 9
     if (($Utility.Ranks >= 250) && ($Utility.Ranks < 300)) then var GAF.MANA 11
     if (($Utility.Ranks >= 300) && ($Utility.Ranks < 360)) then var GAF.MANA 12
     if (($Utility.Ranks >= 360) && ($Utility.Ranks < 420)) then var GAF.MANA 14
     if (($Utility.Ranks >= 420) && ($Utility.Ranks < 500)) then var GAF.MANA 16
     if (($Utility.Ranks >= 500) && ($Utility.Ranks < 600)) then var GAF.MANA 18
     if (($Utility.Ranks >= 600) && ($Utility.Ranks < 700)) then var GAF.MANA 20
     if (($Utility.Ranks >= 700) && ($Utility.Ranks < 900)) then var GAF.MANA 25
     if ($Utility.Ranks > 900) then var GAF.MANA 32
     pause 0.001
MAGICAL_RESEARCH_2:
     pause 0.001
     if ($SpellTimer.GaugeFlow.duration > 15) then goto RESEARCH_CHOOSE
     echo
     echo ####################
     echo ** MAGICAL RESEARCH TRAINING!
     echo ** Utility Ranks: $Utility.Ranks
     echo ** Casting GAF @ %GAF.MANA mana
     echo ####################
     echo
     pause 0.5
     pause 0.2
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
     pause 0.1
     gosub PREPARE GAF %GAF.MANA
     gosub SPELL_WAIT
     pause 0.1
RESEARCH_CHOOSE:
     if ((%Research.Active = 1) && (%Research.Inactive = 1)) then goto RESEARCH_CONTINUE
     gosub RESEARCH_DECIDE
     pause 0.1
RESEARCH_CONTINUE:
     if (((%SorceryON = 1) && (%healthwalk = 0)) || matchre("%RESEARCH.TYPE", "(?i)(SORCERY|FIELD)")) then
          {
               ### CHOOSING ROOM OUTSIDE OF TOWN
               echo
               echo ###########################
               echo *** Moving out of Town for Magical Research!
               echo *** To be safe researching Sorcery
               echo ###########################
               echo
               pause 0.2
               if ("$zoneid" = "1") then gosub AUTOMOVE 170
               if ("$zoneid" = "8") then gosub AUTOMOVE 49
               if ("$zoneid" = "30") then gosub AUTOMOVE E gate
               if ("$zoneid" = "31") then gosub AUTOMOVE 6
               if ("$zoneid" = "33") then gosub AUTOMOVE 115
               if ("$zoneid" = "47") then gosub AUTOMOVE 376
               if ("$zoneid" = "42") then gosub AUTOMOVE gate
               if ("$zoneid" = "40") then gosub AUTOMOVE 216
               if ("$zoneid" = "61") then gosub AUTOMOVE cross
               if ("$zoneid" = "60") then gosub AUTOMOVE 39
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "66") then gosub AUTOMOVE 641
               if ("$zoneid" = "90") then gosub AUTOMOVE 662
               if ("$zoneid" = "95") then gosub AUTOMOVE 5
               if ("$zoneid" = "99") then gosub AUTOMOVE west
               if ("$zoneid" = "98") then gosub AUTOMOVE 325
               if ("$zoneid" = "106") then gosub AUTOMOVE pool
               if ("$zoneid" = "107") then gosub AUTOMOVE 259
               if ("$zoneid" = "116") then gosub AUTOMOVE boar
               if ("$zoneid" = "126") then gosub AUTOMOVE 56
               if ("$zoneid" = "127") then gosub AUTOMOVE 29
               pause 0.01
          }
     pause 0.1
     ### CHECK JUSTICE HERE
     gosub JUSTICE
     if ($SpellTimer.GaugeFlow.active = 0) then goto MAGICAL_RESEARCH_2
     pause 0.01
     echo
     echo ####################
     echo *** MAGICAL RESEARCH
     echo *** TYPE: %RESEARCH
     echo ####################
     echo
     pause 0.3
     pause 0.1
     put RESEARCH %RESEARCH
     pause 0.5
     pause 0.4
     return

RESEARCH_DECIDE:
     action (research) on
     var RESEARCH NULL
     echo
     echo **** CHOOSING MAGICAL RESEARCH TYPE....
     echo
     if ($Arcana.LearningRate < 20) then var RESEARCH FUNDAMENTAL 300
     if ($Attunement.LearningRate < 20) then var RESEARCH STREAM 300
     if ($Augmentation.LearningRate < 20) then var RESEARCH AUGMENT 300
     if ($Utility.LearningRate < 20) then var RESEARCH UTILITY 300
     if ($Warding.LearningRate < 20) then var RESEARCH WARDING 300
     pause 0.0001
     if ($Attunement.LearningRate < 10) then var RESEARCH STREAM 300
     if ($Augmentation.LearningRate < 10) then var RESEARCH AUGMENT 300
     if ($Utility.LearningRate < 10) then var RESEARCH UTILITY 300
     if ($Warding.LearningRate < 10) then var RESEARCH WARDING 300
     if ($Arcana.LearningRate < 10) then var RESEARCH FUNDAMENTAL 300
     pause 0.0001
     if ($Attunement.LearningRate < 5) then var RESEARCH STREAM 300
     if ($Augmentation.LearningRate < 5) then var RESEARCH AUGMENT 300
     if ($Utility.LearningRate < 5) then var RESEARCH UTILITY 300
     if ($Warding.LearningRate < 5) then var RESEARCH WARDING 300
     if ($Arcana.LearningRate < 5) then var RESEARCH FUNDAMENTAL 300
     pause 0.0001
     if ("%justice" = "unsafe") then
          {
               if (($Arcana.Ranks > 250) && (%SorceryON = 1) && ($Sorcery.LearningRate < 20)) then var RESEARCH SORCERY 300
               if (($Arcana.Ranks > 750) && (%SorceryON = 1) && ($Sorcery.LearningRate < 25)) then var RESEARCH FIELD 300
          }
     if ($Arcana.Ranks > 1000) then
          {
               if (($Augmentation.LearningRate < 2) || ($Utility.LearningRate < 2) || ($Warding.LearningRate < 2)) then
                    {
                         echo *** ARCANA RANKS > 1000 AND Aug/Util/Ward are Low - Researching SPELL
                         var RESEARCH SPELL 300
                         return
                    }
          }
     if (($Arcana.Ranks > 500) && ($Augmentation.LearningRate < 1)) then var RESEARCH ENERGY 300
     if ("%justice" = "unsafe") then
          {
               if (($Arcana.Ranks > 250) && (%SorceryON = 1) && ($Sorcery.LearningRate < 10)) then var RESEARCH SORCERY 300
               if (($Arcana.Ranks > 750) && (%SorceryON = 1) && ($Sorcery.LearningRate < 10)) then var RESEARCH FIELD 300
          }
     if (($Arcana.Ranks > 250) && (%SorceryON = 1) && ($Sorcery.LearningRate > 10)) then
          {
               if (($Augmentation.LearningRate < 5) || ($Utility.LearningRate < 5) || ($Warding.LearningRate < 5)) then
                    {
                         if ($Arcana.Ranks > 1000) then
                              {
                                   var RESEARCH SPELL 300
                                   return
                              }
                         if ($Augmentation.LearningRate < 5) then
                              {
                                   var RESEARCH AUGMENTATION 300
                                   return
                              }
                         if ($Utility.LearningRate < 5) then
                              {
                                   var RESEARCH UTILITY 300
                                   return
                              }
                         if ($Warding.LearningRate < 5) then
                              {
                                   var RESEARCH WARDING 300
                                   return
                              }
                    }
               if (($Arcana.Ranks > 750) && ($Primary_Magic.LearningRate < 32) && ($Sorcery.LearningRate < 32) && ("%justice" = "unsafe")) then var RESEARCH FIELD 300
          }
     if (matchre("%RESEARCH.TYPE", "(?i)FUNDAMENTAL") && ($Arcana.LearningRate < 20)) then var RESEARCH FUNDAMENTAL 300
     if (matchre("%RESEARCH.TYPE", "(?i)STREAM") && ($Attunement.LearningRate < 20)) then var RESEARCH STREAM 300
     if (matchre("%RESEARCH.TYPE", "(?i)AUGMENT") && ($Augmentation.LearningRate < 20)) then var RESEARCH AUGMENT 300
     if (matchre("%RESEARCH.TYPE", "(?i)UTILITY") && ($Utility.LearningRate < 20)) then var RESEARCH UTILITY 300
     if (matchre("%RESEARCH.TYPE", "(?i)WARDING") && ($Warding.LearningRate < 20)) then var RESEARCH WARDING 300
     if (matchre("%RESEARCH.TYPE", "(?i)SPELL") && ($Warding.LearningRate < 15) && ($Arcana.Ranks > 1000)) then var RESEARCH SPELL 300
     if (matchre("%RESEARCH.TYPE", "(?i)FIELD") && ($Sorcery.LearningRate < 34) && ($Arcana.Ranks > 750) && ("%justice" = "unsafe")) then var RESEARCH FIELD 300
     if (matchre("%RESEARCH.TYPE", "(?i)SORCERY") && ($Sorcery.LearningRate < 25) && ($Arcana.Ranks > 250) && ("%justice" = "unsafe")) then var RESEARCH SORCERY 300
     ## if ("%RESEARCH" != "NULL") && (($Augmentation.LearningRate < 7) && ($Utility.LearningRate < 7) && ($Warding.LearningRate < 7)) then return
     pause 0.0001
     #### SPECIAL RESEARCH (REQUIRES QUEST AND HAS A 24 HOUR COOLDOWN - NOT SUPPORTED)
     # if (($Arcana.Ranks > 250) && ("$guild" = "Moon Mage") && ($Astrology.LearningRate < 20)) then var RESEARCH PLANE
     # if (($Arcana.Ranks > 250) && ("$guild" = "Warrior Mage") && ($Summoning.LearningRate < 20)) then var RESEARCH PLANES
     # if (($Arcana.Ranks > 250) && ("$guild" = "Cleric") && ($Theurgy.LearningRate < 20)) then var RESEARCH ROAD
     if ("%RESEARCH" = "NULL") then var RESEARCH FUNDAMENTAL 300
     return
####################################################################
#####################################################
## RESTOCK CHAMOIS CLOTH
#####################################################
RESTOCK_CLOTH:
CLOTH_RESTOCK:
     echo
     echo ####################
     echo # RESTOCKING CHAMOIS CLOTH!
     echo ####################
     echo
     pause 0.4
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     pause 0.2
     if !matchre("$zoneid", "\b(1|4|7|8|10|30|31|32|33|34|34a|40|42|47|61|65|66|67|68|69|90|99|107|112|116|126|127)\b") then
          {
               echo
               echo ############################
               echo *** $zonename - Map $zoneid
               echo *** IS NOT A RECOGNIZED ZONE TO BUY CLOTH
               echo *** TURNING OFF ZILLS
               echo #############################
               echo
               put #echo >Log #ff0000 ** $zoneid - Not an area to buy chamois cloth - Turning Zills OFF
               put #var UC_Zills 0
               pause
               return
          }
     if !matchre("$roomname", "Teller") then gosub AUTOMOVE teller
     pause 0.3
     if matchre("$zoneid", "47") then put withdraw 3 gold
     if !matchre("$zoneid", "47") then put withdraw 4 silver
     pause 0.5
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "69") then gosub AUTOMOVE shard
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     pause 0.2
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "69") then gosub AUTOMOVE shard
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     pause 0.2
     #### TO THE MUSIC SHOP / PLACE TO BUY INSTRUMENT CLOTHS
     if !matchre("$zoneid", "\b(30|47)\b") then gosub AUTOMOVE music
     if ("$zoneid" = "30") then gosub AUTOMOVE bard shop
     if ("$zoneid" = "47") then gosub AUTOMOVE kohit
     pause 0.4
     pause 0.2
     if !matchre("$zoneid", "\b(30|61)\b") then put buy cloth
     if ("$zoneid" = "61") then put buy chamois cloth
     if ("$zoneid" = "30") then
          {
               put buy silk cloth
               pause 0.4
               put offer 369
               pause 0.1
               put offer 369
               pause 0.3
               goto RESTOCK_CLOTH_DONE
          }
     if ("$zoneid" = "47") then
          {
               pause 0.2
               put buy woven cloth
               pause 0.7
               put offer 2025
               pause 0.4
               put offer 2025
               pause 0.2
               goto RESTOCK_CLOTH_DONE
          }
     pause 0.5
     put offer 325
     pause 0.1
     put offer 325
     pause 0.3
RESTOCK_CLOTH_DONE:
     pause 0.3
     pause 0.3
     gosub stowing
     put #echo >Log #cc0066 ** RESTOCKED CHAMOIS CLOTH!
     pause 0.3
     return
#############################################################
#### RESTOCKING AMMO FROM VAULT STORAGE
#############################################################
TO_VAULT:
     pause 0.1
     matchre TO_VAULT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre INSIDE_VAULT Carousel Chamber|A sturdy vault|steel door and a garbage chute
     put .vault
     matchwait 20
     goto TO_VAULT
INSIDE_VAULT:
     pause 2
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.5
     if (%BuyBolts = 1) then gosub GET_VAULT bolt Buybolts
     if (%BuyArrows = 1) then gosub GET_VAULT arrow BuyArrows
     if (%BuyRocks = 1) then gosub GET_VAULT shard BuyRocks
     goto VAULT_RESTOCK_DONE
GET_VAULT:
     var item $1
     var BuyType $2
     pause 0.3
     pause 0.1
     matchre GET_VAULT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre BREAK_ITEMS ^You get
     matchre GET_VAULT ^You struggle
     matchre GET_SHELF_2 ^I could not|^What
     put get %item from shelf
     matchwait 20
GET_SHELF_2:
     pause 0.2
     pause 0.1
     pause 0.1
     matchre GET_SHELFT_2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre BREAK_ITEMS ^You get
     matchre GET_SHELF_2 ^You struggle
     matchre NO_VAULT_ITEM ^I could not|^What|^You are not strong
     put get %item from second shelf
     matchwait 20
BREAK_ITEMS:
     pause 0.3
     var itemcount 90
     if ("%item" = "shard") then var itemcount 12
     if ("%item" = "arrow") then var itemcount 90
     if ("%item" = "bolt") then var itemcount 90
     pause 0.1
     put .break %item %itemcount
     waitforre FIN
     pause
     pause
     send put my %item on large shelf
     pause 0.5
     send get my %item
     pause
     gosub stowing
     put #echo >Log Gold >>--> RESTOCKED AMMO FROM VAULT - %itemcount %item(s)!
     if matchre("%item", "shard") then var BuyRocks 0
     if matchre("%item", "bolt") then var BuyBolts 0
     if matchre("%item", "arrow") then var BuyArrows 0
     pause
     return
NO_VAULT_ITEM:
     var %BuyType 1
     if matchre("%item", "shard") then var BuyRocks 1
     if matchre("%item", "bolt") then var BuyBolts 1
     if matchre("%item", "arrow") then var BuyArrows 1
     return
VAULT_RESTOCK_DONE:
     pause 0.2
     pause 0.1
     var AmmoRestock 0
     put #var AMMOSWAP 0
     put DONE!
     put #parse DONE!
     put #parse DONE!
     pause 7
     if (%BuyRocks = 1) then goto AMMO_RESTOCK_BANK
     if (%BuyArrows = 1) then goto AMMO_RESTOCK_BANK
     if (%BuyBolts = 1) then goto AMMO_RESTOCK_BANK
     goto AMMO_RESTOCK_DONE
#####################################################
## AMMO RESTOCKING
#####################################################
RESTOCK_AMMO:
AMMO_RESTOCK:
RESTOCKAMMO:
AMMOSTOCK:
AMMORESTOCK:
RESTOCKING_AMMO:
RESTOCKINGAMMO:
     var boltloop 0
     var arrowloop 0
     var rockloop 0
     var BuyArrows 0
     var BuyBolts 0
     var BuyRocks 0
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     pause 0.2
     if !matchre("$zoneid", "\b(1|4|7|8|10|30|31|32|33|34|34a|40|42|47|61|65|66|67|68|69|90|99|107|112|116|126|127)\b") then
          {
               echo ############################
               echo *** $zonename - Map $zoneid
               echo *** IS NOT A RECOGNIZED ZONE TO BUY AMMO!
               echo *** TURNING RANGED WEAPONS OFF FOR THIS LOOP
               echo *** SEND ME A TEXT LOG AND YOUR MAP ID IF THIS IS AN ERROR
               echo #############################
               put #echo >Log #ff0000 ** ERROR! $zonename - Map $zoneid - Not a recognized area to buy ammo!
               put #echo >Log #ff0000 ** Turning Off Ranged Weapons this loop - Restock Ammo Manually
               var RangedWeapons 0
               pause 2
               goto RETURN_FROM_RESTOCK
          }
     if (%Necro.Known = 1) then
          {
               echo ###############
               echo *** NECRO KNOWN STATUS!
               echo *** SKIPPING AMMO RESTOCK FOR SAFETY!
               echo *** RESTOCK AMMO MANUALLY
               echo ################
               put #echo >Log #F09C00 *** NECRO KNOWN - SKIPPING AMMO RESTOCK FOR SAFETY! RESTOCK AMMO MANUALLY!!
               pause 2
               goto RETURN_FROM_RESTOCK
          }
     send STORE AMMO in my $UC_Container.Ammo
     wait
     pause 0.2
AMMO_CHECK:
     var AmmoCount 0
     if matchre("$UC_WEAPON_CROSSBOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto AMMO_COUNT_2
     if matchre("$UC_WEAPON_CROSSBOW", "(?i)STONEBOW") then
          {
               var BuyRocks 1
               echo ** Stonebow is our Crossbow - Need to buy ROCKS instead of bolts!
               pause 0.4
               goto AMMO_COUNT_2
          }
AMMO_COUNT_XBOW:
     pause 0.0001
     gosub AMMO_COLLECT %XbowAmmo
     gosub AMMO_COUNT %XbowAmmo
     pause 0.2
     if (%AmmoCount < 15) then goto BOLTS_ON
     goto AMMO_COUNT_2
BOLTS_ON:
     var BuyBolts 1
     echo ** Bolts are out or low! Will restock XBOW BOLTS!
     pause 0.4
AMMO_COUNT_2:
     var AmmoCount 0
     if matchre("$UC_WEAPON_BOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto AMMO_COUNT_3
AMMO_COUNT_BOW:
     pause 0.2
     pause 0.2
     gosub AMMO_COLLECT %BowAmmo
     gosub AMMO_COUNT %BowAmmo
     pause 0.2
     if (%AmmoCount < 15) then goto ARROWS_ON
     goto AMMO_COUNT_3
ARROWS_ON:
     var BuyArrows 1
     echo ** Arrows out or low! Will restock ARROWS!
     pause 0.4
AMMO_COUNT_3:
     var AmmoCount 0
     if matchre("$UC_WEAPON_CROSSBOW", "(?i)STONEBOW") then goto AMMO_COUNT_SLING
     if matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto RESTOCKING_GO
AMMO_COUNT_SLING:
     pause 0.2
     pause 0.2
     gosub AMMO_COLLECT %SlingAmmo
     gosub AMMO_COUNT %SlingAmmo
     pause 0.2
     if (%AmmoCount < 15) then goto STONES_ON
STONES_ON:
     pause 0.2
     var BuyRocks 1
     echo ** Rocks out or low! Will restock ROCKS!
     pause 0.5
RESTOCKING_GO:
     if ((%BuyBolts = 0) && (%BuyArrows = 0) && (%BuyRocks = 0)) then goto AMMO_FALSE_ALARM
     echo
     echo #########################
     echo *** RESTOCKING AMMO SUPPLIES!!
     echo #########################
     echo
     pause
     gosub stowing
TO_VAULT_CHECK:
VAULTCHECK:
     if !matchre("$zoneid", "\b(1|30|42|47|61|67|90|99|107|116)\b") then
          {
               #### ESCAPE TO NEAREST CITY
               var GOSUBBING ON
               var escaping ON
               gosub ESCAPE_NOW
               var GOSUBBING OFF
               #### DONE ESCAPING TO CITY
          }
     if ($VaultAmmo = 1) then
          {
               if (matchre("$UC_VaultCity", "(?i)(CROSS|XING)") && ("$zoneid" = "1")) then goto TO_VAULT
               if (matchre("$UC_VaultCity", "(?i)(RIVER|HAVEN)") && ("$zoneid" = "30")) then goto TO_VAULT
               if (matchre("$UC_VaultCity", "(?i)THEREN") && ("$zoneid" = "42")) then goto TO_VAULT
               if (matchre("$UC_VaultCity", "(?i)SHARD") && ("$zoneid" = "67")) then goto TO_VAULT
               if (matchre("$UC_VaultCity", "(?i)HIB") && ("$zoneid" = "116")) then goto TO_VAULT
               if (matchre("$UC_VaultCity", "(?i)MUSPARI") && ("$zoneid" = "47")) then goto TO_VAULT
               echo *** VAULT AMMO IS ON - BUT WE ARE NOT IN OUR VAULT CITY ($UC_VaultCity)
               echo *** RESTOCKING AMMO LOCALLY WITH SHOP AMMO
               pause 0.5
          }
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.5
AMMO_RESTOCK_BANK:
     if ("$zoneid" = "40a") then
          {
               put .travel haven
               waitforre ^YOU ARRIVED
          }
     if matchre("$zoneid", "(34|34a|33a|33)") then
          {
               put .travel haven
               waitforre ^YOU ARRIVED
          }
     if matchre("$zoneid", "(127|126)") then
          {
               put .travel hib
               waitforre ^YOU ARRIVED
          }
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "69") then gosub AUTOMOVE shard
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     pause 0.2
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "98") then gosub AUTOMOVE aesry
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "69") then gosub AUTOMOVE shard
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     gosub AUTOMOVE teller
AMMO_BANK_WITHDRAW:
     pause 0.2
     matchre AMMO_BANK_WITHDRAW ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre ERROR_BANK ^You must be at a bank
     matchre NO_MONIES_AMMO You don't have that much money|we are not lending money|do not seem to have an account with us
     matchre TO_AMMO_STORE ^The clerk counts out|it looks like your current balance|^You count out|Searching methodically|^You find
     put withdraw 7 gold
     matchwait 20
     put #echo >Log #ff0000 ** MISSING MATCH IN AMMO_BANK_WITHDRAW
     goto NO_MONIES_AMMO
NO_MONIES_AMMO:
     echo ##############################################
     echo *** ERROR! NO MONEY IN $zonename BANK TO BUY AMMO!!!
     echo *** TURNING OFF RANGED WEAPONS FOR THIS RUN
     echo *** PUT PLATS IN ZONE $zonename BANK!!
     echo ##############################################
     put #echo >Log #ff0000 *** ERROR!!! NO MONEY IN BANK TO BUY AMMO!!
     put #echo >Log #ff0000 *** TURNING OFF RANGED WEAPONS UNTIL RESTART
     put #echo >Log #ff0000 *** PUT PLATS IN $zonename BANK!!
     var RangedWeapons 0
     pause
     gosub LEAVE_BANK
     goto RETURN_FROM_RESTOCK
ERROR_BANK:
     echo ###########################
     echo *** ERROR FINDING BANK?
     echo *** PLEASE SEND ME LOG AND ZONE ID
     echo ###########################
     put #echo >Log #ff0000 *** ERROR FINDING BANK FOR AMMO RESTOCK - SEND LOG
     pause
     goto RETURN_FROM_RESTOCK
#### MOVE TO THE AMMO SHOP
TO.AMMO.STORE:
var BuyRocks 1
TO_AMMO_STORE:
     echo
     echo ########################
     echo *** NOW SEARCHING FOR THE AMMO STORE
     echo *** RESTOCKING AMMO
     echo ########################
     echo
     pause 0.5
     gosub stowing
     var boltloop 0
     var arrowloop 0
     var rockloop 0
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if (("$zoneid" = "67") && (%BuyRocks = 1) && (%HaveSkates = 1) && ($Athletics.Ranks > 60)) then
          {
               pause 0.8
               echo ####################
               echo *** ICE SKATES DETECTED!
               echo *** TRAVELING TO BOAR CLAN TO BUY SLING AMMO
               echo ####################
               put .travel boar
               waitforre ^YOU ARRIVED\!
               goto TO_AMMO_STORE_2
          }
     if (("$zoneid" = "67") && (%BuyRocks = 1)) then
          {
               echo ########################
               echo *** WE DON'T HAVE ICE SKATES
               echo *** OR ATHLETICS IS TOO LOW FOR BOAR CLAN
               echo *** TRAVELING TO LETH TO BUY SLING AMMO!
               echo ########################
               pause 0.8
               put .travel leth
               waitforre ^YOU ARRIVED\!
               gosub AUTOMOVE exchange
               pause 0.5
               gosub KRONARS
               pause 0.5
               goto TO_AMMO_STORE_2
          }
     if (("$zoneid" = "30") && (%BuyRocks = 1) && ($Athletics.Ranks > 180)) then
          {
               echo ##########################
               echo *** WE HAVE ENOUGH ATHLETICS FOR SHORTCUT TO LANG
               echo *** TRAVELING TO LANG TO BUY SLING AMMO!
               echo ##########################
               put .travel lang
               waitforre ^YOU ARRIVED\!
               goto TO_AMMO_STORE_2
          }
     if matchre("$zoneid", "(116|124|126)") then
          {
               put .travel boar
               waitforre ^YOU ARRIVED
          }
TO_AMMO_STORE_2:
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "42") then gosub AUTOMOVE gate
     if ("$zoneid" = "1") then gosub AUTOMOVE weapon
     if ("$zoneid" = "30") then gosub AUTOMOVE noel
     if ("$zoneid" = "40") then gosub AUTOMOVE bows
     if ("$zoneid" = "61") then gosub AUTOMOVE bows
     if ("$zoneid" = "66") then gosub AUTOMOVE weapons emporium
     if ("$zoneid" = "90") then gosub AUTOMOVE general
     if ("$zoneid" = "99") then gosub AUTOMOVE bows
     if ("$zoneid" = "107") then gosub AUTOMOVE weapon
     if ("$zoneid" = "116") then
          {
               gosub AUTOMOVE boar
               pause 0.2
               gosub AUTOMOVE boar
               pause 0.2
          }
     if ("$zoneid" = "116") then gosub AUTOMOVE boar
     pause 0.1
     if ("$zoneid" = "126") then gosub AUTOMOVE boar
     pause 0.1
     if ("$zoneid" = "127") then gosub AUTOMOVE weapon
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     pause 0.1
     if (("$zoneid" = "1") && ("$roomid" != "191")) then gosub AUTOMOVE weapon
     if (("$zoneid" = "30") && ("$roomid" != "173")) then gosub AUTOMOVE weapon
     if (("$zoneid" = "40") && ("$roomid" != "247")) then gosub AUTOMOVE bows
     if (("$zoneid" = "61") && ("$roomid" != "160")) then gosub AUTOMOVE bows
     if (("$zoneid" = "66") && ("$roomid" != "149")) then gosub AUTOMOVE 149
     if (("$zoneid" = "90") && ("$roomid" != "327")) then gosub AUTOMOVE general
     if (("$zoneid" = "99") && ("$roomid" != "391")) then gosub AUTOMOVE bows
     if (("$zoneid" = "107") && ("$roomid" != "330")) then gosub AUTOMOVE weapon
     if (("$zoneid" = "127") && ("$roomid" != "66")) then gosub AUTOMOVE weapon
     pause 0.1
     if (("$zoneid" = "1") && ("$roomid" != "191")) then gosub AUTOMOVE weapon
     if (("$zoneid" = "30") && ("$roomid" != "173")) then gosub AUTOMOVE weapon
     if (("$zoneid" = "40") && ("$roomid" != "247")) then gosub AUTOMOVE bows
     if (("$zoneid" = "61") && ("$roomid" != "160")) then gosub AUTOMOVE bows
     if (("$zoneid" = "66") && ("$roomid" != "149")) then gosub AUTOMOVE 149
     if (("$zoneid" = "90") && ("$roomid" != "327")) then gosub AUTOMOVE general
     if (("$zoneid" = "99") && ("$roomid" != "391")) then gosub AUTOMOVE bows
     if (("$zoneid" = "107") && ("$roomid" != "330")) then gosub AUTOMOVE weapon
     if (("$zoneid" = "127") && ("$roomid" != "66")) then gosub AUTOMOVE weapon
     gosub stowing
BUYING_BOLTS:
     if matchre("$UC_WEAPON_CROSSBOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto BUYING_ARROWS
     if (%BuyBolts = 0) then goto BUYING_ARROWS
     put #echo >Log #80ffbf ** Changing Xbow Ammo to: BOLT
     var XbowAmmo bolt
     var BuyBolts 0
     put #var AMMOSWAP 1
BUYING_BOLTS_1:
     pause 0.1
     pause 0.001
     math boltloop add 1
     send buy bolts
     pause 0.4
     pause 0.2
     if (matchre("$righthand", "bolt") || matchre("$lefthand", "bolt")) then goto BOUGHT_BOLTS
     if !matchre("$zoneid", "\b(1|99|40|127)\b") then send offer 135
     if ("$zoneid" = "90") then send offer 345
     if ("$zoneid" = "40") then send offer 137
     pause 0.2
     pause 0.2
     pause 0.1
     if !matchre("$zoneid", "\b(1|99|40|127)\b") then send offer 135
     if ("$zoneid" = "90") then send offer 345
     if ("$zoneid" = "40") then send offer 137
     pause 0.4
     pause 0.2
     pause 0.2
     pause 0.1
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then goto NO_BOLTS
BOUGHT_BOLTS:
     if (!matchre("$righthand", "Empty") && !matchre("$righthand", "%XbowAmmo")) then
          {
               var XbowAmmo $righthand
               eval XbowAmmo replacere("%XbowAmmo", "s$", "")
               echo *** NEW XBOW AMMO - %XbowAmmo
               pause 0.1
          }
     if (!matchre("$lefthand", "Empty") && !matchre("$lefthand", "%XbowAmmo")) then
          {
               var XbowAmmo $lefthand
               eval XbowAmmo replacere("%XbowAmmo", "s$", "")
               echo *** NEW XBOW AMMO - %XbowAmmo
               pause 0.1
          }
     gosub STOWIT %XbowAmmo
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then gosub stowing
     pause 0.2
     gosub AMMO_COUNT %XbowAmmo
     pause 0.1
     if ((%boltloop > 1) && ($circle < 50)) then
          {
               if (%AmmoCount < 30) then goto BUYING_BOLTS_1
               put #echo >Log #00ff00 Â»Â»Â»---âº RESTOCKED AMMO! Bought ~30 XBOW BOLTS!
               goto BUYING_ARROWS
          }
     if ((%boltloop > 3) && ($circle < 100)) then
          {
               if (%AmmoCount < 60) then goto BUYING_BOLTS_1
               put #echo >Log #00ff00 Â»Â»Â»---âº RESTOCKED AMMO! Bought ~60 XBOW BOLTS!
               goto BUYING_ARROWS
          }
     if (%boltloop > 5) then
          {
               if (%AmmoCount < 100) then goto BUYING_BOLTS_1
               put #echo >Log #00ff00 Â»Â»Â»---âº RESTOCKED AMMO! Bought ~100 XBOW BOLTS!
               goto BUYING_ARROWS
          }
     goto BUYING_BOLTS_1
NO_BOLTS:
     echo
     echo *** NO XBOW BOLTS! TURNING CROSSBOW OFF
     echo
     put #echo >Log #ffff66 ** No Xbow ammo found at $zonename! Turning Xbow off
     var XBOW.OFF 1
BUYING_ARROWS:
     if matchre("$UC_WEAPON_BOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto BUYING_ROCKS
     if (%BuyArrows = 0) then goto BUYING_ROCKS
     put #echo >Log #80ffbf ** Changing Bow Ammo to: ARROW
     var BowAmmo arrow
     var BuyArrows 0
     put #var AMMOSWAP 1
BUYING_ARROWS_1:
     pause 0.1
     pause 0.001
     math arrowloop add 1
     if ("$zoneid" = "1") then send buy arrow
     if !matchre("$zoneid", "\b(1|99)\b") then send buy barbed arrow
     if ("$zoneid" = "99") then send buy blunt arrow
     pause 0.4
     pause 0.3
     if (matchre("$righthand", "arrows") || matchre("$lefthand", "arrows")) then goto BOUGHT_ARROWS
     if !matchre("$zoneid", "\b(1|40|61|99|127)\b") then send offer 190
     if ("$zoneid" = "99") then send offer 840
     if matchre("$zoneid", "\b(40|61)\b") then send offer 235
     pause 0.2
     pause 0.2
     pause 0.1
     if !matchre("$zoneid", "\b(1|40|61|99|127)\b") then send offer 190
     if ("$zoneid" = "99") then send offer 840
     if matchre("$zoneid", "\b(40|61)\b") then send offer 235
     pause 0.6
     pause 0.2
     pause 0.2
     pause 0.1
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then goto NO_ARROWS
BOUGHT_ARROWS:
     if (!matchre("$righthand", "Empty") && !matchre("$righthand", "%XbowAmmo")) then
          {
               var BowAmmo $righthand
               eval BowAmmo replacere("%BowAmmo", "s$", "")
               echo *** BOW AMMO - %BowAmmo
               pause 0.1
          }
     if (!matchre("$lefthand", "Empty") && !matchre("$lefthand", "%XbowAmmo")) then
          {
               var BowAmmo $lefthand
               eval BowAmmo replacere("%BowAmmo", "s$", "")
               echo *** BOW AMMO - %BowAmmo
               pause 0.1
          }
     gosub STOWIT %BowAmmo
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then gosub stowing
     pause 0.2
     gosub AMMO_COUNT %BowAmmo
     pause 0.1
     if ((%arrowloop > 2) && ($circle < 50)) then
          {
               if (%AmmoCount < 30) then goto BUYING_ARROWS_1
               put #echo >Log #00ff00 Â»Â»Â»---âº RESTOCKED AMMO! Bought ~30 ARROWS!
               goto BUYING_ROCKS
          }
     if ((%arrowloop > 5) && ($circle < 100)) then
          {
               if (%AmmoCount < 60) then goto BUYING_ARROWS_1
               put #echo >Log #00ff00 Â»Â»Â»---âº RESTOCKED AMMO! Bought ~60 ARROWS!
               goto BUYING_ROCKS
          }
     if (%arrowloop > 9) then
          {
               if (%AmmoCount < 100) then goto BUYING_ARROWS_1
               put #echo >Log #00ff00 Â»Â»Â»---âº RESTOCKED AMMO! Bought ~100 ARROWS!
               goto BUYING_ROCKS
          }
     goto BUYING_ARROWS_1
NO_ARROWS:
     echo
     echo *** NO ARROWS! TURNING BOWS OFF
     echo
     put #echo >Log #ffff66 ** No Bow ammo found at $zonename! Turning Bow off
     var BOW.OFF 1
BUYING_ROCKS:
     if matchre("$UC_WEAPON_CROSSBOW", "(?i)STONEBOW") then goto BUYING_ROCKS_0
     if matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then goto AMMO_RESTOCK_DONE
BUYING_ROCKS_0:
     if (%BuyRocks = 0) then goto AMMO_RESTOCK_DONE
     if ("$zoneid" = "107") then goto NO_ROCKS
     if ("$zoneid" = "67") then goto NO_ROCKS
     if ("$zoneid" = "30") then goto NO_ROCKS
     if ("$zoneid" = "90") then goto NO_ROCKS
     put #echo >Log #80ffbf ** Changing Sling Ammo to: ROCK
     var SlingAmmo rock
     var BuyRocks 0
     put #var AMMOSWAP 1
BUYING_ROCKS_1:
     pause 0.1
     pause 0.001
     math rockloop add 1
     send buy small rock
     pause 0.4
     pause 0.3
     if (matchre("$righthand", "rocks") || matchre("$lefthand", "rocks")) then goto BOUGHT_ROCKS
     if matchre("$zoneid", "\b(40|61|127)\b") then send offer 112
     pause 0.2
     if matchre("$zoneid", "\b(40|61|127)\b") then send offer 112
     pause 0.6
     pause 0.3
     pause 0.2
     pause 0.1
     if (("$righthand" = "Empty") && ("$lefthand" = "Empty")) then goto NO_ROCKS
BOUGHT_ROCKS:
     if (!matchre("$righthand", "Empty") && !matchre("$righthand", "%XbowAmmo")) then
          {
               var SlingAmmo $righthand
               eval SlingAmmo replacere("%SlingAmmo", "s$", "")
               echo *** SLING AMMO - %SlingAmmo
               pause 0.1
          }
     if (!matchre("$lefthand", "Empty") && !matchre("$lefthand", "%XbowAmmo")) then
          {
               var SlingAmmo $lefthand
               eval SlingAmmo replacere("%SlingAmmo", "s$", "")
               echo *** SLING AMMO - %SlingAmmo
               pause 0.1
          }
     gosub STOWIT %SlingAmmo
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then gosub stowing
     pause 0.2
     gosub AMMO_COUNT %SlingAmmo
     if ("$zoneid" = "1") then
          {
               if ((%rockloop > 2) && ($circle < 50)) then
                    {
                         put #echo >Log #00ff00 Â»Â»Â»---âº RESTOCKED AMMO! Bought ~30 small rocks!
                         goto AMMO_RESTOCK_DONE
                    }
               if (%rockloop > 5) then
                    {
                         put #echo >Log #00ff00 Â»Â»Â»---âº RESTOCKED AMMO! Bought ~60 small rocks!
                         goto AMMO_RESTOCK_DONE
                    }
          }
     if ("$zoneid" != "1") then
          {
          if ((%rockloop > 0) && ($circle < 50)) then
               {
                    put #echo >Log #00ff00 Â»Â»Â»---âº RESTOCKED AMMO! Bought ~30 small rocks!
                    goto AMMO_RESTOCK_DONE
               }
          if (%rockloop > 1) then
               {
                    put #echo >Log #00ff00 Â»Â»Â»---âº RESTOCKED AMMO! Bought ~60 small rocks!
                    goto AMMO_RESTOCK_DONE
               }
          }
     goto BUYING_ROCKS_1
NO_ROCKS:
     echo
     echo *** NO ROCKS! TURNING SLINGS OFF
     echo
     put #echo >Log #ffff66 ** No Sling ammo found at $zonename! Turning Slings off
     var SLING.OFF 1
     goto AMMO_RESTOCK_DONE
#########################################
AMMO_FALSE_ALARM:
     echo
     echo ####################################
     echo *** FALSE ALARM! Seems no ammo is needed...
     echo ####################################
     echo
     pause 0.5
     send out
     pause 0.1
     var AmmoRestock 0
     var boltloop 0
     var arrowloop 0
     var rockloop 0
     var loading 1
     gosub LOAD_VARS
     var loading 0
     unvar boltloop
     unvar arrowloop
     unvar rockloop
     unvar BuyArrows
     unvar BuyBolts
     unvar BuyRocks
     goto RETURN_FROM_RESTOCK
AMMO_RESTOCK_DONE:
     send out
     pause 0.2
     pause 0.1
     gosub stowing
     var AmmoRestock 0
     var boltloop 0
     var arrowloop 0
     var rockloop 0
     unvar boltloop
     unvar arrowloop
     unvar rockloop
     unvar BuyArrows
     unvar BuyBolts
     unvar BuyRocks
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     put #echo >Log #cc0066 ** RESTOCKED AMMO! FKING ROBUST! \m/_(>_<)_\m/
     goto RETURN_FROM_RESTOCK
########################################################################
### LOGIC TO CONDENSE ALL AMMO INTO ONE SINGLE BAG FOR COUNTING PURPOSES
COLLECT_AMMO:
AMMO_COLLECT:
     var collectloop 0
     var ammo $0
     echo
     echo ################
     echo # CONDENSING ALL AMMO
     echo # INTO AMMO CONTAINER:
     echo # $UC_Container.Ammo
     echo ################
     echo
     pause 0.1
     gosub AMMO_COLLECTING $UC_Container
     gosub AMMO_COLLECTING $UC_Container.Backup
     gosub AMMO_COLLECTING $UC_Container.Crafting
     gosub AMMO_COLLECTING $UC_Container.Sheath
     gosub AMMO_COLLECTING $UC_Container.Wand1
     gosub AMMO_COLLECTING $UC_Container.Wand2
     gosub AMMO_COLLECTING $UC_Container.Textbook
     return
AMMO_COLLECTING:
     var ammoContainer $0
AMMO_COLLECT_1:
     if matchre("%ammoContainer", "(?i)$UC_Container.Ammo") then goto AMMO_COLLECT_DONE
     if matchre("$UC_Container.Ammo", "(?i)%ammoContainer") then goto AMMO_COLLECT_DONE
     math collectloop add 1
     pause 0.01
     pause 0.01
     matchre AMMO_COLLECT_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre AMMO_STOWING ^You get|^You pull|^You slip
     matchre AMMO_COLLECT_DONE ^I could not|^What were you
     put get %ammo from my %ammoContainer
     matchwait 7
     return
AMMO_STOWING:
     var todo %ammo
     pause 0.1
     gosub PUT put %ammo in my %UC_Container.Ammo
     pause 0.01
     if matchre("$righthand $lefthand", "(?i)%ammo") then gosub PUT put %ammo in my %UC_Container.Ammo.Backup
     if (("$righthand" != "Empty") || ("$lefthand" != "Empty")) then gosub stowing
     if (%collectloop > 10) then goto AMMO_COLLECT_DONE
     goto AMMO_COLLECT_1
AMMO_COLLECT_DONE:
     var collectloop 0
     pause 0.001
     return
#########################################################################################
##### AMMO COUNT LOGIC - gosub AMMO_COUNT bolts - returns numbers of bolts as %AmmoCount
AMMO_COUNT:
     var AmmoCheck $0
     var AmmoCount 0
     var AmmoLoop 0
     pause 0.1
     AMMO_COUNT_1:
     math AmmoLoop add 1
     pause 0.1
     if (%AmmoLoop > 2) then goto AMMO_SET_NULL
     matchre AMMO_COUNT_1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre AMMO_SET_NULL ^I could not|^What were you
     matchre AMMO_SET ^You count .+ there (?:are|is) (.*) (?:left|remaining)\.
     put count my %AmmoCheck
     matchwait 9
AMMO_SET_NULL:
     var AmmoCount 0
     pause 0.2
     goto AMMO_COUNT_PARSE
AMMO_SET:
     var AmmoCount $1
     pause 0.2
     gosub TEXT_TO_NUMBER %AmmoCount
     pause 0.1
     pause 0.1
     var AmmoCount %text_to_number
     pause 0.1
AMMO_COUNT_PARSE:
     echo ##########################
     echo *** Counted %AmmoCount %AmmoCheck
     echo ##########################
     return
#########################################################################################
##### NOOB LOOP (SIT IN ONE ROOM - NO COMBAT )
NOOB:
NOOB_LOOP:
     var noobloop
     var NoCombat 1
     var CURRENT n00b Training
     gosub STATUSBAR
NOOB_LOOP_1:
     echo
     echo #####################################
     echo ** NOOB TRAINING ROUTINE!
     echo ** THIS IS INTENDED FOR TOTAL NOOB CHARACTERS
     echo ** MAINLY FOR SCHOLARSHIP CLASSES / LEARNING IN ONE ROOM
     echo
     echo ** WILL PREFER TO GO FC PORTAL ROOM IF IN TF OR FANGECOVE ON
     echo ** OTHERWISE SITS IN THE ROOM YOU START IT IN AND TRAINS
     echo ** WILL AUTO-TRAIN CLIMBING IF IN CROSSING OR SHARD
     echo #####################################
     echo
     pause 4
     var NoobRoom $roomid
NOOB_TRAIN:
     pause 0.5
     if matchre("$zoneid", "\b(1|30|40|42|61|67|99|106|107|108|112|114|116|127)\b") then
          {
               if (("$game" = "DRF") || ($UC_Premium = 1) && ("%FANGCOVE" = "ON")) then
                    {
                         if ("$zoneid" = "42") then gosub AUTOMOVE gate
                         if ("$zoneid" = "112") then gosub AUTOMOVE leth
                         if ("$zoneid" = "127") then gosub AUTOMOVE south
                         pause 0.2
                         pause 0.2
                         gosub TO_SEACAVE
                         goto NOOB_TRAIN_2
                    }
          }
NOOB_TRAIN_2:
     if (("$game" != "DRF") || ("%FANGCOVE" != "ON")) then
          {
               if ($roomid != "%NoobRoom") then gosub AUTOMOVE %NoobRoom
          }
     gosub stowing
     if ($UC_Tarantula = 1) then gosub TARANTULA_TIMER
     if ($UC_Almanac = 1) then gosub ALMANAC_TIMER
     if matchre("$guild", "%MAGICUSER") then gosub PERCEIVE_TIMER
     if ("$guild" = "Moon Mage") then gosub OBSERVE_CHECK
     if ($UC_Crystal = 1) then gosub CRYSTAL_TIMER
     gosub BUFF_UP
     if ((%Listening = 0) && matchre("$roomplayers", "(Odium|Bayndayd)")) then send poke $1
     pause 0.4
     if ($UC_Textbook = 1) then gosub TEXTBOOK_TIMER
     if (($UC_Textbook = 1) && ($Scholarship.LearningRate < 33) && (%TextbookLast > 60)) then
          {
               gosub GET my %TEXTBOOK.TYPE
               pause 0.4
               if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub TEXTBOOK_READ normal
               if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub PUT put %TEXTBOOK.TYPE in my $UC_Container.Textbook
               if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub STOW my %TEXTBOOK.TYPE
          }
NOOB_SPELL:
     if (%noobloop > %totalspells) then var noobloop 0
     if (matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (%Playing = 1) then gosub STOP_PLAY
     gosub COLLECT rock
     pause 0.2
     gosub COLLECT rock
     pause 0.2
     if (matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub COLLECT rock
     pause 0.2
     gosub KICKEM
     if (%Playing = 0) then gosub PLAY
     if (matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (matchre("$guild", "%MAGICUSER") && ("$preparedspell" != "None")) then gosub PREPARE %abbrevs(%noobloop)
     if (%Playing = 1) then gosub STOP_PLAY
     gosub COLLECT rock
     pause 0.2
     if (matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub COLLECT rock
     pause 0.2
     if (matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     gosub COLLECT rock
     pause 0.2
     gosub KICKEM
     if (matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (%Playing = 0) then gosub PLAY
     pause 0.4
     put app my %CHEST.ARMOR
     pause 2
     pause
     if (matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     put app my %HEAD.ARMOR
     pause 2
     pause
     put app my %LEG.ARMOR
     pause 2
     pause
     if (matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (%Playing = 1) then gosub STOP_PLAY
     if (matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if (matchre("$guild", "%MAGICUSER") && ($Sorcery.Ranks < 60)) then
          {
               put get my runestone
               pause
               pause 0.5
               if !matchre("$righthand $lefthand", "runestone") then goto NOOB_LOOP_DONE
               gosub NOOB_RUNE
          }
NOOB_LOOP_DONE:
     math noobloop add 1
     if ($Athletics.LearningRate < 2) then goto NOOB_CLIMBRUN
     goto NOOB_TRAIN

NOOB_CLIMBRUN:
     if matchre("%MAGIC.ROPE", "(?i)(ON|1|YES)") then goto NOOB_ROPE
     if ($Athletics.LearninRate < 24) then goto NOOB_TRAIN
     if ("$zoneid" = "150") then gosub LEAVE.SEACAVE
     pause 0.2
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "1") then
          {
               put .climbcross
               waitforre DONE CLIMBING
          }
     if ("$zoneid" = "67") then
          {
               put .climbshard
               waitforre DONE CLIMBING
          }
     goto NOOB_TRAIN

NOOB_RUNE:
     var runeloop 0
NOOB_RUNE_1:
     math runeloop add 1
     if (%runeloop > 6) then return
     if (matchre("$guild", "%MAGICUSER") then gosub MAGIC_PREP
     if ($Sorcery.LearningRate > 28) then return
     put focus my rune
     pause
     pause 0.5
     goto NOOB_RUNE_1

NOOB_ROPE:
     if ($UC_Zills = 1) then gosub ZILL_MAINTAIN
     gosub ATHLETICS_SONG
     if ((%Playing = 0) && ($UC_Zills = 0)) then send hum $SONG
     if ((%Playing = 0) && ($UC_Zills = 1)) then send play $SONG
     var magicRopeLoop 0
     pause 0.2
     gosub stowing
     pause 0.2
     if !matchre("%Rope.Container", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub GET my %ROPE.NAME from my %Rope.Container
     pause 0.5
     if !matchre("$righthand $lefthand", "rope") then gosub GET my rope from my %Rope.Container
     pause 0.3
     if !matchre("$righthand $lefthand", "rope") then gosub GET my %ROPE.NAME
     pause 0.2
     pause 0.1
     if !matchre("$righthand $lefthand", "rope") then
          {
               gosub clear
               goto NOOB_TRAIN
          }
NOOB_ROPE_CLIMB:
     pause 0.1
     if ($standing = 0) then gosub STAND
     if ((%Playing = 0) && ($UC_Zills = 0)) then send hum $SONG
     if ((%Playing = 0) && ($UC_Zills = 1)) then send play $SONG
     pause 0.2
     math magicRopeLoop add 1
     if (%magicRopeLoop > 9) then goto NOOB_ROPE_FINISHED
     matchre NOOB_ROPE_CLIMB ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre NOOB_ROPE_CHECK ^You finish practicing|^This climb is no challenge|^The rope's will quickly fades
     matchre NOOB_ROPE_HARD ^(The|This) climb is too difficult
     matchre NOOB_ROPE_EASY ^(The|This) climb is too easy
     matchre NOOB_TRAIN ^You are engaged|^You can\'t climb
     matchre NOOB_STAND ^You should probably
     put climb practice my rope
     matchwait 120
NOOB_ROPE_CHECK:
     send stop climb
     pause 0.2
     if ($standing = 0) then gosub STAND
     pause 0.2
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.1
NOOB_ROPE_CHECK_1:
     if (%magicRopeLoop > 4) then goto NOOB_ROPE_FINISHED
     if ($Athletics.LearningRate > 30) then goto NOOB_ROPE_FINISHED
     echo *** Magic Rope Loop: %magicRopeLoop
     goto NOOB_ROPE_CLIMB
NOOB_STAND:
     gosub STAND
     goto NOOB_ROPE_CLIMB

NOOB_ROPE_FINISHED:
     pause 0.3
     send stop climb
     pause 0.5
     pause 0.3
     if !matchre("%Rope.Container", "(?i)(OFF|NULL|NIL)") then gosub PUT put my rope in my %Rope.Container
     pause 0.3
     gosub stowing
     put #echo >Log Aqua *** Trained ATHLETICS w/ Magic Climbing Rope! %magicRopeLoop loops to $Athletics.Ranks $Athletics.LearningRate / 34
NOOB_ROPE_DONE:
     if ($standing = 0) then gosub STAND
     # put #echo >Log Aqua **** Climbing Run Completed!
     if matchre("%Zill.Name", "(?i)cowbells?") then gosub PERFORMANCE_COWBELL
     if !matchre("%Zill.Name", "(?i)cowbells?") then gosub PERFORMANCE
     gosub stowing
     gosub clear
     goto NOOB_TRAIN

NOOB_ROPE_HARD:
     var hard 1
     pause 0.5
     put stop play
     pause 0.5
     echo ** Magic rope song too hard! - Downshifting song..
     echo ** Current Song: $SONG
     pause 0.5
     goto NOOB_SHIFT
NOOB_ROPE_EASY:
     var hard 0
     pause 0.5
     put stop play
     pause 0.5
     echo ** Magic rope song too easy! - Upshifting song..
     echo ** Current Song: $SONG
     pause 0.5
     goto NOOB_SHIFT
NOOB_SHIFT:
     var songs %song0|%song1|%song2|%song3|%song4|%song5|%song6|%song7|%song8|%song9|%song10|%song11|%song12|%song13|%song14|%song15|%song16|%song17|%song18|%song19|%song20|%song21|%song22|%song23|%song24|%song25|%song26|%song27|%song28|%song29|%song30
     var totalsongs 31
     var i 0
     if matchre("$SONG", "%song0") then var i 0
     if matchre("$SONG", "%song1") then var i 1
     if matchre("$SONG", "%song2") then var i 2
     if matchre("$SONG", "%song3") then var i 3
     if matchre("$SONG", "%song4") then var i 4
     if matchre("$SONG", "%song5") then var i 5
     if matchre("$SONG", "%song6") then var i 6
     if matchre("$SONG", "%song7") then var i 7
     if matchre("$SONG", "%song8") then var i 8
     if matchre("$SONG", "%song9") then var i 9
     if matchre("$SONG", "%song10") then var i 10
     if matchre("$SONG", "%song11") then var i 11
     if matchre("$SONG", "%song12") then var i 12
     if matchre("$SONG", "%song13") then var i 13
     if matchre("$SONG", "%song14") then var i 14
     if matchre("$SONG", "%song15") then var i 15
     if matchre("$SONG", "%song16") then var i 16
     if matchre("$SONG", "%song17") then var i 17
     if matchre("$SONG", "%song18") then var i 18
     if matchre("$SONG", "%song19") then var i 19
     if matchre("$SONG", "%song20") then var i 20
     if matchre("$SONG", "%song21") then var i 21
     if matchre("$SONG", "%song22") then var i 22
     if matchre("$SONG", "%song23") then var i 23
     if matchre("$SONG", "%song24") then var i 24
     if matchre("$SONG", "%song25") then var i 25
     if matchre("$SONG", "%song26") then var i 26
     if matchre("$SONG", "%song27") then var i 27
     if matchre("$SONG", "%song28") then var i 28
     if matchre("$SONG", "%song29") then var i 29
     if matchre("$SONG", "%song30") then var i 30
NOOB_SONG_SHIFT:
     pause 0.1
     if (%i > %totalsongs) then return
     var CurrentSong %songs(%i)
     pause 0.1
     if (%hard = 1) then goto NOOB_DOWNSHIFT
     math i add 1
     pause 0.1
     if matchre("%CurrentSong", "%songs(%i)") then return
     if ("%CurrentSong" = "") then return
     put #var SONG %songs(%i)
     echo ** NEW SONG: $SONG
     pause
     goto NOOB_ROPE_CLIMB
NOOB_DOWNSHIFT:
     math i subtract 1
     put #var SONG %songs(%i)
     echo ** NEW SONG: $SONG
     pause
     goto NOOB_ROPE_CLIMB

##############################################################################
##############################################################################
EYE_HERBS:
     pause 0.1
     if (%have_sufil = 0) then gosub BUY_SUFIL
     pause 0.5
     put eat sufil sap
     pause
     return
BUY_SUFIL:
     pause 0.1
     gosub AUTOMOVE teller
     pause 0.5
     put withdraw 750 copper
     pause
     pause 0.5
     gosub AUTOMOVE herb
     pause 0.7
     put buy sufil sap
     wait
     pause 0.3
     put offer 700
     pause 0.5
     put offer 700
     pause 0.5
     pause 0.5
     put eat sufil sap
     pause
     gosub stowing
     var HaveSufil 1
     return
################################
# BLEEDER CHECK/TENDING SYSTEM
################################
#### QUICK HERB HEALING
HERB_CHECK:
     delay 0.0001
     if ("%BLEEDING_HEAD" = "YES") then
          {
               if (%have_nemoih = 1) then send eat nemoih root
               pause 0.4
          }
     if ("%BLEEDING_NECK" = "YES") then
          {
               if (%have_riolur = 1) then send eat riolur leaf
               pause 0.4
               if (%have_georin = 1) then send eat georin salve
               pause 0.4
          }
     if ("%BLEEDING_CHEST" = "YES") then
          {
               if (%have_plovik = 1) then send eat plovik leaf
               pause 0.4
               if (%have_ithor = 1) then
                    {
                         gosub GET ithor potion
                         send drink ithor pot
                         pause 0.3
                         pause 0.1
                         gosub STOWIT ithor potion
                    }
               pause 0.4
               pause 0.0001
          }
     if ("%BLEEDING_ABDOMEN" = "YES") then
          {
               if (%have_nilos = 1) then send eat nilos salve
               pause 0.4
               pause 0.0001
               if (%have_muljin = 1) then send eat muljin sap
               pause 0.4
          }
     if ("%BLEEDING_BACK" = "YES") then
          {
               if (%have_nemoih = 1) then send eat nemoih root
               pause 0.4
               if (%have_hulnik = 1) then send eat hulnik grass
               pause 0.3
          }
     if (("%BLEEDING_R_ARM" = "YES") || ("%BLEEDING_L_ARM" = "YES") || ("%BLEEDING_R_LEG" = "YES") || ("%BLEEDING_L_LEG" = "YES") || ("%BLEEDING_R_HAND" = "YES") || ("%BLEEDING_L_HAND" = "YES")) then
          {
               if (%have_jadice = 1) then send eat jadice flower
               pause 0.3
               if (%have_yelith = 1) then send eat yelith root
               pause 0.3
          }
     if (("%BLEEDING_L_EYE" = "YES") || ("%BLEEDING_R_EYE" = "YES")) then
          {
               if (%have_sufil = 1) then send eat sufil sap
               pause 0.3
          }
     #if "%BLEEDING_SKIN" = "YES" then gosub tend skin
     return
BLEEDERCHECK:
BLEEDER.CHECK:
BLEEDCHECK:
     var INFECTED NO
     if (("$righthand" != "Empty") || ("$lefthand" != "Empty")) then gosub stowing
     # action goto BLEEDCHECK when The bandages binding your (.+) soak through with blood becoming useless and you begin bleeding again\.
     action var BLEEDING_HEAD YES when ^(?!.*\(tended\))\s*(head)\s{7}(.*)
     action var BLEEDING_NECK YES when ^(?!.*\(tended\))\s*(neck)\s{7}(.*)
     action var BLEEDING_CHEST YES when ^(?!.*\(tended\))\s*(chest)\s{7}(.*)
     action var BLEEDING_ABDOMEN YES when ^(?!.*\(tended\))\s*(abdomen)\s{7}(.*)
     action var BLEEDING_BACK YES when ^(?!.*\(tended\))\s*(back)\s{7}(.*)
     action var BLEEDING_R_ARM YES when ^(?!.*\(tended\))\s*r(?:ight|.) arm\s{7}(.*)
     action var BLEEDING_L_ARM YES when ^(?!.*\(tended\))\s*l(?:eft|.) arm\s{7}(.*)
     action var BLEEDING_R_LEG YES when ^(?!.*\(tended\))\s*r(?:ight|.) leg\s{7}(.*)
     action var BLEEDING_L_LEG YES when ^(?!.*\(tended\))\s*l(?:eft|.) leg\s{7}(.*)
     action var BLEEDING_R_HAND YES when ^(?!.*\(tended\))\s*r(?:ight|.) hand\s{7}(.*)
     action var BLEEDING_L_HAND YES when ^(?!.*\(tended\))\s*l(?:eft|.) hand\s{7}(.*)
     action var BLEEDING_L_EYE YES when ^(?!.*\(tended\))\s*l(?:eft|.) eye\s{7}(.*)
     action var BLEEDING_R_EYE YES when ^(?!.*\(tended\))\s*r(?:ight|.) eye\s{7}(.*)
     action var BLEEDING_SKIN YES when ^(?!.*\(tended\))\s*(skin)\s{7}(.*)
     action var BLEEDING_HEAD YES when (lodged\s*.*|mite|leech) (into|in|on) your head
     action var BLEEDING_NECK YES when (lodged\s*.*|mite|leech) (into|in|on) your neck
     action var BLEEDING_CHEST YES when (lodged\s*.*|mite|leech) (into|in|on) your chest
     action var BLEEDING_ABDOMEN YES when (lodged\s*.*|mite|leech) (into|in|on) your abdomen
     action var BLEEDING_BACK YES when (lodged\s*.*|mite|leech) (into|in|on) your back
     action var BLEEDING_R_ARM YES when (lodged\s*.*|mite|leech) (into|in|on) your right arm
     action var BLEEDING_L_ARM YES when (lodged\s*.*|mite|leech) (into|in|on) your left arm
     action var BLEEDING_R_LEG YES when (lodged\s*.*|mite|leech) (into|in|on) your right leg
     action var BLEEDING_L_LEG YES when (lodged\s*.*|mite|leech) (into|in|on) your left leg
     action var BLEEDING_R_HAND YES when (lodged\s*.*|mite|leech) (into|in|on) your right hand
     action var BLEEDING_L_HAND YES when (lodged\s*.*|mite|leech) (into|in|on) your left hand
     action var BLEEDING_L_EYE YES when (lodged\s*.*|mite|leech) (into|in|on) your left eye
     action var BLEEDING_R_EYE YES when (lodged\s*.*|mite|leech) (into|in|on) your right eye
     action var POISONED YES when ^You.+(poisoned)
BLEEDYES:
     echo [Checking Health / Bleeders]
     if matchre("$righthandnoun $lefthandnoun", "(spear|fragment|arrow|thorn|bolt|shard|mite|leech|axe|worm)") then
          {
               put drop $1
               pause 0.2
          }
     if matchre("$righthandnoun $lefthandnoun", "(spear|fragment|arrow|thorn|bolt|shard|mite|leech|axe|worm)") then
          {
               put drop $1
               pause 0.2
          }
     matchre BLEEDYES ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre YESBLEEDING Bleeding|bleeding|arrow lodged|bolt lodged|spear lodged|fragment lodged|thorn lodged|axe lodged|mite|blood worm
     matchre YESBLEEDING lodged (shallowly|deeply|firmly|savagely|in your)
     matchre END.OF.BLEEDER ^You pause a moment|^The THINK verb|^Syntax\:|^Thinking|Related verbs
     matchre bleedyes It\'s all a blur\!
     put -health;-0.01 think
     matchwait 20
     echo [No bleeder found - exiting bleeder check]
     goto END.OF.BLEEDER
YESBLEEDING:
     echo
     echo **** BLEEDING! ****
     echo
     delay 0.00001
     if (($monstercount > 0) || matchre("$roomobjs", "(?i)%critters")) then gosub RETREAT
     if ("%INFECTED" = "YES") then
          {
               echo
               echo ***********************************
               echo *** WARNING ** WOUNDS INFECTED! ***
               echo ***********************************
               echo
               pause 0.1
          }
     if ("%BLEEDING_HEAD" = "YES") then gosub tend head
     if ("%BLEEDING_NECK" = "YES") then gosub tend neck
     if ("%BLEEDING_CHEST" = "YES") then gosub tend chest
     if ("%BLEEDING_ABDOMEN" = "YES") then gosub tend abdomen
     if ("%BLEEDING_BACK" = "YES") then gosub tend back
     if ("%BLEEDING_R_ARM" = "YES") then gosub tend right arm
     if ("%BLEEDING_L_ARM" = "YES") then gosub tend left arm
     if ("%BLEEDING_R_LEG" = "YES") then gosub tend right leg
     if ("%BLEEDING_L_LEG" = "YES") then gosub tend left leg
     if ("%BLEEDING_R_HAND" = "YES") then gosub tend right hand
     if ("%BLEEDING_L_HAND" = "YES") then gosub tend left hand
     if ("%BLEEDING_L_EYE" = "YES") then gosub tend left eye
     if ("%BLEEDING_R_EYE" = "YES") then gosub tend right eye
     #if ("%BLEEDING_SKIN" = "YES") then gosub tend skin
     goto END.OF.BLEEDER
TEND:
     var bleeder $0
     echo
     echo ******************************
     echo ** Tending Bleeder: %bleeder **
     echo ******************************
     echo
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.0001
     # if $prone then gosub STAND
tend_bleeder:
     pause 0.0001
     pause 0.0001
     send tend my %bleeder
     pause 0.8
     pause 0.5
     pause 0.0001
     pause 0.0001
     gosub DUMPSTER_SET
     if !matchre("%dumpster", "(NULL|gelapod)") then
          {
               pause 0.0001
               if (!matchre("$righthand", "Empty") && matchre("$righthand", "(arrow|thorn|bolt|fragment)")) then put put my $righthandnoun in %dumpster
               if (!matchre("$lefthand", "Empty") && matchre("$lefthand", "(arrow|thorn|bolt|fragment)")) then put put my $lefthandnoun in %dumpster
               pause 0.5
          }
     if matchre("%dumpster", "gelapod") then
          {
               pause 0.0001
               if (!matchre("$righthand", "Empty") && matchre("$righthand", "(arrow|thorn|bolt|fragment)")) then put feed my $righthandnoun to gelapod
               if (!matchre("$lefthand", "Empty") && matchre("$lefthand", "(arrow|thorn|bolt|fragment)")) then put feed my $lefthandnoun to gelapod
               pause 0.5
          }
     if (!matchre("$righthand","Empty") && ("%dumpster" != "NULL") && matchre("$righthand", "(arrow|thorn|bolt|fragment)")) then put drop my $righthand
     if (!matchre("$lefthand","Empty") && ("%dumpster" != "NULL") && matchre("$lefthand", "(arrow|thorn|bolt|fragment)")) then put drop my $lefthand
     if matchre("$righthand $lefthand", "hurling axe") then put drop axe
     if matchre("$righthand $lefthandn", "spear") then put drop spear
     if matchre("$righthand $lefthand", "fragment") then put drop fragment
     if matchre("$righthandnoun $lefthandnoun", "arrow") then put drop arrow
     if matchre("$righthandnoun $lefthandnoun", "thorn") then put drop thorn
     if matchre("$righthandnoun $lefthandnoun", "bolt") then put drop bolt
     if matchre("$righthandnoun $lefthandnoun", "arrow") then put drop arrow
     if matchre("$righthandnoun $lefthandnoun", "thorn") then put drop thorn
     if matchre("$righthandnoun $lefthandnoun", "bolt") then put drop bolt
tend_bleeder2:
     delay 0.0001
     gosub put tend my %bleeder
     delay 0.0001
     gosub DUMPSTER_SET
     if !matchre("%dumpster", "(NULL|gelapod)") then
          {
               pause 0.001
               if !matchre("$righthand", "Empty") then put put my $righthandnoun in %dumpster
               if !matchre("$lefthand", "Empty") then put put my $lefthandnoun in %dumpster
               pause 0.5
          }
     if matchre("%dumpster", "gelapod") then
          {
               pause 0.001
               if !matchre("$righthand", "Empty") then put feed my $righthandnoun to gelapod
               if !matchre("$lefthand", "Empty") then put feed my $lefthandnoun to gelapod
               pause 0.5
          }
     delay 0.0001
     if !matchre("$righthand","Empty") && ("%dumpster" != "NULL") then put drop my $righthand
     if !matchre("$lefthand","Empty") && ("%dumpster" != "NULL") then put drop my $lefthand
     delay 0.0001
     if matchre("$righthandnoun $lefthandnoun", "axe") then put drop axe
     if matchre("$righthandnoun $lefthandnoun", "spear") then put drop spear
     if matchre("$righthandnoun $lefthandnoun", "fragment") then put drop fragment
     if matchre("$righthandnoun $lefthandnoun", "arrow") then put drop arrow
     if matchre("$righthandnoun $lefthandnoun", "thorn") then put drop thorn
     if matchre("$righthandnoun $lefthandnoun", "bolt") then put drop bolt
     if matchre("$righthandnoun $lefthandnoun", "arrow") then put drop arrow
     if matchre("$righthandnoun $lefthandnoun", "thorn") then put drop thorn
     if matchre("$righthandnoun $lefthandnoun", "bolt") then put drop bolt
     echo [Leaving Bleeder System]
     return
END.OF.BLEEDER:
     action remove The bandages binding your (.+) soak through with blood becoming useless and you begin bleeding again\.
     action remove ^(?!.*\(tended\))\s*(head)\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*(neck)\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*(chest)\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*(abdomen)\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*(back)\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*r(?:ight|.) arm\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*l(?:eft|.) arm\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*r(?:ight|.) leg\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*l(?:eft|.) leg\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*r(?:ight|.) hand\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*l(?:eft|.) hand\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*l(?:eft|.) eye\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*r(?:ight|.) eye\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*(skin)\s{7}(.*)
     action remove (lodged\s*.*|mite|leech) (into|in|on) your head
     action remove (lodged\s*.*|mite|leech) (into|in|on) your neck
     action remove (lodged\s*.*|mite|leech) (into|in|on) your chest
     action remove (lodged\s*.*|mite|leech) (into|in|on) your abdomen
     action remove (lodged\s*.*|mite|leech) (into|in|on) your back
     action remove (lodged\s*.*|mite|leech) (into|in|on) your right arm
     action remove (lodged\s*.*|mite|leech) (into|in|on) your left arm
     action remove (lodged\s*.*|mite|leech) (into|in|on) your right leg
     action remove (lodged\s*.*|mite|leech) (into|in|on) your left leg
     action remove (lodged\s*.*|mite|leech) (into|in|on) your right hand
     action remove (lodged\s*.*|mite|leech) (into|in|on) your left hand
     action remove (lodged\s*.*|mite|leech) (into|in|on) your left eye
     action remove (lodged\s*.*|mite|leech) (into|in|on) your right eye
     action remove ^You have no significant injuries\.
     return
##############################################
## DUMPSTER SET
#############################################
DUMPSTER_SET:
DUMPSTER_CHECK:
     var dumpster NULL
     if matchre("$roomobjs", "a small hole") then var dumpster hole
     if matchre("$roomobjs", "a small mud puddle") then var dumpster puddle
     if matchre("$roomobjs", "a marble statue ") then var dumpster statue
     if matchre("$roomobjs", "(a disposal bin|a waste bin|firewood bin)") then var dumpster bin
     if matchre("$roomobjs", "(a tree hollow|darken hollow)") then var dumpster hollow
     if matchre("$roomobjs", "a bucket of viscous gloop|(a|metal|iron|steel|rusted|waste) bucket") then var dumpster bucket
     if matchre("$roomobjs", "a large stone turtle") then var dumpster turtle
     if matchre("$roomobjs", "an oak crate") then var dumpster crate
     if matchre("$roomobjs", "a driftwood log") then var dumpster log
     if matchre("$roomobjs", "(ivory|stone) urn") then var dumpster urn
     if matchre("$roomobjs", "a waste basket") then var dumpster basket
     if matchre("$roomobjs", "a bottomless pit") then var dumpster pit
     if matchre("$roomobjs", "trash receptacle") then var dumpster receptacle
     if matchre("$roomobjs", "domesticated gelapod") then var dumpster gelapod
     if matchre("$roomobjs", "large wooden barrel") then var dumpster barrel
     if matchre("$roomname", "^\[Garden Rooftop, Medical Pavilion\]") then var dumpster gutter
     return
#########################################################################################################################
### ARMOR REMOVAL AND WEARING
#########################################################################################################################
ARMOR_INIT:
     put #script abort mastercraft
     if ($standing = 0) then gosub STAND
     if ($UC_ArmorCheck = 0) then return
     action (retreat) on
     echo
     echo ##########################
     echo *** ARMOR.CHECK is ~ON~
     echo *** REMOVING ~ALL~ ARMOR FIRST!
     echo *** TO MAKE SURE CORRECT ARMOR IS ON
     echo ##########################
     echo
     delay 0.00001
     gosub stowing
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     gosub ARMOR_REMOVE
     gosub WEAR_ARMOR
     return
ARMOR_REMOVE:
     var countarmor 0
HAND_CHECK:
     delay 0.0001
     matchre REMOVE_ARMOR (hand wraps|handwraps|knuckles|hand claws|knuckleguards)
     matchre ARMOR_CHECK You have nothing of that sort|You are wearing nothing of that sort|You aren't wearing anything
     put inv hand weapon
     matchwait 20
     goto ARMOR_CHECK

ARMOR_CHECK:
     delay 0.00001
     matchre ARMOR_CHECK ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre REMOVE_ARMOR \bhelm|((?<=field|fluted|full|half|war|battle|lamellar|Imperial|kiralan|blue|blackened|jousting|silver|white|lunated|sniper's|icesteel|goffered|fluted|polished) (\bplate\b)(?! armor| gauntlets| gloves| greaves| helm| mask| balaclava| shirt)|steel plate(?! armor| gauntlets| gloves| greaves| helm| mask))|(?<=field|assassin's|chain|leather|bone|quilted|reed|black|plate|combat|body|clay|lamellar|hide|steel|mail|pale|polished|shadow|Suit of|suit|woven|yeehar-hide|kidskin|gladiatorial|sniper|sniper's|battle|tomiek|glaes|pale|ceremonial|sinuous|trimmed|carapace|Zaulguum-skin|coral|dark|violet|ridged) (\barmor\b)|armet(?! helm)|gauntlet|gloves|(?!pavise)shield|claw guards|kimono|odaj|(?<!ka'hurst )mail gloves|platemail legs|trousers|parry stick|leggings|handwraps|gown|\bhat\b|hand claws|boots|armguard|jacket|goggle|armwraps|footwraps|aegis|torso|buckler|\bhood\b|\bcowl\b|\bheater(?! shield)|\bpavise(?! shield)|scutum|sipar|\btarge\b|aventail|backplate|balaclava|barbute|bascinet|breastplate|\bcap\b|longcoat|legwraps|\bcoat\b|\bcowl|cuirass|fauld|greaves|hauberk|\bhood\b|jerkin|leathers|lorica|mantle|(?<!crimson leather )\bmask\b|morion|pants|handguards|bodysuit|robe|sallet|(?<!fighting )shirt|sleeves|ticivara|tabard|tasset|thorakes|\blid\b|vambraces|vest|collar|coif|mitt|steel mail(?! armor| gauntlets| gloves| greaves| helm| mask| balaclava| shirt)|darkened mail|velnhliwa|bamarhliwa|shalhliwa|tunic|chausses|carapace(?! armor)
     matchre ARMOR_NONE You have nothing of that sort|You are wearing nothing of that sort|You aren't wearing anything
     matchre ARMOR_CHECK You can\'t do that\.|^You put|^I could|^(You|I) can't|^What
     put inv armor
     matchwait 9
     put #echo >Log #ff0000 *** MISSING MATCH IN ARMOR_CHECK!
     put #parse MISSING MATCH IN ARMOR_CHECK
     goto ARMOR_CHECK2
ARMOR_CHECK2:
     matchre ARMOR_CHECK2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre REMOVE_ARMOR \bhelm|((?<=field|fluted|full|half|war|battle|lamellar|Imperial|kiralan|blue|blackened|jousting|silver|white|lunated|sniper's|icesteel|goffered|fluted|polished) (\bplate\b)(?! armor| gauntlets| gloves| greaves| helm| mask| balaclava| shirt)|steel plate(?! armor| gauntlets| gloves| greaves| helm| mask))|(?<=field|assassin's|chain|leather|bone|quilted|reed|black|plate|combat|body|clay|lamellar|hide|steel|mail|pale|polished|shadow|Suit of|suit|woven|yeehar-hide|kidskin|gladiatorial|sniper|sniper's|battle|tomiek|glaes|pale|ceremonial|sinuous|trimmed|carapace|Zaulguum-skin|coral|dark|violet|ridged) (\barmor\b)|armet(?! helm)|gauntlet|gloves|(?!pavise)shield|claw guards|kimono|odaj|(?<!ka'hurst )mail gloves|platemail legs|trousers|parry stick|leggings|handwraps|gown|\bhat\b|hand claws|boots|armguard|jacket|goggle|armwraps|footwraps|aegis|torso|buckler|\bhood\b|\bcowl\b|\bheater(?! shield)|\bpavise(?! shield)|scutum|sipar|\btarge\b|aventail|backplate|balaclava|barbute|bascinet|breastplate|\bcap\b|longcoat|legwraps|\bcoat\b|\bcowl|cuirass|fauld|greaves|hauberk|\bhood\b|jerkin|leathers|lorica|mantle|(?<!crimson leather )\bmask\b|morion|pants|handguards|bodysuit|robe|sallet|(?<!fighting )shirt|sleeves|ticivara|tabard|tasset|thorakes|\blid\b|vambraces|vest|collar|coif|mitt|steel mail(?! armor| gauntlets| gloves| greaves| helm| mask| balaclava| shirt)|darkened mail|velnhliwa|bamarhliwa|shalhliwa|tunic|chausses|carapace(?! armor)
     matchre ARMOR_COMPLETE You have nothing of that sort|You are wearing nothing of that sort|You aren't wearing anything
     matchre ARMOR_CHECK2 You can\'t do that\.|^You put|^I could|^(You|I) can't|^What
     put inv armor
     matchwait 9
     put #echo >Log #ff0000 *** MISSING MATCH IN ARMOR_CHECK2!
     put #parse MISSING MATCH IN ARMOR_CHECK2
     goto ARMOR_CHECK2
REMOVE_ARMOR:
     var armor $0
     var ArmorContainer $UC_Container
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     matchre REMOVE_ARMOR ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_ARMOR (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre STOW_ARMOR ^Without any effort|the .* slide off|tug the .* free|Shaking your head|^Wiggling|slide themselves off|The carapace armor pulls itself into your hand
     matchre GET_ARMOR ^The .+ shakes violently
     matchre GET_ARMOR ^You have nothing of that|^Remove what|^What
     put remove my %armor
     matchwait 9
     put #echo >Log #ff0000 *** MISSING MATCH IN REMOVE_ARMOR!
     put #parse MISSING MATCH IN REMOVE_ARMOR
     goto STOW_ARMOR
GET_ARMOR:
     matchre GET_ARMOR ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_ARMOR (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre STOW_ARMOR ^Without any effort|the .* slide off|tug the .* free|Shaking your head|^Wiggling|slide themselves off|The carapace armor pulls itself into your hand
     matchre ARMOR_CHECK ^You have nothing of that|^Remove what|^What|^I could|^Please
     put get my %armor
     matchwait 9
     put #echo >Log #ff0000 *** MISSING MATCH IN GET_ARMOR!
     put #parse MISSING MATCH IN GET_ARMOR
     goto STOW_ARMOR
OPEN_ARMOR1:
     gosub OPEN %ArmorContainer
STOW_ARMOR:
     delay 0.0001
     delay 0.0001
     pause 0.0001
     pause 0.0001
     if matchre("$righthand $lefthand" "(\w+) orb\b") then
          {
               var orbtype $1
               pause 0.3
               var armor %orbtype orb
               var ARMOR.CHEST %orbtype orb
               echo
               echo *** SETTING CHEST ARMOR VAR TO: %orbtype orb
               echo
               pause 0.3
               goto STOW_ARMOR_1
          }
STOW_ARMOR_1:
     if !matchre("$UC_Container", "(?i)$BURGLE.PACK") then var ArmorContainer $UC_Container.Box
     if !matchre("$UC_Container.Box", "(?i)$BURGLE.PACK") then var ArmorContainer $UC_Container.Backup
     if !matchre("$UC_Container.Backup", "(?i)$BURGLE.PACK") then var ArmorContainer $UC_Container.Crafting
     if !matchre("$UC_Container.Crafting", "(?i)$BURGLE.PACK") then var ArmorContainer $UC_Container
     if matchre("%ArmorContainer", "(?i)NULL|NIL") then var ArmorContainer $UC_Container
     delay 0.0001
     gosub SHEATH_CHECK
     matchre STOW_ARMOR ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre OPEN_ARMOR1 ^But that's closed
     matchre TIE_ARMOR ^You can't put that there\!
     matchre TIE_ARMOR ^There\'s no room|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^(You|I) can't|^Tie what\?|^You just can't|As you attempt to place your
     matchre ARMOR_DONE (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre STOW_ARMOR ^Without any effort|the .* slide off|tug the .* free|Shaking your head|^Wiggling|slide themselves off
     matchre ARMOR_DONE ^You put|^I could|^(You|I) can't|^What
     put put %armor in my %ArmorContainer
     matchwait 9
TIE_ARMOR:
     delay 0.0001
     matchre TIE_ARMOR ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_ARMOR_2 ^There\'s no room|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^(You|I) can't|^Tie what\?|^You just can't
     matchre ARMOR_DONE (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre ARMOR_DONE ^You put|^I could|^(You|I) can't|^What
     put tie %armor to my %ArmorContainer
     matchwait 9
OPEN_ARMOR2:
     gosub OPEN %Container.Boxes
STOW_ARMOR_2:
     matchre STOW_ARMOR_2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre OPEN_ARMOR2 ^But that's closed
     matchre TIE_ARMOR_2 ^You can't put that there\!
     matchre STOW_ARMOR_3 ^There\'s no room|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^(You|I) can't|^Tie what\?|^You just can't
     matchre ARMOR_DONE ^You put|^I could|^(You|I) can't|^What
     put put %armor in my %Container.Boxes
     matchwait 9
TIE_ARMOR_2:
     pause 0.0001
     matchre TIE_ARMOR_2 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre STOW_ARMOR_3 ^There\'s no room|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^(You|I) can't|^Tie what\?|^You just can't|As you attempt to place your
     matchre ARMOR_DONE (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre ARMOR_DONE ^You put|^I could|^(You|I) can't|^What
     put tie %armor to my %Container.Boxes
     matchwait 8
OPEN_ARMOR_3:
     gosub OPEN %Container.Backup
STOW_ARMOR_3:
     matchre STOW_ARMOR_3 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre OPEN_ARMOR_3 ^But that's closed
     matchre TIE_ARMOR_3 ^You can't put that there\!
     matchre TIE_ARMOR_3 ^There\'s no room|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^(You|I) can't|^Tie what\?|^You just can't|As you attempt to place your
     matchre ARMOR_DONE (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre ARMOR_DONE ^You put|^I could|^(You|I) can't|^What
     put put %armor in my %Container.Backup
     matchwait 9
TIE_ARMOR_3:
     pause 0.0001
     matchre TIE_ARMOR_3 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre NO_MORE_STOWING ^There\'s no room|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^(You|I) can't|^Tie what\?|^You just can't|As you attempt to place your
     matchre ARMOR_DONE (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre ARMOR_DONE ^You put|^I could|^(You|I) can't|^What
     put tie %armor to my %Container.Backup
     matchwait 9
OPEN_ARMOR_4:
     gosub OPEN %Container.Sheath
STOW_ARMOR_4:
     matchre STOW_ARMOR_4 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre OPEN_ARMOR_4 ^But that's closed
     matchre TIE_ARMOR_4 ^You can't put that there\!
     matchre TIE_ARMOR_4 ^There\'s no room|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^(You|I) can't|^Tie what\?|^You just can't|As you attempt to place your
     matchre ARMOR_DONE (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre ARMOR_DONE ^You put|^I could|^(You|I) can't|^What
     put put %armor in my %Container.Sheath
     matchwait 9
TIE_ARMOR_4:
     pause 0.0001
     matchre TIE_ARMOR_3 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre NO_MORE_STOWING ^There\'s no room|any more room|no matter how you arrange|too heavy|too thick|too long|too wide|not designed to carry|cannot hold any more|^(You|I) can't|^Tie what\?|^You just can't
     matchre ARMOR_DONE (You'?r?e?|As|With) (?:accept|add|adjust|allow|already|are|aren't|ask|attach|attempt|.+ to|.+ fan|bash|begin|bend|blow|breathe|briefly|bundle|cannot|can't|chop|circle|close|corruption|count|combine|come|carefully|dance|decide|dodge|don't|drum|draw|effortlessly|gracefully|deftly|desire|detach|drop|drape|exhale|fade|fail|fake|feel(?! fully rested)|feint|fill|find|filter|form|fumble|gesture|gingerly|get|glance|grab|hand|hang|have|icesteel|insert|kiss|kneel|knock|leap|lean|let|lose|lift|loosen|lob|load|move|must|mind|not|now|need|offer|open|parry|place|pick|push|pout|pour|put|pull|press|quietly|quickly|raise|read|reach|ready|realize|recall|remain|release|remove|retreat|reverently|roll|rub|scan|search|secure|sense|set|sheathe|shield|shouldn't|shove|silently|sit|slide|sling|slip|slowly|spin|spread|sprinkle|stop|strap|struggle|swiftly|swing|switch|tap|take|the|though|tie|tilt|toss|trace|try|tug|turn|twist|unload|untie|vigorously|wave|wear|weave|whisper|will|wink|wring|work|yank|you|zills) .*(?:\.|\!|\?)?
     matchre ARMOR_DONE ^You put|^I could|^(You|I) can't|^What
     put tie %armor to my %Container.Sheath
     matchwait 9
ARMOR_DONE:
     math armorcount add 1
     var total.armor %armorcount
     var armor%armorcount %armor
     goto ARMOR_CHECK2
ARMOR_NONE:
     echo **** NO ARMOR FOUND!
     var ARMOR_STOW OFF
     action (retreat) off
     return
ARMOR_COMPLETE:
     var ARMOR_STOW ON
     echo
     echo ################
     echo # Removed all armor
     echo # Saved Armor Count: %total.armor
     if (%total.armor < 1) then
          {
               echo ## NO ARMOR FOUND
               echo ################
               echo
               return
          }
     echo ## Armor1: %armor1
     if (%total.armor < 2) then goto ARMOR_COMPLETE_DONE
     echo ## Armor2: %armor2
     if (%total.armor < 3) then goto ARMOR_COMPLETE_DONE
     echo ## Armor3: %armor3
     if (%total.armor < 4) then goto ARMOR_COMPLETE_DONE
     echo ## Armor4: %armor4
     if (%total.armor < 5) then goto ARMOR_COMPLETE_DONE
     echo ## Armor5: %armor5
     if (%total.armor < 6) then goto ARMOR_COMPLETE_DONE
     echo ## Armor6: %armor6
     if (%total.armor < 7) then goto ARMOR_COMPLETE_DONE
     echo ## Armor7: %armor7
     if (%total.armor < 8) then goto ARMOR_COMPLETE_DONE
ARMOR_COMPLETE_DONE:
     echo ################
     echo
     pause 0.0001
     action (retreat) off
     action remove ^You shake your .+ causing it to break apart into thousands of live spiders\.\s+The swarm of arachnids scuttles quickly up your arm, nestling themselves on your person until they finally melt and coagulate into a (.*)\.$
     return
NO_MORE_STOWING:
     echo **   No more room for stowing armor! Just gonna go for it **
     echo **   Make some more room in your bags! Or get larger containers!
     put #echo >Log #ff0000 *** Out of room for stowing armor! Get larger bags!!
     put wear %armor
     pause 0.5
     gosub stowing
     pause 0.5
     return

ARMOR_WEAR:
WEAR_ARMOR:
     var armorloop 0
     action (retreat) on
     delay 0.00001
     echo
     echo ##################
     echo *** PUTTING ARMOR ON! ***
     echo ##################
     echo
     pause 0.0001
     if (%Melee.Range = 1) then
          {
               send retreat
               pause 0.1
               pause 0.0001
               pause 0.0001
          }
     gosub stowing
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     # if (("$guild" = "Cleric") && ($SpellTimer.ShieldofLight.active = 1)) then goto ARMOR_CHECKING_2
     if !matchre("%MyShield", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               action (shield) on
               echo *** WEARING SHIELD: %MyShield ***
               if ((%HaveExoShield = 1) && matchre("$UC_MyShield", "(exo shield|exoskeletal shield|orbweaver ring|widow ring|tarantula ring)")) then gosub EXO_SHIELD_CHECK
               gosub GET my %MyShield
               pause 0.001
               if !matchre("$righthand", "(?i)%MyShield") then gosub PUT untie my %MyShield
               gosub SHIELD_CHECK
               action (shield) off
          }
     if ((%Backtraining = 1) && !matchre("%B.CHEST.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.CHEST %B.CHEST.ARMOR
     if ((%Backtraining = 0) && !matchre("$UC_Armor.Chest", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.CHEST $UC_Armor.Chest
ARMOR_CHECKING_2:
     math armorloop add 1
     if (%armorloop > 2) then
          {
               var armorloop 0
               goto ARMOR_CHECKING_3
          }
     if !matchre("%ARMOR.CHEST", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               echo *** PUT ON CHEST ARMOR: %ARMOR.CHEST ***
               gosub GET my %ARMOR.CHEST
               pause 0.0001
               gosub GLANCE
               if !matchre("$righthand", "(?i)%ARMOR.CHEST") then gosub GET my %ARMOR.CHEST from my watery portal
               if (!matchre("$righthand", "(?i)%ARMOR.CHEST") && matchre("%ARMOR.CHEST", "(?i)(armor|carapace)")) then
                    {
                         var ARMOR.CHEST %orbtype orb
                         goto ARMOR_CHECKING_2
                    }
               if (!matchre("$righthand", "(?i)%ARMOR.CHEST") && matchre("%ARMOR.CHEST", "orb")) then
                    {
                         var ARMOR.CHEST armor
                         goto ARMOR_CHECKING_2
                    }
               if !matchre("$righthand", "(?i)%ARMOR.CHEST") then gosub PUT untie my %ARMOR.CHEST
               pause 0.0001
               #### EXO-ARMOR LOGIC - SET ARMOR TO WHAT THE ORBS WILL SHIFT INTO
               if matchre("$righthand", "indigo orb") then var ARMOR.CHEST chitinous carapace
               if matchre("$righthand", "viscid orb") then var ARMOR.CHEST violet armor
               if matchre("$righthand", "clouded orb") then var ARMOR.CHEST ridged armor
               if matchre("$righthand", "(violet|black|audrualm|orichalcum|bone-white|dark|white|stirring|oiled|chitinous) orb") then var ARMOR.CHEST carapace armor
               if matchre("$righthand", "orb\b") then
                    {
                         gosub PUT rub my orb
                         pause 0.2
                    }
               if !matchre("$righthand", "orb\b") then gosub PUT wear my %ARMOR.CHEST
               pause 0.0001
          }
ARMOR_CHECKING_3:
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     if ((%Backtraining = 1) && !matchre("%B.FACE.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.FACE %B.FACE.ARMOR
     if ((%Backtraining = 0) && !matchre("$UC_Armor.Chest", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.FACE $UC_Armor.Face
     if !matchre("%ARMOR.FACE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub stowing
               echo *** PUT ON FACE ARMOR: %ARMOR.FACE ***
               gosub GET my %ARMOR.FACE
               pause 0.0001
               gosub GLANCE
               if !matchre("$righthand", "(?i)%ARMOR.FACE") then gosub GET my %ARMOR.FACE from my watery portal
               pause 0.0001
               if !matchre("$righthand", "(?i)%ARMOR.FACE") then gosub PUT untie my %ARMOR.FACE
               if matchre("$righthand", "\borb\b") then gosub PUT rub my $righthandnoun
               else gosub PUT wear my %ARMOR.FACE
               pause 0.0001
          }
     if ((%Backtraining = 1) && !matchre("%B.HEAD.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.HEAD %B.HEAD.ARMOR
     if ((%Backtraining = 0) && !matchre("$UC_Armor.Head", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.HEAD $UC_Armor.Head
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     if !matchre("%ARMOR.HEAD", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub stowing
               echo *** PUT ON HEAD ARMOR: %ARMOR.HEAD ***
               gosub GET my %ARMOR.HEAD
               pause 0.0001
               gosub GLANCE
               if !matchre("$righthand", "(?i)%ARMOR.HEAD") then gosub GET my %ARMOR.HEAD from my watery portal
               pause 0.0001
               if !matchre("$righthand", "(?i)%ARMOR.HEAD") then gosub PUT untie my %ARMOR.HEAD
               if matchre("$righthand", "\borb\b") then gosub PUT rub my $righthandnoun
               else gosub PUT wear my %ARMOR.HEAD
               pause 0.0001
          }
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     if ((%Backtraining = 1) && !matchre("%B.ARM.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.ARMS %B.ARM.ARMOR
     if ((%Backtraining = 0) && !matchre("$UC_Armor.Arms", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.ARMS $UC_Armor.Arms
     if !matchre("%ARMOR.ARMS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub stowing
               echo *** PUT ON ARM ARMOR: %ARMOR.ARMS ***
               gosub GET my %ARMOR.ARMS
               pause 0.0001
               gosub GLANCE
               if !matchre("$righthand", "(?i)%ARMOR.ARMS") then gosub GET my %ARMOR.ARMS from my watery portal
               pause 0.0001
               if !matchre("$righthand", "(?i)%ARMOR.ARMS") then gosub PUT untie my %ARMOR.ARMS
               if matchre("$righthand", "\borb\b") then gosub PUT rub my $righthandnoun
               else gosub PUT wear my %ARMOR.ARMS
               pause 0.0001
          }
     if ((%Backtraining = 1) && !matchre("%B.ABDOMEN.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.ABDOMEN %B.ABDOMEN.ARMOR
     if ((%Backtraining = 0) && !matchre("$UC_Armor.Abdomen", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.ABDOMEN $UC_Armor.Abdomen
     if !matchre("%ARMOR.ABDOMEN", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub stowing
               echo *** PUT ON ABDOMEN ARMOR: %ARMOR.ABDOMEN ***
               gosub GET my %ARMOR.ABDOMEN
               pause 0.0001
               gosub GLANCE
               if !matchre("$righthand", "(?i)%ARMOR.ABDOMEN") then gosub GET my %ARMOR.ABDOMEN from my watery portal
               pause 0.0001
               if !matchre("$righthand", "(?i)%ARMOR.ABDOMEN") then gosub PUT untie my %ARMOR.ABDOMEN
               if matchre("$righthand", "\borb\b") then gosub PUT rub my $righthandnoun
               else gosub PUT wear my %ARMOR.ABDOMEN
               pause 0.0001
          }
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     if ((%Backtraining = 1) && !matchre("%B.BACK.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.BACK %B.BACK.ARMOR
     if ((%Backtraining = 0) && !matchre("$UC_Armor.Back", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.BACK $UC_Armor.Back
     if !matchre("%ARMOR.BACK", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub stowing
               echo *** PUT ON BACK ARMOR: %ARMOR.BACK ***
               gosub GET my %ARMOR.BACK
               pause 0.0001
               gosub GLANCE
               if !matchre("$righthand", "(?i)%ARMOR.BACK") then gosub GET my %ARMOR.BACK from my watery portal
               pause 0.0001
               if !matchre("$righthand", "(?i)%ARMOR.BACK") then gosub PUT untie my %ARMOR.BACK
               if matchre("$righthand", "\borb\b") then gosub PUT rub my $righthandnoun
               else gosub PUT wear my %ARMOR.BACK
               pause 0.0001
          }
     if ((%Backtraining = 1) && !matchre("%B.HAND.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.HANDS %B.HAND.ARMOR
     if ((%Backtraining = 0) && !matchre("$UC_Armor.Hands", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.HANDS $UC_Armor.Hands
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     if !matchre("%ARMOR.HANDS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub stowing
               echo *** PUT ON HAND ARMOR: %ARMOR.HANDS ***
               gosub GET my %ARMOR.HANDS
               pause 0.0001
               gosub GLANCE
               if !matchre("$righthand", "(?i)%ARMOR.HANDS") then gosub GET my %ARMOR.HANDS from my watery portal
               pause 0.0001
               if !matchre("$righthand", "(?i)%ARMOR.HANDS") then gosub PUT untie my %ARMOR.HANDS
               if matchre("$righthand", "\borb\b") then gosub PUT rub my $righthandnoun
               else gosub PUT wear my %ARMOR.HANDS
               pause 0.0001
          }
     if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
     if ((%Backtraining = 1) && !matchre("%B.LEG.ARMOR", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.LEGS %B.LEG.ARMOR
     if ((%Backtraining = 0) && !matchre("$UC_Armor.Legs", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.LEGS $UC_Armor.Legs
     if !matchre("%ARMOR.LEGS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub stowing
               echo *** PUT ON LEG ARMOR: %ARMOR.LEGS ***
               gosub GET my %ARMOR.LEGS
               pause 0.0001
               gosub GLANCE
               if !matchre("$righthand", "(?i)%ARMOR.LEGS") then gosub GET my %ARMOR.LEGS from my watery portal
               pause 0.0001
               if !matchre("$righthand", "(?i)%ARMOR.LEGS") then gosub PUT untie my %ARMOR.LEGS
               if matchre("$righthand", "\borb\b") then gosub PUT rub my $righthandnoun
               else gosub PUT wear my %ARMOR.LEGS
               pause 0.0001
          }
     if ((%Backtraining = 1) && !matchre("%B.KNUCKLE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.KNUCKLE %B.KNUCKLE
     if ((%Backtraining = 0) && !matchre("$UC_Armor.Knuckle", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then var ARMOR.KNUCKLE $UC_Armor.Knuckle
     if !matchre("%ARMOR.KNUCKLE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               gosub stowing
               echo *** PUT ON FIST WEAPON: %ARMOR.KNUCKLE ***
               gosub GET my %ARMOR.KNUCKLE
               pause 0.0001
               gosub GLANCE
               if !matchre("$righthand", "(?i)%ARMOR.KNUCKLE") then gosub GET my %ARMOR.KNUCKLE from my watery portal
               pause 0.0001
               if !matchre("$righthand", "(?i)%ARMOR.KNUCKLE") then gosub PUT untie my %ARMOR.KNUCKLE
               gosub PUT wear my %ARMOR.KNUCKLE
               pause 0.0001
          }
     if ($UC_ParryStick = 1) then
          {
               gosub GET %PARRYSTICK
               pause 0.0001
               if !matchre("$righthand", "(?i)%PARRYSTICK") then gosub GET my %PARRYSTICK from my watery portal
               pause 0.0001
               if !matchre("$righthand", "(?i)%PARRYSTICK") then gosub PUT untie my %PARRYSTICK
               gosub PUT wear my %PARRYSTICK
          }
     echo
     echo ###################
     echo *** NOW WEARING ALL ARMOR!
     echo ###################
     echo
     put inv armor
     action (retreat) off
     pause 0.0001
     return
##################################################################
## CHECK TO MAKE SURE MAIN BAG IS EQUIPPED AND NOT CRAFTING BAG
##################################################################
CRAFTING_SACK_CHECK:
     if ($UC_VaultSwap = 0) then return
     echo
     echo ###########################
     echo *** Check for Crafting Container Mixup
     echo ###########################
     echo
     matchre CRAFTING_SACK_CHECK ^\s*\.\.\.wait|^You are still stunned
     matchre CRAFTING_SACK_CHECK_RETURN ^I could not|^What were you|^Tap what
     matchre RETURN_VAULTSACK ^You tap
     put tap my $UC_VaultBag
     matchwait 3
     return

RETURN_VAULTSACK:
     var precheck 1
     echo
     echo ########################
     echo *** FOUND CRAFTING BAG ON US
     echo *** GOING TO VAULT TO SWAP BAGS
     echo ########################
     echo
     pause 0.8
     gosub VAULT_CITY_GO
     pause 0.2
     gosub VAULTING22
CRAFTING_SACK_CHECK_RETURN:
     var precheck 0
     return
#############################################################
######################################################
## CHECK FOR NO INVENTORY TO RECOVER ITEMS FROM JAIL
JAILED_CHECK:
     echo
     echo *** Checking for no inventory (Jail check)
     echo
     pause 0.0001
     matchre RECOVER_JAIL ^You aren't wearing anything special\.
     matchre RECOVER_JAIL_END INVENTORY HELP
     put inv
     matchwait 3
     return
RECOVER_JAIL:
     pause 0.0001
     pause 0.0001
     pause 0.0001
     var LAST RECOVER_JAIL_END
     echo
     echo #######################
     echo ** NO INVENTORY DETECTED!!
     echo ** ATTEMPTING TO PAY DEBT
     echo ** RECOVER ITEMS FROM JAIL!
     echo #######################
     echo
     put #echo >Log #EDC64E *** NO INVENTORY ERROR! ATTEMPTING RECOVER ITEMS FROM JAIL!
     pause 2
     if !matchre("$zoneid", "\b(1|30|42|47|61|67|90|107|116)\b") then
          {
               #### ESCAPE TO NEAREST CITY
               var GOSUBBING ON
               var escaping ON
               gosub ESCAPE_NOW
               var GOSUBBING OFF
               #### DONE ESCAPING TO CITY
          }
     goto DEBT
RECOVER_JAIL_END:
     return
###########################################
## TICKET CHECK / FULL INVENTORY CHECK
INVENTORY_PRECHECK:
     var nocheck $1
     var TotalRope 0
     var TotalPouches 0
     var TotalBoxes 0
     var AltPouches 0
     var TotalLead 0
     var HaveBoxes 0
     var HaveCardCase 0
     var HaveCards 0
     var CardsCount 0
     var HaveDamaris 0
     var HaveFavorIdol 0
     var IdolType NULL
     var HaveFinesse 0
     var HaveBandolier 0
     var HaveQuiverBolt 0
     var HaveQuiverArrow 0
     var HaveExoShield 0
     var HaveCloth 0
     var HaveTorch 0
     var HaveFlint 0
     var HaveCandle 0
     var HaveIncense 0
     var HaveWine 0
     var HaveSage 0
     var HaveFlint 0
     var HaveLavender 0
     var HaveChamomile 0
     var HaveDirt 0
     var HaveOil 0
     var NeedOil 0
     var HaveSkates 0
     var HaveFragment 0
     var HaveFragSack 0
     var HaveTicket 0
     var HaveAnloral 0
     var HaveSmallSack 0
     var HaveLargeSack 0
     var HaveLighter 0
     var HaveGaethzen 0
     var HaveGoggles 0
     var HaveLantern 0
     var HaveStarglass 0
     var Necro.Material 0
     var NeedRope 1
     var IcicleCount 0
     if ($UC_Lighter = 1) then
     {
          action var HaveLighter 1 when (?i)%Lighter.Name
     }
     action var HaveExoShield 1;var ExoShieldType $1 when (orbweaver ring|widow ring|tarantula ring|exoskeletal shield)
     action var HaveBandolier 1 when ice-veined leather bandolier
     action var HaveFavorIdol 1;var IdolType $1 when ((?<=glittering )sun|(?<=dreamstone )moon|(?<=glistening )star|(?<=bloodfire )shell) idol
     action var HaveQuiverBolt 1 when drake-hide quiver studded
     action var HaveQuiverArrow 1 when drake-hide quiver limned
     action var HaveFragment 1 when glowing iron fragment
     action var HaveCloth 1 when (chamois|linen|needlework|silk|cotton) cloth
     action var HaveCardCase 1 when card collector's case
     action var HaveCards 1;var CardsCount add 1 when (?:an?) (.+) card\b$
     action var HaveFragSack 1 when  star-streaked midnight black sack
     action var HaveCandle 1 when (altar|votive) candle
     action var HaveAnloral 1;var Anloral $1 when [Aa]nloral (\w+) pin
     action var HaveStarglass 1 when starglass
     action var HaveFinesse 1 when glittery platinum poppet
     action var HaveGoggles 1 when wraparound goggles
     action var HaveGaethzen 1;var Gaethzen.Type $1 when [Gg]aethzen (\w+)
     action var HaveLantern 1 when (oil|copper|tin|lelori|horn|gravedigger's) lantern
     action var HaveOil 1 when ((?<!miner's )lamp|fish|coal) oil
     action var HaveTicket 1;var TicketType $1 when (Catrox|Randal|Unspiek|Wyla|Kamze|Dagul|Ylono|Lakyan|Osmandikar|Krrikt'k|Raven|Ladar|Shh'yris|Sefu|Fekoeti|Diwitt|repairman).*ticket
     action var HaveSmallSack 1 when a small sack
     action var HaveLargeSack 1 when a large sack
     action var HaveFlint 1 when piece of black flint
     action var HaveTorch 1 when \btorch\b
     action var HaveSkates 1 when ice skates
     action var HaveBoxes 1;math TotalBoxes add 1 when (brass|copper|deobar|driftwood|iron|ironwood|mahogany|oaken|pine|steel|wooden) (coffer|trunk|chest|strongbox|skippet|caddy|crate|casket|(?<!(?i)training )box)
     action math IcicleCount add 1 when blued steel icicles
     action math Necro.Material add 1 when chunk of (\w+)(?: \w+)? material
     action math TotalLead add 1 when braided lead rope
     action math TotalRope add 1;var NeedRope 0 when bundling rope
     action var HaveDamaris 1;var DamarisType $1 when (?i)(damaris\s+(?:battle |throwing )?(akabo|arbalest|bow|bludgeon|bola|broadsword|claymore|falchion|greathammer|halberd|latchbow|mace|maul|nightstick|oben|pike|quarterstaff|rapier|sabre|shortbow|sledgehammer|sling|slurbow|stonebow|mallet))
     var TempPouch %gemPouch
     if matchre("%TempPouch", "(\w+) gem pouch") then
          {
               var pouchColor $1
               goto INV_NEXT
          }
     if ("%TempPouch" = "gem pouch") then
          {
               var pouchColor
               goto INV_NEXT
          }
     if matchre("%TempPouch", "(\w+) pouch") then
          {
               var pouchColor $1
               goto INV_NEXT
          }
     if !matchre("%TempPouch", "(\w+) gem pouch") then
          {
               var pouchColor
          }
INV_NEXT:
     action (pouches) math TotalPouches add 1 when (?i)%pouchColor gem pouch
     action (pouches) math AltPouches add 1;var AltPouchColor $1 when (?!%pouchColor)\b(\w+) gem pouch
     action (pouches) on
     action (communes) on
     action (herbs) on
     echo
     echo ###################
     echo *** SCANNING INVENTORY
     echo ###################
     echo
     if ("$guild" = "Cleric") then
          {
               if (!matchre("%HolyWater", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%command", "(?i)(FIGHT|INVASION)")) then gosub CHECK_RECEPTACLE
          }
     delay 0.00001
     matchre INVENTORY_PRECHECK ^\.\.\.wait|^Sorry
     matchre INVENTORY_DECISION ^Roundtime\:
     put inv list
     matchwait 20
INVENTORY_DECISION:
     ## NO LONGER NEEDED - EDDY/PORTAL CONTENTS SHOW IN INV LIST
     # if matchre("%ALLCONTAINERS", "(?i)(eddy|portal)") then
          # {
               # send inv eddy
               # wait
               # pause 0.4
          # }
     pause 0.1
     pause 0.0001
     pause 0.0001
     if ((%HaveFragSack = 1) && (%HaveFragment = 0)) then gosub TAP_FRAG
INVENTORY_PARSE:
     delay 0.0001
     echo
     echo ##################
     echo ##################
     echo ** INVENTORY REPORT **
     echo *
     if ("$guild" = "Cleric") then
          {
               echo *
               echo ~~~ CLERIC SUPPLIES ~~~
               if (%HaveCandle = 1) then echo * Candle
               if (%HaveIncense = 1) then echo * Incense
               if (%HaveWine = 1) then echo * Wine
               if (%HaveSage = 1) then echo * Sage
               if (%HaveLavender = 1) then echo * Lavender
               if (%HaveChamomile = 1) then echo * Chamomile
               if (%HaveDirt = 1) then echo * Dirt
               if (%HaveAnloral = 1) then echo * Anloral %Anloral Pin!
               echo *
          }
     delay 0.00001
     if ((%HaveGaethzen = 1) || (%HaveStarglass = 1) || (%HaveGoggles = 1) || (%HaveTorch = 1) || (%HaveLantern = 1)) then
          {
               echo ~~~ LIGHT SOURCES ~~~
          }
     if (%HaveGaethzen = 1) then echo * Gaethzen %Gaethzen.Type
     if (%HaveStarglass = 1) then echo * Starglass
     if (%HaveGoggles = 1) then echo * Goggles
     if (%HaveLantern = 1) then echo * Lantern
     if (%HaveTorch = 1) then echo * Torch
     if ((%HaveGaethzen = 1) || (%HaveStarglass = 1) || (%HaveGoggles = 1) || (%HaveTorch = 1) || (%HaveLantern = 1)) then
          {
               echo *
          }
     if ((%HaveLighter = 1) || (%HaveFlint = 1) || (%Necro.Material > 0) || (%HaveDirt = 1) || (%HaveExoShield = 1) || (%HaveBandolier = 1) || (%HaveSkates = 1)) then
          {
               echo ~~~ MISC ~~~
          }
     if (%HaveLighter = 1) then echo * Lighter - %Lighter.Name
     if (%HaveSkates = 1) then echo * Ice Skates
     if (%HaveFinesse = 1) then echo * Finesse Wand
     if (!matchre("$guild", "(Cleric|Ranger|Moon Mage|Paladin|Thief)") && matchre("($UC_combatCritter|$UC_backtrainCritter)", "\b(?i)(Crypt Fiend|Ghoul Raven|Snaer|Hafwa|Resuscitants?|Moths?)\b") then
          {
               if (("$guild" = "Barbarian") && (%HaveGoggles = 0) && (%HaveStarglass = 0) && (%HaveLantern = 1)) then var NeedOil 1
               if ((%HaveGaethzen = 0) && (%HaveStarglass = 0) && (%HaveGoggles = 1) && (%HaveLantern = 1)) then var NeedOil 1
          }
     if (%HaveCardCase = 1) then echo * Card Collector's Case
     if (%HaveCards = 1) then echo * %CardsCount Collector's Cards
     if (%HaveFragment = 1) then echo * Glowing Iron Fragment
     if (%HaveCloth = 1) then echo * Chamois Cloth
     if (%HaveOil = 1) then echo * Lamp Oil
     if (%HaveFlint = 1) then echo * Flint
     if (%Necro.Material > 0) then echo * Necro Material - %Necro.Material
     if (matchre("$guild", "(Necromancer|Thief)") && (%HaveDirt = 1)) then echo * Dirt
     if (%TotalRope > 0) then echo * %TotalRope bundling rope
     if (%TotalPouches > 0) then echo * %TotalPouches %pouchColor gem pouches
     if (%AltPouches > 0) then echo * %AltPouches %AltPouchColor gem pouches
     if (%HaveBoxes > 0) then echo * %TotalBoxes boxes
     if ((%have_aevaes = 0) && (%have_aloe = 0) && (%have_junliar = 0) && (%have_blocil = 0) && (%have_hulnik = 0) && (%have_eghmok = 0) && (%have_georin = 0) && (%have_ithor = 0) && (%have_jadice = 0) && (%have_yelith = 0) && (%have_lujeakave = 0) && (%have_muljin = 0) && (%have_nemoih = 0) && (%have_nilos = 0) && (%have_plovik = 0) && (%have_riolur = 0) && (%have_sufil = 0) && (%have_hisan = 0) && (%have_cebi = 0) && (%have_dioica = 0) && (%have_belradi = 0)) then goto INVENTORY_SACK
     delay 0.00001
     echo *
     echo ~~~ HERBS ~~~
     if (%have_nemoih = 1) then echo * Nemoih (ext head)
     if (%have_eghmok = 1) then echo * Eghmok (int head)
     if (%have_sufil = 1) then echo * Sufil (ext eye)
     if (%have_aevaes = 1) then echo * Aevaes (int eye)
     if (%have_georin = 1) then echo * Georin (ext neck)
     if (%have_riolur = 1) then echo * Riolur (int neck)
     if (%have_plovik = 1) then echo * Plovik (ext chest)
     if (%have_ithor = 1) then echo * Ithor (int chest)
     if (%have_nilos = 1) then echo * Nilos (ext abdomen)
     if (%have_muljin = 1) then echo * Muljin (int abdomen)
     if (%have_hulnik = 1) then echo * Hulnik (ext back)
     if (%have_junliar = 1) then echo * Junliar (int back)
     if (%have_blocil = 1) then echo * Blocil (int back)
     if (%have_jadice = 1) then echo * Jadice (ext limb)
     if (%have_yelith = 1) then echo * Yelith (int limb)
     if (%have_aloe = 1) then echo * Aloe (skin)
     if (%have_lujeakave = 1) then echo * Lujeakave (nerve)
     if (%have_cebi = 1) then echo * Cebi (ext scar)
     if (%have_hisan = 1) then echo * Hisan (int scar)
     if (%have_dioica = 1) then echo * Dioica (ext scar)
     if (%have_belradi = 1) then echo * Belradi (int scar)
INVENTORY_SACK:
     if ((%HaveLargeSack = 1) || (%HaveTicket = 1) || (%HaveFinesse = 1) || (%HaveSkates = 1) || (%HaveLighter = 1) || (%HaveFavorIdol = 1) || (%HaveExoShield = 1) || (%HaveBandolier = 1) || (%HaveQuiver = 1)) then
          {
               echo *
               echo ~~~ SPECIAL ITEMS ~~~
               if (%HaveTicket = 1) then echo * !!REPAIR TICKETS FOUND!!
               if (%HaveLargeSack = 1) then echo * !!LARGE SACK FOUND!!
               if (%HaveExoShield = 1) then echo * Exoskeletal Shield
               if (%HaveBandolier = 1) then echo * Magic Bandolier
               if (%IcicleCount > 0) then echo * %IcicleCount Icicle stacks
               if (%HaveDamaris = 1) then echo * %DamarisType 
               if (%HaveQuiver = 1) then echo * Drake-Hide Quiver
               if (%HaveFavorIdol = 1) then echo * Favor Idol: %IdolType idol
          }
     echo ##################
     echo ##################
     echo
     delay 0.00001
     action remove (orbweaver ring|widow ring|tarantula ring|exoskeletal shield)
     action remove ice-veined leather bandolier
     action remove drake-hide quiver studded
     action remove drake-hide quiver limned
     action remove ((?<=glittering )sun|(?<=dreamstone )moon|(?<=glistening )star|(?<=bloodfire )shell) idol
     action remove (Catrox|Randal|Unspiek|Wyla|Kamze|Dagul|Ylono|Lakyan|Osmandikar|Krrikt'k|Raven|Ladar|Shh'yris|Sefu|Fekoeti|Diwitt|repairman).*ticket
     action remove a large sack
     action remove a small sack
     action remove (chamois|linen|needlework) cloth
     action remove piece of black flint
     action remove \btorch\b
     action remove (?i)%pouchColor gem pouch
     action remove (?!%pouchColor)\b(\w+) gem pouch
     action remove braided lead rope
     action remove bundling rope
     action remove glittery platinum poppet
     action remove blued steel icicles
     action remove chunk of (\w+)(?: \w+)? material
     action remove (oil|copper|tin|lelori|horn|gravedigger's) lantern
     action remove [Gg]aethzen (\w+)
     action remove starglass
     action remove wraparound goggles
     action remove glowing iron fragment
     action remove (altar|votive) candle
     action remove ((?<!miner's )lamp|fish|coal) oil
     action remove star-streaked midnight black sack
     action remove %Lighter.Name
     action remove ice skates
     action remove card collector's case
     action remove (?:an?) (.+) card\b$
     action remove (brass|copper|deobar|driftwood|iron|ironwood|mahogany|oaken|pine|steel|wooden) (coffer|trunk|chest|strongbox|skippet|caddy|crate|casket|(?<!(?i)training )box)
     action remove (?i)(damaris\s+(?:battle |throwing )?(akabo|arbalest|bow|bludgeon|bola|broadsword|claymore|falchion|greathammer|halberd|latchbow|mace|maul|nightstick|oben|pike|quarterstaff|rapier|sabre|shortbow|sledgehammer|sling|slurbow|stonebow|mallet))
##############################################################
## SPECIAL SETUP SECTION
## THIS CHECKS FOR ANY SPECIAL CONDTIIONS AFTER INV CHECK
## TAKES ACTION IF NEEDED SUCH AS RESUPPLY / JAIL RECOVERY ETC
##############################################################
if (!matchre("%command", "(?i)(FIGHT|INVASION)") && !matchre("%nocheck", "(?i)SKIP")) then
     {
          if (%HaveBandolier = 1) then
               {
                    if (%IcicleCount < 7) then put rub my bandolier
                    pause 0.3
                    pause 0.1
               }
          if ((%HaveQuiverBolt = 1) || (%HaveQuiverArrow = 1)) then
               {
                    put rub my drake-hide quiver
                    pause 0.3
                    pause 0.1
               }
          if ((%NeedOil = 1) && (%HaveOil = 0)) then gosub BUY_OIL
          if (("$guild" = "Necromancer") && !matchre("$UC_Container.Dirt", "(?i)(NULL|NILL|OFF)") && (%HaveDirt = 0)) then gosub FIND_DIRT
          if (("$guild" = "Cleric") && ($UC_ClericRituals = 1)) then gosub RESUPPLY
          if (%HaveSmallSack = 1) then gosub SMALL_SACK_EMPTY
          if ((%HaveCardCase = 1) && (%HaveCards = 1)) then gosub CARDCASE
     }
#### THIS WILL EMPTY OUT "LARGE SACKS" FROM INVENTORY FIRST - THAT MAY HAVE ARMOR ITEMS FROM BEING REPAIRED
#### THIS AVOIDS SCRIPT RUNNING INTO ERRORS NOT FINDING ARMOR - IF USER ABORTED SCRIPT IN MID REPAIR AFTER GETTING SACK
     if (%HaveLargeSack = 1) then gosub SACK_EMPTY
#### THIS MAKES SURE WE CLEAR OUT ANY REPAIR TICKETS FROM INVENTORY FIRST
#### WILL ONLY DO THIS SECTION ON INITIAL STARTUP INV CHECK
     if ((%HaveTicket = 1) && !matchre("%nocheck", "(?i)SKIP")) then goto TICKET_YES
INVENTORY_CHECK_END:
     action (communes) off
     action (pouches) off
     action (herbs) off
     return

TAP_FRAG:
     delay 0.0001
     matchre return ^I could not|^What were you
     matchre HAVE_FRAG ^You tap
     put tap frag in my black sack
     matchwait 3
     return
HAVE_FRAG:
     var HaveFragment 1
     return

CARDCASE:
     echo
     echo ##############
     echo # CARD CASE MANAGEMENT
     echo ##############
     echo
     pause 0.4
     gosub GET my collector case
     pause 0.2
     pause 0.2
     if !matchre("$righthand", "case") then goto CARDCASE_DONE
     gosub PUT open my case
CARDCASE_GET:
     pause 0.1
     gosub GET my card
     pause 0.1
     pause 0.1
     if !matchre("$lefthand", "card") then goto CARDCASE_DONE
CARD_ADD:
     pause 0.01
     put card add
     pause 0.5
     pause 0.3
     if matchre("$lefthand", "card") then gosub PUT drop my card
     goto CARDCASE_GET
CARDCASE_DONE:
     echo
     echo ##############
     echo # DONE WITH CARD CASE 
     echo ##############
     echo
     pause 0.5
     gosub stowing
     return
BUY_OIL:
     echo
     echo ######################
     echo ** Attempting to Restock Lamp Oil!
     echo ######################
     echo
     pause 0.001
     if !matchre("$zoneid", "\b(1|30|42|47|61|67|90|107|116|150)\b") then
          {
               #### ESCAPE TO NEAREST CITY
               var GOSUBBING ON
               var escaping ON
               gosub ESCAPE_NOW
               var GOSUBBING OFF
               #### DONE ESCAPING TO CITY
          }
     if (("$zoneid" > "61") && ("$zoneid" != "116")) then
          {
               put .travel hib
               waitforre ^YOU ARRIVED\!
          }
     if !matchre("$zoneid", "\b(116|99|61)\b") then
          {
               put #echo >Log #ff0000 ** ERROR! CANNOT RESTOCK LAMP OIL! RESTOCK MANUALLY - BUY OIL IN HIB!
               echo ############################
               echo ** ERROR! NOT IN A VALID LOCATION TO BUY LAMP OIL!
               echo ** WE NEED OIL FOR OUR LANTERN!!!
               echo ** GO BUY OIL IN HIB/AESRY/ILAYA
               echo ############################
               pause 2
               return
          }
     gosub AUTOMOVE teller
     pause 0.1
     pause 0.1
     put withdraw 2 silver
     pause 0.5
     if ("$zoneid" = "61") then gosub AUTOMOVE ilaya
     pause 0.5
     if ("$zoneid" = "99") then gosub AUTOMOVE general
     if ("$zoneid" = "112") then gosub AUTOMOVE general
     if ("$zoneid" = "116") then gosub AUTOMOVE lamp
     pause 0.5
     pause 0.1
     if ("$zoneid" != "112") then put buy lamp oil
     if ("$zoneid" = "112") then put buy fish oil
     pause 0.5
     if ("$zoneid" = "99") then put offer 240
     if ("$zoneid" = "99") then put offer 240
     pause 0.5
     gosub stowing
     return

TICKET_YES:
     echo
     echo ##############################
     echo *** Repair Tickets Found in Inventory!
     echo *** TickeType: %TicketType
     echo *** ESCAPING TO GO COLLECT GEAR
     echo ##############################
     echo
     pause 0.5
     var TicketCheck 1
     gosub clear
     gosub stowing
     if !matchre("$zoneid", "\b(1|30|42|47|61|67|90|107|116|150)\b") then
          {
               #### ESCAPE TO NEAREST CITY
               var GOSUBBING ON
               var escaping ON
               gosub ESCAPE_NOW
               var GOSUBBING OFF
               #### DONE ESCAPING TO CITY
          }
     if matchre("%TicketType", "(repairman|Osmandikar|Lakyan)") then gosub TO_SEACAVE
     if matchre("%TicketType", "(Catrox|Randal)") && !matchre("$zoneid", "\b(1|4|7)\b") then
          {
               put .travel cross
               waitforre ^YOU ARRIVED
          }
     if matchre("%TicketType", "Ylono") && !matchre("$zoneid", "\b(66|67)\b") then
          {
               put .travel shard
               waitforre ^YOU ARRIVED
          }
     if matchre("%TicketType", "(Shh'yris|Sefu)") && !matchre("$zoneid", "\b99\b") then
          {
               put .travel aesry
               waitforre ^YOU ARRIVED
          }
     if matchre("%TicketType", "Kamze") && !matchre("$zoneid", "\b40\b") then
          {
               put .travel lang
               waitforre ^YOU ARRIVED
          }
     if matchre("%TicketType", "Kamze") && !matchre("$zoneid", "\b40\b") then
          {
               put .travel lang
               waitforre ^YOU ARRIVED
          }
     if matchre("%TicketType", "Kamze") && !matchre("$zoneid", "\b40\b") then
          {
               put .travel lang
               waitforre ^YOU ARRIVED
          }
     if matchre("%TicketType", "Dagul") && !matchre("$zoneid", "\b42\b") then
          {
               put .travel theren
               waitforre ^YOU ARRIVED
          }
     if matchre("%TicketType", "Raven") && !matchre("$zoneid", "\b90\b") then
          {
               put .travel ratha
               waitforre ^YOU ARRIVED
          }
     if matchre("%TicketType", "Fekoeti") && !matchre("$zoneid", "\b47\b") then
          {
               put .travel muspar
               waitforre ^YOU ARRIVED
          }
     if matchre("%TicketType", "Unspiek") && !matchre("$zoneid", "\b30\b") then
          {
               put .travel river
               waitforre ^YOU ARRIVED
          }
     if ("$zoneid" = "1") then goto DONE_REPAIR_XING
     if ("$zoneid" = "67") then goto DONE_REPAIR_SHARD
     if ("$zoneid" = "30") then goto DONE_REPAIR_HAVEN
     if ("$zoneid" = "116") then goto DONE_REPAIR_HIB
     if ("$zoneid" = "107") then goto DONE_REPAIR_MERK
     if ("$zoneid" = "150") then goto DONE_REPAIR_FANG
     if ("$zoneid" = "42") then goto DONE_REPAIR_THEREN
     if ("$zoneid" = "47") then goto DONE_REPAIR_MUSPARI
     if ("$zoneid" = "90") then goto DONE_REPAIR_RATHA
     echo
     echo *** ERROR! UNKNOWN LOCATION!
     echo *** Abort script and check for repair tickets!
     echo
     pause
     goto INVENTORY_PRECHECK
SACK_EMPTY:
     var sackloop 0
SACK_EMPTY_1:
     if (%sacklook > 3) then goto SACK_EMPTY_DONE
     gosub stowing
     pause 0.5
     gosub GET my large sack
     pause 0.5
     gosub PUT open my large sack
     pause 0.5
     if !matchre("$righthand $lefthand", "large sack") then goto SACK_EMPTY_DONE
     gosub REPAIR_DONE
     pause 0.1
     if matchre("$righthand $lefthand", "sack") then
          {
               gosub DUMPSTER_CHECK
               pause 0.3
               if ("%dumpster" != "NULL") then gosub PUT put my sack in %dumpster
               pause 0.1
               if (("%dumpster" = "NULL") || (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty"))) then put drop my sack
               pause 0.2
          }
     goto SACK_EMPTY_1
SACK_EMPTY_DONE:
     var HaveLargeSack 0
     return
SMALL_SACK_EMPTY:
     var sackloop 0
SMALL_SACK_EMPTY_1:
     if (%sacklook > 4) then goto SMALL_SACK_EMPTY_DONE
     gosub stowing
     pause 0.5
     gosub GET my small sack
     pause 0.5
     gosub PUT open my small sack
     pause 0.5
     pause 0.2
     if !matchre("$righthand $lefthand", "small sack") then goto SMALL_SACK_EMPTY_DONE
     gosub REPAIR_DONE
     pause 0.1
     if matchre("$righthand $lefthand", "sack") then
          {
               gosub DUMPSTER_CHECK
               pause 0.3
               if ("%dumpster" != "NULL") then gosub PUT put my sack in %dumpster
               pause 0.1
               if (("%dumpster" = "NULL") || (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty"))) then put drop my sack
               pause 0.2
          }
     pause 0.1
     goto SACK_EMPTY_1
SMALL_SACK_EMPTY_DONE:
     var HaveSmallSack 0
     return
################################################
#### DEDICATED HERB HEALING ROUTINE
#### USES HERBS ON HAND TO HEAL ANY INJURIES
#### DOES ONE PASS THEN RETURNS
################################################
HERB_HEALING:
     delay 0.0001
     # Initialize Wound / Herb Variables
     var nerves 0
     var skin 0
     var ext_head 0
     var int_head 0
     var ext_neck 0
     var int_neck 0
     var ext_chest 0
     var int_chest 0
     var ext_abdomen 0
     var int_abdomen 0
     var ext_back 0
     var int_back 0
     var ext_limb 0
     var int_limb 0
     var ext_eye 0
     var int_eye 0
     var ext_scar 0
     var int_scar 0
     var quaff eat
     var prep_aevaes NULL
     var prep_aloe NULL
     var prep_belradi NULL
     var prep_blocil NULL
     var prep_cebi NULL
     var prep_dioica NULL
     var prep_eghmok NULL
     var prep_georin NULL
     var prep_hisan NULL
     var prep_hulnik NULL
     var prep_ithor NULL
     var prep_jadice NULL
     var prep_junliar NULL
     var prep_lujeakave NULL
     var prep_nemoih NULL
     var prep_muljin NULL
     var prep_nilos NULL
     var prep_plovik NULL
     var prep_riolur NULL
     var prep_plovik NULL
     var prep_sulfil NULL
     var prep_yelith NULL
     var herbTime $gametime
     echo
     echo ####################
     echo *** HERB HEALING ROUTINE
     echo ####################
     echo
     if (("$righthand" != "Empty") && ("$lefthand" != "Empty")) then gosub STOWIT left
     # Initialize actions
     action var nerves 1 when (minor|severe) twitching|difficulty controlling actions|paralysis of the entire body
     action var skin 1 when (abrasions|scuffing|scratches) (about|across|along|around|from|in|of|on|to) the skin|rash|boils|sores
     action var ext_head 1 when (abrasions|scuffing|scratches|cuts and bruises|cuts|slashes|holes) (about|across|along|around|from|in|of|on|to) the head|(cracked|crushed) skull|pulpy stump for a head
     action var int_head 1 when (bruised|swollen|bloated) head|bruising (about|across|along|around|from|in|of|on|to) the head|inside head
     action var ext_neck 1 when (abrasions|scuffing|scratches|cuts and bruises|cuts|slashes|holes) (about|across|along|around|from|in|of|on|to) the neck|(shattered|useless) neck
     action var int_neck 1 when bruising (about|across|along|around|from|in|of|on|to) the neck|(bruised|swollen|swollen and shattered) neck|inside neck
     action var ext_chest 1 when (abrasions|scuffing|scratches|cuts and bruises|cuts|slashes|holes) (about|across|along|around|from|in|of|on|to) the chest|(shattered|destroyed) chest
     action var int_chest 1 when bruising (about|across|along|around|from|in|of|on|to) the chest|(bruised|swollen) chest|inside chest
     action var ext_abdomen 1 when (abrasions|scuffing|scratches|cuts and bruises|cuts|slashes|holes) (about|across|along|around|from|in|of|on|to) the abdomen|abdomen deeply gouged|destroyed abdomen
     action var int_abdomen 1 when  bruising (about|across|along|around|from|in|of|on|to) the abdomen|(bruised|swollen) abdomen|discolored abdomen|inside abdomen
     action var ext_back 1 when (abrasions|scuffing|scratches|cuts and bruises|cuts|slashes|holes) (about|across|along|around|from|in|of|on|to) the back|(shattered|destroyed) back
     action var int_back 1 when (about|across|along|around|from|in|of|on|to) the back|(bruised|swollen) back|inside back
     action var ext_limb 1 when (abrasions|scuffing|scratches|cuts and bruises|cuts|slashes|holes) (about|across|along|around|from|in|of|on|to) the ((right|left) (hand|arm|leg)|tail)|(broken|shattered) ((right|left) (hand|arm|leg)|tail)|stump for a ((right|left) (hand|arm|leg)|tail)
     action var int_limb 1 when bruising (about|across|along|around|from|in|of|on|to) the ((right|left) (hand|arm|leg)|tail)|(bruised|swollen) ((right|left) (hand|arm|leg)|tail)|inside ((right|left|r\.|l\.) (hand|arm|leg)|tail)
     action var ext_eye 1 when (black and blue|swollen|bleeding|slashed|shattered) (right|left) eye|cavity for a (right|left) eye
     action var int_eye 1 when bruising (about|across|along|around|from|in|of|on|to) the (right|left) eye|bruised (right|left) eye|bruised and (crossed|cloudy|blind) (right|left) eye|inside ((right|left)|r\.|l\.) eye
     action var ext_scar 1 when a stump for|flesh stump for|gashes|malformed|missing|non-existent|scarred|scarring|scars|shriveled|skin discoloration|skin loss|skin tone|socket|stump
     action var int_scar 1 when a blind|blank stare|breath|clouded|emaciated|move|moving|numbness|pallor|paralyzed|twitch|twitching
     put health
     #Secondary resupply action
     action var have_%s 1 when ^That was the last of
     pause 0.0001

#Take herbs for anything that picked up by the triggers
nerves:
if (%nerves = 1) then GOTO heal_nerves
GOTO skin

heal_nerves:
if matchre ("%prep_lujeakave", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_lujeakave", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_lujeakave", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
if ("%prep_lujeakave" = "NULL") then goto need_lujeakave
SAVE lujeakave
matchre heal_nerves ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre nerves_scar ^You apply|^You drink|^You eat|^You take
matchre rub_lujeakave ^Rub what
matchre need_lujeakave ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
put %quaff my lujeakave %prep_lujeakave
matchwait 5
goto need_lujeakave

rub_lujeakave:
matchre need_lujeakave ^What were you referring
put get my lujeakave %prep_lujeakave
matchwait 2
put rub my lujeakave %prep_lujeakave
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

nerves_scar:
gosub set_int_scar
goto skin
need_lujeakave:
var have_lujeakave 0

skin:
if (%skin = 1) then GOTO heal_skin
GOTO ext_head

heal_skin:
if ("%prep_aloe" = "NULL") then goto need_aloe
if matchre ("%prep_aloe", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_aloe", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_aloe", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE aloe
matchre heal_skin ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre skin_scar ^You apply|^You drink|^You eat|^You take
matchre rub_aloe ^Rub what
matchre need_aloe ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
put %quaff my aloe %prep_aloe
matchwait 5
goto need_aloe

rub_aloe:
matchre need_aloe ^What were you referring
put get my aloe %prep_aloe
matchwait 2
send rub my aloe %prep_aloe
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

skin_scar:
gosub set_ext_scar
goto ext_head
need_aloe:
var have_aloe 0

ext_head:
if (%ext_head = 1) then GOTO heal_ext_head
GOTO int_head

heal_ext_head:
if ("%prep_nemoih" = "NULL") then goto need_nemoih
if matchre ("%prep_nemoih", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_nemoih", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_nemoih", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE nemoih
matchre heal_ext_head ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre ext_head_scar ^You apply|^You drink|^You eat|^You take
matchre rub_nemoih ^Rub what
matchre need_nemoih ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my nemoih %prep_nemoih
matchwait 5
goto need_nemoih

rub_nemoih:
matchre need_nemoih ^What were you referring
send get my nemoih %prep_nemoih
matchwait 2
send rub my nemoih %prep_nemoih
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

ext_head_scar:
gosub set_ext_scar
goto int_head
need_nemoih:
var have_nemoih 0

int_head:
if (%int_head = 1) then GOTO heal_int_head
GOTO ext_neck

heal_int_head:
if ("%prep_eghmok" = "NULL") then goto need_eghmok
if matchre ("%prep_eghmok", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_eghmok", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_eghmok", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE eghmok
matchre heal_int_head ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre int_head_scar ^You apply|^You drink|^You eat|^You take
matchre rub_eghmok ^Rub what
matchre need_eghmok ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my eghmok %prep_eghmok
matchwait 5
goto need_eghmok

rub_eghmok:
matchre need_eghmok ^What were you referring
send get my eghmok %prep_eghmok
matchwait 2
send rub my eghmok %prep_eghmok
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

int_head_scar:
gosub set_int_scar
goto ext_neck
need_eghmok:
var have_eghmok 0

ext_neck:
if (%ext_neck = 1) then GOTO heal_ext_neck
GOTO int_neck

heal_ext_neck:
if ("%prep_georin" = "NULL") then goto need_georin
if matchre ("%prep_georin", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_georin", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_georin", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE georin
matchre heal_ext_neck ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre ext_neck_scar ^You apply|^You drink|^You eat|^You take
matchre rub_georin ^Rub what
matchre need_georin ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my georin %prep_georin
matchwait 5
goto need_georin

rub_georin:
matchre need_georin ^What were you referring
send get my georin %prep_georin
matchwait 2
send rub my georin %prep_georin
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

ext_neck_scar:
gosub set_ext_scar
goto int_neck
need_georin:
var have_georin 0

int_neck:
if (%int_neck = 1) then GOTO heal_int_neck
GOTO ext_chest

heal_int_neck:
if ("%prep_riolur" = "NULL") then goto need_riolur
if matchre ("%prep_riolur", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_riolur", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_riolur", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE riolur
matchre heal_int_neck ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre int_neck_scar ^You apply|^You drink|^You eat|^You take
matchre rub_riolur ^Rub what
matchre need_riolur ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my riolur %prep_riolur
matchwait 5
goto need_riolur

rub_riolur:
matchre need_riolur ^What were you referring
send get my riolur %prep_riolur
matchwait 2
send rub my riolur %prep_riolur
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

int_neck_scar:
gosub set_int_scar
goto ext_chest
need_riolur:
var have_riolur 0

ext_chest:
if (%ext_chest = 1) then GOTO heal_ext_chest
GOTO int_chest

heal_ext_chest:
if ("%prep_plovik" = "NULL") then goto need_plovik
if matchre ("%prep_plovik", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_plovik", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_plovik", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE plovik
matchre heal_ext_chest ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre ext_chest_scar ^You apply|^You drink|^You eat|^You take
matchre rub_plovik ^Rub what
matchre need_plovik ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my plovik %prep_plovik
matchwait 5
goto need_plovik

rub_plovik:
matchre need_plovik ^What were you referring
send get my plovik %prep_plovik
matchwait 2
send rub my plovik %prep_plovik
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

ext_chest_scar:
gosub set_ext_scar
goto int_chest
need_plovik:
var have_plovik 0

int_chest:
if (%int_chest = 1) then GOTO heal_int_chest
GOTO ext_abdomen

heal_int_chest:
if ("%prep_ithor" = "NULL") then goto need_ithor
if matchre ("%prep_ithor", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_ithor", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_ithor", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE ithor
matchre heal_int_chest ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre int_chest_scar ^You apply|^You drink|^You eat|^You take
matchre rub_ithor ^Rub what
matchre need_ithor ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my ithor %prep_ithor
matchwait 5
goto need_ithor

rub_ithor:
matchre need_ithor ^What were you referring
send get my ithor %prep_ithor
matchwait 2
send rub my ithor %prep_ithor
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

int_chest_scar:
gosub set_int_scar
goto ext_abdomen
need_ithor:
var have_ithor 0

ext_abdomen:
if (%ext_abdomen = 1) then GOTO heal_ext_abdomen
GOTO int_abdomen

heal_ext_abdomen:
if ("%prep_nilos" = "NULL") then goto need_nilos
if matchre ("%prep_nilos", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_nilos", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_nilos", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE nilos
matchre heal_ext_abdomen ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre ext_abdomen_scar ^You apply|^You drink|^You eat|^You take
matchre rub_nilos ^Rub what
matchre need_nilos ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my nilos %prep_nilos
matchwait 5
goto need_nilos

rub_nilos:
matchre need_nilos ^What were you referring
send get my nilos %prep_nilos
matchwait 2
send rub my nilos %prep_nilos
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

ext_abdomen_scar:
gosub set_ext_scar
goto int_abdomen
need_nilos:
var have_nilos 0

int_abdomen:
if (%int_abdomen = 1) then GOTO heal_int_abdomen
GOTO ext_back

heal_int_abdomen:
if ("%prep_muljin" = "NULL") then goto need_muljin
if matchre ("%prep_muljin", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_muljin", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_muljin", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE muljin
matchre heal_int_abdomen ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre int_abdomen_scar ^You apply|^You drink|^You eat|^You take
matchre rub_muljin ^Rub what
matchre need_muljin ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my muljin %prep_muljin
matchwait 5
goto need_muljin

rub_muljin:
matchre need_muljin ^What were you referring
send get my muljin %prep_muljin
matchwait 2
send rub my muljin %prep_muljin
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

int_abdomen_scar:
gosub set_int_scar
goto ext_back
need_muljin:
var have_muljin 0

ext_back:
if (%ext_back = 1) then GOTO heal_ext_back
GOTO int_back

heal_ext_back:
if ("%prep_hulnik" = "NULL") then goto need_hulnik
if matchre ("%prep_hulnik", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_hulnik", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_hulnik", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE hulnik
matchre heal_ext_back ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre ext_back_scar ^You apply|^You drink|^You eat|^You take
matchre rub_hulnik ^Rub what
matchre need_hulnik ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my hulnik %prep_hulnik
matchwait 5
goto need_hulnik

rub_hulnik:
matchre need_hulnik ^What were you referring
send get my hulnik %prep_hulnik
matchwait 2
send rub my hulnik %prep_hulnik
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

ext_back_scar:
gosub set_ext_scar
goto int_back
need_hulnik:
var have_hulnik 0

int_back:
if (%int_back = 1) then GOTO heal_int_back
GOTO ext_limb

heal_int_back:
if ("%prep_blocil" = "NULL") then goto need_blocil
if matchre ("%prep_blocil", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_blocil", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_blocil", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE blocil
matchre heal_int_back ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre int_back_scar ^You apply|^You drink|^You eat|^You take
matchre rub_blocil ^Rub what
matchre heal_int_back2 ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my blocil %prep_blocil
matchwait 5
goto need_blocil

need_blocil:
var have_blocil 0
goto heal_int_back2

rub_blocil:
matchre heal_int_back2 ^What were you referring
send get my blocil %prep_blocil
matchwait 2
send rub my blocil %prep_blocil
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

heal_int_back2:
if ("%prep_junliar" = "NULL") then goto need_junliar
if matchre ("%prep_junliar", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_junliar", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_junliar", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE junliar
matchre heal_int_back2 ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre int_back_scar ^You apply|^You drink|^You eat|^You take
matchre rub_junliar ^Rub what
matchre need_junliar ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my junliar %prep_junliar
matchwait 5
goto need_junliar

rub_junliar:
matchre need_junliar ^What were you referring
send get my junliar %prep_junliar
matchwait 2
send rub my junliar %prep_junliar
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

int_back_scar:
gosub set_int_scar
goto ext_limb
need_junliar:
var have_junliar 0

ext_limb:
if (%ext_limb = 1) then GOTO heal_ext_limb
GOTO int_limb

heal_ext_limb:
if ("%prep_jadice" = "NULL") then goto need_jadice
if matchre ("%prep_jadice", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_jadice", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_jadice", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE jadice
matchre heal_ext_limb ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre ext_limb_scar ^You apply|^You drink|^You eat|^You take
matchre rub_jadice ^Rub what
matchre need_jadice ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my jadice %prep_jadice
matchwait 5
goto need_jadice

rub_jadice:
matchre need_jadice ^What were you referring
send get my jadice %prep_jadice
matchwait 2
send rub my jadice %prep_jadice
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

ext_limb_scar:
gosub set_ext_scar
goto int_limb
need_jadice:
var have_jadice 0

int_limb:
if (%int_limb = 1) then GOTO heal_int_limb
GOTO ext_eye

heal_int_limb:
if ("%prep_yelith" = "NULL") then goto need_yelith
if matchre ("%prep_yelith", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_yelith", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_yelith", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE yelith
matchre heal_int_limb ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre int_limb_scar ^You apply|^You drink|^You eat|^You take
matchre rub_yelith ^Rub what
matchre need_yelith ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my yelith %prep_yelith
matchwait 5
goto need_yelith

rub_yelith:
matchre need_yelith ^What were you referring
send get my yelith %prep_yelith
matchwait 2
send rub my yelith %prep_yelith
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

int_limb_scar:
gosub set_int_scar
goto ext_eye
need_yelith:
var have_yelith 0

ext_eye:
if (%ext_eye = 1) then GOTO heal_ext_eye
GOTO int_eye

heal_ext_eye:
if ("%prep_sufil" = "NULL") then goto need_sufil
if matchre ("%prep_sufil", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_sufil", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_sufil", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE sufil
matchre heal_ext_eye ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre ext_eye_scar ^You apply|^You drink|^You eat|^You take
matchre rub_sufil ^Rub what
matchre need_sufil ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my sufil %prep_sufil
matchwait 5
goto need_sufil

rub_sufil:
matchre need_sufil ^What were you referring
send get my sufil %prep_sufil
matchwait 2
send rub my sufil %prep_sufil
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

ext_eye_scar:
gosub set_ext_scar
goto int_eye
need_sufil:
var have_sufil 0

int_eye:
if (%int_eye = 1) then GOTO heal_int_eye
GOTO ext_scar

heal_int_eye:
if ("%prep_aevaes" = "NULL") then goto need_aevaes
if matchre ("%prep_aevaes", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_aevaes", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_aevaes", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE aevaes
matchre heal_int_eye ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre int_eye_scar ^You apply|^You drink|^You eat|^You take
matchre rub_aevaes ^Rub what
matchre need_aevaes ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my aevaes %prep_aevaes
matchwait 5
goto need_aevaes

rub_aevaes:
matchre need_aevaes ^What were you referring
send get my aevaes %prep_aevaes
matchwait 2
send rub my aevaes %prep_aevaes
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

int_eye_scar:
gosub set_int_scar
goto ext_scar
need_aevaes:
var have_aevaes 0

ext_scar:
if (%ext_scar = 1) then GOTO heal_ext_scar
GOTO int_scar

heal_ext_scar:
if ("%prep_cebi" = "NULL") then goto need_cebi
if matchre ("%prep_cebi", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_cebi", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_cebi", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE cebi
matchre heal_ext_scar ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre int_scar ^You apply|^You drink|^You eat|^You take
matchre rub_cebi ^Rub what
matchre need_cebi ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my cebi %prep_cebi
matchwait 5
goto need_cebi

rub_cebi:
matchre need_cebi ^What were you referring
send get my cebi %prep_cebi
matchwait 2
send rub my cebi %prep_cebi
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

need_cebi:
var have_cebi 0

heal_ext_scar_2:
if ("%prep_dioica" = "NULL") then goto need_dioica
if matchre ("%prep_dioica", "(ale|brandy|coffee|draught|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|tonic)") then var quaff drink
if matchre ("%prep_dioica", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_dioica", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE dioica
matchre heal_ext_scar_2 ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre int_scar ^You apply|^You drink|^You eat|^You take
matchre rub_dioica ^Rub what
matchre need_dioica ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my dioica %prep_dioica
matchwait 5
goto need_dioica

rub_dioica:
matchre need_dioica ^What were you referring
send get my dioica %prep_cebi
matchwait 2
send rub my dioica %prep_cebi
waitforre ^You rub|^What|^I|^Rub|Note
gosub stowing

need_dioica:
var have_dioica 0

int_scar:
if (%int_scar = 1) then goto heal_int_scar
goto HERB_SUPPLIES
heal_int_scar:
if ("%prep_hisan" = "NULL") then goto need_hisan
if matchre ("%prep_hisan", "(ale|brandy|coffee|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|draught)") then var quaff drink
if matchre ("%prep_hisan", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_hisan", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE hisan
matchre heal_int_scar ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre HERB_SUPPLIES ^You apply|^You drink|^You eat|^You take
matchre rub_hisan ^Rub what
matchre need_hisan ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my hisan %prep_hisan
matchwait 5
goto need_hisan

rub_hisan:
matchre need_hisan ^What were you referring
send get my hisan %prep_hisan
matchwait 2
send rub my hisan %prep_hisan
waitforre ^You rub|^What|^I|^Rub|Note|Perhaps
gosub stowing

need_hisan:
var have_hisan 0

heal_int_scar_2:
if ("%prep_belradi" = "NULL") then goto need_belradi
if matchre ("%prep_belradi", "(ale|brandy|coffee|drink|elixir|kefir|mash|mead|potion|smoothie|solution|tea|tincture|draught)") then var quaff drink
if matchre ("%prep_belradi", "(berries|berry|bread|brownie|butter|cake|cookie|cornbread|flower|grass|jam|leaf|moss|paste|pie|pollen|porridge|powder|puff-pastry|pulp|root|sap|sauce|scone|spread|stem|sticky-bun|tart|yogurt)\b") then var quaff eat
if matchre ("%prep_belradi", "(balm|ointment|poultice|salve|ungent)") then var quaff rub
SAVE belradi
matchre heal_int_scar_2 ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
matchre HERB_SUPPLIES ^You apply|^You drink|^You eat|^You take
matchre rub_belradi ^Rub what
matchre need_belradi ^Drink what|^Eat what|^What were you referring|^Please rephrase that command|Perhaps once crafted
send %quaff my belradi %prep_belradi
matchwait 5
goto need_belradi

rub_belradi:
matchre need_belradi ^What were you referring
send get my belradi %prep_belradi
matchwait 2
send rub my belradi %prep_belradi
waitforre ^You rub|^What|^I|^Rub|Note|Perhaps
gosub stowing
goto HERB_SUPPLIES

need_belradi:
var have_belradi 0

#Report on missing herbs
HERB_SUPPLIES:
echo ##########################################
echo MISSING THE FOLLOWING HERBS FOR HEALING:
echo
if (%have_nemoih = 0) then echo nemoih (external head wounds)
if (%have_eghmok = 0) then echo eghmok (internal head wounds)
if (%have_sufil = 0) then echo sufil (external eye wounds)
if (%have_aevaes = 0) then echo aevaes (internal eye wounds)
if (%have_georin = 0) then echo georin (external neck wounds)
if (%have_riolur = 0) then echo riolur (internal neck wounds)
if (%have_plovik = 0) then echo plovik (external chest wounds)
if (%have_ithor = 0) then echo ithor (internal chest wounds)
if (%have_nilos = 0) then echo nilos (external abdomen wounds)
if (%have_muljin = 0) then echo muljin (internal abdomen wounds)
if (%have_hulnik = 0) then echo hulnik (external back wounds)
if (%have_junliar = 0) then echo junliar (internal back wounds)
if (%have_blocil = 0) then echo blocil (internal back wounds)
if (%have_jadice = 0) then echo jadice (external limb wounds)
if (%have_yelith = 0) then echo yelith (internal limb wounds)
if (%have_aloe = 0) then echo aloe (skin wounds)
if (%have_lujeakave = 0) then echo lujeakave (nerve wounds)
if (%have_cebi = 0) then echo cebi (external scars)
if (%have_hisan = 0) then echo hisan (internal scars)
echo #########################################
END_HERB:
END_HERBS:
action (herbs) off
action remove (minor|severe) twitching|difficulty controlling actions|paralysis of the entire body
action remove (abrasions|scuffing|scratches) (about|across|along|around|from|in|of|on|to) the skin|rash|boils|sores
action remove (abrasions|scuffing|scratches|cuts and bruises|cuts|slashes|holes) (about|across|along|around|from|in|of|on|to) the head|(cracked|crushed) skull|pulpy stump for a head
action remove (bruised|swollen|bloated) head|bruising (about|across|along|around|from|in|of|on|to) the head|inside head
action remove (abrasions|scuffing|scratches|cuts and bruises|cuts|slashes|holes) (about|across|along|around|from|in|of|on|to) the neck|(shattered|useless) neck
action remove bruising (about|across|along|around|from|in|of|on|to) the neck|(bruised|swollen|swollen and shattered) neck|inside neck
action remove (abrasions|scuffing|scratches|cuts and bruises|cuts|slashes|holes) (about|across|along|around|from|in|of|on|to) the chest|(shattered|destroyed) chest
action remove bruising (about|across|along|around|from|in|of|on|to) the chest|(bruised|swollen) chest|inside chest
action remove (abrasions|scuffing|scratches|cuts and bruises|cuts|slashes|holes) (about|across|along|around|from|in|of|on|to) the abdomen|abdomen deeply gouged|destroyed abdomen
action remove  bruising (about|across|along|around|from|in|of|on|to) the abdomen|(bruised|swollen) abdomen|discolored abdomen|inside abdomen
action remove (abrasions|scuffing|scratches|cuts and bruises|cuts|slashes|holes) (about|across|along|around|from|in|of|on|to) the back|(shattered|destroyed) back
action remove (about|across|along|around|from|in|of|on|to) the back|(bruised|swollen) back|inside back
action remove (abrasions|scuffing|scratches|cuts and bruises|cuts|slashes|holes) (about|across|along|around|from|in|of|on|to) the ((right|left) (hand|arm|leg)|tail)|(broken|shattered) ((right|left) (hand|arm|leg)|tail)|stump for a ((right|left) (hand|arm|leg)|tail)
action remove bruising (about|across|along|around|from|in|of|on|to) the ((right|left) (hand|arm|leg)|tail)|(bruised|swollen) ((right|left) (hand|arm|leg)|tail)|inside ((right|left|r\.|l\.) (hand|arm|leg)|tail)
action remove (black and blue|swollen|bleeding|slashed|shattered) (right|left) eye|cavity for a (right|left) eye
action remove bruising (about|across|along|around|from|in|of|on|to) the (right|left) eye|bruised (right|left) eye|bruised and (crossed|cloudy|blind) (right|left) eye|inside ((right|left)|r\.|l\.) eye
action remove a stump for|flesh stump for|gashes|malformed|missing|non-existent|scarred|scarring|scars|shriveled|skin discoloration|skin loss|skin tone|socket|stump
action remove a blind|blank stare|breath|clouded|emaciated|move|moving|numbness|pallor|paralyzed|twitch|twitching
send health
action remove ^That was the last of
unvar nerves
unvar skin
unvar ext_head
unvar int_head
unvar ext_neck
unvar int_neck
unvar ext_chest
unvar int_chest
unvar ext_abdomen
unvar int_abdomen
unvar ext_back
unvar int_back
unvar ext_limb
unvar int_limb
unvar ext_eye
unvar int_eye
unvar ext_scar
unvar int_scar
unvar quaff
echo ######################
echo *** DONE HERB HEALING!
echo ######################
put #PARSE DONE HERB!
return

set_ext_scar:
var ext_scar 1
return

set_int_scar:
var int_scar 1
return
######################################################
## BANK PROFIT TRACKING
BANK:
    if matchre("$zoneid", "\b(1|61|13|112)\b") then var CurrentCurrency Kronars
    if matchre("$zoneid", "\b(30|41|42|35|47|34a|90|99|107|106)\b") then var CurrentCurrency Lirums
    if matchre("$zoneid", "\b(116|127|114|67|123|150|66)\b") then var CurrentCurrency Dokoras
    var Copper 0
    var Bronze 0
    var Silver 0
    var Gold 0
    var Plat 0
    var Profit 0
    var TempProfit 0
    put #var UC_tempProfit 0
    action (bank) var Plat $1 when (\d+) platinum,
    action (bank) var Gold $1 when (\d+) gold,
    action (bank) var Silver $1 when (\d+) silver,
    action (bank) var Bronze $1 when (\d+) bronze,
    action (bank) var Copper $1 when (\d+) copper
    action (debt) on
    put wealth
    wait
    pause 0.2
    pause 0.0001
    action (bank) on
    put check balance
    wait
    pause 0.2
    pause 0.1
    pause 0.001
    evalmath pre.dep %Copper + (%Bronze*10) + (%Silver*100) + (%Gold*1000) + (%Plat*10000)
    echo
    echo ** PRE-DEPOSIT: %pre.dep
    echo
    pause 0.1
    gosub BANK.COIN.CLEAR
    put deposit all
    pause
    pause 0.001
    pause 0.001
    put check balance
    wait
    pause 0.2
    pause 0.1
    pause 0.001
    if !def(UC_tempProfit) then put #var UC_tempProfit 0
    evalmath Profit $UC_tempProfit+((%Copper + (%Bronze*10) + (%Silver*100) + (%Gold*1000) + (%Plat*10000))-%pre.dep)
    pause 0.001
    echo
    echo ** PROFIT: %Profit
    echo
    pause 0.001
    put #var UC_tempProfit %Profit
    action (bank) off
    action (debt) off
    evalmath Plat floor(%Profit/10000)
    evalmath Gold floor((%Profit-(%Plat*10000))/1000)
    evalmath Silver floor((%Profit-(%Plat*10000)-(%Gold*1000))/100)
    evalmath Bronze floor((%Profit-(%Plat*10000)-(%Gold*1000)-(%Silver*100))/10)
    evalmath Copper floor((%Profit-(%Plat*10000)-(%Gold*1000)-(%Silver*100)-(%Bronze*10))/1)
    pause 0.001
    echo
    echo ######################
    echo *** Profit: %Profit %CurrentCurrency
    if (%Plat > 0) then echo *** %Plat Plat, %Gold Gold, %Silver Silver, %Bronze Bronze and %Copper Copper
    if ((%Plat = 0) && (%Gold > 0)) then echo *** %Gold Gold, %Silver Silver, %Bronze Bronze and %Copper Copper
    if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then echo ***  %Silver Silver, %Bronze Bronze and %Copper Copper
    if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then echo ***  %Bronze Bronze and %Copper Copper
    if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then echo ***  %Copper Copper
    echo ######################
    echo
    pause 0.1
    pause 0.1
    if ($UC_tempProfit > 0) then put #echo >Log Gold **** Deposited coin at bank - %Profit %CurrentCurrency
    if ($UC_tempProfit > 0) then
          {
               if (%Plat > 0) then put #echo >Log Gold **** %Plat Plat, %Gold Gold, %Silver Silver, %Bronze Bronze and %Copper Copper
               if ((%Plat = 0) && (%Gold > 0)) then put #echo >Log Gold **** %Gold Gold, %Silver Silver, %Bronze Bronze and %Copper Copper
               if ((%Plat = 0) && (%Gold = 0) && (%Silver > 0)) then put #echo >Log Gold **** %Silver Silver, %Bronze Bronze and %Copper Copper
               if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze > 0)) then put #echo >Log Gold **** %Bronze Bronze and %Copper Copper
               if ((%Plat = 0) && (%Gold = 0) && (%Silver = 0) && (%Bronze = 0)) then put #echo >Log Gold **** %Copper Copper
          }
    var TempProfit $UC_Profit
    math TempProfit add %Profit
    put #var UC_Profit %TempProfit
    pause 0.3
    pause 0.2
    gosub BANK.COIN.CLEAR
    gosub STATUSBAR
    return
COMBINE.BANK:
     math Plats add $UC_Plat
     math Golds add $UC_Gold
     math Silvers add $UC_Silver
     math Bronzes add $UC_Bronze
     math Coppers add $UC_Copper
     return
BANK.COIN.CLEAR:
     var Copper 0
     var Bronze 0
     var Silver 0
     var Gold 0
     var Plat 0
     return
BANK.COIN.MATH:
     math Bronze multiply 10
     math Silver multiply 100
     math Gold multiply 1000
     math Plat multiply 10000
     return
BANK.PREDEP.MATH:
     math preDeposit add %Copper
     math preDeposit add %Bronze
     math preDeposit add %Silver
     math preDeposit add %Gold
     math preDeposit add %Plat
     return
BANK.POSTDEP.MATH:
     math postDeposit add %Copper
     math postDeposit add %Bronze
     math postDeposit add %Silver
     math postDeposit add %Gold
     math postDeposit add %Plat
     return
##################################################################################################################################
## TIPPING MODULE
TIP:
     # debug 10
     var tipped 0
     var person $1
     var currency kronars
     action var kamount $1 when ^.+ Kronars\s+\((\d+) copper Kronars\)\.
     action var lamount $1 when ^.+ Lirums\s+\((\d+) copper Lirums\)\.
     action var damount $1 when ^.+ Dokoras\s+\((\d+) copper Dokoras\)\.
     var kamount no
     var lamount no
     var damount no
     if ("%person" = "NULL") then
     {
          echo type name
          echo .tip person
          echo will tip all you have of the different types
          return
     }
     delay 0.0001
     delay 0.0001
     send wealth
     waitfor Wealth:
     pause 0.0001
     if "%kamount" != "no" then
          {
          var coin %kamount
          var currency kronars
          gosub JUST_THE_TIP
          }
     delay 0.0001
     if "%lamount" != "no" then
          {
          var coin %lamount
          var currency lirums
          gosub JUST_THE_TIP
          }
     delay 0.0001
     if "%damount" != "no" then
          {
          var coin %damount
          var currency dokoras
          gosub JUST_THE_TIP
          }
     echo
     echo *** TIPPING DONE!
     echo
     put #echo >Log #66ccff **** Tipped Bankbot! - %tipped %currency
     put #parse DONE TIP!
     put #parse DONE TIPPING!
     put #parse TIPPING DONE!
     return

JUST_THE_TIP:
     var tipped %coin
     delay 0.001
     pause 0.001
     matchre RETURN You have exceeded your coin handoff
     matchre RETURN accepts your tip and slips it away
     matchre RETURN ^I could not
     matchre RETURN ^But that|You must
     send tip %person %coin %currency
     matchwait 20
     math tip add 1
     if (%tip > 2) then
          {
               unvar tip
               unvar tipped
               unvar coin
               unvar currency
               return
          }
     goto JUST_THE_TIP
############################################################################################
#### JAIL HANDLING
#### DEBT PAYING ROUTINE
#### ROBUST AS A MOTHERFUCKER
############################################################################################
JAILED:
JAIL_CHECK:
JAIL.CHECK:
     action (jail) off
     put #parse TAKING CARE OF BUSINESS
     action goto PLEAD when ^The eyes of the court|PLEAD INNOCENT or PLEAD GUILTY|Your silence shall be taken|How do you plead\?|Shouldn't you be worrying|You don't seem to be able
     var Currentfine 0
     put #script abort all except %scriptname
     delay 0.0001
     #put #script pause %scriptname
     if ("$zoneid" = "1") then goto CROSSING_JAIL
     if ("$zoneid" = "30") then goto HAVEN_JAIL
     if ("$zoneid" = "42") then goto THEREN_JAIL
     if ("$zoneid" = "47") then goto MUSPARI_JAIL
     if ("$zoneid" = "61") then goto LETH_JAIL
     if ("$zoneid" = "116") then goto HIB_JAIL
     if ("$zoneid" = "107") then goto MERKRESH_JAIL
     if ("$zoneid" = "67") then goto SHARD_JAIL
     if ("$zoneid" = "99") then goto AESRY_JAIL
     if ("$zoneid" = "90") then goto RATHA_JAIL
     delay 0.1
     goto JAILED
AESRY_JAIL:
     var CURRENT_CITY AESRY
     echo Aesry JAIL
     put #parse AESRY JAIL
     goto INIT_JAIL
RATHA_JAIL:
     var CURRENT_CITY RATHA
     echo Ratha JAIL
     put #parse RATHA JAIL
     goto INIT_JAIL
MERKRESH_JAIL:
     var CURRENT_CITY MERKRESH
     echo Mer'Kresh JAIL
     put #parse MERKRESH JAIL
     goto INIT_JAIL
MUSPARI_JAIL:
     var CURRENT_CITY MUSPARI
     echo MUSPAR'I JAIL
     put #parse MUSPARI JAIL
     goto INIT_JAIL
THEREN_JAIL:
     var CURRENT_CITY THEREN
     echo Theren JAIL
     put #parse THEREN JAIL
     goto INIT_JAIL
HAVEN_JAIL:
     var CURRENT_CITY RIVERHAVEN
     echo RIVERHAVEN JAIL
     put #parse RIVERHAVEN JAIL
     goto INIT_JAIL
LETH_JAIL:
     var CURRENT_CITY LETH
     echo LETH JAIL
     put #parse LETH JAIL
     goto INIT_JAIL
CROSSING_JAIL:
     var CURRENT_CITY CROSSING
     echo CROSSING JAIL
     put #parse CROSS JAIL
     goto INIT_JAIL
HIB_JAIL:
     var CURRENT_CITY HIB
     echo HIB JAIL
     put #parse HIB JAIL
     goto INIT_JAIL
SHARD_JAIL:
     var CURRENT_CITY SHARD
     echo SHARD JAIL
     put #parse SHARD JAIL
     goto INIT_JAIL
INIT_JAIL:
     math Jailed add 1
     var PLEAD guilty
     echo
     echo *** YOU'VE BEEN JAILED IN %CURRENT_CITY! ***
     echo
     echo *** Taking care of business..
     put #echo >log Orange **** ARRESTED IN %CURRENT_CITY ****
     if (%Jailed = 1) then var JAIL %CURRENT_CITY
     if (%Jailed = 2) then var JAIL2 %CURRENT_CITY
     if (%Jailed = 3) then var JAIL3 %CURRENT_CITY
     if (%Jailed = 4) then var JAIL4 %CURRENT_CITY
     if ("$roomname" = "Guard House, Jail Cell") then goto JAIL_FORAGE
     if ("$zoneid" = "1") && ($roomid = 23) then goto GET_SACK
     if ("$zoneid" = "1") && ($roomid = 406) then goto PLEAD
     if ("$zoneid" = "1") && !matchre("$roomid" , "(620|406|0)") then goto GET_SACK
     if ("$roomname" = "The Great Tower, Cell") then goto JAIL_FORAGE
     if ("$zoneid" = "67") && ($roomid = 528) then goto PLEAD
     if ("$zoneid" = "67") && ($roomid = 527) then goto GET_SACK
     if ("$zoneid" = "67") && !matchre("$roomid" , "(528|527|0|32)") then goto GET_SACK
     if ("$roomname" = "Town Jail, The Cell") then goto JAIL_FORAGE
     if ("$zoneid" = "30") && ($roomid = 270) then goto PLEAD
     if ("$zoneid" = "30") && ($roomid = 76) then goto GET_SACK
     if ("$zoneid" = "30") && !matchre("$roomid" , "(76|270|0)") then goto GET_SACK
     if ("$roomname" = "Muspar'i, Jail Cell") then goto JAIL_FORAGE
     if ("$zoneid" = "47") && ($roomid = 255) then goto PLEAD
     if ("$zoneid" = "47") && ($roomid = 254) then goto GET_SACK
     if ("$zoneid" = "47") && !matchre("$roomid" , "(255|254|0)") then goto GET_SACK
     if ("$roomname" = "Theren Keep, Cell") then goto JAIL_FORAGE
     if ("$zoneid" = "42") && ($roomid = 125) then goto PLEAD
     if ("$zoneid" = "42") && ($roomid = 319) then goto GET_SACK
     if ("$zoneid" = "42") && !matchre("$roomid" , "(319|125|0)") then goto GET_SACK
     if ("$roomname" = "Gallows Tree, Cell") then goto JAIL_FORAGE
     if ("$zoneid" = "61") && ($roomid = 180) then goto PLEAD
     if ("$zoneid" = "61") && !matchre("$roomid" , "(181|0)") then goto GET_SACK
     if ("$zoneid" = "107") && ($roomid = 268) then goto PLEAD
     if ("$zoneid" = "107") && !matchre("$roomid" , "(306|268|0)") then goto GET_SACK
     if ("$roomname" = "Justice Office, Cell") then goto JAIL_FORAGE
     if ("$zoneid" = "116") && ($roomid = 202) then goto PLEAD
     if ("$zoneid" = "99") && ($roomid = 163) then goto PLEAD
     if ("$zoneid" = "99") && !matchre("$roomid" , "(161|0)") then goto GET_SACK
     if ("$roomname" = "Ratha, Jail") then var RATHA_JAIL 1;goto JAIL_FORAGE
     if ("$roomname" = "Malk'smo Holding Cell") then var RATHA_JAIL 3;goto JAIL_FORAGE
     if ("$zoneid" = "90") && ($roomid = 349) then var RATHA_JAIL 1;goto PLEAD
     if ("$zoneid" = "90") && ($roomid = 581) then var RATHA_JAIL 3;goto PLEAD
     if ("$zoneid" = "90") && !matchre("$roomid" , "(581|349|0)") then goto GET_SACK
     pause 0.0001
     echo *** WAITING FOR SENTENCE! ***
JAIL_FORAGE:
     pause 0.0001
     pause 0.0001
     if ($standing = 0) then gosub STAND
     if matchre("innocent", "(?i)%PLEAD") && ("$guild" = "Thief") then send khri cunning
     if !matchre("$zoneid" , "(107|67|61|30|47)") then goto PLEAD_WAIT
     gosub KICKEM
     if ("$zoneid" = "67") then gosub collect dust bunny
     if ("$zoneid" = "61") then gosub collect dust bunny
     if ("$zoneid" = "30") then gosub collect coin
     if ("$zoneid" = "47") then gosub collect coin
     if ("$zoneid" = "107") then gosub collect coin
     pause 0.5
     goto JAIL_FORAGE

PLEAD_WAIT:
     waitforre ^The eyes of the court|PLEAD INNOCENT or PLEAD GUILTY|Your silence shall be taken|How do you plead\?|Shouldn't you be worrying|You don't seem to be able
PLEAD:
     if matchre("$roomname", "The Great Tower, Cell") then goto JAIL_FORAGE
     if matchre("$roomname", "Guard House, Jail Cell") then goto JAIL_FORAGE
     if matchre("$roomname", "Town Jail, The Cell") then goto JAIL_FORAGE
     if matchre("$roomname", "Muspar'i, Jail Cell") then goto JAIL_FORAGE
     if matchre("$roomname", "Theren Keep, Cell") then goto JAIL_FORAGE
     if matchre("$roomname", "Gallows Tree, Cell") then goto JAIL_FORAGE
     if matchre("$roomname", "Justice Office, Cell") then goto JAIL_FORAGE
     if matchre("$roomname", "Ratha, Jail") then var RATHA_JAIL 1;goto JAIL_FORAGE
     if matchre("$roomname", "Malk'smo Holding Cell") then var RATHA_JAIL 3;goto JAIL_FORAGE
     action remove ^The eyes of the court|PLEAD INNOCENT or PLEAD GUILTY|Your silence shall be taken|How do you plead\?|Shouldn't you be worrying|You don't seem to be able
     pause 0.1
     send plead %PLEAD
     pause 2
     pause 0.5
     echo FINE: %fine
     put #parse FINE: %fine
     var Currentfine %fine
     if ("$guild" = "Thief") then send khri stop cunning
     pause 0.3
     pause 0.0001
     if (("$zoneid" = "1") && ($roomid = 23)) then goto STOCKS
GET_SACK:
     pause 0.0001
     matchre GET_SACK ^\.\.\.wait|^Sorry\,
     matchre DEBT ^You glance down at your empty hands
     matchre PLEAD ^You don't seem to be able to move
     matchre STOCKS ^Given your helpless condition
     matchre SACK small sack
     send glance
     matchwait 20
DEBT:
     var fine 0
     var wealth 0
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     pause 0.0001
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     #### NEW - THIS MAKES SURE YOU ARE IN TOWN BEFORE CALLING THE DEBT ROUTINE
     if !matchre("$zoneid", "\b(1|30|42|47|61|67|90|107|116)\b") then
          {
               #### ESCAPE TO NEAREST CITY
               var GOSUBBING ON
               var escaping ON
               gosub ESCAPE_NOW
               var GOSUBBING OFF
               #### DONE ESCAPING TO CITY
          }
     #################
     if matchre("$scriptlist" , "steal\.cmd") then put #script abort steal
     if ("$zoneid" = "1") then var CURRENT_CITY Crossing
     if ("$zoneid" = "30") then var CURRENT_CITY Riverhaven
     if ("$zoneid" = "42") then var CURRENT_CITY Theren
     if ("$zoneid" = "47") then var CURRENT_CITY Muspari
     if ("$zoneid" = "61") then var CURRENT_CITY Leth Deriel
     if ("$zoneid" = "116") then var CURRENT_CITY Hib
     if ("$zoneid" = "107") then var CURRENT_CITY Merkresh
     if ("$zoneid" = "67") then var CURRENT_CITY Shard
     if ("$zoneid" = "99") then var CURRENT_CITY Aesry
     if ("$zoneid" = "90") then var CURRENT_CITY Ratha
     if ("$zoneid" = "150") then goto NO_FINE
     if ("$zoneid" = "69") then var CITY HORSE
     if ("$zoneid" = "99") then var CITY AESRY
     if ("$zoneid" = "90") then var CITY RATHA
     if ("$zoneid" = "47") then var CITY MUSPARI
     if ("$zoneid" = "42") then var CITY THEREN
     if ("$zoneid" = "30") then var CITY RIVERHAVEN
     if ("$zoneid" = "7") then var CITY ARTHE
     if ("$zoneid" = "1") then var CITY CROSSING
     if ("$zoneid" = "61") then var CITY LETH
     if ("$zoneid" = "67") then var CITY SHARD
     if ("$zoneid" = "116") then var CITY HIB
     if ("$zoneid" = "107") then var CITY MERKRESH
     echo
     echo **** GETTING COIN FROM BANK TO PAY FINE ****
     echo
     gosub STAND
     if matchre("$roomobjs","(\brat\b|monkey|\bcat\b|\bpig\b)") then
          {
               gosub GET $1
               gosub stowing
          }
     pause 0.2
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if (("$zoneid" = "42") && (%debt = 0)) then goto THEREN_JAIL_GET_FINE
     if ("$guild" = "Necromancer") then gosub NECRO_PREP
     if ("$zoneid" = "90") then
          {
               var GUARD 1guard
               if ("$roomid" = "349") then var GUARD 1guard
               if ("$roomid" = "581") then var GUARD 3guard
          }
     pause 0.1
TO_TELLER:
     var plat 20
     var fine 0
     var wealth 0
     var nofundloop 0
     gosub AUTOMOVE teller
CHECKING_FINE:
     echo ##################
     echo *** CHECKING DEBT
     echo ##################
     pause 0.3
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "107") then goto FINECHECK_QI
     if ("$zoneid" = "99") then goto FINECHECK_QI
     if ("$zoneid" = "90") then goto FINECHECK_QI
     if ("$zoneid" = "61") then goto FINECHECK_ZOLUREN
     if ("$zoneid" = "1") then goto FINECHECK_ZOLUREN
     if ("$zoneid" = "30") then goto FINECHECK_THERENGIA
     if ("$zoneid" = "34a") then goto FINECHECK_THERENGIA
     if ("$zoneid" = "42") then goto FINECHECK_THERENGIA
     if ("$zoneid" = "47") then goto FINECHECK_THERENGIA
     if ("$zoneid" = "67") then goto FINECHECK_ILITHI
     if ("$zoneid" = "116") then goto FINECHECK_FORFEDHDAR
     pause
     echo
     echo *** CRITICAL ERROR!
     echo *** UKNOWN JAIL LOCATION!!
     echo
     put #echo >Log #ff0000 *** CRITICAL ERROR!!!!
     put #echo >Log #ff0000 *** UNKOWN JAIL LOCATION: Zone- $zoneid Room- $roomid
     put #echo >Log #ff0000 *** PAY YOUR FINE MANUALLY!
     pause 0.1
     exit
FINECHECK_QI:
var LOCATION FINECHECK_QI
     matchre SET_FINE Qi\.\s*\((\d+) copper Lirums\)
     send wealth
     matchwait 3
     goto NO_FINE
FINECHECK_THERENGIA:
var LOCATION FINECHECK_THERENGIA
     matchre SET_FINE Therengia\.\s*\((\d+) copper Lirums\)
     send wealth
     matchwait 3
     goto NO_FINE
FINECHECK_ZOLUREN:
var LOCATION FINECHECK_ZOLUREN
     matchre SET_FINE Zoluren\.\s*\((\d+) copper Kronars\)
     send wealth
     matchwait 3
     goto NO_FINE
FINECHECK_ILITHI:
var LOCATION FINECHECK_ILITHI
     matchre SET_FINE Ilithi\.\s*\((\d+) copper Dokoras\)
     send wealth
     matchwait 3
     goto NO_FINE
FINECHECK_FORFEDHDAR:
var LOCATION FINECHECK_FORFEDHDAR
     matchre SET_FINE Forfedhdar\.\s*\((\d+) copper Dokoras\)
     send wealth
     matchwait 3
     goto NO_FINE
SET_FINE:
     pause 0.1
     var fine $1
     pause 0.1
     eval fine replacere("%fine", ",", "")
     eval fine replacere("%fine", " ", "")
     echo ##########################
     echo *** CURRENT CITY FINE: %fine
     echo ##########################
     math currentfine add %fine
     pause 0.5

CHECK_CURRENT_MONEY:
     echo ######################
     echo *** CHECKING CURRENT CASH
     echo ######################
     var WealthLirums 0
     var WealthDokoras 0
     var WealthKronars 0
     pause 0.3
     action var WealthLirums $1 when Lirums\s\(([\d,]+) copper Lirums\)\.
     action var WealthDokoras 0 when ^No Lirums
     action var WealthDokoras $1 when Dokoras\s\(([\d,]+) copper Dokoras\)\.
     action var WealthDokoras 0 when ^No Dokoras
     action var WealthKronars $1 when Kronars\s\(([\d,]+) copper Kronars\)\.
     action var WealthKronars 0 when ^No Kronars
     pause 0.1
     put wealth
     wait
     pause
     pause 0.1
     action remove Lirums\s\(([\d,]+) copper Lirums\)\.
     action remove ^No Lirums
     action remove Dokoras\s\(([\d,]+) copper Dokoras\)\.
     action remove ^No Dokoras
     action remove Kronars\s\(([\d,]+) copper Kronars\)\.
     action remove ^No Kronars
FINE_PROCESS:
     if ("$zoneid" = "107") then var wealth %WealthLirums;echo ** Lirums: %WealthLirums
     if ("$zoneid" = "99") then var wealth %WealthLirums;echo ** Lirums: %WealthLirums
     if ("$zoneid" = "90") then var wealth %WealthLirums;echo ** Lirums: %WealthLirums
     if ("$zoneid" = "61") then var wealth %WealthDokoras;echo ** Dokoras: %WealthDokoras
     if ("$zoneid" = "1") then var wealth %WealthKronars;echo ** Kronars: %WealthKronars
     if ("$zoneid" = "30") then var wealth %WealthLirums;echo ** Lirums: %WealthLirums
     if ("$zoneid" = "34a") then var wealth %WealthLirums;echo ** Lirums: %WealthLirums
     if ("$zoneid" = "42") then var wealth %WealthLirums;echo ** Lirums: %WealthLirums
     if ("$zoneid" = "47") then var wealth %WealthLirums;echo ** Lirums: %WealthLirums
     if ("$zoneid" = "67") then var wealth %WealthDokoras;echo ** Dokoras: %WealthDokoras
     if ("$zoneid" = "116") then var wealth %WealthDokoras;echo ** Dokoras: %WealthDokoras
     pause 0.3
     if (%fine = 0) then goto NO_FINE
     if (%fine > 20000) then
          {
               put #echo >Log Crimson *** Warning! Large Fines in %CURRENT_CITY! Current Fine: %fine
               if (%Debt = 0) then put #echo >Log Crimson *** Consider laying low from stealing for a few days or switching provinces!
          }
     if (%wealth > %fine) then
          {
               echo ################################
               echo *** Paying debt with cash on hand!
               echo ################################
               pause 0.4
               goto JAIL_PAY_DEBT
          }
     if (%fine > 250000) then goto BIGGER_FINE
     if (%fine > 100000) then goto BIG_FINE
     goto WITHDRAW
WITHDRAW:
     var LOCATION WITHDRAW
     if ($invisible = 1) then gosub stopinvis
     pause 0.2
     pause 0.1
     matchre WITHDRAW ^\.\.\.wait|^Sorry\,
     matchre BANK_INVIS ^How can you withdraw money when the clerk can't even see
     matchre TO_TELLER ^You must be at a bank teller's window
     matchre JAIL_PAY_DEBT ^The clerk counts out|it looks like your current balance|^You count out|Searching methodically|^You find
     matchre NO_FUNDS_CHECK we are not lending money|You don't have that much
     matchre NO_FUNDS_CHECK You don't have that much money in your account\.
     send withdraw %fine copper
     matchwait 20
     goto NO_FUNDS
BIG_FINE:
     var LOCATION BIG_FINE
     if ($invisible = 1) then gosub stopinvis
     pause 0.2
     pause 0.1
     matchre BIG_FINE ^\.\.\.wait|^Sorry\,
     matchre BANK_INVIS ^How can you withdraw money when the clerk can't even see
     matchre TO_TELLER ^You must be at a bank teller's window
     matchre JAIL_PAY_DEBT ^The clerk counts out|it looks like your current balance|^You count out|Searching methodically|^You find
     matchre NO_FUNDS_CHECK we are not lending money|You don't have that much
     matchre NO_FUNDS_CHECK You don't have that much money in your account\.
     send withdraw %plat plat
     matchwait 20
     goto NO_FUNDS
BANK_INVIS:
     delay 0.001
     if ("$guild" = "Necromancer") then
          {
               gosub PUT release eotb
               pause 0.3
          }
     if ("$guild" = "Thief") then
          {
               gosub PUT khri stop silence vanish
               pause 0.3
          }
     if ("$guild" = "Moon Mage") then
          {
               gosub PUT release rf
               pause 0.3
          }
     pause 0.3
     goto %LOCATION
NO_FUNDS_CHECK:
     var fine 0
     math nofundloop add 1
     if (%nofundloop > 2) then goto NO_FUNDS
     goto CHECKING_FINE
BIGGER_FINE:
var LOCATION BIGGER_FINE
     if (%fine > 200000) then var plat 25
     if (%fine > 250000) then var plat 35
     if (%fine > 350000) then var plat 40
     if (%fine > 400000) then var plat 45
     if (%fine > 450000) then var plat 50
     if (%fine > 500000) then var plat 90
     if (%fine > 900000) then var plat 120
     if (%fine > 1200000) then var plat 150
     if (%fine > 1500000) then var plat 200
     if (%fine > 2000000) then var plat 300
     goto BIG_FINE
NO_FINE:
     echo
     echo *** You have no fine
     echo
     if ("$zoneid" = "1") then gosub AUTOMOVE 43
     if (%debt = 1) then return
     if ("%GOSUBBING" = "ON") then return
     goto RETURN_TO_JAIL
JAIL_PAY_DEBT:
var LOCATION PAY_DEBT
     echo
     echo **** Paying off your debt! ***
     echo
     pause 0.3
     # Walking to pay off the debt
     gosub AUTOMOVE debt
     if ($invisible = 1) then gosub stopinvis
     pause 0.2
     send pay %fine
     pause
     gosub AUTOMOVE teller
DONE_DEBT:
var LOCATION DONE_DEBT
     action (debt) on
     pause 0.1
     if !matchre("%BANKRUN", "(?i)(ON|1|YES)") then goto RETURN_TO_JAIL
     if ($invisible = 1) then gosub stopinvis
     send deposit all
     pause 0.5
     pause 0.3
     action (debt) off
RETURN_TO_JAIL:
     if (%debt = 1) then return
     if (%debt = 1) then goto PAID_DEBT
     echo
     echo **** Heading back to jail now ****
     echo
     pause 0.5
     if ("$zoneid" = "42") then goto THEREN_KEEP_JAIL
     if ("$zoneid" = "47") then goto MUSPARI_JAIL_RETURN
     if ("$zoneid" = "90") then goto RATHA_JAIL_RETURN
     if ("$zoneid" = "67") then goto SHARD_JAIL_RETURN
     if ("$zoneid" = "116") then goto HIB_JAIL_RETURN
     # Walking to the Guard House
     gosub AUTOMOVE guard
     goto CLAN
MUSPARI_JAIL_RETURN:
     gosub AUTOMOVE jail
     goto CLAN
RATHA_JAIL_RETURN:
     if (%RATHA_JAIL = 1) then gosub AUTOMOVE 1GUARD
     if (%RATHA_JAIL = 3) then gosub AUTOMOVE 3GUARD
     goto CLAN
HIB_JAIL_RETURN:
     gosub AUTOMOVE 200
     goto CLAN
SHARD_JAIL_RETURN:
     gosub AUTOMOVE sentin
CLAN:
     var fullhands 0
     var removed 0
     var removeCheck 0
     var itemsRemoved 0
     var item1 NULL
     var item2 NULL
     var savedleft NULL
     var savedright NULL
CLAN.ITEM_CHECK:
     if matchre("%CLAN", "(?i)(NULL|OFF|0)") then goto THE_SACK
     if matchre("%CLAN", "(?i)(ON|1|YES)")) then send remove my %CLAN.ITEM
     pause 0.3
     pause 0.1
THESACK:
THE_SACK:
     if ($invisible = 1) then gosub stopinvis
     pause 0.5
     matchre THE_SACK ^\.\.\.wait|^Sorry\,|^I could not|^Please rephrase
     matchre CHECK_LOC ^What were you
     matchre SACK_PRE ^You reach for your sack and retrieve the equipment
     matchre INV_CHECK ^You'll need to not be wearing anything
     matchre INV_CHECK ^Realizing you're wearing too much
     matchre DEBT paid off your debt to society
     send get $charactername sack
     matchwait 20
     goto GET_SACK
CHECK_LOC:
     if (("$zoneid" = "90") && ($roomid = 349)) then
          {
               var RATHA_JAIL 3
               gosub AUTOMOVE 581
               goto THE_SACK
          }
     if (("$zoneid" = "90") && ($roomid = 581)) then
          {
               var RATHA_JAIL 1
               gosub AUTOMOVE 349
               goto THE_SACK
          }
     send get my small sack
     pause 0.3
     pause 0.2
     if (!matchre("$lefthand", "Empty") || !matchre("$righthand", "Empty")) then goto INV_CHECK
     echo *** OH NO! CAN'T FIND YOUR JAIL SACK!!! RECOVER YOUR GEAR MANUALLY!!
     put #echo >Log #ff0000 *** CANT FIND JAIL SACK!! RECOVER GEAR MANUALLY!!
     exit
INV_CHECK:
     echo
     echo *** Removing worn items before grabbing sack!!
     echo
     if (!matchre("$lefthand", "Empty") && !matchre("$righthand", "Empty")) then goto CRIT_ERROR
     pause 0.6
     matchre THE_SACK You aren't wearing anything special
     put inv
     matchwait 2
     matchre THE_SACK You aren't wearing anything special
     matchre REMOVE_JAILITEM \b(spher|key|skull|sphere|gwethdesuan|(?<!wea)ring|toad|obsidian|band)
     matchre REMOVE_ITEM (\S+)(\.)
     put inv
     matchwait 20
     put #echo >Log #ff0000 *** Missing Match Label in INV_CHECK
     put #log $datetime MISSING MATCH IN INV_CHECK ***
REMOVE_ITEM:
     var wornItem $1
     var removed 1
     math removeCheck add 1
     if ((%removeCheck > 2) && (%fullhands = 1)) then goto CRAZY_ERROR
     if ((%removeCheck > 2) && (%fullhands = 0)) then goto CRIT_ERROR
     # eval wornItem replacere("%wornItem", " (?:with[^\|]*|\w+(?<!crack|bloodsoak|brand|hood|finger)ed[^\|]*|\w+(?<!glow|display|hang)ing[^\|]*)",  "|")
     if (!matchre("$lefthand", "Empty") && !matchre("$righthand", "Empty")) then goto CRIT_ERROR
     if ("%wornItem" = "ring") && matchre("$righthandnoun", "ring") then gosub PUT remove my second %wornItem
     else gosub PUT remove my %wornItem
     pause 0.5
     pause 0.2
     if (%itemsRemoved = 0) then var item1 %wornItem
     if (%itemsRemoved = 1) then var item2 %wornItem
     math itemsRemoved add 1
     if ((%removeCheck > 2) && (%fullhands = 1)) then goto CRAZY_ERROR
     if ((%removeCheck > 2) && (%fullhands = 0)) then goto CRIT_ERROR
     goto INV_CHECK
REMOVE_JAILITEM:
     var jailitem $1
     var removed 1
     math removeCheck add 1
     if ((%removeCheck > 2) && (%fullhands = 1)) then goto CRAZY_ERROR
     if ((%removeCheck > 2) && (%fullhands = 0)) then goto CRIT_ERROR
     if (!matchre("$lefthand", "Empty") && !matchre("$righthand", "Empty")) then goto CRIT_ERROR
     if ("%jailitem" = "ring") && matchre("$righthandnoun", "ring") then gosub PUT remove my second %jailitem
     else gosub PUT remove my %jailitem
     pause 0.5
     pause 0.2
     if (%itemsRemoved = 0) then var item1 %jailitem
     if (%itemsRemoved = 1) then var item2 %jailitem
     math itemsRemoved add 1
     if ((%removeCheck > 2) && (%fullhands = 1)) then goto CRAZY_ERROR
     if ((%removeCheck > 2) && (%fullhands = 0)) then goto CRIT_ERROR
     goto INV_CHECK

CRIT_ERROR:
     echo ##################################################################
     echo ** HANDS ARE TOO FULL OF ITEMS THAT PERSIST THROUGH JAIL
     echo ** DROPPING ITEMS TEMPORARILY TO CLEAR INVENTORY BEFORE GETTING SACK
     echo ** WILL PICK UP AFTER GETTING SACK
     echo ** CONSIDER REDUCING AMOUNT OF ITEMS THAT PERSIST THROUGH JAIL
     echo ** MOST ARE JUST STUPID FLUFF ANYWAY
     echo ##################################################################
     pause
     pause 2
     var itemsRemoved 0
     var fullhands 1
     var savedright $righthandnoun
     var savedleft $lefthandnoun
     gosub EMPTY_RIGHT
     gosub EMPTY_LEFT
     goto INV_CHECK
CRAZY_ERROR:
     echo ##########################################################################
     echo ** CONGRATS! YOU ARE THE FIRST PERSON IN RECORDED HISTORY TO EVER SEE THIS ERROR!
     echo ** YOU HAVE 4 OR MORE ITEMS THAT PERSIST THROUGH JAIL... WTF M8?
     echo ** YOU NEED TO REMOVE ALL YOUR ITEMS AND RECOVER YOUR GEAR MANUALLY
     echo ** get <charactername> sack
     echo ** PLEASE REDUCE THE AMOUNT OF ITEMS YOU HAVE THAT PERSIST THROUGH JAIL!
     echo ##########################################################################
     put #echo >Log #ff0000 #################################################################
     put #echo >Log #ff0000 * MAJOR CRITICAL ERROR! DO NOT PASS GO! DO NOT COLLECT 200!
     put #echo >Log #ff0000 * YOU HAVE 72 HOURS TO RECOVER YOUR GEAR
     put #echo >Log #ff0000 * YOU HAVE TOO MANY ITEMS THAT PERSIST THROUGH JAIL! (MORE THAN 4)
     put #echo >Log #ff0000 * COULD NOT RECOVER YOUR JAIL SACK - DO NOT WANT TO LOSE YOUR ITEMS
     put #echo >Log #ff0000 * REMOVE ALL YOUR WORN ITEMS AND RECOVER YOUR JAIL SACK MANUALLY
     put #echo >Log #ff0000 * PLEASE REDUCE THE AMOUNT OF ITEMS THAT PERSIST THROUGH JAIL
     put #echo >Log #ff0000 * MOST OF THEM ARE FLUFF ANYWAY - SCRIPT CAN HANDLE 4 MAX
     put #echo >Log #ff0000 * REMOVE ALL WORN ITEMS AND RECOVER GEAR AT GUARD HOUSE
     put #echo >Log #ff0000 ################################################################
     pause 4
     gosub WEAR $righthandnoun
     pause 0.2
     gosub WEAR $lefthandnoun
     pause 0.2
     gosub GET %savedleft
     pause 0.4
     gosub WEAR %savedleft
     pause 0.4
     gosub GET %savedright
     pause 0.4
     gosub WEAR %savedright
     pause 0.5
     exit

STOCKS:
     echo
     echo *** You got the stocks! Wait it out or plead for mercy
     echo
     pause
     matchre SACK_PRE ^You accept a sack and retrieve the equipment|^YOU HAVE BEEN
     send plead release
     matchwait 400
     pause 0.5
     pause 0.5
     pause 0.2
     if ($standing = 0) then gosub STAND
SACK_PRE:
     pause 0.001
     pause 0.1
     if ($standing = 0) then gosub STAND
     pause 0.5
     if ($standing = 0) then gosub STAND
     pause 0.2
     if matchre("%CLAN", "(?i)(ON|1|YES)") then gosub PUT wear %CLAN.ITEM
     if matchre("%CLAN", "(?i)(ON|1|YES)") then gosub PUT rub %CLAN.ITEM
     pause 0.2
     pause 0.1
     if !matchre("$righthand", "Empty") then gosub put wear my $righthand
     pause 0.2
     gosub PUT open my %Container
     gosub PUT open my %Container.Backup
     pause 0.2
     pause 0.3
     if (%removed = 1) then
          {
          if !matchre("%item1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT wear my %item1
          if !matchre("%item2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT wear my %item2
          pause 0.1
          pause 0.1
          if matchre("$righthand $lefthand", "ring") then gosub PUT wear my ring
          if matchre("$righthand $lefthand", "key") then gosub PUT wear my key
          if matchre("$righthand $lefthand", "toad") then gosub PUT wear my toad
          if matchre("$righthand $lefthand", "gwethdesuan") then gosub PUT wear my gweth
          if matchre("$righthand $lefthand", "obsidian") then gosub PUT wear my obsidian
          if matchre("$righthand $lefthand", "rat") then gosub PUT wear my rat
          if matchre("$righthand $lefthand", "rat") then gosub PUT stow my rat
          if matchre("$righthand $lefthand", "kitten") then gosub PUT wear my kitten
          if matchre("$righthand $lefthand", "kitten") then gosub PUT stow my kitten
          if matchre("$righthand $lefthand", "pig") then gosub PUT wear my pig
          if matchre("$righthand $lefthand", "pig") then gosub PUT stow my pig
          if matchre("$roomobjs","(\bpig\b|kitten|\brat\b)") then gosub STOW $0
          pause 0.01
          if matchre("$righthand $lefthand", "ring") then gosub PUT wear my second ring
          if matchre("$righthand $lefthand", "rat") then gosub PUT wear my second rat
          pause 0.01
          if matchre("$righthand $lefthand", "ring") then gosub PUT wear my third ring
          pause 0.01
          if matchre("$righthand $lefthand", "ring") then gosub PUT wear my fourth ring
          if matchre("$righthand $lefthand", "kitten") then gosub PUT stow my kitten
          if matchre("$righthand $lefthand", "rat") then gosub PUT stow my rat
          if matchre("$righthand $lefthand", "pig") then gosub PUT stow my pig
          pause 0.01
          if matchre("$righthand $lefthand", "ring") then gosub PUT wear my fifth ring
          if matchre("$righthand $lefthand", "ring") then gosub PUT put my ring in my %Container
          if matchre("$righthand $lefthand", "rat") then gosub PUT put my rat in my %Container
          if matchre("$righthand $lefthand", "pig") then gosub PUT put my pig in my %Container
          if matchre("$righthand $lefthand", "kitten") then gosub PUT put my kitten in my %Container
          if matchre("$righthand $lefthand", "ring") then gosub PUT put my second ring in my %Container
          pause 0.01
          if matchre("$righthand $lefthand", "ring") then gosub PUT put my third ring in my %Container
          if matchre("$righthand $lefthand", "ring") then gosub PUT put my fourth ring in my %Container
          pause 0.1
          }
     if (%fullhands = 1) then
          {
               gosub GET %savedleft
               pause 0.4
               gosub WEAR %savedleft
               pause 0.4
               gosub GET %savedright
               pause 0.4
               gosub WEAR %savedright
               pause 0.1
          }
     pause 0.001
     pause 0.001
     if !matchre("$righthand", "Empty") then
          {
               if !matchre("$righthand", "sack") then gosub PUT put my $righthandnoun in my %Container
          }
     if !matchre("$lefthand", "Empty") then
          {
               if !matchre("$lefthand", "sack") then gosub PUT put $lefthandnoun in my %Container
          }
     pause 0.1
     pause 0.1
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then
          {
               if (!matchre("$righthand", "sack") && !matchre("$righthand", "Empty")) then gosub PUT put $righthandnoun in my %Container.Backup
               if (!matchre("$lefthand", "sack") && ("$leftthand" != "Empty")) then gosub PUT put $lefthandnoun in my %Container.Backup
               pause 0.2
          }
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then
          {
               if (!matchre("$righthand", "sack") && !matchre("$righthand", "Empty")) then gosub PUT put $righthandnoun in my %Container.Boxes
               if (!matchre("$lefthand", "sack") && ("$leftthand" != "Empty")) then gosub PUT put $lefthandnoun in my %Container.Boxes
               pause 0.2
          }
SACK:
     var itemloop 0
     if (!matchre("$righthand", "sack") && !matchre("$lefthand", "sack")) then gosub GET my small sack
     pause 0.1
     pause 0.2
     send open my small sack
     wait
     pause 0.5
     if (!matchre("$righthand", "sack") && !matchre("$lefthand", "sack")) then goto NO_MORE_ITEMS
     gosub JAIL_EMPTY small.sack
     pause 0.5
     pause 0.5
SACK_CHECK:
     var itemloop 0
     pause 0.1
     matchre SACK That is closed\.
     matchre NO_MORE_ITEMS ^There is nothing in there\.
     matchre NO_MORE_ITEMS ^I could not find|^What were you
     matchre STOW_IT backpack|duffel bag|haversack|knapsack
     matchre ODD_ITEM khuj|quarterstaff|quarter staff|halberd|toad|key
     matchre PET \b(rat|kitten|pig)\b
     matchre STOW_IT mining (\S+)(?<! nothing in there)(?:\.)
     matchre GET_SACK_ITEM (\S+)(?<! nothing in there)(?:\.)
     put look in my small sack
     matchwait 20
     echo *** MISSING MATCH IN SACK_CHECK! ***
     put #echo >Log #ff0000 *** Missing match label in - SACK_CHECK
     put #log $datetime MISSING MATCH IN SACK_CHECK ***
     gosub stowing
     goto NO_MORE_ITEMS
PET:
     var item $0
     pause 0.1
     gosub JAIL_ITEM_STRIP
PET_1:
     pause 0.1
     math itemloop add 1
     send get %item
     pause 0.5
     pause 0.2
     if (%itemloop > 2) then goto SACK_HANDS
     if !matchre("$righthand $lefthand", "%item") then
          {
               gosub SWAP
               goto PET_1
          }
     send wear %item
     pause 0.2
     gosub stowing
     pause 0.5
     goto SACK
STOW_IT:
     var item $0
     gosub JAIL_ITEM_STRIP
STOW_IT_1:
     pause 0.1
     math itemloop add 1
     send get %item from my small sack
     pause 0.5
     pause 0.2
     if (%itemloop > 2) then goto SACK_HANDS
     if !matchre("$righthand $lefthand", "%item") then
          {
               gosub SWAP
               goto STOW_IT_1
          }
     send put my %item in my %Container
     pause 0.5
     pause 0.1
     if matchre("$lefthand", "item") then gosub PUT my $lefthandnoun in my %Container
     if matchre("$righthand", "item") then gosub PUT my $righthandnoun in my %Container
     pause 0.1
     pause 0.5
     if matchre("$lefthand", "item") then gosub PUT my $lefthandnoun in my %Container.Boxes
     if matchre("$righthand", "item") then gosub PUT my $righthandnoun in my %Container.Boxes
     pause 0.2
     goto SACK
ODD_ITEM:
     var item $0
     gosub JAIL_ITEM_STRIP
ODD_ITEM_1:
     math itemloop add 1
     gosub GET %item from my small sack
     pause 0.5
     pause 0.2
     if (%itemloop > 2) then goto SACK_HANDS
     if !matchre("$righthand $lefthand", "%item") then
          {
               gosub SWAP
               goto ODD_ITEM_1
          }
     send wear my %item
     pause 0.5
     pause 0.2
     send put my $lefthand in my %Container
     pause 0.5
     if matchre("$lefthand", "item") then gosub PUT my $lefthandnoun in my %Container
     if matchre("$righthand", "item") then gosub PUT my $righthandnoun in my %Container
     pause 0.1
     pause 0.5
     if matchre("$lefthand", "item") then gosub PUT my $lefthandnoun in my %Container.Boxes
     if matchre("$righthand", "item") then gosub PUT my $righthandnoun in my %Container.Boxes
     pause 0.2
     goto SACK
GET_SACK_ITEM:
     var item $0
     gosub JAIL_ITEM_STRIP
GET_SACK_ITEM_1:
     math itemloop add 1
     if ($1 = there.) then goto NO_MORE_ITEMS
     if ($1 = there) then goto NO_MORE_ITEMS
     send get %item from my small sack
     pause 0.5
     pause 0.1
     pause 0.1
     if (%itemloop > 2) then goto SACK_HANDS
     if !matchre("$righthand $lefthand", "%item") then
          {
               gosub SWAP
               goto GET_SACK_ITEM_1
          }
     pause 0.1
     if matchre("%IMPORTANT_ITEMS", "%item") then send put my %item in my %Container
     if matchre("%ring", "%item") then send put my %item in my %Container
     pause 0.1
     pause 0.1
     if (("$1" = "backpack") || ("$1" = "cauldron")) then
          {
               pause 0.5
               goto SACK
          }
     if ("$1" = ("obsidian") || ("$1" = "toad") || ("$1" = "rat") then
          {
               send wear my $1
               pause 0.5
               send stow my $1
               pause 0.5
          }
     else
          {
               if matchre("$lefthand", "item") then gosub PUT my $lefthandnoun in my %Container
               if matchre("$righthand", "item") then gosub PUT my $righthandnoun in my %Container
               pause 0.1
               pause 0.5
               if matchre("$lefthand", "item") then gosub PUT my $lefthandnoun in my %Container.Boxes
               if matchre("$righthand", "item") then gosub PUT my $righthandnoun in my %Container.Boxes
               pause 0.2
          }
     pause 0.5
     goto SACK
JAIL_ITEM_STRIP:
     echo *** ITEM: %item
     eval item replacere("%item", " (bearing|crafted|inked in|worked in) .+", "")
     eval item replacere("%item", " (delicately embroidered) with .+", "")
     eval item replacere("%item", " (banded|carved|detailed|emblazoned|embroidered|embossed|engraved|fit|inlaid|inset|painted|secured|set|tied|tinted|topped|trimmed) with .+", "")
     eval item replacere("%item", " with a .+ on it", "")
     eval item replacere("%item", " with .+", "")
     eval item replacere("%item", " polished to a sheen", "")
     eval item replacere("%item", " of unpolished .+", "")
     eval item replacere("%item", " in the form of a woman", "")
     eval item replacere("%item", " of viscous gloop", "")
     eval item replacere("%item", "\ba ", "")
     eval item replacere("%item", "\.$", "")
     # STRIP TO VERY ROOT NOUN AFTER TAKING OFF ANY DESCRIPTORS - MAYBE REMOVE THIS??!!
     eval item replacere("%item", "([\w'-]+\s){0,5}", "")
     echo *** ITEM: %item
     return
SACK_HANDS:
     echo
     echo **** HANDS TOO DAMAGED TO EMPTY SACK???
     echo **** STOWING SACK UNTIL LATER
     echo
     gosub stowing
     pause 0.5
NO_MORE_ITEMS:
     pause 0.001
     pause 0.001
     pause 0.001
     send drop my small sack
     pause 0.2
     pause 0.1
     if matchre("$roomobjs","(\brat\b|monkey|\bcat\b|\bpig\b)") then
          {
               gosub GET $1
               gosub stowing
          }
     pause 0.1
     if !matchre("$righthand", "Empty") then gosub put put $righthandnoun in my %Container.Boxes
     if !matchre("$lefthand", "Empty") then gosub put put $lefthandnoun in my %Container.Boxes
     pause 0.2
     if !matchre("$righthand", "Empty") then gosub put put $righthandnoun in my %Container.Backup
     if !matchre("$lefthand", "Empty") then gosub put put $lefthandnoun in my %Container.Backup
     pause 0.1
     echo
     echo **** DONE WITH JAIL / SACK SEQUENCE ****
     echo
     pause
     if ($standing = 0) then gosub STAND
CHECKLOC:
     if ("$zoneid" = "67") then goto SHARD_JAIL_DONE
     if ("$zoneid" = "116") then goto HIB_JAIL_DONE
     if ("$zoneid" = "107") then goto MERKRESH_JAIL_DONE
     if ("$zoneid" = "61") then goto LETH_JAIL_DONE
     if ("$zoneid" = "1") then goto CROSS_JAIL_DONE
     if ("$zoneid" = "30") then goto HAVEN_JAIL_DONE
     if ("$zoneid" = "42") then goto THEREN_JAIL_LEAVE
     if ("$zoneid" = "47") then goto MUSPARI_JAIL_DONE
     if ("$zoneid" = "90") then goto RATHA_JAIL_DONE
     if ("$zoneid" = "99") then goto AESRY_JAIL_DONE
MERKRESH_JAIL_DONE:
     gosub AUTOMOVE 55
     put #script resume %scriptname
     put #parse TAKING CARE OF BUSINESS
     goto JAIL_END
RATHA_JAIL_DONE:
     gosub AUTOMOVE 51
     put #script resume %scriptname
     put #parse TAKING CARE OF BUSINESS
     goto JAIL_END
AESRY_JAIL_DONE:
     gosub AUTOMOVE 76
     put #script resume %scriptname
     put #parse TAKING CARE OF BUSINESS
     goto JAIL_END
MUSPARI_JAIL_DONE:
     gosub AUTOMOVE 48
     put #script resume %scriptname
     put #parse TAKING CARE OF BUSINESS
     goto JAIL_END
CROSS_JAIL_DONE:
     gosub AUTOMOVE 42
     if ("%ARTHE" = "ON") then gosub AUTOMOVE NTR
     put #script resume %scriptname
     put #parse TAKING CARE OF BUSINESS
     goto JAIL_END
LETH_JAIL_DONE:
     gosub AUTOMOVE portal
     put #script resume %scriptname
     put #parse TAKING CARE OF BUSINESS
     goto JAIL_END
HAVEN_JAIL_DONE:
     gosub AUTOMOVE town
     put #script resume %scriptname
     put #parse TAKING CARE OF BUSINESS
     goto JAIL_END
SHARD_JAIL_DONE:
     gosub AUTOMOVE 57
     put #script resume %scriptname
     put #parse TAKING CARE OF BUSINESS
     goto JAIL_END
HIB_JAIL_DONE:
     gosub AUTOMOVE 75
     put #script resume %scriptname
     put #parse TAKING CARE OF BUSINESS
     goto JAIL_END
THEREN_JAIL_LEAVE:
     save THEREN_JAIL_END
     goto THEREN_KEEP_ESCAPE
THEREN_JAIL_GET_FINE:
     save TO_TELLER
THEREN_KEEP_ESCAPE:
     gosub AUTOMOVE 69
     send jump moat
     pause 3
THEREN_STUNNED_WAIT:
     echo **** Stunned! Pausing to recover..
     pause 10
     if $stunned = 1 then goto THEREN_STUNNED_WAIT
     pause 0.5
     gosub STAND
     pause 0.5
THEREN_MOAT_LEAVE:
     var location THEREN_MOAT_LEAVE
     gosub MOVE s
     pause 2
     goto %s
THEREN_KEEP_JAIL:
     var location THEREN_KEEP_JAIL
     pause 0.2
     if ("$guild" = "Necromancer") then gosub NECRO_PREP
     if ("$guild" = "Thief") then put khri start silence
     if ("$guild" = "Moon Mage") then gosub MOONIE_PREP
     pause 0.1
     pause 0.2
     gosub AUTOMOVE 102
     gosub AUTOMOVE moat
     gosub AUTOMOVE 116
     gosub AUTOMOVE 160
     gosub AUTOMOVE 161
     gosub AUTOMOVE 137
     gosub AUTOMOVE dungeon
     gosub STAND
     goto CLAN.ITEM_CHECK
THEREN_JAIL_END:
THEREN_JAIL_DONE:
     gosub AUTOMOVE 1
     pause 2
JAIL_END:
     action (jail) on
     put #script resume %scriptname
     put #script abort jail
     if ("$zoneid" = "107") then var CurrentCurrency Dokoras
     if ("$zoneid" = "99") then var CurrentCurrency Dokoras
     if ("$zoneid" = "90") then var CurrentCurrency Dokoras
     if ("$zoneid" = "61") then var CurrentCurrency Kronars
     if ("$zoneid" = "1") then var CurrentCurrency Kronars
     if ("$zoneid" = "30") then var CurrentCurrency Lirums
     if ("$zoneid" = "34a") then var CurrentCurrency Lirums
     if ("$zoneid" = "42") then var CurrentCurrency Lirums
     if ("$zoneid" = "47") then var CurrentCurrency Lirums
     if ("$zoneid" = "67") then var CurrentCurrency Dokoras
     if ("$zoneid" = "116") then var CurrentCurrency Dokoras
     put #echo >Log SkyBlue *** Recovered from jail via Ubercombat - Fine: %Currentfine
     math totalFine add %Currentfine
     put #parse FREE FROM JAIL
     if matchre("$charactername", "(Alucios|Valgrind|Hvinir|Idavoll|Aerithius|Drunvalo|Akios|Teothius)") then put .scriptcheck
     if matchre("$roomobjs","(\brat\b|monkey|\bcat\b|\bpig\b)") then
          {
               gosub GET $1
               gosub stowing
          }
     echo *** FREE FROM JAIL!
     echo
     unvar CurrentCurrency
     unvar Currentfine
     unvar jailitem
     unvar removed
     unvar itemsRemoved
     unvar fullhands
     unvar removeCheck
     unvar bag
     unvar item
     unvar item1
     unvar item2
     unvar savedleft
     unvar savedright
     unvar fine
     unvar nofundloop
     unvar plat
     unvar WealthLirums
     unvar WealthDokoras
     unvar WealthKronars
     unvar wealth
     pause 0.1
     pause
     goto %LAST
PAID_DEBT:
     var debt 0
     if ("$zoneid" = "107") then var CurrentCurrency Dokoras
     if ("$zoneid" = "99") then var CurrentCurrency Dokoras
     if ("$zoneid" = "90") then var CurrentCurrency Dokoras
     if ("$zoneid" = "61") then var CurrentCurrency Kronars
     if ("$zoneid" = "1") then var CurrentCurrency Kronars
     if ("$zoneid" = "30") then var CurrentCurrency Lirums
     if ("$zoneid" = "34a") then var CurrentCurrency Lirums
     if ("$zoneid" = "42") then var CurrentCurrency Lirums
     if ("$zoneid" = "47") then var CurrentCurrency Lirums
     if ("$zoneid" = "67") then var CurrentCurrency Dokoras
     if ("$zoneid" = "116") then var CurrentCurrency Dokoras
     if (%fine != 0) then
          {
               echo ########################################
               echo ** Paid off Debt: %fine %CurrentCurrency
               echo ########################################
               put #echo >Log DeepSkyBlue *** PAID OFF DEBT! - %fine %CurrentCurrency
          }
     pause 0.3
     unvar CurrentCurrency
     unvar Currentfine
     unvar jailitem
     unvar removed
     unvar itemsRemoved
     unvar fullhands
     unvar removeCheck
     unvar bag
     unvar item
     unvar item1
     unvar item2
     unvar savedleft
     unvar savedright
     unvar fine
     unvar nofundloop
     unvar plat
     unvar WealthLirums
     unvar WealthDokoras
     unvar WealthKronars
     unvar wealth
     return
NO_MONEY_DEBT:
     put #echo >Log #ff0000 ** NOT ENOUGH MONEY IN BANK TO PAY DEBT!!!
     return
#### CLEARS MESSED UP ITEM NAMES IN JAIL SACK THAT INTERFERE WITH SCRIPT
JAIL_EMPTY:
     var bag $0
     var jailloop 0
     pause 0.0001
     var Contents null
     action var Contents $1 when ^You rummage through .+ and see (.*)\.
     action var Contents $1 when ^In the .* you see (.*)\.
     send look in my %bag
     waitforre ^In the .* you see|^There is nothing in there\.|^You rummage
     action remove ^In the .* you see (.*)\.|^You rummage through .+ and see (.*)\.
     if ("%Contents" = "null") then goto JAIL_EMPTY_DONE
     pause .0001
     eval Contents replace("%Contents" , ", " , "|")
     eval Contents replace("%Contents" , " and a" , "|a")
     eval Contents replace("%Contents" , " and an" , "|an")
     eval Contents replace("%Contents" , " and some" , "|some")
     eval Contents replace("%Contents"," with a .+ on it",  "")
     eval Contents replace("%Contents"," on it",  "")
     eval Contents replace("%Contents","some ",  "")
     var Contents |%Contents|
     eval total count("%Contents", "|")
JAIL_EMPTY_Loop:
     eval item element("%Contents", 1)
     eval number count("%Contents", "|%item")
     var Count 0
     gosub JAIL_EMPTY_RemoveLoop
     action var item $1 when ^@(?:an?|some).* (\S+)
     put #parse @%item
     var jailloop %number
     gosub JAIL_EMPTY_ItemAction
     if ("%Contents" != "|") then goto JAIL_EMPTY_Loop
     goto JAIL_EMPTY_DONE
JAIL_EMPTY_RemoveLoop:
     eval number count("%Contents", "|%item|")
     eval Contents replace("%Contents" , "|%item|" , "|")
     eval Contents replace("%Contents" , "||" , "|")
     evalmath jailloop %Count + %number
     if !contains("%Contents", "|%item|") then goto JAIL_EMPTY_DONE
     goto JAIL_EMPTY_RemoveLoop
JAIL_EMPTY_ItemAction:
     math jailloop subtract 1
     gosub GET %item from my %bag
     #gosub WEAR my %item
     pause 0.2
     if !matchre("$righthand $lefthand", "%item") then goto JAIL_EMPTY_DONE
     if ("%item" = "%Container") then gosub PUT open my %Container
     gosub PUT_IT my %item in my %Container
     if (%jailloop < 1) then goto JAIL_EMPTY_DONE
     goto JAIL_EMPTY_ItemAction
JAIL_EMPTY_DONE:
     unvar jailloop
     return
### END JAIL SECTION
##################################
# STANDALONE FINE CHECK
FINECHECKING:
     var fine 0
     action (debt) on
     echo ####################
     echo *** CHECKING FINES..
     echo ####################
     pause 0.1
     if ("$zoneid" = "107") then goto FINEAT_QI
     if ("$zoneid" = "99") then goto FINEAT_QI
     if ("$zoneid" = "90") then goto FINEAT_QI
     if ("$zoneid" = "61") then goto FINEAT_ZOLUREN
     if ("$zoneid" = "1") then goto FINEAT_ZOLUREN
     if ("$zoneid" = "30") then goto FINEAT_THERENGIA
     if ("$zoneid" = "34a") then goto FINEAT_THERENGIA
     if ("$zoneid" = "42") then goto FINEAT_THERENGIA
     if ("$zoneid" = "47") then goto FINEAT_THERENGIA
     if ("$zoneid" = "67") then goto FINEAT_ILITHI
     if ("$zoneid" = "116") then goto FINEAT_FORFEDHDAR
     pause 0.5
     echo
     echo *** CRITICAL ERROR!
     echo *** UKNOWN LOCATION!! Zone- $zoneid
     echo
     pause
     return
FINEAT_QI:
var LOCATION FINEAT_QI
     matchre FINECHECKING_FINE Qi\.\s*\((\d+) copper Lirums\)
     matchre FINECHECKING_NONE No debt\.
     send info
     matchwait 3
     goto FINECHECKING_NONE
FINEAT_THERENGIA:
var LOCATION FINEAT_THERENGIA
     matchre FINECHECKING_FINE Therengia\.\s*\((\d+) copper Lirums\)
     matchre FINECHECKING_NONE No debt\.
     send info
     matchwait 3
     goto FINECHECKING_NONE
FINEAT_ZOLUREN:
var LOCATION FINEAT_ZOLUREN
     matchre FINECHECKING_FINE Zoluren\.\s*\((\d+) copper Kronars\)
     matchre FINECHECKING_NONE No debt\.
     send info
     matchwait 3
     goto FINECHECKING_NONE
FINEAT_ILITHI:
var LOCATION FINEAT_ILITHI
     matchre FINECHECKING_FINE Ilithi\.\s*\((\d+) copper Dokoras\)
     matchre FINECHECKING_NONE No debt\.
     send info
     matchwait 3
     goto FINECHECKING_NONE
FINEAT_FORFEDHDAR:
var LOCATION FINEAT_FORFEDHDAR
     matchre FINECHECKING_FINE Forfedhdar\.\s*\((\d+) copper Dokoras\)
     matchre FINECHECKING_NONE No debt\.
     send info
     matchwait 3
     goto FINECHECKING_NONE
FINECHECKING_FINE:
     var fine $1
     pause 0.1
     eval fine replacere("%fine", ",", "")
     eval fine replacere("%fine", " ", "")
     echo ################
     echo *** FINE: %fine
     echo ################
     pause 0.4
     return
FINECHECKING_NONE:
     echo =========
     echo *** NO FINE!
     echo =========
     pause 0.2
     return
###############################################################
# REMOTE DEBT PAY (PREMIUM ONLY)
REMOTE_DEBT:
     var QiFine 0
     var TherengiaFine 0
     var ForfedhdarFine 0
     var IlithiFine 0
     var ZolurenFine 0
     if !matchre("$zoneid", "\b(1|30|90|99|107|116)\b") then
          {
               echo ########################################
               echo ** NOT IN A LOCATION WITH A PREMIUM BANK
               echo ** SKIPPING REMOTE DEBT PAY
               echo ########################################
               return
          }
     action (debt) on
     if ($invisible = 1) then gosub STOP_INVIS
     echo ########################################
     echo *** CHECKING DEBTS IN ALL PROVINCES
     echo ########################################
     pause 0.1
     put wealth
     wait
     pause
     pause 0.5
     action (debt) off
     gosub REMOTE_CASH
     echo ################################
     echo ** PROVINCE DEBTS:
     if (%ZolurenFine != 0) then echo ** Zoluren: %ZolurenFine
     if (%TherengiaFine != 0) then echo ** Therengia: %TherengiaFine
     if (%IlithiFine != 0) then echo ** Ilithi: %IlithiFine
     if (%ForfedhdarFine != 0) then echo ** Forfedhdar: %ForfedhdarFine
     if (%QiFine != 0) then echo ** Qi: %QiFine
     echo ################################
     pause 0.4
     pause 0.2
     if (%ZolurenFine >= 1000) then GOSUB PAY_REMOTE ZOLUREN
     if (%ZolurenFine < 1000) then echo ** Skipping Zoluren Fine - not high enough
     if (%TherengiaFine >= 1000) then GOSUB PAY_REMOTE THEREN
     if (%TherengiaFine < 1000) then echo ** Skipping Therengia Fine - not high enough
     if (%IlithiFine >= 1000) then GOSUB PAY_REMOTE ILITHI
     if (%IlithiFine < 1000) then echo ** Skipping Ilithi Fine - not high enough
     if (%ForfedhdarFine >= 1000) then GOSUB PAY_REMOTE FORF
     if (%ForfedhdarFine < 1000) then echo ** Skipping Forf Fine - not high enough
     if (%QiFine >= 1000) then GOSUB PAY_REMOTE QI
     if (%QiFine < 1000) then echo ** Skipping Qi Fine - not high enough
     pause 0.3
     unvar payee
     unvar fine
     return

REMOTE_CASH:
     echo ########################
     echo *** CHECKING CURRENT CASH
     echo ########################
     var WealthLirums 0
     var WealthDokoras 0
     var WealthKronars 0
     pause 0.3
     action var WealthLirums $1 when Lirums\s\(([\d,]+) copper Lirums\)\.
     action var WealthDokoras 0 when ^No Lirums
     action var WealthDokoras $1 when Dokoras\s\(([\d,]+) copper Dokoras\)\.
     action var WealthDokoras 0 when ^No Dokoras
     action var WealthKronars $1 when Kronars\s\(([\d,]+) copper Kronars\)\.
     action var WealthKronars 0 when ^No Kronars
     pause 0.1
     put wealth
     wait
     pause 0.5
     pause 0.1
     action remove Lirums\s\(([\d,]+) copper Lirums\)\.
     action remove ^No Lirums
     action remove Dokoras\s\(([\d,]+) copper Dokoras\)\.
     action remove ^No Dokoras
     action remove Kronars\s\(([\d,]+) copper Kronars\)\.
     action remove ^No Kronars
     pause 0.1
     return

PAY_REMOTE:
     var payee $1
     pause 0.001
     echo ###########################
     echo ** PAYING REMOTE DEBT IN: %payee
     echo ###########################
     pause 0.4
     if matchre("$zoneid", "\b(1|90|107|116)\b") then gosub AUTOMOVE premium teller
     if matchre("$zoneid", "\b99\b") then gosub AUTOMOVE teller
     pause 0.2
     if matchre("%payee", "(?i)FORF") then
          {
               if (%WealthDokoras < %ForfedhdarFine) then gosub REMOTE_WITHDRAW %ForfedhdarFine
          }
     if matchre("%payee", "(?i)ZOLUREN") then
          {
               if (%WealthKronars < %ZolurenFine) then gosub REMOTE_WITHDRAW %ZolurenFine
          }
     if matchre("%payee", "(?i)ILITHI") then
          {
               if (%WealthDokoras < %IlithiFine) then gosub REMOTE_WITHDRAW %IlithiFine
          }
     if matchre("%payee", "(?i)THEREN") then
          {
               if (%WealthLirums < %TherengiaFine) then gosub REMOTE_WITHDRAW %TherengiaFine
          }
     if matchre("%payee", "(?i)QI") then
          {
               if (%WealthLirums < %QiFine) then gosub REMOTE_WITHDRAW %QiFine
          }
      gosub AUTOMOVE exchange
      pause 0.5
      if matchre("%payee", "(?i)ILITHI") then gosub DOKORAS
      if matchre("%payee", "(?i)ZOLUREN") then gosub KRONARS
      if matchre("%payee", "(?i)FORF") then gosub DOKORAS
      if matchre("%payee", "(?i)THEREN") then gosub LIRUMS
      if matchre("%payee", "(?i)QI") then gosub LIRUMS
      pause 0.5
      gosub AUTOMOVE premium exchange
      pause 0.3
      if matchre("%payee", "(?i)ILITHI") then put BANK debt 3 all
      if matchre("%payee", "(?i)ZOLUREN") then put BANK debt 1 all
      if matchre("%payee", "(?i)FORF") then put BANK debt 5 all
      if matchre("%payee", "(?i)THEREN") then put BANK debt 2 all
      if matchre("%payee", "(?i)QI") then put BANK debt 4 all
      pause
      put #echo >Log #00FF00 ** PAID DEBT IN %payee REMOTELY!
      pause 0.5
      gosub LEAVE_BANK
      unvar payee
      unvar WealthLirums
      unvar WealthDokoras
      unvar WealthKronars
      return
REMOTE_WITHDRAW:
     var fine $1
     if matchre("$zoneid", "\b(1|61)\b") then
          {
               evalmath fine (%fine * 1.5)
          }
     if matchre("$zoneid", "\b(30|42|47|90|99|107)\b") then
          {
               evalmath fine (%fine * 1.4)
          }
     evalmath fine round((%fine),0)
REMOTE_WITHDRAW_1:
     pause 0.1
     pause 0.1
     matchre REMOTE_WITHDRAW_1 ^\.\.\.wait|^Sorry\,
     matchre RETURN ^The clerk counts out|it looks like your current balance|^You count out|Searching methodically|^You find
     matchre NO_FUNDS_REMOTE we are not lending money|You don't have that much
     matchre NO_FUNDS_REMOTE You don't have that much money in your account\.
     send withdraw %fine copper
     matchwait 10
NO_FUNDS_REMOTE:
     echo ######################################################
     echo *** NOT ENOUGH FUNDS IN BANK TO PAY REMOTE DEBT!!
     echo ######################################################
     unvar fine
     return

### STANDALONE WEALTH CHECK GOSUB
WEALTH_CHECK:
MONEY_CHECK:
     echo ###################
     echo *** CHECKING MONEY ON HAND
     echo ###################
     var WealthLirums 0
     var WealthDokoras 0
     var WealthKronars 0
     pause 0.3
     action var WealthLirums $1 when Lirums\s\(([\d,]+) copper Lirums\)\.
     action var WealthDokoras 0 when ^No Lirums
     action var WealthDokoras $1 when Dokoras\s\(([\d,]+) copper Dokoras\)\.
     action var WealthDokoras 0 when ^No Dokoras
     action var WealthKronars $1 when Kronars\s\(([\d,]+) copper Kronars\)\.
     action var WealthKronars 0 when ^No Kronars
     pause 0.1
     put wealth
     wait
     pause
     pause 0.1
     action remove Lirums\s\(([\d,]+) copper Lirums\)\.
     action remove ^No Lirums
     action remove Dokoras\s\(([\d,]+) copper Dokoras\)\.
     action remove ^No Dokoras
     action remove Kronars\s\(([\d,]+) copper Kronars\)\.
     action remove ^No Kronars
     return
########################################################################################################
# RAVEN'S COURT SCHOL STUDY
RAVEN_STUDY:
RAVENCOURT:
     if ("$zoneid" != "1") then return
     gosub AUTOMOVE 72
     pause 0.1
     gosub AUTOMOVE 534
     echo #############################
     echo *** STUDYING IN RAVEN'S COURT
     echo #############################
STARTSTUDY:
     gosub study sculpture
     gosub study painting
     gosub study carving
     gosub study statue
     gosub study second painting
     gosub MOVE w
     if ($Scholarship.LearningRate > 30) then goto LEAVE_STUDY
     gosub study painting
     gosub study triptych
     gosub study statue
     gosub study figurine
     gosub study second painting
     gosub MOVE s
     if ($Scholarship.LearningRate > 30) then goto LEAVE_STUDY
     gosub study cylinder
     gosub study sculpture
     gosub study statue
     gosub study painting
     gosub study second painting
     gosub MOVE s
     if ($Scholarship.LearningRate > 30) then goto LEAVE_STUDY
     gosub study painting
     gosub study canvas
     gosub study panel
     gosub study sphere
     gosub study statue
     gosub MOVE e
     if ($Scholarship.LearningRate > 30) then goto LEAVE_STUDY
     gosub study painting
     gosub study diorama
     gosub study figure
     gosub study statue
     gosub study second painting
     pause
     if ($Scholarship.LearningRate > 30) then goto LEAVE_STUDY
VIP_STUDY:
     gosub AUTOMOVE 549
     pause 0.5
     matchre VIP_BAD \"You're not on our guest list, please see our membership desk near the club entryway\.\"
     matchre VIP_GOOD So good to see you again, do come in\!
     put knock knocker
     matchwait 10
VIP_GOOD:
     gosub AUTOMOVE 560
     gosub study painting
VIP_BAD:
LEAVE_STUDY:
     gosub AUTOMOVE 75
     pause 0.1
     gosub AUTOMOVE 155
     pause 0.1
     unvar object
     put #parse DONE STUDY
     return
STUDY:
     var object $0
     put study %object
     pause
     pause 0.5
     return
###########################################################################################
# BRAIDING LOGIC
###########################################################################################
BRAID:
     var forage grass
     # if ($Mechanical_Lore.Ranks > 240) then var forage vine
     var dumpster null
     var braidloop 0
     var GreenPouch 0
     action goto ABORT_BRAIDING when ^You survey the area and realize that any foraging efforts would be futile\.
     pause 0.001
     gosub stowing
     gosub CLEARHANDS
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     pause 0.2
     pause 0.1
     matchre GREENNO ^What were|^I could
     matchre GREENYES ^You tap a green pouch embroidered with flowing grass
     send tap my green pouch
     matchwait 20
GREENNO:
     goto BRAIDING_LOOP
GREENYES:
     echo *** Magic Grass Pouch detected!
     var GreenPouch 1
BRAIDING_LOOP:
     if ($invisible = 1) then gosub STOP_INVIS
     math braidloop add 1
     if (%braidloop > 20) then goto BRAIDING_COMPLETE
     if (($Engineering.Ranks > 65) then goto BRAIDING_COMPLETE
     if (($Engineering.LearningRate > 32) || ($Mechanical_Lore.LearningRate > 32)) then goto BRAIDING_COMPLETE
     if contains("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICK_PILE
     pause 0.1
     if ("$righthandnoun" = "%forage") && ("$lefthandnoun" = "%forage") then goto BRAIDING_GO
     if ("$zoneid" = "150") && ($roomid != 45) then
          {
               if ($Athletics.Ranks > 45) then gosub AUTOMOVE 45
               if ($Athletics.Ranks < 46) then gosub AUTOMOVE 85
          }
     if (%GreenPouch != 1) then
          {
               put forage %forage
               pause 2
               pause
          }
BRAIDING_FORAGE:
     if ($Engineering.LearningRate > 32) then goto BRAIDING_COMPLETE
     if matchre("$lefthand", "(vines|grass)") then
          {
               send swap
               pause 0.3
          }
     pause 0.1
     if (%GreenPouch = 1) then goto BRAIDING_GREENPOUCH
     if ("$charactername" = "Shroom") && ("$zoneid" = "150") then goto BRAIDING_FEEDBAG
     pause 0.001
BRAIDING_FORAGE_CONTINUE:
     if ("%forage" = "grass") then
          {
          if contains("$roomobjs","(a|some|pile of) grass") then
               {
                    pause 0.01
                    send get grass
                    pause 0.5
                    goto BRAIDING_GO
               }
          }
     if ("%forage" = "vine") then
          {
          if contains("$roomobjs","(a|some|pile of) vine") then
               {
                    pause 0.01
                    send get vine
                    pause 0.5
                    goto BRAIDING_GO
               }
          }
     put forage %forage
     pause 2
     pause
     if !matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty") then goto BRAIDING_GO
     goto BRAIDING_LOOP

BRAIDING_STOWPOUCH:
     pause 0.001
     put remove my green pouch
     pause 0.5
     pause 0.1
     gosub STOWIT green pouch
     pause 0.1
BRAIDING_RUBPOUCH:
     pause 0.001
     matchre BRAIDING_GREENPOUCH ^Brushing your fingers
     matchre BRAIDING_STOWPOUCH ^You will need to hold
     put rub my green pouch
     matchwait 20
BRAIDING_GREENPOUCH:
     pause 0.2
     if !matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty") then goto BRAIDING_GO
     matchre BRAIDING_GREENPOUCH ^You get
     matchre BRAIDING_RUBPOUCH ^What were|^I could not
     put get grass from my green pouch
     matchwait 20
     echo *** TIMEOUT! MISSING MATCH
     goto BRAIDING_FORAGE_CONTINUE

BRAIDING_FEEDBAG:
     pause 0.2
     if !matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty") then goto BRAIDING_GO
     matchre BRAIDING_FEEDBAG ^You get
     matchre EMPTY_FEEDBAG ^What were|^I could not
     put get grass from my feedb
     matchwait 20
     echo *** TIMEOUT! MISSING MATCH
     goto BRAIDING_FORAGE_CONTINUE

BRAID_HUM:
     send stop hum
     pause 0.2
     if ($invisible = 1) then gosub STOP_INVIS
BRAIDING_GO:
     pause 0.1
     pause 0.1
     if contains("$lefthand", "braided") then put swap
     if (($Engineering.LearningRate > 32) || ($Mechanical_Lore.LearningRate > 32)) then goto BRAIDING_COMPLETE
     pause 0.3
     if ("$lefthand" = "Empty") then goto BRAIDING_LOOP
     matchre BRAIDING_LOOP ^Braid what\?
     matchre BRAIDING_LOOP ^You need to have more material
     matchre BRAID_HUM ^But that would give away your hiding
     matchre BRAIDING_DUMP ^You need both hands to do that|nothing more than wasted effort
     matchre BRAID_PULL ^You fumble around trying|^You are certain that you have made a|is already as long
     matchre BRAIDING_GO Roundtime|^\.\.\.wait|^Sorry
     send braid my %forage
     matchwait 20
     echo *** TIMEOUT! MISSING MATCH
     goto BRAIDING_GO

BRAID_PULL:
     pause 0.3
     put pull my %forage
     pause 0.5
BRAIDING_DUMP:
     pause 0.1
     gosub DUMPSTER_SET
     if !matchre("%dumpster", "(NULL|gelapod)") then
          {
               pause 0.2
               if matchre("$righthand","(grass|vine|rope)") then put put my $1 in %dumpster
               if matchre("$lefthand","(grass|vine|rope)") then put put my $1 in %dumpster
               pause 0.5
          }
     if matchre("%dumpster", "gelapod") then
          {
               pause 0.2
               if matchre("$righthand","(grass|vine|rope)") then put feed my $1 to gelapod
               if matchre("$lefthand","(grass|vine|rope)") then put feed my $1 to gelapod
               pause 0.5
          }
     pause 0.2
     if matchre("$righthand","(grass|vine|rope)") then put drop my $righthandnoun
     if matchre("$lefthand","(grass|vine|rope)") then put drop my $lefthandnoun
     pause 0.5
     gosub stowing
     pause 0.2
     send dump junk
     pause 0.1
     goto BRAIDING_LOOP

EMPTY_FEEDBAG:
     echo **** FEEDBAG IS EMPTY! ATTEMPTING TO REFILL!!
     put put grass in my feed
     pause 0.5
     if ("$zoneid" = "150") && ("$roomid" != "44") then gosub AUTOMOVE 44
     if ("$zoneid" = "150") && ("$roomid" = "85") then put go portal
     pause
     pause 0.5
     if ("$zoneid" = "66") then gosub AUTOMOVE campfire
FEEDBAG_COLLECT:
     var feedbagloop 0
     FEEDBAG_COLLECT_1:
     pause 0.2
     put collect grass
     pause 2
     pause
     if !contains("$roomobjs","pile of grass") then goto FEEDBAG_COLLECT_1
FEEDBAG_COLLECT_LOOP:
     math feedbagloop add 1
     put get grass
     pause 0.5
     put put grass in my feedbag
     pause 0.1
     if (%feedbagloop > 13) then goto DONE_FEEDBAG
     if !contains("$roomobjs","pile of grass") then goto FEEDBAG_COLLECT_1
     goto FEEDBAG_COLLECT_LOOP
DONE_FEEDBAG:
     gosub AUTOMOVE 45
     unvar feedbagloop
     goto BRAIDING_LOOP

BRAIDING_COMPLETE:
     pause 0.1
     pause 0.1
ABORT_BRAIDING:
     gosub DUMPSTER_SET
     if !matchre("%dumpster", "(NULL|gelapod)") then
          {
               pause 0.2
               if matchre("$righthand","(grass|vine|rope)") then put put my $1 in %dumpster
               if matchre("$lefthand","(grass|vine|rope)") then put put my $1 in %dumpster
               pause 0.5
          }
     if matchre("%dumpster", "gelapod") then
          {
               pause 0.2
               if matchre("$righthand","(grass|vine|rope)") then put feed my $1 to gelapod
               if matchre("$lefthand","(grass|vine|rope)") then put feed my $1 to gelapod
               pause 0.5
          }
     pause 0.2
     if contains("$righthand","(grass|vine|rope)") then put drop my $righthand
     if contains("$lefthand","(grass|vine|rope)") then put drop my $lefthand
     pause 0.3
     if matchre("$righthand","(grass|vine|rope)") then put drop my $righthand
     if matchre("$lefthand","(grass|vine|rope)") then put drop my $lefthand
     pause 0.3
     gosub stowing
     unvar dumpster
     unvar braidloop
     unvar GreenPouch
     pause 0.1
     put #parse DONE BRAIDING
     put #parse BRAIDING DONE
     put #parse BRAIDING DONE
     return
###########################################################################################
# TEXTBOOK / COMPENDIUM TRAINING
###########################################################################################
TEXTBOOK_READ:
TEXTBOOKING:
     var Type $1
     var PAGE 0
     var studied 0
     var CompLoop 0
     var noStudyCount 0
     var Textbook.Noun NULL
     var TextbookTime $gametime
     delay 0.00001
     if matchre("$righthand $lefthand", "(?i)%TEXTBOOK.TYPE") then goto COMPENDIUM_SET
     if (%Playing = 0) then gosub PLAY
COMPENDIUM_SET:
     echo
     echo ###########################
     echo #    ~TEXTBOOK/COMPENDIUM TIME~       #
     echo #   TRAINING FIRST AID/SCHOLARSHIP!   #
     echo ###########################
     echo
     if ((%Research.Active = 1) && (%Research.Inactive = 0)) then gosub RESEARCH_CANCEL
     if matchre("$righthand $lefthand", "(?i)%TEXTBOOK.TYPE") then goto OPEN_COMP
GET_COMP:
     pause 0.0001
     matchre OPEN_COMP ^You are already holding that
     matchre OPEN_COMP ^You get .*
     matchre UNTIE_COMP ^What were you referring to
     matchre UNTIE_COMP ^You should untie
     put GET my %TEXTBOOK.TYPE
     matchwait 20
     echo *** Error with Compendium ***
     goto FINISH_COMP
UNTIE_COMP:
     pause 0.0001
     matchre OPEN_COMP ^You are already holding that
     matchre OPEN_COMP ^You get|^You untie
     matchre COMP_DOUBLECHECK ^What were you
     put untie my %TEXTBOOK.TYPE
     matchwait 10
     echo *** Error with Compendium ***
COMP_DOUBLECHECK:
     pause 0.0001
     if !matchre("%ALLCONTAINERS", "(?i)(eddy|portal)") then return
     matchre OPEN_COMP ^You are already holding that
     matchre OPEN_COMP ^You get|^You untie
     matchre NO_COMP ^What were you
     put GET my %TEXTBOOK.TYPE from my watery portal
     matchwait 10
     echo *** Error with Compendium ***
     goto NO_COMP
OPEN_COMP:
     delay 0.0001
     if matchre("$righthand", "(?i)%TEXTBOOK.TYPE") then var Textbook.Noun $righthandnoun
     if matchre("$lefthand", "(?i)%TEXTBOOK.TYPE") then var Textbook.Noun $lefthandnoun
     if matchre("$righthand $lefthand", "(bestiary|(sturdy |weathered |grey |leather )textbook|(wood-framed |small |self-help )book|encyclopedia|(oversized |steel-bound )treatise|(weighty |black )volume|(korograth-leather |massive |chitin-covered )codex|(weighty |leather |salt-stained |slate-bound )tome|(thick |inlaid )grimoire|(green |purple )quarto|(elegant |grey |leather-bound |thick )folio|battered field guide|wine-red cookbook|pale manual|square atlas|large atlas|sheepskin vellum|snakeskin roll|gilded guidebook)") then
          {
               gosub TEXTBOOK_GO first
               goto FINISH_COMP
          }
     if matchre("$righthand $lefthand", "(?i)comp") then var book compendium
     if matchre("$righthand $lefthand", "(?i)tome") then var book tome
     if matchre("$righthand $lefthand", "(?i)guide") then var book guide
     if matchre("$righthand $lefthand", "(?i)manual") then var book manual
OPEN_COMP_1:
     put close my %Textbook.Noun
     wait
     pause 0.001
     pause 0.001
     math CompLoop add 1
     matchre SET_COMP_START ^You open your .* to the section on (.+) physiology
     matchre CLOSE_COMP ^That is already open
     put open my %Textbook.Noun
     matchwait 20
     echo *** Error with opening ***
     goto FINISH_COMP
CLOSE_COMP:
     if matchre("%TEXTBOOK.TYPE", "(?i)textbook") then
          {
               pause 0.2
               send turn my %Textbook.Noun to rat
               pause 0.5
               pause 0.1
          }
     put close my %Textbook.Noun
     pause 0.3
     pause 0.001
     goto OPEN_COMP_1
SET_COMP_START:
     var Startpage $1
     var Currentpage NULL
     pause 0.0001
STUDY_COMP:
     matchre STUDY_COMP ^\.\.\.wait|^Sorry
     matchre OPEN_COMP_1 ^You think that you could OPEN|^You carefully examine
     matchre DOTURN_YES ^You begin studying .* gradually absorbing the knowledge
     matchre DOTURN_YES ^You continue studying
     matchre DOTURN_YES ^In a sudden moment of clarity
     matchre DOTURN_YES ^With a sudden moment of clarity
     matchre DOTURN_HARD having a difficult time comprehending|almost impossible
     matchre DOTURN ^Why do you need to study this chart again
     put study my %Textbook.Noun
     matchwait 20
     echo *** Error with STUDY ***
     goto FINISH_COMP
DOTURN_HARD:
     math noStudyCount add 1
     goto DOTURN
DOTURN_YES:
     var studied 1
DOTURN:
     math PAGE add 1
     pause 0.0001
     pause 0.0001
     matchre DOTURN ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre SETNEWPAGE ^You turn to the section (?:containing|on) (.+) physiology
     matchre SETNEWPAGE ^You turn to page .* (?:containing|on) (.+) physiology.
     put turn my %Textbook.Noun
     matchwait 20
     echo *** Error in DOTURN ***
     goto FINISH_COMP
SETNEWPAGE:
     var Currentpage $1
     if matchre("%Startpage","%Currentpage") then goto FINISH_COMP
     if ($First_Aid.LearningRate > 33) then goto FINISH_COMP
     if ($Scholarship.LearningRate > 33) then goto FINISH_COMP
     if (%PAGE > 31) then goto FINISH_COMP
     if (%noStudyCount > 2) then goto FINISH_COMP
     if (matchre("%Type", "(?i)(once|instant)") && (%studied = 1)) then goto FINISH_COMP
     if (matchre("%Type", "(?i)(quick|fast)") && (%PAGE > 2)) then goto FINISH_COMP
     if (matchre("%Type", "(?i)average") && (%PAGE > 6)) then goto FINISH_COMP
     if (matchre("%Type", "(?i)normal") && (%PAGE > 18)) then goto FINISH_COMP
     if (matchre("%Type", "(?i)long") && (%PAGE > 25)) then goto FINISH_COMP
     if (%Playing = 0) then gosub PLAY
     goto STUDY_COMP
NO_COMP:
     echo ######################################
     echo **** NO COMPENDIUM/TEXTBOOK FOUND!
     echo **** DID YOU SET YOUR VARIABLES CORRECTLY?
     echo ######################################
     pause
     return
FINISH_COMP:
     var PAGE 0
     echo
     echo *** Finished Studying Textbook/Compendium! ***
     echo
     pause 0.0001
     if matchre("$righthand $lefthand", "(?i)%TEXTBOOK.TYPE") then gosub PUT put my %Textbook.Noun in my %Textbook.Container
     if matchre("$righthand $lefthand", "(?i)%TEXTBOOK.TYPE") then gosub PUT tie my %Textbook.Noun to my %Textbook.Container
     if matchre("$righthand $lefthand", "(?i)%TEXTBOOK.TYPE") then gosub stowing
     unvar Type
     unvar PAGE
     unvar studied
     unvar CompLoop
     unvar noStudyCount
     unvar skill
     unvar ranks
     unvar charts
     unvar ReadLoop
     unvar Startpage
     unvar Currentpage
     return
##### TEXTBOOK STUDY
TEXTBOOK_GO:
     # debug 5
     var studied 0
     var skill $1
     var ranks 10|20|20|30|30|40|40|50|50|60|60|70|70|80|80|90|90|100|100|100|100|100|100|100|100|100|100|120|120|120|140|140|160|160|180|180|180|200|200|220|220|230|240|240|260|260|260|280|300|300|320|320|340|340|360|360|380|380|400|410|420|430|440|450|460|470|480|490|500|510|520|530|540|550|560|570|580|590|600|610|620|630|640|650|660|670|680|690|700|710|720|730|740|750|760|770|780|790|800|810|820|830|840|850|860|870|880|890|900|910|920|930|940|950|960|970|980|990|1000|1050|1150|1750
     var charts Rat|Croff Pothanit|Heggarangi Frog|Brocket Deer|Scavenger Gobli|Wild Boar|Silver Leucro|Grass Eel|Striped Badger|Blood Dryad|Equine|Blood Nyad|Glutinous|Kelpie|Trollkin|Boggle|Cougar|Dwarven|Elothean|Elven|Gnome|Gor'Tog|Halfling|Human|Kaldar|Prydaen|Rakash|S'Kra Mur|Boobrie|Snow Goblin|Thunder Ram|Copperhead|Malodorous|Dusk Ogre|Young Ogre|Bison|Rock Troll|Sun Vulture|Fire Maiden|Moss Mey|Prereni|Vela'tohr|Peccary|Blue-belly|Kashika Serpent|River Caiman|Sluagh|Wood Troll|Gidii|Black Goblin|Granite|Rhoat Moda|River Sprite|Bawdy Swain|Swamp Troll|Heggarangi Boar|Warcat|Blacktip Shark|Piranha|Lanky Grey Lach|Ape|Merrows|Selkie|Geni|Trekhalo|Giant|Bobcat|Snowbeast|Arzumos|Caracal|Firecat|Gryphon|Seordmaor|Bull|Mammoth|Hawk|Armadillo|Shark|La'heke|Angiswaerd|Toad|Elsralael|Celpeze|Spider|Silverfish|Crab|Westanuryn|Dolomar|Warklin|Wasp|Dryad|Fendryad|Sprite|Alfar|Frostweaver|Spriggan|Gremlin|Cyclops|Atik'et|S'lai|Adan'f|Kra'hei|Faenrae|Bear|Barghest|Shalswar|Dyrachis|Poloh'izh|Korograth|Larva|Bizar|Pivuh|Vulture|Unyn|Moruryn|Moth|Kartais|Colepexy|Vykathi|Wyvern|Elpalzi|Xala'shar
     var Playing 0
     var studied 0
     var ReadLoop 0
     var Currentchart NULL
     var Totalcharts 0
     action var Currentchart $1 when ^You turn to page \d+ of your textbook, containing (.*) physiology\.
     action var Currentchart $1 when ^You turn to the section on (.*) physiology
     eval skill tolower(%skill)
     if matchre("first", "%skill") then goto TEXTBOOK.first
     if matchre("scholarship", "%skill") then goto TEXTBOOK.scholarship
     return

TEXTBOOK.first:
     var skill First_Aid
     evalmath minranks $Scholarship.Ranks - 100
     evalmath maxranks $Scholarship.Ranks + 100
     if (%minranks < 0) then var minranks 0
     eval Totalcharts count("%ranks", "|")
     goto TEXTBOOK.getranks

TEXTBOOK.scholarship:
     var skill Scholarship
     var maxranks $Scholarship.Ranks
     evalmath minranks $Scholarship.Ranks - 200
     if (%minranks < 0) then var minranks 0
     eval Totalcharts count("%ranks", "|")
     goto TEXTBOOK.getranks

TEXTBOOK.getranks:
     gosub TEXTBOOK.getmin
     gosub TEXTBOOK.getmax
     echo
     echo #################
     echo ** Starting Chart: %lowchart
     echo ** High Chart: %highchart
     echo #################
     echo
     if matchre("%Type", "(?i)quick|fast") then goto TEXTBOOK.charts
     goto TEXTBOOK.read

TEXTBOOK.getmin:
     var Tracker 0
     var temploop 0
     TEXTBOOK.getmin1:
     delay 0.0001
     if (%Tracker > %Totalcharts) then evalmath Tracker (%Totalcharts-25)
     if (%minranks > 930) then
          {
		     evalmath Tracker (%Totalcharts-20)
		     var lowchart %charts(%Tracker)
		     var Chartnumber %Tracker
               return
          }
     if (%minranks < 10) then
          {
               var lowchart %charts(0)
               return
          }
     if (%minranks < %ranks(%Tracker)) then
          {
               math Tracker subtract 15
               if (%Tracker < 3) then var Tracker 1
               var lowchart %charts(%Tracker)
               var Chartnumber %Tracker
               return
          }
     if (%minranks = %ranks(%Tracker)) then
          {
               math Tracker subtract 12
               if (%Tracker < 3) then var Tracker 1
               var lowchart %charts(%Tracker)
               var Chartnumber %Tracker
               return
          }
     if (%temploop > 122) then
          {
               echo *** Could not find Optimal Starting Page!
               echo *** Starting from beginning
               var Tracker 0
               var lowchart %charts(%Tracker)
               return
          }
     pause 0.00001
     math temploop add 1
     math Tracker add 2
     goto TEXTBOOK.getmin1

TEXTBOOK.getmax:
     var Tracker 0
     var temploop 0
     TEXTBOOK.getmax1:
     pause 0.0001
     if (%maxranks > 1050) then
          {
               var highchart %charts(%Totalcharts)
               return
          }
     if (%maxranks < %ranks(%Tracker)) then
          {
               math Tracker subtract 1
               var highchart %charts(%Tracker)
               return
          }
     if (%temploop > 122) then
          {
               var Tracker 121
               var highchart %charts(%Tracker)
               return
          }
     pause 0.0001
     math Tracker add 1
     math temploop add 1
     goto TEXTBOOK.getmax1

TEXTBOOK.read:
     put turn %TEXTBOOK.TYPE to %lowchart
     pause 0.5
TEXTBOOK.charts:
     pause 0.0001
     pause 0.0001
     if ($invisible = 1) then gosub STOP_INVIS
     math ReadLoop add 1
     if ((%Playing = 0) && (%Research.Active = 0)) then
          {
               put play $SONG
               pause 1
          }
     matchre TEXTBOOK.charts ^\.\.\.wait|^Sorry,
     match TEXTBOOK.next having a difficult time comprehending the advanced text
     match TEXTBOOK.next With a sudden moment of clarity,
     match TEXTBOOK.next In a sudden moment of clarity
     match TEXTBOOK.quickturn Why do you need to study this chart again?
     match TEXTBOOK.chartsdone You take on a studious look
     match TEXTBOOK.chartsdone What were you referring to
     match TEXTBOOK.chartsreset find it almost impossible to do
     match TEXTBOOK.chartsdone You attempt to study
     match TEXTBOOK.OPEN You think that you could OPEN
     match TEXTBOOK.expcheck You begin
     match TEXTBOOK.expcheck You continue studying the
     match TEXTBOOK.expcheck You continue to study
     put study my %TEXTBOOK.TYPE
     matchwait 20
     goto TEXTBOOK.expcheck
TEXTBOOK.open:
     put open my %TEXTBOOK.TYPE
     pause 0.7
     goto TEXTBOOK.charts
TEXTBOOK.chartsreset:
     var Chartnumber 0
     put turn my %TEXTBOOK.TYPE to %charts(%Chartnumber)
     pause 0.7
     goto TEXTBOOK.charts
TEXTBOOK.expcheck:
     var studied 1
     if (($monstercount > 0) && (%InCombat = 1)) then goto TEXTBOOK.chartsdone
     if ((%studied = 1) && matchre("%Type", "(?i)(once|instant)")) then goto TEXTBOOK.chartsdone
     if ((%ReadLoop > 4) && matchre("%Type", "(?i)(quick|fast)")  then goto TEXTBOOK.chartsdone
     if ((%ReadLoop > 13) && matchre("%Type", "(?i)(normal|average)"))  then goto TEXTBOOK.chartsdone
     if ((%ReadLoop > 22) && matchre("%Type", "(?i)long")) then goto TEXTBOOK.chartsdone
     if (%Chartnumber > %Totalcharts) then goto TEXTBOOK.chartsreset
     if ($%skill.LearningRate > 30) then goto TEXTBOOK.chartsdone
     if ("%skill" = "First_Aid") then goto TEXTBOOK.next
     goto TEXTBOOK.charts
TEXTBOOK.quickturn:
     math Chartnumber add 1
     math ReadLoop subtract 1
     goto TEXTBOOK.check
TEXTBOOK.next:
     var studied 1
     math Chartnumber add 1
TEXTBOOK.check:
     delay 0.0001
     matchre TEXTBOOK.chartsreset ^Turn what\?
     matchre TEXTBOOK.normalturn ^That section does not exist
     matchre TEXTBOOK.donedone ^You attempt to turn .+ but that doesn't seem to do much\.
     matchre TEXTBOOK.turned ^You turn to the section (?:containing|on) (.+) physiology
     put turn my %TEXTBOOK.TYPE to %charts(%Chartnumber)
     matchwait 4
TEXTBOOK.turned:
     if matchre("%Type", "(?i)(once|instant)") then
          {
               if ((%ReadLoop > 1) && (%studied = 1)) then goto TEXTBOOK.chartsdone
               if (%Chartnumber > %Totalcharts) then goto TEXTBOOK.chartsreset
               goto TEXTBOOK.charts
          }
     if matchre("%Type", "(?i)(quick|fast)") then
          {
               if (%ReadLoop > 4) then goto TEXTBOOK.chartsdone
               if (%Chartnumber > %Totalcharts) then goto TEXTBOOK.chartsreset
               goto TEXTBOOK.charts
          }
     if matchre("%Type", "(?i)(average|normal)") then
          {
               if (%ReadLoop > 13) then goto TEXTBOOK.chartsdone
               if (%Chartnumber > %Totalcharts) then goto TEXTBOOK.chartsreset
               goto TEXTBOOK.charts
          }
     if matchre("%Type", "(?i)long") then
          {
               if (%ReadLoop > 22) then goto TEXTBOOK.chartsdone
               if (%Chartnumber > %Totalcharts) then goto TEXTBOOK.chartsreset
               goto TEXTBOOK.charts
          }
     pause 0.0001
     if (($monstercount > 0) && (%InCombat = 1)) then goto TEXTBOOK.chartsdone
     if (matchre("%Type", "(?i)(once|instant)") && (%studied = 1)) then goto TEXTBOOK.chartsdone
     if (matchre("%Type", "(?i)(quick|fast)") && (%ReadLoop > 4)) then goto TEXTBOOK.chartsdone
     if (matchre("%Type", "(?i)(normal|average)") && (%ReadLoop > 13)) then goto TEXTBOOK.chartsdone
     if (matchre("%Type", "(?i)long") && (%ReadLoop > 22)) then goto TEXTBOOK.chartsdone
     if ($First_Aid.LearningRate > 29) then goto TEXTBOOK.chartsdone
     if ($Scholarship.LearningRate > 29) then goto TEXTBOOK.chartsdone
     if (%Chartnumber > %Totalcharts) then goto TEXTBOOK.chartsreset
     if matchre("%Currentchart", "%highchart") then goto TEXTBOOK.chartsdone
     if (%ReadLoop > 30) then goto TEXTBOOK.chartsdone
TEXTBOOK.nextturn:
     pause 0.0001
     matchre TEXTBOOK.normalturn ^That section does not exist
     matchre TEXTBOOK.alt ^You attempt to turn .+ but that doesn't seem to do much\.
     put turn my %TEXTBOOK.TYPE to %charts(%Chartnumber)
     matchwait 2
     pause 0.5
     goto TEXTBOOK.charts
TEXTBOOK.alt:
     pause 0.0001
     matchre TEXTBOOK.normalturn ^That section does not exist
     matchre TEXTBOOK.donedone ^You attempt to turn .+ but that doesn't seem to do much\.
     if matchre("$righthand", "(?i)%TEXTBOOK.TYPE") then put turn my $righthandnoun to %charts(%Chartnumber)
     if matchre("$lefthand", "(?i)%TEXTBOOK.TYPE") then put turn my $lefthandnoun to %charts(%Chartnumber)
     matchwait 2
     pause 0.5
     goto TEXTBOOK.charts
TEXTBOOK.normalturn:
     put turn my %TEXTBOOK.TYPE
     pause 0.2
     if (matchre("%Type", "(?i)(instant|once)") then goto TEXTBOOK.chartsdone
     if (matchre("%Type", "(?i)(quick|fast)") && (%ReadLoop > 3)) then goto TEXTBOOK.chartsdone
     if (matchre("%Type", "(?i)(normal|average)") && (%ReadLoop > 13)) then goto TEXTBOOK.chartsdone
     if (matchre("%Type", "(?i)long") && (%ReadLoop > 22)) then goto TEXTBOOK.chartsdone
     goto TEXTBOOK.charts
TEXTBOOK.chartsdone:
     if (%Chartnumber >= %Totalcharts) then goto TEXTBOOK.donedone
     if (%studied = 0) then
          {
               if matchre("%TEXTBOOK.TYPE", "(?i)(textbook|book|encyclopedia|treatise|volume|codex|tome|grimoire|quarto|folio|bestiary|field guide|cookbook|manual|atlas)") then goto TEXTBOOK.quickturn
               if matchre("%TEXTBOOK.TYPE", "(?i)(compendium|tome)") then goto DOTURN
          }
TEXTBOOK.donedone:
     var studied 0
     var ReadLoop 0
     pause 0.0001
     gosub PUT put my %TEXTBOOK.TYPE in my %Textbook.Container
     if (%Playing = 1) then
          {
               put stop play
               pause 0.0001
          }
     unvar Tracker
     unvar Type
     unvar PAGE
     unvar studied
     unvar CompLoop
     unvar noStudyCount
     unvar skill
     unvar ranks
     unvar charts
     put #parse TEXTBOOK DONE
     return
###########################################################################################
## CLERIC SUPPLY - Re-supply Stuff ############################
CHECK_DEBT:
     pause 0.0001
     matchre CLERIC_PAY_DEBT Debt\:
     matchre RETURN Wealth\:
     send wealth
     matchwait 20
     goto CHECK_DEBT
CLERIC_PAY_DEBT:
     var debt 1
     gosub DEBT
     var debt 0
     pause 0.2
     return
     ## You owe 1 silver, 9 bronze, and 8 copper Kronars to the Principality of Zoluren. (198 copper Kronars)
CHECK_SUPPLIES:
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVES
     pause 0.0001
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     gosub INVENTORY_PRECHECK
     return
RESUPPLY:
     pause 0.0001
     if !matchre("$UC_Container.Dirt", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               put rummage my $UC_Container.Dirt
               wait
               pause 0.2
          }
     math BathTime add %HaveChamomile
     math BathTime add %HaveLavender
     math BathTime add %HaveSage
     if ((matchre("$zoneid", "(1|66|67|68|69|116|123|127)") && (%BathTime < 2)) || (%HaveWine = 0) || (%HaveIncense = 0) || (%HaveFlint = 0) || ((%HaveCandle = 0) && ("$zoneid" = "116") && (%HaveSkates = 1)) || ((%HaveCandle = 0) && matchre("$zoneid", "\b(1|42|67|99)\b"))) then
     {
          echo *** Going to buy Clerical Supplies!
          #### ESCAPE TO NEAREST CITY
          var GOSUBBING ON
          var escaping ON
          gosub ESCAPE_NOW
          var GOSUBBING OFF
          #### DONE ESCAPING TO CITY
          gosub CHECK_DEBT
          gosub AUTOMOVE teller
          pause 0.3
          send withdraw 55 silver
          pause 0.4
          pause 0.4
          if (("$zoneid" = "116") && (%HaveCandle = 0)) then
               {
                    echo *** HEADING TO SHARD TO RESTOCK CANDLE!
                    put .travel shard
                    waitforre ^YOU ARRIVED
               }
          if ("$zoneid" = "1") then
          {
               gosub AUTOMOVE brother
               if ((%BathTime < 2) && (%HaveChamomile = 0)) then
               {
                    pause 0.1
                    gosub BUYIT chamomile 25
                    if ($UC_F2P = 0) then gosub BUYIT chamomile 25
                    var HaveChamomile 1
               }
               if ((%BathTime < 2) && (%HaveLavender = 0)) then
               {
                    pause 0.1
                    gosub BUYIT lavender 25
                    if ($UC_F2P = 0) then gosub BUYIT lavender 25
                    var HaveLavender 1
               }
               if (%HaveWine = 0) then
               {
                    pause 0.1
                    gosub BUYIT wine 250
                    var HaveWine 1
               }
               if (%HaveIncense = 0) then
               {
                    pause 0.1
                    gosub BUYIT incense 62
                    if ($UC_F2P = 0) then gosub BUYIT incense 62
                    if ($UC_F2P = 0) then gosub BUYIT incense 62
                    var HaveIncense 1
               }
               send out
               pause 0.4
               if (%HaveFlint = 0) then
                    {
                         gosub AUTOMOVE general
                         pause 0.2
                         gosub BUYIT flint 144
                         var HaveFlint 1
                         gosub STOWIT flint
                    }
               if (%HaveDirt = 0) then gosub FIND_DIRT
               if (%HaveCandle = 0) then
                    {
                         gosub AUTOMOVE temple
                         pause 0.3
                         gosub AUTOMOVE 6
                         pause 0.1
                         gosub FIND_MONK
                    }
               echo *** RESTOCKED CLERIC SUPPLIES!
               if ("$zoneid" = "2") then gosub AUTOMOVE crossing
               pause 0.5
               return
          }
          if ("$zoneid" = "30") then
          {
               gosub AUTOMOVE cleric shop
               if (%HaveWine = 0) then
               {
                    gosub BUYIT wine 290
                    if ($UC_F2P = 0) then gosub BUYIT wine 290
                    var HaveWine 1
               }
               if (%HaveIncense = 0) then
               {
                    gosub BUYIT incense 50
                    if ($UC_F2P = 0) then gosub BUYIT incense 50
                    if ($UC_F2P = 0) then gosub BUYIT incense 50
                    var HaveIncense 1
               }
               if (%HaveCandle = 0) then
               {
                    gosub BUYIT candle 115
                    if ($UC_F2P = 0) then gosub BUYIT candle 115
                    var HaveCandle 1
               }
               send out
               pause 0.5
               pause 0.1
               if (%HaveFlint = 0) then
                    {
                         gosub AUTOMOVE general
                         gosub BUYIT flint 110
                         var HaveFlint 1
                         gosub STOWIT flint
                    }
               if (%HaveDirt = 0) then gosub FIND_DIRT
               echo *** RESTOCKED CLERIC SUPPLIES!
               return
          }
          if ("$zoneid" = "67") then
          {
               gosub AUTOMOVE cleric shop
               if (%HaveChamomile = 0)) then
               {
                    gosub BUYIT chamomile 45
                    if ($UC_F2P = 0) then gosub BUYIT chamomile 45
                    var HaveChamomile 1
               }
               if (%HaveLavender = 0)) then
               {
                    gosub BUYIT lavender 45
                    if ($UC_F2P = 0) then gosub BUYIT lavender 45
                    var HaveLavender 1
               }
               if (%HaveIncense = 0) then
               {
                    gosub BUYIT incense 45
                    if ($UC_F2P = 0) then gosub BUYIT incense 45
                    if ($UC_F2P = 0) then gosub BUYIT incense 45
                    var HaveIncense 1
               }
               if (%HaveCandle = 0) then
               {
                    gosub BUYIT candle 115
                    if ($UC_F2P = 0) then gosub BUYIT candle 115
                    var HaveCandle 1
               }
               send out
               pause 0.5
               if (%HaveWine = 0) then
                    {
                    gosub AUTOMOVE milene
                    pause 0.2
                    put order 10
                    pause 0.5
                    pause 0.3
                    put get wine from bar
                    wait
                    put prep bless 10
                    pause 15
                    put cast my wine
                    pause 0.5
                    gosub STOWIT wine
                    pause 0.5
                    put order 10
                    pause 0.5
                    pause 0.3
                    put get wine from bar
                    wait
                    put prep bless 10
                    pause 15
                    put cast my wine
                    pause 0.5
                    gosub STOWIT wine
                    var HaveWine 1
                    }
               if (%HaveFlint = 0) then
                    {
                         gosub AUTOMOVE general
                         pause 0.2
                         gosub BUYIT flint 35
                         var HaveFlint 1
                         gosub STOWIT flint
                    }
               if (%HaveDirt = 0) then gosub FIND_DIRT
               echo *** RESTOCKED CLERIC SUPPLIES!
               return
          }
          if ("$zoneid" = "42") then
          {
               gosub AUTOMOVE cleric shop
               if (%HaveWine = 0) then
               {
                    gosub BUYIT wine 150
                    gosub BUYIT wine 150
                    var HaveWine 1
               }
               if (%HaveIncense = 0) then
               {
                    gosub BUYIT incense 48
                    gosub BUYIT incense 48
                    gosub BUYIT incense 48
                    var HaveIncense 1
               }
               if (%HaveCandle = 0) then
               {
                    gosub BUYIT candle 115
                    gosub BUYIT candle 115
                    var HaveCandle 1
               }
               send out
               pause 0.5
               if (%HaveFlint = 0) then
                    {
                         gosub AUTOMOVE general
                         pause 0.2
                         gosub BUYIT flint 60
                         var HaveFlint 1
                         gosub STOWIT flint
                    }
               if (%HaveDirt = 0) then gosub FIND_DIRT
               echo *** RESTOCKED CLERIC SUPPLIES!
               return
          }
          if ("$zoneid" = "90") then
          {
               gosub AUTOMOVE divine
               if (%HaveWine = 0) then
               {
                    gosub BUYIT wine 120
                    gosub BUYIT wine 120
                    var HaveWine 1
               }
               if (%HaveChamomile = 0)) then
               {
                    gosub BUYIT chamomile 45
                    gosub BUYIT chamomile 45
                    var HaveChamomile 1
               }
               if (%HaveLavender = 0)) then
               {
                    gosub BUYIT lavender 40
                    gosub BUYIT lavender 40
                    var HaveLavender 1
               }
               if (%HaveIncense = 0) then
               {
                    gosub BUYIT incense 45
                    gosub BUYIT incense 45
                    gosub BUYIT incense 45
                    var HaveIncense 1
               }
               send out
               pause 0.5
               if (%HaveFlint = 0) then
                    {
                         gosub AUTOMOVE general
                         pause 0.2
                         gosub BUYIT flint 100
                         var HaveFlint 1
                         gosub STOWIT flint
                    }
               if (%HaveDirt = 0) then gosub FIND_DIRT
               echo *** RESTOCKED CLERIC SUPPLIES!
               return
          }
          if ("$zoneid" = "99") then
          {
               gosub AUTOMOVE clerical
               if (%HaveWine = 0) then
               {
                    gosub BUYIT wine 1700
                    gosub BUYIT wine 1700
                    var HaveWine 1
               }
               if (%HaveChamomile = 0)) then
               {
                    gosub BUYIT chamomile 45
                    gosub BUYIT chamomile 45
                    var HaveChamomile 1
               }
               if (%HaveLavender = 0)) then
               {
                    gosub BUYIT lavender 45
                    gosub BUYIT lavender 45
                    var HaveLavender 1
               }
               if (%HaveIncense = 0) then
               {
                    gosub BUYIT incense 45
                    gosub BUYIT incense 45
                    gosub BUYIT incense 45
                    var HaveIncense 1
               }
               if (%HaveCandle = 0) then
               {
                    gosub BUYIT candle 115
                    gosub BUYIT candle 115
                    var HaveCandle 1
               }
               send out
               pause 0.5
               pause 0.1
               if (%HaveFlint = 0) then
                    {
                         gosub AUTOMOVE general
                         pause 0.2
                         gosub BUYIT flint 50
                         var HaveFlint 1
                         gosub STOWIT flint
                    }
               if (%HaveDirt = 0) then gosub FIND_DIRT
               echo *** RESTOCKED CLERIC SUPPLIES!
               return
          }
          if ("$zoneid" = "116") then
          {
               if (%HaveWine = 0) then
                    {
                    gosub AUTOMOVE 314
                    pause 0.2
                    gosub GET wine
                    pause 0.5
                    pause 0.3
                    wait
                    put prep bless 10
                    pause 15
                    put cast my wine
                    pause 0.5
                    gosub STOWIT wine
                    pause 0.2
                    gosub GET wine
                    pause 0.5
                    pause 0.3
                    wait
                    put prep bless 10
                    pause 15
                    put cast my wine
                    pause 0.5
                    gosub STOWIT wine
                    var HaveWine 1
                    }
               if (%HaveDirt = 0) then gosub FIND_DIRT
               echo #############################
               echo *** RESTOCKED CLERIC SUPPLIES!
               echo #############################
               pause 0.5
               action (communes) off
               return
          }
          if (%HaveDirt = 0) then gosub FIND_DIRT
          echo #############################
          echo *** NOT IN A RECOGNIZED AREA
          echo *** TO RESTOCK CLERICAL ITEMS
          echo #############################
          action (communes) off
          return
     }
     if (%HaveDirt = 0) then gosub FIND_DIRT
     echo #############################
     echo *** NO CLERIC SUPPLIES NEEDED!
     echo #############################
     pause 0.5
     action (communes) off
     return

BUYIT:
     var buy $1
     var offer $2
     pause 0.1
     put buy %buy
     pause 0.6
     pause 0.1
     if (%offer = 0) then return
     put offer %offer
     pause 0.1
     put offer %offer
     pause 0.4
     echo
     echo *** BOUGHT %buy
     echo
     pause 0.1
     gosub stowing
     return

FIND_MONK:
     if ("$zoneid" != "2a") then return
     var monkroom 4
FIND_MONK_1:
     pause 0.01
     pause 0.01
     if ("$roomid" != "%monkroom") then gosub AUTOMOVE %monkroom
     pause 0.1
     pause 0.1
     if matchre("$roomobjs", "weary old monk") then
          {
               put order 13 from monk
               wait
               pause 0.4
               gosub STOWIT candle
               pause 0.5
               gosub AUTOMOVE crossing
               var HaveCandle 1
               unvar monkroom
               return
          }
     math monkroom add 1
     if (%monkroom > 30) then
          {
               echo WEARY OLD MONK NOT FOUND!!
               gosub AUTOMOVE crossing
               unvar monkroom
               return
          }
     goto FIND_MONK_1

###########################################################################################
# THEURGY TRAINING
###############################
COMMUNE_SET:
     if (%Playing = 1) then gosub STOP_PLAY
     echo ######################
     echo ** CHECKING KNOWN COMMUNES
     echo ######################
     pause 0.0001
     action (communes) on
     var tamsine 0
     var eluned 0
     var kertigen 0
     var hodierna 0
     var meraud 0
     var glythtide 0
     var truffenyi 0
     if (%Playing = 1) then put stop play
COMMUNE_SET_1:
     matchre COMMUNE_SET_1 \.\.\.wait|Please
     matchre COMMUNE_PLAY ^You are a bit too busy
     matchre PRETRAININGLOOP ^You need to concentrate
     matchre COMMUNE_RETURN Syntax|What|I could|At this|COMMUNE
     put commune help
     matchwait 15
     goto COMMUNE_SET
COMMUNE_PLAY:
     put stop play
     pause 0.2
     goto COMMUNE_SET_1
COMMUNE_RETURN:
     pause 0.0001
     action (communes) off
     return
THEURGY:
## Actions ##########
     action (communes) on
     if (%Playing = 1) then gosub STOP_PLAY
     var BathFull NO
     var BathTime 0
     var CommuneCount 0
     var DanceComplete NO
     var HaveChamomile 0
     var HaveIncense 0
     var HaveLavender 0
     var HaveSage 0
     var HaveWine 0
     var HaveFlint 0
     var HerbsUsed 0
     var Winter NO
     var tamsine 0
     var eluned 0
     var kertigen 0
     var hodierna 0
     var meraud 0
     var glythtide 0
     var truffenyi 0
     var devotion 0
     if !matchre("$UC_WEAPON_OH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade $UC_WEAPON_OH
     if !matchre("%BSWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Backstab %BSWEAPON
     if !matchre("%THEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %THEWEAPON
     if !matchre("%LEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %LEWEAPON
     if !matchre("%SEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %SEWEAPON
     if !matchre("%Skinning.Knife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %Skinning.Knife
     if !matchre("%FlintKnife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %FlintKnife
     pause 0.001
     if ($UC_Zills = 1) then var Instrument %Zill.Name
     if ($UC_Zills = 0) then var Instrument lyre
     var InstrumentCont $UC_Container
     var PlaySongStyle $SONG
     var PrayTo %FAVOR.GOD
## Provincial Detection #######################
     if (%Playing = 1) then gosub STOP_PLAY
     gosub TIME_CHECK
     # gosub COMMUNE_CHECK
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     if !matchre("%PrayerMat", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PRAYER_MAT
     if matchre ("$zoneid", "\b(1|1j|1l|1m|2|2a|2d|4|4a|6|7|7a|8|8a|9b|61)\b") then goto THEURGY_CROSSING
     if matchre ("$zoneid", "\b(65|66|67|68|69)\b") then goto THEURGY_SHARD
     if matchre ("$zoneid", "\b(30|31|32|33)\b") then goto THEURGY_HAVEN
     if matchre ("$zoneid", "\b(116|127|126|123)\b") then goto THEURGY_HIB
     if matchre ("$zoneid", "\b(34|40|42)\b") then goto THEURGY_THEREN
     goto NO_THEURGY_TRAINING
THEURGY_CROSSING:
     var Province Crossing
     echo
     echo ###########################
     echo ** Training Theurgy/Rituals in %Province
     echo ###########################
     echo
     pause 0.5
     gosub stowing
     if ("$zoneid" = "61") then
          {
               put .travel cross
               waitforre ^YOU ARRIVED
          }
     if ("$zoneid" = "2d") then gosub AUTOMOVE temple
     if ("$zoneid" != "1") then gosub AUTOMOVE crossing
     var debt 1
     gosub DEBT
     var debt 0
     gosub CHECK_SUPPLIES
     gosub AUTOMOVE teller
     put withdraw 5 silver
     pause 0.5
     gosub TITHE
     if ("$zoneid" != "2a" && "%Winter" != "YES") then gosub AUTOMOVE temple
     if ("$zoneid" = "2a" && "$roomid" != "11") then gosub AUTOMOVE 11
     if (%Playing = 1) then put stop play
     pause 0.2
     put COMMUNE HELP
     pause 0.5
     pause 0.5
     if ("$zoneid" != "2a" && "%Winter" != "YES") then gosub AUTOMOVE temple
     if ("$zoneid" = "2a" && "$roomid" != "11") then gosub AUTOMOVE 11
     gosub stowing
     if (%Playing = 1) then gosub STOP_PLAY
     gosub COMMUNES
     gosub stowing
     pause 0.1
     pause 0.1
     if ("$zoneid" != "2a" && "%Winter" != "YES") then gosub AUTOMOVE temple
     if ("$zoneid" = "2a" && "$roomid" != "11") then gosub AUTOMOVE 11
     if ("%Winter" != "YES") then gosub FILL_BATH
     if ("%Winter" != "YES") then gosub BATHE
     gosub AUTOMOVE crossing
     pause 0.5
     if ($Theurgy.LearningRate > 33) then goto THEURGY_CROSSING_RETURN
     pause 0.2
     gosub AUTOMOVE chapel
     #gosub CLEAN_ALTAR
     gosub PRAY_AND_KISS_ALTAR
     gosub RECITE
     if ($UC_Pilgrim = 1) then gosub PRAYBADGE_TIMER
     if ($Theurgy.LearningRate > 33) then goto THEURGY_CROSSING_RETURN
     gosub stowing
     if (%HaveWine = 1) then gosub WINE_ALTAR
     if ($Theurgy.LearningRate > 33) then goto THEURGY_CROSSING_RETURN
     gosub stowing
     if (%HaveIncense = 1) then gosub INCENSE_ALTAR
     gosub stowing
     if ($Theurgy.LearningRate > 33) then goto THEURGY_CROSSING_RETURN
     if (($UC_F2P = 0) || (($UC_F2P = 1) && ($circle > 10))) then gosub DANCE_ALTAR
     if (%Playing = 1) then gosub STOP_PLAY
     if ($Theurgy.LearningRate > 33) then goto THEURGY_CROSSING_RETURN
     gosub stowing
     gosub PLAY_ALTAR
     if (%Playing = 1) then gosub STOP_PLAY
     if ($Theurgy.LearningRate > 33) then goto THEURGY_CROSSING_RETURN
     gosub stowing
     gosub PLANT_SIRESE
     pause 0.1
THEURGY_CROSSING_RETURN:
     gosub stowing
     if (%Playing = 1) then gosub STOP_PLAY
     gosub FILL_RECEPTACLE
     if ("$zoneid" = "2a") then gosub AUTOMOVE cross
     pause 0.2
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     if ("$zoneid" != "1") then gosub AUTOMOVE cross
     if ("$zoneid" != "1") then gosub AUTOMOVE cross
     if ("$zoneid" = "2a") then gosub AUTOMOVE cross
     pause 0.5
     if ("$zoneid" = "2a") then gosub AUTOMOVE cross
     if ("$zoneid" = "2a") then gosub AUTOMOVE cross
     goto THEURGY_RETURN

THEURGY_SHARD:
     var Province Shard
     echo
     echo ###########################
     echo ** Training Theurgy/Rituals in %Province
     echo ###########################
     echo
     pause 0.5
     gosub stowing
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "68") then gosub AUTOMOVE east
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     pause 0.1
     pause 0.1
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "67") then gosub AUTOMOVE bank
     var debt 1
     gosub DEBT
     var debt 0
     gosub CHECK_SUPPLIES
     gosub AUTOMOVE teller
     put withdraw 5 silver
     gosub TITHE
     gosub AUTOMOVE 88
     if (("$zoneid" = "67") && ($roomid != 88)) then gosub AUTOMOVE 88
     if (%Playing = 1) then put stop play
     pause 0.2
     put COMMUNE HELP
     pause 0.5
     pause 0.5
     gosub stowing
     if (%Playing = 1) then gosub STOP_PLAY
     gosub COMMUNES
     gosub stowing
     ### TO THE HOLY BATH AT HOT SPRINGS
     if ("$zoneid" = "67") then gosub AUTOMOVE west
     if ("$zoneid" = "69") then gosub AUTOMOVE 384
     gosub BATHE
     ### TO THE ALTAR IN STEELCLAW CLAN
     if ("$zoneid" = "69") then gosub AUTOMOVE shard
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     pause 0.3
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     pause 0.1
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE 108
     if (("$zoneid" = "66") && ("$roomid" != "108")) then gosub AUTOMOVE 108
     gosub CLEAN_ALTAR
     gosub PRAY_AND_KISS_ALTAR
     gosub RECITE
     if ($UC_Pilgrim = 1) then gosub PRAYBADGE_TIMER
     if ($Theurgy.LearningRate > 33) then goto THEURGY_SHARD_RETURN
     if (%HaveWine = 1) then gosub WINE_ALTAR
     if (%HaveIncense = 1) then gosub INCENSE_ALTAR
     if ($circle > 10) then gosub DANCE_ALTAR
     if (%Playing = 1) then gosub STOP_PLAY
     if ($Theurgy.LearningRate > 33) then goto THEURGY_SHARD_RETURN
     gosub stowing
     gosub PLAY_ALTAR
     gosub PLANT_SIRESE
     pause 0.1
THEURGY_SHARD_RETURN:
     gosub stowing
     if (%Playing = 1) then gosub STOP_PLAY
     gosub FILL_RECEPTACLE
     if matchre("$zoneid", "66|68") then gosub AUTOMOVE east
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     goto THEURGY_RETURN

THEURGY_HIB:
     var Province Hib
     echo
     echo ###########################
     echo ** Training Theurgy/Rituals in %Province
     echo ###########################
     echo
     pause 0.5
     gosub stowing
     if ("$zoneid" != "116") then
          {
               put .travel hib
               waitforre ^YOU ARRIVED\!
          }
     if matchre ("$zoneid", "123|127|126") then gosub AUTOMOVE hib
     if matchre ("$zoneid", "123|127|126") then gosub AUTOMOVE hib
     var debt 1
     gosub DEBT
     var debt 0
     gosub AUTOMOVE 60
     gosub CHECK_SUPPLIES
     if (%Playing = 1) then put stop play
     pause 0.2
     put COMMUNE HELP
     pause 0.5
     pause 0.5
     if (%Playing = 1) then gosub STOP_PLAY
     gosub COMMUNES
     gosub stowing
     ### TO THE HOLY BATH AT TEMPLE OF KERTIGEN
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "116") then gosub AUTOMOVE 306
     gosub BATHE
     if ($Theurgy.LearningRate > 33) then return
     ### TO ALTAR
     if matchre ("$zoneid", "116|126") then gosub AUTOMOVE boar
     if matchre ("$zoneid", "116|126") then gosub AUTOMOVE boar
     if matchre ("$zoneid", "116|126") then gosub AUTOMOVE boar
     pause 0.2
     if ("$zoneid" = "127") then gosub AUTOMOVE 220
     pause 0.2
     if (("$zoneid" = "127") && ("$roomid" != "220")) then gosub AUTOMOVE 220
     gosub CLEAN_ALTAR
     gosub PRAY_AND_KISS_ALTAR
     gosub RECITE
     if ($UC_Pilgrim = 1) then gosub PRAYBADGE_TIMER
     if ($Theurgy.LearningRate > 33) then goto THEURGY_HIB_RETURN
     if (%HaveWine = 1) then gosub WINE_ALTAR
     if (%HaveIncense = 1) then gosub INCENSE_ALTAR
     if ($circle > 10) then gosub DANCE_ALTAR
     if (%Playing = 1) then gosub STOP_PLAY
     if ($Theurgy.LearningRate > 33) then goto THEURGY_HIB_RETURN
     gosub stowing
     gosub PLAY_ALTAR
     gosub PLANT_SIRESE
     pause 0.1
THEURGY_HIB_RETURN:
     gosub stowing
     if (%Playing = 1) then gosub STOP_PLAY
     gosub FILL_RECEPTACLE
     if matchre ("$zoneid", "127|126") then gosub AUTOMOVE hib
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "116") then gosub AUTOMOVE 60
     goto THEURGY_RETURN

THEURGY_HAVEN:
     var Province Riverhaven
     echo
     echo ###########################
     echo ** Training Theurgy/Rituals in %Province
     echo ###########################
     echo
     pause 0.5
     gosub stowing
     if matchre ("$zoneid", "31|32|33") then gosub AUTOMOVE river
     if matchre ("$zoneid", "31|32|33") then gosub AUTOMOVE river
     if matchre ("$zoneid", "31|32|33") then gosub AUTOMOVE river
     var debt 1
     gosub DEBT
     var debt 0
     gosub CHECK_SUPPLIES
     gosub AUTOMOVE teller
     put withdraw 5 silver
     gosub TITHE
     if (%Playing = 1) then put stop play
     pause 0.2
     put COMMUNE HELP
     pause 0.5
     pause 0.5
     if (%Playing = 1) then gosub STOP_PLAY
     gosub COMMUNES
     gosub stowing
     ### TO THE ALTAR
     gosub AUTOMOVE 133
     if (("$zoneid" = "30") && ("$roomid" != "133")) then gosub AUTOMOVE 133
     gosub CLEAN_ALTAR
     gosub PRAY_AND_KISS_ALTAR
     gosub RECITE
     if ($UC_Pilgrim = 1) then gosub PRAYBADGE_TIMER
     if ($Theurgy.LearningRate > 33) then goto THEURGY_HAVEN_RETURN
     if (%HaveWine = 1) then gosub WINE_ALTAR
     if (%HaveIncense = 1) then gosub INCENSE_ALTAR
     if ($circle > 10) then gosub DANCE_ALTAR
     if (%Playing = 1) then gosub STOP_PLAY
     if ($Theurgy.LearningRate > 33) then goto THEURGY_HAVEN_RETURN
     gosub stowing
     gosub PLAY_ALTAR
     gosub PLANT_SIRESE
     pause 0.1
THEURGY_HAVEN_RETURN:
     gosub stowing
     if (%Playing = 1) then gosub STOP_PLAY
     gosub FILL_RECEPTACLE
     goto THEURGY_RETURN

THEURGY_THEREN:
     var Province Theren
     echo
     echo ###########################
     echo ** Training Theurgy/Rituals in %Province
     echo ###########################
     echo
     pause 0.5
     gosub stowing
     if matchre ("$zoneid", "34|40") then gosub AUTOMOVE theren
     var debt 1
     gosub DEBT
     var debt 0
     gosub CHECK_SUPPLIES
     gosub AUTOMOVE teller
     put withdraw 5 silver
     gosub TITHE
     if (%Playing = 1) then put stop play
     pause 0.2
     put COMMUNE HELP
     pause 0.5
     pause 0.5
     gosub COMMUNES
     gosub stowing
     ### TO THE ALTAR
     gosub AUTOMOVE 202
     if (("$zoneid" = "42") && ("$roomid" != "202")) then gosub AUTOMOVE 202
     gosub CLEAN_ALTAR
     gosub PRAY_AND_KISS_ALTAR
     gosub RECITE
     if ($UC_Pilgrim = 1) then gosub PRAYBADGE_TIMER
     if ($Theurgy.LearningRate > 33) then goto THEURGY_THEREN_RETURN
     if (%HaveWine = 1) then gosub WINE_ALTAR
     if (%HaveIncense = 1) then gosub INCENSE_ALTAR
     if ($circle > 10) then gosub DANCE_ALTAR
     if (%Playing = 1) then gosub STOP_PLAY
     if ($Theurgy.LearningRate > 33) then goto THEURGY_THEREN_RETURN
     gosub stowing
     gosub PLAY_ALTAR
     gosub PLANT_SIRESE
THEURGY_THEREN_RETURN:
     gosub stowing
     if (%Playing = 1) then gosub STOP_PLAY
     gosub FILL_RECEPTACLE
     goto THEURGY_RETURN

THEURGY_AESRY:
     var Province Aesry
     echo
     echo ###########################
     echo ** Training Theurgy/Rituals in %Province
     echo ###########################
     echo
     pause 0.5
     gosub stowing
     if matchre("$zoneid", "98") then gosub AUTOMOVE aesry
     var debt 1
     gosub DEBT
     var debt 0
     gosub CHECK_SUPPLIES
     gosub AUTOMOVE teller
     put withdraw 5 silver
     gosub TITHE
     if (%Playing = 1) then put stop play
     pause 0.2
     put COMMUNE HELP
     pause 0.5
     pause 0.5
     if (%Playing = 1) then gosub STOP_PLAY
     gosub COMMUNES
     gosub stowing
     ### TO THE ALTAR
     gosub AUTOMOVE meraud
     if (("$zoneid" = "99") && ("$roomid" != "296")) then gosub AUTOMOVE 296
     gosub CLEAN_ALTAR
     gosub PRAY_AND_KISS_ALTAR
     gosub RECITE
     if ($UC_Pilgrim = 1) then gosub PRAYBADGE_TIMER
     if ($Theurgy.LearningRate > 33) then goto THEURGY_AESRY_RETURN
     if (%HaveWine = 1) then gosub WINE_ALTAR
     if (%HaveIncense = 1) then gosub INCENSE_ALTAR
     if ($circle > 10) then gosub DANCE_ALTAR
     if (%Playing = 1) then gosub STOP_PLAY
     if ($Theurgy.LearningRate > 33) then goto THEURGY_AESRY_RETURN
     gosub stowing
     gosub PLAY_ALTAR
     gosub PLANT_SIRESE
     pause 0.1
     if ($Theurgy.LearningRate > 33) then goto THEURGY_AESRY_RETURN
     gosub AUTOMOVE 123
     pause 0.1
     put kiss unicorn
     pause 0.8
THEURGY_AESRY_RETURN:
     gosub stowing
     if (%Playing = 1) then gosub STOP_PLAY
     gosub FILL_RECEPTACLE
     goto THEURGY_RETURN

THEURGY_RETURN:
     # unvar BathFull
     # unvar BathTime
     # unvar CommuneCount
     # unvar DanceComplete
     # unvar HaveChamomile
     # unvar HerbsUsed
     # unvar Winter
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "116") then gosub AUTOMOVE 60
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     return
###########################################
ALIGN_CHECK:
     gosub ALIGN_TIMER
     if ($UC_Align.Last < 21600) then return
     if (%HaveCandle = 0) then
          {
               echo ** MISSING CANDLE FOR ALIGNMENT
               put #tvar UC_Align.Time $gametime
               return
          }
     if ($devotion < 6) then return
     if ($UC_meraud = 0) then return
     # if ($UC_Lighter = 1) then goto LIGHTER_CANDLE
     if matchre("%FlintBlade", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               if !matchre("$UC_WEAPON_OH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade $UC_WEAPON_OH
               if !matchre("%BSWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Backstab %BSWEAPON
               if !matchre("%THEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %THEWEAPON
               if !matchre("%LEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %LEWEAPON
               if !matchre("%SEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %SEWEAPON
               if !matchre("%Skinning.Knife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %Skinning.Knife
               if !matchre("%FlintKnife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %FlintKnife
               pause 0.2
          }
     gosub stowing
     if ($UC_Lighter = 1) then
          {
          gosub GET my %Lighter.Name
          pause 0.3
          if !matchre("$righthand", "(?i)%Lighter.Name") then
               {
                    echo *** NO LIGHTER FOUND!!!
                    put #var UC_Lighter 0
                    goto ALIGN_CHECK_2
               }
          }
ALIGN_CHECK_2:
     if ($UC_Lighter = 0) then gosub GET my %FlintBlade
     pause 0.1
     gosub GET my candle
     pause 0.5
     pause 0.1
     if !matchre("$righthand $lefthand", "candle") then goto MISSING_CANDLE
     if matchre("$righthand $lefthand", "(?i)%Lighter.Name") then
          {
               gosub PUT point %Lighter.Name at incense
               pause 0.5
               gosub STOWIT %Lighter.Name
               goto ALIGN_CHECK_3
          }
     send drop candle
     pause 0.5
     pause 0.4
     gosub GET my flint
     pause 0.5
     gosub LIGHT_CANDLE
     pause 0.5
     gosub STOWIT flint
     pause 0.3
     gosub GET candle
     pause 0.1
ALIGN_CHECK_3:
     put align kertigen
     put #tvar UC_Align.Time $gametime
     pause 0.5
     pause 0.1
MISSING_CANDLE:
     echo
     echo *** MISSING CANDLE!!
     echo
     gosub stowing
     return
###########################################
PRAYER_MAT:
     echo #######################
     echo ** Training Theurgy w/ Prayer Mat
     echo #######################
     put #echo >Log #7FFFD4 **** Using Prayer Mat
     if ("$zoneid" = "1") then gosub AUTOMOVE tgne
     gosub stowing
     pause 0.3
     gosub GET my %PrayerMat
     pause 0.6
     pause 0.3
     gosub GLANCE
     if !matchre("$righthand $lefthand", "(?i)%PrayerMat") then goto PRAYER_MAT_ERROR
     gosub PUT unroll my %PrayerMat
     pause 0.7
     gosub PUT kneel
     gosub KISS_MAT
     gosub WINE_MAT
     gosub STAND
     gosub DANCE_MAT
     gosub INCENSE_MAT
     pause 0.5
     pause 0.5
     put roll %PrayerMat
     wait
     gosub stowing
     return

KISS_MAT:
     pause 0.1
     put kiss %PrayerMat
     pause 0.5
     pause 0.2
     put kiss %PrayerMat
     pause 0.4
     pause 0.5
     return
DANCE_MAT:
     pause 0.1
     gosub PUT dance %PrayerMat
     pause 10
     pause 0.5
     gosub PUT dance %PrayerMat
     pause 10
     pause 0.5
     gosub PUT dance %PrayerMat
     pause 10
     pause 0.5
     pause 0.5
     return
INCENSE_MAT:
     if (%HaveIncense = 0) then
          {
               echo *** NO INCENSE! SKIPPING INCENSE RITUAL
               return
          }
     pause 0.2
     gosub LIGHT_IT
     gosub WAVE_INCENSE %PrayerMat
     pause 0.5
     gosub SNUFF_INCENSE
     return
WINE_MAT:
     if (%HaveWine = 0) then
          {
               echo *** NO WINE! SKIPPING WINE RITUAL
               return
          }
     pause 0.2
     gosub GET my wine
     if ($kneeling = 0) then put kneel
     pause 0.1
     pause 0.5
     matchre WINE_MAT_2 ^You quietly pour|What were you|I could not|Maybe|^Pour what\?
     send pour wine on %PrayerMat
     matchwait 10
WINE_MAT_2:
     pause 0.5
     gosub STAND
     gosub STOWIT wine
     return
RECITE:
     pause 0.01
     pause 0.01
     send recite Hodierna, give me strength for my righteous love and vengeance\;Chadatru, guide my sword to swing in justice\;Everild, give me the power to conquer my enemies\;Truffenyi, let me not lose sight of compassion and mercy\;Else, I will become like those I despise\;Urrem'tier, receive into your fetid grasp these wicked souls\;May the Tamsine's realms never know their evil ways again\;Glythtide, show me the path of blessings
     pause 0.8
     pause
     put commune
     pause 0.5
     return
PRAYER_MAT_ERROR:
     echo
     echo #########################
     echo *** ERROR! PRAYER MAT NOT FOUND?!
     echo *** Variable set properly?
     echo *** CHECK PrayerMat VAR: %PrayerMat
     echo #########################
     echo
     put #echo >Log #ff0000 *** Error! PRAYER MAT not found?! Check variables!
     pause
     return
NO_THEURGY_TRAINING:
     # if !matchre("%PrayerMat", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then return
     echo
     echo ###########################################
     echo *** Zone $zoneid NOT A SUPPORTED LOCATION FOR THEURGY TRAINING
     echo ###########################################
     echo
     put #echo >Log Orange *** Not in a supported city for Theurgy training - Zone $zoneid
     pause
     goto THEURGY_RETURN
## Altar Stuff ################################
CLEAN_ALTAR:
     gosub GET my %HolyWater
     gosub CLEAN_ALTAR_2
     gosub STOW my %HolyWater
     gosub stowing
     return
CLEAN_ALTAR_2:
     pause 0.2
     matchre CLEAN_ALTAR_2 ^\.\.\.wait|^Sorry
     matchre RETURN ^You feel that your gods|you have completed this ritual too recently in the past\.|^You finish|^You sense|^That doesn\'t appear
     send clean altar with water in my %HolyWater
     matchwait 9
     return

DANCE_ALTAR:
     var danceloop 0
     DANCE_ALTAR_1:
     math danceloop add 1
     pause 0.2
     if (%danceloop > 5) then return
     if ("%DanceComplete" = "YES") then return
     pause 0.5
     gosub STAND
     pause 0.2
     pause 0.5
     send dance
     pause 0.5
     pause 0.5
     goto DANCE_ALTAR_1

INCENSE_ALTAR:
     if (%HaveIncense = 0) then return
     pause 0.2
     gosub LIGHT_IT
     pause 0.2
     gosub WAVE_INCENSE altar
     # if ("$zoneid" != "30") then gosub WAVE_INCENSE altar
     # if ("$zoneid" = "30") then gosub WAVE_INCENSE statue
     pause 0.5
     gosub SNUFF_INCENSE
     gosub stowing
     return

#################################################################
LIGHT_INCENSE:
     var incenseloop 0
     var incenselit 1
LIGHT_INCENSE_1:
     pause 0.2
     math incenseloop add 1
     if (%incenseloop > 4) then goto BAD_INCENSE
     matchre BAD_INCENSE nothing happens
     matchre LIGHT_INCENSE_1 ^\.\.\.wait|^Sorry
     matchre RETURN smolders\, then bursts into flames\.
     matchre RETURN ^It's much too dark in here to do that\.
     send light incense with my flint
     matchwait 20
     return
SNUFF_INCENSE:
     var incenselit 0
     matchre SNUFF_INCENSE ^\.\.\.wait|^Sorry
     matchre RETURN ^What were you referring to\?
     matchre RETURN ^But that isn't burning\!
     matchre STOW_INCENSE ^You snuff out
     send snuff my incense
     matchwait 5
     return
STOW_INCENSE:
     gosub STOWIT incense
     gosub WEAR %FlintBlade
     gosub stowing
     return
BAD_INCENSE:
     var incenselit 0
     return
WAVE_INCENSE:
     var wave $0
WAVE_INCENSE_1:
     pause 0.2
     matchre WAVE_INCENSE_1 ^\.\.\.wait|^Sorry
     matchre RETURN ^You feel that your gods
     matchre RETURN you have completed this ritual too recently in the past\.
     matchre RETURN ^You wave your .* over
     matchre RETURN ^You wave some burnt incense around yourself.
     matchre RETURN ^You wave some fragrant incense around yourself\.
     send wave incense at %wave
     matchwait 20
     return
PLAY_ALTAR:
     pause 0.2
     gosub stowing
     if ($UC_Zills = 0) then gosub GET my %Instrument
     pause 0.2
     if matchre("%Zill.Name", "(?i)cowbells?") then gosub PERFORMANCE_COWBELL
     if !matchre("%Zill.Name", "(?i)cowbells?") then gosub PERFORMANCE
     gosub PLAY_INSTRUMENT
     pause 0.5
     if ($UC_Zills = 0) then gosub PUT_IT %Instrument in my %InstrumentCont
     pause 0.2
     if (%Playing = 1) then gosub STOP_PLAY
     gosub stowing
     return
PLAY_INSTRUMENT:
     pause 0.5
     matchre PLAY_INSTRUMENT ^\.\.\.wait|^Sorry
     matchre PLAY_INSTRUMENT_DONE ^You finish
     matchre PLAY_INSTRUMENT_DONE ^What type of song
     send play %PlaySongStyle on my %Instrument for %PrayTo
     matchwait 120
PLAY_INSTRUMENT_DONE:
     put stop play
     pause 0.5
     return
PRAY_AND_KISS_ALTAR:
     pause 0.2
     pause 0.5
     send pray
     pause
     pause 0.5
     pause 0.5
     send pray %PrayTo
     pause
     pause 0.5
     pause 0.5
     matchre KISS_ALTAR_2 ^You bend forward to kiss
     send kiss altar
     matchwait 12
KISS_ALTAR_2:
     pause 0.1
     gosub STAND
     gosub stowing
     return
WINE_ALTAR:
     if (%HaveWine = 0) then return
     pause 0.2
     gosub GET my wine
     pause 0.5
     if !matchre("$righthand $lefthand", "(?i)wine") then return
     pause 0.5
     matchre WINE_ALTAR_2 ^You quietly pour some of the wine onto the altar\.
     send pour wine on altar
     matchwait 20
WINE_ALTAR_2:
     pause 0.1
     gosub STOWIT wine
     return
######################################################
## LIGHT CANDLE
CANDLE_RETRY:
     gosub GET my %FlintBlade
LIGHT_CANDLE:
     var candleloop 0
     var candleflip 0
LIGHT_CANDLE_1:
     math candleloop add 1
     if (%candleloop > 2) then goto LIGHT_SWAP2
     pause 0.2
     matchre LIGHT_CANDLE ^\.\.\.wait|^Sorry
     matchre RETURN smolders\, then bursts into flames\.
     matchre RETURN ^It's much too dark in here to do that\.
     matchre LIGHT_CANDLE_1 but nothing happens\.
     send light candle with my flint
     matchwait 20
     return
LIGHT_SWAP2:
     math candleflip add 1
     echo
     echo *** Bad weapon to make fire! Trying something else...
     echo
     pause 0.2
     gosub STOWIT %FlintBlade
     if (%candleflip > 3) then goto CANDLE_ERROR
     if (!matchre("%FlintKnife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)%FlintKnife")) then var FlintBlade %FlintKnife
     if (!matchre("%Skinning.Knife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)%Skinning.Knife")) then var FlintBlade %Skinning.Knife
     if (!matchre("$UC_WEAPON_SE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)$UC_WEAPON_SE")) then var FlintBlade $UC_WEAPON_SE
     if (!matchre("$UC_WEAPON_OH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)$UC_WEAPON_OH")) then var FlintBlade $UC_WEAPON_OH
     if (!matchre("$UC_WEAPON_BS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)$UC_WEAPON_BS")) then var FlintBlade $UC_WEAPON_BS
     if (!matchre("$UC_WEAPON_THE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)$UC_WEAPON_THE")) then var FlintBlade $UC_WEAPON_THE
     if (!matchre("$UC_WEAPON_LE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)$UC_WEAPON_LE")) then var FlintBlade $UC_WEAPON_LE
     pause 0.2
     echo
     echo ** TRYING %FlintBlade
     echo
     goto CANDLE_RETRY
CANDLE_ERROR:
     echo
     echo *** ERROR!! NO VALID WEAPON FOUND TO MAKE FIRE
     echo
     return
###############################################
# FIRE LOGIC / LIGHTER LOGIC
LIGHT_IT:
     var lightloop 0
     if (%HaveIncense = 0) then return
     if ($UC_Lighter = 1) then goto LIGHTER_IT
     if matchre("%FlintBlade", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               if !matchre("$UC_WEAPON_OH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade $UC_WEAPON_OH
               if !matchre("%BSWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var Backstab %BSWEAPON
               if !matchre("%THEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %THEWEAPON
               if !matchre("%LEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %LEWEAPON
               if !matchre("%SEWEAPON", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %SEWEAPON
               if !matchre("%Skinning.Knife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %Skinning.Knife
               if !matchre("%FlintKnife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then var FlintBlade %FlintKnife
               pause 0.2
          }
LIGHT_IT_RETURN:
     math lightloop add 1
     gosub stowing
     gosub GET my %FlintBlade
     gosub GET incense
     pause 0.2
     if !matchre("$righthand $lefthand", "incense") then goto OUT_OF_INCENSE
     if (%lightloop > 3) then goto LIGHT_ERROR
     if (%HaveIncense = 0) then return
     send drop incense
     pause 0.5
     gosub GET my flint
     pause 0.5
     gosub LIGHT_INCENSE
     pause 0.3
     if (%incenselit = 0) then goto LIGHT_SWAP
     gosub STOW flint
     pause 0.3
     gosub GET incense
     gosub CLEAR_MATCHTABLE
     return
LIGHT_SWAP:
     echo
     echo *** Bad weapon to make fire! Trying something else...
     echo
     pause 0.2
     gosub STOWIT %FlintBlade
     if (!matchre("%FlintKnife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)%FlintKnife")) then var FlintBlade %FlintKnife
     if (!matchre("%Skinning.Knife", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)%Skinning.Knife")) then var FlintBlade %Skinning.Knife
     if (!matchre("$UC_WEAPON_SE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)$UC_WEAPON_SE")) then var FlintBlade $UC_WEAPON_SE
     if (!matchre("$UC_WEAPON_OH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)$UC_WEAPON_OH")) then var FlintBlade $UC_WEAPON_OH
     if (!matchre("$UC_WEAPON_BS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)$UC_WEAPON_BS")) then var FlintBlade $UC_WEAPON_BS
     if (!matchre("$UC_WEAPON_THE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)$UC_WEAPON_THE")) then var FlintBlade $UC_WEAPON_THE
     if (!matchre("$UC_WEAPON_LE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") && !matchre("%FlintBlade" "(?i)$UC_WEAPON_LE")) then var FlintBlade $UC_WEAPON_LE
     pause 0.2
     echo
     echo ** TRYING %FlintBlade
     echo
     goto LIGHT_IT_RETURN
LIGHT_ERROR:
     echo *** Error Finding a proper FlintBlade for striking flint!
     return
### LIGHTERS
LIGHTER_IT:
     pause 0.001
     gosub stowing
     pause 0.1
     gosub GET my %Lighter.Name
     pause 0.2
     pause 0.1
     pause 0.2
     if !matchre("$righthand", "(?i)%Lighter.Name") then
          {
               put #var UC_Lighter 0
               goto LIGHT_IT
          }
     gosub GET my incense
     pause 0.2
     pause 0.1
     if !matchre("$righthand $lefthand", "(?i)incense") then goto OUT_OF_INCENSE
     gosub PUT point %Lighter.Name at incense
     pause 0.5
     gosub STOWIT %Lighter.Name
     pause 0.4
     return
## Bathing Stuff ##############################
BATHE:
     if (((%HaveChamomile = 0) && (%HaveSage = 0)) || ((%HaveLavender = 0) && (%HaveSage = 0))) then return
     gosub stowing
     math BathTime add %HaveChamomile
     math BathTime add %HaveLavender
     math BathTime add %HaveSage
     if (%BathTime >= 2) then
     {
          if ("$zoneid" = "1") then gosub AUTOMOVE temple
          if (("$zoneid" = "2a") && ("$roomid" != "33")) then gosub AUTOMOVE 33
          if (("$zoneid" = "2a") && ("$roomid" = "11")) then gosub MOVE go bath
          pause 0.001
          if (%HaveChamomile = 1) then
          {
               gosub GET my chamomile
               pause 0.2
               send rub my chamomile
               math HerbsUsed add 1
          }
          pause 0.8
          if (%HaveLavender = 1) then
          {
               gosub GET my lavender
               pause 0.2
               send rub my lavender
               math HerbsUsed add 1
          }
          pause 0.1
          if (%HaveSage = 1 && %HerbsUsed < 2) then
          {
               pause 0.5
               gosub GET my sage
               pause 0.5
               send rub my sage
          }
          waitforre ^You feel that your gods have smiled upon you|you have completed this ritual too recently in the past\.|^You sense that you are as pure|^YOU HAVE BEEN|^You get a sense that the gods are pleased with your task|A warm feeling suffuses you, and you realize you have achieved a higher state of purity\.
          gosub MOVE out
     }
     return
CHECK_BATH_LEVEL:
     pause 0.5
     matchre CHECK_BATH_LEVEL ^\.\.\.wait|^Sorry
     matchre FILL_POT (bone|currently|fairly|half|nearly) (empty|dry|full|shallow)|very shallow
     matchre RETURN currently (very full|almost overflowing)\,
     send peer marble bath
     matchwait 20
FILL_BATH:
     gosub CHECK_BATH_LEVEL
     if ("%BathFull" = "YES") then return
FILL_BATH_2:
     pause 0.3
     matchre FILL_BATH_2 ^\.\.\.wait|^Sorry
     matchre FILL_POT ^But the pot is empty\!
     matchre CHECK_BATH_LEVEL ^Roundtime\:|^You feel that your gods|you have completed this ritual too recently in the past\.|^You sense that you are as pure
     matchre RETURN ^The pool is already too full\!
     send pour pot in pool
     matchwait 20
FILL_POT:
     pause 0.3
     matchre FILL_POT ^\.\.\.wait|^Sorry
     matchre FILL_POT The weight of the stone pot is simply too much to bear
     matchre CHECK_POT ^Roundtime\:|^But the stone pot is already full\!
     send fill pot with stream
     matchwait 20
     goto FILL.POT
CHECK_POT:
     pause 0.2
     matchre BLESS_POT ^The stone pot is full of .* river water\.
     matchre FILL_BATH_2 holy water\.
     send look in pot
     matchwait 10
BLESS_POT:
     put PREP bless 5
     pause 15
     gosub CAST water in pot
     goto FILL_BATH_2
DUMP_DIRT:
     pause 0.2
     # if matchre("$righthand", "orb") then gosub STOWIT $1
     if matchre("$righthand", "(dirt|grass|primer|bead|tobacco|cigar)" then gosub STOWIT right
     if matchre("$lefthand", "(dirt|grass|primer|bead|tobacco|cigar)" then gosub STOWIT left
     if matchre("$righthand", "orb" then gosub EMPTY_RIGHT
     if matchre("$lefthand", "orb" then gosub EMPTY_LEFT
     pause 0.4
     return
## Commune Stuff ##############################
COMMUNES:
     var Communes 0|meraud|eluned|truffenyi
     action (communes) on
     math CommuneCount add 1
     if ("%Communes(%CommuneCount)" = "") then return
     gosub COMMUNE_%Communes(%CommuneCount)
     goto COMMUNES
COMMUNE_tamsine:
     action (communes) on
     if (%tamsine = 0) then return
     if ($UC_tamsine = 1) then return
     echo ##################
     echo ** TAMSINE COMMUNE
     echo ##################
     if (%InCombat = 1) then gosub RETREAT
     gosub stowing
     gosub GET %HolyWater
     gosub SPRINKLE $charactername
     gosub STOW my %HolyWater
     matchre RETURN ^You feel warmth spread throughout your body\,|^You feel like you have completed this commune too recently\.|^You sense that you are as pure|^You stop
     send commune tamsine
     matchwait 20
     return
COMMUNE_eluned:
     action (communes) on
     if (%eluned = 0) then return
     echo ##################
     echo ** ELUNED COMMUNE
     echo ##################
     gosub stowing
     pause 0.1
     gosub GET dirt
     pause 0.2
     if !matchre("$righthand $lefthand", "dirt") then
          {
               if !matchre("$UC_Container.Dirt", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
                    {
                         gosub PUT push $UC_Container.Dirt
                         pause 0.2
                         if !matchre("$righthand $lefthand", "dirt") then gosub GET dirt from $UC_Container.Dirt
                         pause 0.2
                    }
          }
     if (!matchre("$righthand", "dirt") && !matchre("$lefthand", "dirt")) then
          {
               if !matchre("$lefthand", "Empty") then gosub STOWIT left
               gosub RETREAT
               gosub FORAGE dirt
               pause 0.3
          }
     if matchre("$lefthand", "dirt") then gosub SWAP
     if (!matchre("$righthand", "dirt") && !matchre("$lefthand", "dirt")) then
          {
               if !matchre("$lefthand", "Empty") then gosub STOWIT left
               put forage dirt
               pause 2
               pause
               if !matchre("$righthand", "dirt") && !matchre("$lefthand", "dirt") then
                    {
                         echo ###############################
                         echo ** NO DIRT FOR ELUNED COMMUNE!
                         echo ###############################
                         return
                    }
          }
     if (%InCombat = 1) then gosub RETREAT
     gosub GET %HolyWater
     pause 0.2
COMMUNE_eluned_1:
     gosub CLEAR_MATCHTABLE
     pause 0.2
     matchre COMMUNE_eluned_1 ^\.\.\.wait|^Sorry
     matchre ELUNED_RETURN ^You grind some dirt in your fist\, allowing the particles to slowly sprinkle to the ground\.|^You struggle
     matchre DUMP_DIRT ^You stop as you realize that you have attempted a commune too recently in the past\.|^You feel like you have completed this commune too recently\.|^You sense that you are as pure
     matchre DUMP_DIRT You feel you are not ready
     send commune eluned
     matchwait 20
     return
ELUNED_RETURN:
     pause 0.1
     if matchre("$righthand $lefthand", "%HolyWater") then gosub STOWIT %HolyWater
     return
COMMUNE_truffenyi:
     action (communes) on
     if (%truffenyi = 0) then return
     if ($UC_truffenyi = 1) then return
     echo ###################
     echo ** TRUFFENYI COMMUNE
     echo ###################
     pause 0.1
     pause 0.1
     if (!matchre("$righthand", "Empty") && !matchre("$lefthand", "Empty")) then gosub STOWIT $lefthand
     pause 0.2
     if (!matchre("$righthand", "Empty") && matchre("$lefthand", "Empty")) then gosub SWAP
     pause 0.2
     gosub GET dirt
     pause 0.1
     if !matchre("$righthand", "dirt") && !matchre("$lefthand", "dirt") then gosub GET grass
     pause 0.1
     # if !matchre("$righthand", "grass") && !matchre("$lefthand", "grass") then
          # {
               # gosub RETREAT
               # gosub FORAGE grass
               # pause 0.3
          # }
     if !matchre("$righthand", "dirt") && !matchre("$lefthand", "dirt") then
          {
               gosub RETREAT
               gosub FORAGE dirt
               pause 0.3
          }
     if matchre("$righthand $lefthand", "dirt") then goto COMMUNE_truffenyi_1
     if matchre("$righthand $lefthand", "grass") then goto COMMUNE_truffenyi_1
     gosub GET primer
     pause 0.1
     if matchre("$righthand $lefthand", "(ox|raven|unicorn|wolf|panther|boar|cobra|dolphin|ram|cat|wren|lion|scorpion|welkin|cow|nightingale|wolverine|magpie|snake|albatross|donkey|dove|phoenix|mongoose|jackal|raccoon|adder|shrew|shrike|centaur|weasel|viper|shark|coyote|spider|heron|goshawk|vulture) primer") then goto COMMUNE_truffenyi_1
     if matchre("$righthand $lefthand", "primer") then gosub STOWIT primer
     gosub GET bead
     pause 0.1
     if matchre("$righthand $lefthand", "bead") then goto COMMUNE_truffenyi_1
     gosub GET tobacco
     pause 0.1
     if matchre("$righthand $lefthand", "tobacco") then goto COMMUNE_truffenyi_1
     gosub GET cigar
     if matchre("$righthand $lefthand", "cigar") then goto COMMUNE_truffenyi_1
     echo ####################################
     echo ** NO ITEMS FOR TRUFFENYI COMMUNE!
     echo ####################################
     return
COMMUNE_truffenyi_1:
     pause 0.1
     matchre COMMUNE_truffenyi_1 ^\.\.\.wait|^Sorry
     matchre COMMUNE_truffenyi You must be holding your favor offering or orb in your right hand
     matchre DUMP_DIRT ^You stop as you realize that you have attempted a commune too recently in the past\.|^You feel like you have completed this commune too recently\.|^You sense that you are as pure|^You feel you are not ready
     matchre DUMP_DIRT The power of Truffenyi has answered your prayer.
     send commune Truffenyi
     matchwait 20
     goto DUMP_DIRT
COMMUNE_meraud:
     action (communes) on
     if (%meraud = 0) then return
     if ($UC_meraud = 1) then return
     echo ##################
     echo ** MERAUD COMMUNE
     echo ##################
     gosub stowing
     gosub GET %HolyWater
     pause 0.5
     pause 0.1
     gosub SPRINKLE $charactername
     pause 0.5
     gosub STOWIT %HolyWater
     if (%HolyWaterStock = 0) then return
     pause 0.5
     gosub LIGHT_IT
     gosub WAVE_INCENSE $charactername
     pause 0.5
     put commune meraud
     pause 0.5
     pause 0.5
     if ($standing = 0) then gosub STAND
     gosub SNUFF_INCENSE
     put #var UC_LastCommune $gametime
     gosub stowing
     gosub CLEAR_MATCHTABLE
     return

OUT_OF_INCENSE:
     echo *** Out of Incense!
     var HaveIncense 0
     var meraud 0
     gosub stowing
     return
## Misc Stuff #################################
CHECK_RECEPTACLE:
     gosub CLEAR_MATCHTABLE
     pause 0.1
     pause 0.1
     matchre CHECK_RECEPTACLE ^\.\.\.wait|^Sorry
     matchre DUMP_RECEPTACLE ^There is only one
     matchre FILL_RECEPTACLE ^I could not find|^There is nothing|^There is only one
     matchre FILL_RECEPTACLE ^There (is|are) (one|two|three|four|five|six|seven|eight|nine|ten|eleven|twelve|thirteen|fourteen|fifteen|sixteen|seventeen) parts?
     matchre FILL_RECEPTACLE ^There (is|are) (eighteen|nineteen|twenty|twenty-one|twenty-two|twenty-three|twenty-four|twenty one|twenty two|twenty three|twenty four|twenty-five|twenty five) parts?
     matchre FILL_RECEPTACLE ^There (is|are) (twenty-six|twenty six|twenty-seven|twenty seven|twenty-eight|twenty eight|twenty-nine|twenty nine) parts?
     matchre HOLYWATER_GOOD ^There are|^You count
     put count water in my %HolyWater
     matchwait 20
     return
DUMP_RECEPTACLE:
     pause 0.2
     put get water from my %HolyWater
     pause 0.5
     put drop my water
     pause 0.3
     goto CHECK_RECEPTACLE
HOLYWATER_GOOD:
     var HolyWaterStock 1
     echo
     echo *** Holy Water good!
     echo
     return
FILL_RECEPTACLE:
     pause 0.1
     pause 0.1
     send commune
     wait
     pause 0.2
     if ((%eluned = 0) && !matchre("$zoneid", "\b(1|4|7|8|30|40|42|66|67|69|90|99|116|123|127|126)\b")) then
          {
               echo *** You do not have the Eluned Commune
               echo *** And are not in a recognized area to restock holy water
               return
          }
     echo
     echo #################
     echo *** RESTOCKING HOLY WATER!
     echo #################
     echo
     if ((%eluned = 1) && ($devotion > 3)) then
          {
               gosub stowing
               gosub COMMUNE_eluned
               return
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE temple
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "127") then gosub AUTOMOVE hib
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "116") then
          {
               gosub AUTOMOVE 60
               var source pond
               var water water
               goto GET_HOLYWATER
          }
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "67") then
          {
               gosub AUTOMOVE 420
               var source fountain
               var water water
               goto GET_HOLYWATER
          }
     if ("$zoneid" = "7") then gosub AUTOMOVE crossing
     if ("$zoneid" = "8") then gosub AUTOMOVE crossing
     if ("$zoneid" = "4") then gosub AUTOMOVE crossing
     if ("$zoneid" = "1") then gosub AUTOMOVE temple
     pause 0.1
     if ("$zoneid" = "2a") then
          {
               put n
               pause 0.5
               pause 0.5
               gosub AUTOMOVE holy water
               var source basin
               var water water
               goto GET_HOLYWATER
          }
     if matchre("$zoneid", "(32|31|33)") then gosub AUTOMOVE river
     if ("$zoneid" = "30") then
          {
               gosub AUTOMOVE 126
               var source pool
               var water water
               goto GET_HOLYWATER
          }
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     pause 0.2
     if ("$zoneid" = "42") then
          {
               gosub AUTOMOVE 248
               var source fountain
               var water water
               goto GET_HOLYWATER
          }
####### NON HOLY WATER
     if ("$zoneid" = "99") then
          {
               gosub AUTOMOVE 196
               var source stream
               var water water
               goto GET_HOLYWATER
          }
     if ("$zoneid" = "90") then
          {
               gosub AUTOMOVE 342
               var source brook
               var water water
               goto GET_HOLYWATER
          }
     if ("$zoneid" = "47") then
          {
               gosub AUTOMOVE 438
               var source river
               var water water
               goto GET_HOLYWATER
          }
     if ("$zoneid" = "116") then
          {
               gosub AUTOMOVE serenity
               var source pool
               var water water
               goto GET_HOLYWATER
          }
     if matchre("$zoneid", "\b(63|62|60|58)\b") then gosub AUTOMOVE leth
     if ("$zoneid" = "61") then
          {
               gosub AUTOMOVE pool
               var source pool
               var water water
               goto GET_HOLYWATER
          }
     if ("$zoneid" = "2a") then gosub AUTOMOVE cross
     if ("$zoneid" = "2a") then gosub AUTOMOVE cross
     return
GET_HOLYWATER:
     pause 0.2
     gosub GET my %HolyWater
     pause 0.3
     put pour %HolyWater
     pause 0.5
     pause 0.4
     if matchre("$zoneid", "\b(40|47|90|99|116)\b") then goto FILL_WATER_NULL
FILL_WATER:
     pause 0.001
     matchre FILL_WATER ^You fill
     matchre FILL_DONE ^There is no|^I could not|^What were|^But there is|^The water is
     put fill my %HolyWater with %water in %source
     matchwait 12
     goto FILL_DONE
FILL_WATER_NULL:
     pause 0.001
     matchre FILL_WATER_NULL ^You fill
     matchre FILL_DONE ^There is no|^I could not|^What were|^But there is|^The water is
     put fill my %HolyWater with %water
     matchwait 12
     goto FILL_DONE
FILL_DONE:
     var blessloop 0
FILL_DONE_1:
     pause 0.1
     if ("$zoneid" = "2a") then gosub AUTOMOVE cross
     if ("$zoneid" = "40") then
          {
               put go trail
               pause 0.5
          }
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     matchre BLESS_WATER some water
     matchre BLESS_RECEPTACLE_DONE you see some holy water\.
     put look in my %HolyWater
     matchwait 2
     goto BLESS_RECEPTACLE
BLESS_WATER:
     var blessit 1
BLESS_RECEPTACLE:
     math blessloop add 1
     pause 0.1
     if (matchre("$zoneid", "\b(42|47|90|99|116)\b") || (%blessit = 1)) then
          {
               if (%Playing = 1) then gosub STOP_PLAY
               echo *** Blessing our unholy Water! ****
               put prep bless 12
               pause 19
               put cast my water
               pause 0.2
               if (%blessloop > 3) then goto BLESS_RECEPTACLE_DONE
               goto FILL_DONE_1
          }
BLESS_RECEPTACLE_DONE:
     var HolyWaterStock 1
     gosub stowing
     unvar blessloop
     unvar blessit
     return
PLANT_SIRESE:
     var sireseloop 0
     pause 0.1
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.2
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     if ("$zoneid" = "7") then gosub AUTOMOVE sirese
     if ("$zoneid" = "7") then gosub AUTOMOVE sirese
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE sirese
     if ("$zoneid" = "66") then gosub AUTOMOVE sirese
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "42") then gosub AUTOMOVE sirese
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "33") then gosub AUTOMOVE river
     if ("$zoneid" = "30") then gosub AUTOMOVE sirese
     if ("$zoneid" = "90") then gosub AUTOMOVE sirese
     if ("$zoneid" = "99") then gosub AUTOMOVE sirese
     if ("$zoneid" = "127") then gosub AUTOMOVE sirese
     gosub GATHER_SIRESE
     pause 0.1
     if ("$zoneid" = "7") then gosub AUTOMOVE 340
     if ("$zoneid" = "30") then gosub AUTOMOVE 204
     if ("$zoneid" = "30") then gosub AUTOMOVE N gate
     if ("$zoneid" = "32") then gosub AUTOMOVE 5
     if ("$zoneid" = "42") then gosub AUTOMOVE 301
     if ("$zoneid" = "66") then gosub AUTOMOVE 15
     if ("$zoneid" = "99") then gosub AUTOMOVE 283
     pause 0.5
     pause 0.3
     matchre PLANT_SIRESE_2 ^You carefully dig a hole and cover your seed gently\.
     send plant seed
     matchwait 15
PLANT_SIRESE_2:
     pause 0.2
     gosub GET my %HolyWater
     gosub SPRINKLE room
     gosub STOW my %HolyWater
     gosub stowing
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     if ("$zoneid" = "32") then gosub AUTOMOVE river
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     return
GATHER_SIRESE:
     pause 0.1
     math sireseloop add 1
     if (%sireseloop > 5) then return
     if matchre("$righthand $lefthand", "seed") then RETURN
     if (%Playing = 1) then gosub STOP_PLAY
     if ("$zoneid" = "1") then gosub AUTOMOVE ne gate
     if (("$zoneid" = "7") && ($roomid != 341)) then gosub AUTOMOVE sirese
     pause 0.2
     matchre GATHER_SIRESE ^\.\.\.wait|^Sorry|^You come up empty handed\.
     matchre RETURN ^You find a .+ seed and carefully collect it\.|This is not a good time to do this\.
     send gather seed
     matchwait 20
     goto GATHER_SIRESE
PRAY_BADGE:
     if !matchre("$lefthand", "Empty") then gosub STOW $UC_lefthhandnoun
     pause 0.2
     gosub GET my pilgrim badge
     pause 0.2
     matchre PRAY_BADGE_2 you sense the eyes of the gods upon you\.|^Roundtime\:|^You think really hard|Quietly touching your lips
     send pray my pilgrim badge
     matchwait 20
PRAY_BADGE_2:
     pause 0.5
     put WEAR my badge
     wait
     pause 0.5
     gosub stowing
     return
SPRINKLE:
     var sprinkle $1
SPRINKLE_1:
     pause 0.5
     action echo ][ ERROR! Out of Holy Water or using wrong receptacle. when ^Sprinkle that\?  I don't think so\.
     matchre SPRINKLE_1 ^\.\.\.wait|^Sorry
     matchre HOLY_WATER_OUT ^Sprinkle that\?  I don't think so\.
     matchre RETURN ^You sprinkle yourself with some holy water\.
     matchre RETURN ^You sprinkle some holy water over
     send sprinkle %HolyWater on %sprinkle
     matchwait 20
     return
HOLY_WATER_OUT:
     var HolyWaterStock 0
     var meraud 0
     return
TITHE:
     var kronar kronar
     if !matchre("$zoneid", "\b(1|42|30|67|90|99)\b") then return
     if ("$zoneid" = "1") then var kronar kronar
     if ("$zoneid" = "67") then var kronar dokora
     if ("$zoneid" = "30") then var kronar lirum
     if ("$zoneid" = "42") then var kronar lirum
     if ("$zoneid" = "90") then var kronar lirum
     if ("$zoneid" = "99") then var kronar lirum
     pause 0.2
     if ("$zoneid" = "67") then
          {
               gosub AUTOMOVE 57
               gosub AUTOMOVE alms
          }
     if ("$zoneid" = "99") then gosub AUTOMOVE 196
     if ("$zoneid" = "42") then gosub AUTOMOVE tithe
     if !matchre("$zoneid", "\b(67|42)\b") then gosub AUTOMOVE alms
     pause 0.3
     matchre RETURN ^You feel that your gods have smiled upon you|you have completed this ritual too recently in the past\.|^You sense that you are as pure|^But you
     if ("$zoneid" = "42") then put put 5 silver %kronar in box
     if ("$zoneid" != "42") then put put 5 silver %kronar in alms
     matchwait 4
     return

###### FIND DIRT
FIND_DIRT:
     var dirtloop 0
     echo ######################
     echo *** FINDING SOME DIRT!!
     echo ######################
     pause 0.1
     gosub stowing
     if (("$zoneid" = "150") && ($roomid != 45)) then
          {
               if ($Athletics.Ranks > 45) then gosub AUTOMOVE 45
               if (($Athletics.Ranks < 46) && (%Teleport = 0)) then gosub LEAVE_SEACAVES
               if (($Athletics.Ranks > 46) && (%Teleport = 1)) then gosub AUTOMOVE 45
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE willow
     if ("$zoneid" = "116") then gosub AUTOMOVE boar
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     pause 0.1
     if ("$zoneid" = "30") && ($roomid != 239) then gosub AUTOMOVE 239
     if ("$zoneid" = "42") && ($roomid != 3) then gosub AUTOMOVE 3
     if ("$zoneid" = "47") then gosub AUTOMOVE bucket
     if ("$zoneid" = "61") && ($roomid != 17) then gosub AUTOMOVE 17
     if ("$zoneid" = "66") then gosub AUTOMOVE 638
     if ("$zoneid" = "69") && ($roomid != 11) then gosub AUTOMOVE 11
     if ("$zoneid" = "90") then gosub AUTOMOVE green
     if ("$zoneid" = "99") && ($roomid != 214) then gosub AUTOMOVE 214
     if ("$zoneid" = "107") && ($roomid != 171) then gosub AUTOMOVE 171
     if ("$zoneid" = "108") && ($roomid != 154) then gosub AUTOMOVE 154
     if ("$zoneid" = "112") && ($roomid != 12) then gosub AUTOMOVE 12
     if ("$zoneid" = "126") && ($roomid != 40) then gosub AUTOMOVE 40
DIRT_LOOP:
     pause 0.1
     if ($Outdoorsmanship.Ranks < 40) then put forage dirt
     else put collect dirt
     pause 2
     pause
DIRT_LOOP_1:
     math dirtloop add 1
     if (%dirtloop > 7) then goto DIRT_DONE
     pause 0.001
     if (($Outdoorsmanship.Ranks >= 40) && !matchre("$roomobjs", "dirt")) then
          {
               send collect dirt
               pause 2
               pause 0.5
          }
     if ((($Outdoorsmanship.Ranks >= 40) && !matchre("$roomobjs", "dirt")) || ($Outdoorsmanship.Ranks < 40)) then
          {
               send forage dirt
               pause 2
               pause 0.5
          }
     gosub GET dirt
     pause 0.3
     if (!matchre("$righthand", "dirt") && !matchre("$lefthand", "dirt")) then goto DIRT_NONE
     var HaveDirt 1
     if !matchre("$UC_Container.Dirt", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then gosub PUT put dirt in my %Container.Dirt
     pause 0.1
     gosub GLANCE
     pause 0.1
     pause 0.1
     if matchre("$righthand $lefthand", "dirt") then gosub STOWIT my dirt
     pause 0.1
     if (($UC_F2P = 1) && (%dirtloop > 1)) then goto DIRT_DONE
     goto DIRT_LOOP_1
DIRT_NONE:
     echo ############################
     echo *** NO DIRT FOUND AT THIS LOCATION
     echo *** SEND ME YOUR LOCATION
     echo ############################
     put #echo >Log #ffff66 *** NO DIRT FOUND AT Zone$zoneid Room$roomid
     return
DIRT_DONE:
     unvar dirtloop
     echo #############
     echo *** RESTOCKED DIRT!
     echo #############
     if matchre("$righthand $lefthand", "dirt") then put drop dirt
     if matchre("$righthand $lefthand", "dirt") then put drop dirt
     pause 0.1
     pause 0.1
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "31") then gosub AUTOMOVE river
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     return
#########################################################
## PILGRIM'S BADGES
BADGE_IT:
BADGE.IT:
     var crossingBadge 0
     var therenBadge 0
     var shardBadge 0
     var rathaBadge 0
     var riverBadge 0
     var hibBadge 0
     var aesryBadge 0
     action (badge) var crossingBadge 1 when at Tiger Clan's church\.
     action (badge) var therenBadge 1 when in Theren Keep\.
     action (badge) var shardBadge 1 when altar at Horse Clan\.
     action (badge) var rathaBadge 1 when Ratha\.
     action (badge) var aesryBadge 1 when Aesry Surlaenis'a\.
     action (badge) var riverBadge 1 when in Riverhaven\.
     action (badge) var hibBadge 1 when boulder beneath a ravine\.
     action (badge) on
     pause 0.1
     gosub GET badge
     pause 0.5
     gosub PUT remove my badge
     pause 0.1
     if !matchre("$righthand $lefthand", "badge") then gosub GET badge from my watery portal
     pause 0.4
     put look my badge
     pause 0.5
     pause 0.5
     pause 0.2
     action (badge) off
     if !matchre("$zoneid","\b(1|30|42|67|90|116)\b") then goto NO_ALTAR_LOC
     if !matchre("$righthand $lefthand", "pilgrim's badge") then return
     if ((%crossingBadge = 0) && ("$zoneid" = "1")) then goto BADGE_XING
     if ((%therenBadge = 0) && ("$zoneid" = "42")) then goto BADGE_THEREN
     if ((%shardBadge = 0) && ("$zoneid" = "67")) then goto BADGE_SHARD
     if ((%shardBadge = 0) && ("$zoneid" = "66")) then goto BADGE_SHARD
     if ((%rathaBadge = 0) && ("$zoneid" = "90")) then goto BADGE_RATHA
     if ((%aesryBadge = 0) && ("$zoneid" = "99")) then goto BADGE_AESRY
     if ((%riverBadge = 0) && ("$zoneid" = "30")) then goto BADGE_HAVEN
     if ((%hibBadge = 0) && ("$zoneid" = "116")) then goto BADGE_HIB
     if ((%hibBadge = 0) && ("$zoneid" = "127")) then goto BADGE_HIB
     echo ############################################
     echo *** Gratz! You already have all the altars for this area!
     echo ############################################
     gosub WEAR badge
     goto BADGE_RETURN
NO_ALTAR_LOC:
     echo ############################################
     echo *** UNSUPPORTED AREA FOR ALTARS OR UNKNOWN LOCATION
     echo ############################################
     gosub WEAR badge
     goto BADGE_RETURN
BADGE_XING:
BADGE.XING:
     gosub AUTOMOVE tamsin
     pause 0.5
     gosub PUT push image with badge
     pause 0.5
     gosub AUTOMOVE temple
     gosub AUTOMOVE sundering
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE crossing
     gosub AUTOMOVE kertigen
     pause 0.5
     gosub PUT push statue with badge
     pause 0.5
     gosub AUTOMOVE chapel
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE ushnish
     pause 0.5
     gosub PUT push image with badge
     pause 0.5
     gosub AUTOMOVE w gate
     gosub AUTOMOVE tiger
     gosub AUTOMOVE church
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE crossing
     gosub AUTOMOVE crossing
     gosub AUTOMOVE NTR
     gosub AUTOMOVE handfast
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE glythtide
     pause 0.5
     gosub PUT push glyth with badge
     pause 0.5
     gosub AUTOMOVE damaris
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE misen
     gosub AUTOMOVE misen
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE NTR
     gosub AUTOMOVE cross
     pause 0.5
     gosub WEAR badge
     goto BADGE_RETURN
BADGE_THEREN:
     gosub AUTOMOVE chapel
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE gate
     pause 0.2
     gosub AUTOMOVE kuniyo
     pause 0.2
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE 137
     pause 0.2
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE theren
     pause 0.3
     ## TO KEEP ALTAR
     # gosub AUTOMOVE 102
     # gosub AUTOMOVE moat
     # gosub AUTOMOVE 116
     # gosub AUTOMOVE 160
     # gosub AUTOMOVE 161
     # gosub AUTOMOVE 137
     # gosub AUTOMOVE chadatru
     # pause 0.5
     # gosub PUT push altar with badge
     # pause 0.5
     # gosub AUTOMOVE 69
     # send jump moat
     # pause 15
     # gosub standing
     # gosub AUTOMOVE 1
     # pause 0.5
     gosub WEAR badge
     goto BADGE_RETURN
BADGE_SHARD:
     gosub AUTOMOVE east
     gosub AUTOMOVE dragon
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE 146
     pause 0.5
     gosub PUT push disk with badge
     pause 0.5
     gosub AUTOMOVE harawep
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE chapel
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE east
     pause 0.5
     gosub AUTOMOVE depart
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE aldauth
     pause 0.58
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE south
     if ($zoneid = 67) then gosub AUTOMOVE south
     pause
     gosub AUTOMOVE plinth
     if ($roomid != 107) then gosub AUTOMOVE 107
     if ($roomid != 107) then gosub AUTOMOVE 107
     gosub PUT push plinth with badge
     pause 0.5
     gosub AUTOMOVE altar
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE shard
     pause 0.5
     if ($zoneid = 67) then gosub AUTOMOVE shard
     if ($zoneid = 67) then gosub AUTOMOVE shard
     gosub AUTOMOVE east
     gosub AUTOMOVE west
     pause 0.5
     if ($Athletics > 500) then
          {
               gosub AUTOMOVE keren
               pause 0.4
               gosub PUT push altar with badge
               pause 0.5
          }
     gosub AUTOMOVE kuniyo
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE 205
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE hib
     pause 0.2
     gosub AUTOMOVE altar
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE crag
     gosub AUTOMOVE north
     gosub AUTOMOVE east
     pause 0.5
     gosub WEAR badge
     goto BADGE_RETURN
BADGE_HIB:
     if ($zoneid = 127) then gosub AUTOMOVE hib
     if ($zoneid = 126) then
          {
               gosub AUTOMOVE hib
               put east
               pause 0.3
          }
     gosub AUTOMOVE raven
     gosub AUTOMOVE 199
     gosub PUT push slab with badge
     pause 0.5
     gosub AUTOMOVE 9
     gosub PUT push statue with badge
     pause 0.5
     gosub AUTOMOVE hib
     # gosub AUTOMOVE altar
     # gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE temple
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE boar
     gosub AUTOMOVE tabernacle
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE 10
     gosub AUTOMOVE altar
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE boar
     if ($zoneid != 127) then gosub AUTOMOVE boar
     gosub AUTOMOVE 216
     pause 0.5
     gosub PUT push statue with badge
     pause 0.5
     gosub AUTOMOVE 554
     pause 0.5
     gosub PUT push skeleton with badge
     pause 0.5
     gosub WEAR badge
     pause 0.5
     gosub AUTOMOVE asketi
     pause 0.5
     if ($roomid != 383) then gosub AUTOMOVE 383
     pause 0.5
     if ($roomid != 383) then gosub AUTOMOVE 383
     pause 0.5
     put remove my badge
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE 502
     gosub PUT push statue with badge
     pause 0.5
     gosub WEAR badge
     gosub AUTOMOVE hib
     if ($zoneid = 127) then gosub AUTOMOVE hib
     pause 0.5
     if ($zoneid = 127) then gosub AUTOMOVE hib
     pause 0.2
     if ($zoneid = 127) then gosub AUTOMOVE hib
     if ($zoneid = 126) then gosub AUTOMOVE hib
     if ($zoneid = 127) then gosub AUTOMOVE hib
     if ($zoneid = 126) then gosub AUTOMOVE hib
     goto BADGE_RETURN
BADGE_AESRY:
##### GO TO HALASA TEMPLE
## BOARD CURRACH AT DOCK / UNTIE / ROW DOCK / TIE CURRACK TO ROCK / GO ROCK
     gosub AUTOMOVE 118
     put untie currach
     pause 0.5
     put go currach
     pause 0.9


     goto BADGE_RETURN
BADGE_RATHA:
     gosub AUTOMOVE kertigen
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE everild
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE faenella
     pause 0.5
     gosub PUT push statue with badge
     pause 0.5
     gosub AUTOMOVE damaris
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE chadatru
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE glythtide
     pause 0.5
     gosub PUT push statue with badge
     pause 0.5
     gosub AUTOMOVE dark aspect
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE hodierna
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE phelim
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE urrem
     pause 0.5
     gosub PUT push statue with badge
     pause 0.5
     gosub WEAR badge
     goto BADGE_RETURN
BADGE_HAVEN:
     gosub AUTOMOVE harawep
     pause 0.5
     gosub PUT push statue with badge
     pause 0.5
     gosub AUTOMOVE divyaush
     pause 0.5
     gosub PUT push altar with badge
     pause 0.5
     gosub AUTOMOVE e gate
     gosub AUTOMOVE thicket
     pause 0.5
     gosub PUT push sliver with badge
     pause 0.5
     gosub AUTOMOVE riverhaven
     gosub WEAR badge
     goto BADGE_RETURN
BADGE_RETURN:
     unvar crossingBadge
     unvar therenBadge
     unvar shardBadge
     unvar rathaBadge
     unvar riverBadge
     unvar hibBadge
     return
#############################################################
### TEACHING
#############################################################
TEACHING:
     # debug 5
     var ScanCount 0
     var skill %TEACH.SKILL
     var Character %FRIENDS
     var AllFriends %FRIENDS|%ALLCHARACTERS
     eval AllFriends replacere("%AllFriends", "\|+" "|")
     eval AllFriends replacere("%AllFriends", "^\|" "")|
     gosub RemoveDuplicatesFromArray %AllFriends %Character
     eval FriendCount count("%Character", "|")
     math TeachingLoop add 1
     pause 0.001
     if (%TeachingLoop > 2) then var TeachingLoop 1
     if (%Teaching = 1) then send stop teach
     pause 0.3
     pause 0.2
TEACHING_1:
     if (%TeachingLoop < 2) then var skill %TEACH.SKILL
     if (%TeachingLoop > 1) then var skill %TEACH.SKILL.2
     pause 0.001
     if ("$roomplayers" = "") then return
     if matchre("$roomplayers", "%Character(%ScanCount)") then
          {
               put teach %skill to %Character(%ScanCount)
               pause 0.4
               pause 0.1
          }
     math ScanCount add 1
     if ((%ScanCount > %FriendCount) || (%ScanCount > 22)) then
          {
               unvar ScanCount
               unvar skill
               unvar Character
               unvar FriendCount
               return
          }
     goto TEACHING_1
###########################################################################################
### MOVEMENT ROUTINES
###########################################################################################
LEAVE_BANK:
     ### LEAVING BANK / EXIT BANK / LEAVE BANK
     if ("$zoneid" = "1") then gosub AUTOMOVE 38
     if ("$zoneid" = "30") then gosub AUTOMOVE 52
     if ("$zoneid" = "35") then gosub AUTOMOVE 60
     if ("$zoneid" = "42") then gosub AUTOMOVE 40
     if ("$zoneid" = "47") then gosub AUTOMOVE 38
     if ("$zoneid" = "61") then gosub AUTOMOVE 19
     if ("$zoneid" = "62") then gosub AUTOMOVE leth
     if ("$zoneid" = "67") then gosub AUTOMOVE 81
     if ("$zoneid" = "90") then gosub AUTOMOVE 48
     if ("$zoneid" = "99") then gosub AUTOMOVE 92
     if ("$zoneid" = "106") then gosub AUTOMOVE 88
     if ("$zoneid" = "107") then gosub AUTOMOVE 58
     if ("$zoneid" = "108") then gosub AUTOMOVE well
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "124") then gosub AUTOMOVE hib
     if ("$zoneid" = "112") then gosub AUTOMOVE 27
     if ("$zoneid" = "116") then gosub AUTOMOVE 14
     if ("$zoneid" = "150") then gosub AUTOMOVE 85
     pause 0.001
     if (("$zoneid" = "1") && ("$roomid" != "38")) then gosub AUTOMOVE 38
     if (("$zoneid" = "30") && ("$roomid" != "52")) then gosub AUTOMOVE 52
     if (("$zoneid" = "35") && ("$roomid" != "60")) then gosub AUTOMOVE 60
     if (("$zoneid" = "42") && ("$roomid" != "40")) then gosub AUTOMOVE 40
     if (("$zoneid" = "47") && ("$roomid" != "38")) then gosub AUTOMOVE 38
     if (("$zoneid" = "61") && ("$roomid" != "19")) then gosub AUTOMOVE 19
     if (("$zoneid" = "62") && ("$roomid" != "129")) then gosub AUTOMOVE leth
     if (("$zoneid" = "67") && ("$roomid" != "81")) then gosub AUTOMOVE 81
     if (("$zoneid" = "90") && ("$roomid" != "48")) then gosub AUTOMOVE 48
     if (("$zoneid" = "99") && ("$roomid" != "92")) then gosub AUTOMOVE 92
     if (("$zoneid" = "106") && ("$roomid" != "88")) then gosub AUTOMOVE 88
     if (("$zoneid" = "107") && ("$roomid" != "58")) then gosub AUTOMOVE 58
     if (("$zoneid" = "108") && ("$roomid" != "158")) then gosub AUTOMOVE well
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "124") then gosub AUTOMOVE hib
     if (("$zoneid" = "112") && ("$roomid" != "27")) then gosub AUTOMOVE 27
     if (("$zoneid" = "116") && ("$roomid" != "14")) then gosub AUTOMOVE 14
     if (("$zoneid" = "150") && ("$roomid" != "85")) then gosub AUTOMOVE 85
     return
#####################################
#  TF SEACAVES SUB
###################################
LEAVE_SEACAVE:
LEAVE_SEACAVES:
     action var Teleport 1 when ^Perhaps you should leave the area the same way you arrived\.
     action var Teleport 0 when ^This particular .+ didn't bring you here
     if ($standing = 0) then gosub STAND
     # if matchre("$guild", "%MAGICUSER") then gosub RELEASE cyclic
     if ("$guild" = "Necromancer") then
          {
               if (($spellEOTB = 0) || ($invisible = 0)) then
                    {
                         put prep EOTB 5
                         pause 5
                    }
          }
     if (("$zoneid" = "150") && ($roomid != 85)) then gosub AUTOMOVE 85
     if (matchre("%JumpJewelry", "(?i)(ON|1|YES)") && ("$zoneid" = "150") && (%COMBAT.ZONE != 150) && (%Teleport = 1)) then
          {
               echo ###################################
               echo * TELEPORTING BACK TO COMBAT ZONE
               echo ###################################
               pause 0.5
               pause 0.1
               send pull my %JewerlyVerb
               pause 2
               pause 0.5
               send #mapper reset
               pause 0.5
               pause 0.2
               send look
               pause 0.5
               pause 0.2
               if (("$zoneid" = "150") && (%Teleport = 1)) then goto JJ_COOLDOWN
               var Teleport 0
               if ("$zoneid" = "0") then gosub RANDOMMOVE
          }
     if (("$zoneid" = "150") && ($roomid != 85)) then gosub AUTOMOVE 85
     pause 0.1
     if (("$zoneid" = "150") && ($roomid != 85)) then gosub AUTOMOVE 85
     pause 0.1
     if ("$zoneid" = "150") then put go portal
     wait
     pause 0.5
     put #mapper reset
     pause 0.2
     put look
     pause 0.3
     if (("$zoneid" = "150") && (%Teleport = 1)) then
          {
               echo #########################
               echo ** We teleported into FC
               echo ** Cannot take Portal out!
               echo #########################
               return
          }
      if ("$zoneid" = "150") then goto LEAVE_SEACAVE
     if ("$guild" = "Necromancer") && ("$preparedspell" != "None") then put cast
     pause 0.2
     if ("$guild" = "Necromancer") then
          {
               if ($spellEOTB = 0) then gosub NECRO_PREP
          }
     action remove ^Perhaps you should leave the area the same way you arrived\.
     action remove ^This particular .+ didn't bring you here
     return
TO_SEACAVE:
TO_SEACAVES:
     if ($standing = 0) then gosub STAND
     if ("$zoneid" = "150") then
          {
               echo *** ALREADY IN FC!
               return
          }
     if matchre("$zoneid","\b(14c|30a|31|32|33)\b") then gosub AUTOMOVE river
     if matchre("$zoneid","\b(14c|30a|31|32|33)\b") then gosub AUTOMOVE river
     if matchre("$zoneid","\b(90a|92|95)\b") then gosub AUTOMOVE ratha
     if matchre("$zoneid","\b(90a|92|95)\b") then gosub AUTOMOVE ratha
     if matchre("$zoneid","\b(98a|98)\b") then gosub AUTOMOVE aesry
     if matchre("$zoneid","\b(98a|98)\b") then gosub AUTOMOVE aesry
     if ("$zoneid" = "34") then
          {
               put .travel lang
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "127") then gosub AUTOMOVE south
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     if ("$zoneid" = "123") then gosub AUTOMOVE hib
     if ("$zoneid" = "112") then gosub AUTOMOVE leth
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "42") then gosub AUTOMOVE gate
     pause 0.001
     pause 0.1
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     pause 0.1
     gosub AUTOMOVE portal
     pause 0.4
     if ($invisible = 1) then gosub STOP_INVIS
     if ($invisible = 1) then gosub STOP_INVIS
     pause 0.2
     pause 0.1
     send go meeting portal
     wait
     pause 0.2
     pause 0.5
     pause 0.2
     if ("$zoneid" != "150") then goto TO_SEACAVES
     return
JJ_COOLDOWN:
     echo *** Jump Jewelry on Cooldown...
     echo *** Waiting.....
     pause
     gosub COLLECT rock
     gosub COLLECT rock
     gosub KICKEM
     gosub COLLECT rock
     gosub COLLECT rock
     gosub KICKEM
     pause 0.2
     goto LEAVE_SEACAVES
##################################################
#### TRAVEL ROUTINE
TRAVEL:
     delay 0.00001
     action (moving) on
     var Moving 0
     var TravelLoop 0
     var Destination $0
     var automovefailCounter 0
     if ($hidden = 1) then gosub UNHIDE
     if ($standing = 0) then gosub STAND
     if ($roomid = 0) then gosub RANDOMMOVE
     if ("$roomid" = "%Destination") then return
TRAVEL_GO:
     if matchre("$scriptlist" , "travel\.cmd") then put #script abort travel
     math TravelLoop add 1
     pause 0.0001
     pause 0.0001
     if (%TravelLoop > 6) then goto TRAVEL_RETURN
     if ($webbed = 1) then waiteval ($webbed = 0)
     if ($stunned = 1) then waiteval ($stunned = 0)
     pause 0.0001
     matchre TRAVEL_GO ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre TRAVEL_GO ^You don\'t seem
     matchre TRAVEL_GO ^(?:AUTOMAPPER )?MOVE(?:MENT)? FAILED
     matchre TRAVEL_GO ^SHOP CLOSED(?:\!)?
     matchre TRAVEL_GO ^DESTINATION NOT FOUND
     matchre TRAVEL_RETURN ^YOU ARRIVED(?:\!)?
     put .travel %Destination
     matchwait 1200
TRAVEL_RETURN:
     return
#### AUTOMOVE
AUTOMOVE:
     # action var exit $1;var webtype $2;goto websarestupid when ^As you approach (?:an?|the)\b.*? ((?:[\w'-]+) [\w'-]+|[\w'-]+), you become tangled up in the.*? \b(metallic|spidersilk|phantasmal|dew-covered|shadowy nightweaver silk)\b webbing
     # action goto ABYSS_ESCAPE when ^With lightning speed, something large and arachnid bursts from below, dragging you into a web-filled, subterranean gloom!
     delay 0.00001
     action (moving) on
     var Moving 0
     var randomloop 0
     var Destination $0
     var automovefailCounter 0
     if ($hidden = 1) then gosub UNHIDE
     if ($standing = 0) then gosub AUTOMOVE_STAND
     if ($roomid = 0) then gosub RANDOMMOVE
     if ("$roomid" = "%Destination") then return
AUTOMOVE_GO:
     pause 0.00001
     matchre AUTOMOVE_FAILED ^(?:AUTOMAPPER )?MOVE(?:MENT)? FAILED
     matchre AUTOMOVE_RETURN ^YOU HAVE ARRIVED(?:\!)?
     matchre AUTOMOVE_RETURN ^SHOP CLOSED(?:\!)?
     matchre AUTOMOVE_FAIL_BAIL ^DESTINATION NOT FOUND
     matchre AUTOMOVE_FAILED ^You don\'t seem
     put #goto %Destination
     matchwait 4
     if (%Moving = 0) then goto AUTOMOVE_FAILED
     matchre AUTOMOVE_FAILED ^(?:AUTOMAPPER )?MOVE(?:MENT)? FAILED
     matchre AUTOMOVE_RETURN ^YOU HAVE ARRIVED(?:\!)?
     matchre AUTOMOVE_RETURN ^SHOP CLOSED(?:\!)?
     matchre AUTOMOVE_FAIL_BAIL ^DESTINATION NOT FOUND
     matchwait 160
     goto AUTOMOVE_FAILED
AUTOMOVE_STAND:
     pause 0.00001
     if ($standing = 1) then goto AUTOMOVE_RETURN
     matchre AUTOMOVE_STAND ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre AUTOMOVE_STAND ^Roundtime\:?|^\[Roundtime\:?|^\(Roundtime\:?|^\[Roundtime|^Roundtime
     matchre AUTOMOVE_STAND ^The weight of all your possessions prevents you from standing\.
     matchre AUTOMOVE_STAND ^You are still stunned\.
     matchre AUTOMOVE_RETURN ^You stand(?:\s*back)? up\.
     matchre AUTOMOVE_RETURN ^You are already standing
     send stand
     matchwait 20
     goto AUTOMOVE_STAND
AUTOMOVE_FAILED:
     pause 0.00001
     # put #script abort automapper
     pause 0.00001
     math automovefailCounter add 1
     if (%automovefailCounter > 3) then goto AUTOMOVE_FAIL_BAIL
     if (%automovefailCounter > 1) then send #mapper reset
     pause 0.1
     if ($roomid = 0) || (%automovefailCounter > 2) then gosub RANDOMMOVE
     goto AUTOMOVE_GO
AUTOMOVE_FAIL_BAIL:
     action (moving) off
     put #echo
     put #echo >Log Crimson *** AUTOMOVE FAILED. ***
     put #echo >Log Destination: %Destination
     put #echo Crimson *** AUTOMOVE FAILED.  ***
     put #echo Crimson Destination: %Destination
     put #echo
AUTOMOVE_RETURN:
     action (moving) off
     var automovefailCounter 0
     var randomloop 0
     pause 0.00001
     return
ABYSS_ESCAPE:
     echo *** OH SHIT
     goto INIT
################################
# STUPID ASS SPIDERWEBS 2019
################################
##### caught a trigger
WEBSARESTUPID:
     var webloop 0
     put #script pause all except ubercombat
     var cutter %Melee.Weapon
     pause 0.1
     gosub stowing
     if ("%webtype" = "metallic") then goto TINKER
     if ("%webtype" = "spidersilk") then goto CUT
     if ("%webtype" = "phantasmal") then goto LIGHT
     if ("%webtype" = "shadowy nightweaver silk") then goto LIGHT
     if ("%webtype" = "dew-covered") then goto FIRE_SUB
     goto UNKNOWN_WEB
##### Metallic Webbing
TINKER:
     if ($webbed = 1) then waiteval ($webbed = 0)
     if ($stunned = 1) then waiteval ($stunned = 0)
     math webloop add 1
     if (%webloop > 6) then goto NOTOOLS_ERROR
     if !matchre("$righthand $lefthand", "tools") then
          {
               matchre tinker ^\s*\.\.\.wait|^You are still stunned|^You get|^You are already holding|^You need a free hand|You can't do that
               put get my tools
               matchwait 3
               goto tinker
          }
     put adjust %exit with my tool
     pause 3
     gosub stowing
     var webloop 0
     goto RESUME_SPIDER
##### Spidersilk Webbing
CUT:
     if ($webbed = 1) then waiteval ($webbed = 0)
     if ($stunned = 1) then waiteval ($stunned = 0)
     math webloop add 1
     if (%webloop > 6) then goto NOTOOLS_ERROR
     if !matchre("$righthand $lefthand", "%cutter") then
          {
               matchre CUT ^\s*\.\.\.wait|^You are still stunned|^You get|^You are already holding|^You need a free hand|You can't do that
               put get my %cutter
               matchwait 3
               goto CUT
          }
     put cut %exit with my %cutter
     pause 3
     gosub stowing
     var webloop 0
     goto RESUME_SPIDER
##### LIGHT
LIGHT:
     if ($webbed = 1) then waiteval ($webbed = 0)
     if ($stunned = 1) then waiteval ($stunned = 0)
     math webloop add 1
     if (%webloop > 6) then goto NOTOOLS_ERROR
     if matchre("$guild", "(Thief|Barbarian)") then goto LANTERN
     if !matchre("$righthand $lefthand", "%lightsource") then
          {
          matchre light ^\s*\.\.\.wait|^You are still stunned|^You get|^You are already holding|^You need a free hand|You can't do that
          put get my %lightsource
          matchwait 3
          goto light
          }
     gosub CHARGE_LIGHT
     gosub FOCUS_LIGHT
     gosub RUB_LIGHT
     put wave my %lightsource at %exit
     pause 2
     gosub stowing
     var webloop 0
     goto RESUME_SPIDER

##### GAETHZEN gosubS
CHARGE_LIGHT:
     if ($webbed = 1) then waiteval ($webbed = 0)
     if ($stunned = 1) then waiteval ($stunned = 0)
     matchre FOCUS_LIGHT ^\s*\.\.\.wait|^You are still stunned|^You can't do that while
     matchre WEB_RETURN ^[\[ \(]?Roundtime.*[\] \)]?
     put charge my %lightsource 10
     matchwait 3
     goto CHARGE_LIGHT

FOCUS_LIGHT:
     if ($webbed = 1) then waiteval ($webbed = 0)
     if ($stunned = 1) then waiteval ($stunned = 0)
     matchre FOCUS_LIGHT ^\s*\.\.\.wait|^You are still stunned|^You can't do that while
     matchre WEB_RETURN ^[\[ \(]?Roundtime.*[\] \)]?|Your link .* is intact
     put focus my %lightsource
     matchwait 3
     goto FOCUS_LIGHT

RUB_LIGHT:
     if ($webbed = 1) then waiteval ($webbed = 0)
     if ($stunned = 1) then waiteval ($stunned = 0)
     matchre RUB_LIGHT ^\s*\.\.\.wait|^You are still stunned|^You can't do that while|^With a faint flicker.* extinguishes at your touch.
     matchre WEB_RETURN ^As you rub|^You rub
     put rub my %lightsource
     matchwait 3
     goto WEB_RETURN

##### fire
FIRE_SUB:
     var lighty torch
     if ($webbed = 1) then waiteval ($webbed = 0)
     if ($stunned = 1) then waiteval ($stunned = 0)
     if (%BurningTouch = 1) then goto BT_SUB
     gosub GET_CUTTER
     gosub GET_TORCH
     gosub LIGHT_LIGHTY
     pause 0.5
     put point my torch at %exit
     put wave my torch at %exit
     pause 2
     put snuff my torch
     pause
     put snuff my torch
     pause
     gosub stowing
     goto RESUME_SPIDER
BT_SUB:
     var lighty torch
     if ($webbed = 1) then waiteval ($webbed = 0)
     put prep c b t
     pause 2
     gosub GET_TORCH
     if !matchre("$righthand $lefthand", "torch") then goto FIRE_ERROR
     pause 0.5
     put gesture torch
     pause
     put point my torch at %exit
     put wave my torch at %exit
     pause 2
     put snuff my torch
     pause
     put snuff my torch
     pause
     gosub stowing
     goto RESUME_SPIDER
LANTERN:
     var lighty lantern
     if ($webbed = 1) then waiteval ($webbed = 0)
     gosub GET_TORCH
     gosub GET_FLINT
     gosub LIGHT_LIGHTY
     pause 0.5
     put point my %lighty at %exit
     put wave my %lighty at %exit
     pause 2
     put snuff my %lighty
     pause
     put snuff my %lighty
     pause
     gosub stowing
     goto RESUME_SPIDER

##### fire gosubs
GET_CUTTER:
     if ($webbed = 1) then waiteval ($webbed = 0)
     if ($stunned = 1) then waiteval ($stunned = 0)
     math webloop add 1
     if (%webloop > 6) then goto NOTOOLS_ERROR
     if !matchre("$righthand $lefthand", "%cutter") then
          {
          matchre GET_CUTTER ^\s*\.\.\.wait|^You are still stunned|^You need a free hand|You can't do that
          matchre WEB_RETURN ^You get|^You are already holding
          put get my %cutter
          matchwait 3
          goto GET_CUTTER
          }
GET_TORCH:
     if ($webbed = 1) then waiteval ($webbed = 0)
     if ($stunned = 1) then waiteval ($stunned = 0)
     math webloop add 1
     if (%webloop > 6) then goto NOTOOLS_ERROR
     if !matchre("$righthand $lefthand", "%lighty") then
     {
          matchre GET_TORCH ^\s*\.\.\.wait|^You are still stunned|^You need a free hand|You can't do that
          matchre WEB_RETURN ^You get|^You are already holding
          put get my %lighty
          matchwait 3
          goto GET_TORCH
     }
GET_FLINT:
     if ($webbed = 1) then waiteval ($webbed = 0)
     if ($stunned = 1) then waiteval ($stunned = 0)
     math webloop add 1
     if (%webloop > 6) then goto NOTOOLS_ERROR
     if !matchre("$righthand $lefthand", "%lighty") then goto FIRE_ERROR
     if !matchre("$righthand $lefthand", "flint") then
     {
          matchre GET_FLINT ^\s*\.\.\.wait|^You are still stunned|^You need a free hand|You can't do that
          matchre WEB_RETURN ^You get|^You are already holding
          put get my flint
          matchwait 3
          goto GET_FLINT
     }
LIGHT_LIGHTY:
     matchre LIGHT_LIGHTY ^\s*\.\.\.wait|^You are still stunned|You can't do that
     matchre WEB_RETURN ^[\[ \(]?Roundtime.*[\] \)]?
     put light my %lighty with my flint
     matchwait 3
     goto WEB_RETURN

WEB_RETURN:
     var webloop 0
     return

FIRE_ERROR:
     echo ###################################################
     echo *** FIRE ERROR!!!!!
     echo ** MISSING EITHER LANTERN/TORCH FLINT, OR CUTTER!
     echo ** PICKUP A LANTERN (IF THIEF/BARB) TORCHES AND SOME FLINT!!
     echo ** Good Luck....
     echo ###################################################
     put #echo >Log #ff0000 ** NO LANTERN/TORCH/FLINT TO BREAK WEB! - PICKUP SUPPLIES!
     pause
     gosub stowing
     put #script resume
     put #script resume all
     pause 0.5
     pause 0.2
     goto %LAST
NOTOOLS_ERROR:
     echo ###################################################
     echo *** WEB RECOVERY ERROR!!
     echo ** MISSING EITHER GAEZTHEN, TORCH, FLINT, OR CUTTER!
     echo ** PICKUP A GAEZTHEN, TORCHES AND SOME FLINT!!
     echo ** Good Luck....
     echo ###################################################
     put #echo >Log #ff0000 ** NO GAEZTHEN/CUTTER/TORCH/FLINT TO BREAK WEBS! - PICKUP SUPPLIES!
     pause
     gosub stowing
     put #script resume
     put #script resume all
     pause 0.5
     pause 0.2
     goto %LAST
UNKNOWN_WEB:
     echo
     echo *** UNKNOWN WEB TYPE????
     echo
     gosub stowing
     put #script resume
     put #script resume all
     pause 0.5
     pause 0.2
     goto %LAST
RESUME_SPIDER:
     echo
     echo *** CLEARED FUCKHEAD SPIDER WEB
     echo *** RESUMING...
     gosub stowing
     put #script resume
     put #script resume all
     pause 0.5
     pause 0.2
     goto %LAST
################################
# MOVE SINGLE
################################
MOVE:
     delay 0.0001
     var Direction $0
     var movefailCounter 0
     var moveRetreat 0
     var randomloop 0
     var lastmoved %Direction
MOVE_RESUME:
     matchre MOVE_RETRY ^\.\.\.wait|^Sorry\, you may only type|^Please wait\.|You are still stunned\.
     matchre MOVE_RETURN_CHECK ^You can't (swim|move|climb) in that direction\.
     matchre MOVE_RESUME ^You make your way up the .*\.\s*Partway up\, you make the mistake of looking down\.\s*Struck by vertigo\, you cling to the .* for a few moments\, then slowly climb back down\.
     matchre MOVE_RESUME ^You pick your way up the .*\, but reach a point where your footing is questionable\.\s*Reluctantly\, you climb back down\.
     matchre MOVE_RESUME ^You approach the .*\, but the steepness is intimidating\.
     matchre MOVE_RESUME ^You struggle
     matchre MOVE_RESUME ^You blunder
     matchre MOVE_RESUME ^You slap
     matchre MOVE_RESUME ^You work
     matchre MOVE_RESUME make much headway
     matchre MOVE_RESUME ^You flounder around in the water\.
     matchre MOVE_RETREAT ^You are engaged to .*\!
     matchre MOVE_RETREAT ^You can't do that while engaged\!
     matchre MOVE_STAND ^You start up the .*\, but slip after a few feet and fall to the ground\!\s*You are unharmed but feel foolish\.
     matchre MOVE_STAND ^Running heedlessly over the rough terrain\, you trip over an exposed root and land face first in the dirt\.
     matchre MOVE_STAND ^You can\'t do that while lying down\.
     matchre MOVE_STAND ^You can\'t do that while sitting\!
     matchre MOVE_STAND ^You can\'t do that while kneeling\!
     matchre MOVE_STAND ^You must be standing to do that\.
     matchre MOVE_STAND ^You don\'t seem
     matchre MOVE_STAND ^You must stand first\.
     matchre MOVE_STAND ^Stand up first.
     matchre MOVE_DIG ^You make no progress in the mud \-\- mostly just shifting of your weight from one side to the other\.
     matchre MOVE_DIG ^You find yourself stuck in the mud\, unable to move much at all after your pathetic attempts\.
     matchre MOVE_DIG ^You struggle forward\, managing a few steps before ultimately falling short of your goal\.
     matchre MOVE_DIG ^Like a blind\, lame duck\, you wallow in the mud in a feeble attempt at forward motion\.
     matchre MOVE_DIG ^The mud holds you tightly\, preventing you from making much headway\.
     matchre MOVE_DIG ^You fall into the mud with a loud \*SPLUT\*\.
     matchre MOVE_FAIL_BAIL ^You can't go there
     matchre MOVE_FAILED ^Noticing your attempt
     matchre MOVE_FAILED ^I could not find what you were referring to\.
     matchre MOVE_FAILED ^What were you referring to\?
     matchre MOVE_RETURN ^It's pitch dark
     matchre MOVE_RETURN ^Obvious
     send %Direction
     matchwait 8
     goto MOVE_RETURN
MOVE_RETRY:
     pause
     goto MOVE_RESUME
MOVE_STAND:
     pause 0.00001
     matchre MOVE_STAND ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre MOVE_STAND ^You are overburdened and cannot manage to stand\.
     matchre MOVE_STAND ^The weight
     matchre MOVE_STAND ^You try
     matchre MOVE_STAND ^You don\'t
     matchre MOVE_RETREAT ^You are already standing\.
     matchre MOVE_RETREAT ^You stand(?:\s*back)? up\.
     matchre MOVE_RETREAT ^You stand up\.
     send stand
     matchwait 8
     goto MOVE_STAND
MOVE_RETREAT:
     pause 0.00001
     math moveRetreat add 1
     if (%moveRetreat > 4) then
          {
               send search
               pause 0.5
               pause 0.3
               var moveRetreat 0
          }
     if ($invisible = 1) then gosub STOP_INVIS
     matchre MOVE_RETREAT ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre MOVE_RETREAT ^You retreat back to pole range\.
     matchre MOVE_RETREAT ^You stop advancing
     matchre MOVE_RETREAT ^You try to back away
     matchre MOVE_STAND ^You must stand first\.
     matchre MOVE_RESUME ^You retreat from combat\.
     matchre MOVE_RESUME ^You are already as far away as you can get\!
     send retreat
     matchwait 10
     goto MOVE_RETREAT
MOVE_DIG:
     pause 0.00001
     matchre MOVE_DIG ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre MOVE_DIG ^You struggle to dig off the thick mud caked around your legs\.
     matchre MOVE_STAND ^You manage to dig enough mud away from your legs to assist your movements\.
     matchre MOVE_DIG_STAND ^Maybe you can reach better that way\, but you'll need to stand up for that to really do you any good\.
     matchre MOVE_RESUME ^You will have to kneel
     send dig
     matchwait 10
     goto MOVE_DIG
MOVE_DIG_STAND:
     pause 0.00001
     matchre MOVE_DIG_STAND ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre MOVE_DIG_STAND ^The weight
     matchre MOVE_DIG_STAND ^You try
     matchre MOVE_DIG_STAND ^You are overburdened and cannot manage to stand\.
     matchre MOVE_DIG ^You stand(?:\s*back)? up\.
     matchre MOVE_DIG ^You are already standing\.
     send stand
     matchwait 10
     goto MOVE_DIG_STAND
MOVE_FAILED:
     var moved 0
     math movefailCounter add 1
     if (%movefailCounter > 3) then goto MOVE_FAIL_BAIL
     pause 0.5
     put look
     pause 0.4
     goto MOVE_RESUME
MOVE_FAIL_BAIL:
     put #echo
     # put #echo >$Log Crimson *** MOVE FAILED. ***
     put #echo Crimson *** MOVE FAILED.  ***
     put #echo
     return
MOVE_RETURN_CHECK:
     put look
     pause 0.1
MOVE_RETURN:
     var moved 1
     var randomloop 0
     pause 0.00001
     unvar moveloop
     unvar movefailCounter
     return
FIND_MYSELF:
MOVERANDOM:
moveRandomDirection:
     var moveloop 0
     moveRandomDirection_2:
     math moveloop add 1
     if matchre("$roomname", "Deadman's Confide, Beach") || (matchre("$roomobjs","thick fog") || matchre("$roomexits","thick fog")) then
          {
               gosub TRUE_RANDOM_2
               return
          }
     if matchre("$roomname", "Deadman's Confide, Beach") || (matchre("$roomobjs","thick fog") || matchre("$roomexits","thick fog")) then
          {
               gosub TRUE_RANDOM_2
               return
          }
     if $north then
          {
               gosub MOVE north
               return
          }
     if $northwest then
          {
               gosub MOVE northwest
               return
          }
     if $northeast then
          {
               gosub MOVE northeast
               return
          }
     if $southeast then
          {
               gosub MOVE southeast
               return
          }
     if $south then
          {
               gosub MOVE south
               return
          }
     if $west then
          {
               gosub MOVE west
               return
          }
     if $east then
          {
               gosub MOVE east
               return
          }
     if $southwest then
          {
               gosub MOVE southwest
               return
          }
     if $out then
          {
               gosub MOVE out
               return
          }
     if $up then
          {
               gosub MOVE up
               return
          }
     if $down then
          {
               gosub MOVE down
               return
          }
     if matchre("$roomobjs $roomdesc","\b(stairs|staircase|stairway)\b") then
          {
               gosub MOVE climb stair
               return
          }
     if matchre("$roomobjs $roomdesc","\bsteps\b") then
          {
               gosub MOVE climb step
               return
          }
     if matchre("$roomobjs $roomdesc","\b(exit|curtain|arch|door|gate|hole|hatch|trapdoor|path|animal trail|tunnel|portal)\b") then
          {
               gosub MOVE go $1
               return
          }
     echo *** No random direction possible?? Looking to attempt to reset room exit vars
     send search
     pause 0.4
     pause 0.2
     #might need a counter here to prevent infinite loops
     put look
     pause 0.5
     pause 0.2
     if (%moveloop > 6) then
          {
               echo *** Cannot find a room exit!! Stupid fog!
               echo *** ATTEMPTING RANDOM DIRECTIONS...
               gosub LIGHT_SOURCE
               pause 0.2
               gosub TRUE_RANDOM_2
               return
          }
     goto moveRandomDirection_2
###################################################################################
### RANDOM MOVEMENT ENGINE BY SHROOM
### GO IN RANDOM DIRECTIONS AND DON'T BACKTRACK FROM LAST MOVED DIRECTION IF POSSIBLE
### IF IT CANNOT FIND A DIRECTION, WILL TAKE ANY POSSIBLE EXIT IT CAN SEE
### WILL MOVE IN RANDOM DIRECTIONS IF IT CANNOT SEE ANY ROOM EXITS (PITCH BLACK)
###################################################################################
RANDOMMOVE:
     pause 0.0001
     var moved 0
     math randomloop add 1
     if (%randomloop = 1) then gosub DARK_CHECK_1
     if !($standing) then gosub STAND
     if matchre("%randomloop", "\b(12|30|50)\b") then
          {
               echo **** CANNOT FIND A ROOM EXIT????!
               put look
               pause 0.4
          }
     if (%randomloop > 25) then
          {
               if matchre("$roomobjs $roomdesc","pitch black") then gosub LIGHT_SOURCE
               var lastmoved null
               gosub TRUE_RANDOM_2
          }
     if (%randomloop > 80) then
          {
               echo ################################
               echo *** Cannot find a room exit??? Stupid fog???
               echo *** ZONE: $zoneid | ROOM: $roomid
               echo *** SEND THE ROOM DESCRIPTION/EXITS WHEN YOU TYPE LOOK
               echo *** ATTEMPTING RANDOM DIRECTIONS...
               echo *** SHOULD AUTO-RECOVER IF YOU CAN FIND AN EXIT
               echo ###############################
               pause 0.5
               put look
               pause 0.5
               if matchre("$roomobjs $roomdesc","pitch black") then gosub LIGHT_SOURCE
               pause 0.2
               gosub TRUE_RANDOM_2
               var lastmoved null
               var randomloop 0
               return
          }
     if matchre("$roomname", "\[Skeletal Claw\]") then
          {
               echo ##################################
               echo # IN THE SKELETAL CLAW! OH NO!!!
               echo # WE MIGHT DIE IF SOMEONE DOESN'T CAST UNCURSE ON IT!
               echo # ATTEMPTING TO ESCAPE.............
               echo ##################################
               gosub MOVE out
               return
          }
     if (matchre("$roomname", "Deadman's Confide, Beach") || matchre("$roomobjs","thick fog") || matchre("$roomexits","thick fog")) then
          {
               gosub TRUE_RANDOM_2
               return
          }
     if matchre("$roomname","Smavold's Toggery") then
          {
               gosub MOVE go door
               return
          }
     if matchre("$roomname","Temple Hill Manor, Grounds") then
          {
               gosub MOVE go gate
               return
          }
     if matchre("$roomname","Darkling Wood, Ironwood Tree") then
          {
               gosub MOVE climb pine branches
               return
          }
     if matchre("$roomname","Darkling Wood, Pine Tree") then
          {
               gosub MOVE climb white pine
               return
          }
     if matchre("$roomobjs","strong creeper") then
          {
               gosub MOVE climb ladder
               return
          }
     if (%randomloop > 10) then
          {
          if matchre("$roomobjs","stone wall") then
               {
                    gosub MOVE climb niche
               }
          if (%moved = 1) then return
          if matchre("$roomobjs","narrow ledge") then
               {
                    gosub MOVE climb ledge
               }
          if (%moved = 1) then return
          if matchre("$roomobjs","craggy niche") then
               {
                    gosub MOVE climb niche
               }
          if (%moved = 1) then return
          if matchre("$roomobjs","double door") then
               {
                    gosub MOVE go door
               }
          if (%moved = 1) then return
          if matchre("$roomobjs","staircase") then
               {
                    gosub MOVE climb stair
               }
          if (%moved = 1) then return
          if matchre("$roomobjs","the exit") then
               {
                    gosub MOVE go exit
               }
          if matchre("$roomobjs","\bdoor\b") then
               {
                    gosub MOVE go door
               }
          }
     if (%moved = 1) then return
     random 1 11
     if ((%r = 1) && ($north) && ("%lastmoved" != "south")) then gosub MOVE north
     if ((%r = 2) && ($northeast) && ("%lastmoved" != "southwest")) then gosub MOVE northeast
     if ((%r = 3) && ($east) && ("%lastmoved" != "west")) then gosub MOVE east
     if (%moved = 1) then return
     if ((%r = 4) && ($northwest) && ("%lastmoved" != "southeast")) then gosub MOVE northwest
     if ((%r = 5) && ($southeast) && ("%lastmoved" != "northwest")) then gosub MOVE southeast
     if ((%r = 6) && ($south) && ("%lastmoved" != "north")) then gosub MOVE south
     if ((%r = 7) && ($southwest) && ("%lastmoved" != "northeast")) then gosub MOVE southwest
     if (%moved = 1) then return
     if ((%r = 8) && ($west) && ("%lastmoved" != "east")) then gosub MOVE west
     if (%r = 9) && ($out) then gosub MOVE out
     if ((%r = 10) && ($up) && ("%lastmoved" != "up")) then gosub MOVE up
     if ((%r = 11) && ($down) && ("%lastmoved" != "down")) then gosub MOVE down
     if (%moved = 1) then return
     ### IF DONE 13 LOOPS WITH NO MATCH THEN CHECK FOR ANY OBVIOUS ROOM EXIT
     if (%randomloop > 13) then
          {
               if ($out) then gosub MOVE out
               if (%moved = 1) then return
               if (($north) && ("%lastmoved" != "south")) then gosub MOVE north
               if (($south) && ("%lastmoved" != "north")) then gosub MOVE south
               if (%moved = 1) then return
               if (($east) && ("%lastmoved" != "west")) then gosub MOVE east
               if (($west) && ("%lastmoved" != "east")) then gosub MOVE west
               if (%moved = 1) then return
               if (($northeast) && ("%lastmoved" != "southwest")) then gosub MOVE northeast
               if (($northwest) && ("%lastmoved" != "southeast")) then gosub MOVE northwest
               if (%moved = 1) then return
               if (($southeast) && ("%lastmoved" != "northwest")) then gosub MOVE southeast
               if (($southwest) && ("%lastmoved" != "northeast")) then gosub MOVE southwest
               if (%moved = 1) then return
               if (matchre("$roomobjs $roomdesc","narrow hole") && ("%lastmoved" != "go hole")) then gosub MOVE go hole
               if (matchre("$roomobjs $roomdesc","\bcrevice") && ("%lastmoved" != "go crevice")) then gosub MOVE go crevice
               if (%moved = 1) then return
               if (matchre("$roomobjs $roomdesc","\bgate") && ("%lastmoved" != "go gate")) then gosub MOVE go gate
               if (matchre("$roomobjs $roomdesc","\barch") && ("%lastmoved" != "go arch")) then gosub MOVE go arch
               if (%moved = 1) then return
               if (matchre("$roomexits","\bforward") && ("%lastmoved" != "forward")) then gosub MOVE forward
               if (matchre("$roomexits","\baft\b") && ("%lastmoved" != "aft")) then gosub MOVE aft
               if (%moved = 1) then return
               if (matchre("$roomexits","\bstarboard") && ("%lastmoved" != "starboard")) then gosub MOVE starboard
               if (matchre("$roomexits","\bport\b") && ("%lastmoved" != "port")) then gosub MOVE port
               if (%moved = 1) then return
               if (matchre("$roomobjs $roomdesc","\bexit\b") && ("%lastmoved" != "go exit")) then gosub MOVE go exit
               if (matchre("$roomobjs $roomdesc","\bpath\b") && ("%lastmoved" != "go path")) then gosub MOVE go path
               if (%moved = 1) then return
               if (matchre("$roomobjs $roomdesc","\btrapdoor\b") && ("%lastmoved" != "go trapdoor")) then gosub MOVE go trapdoor
               if (matchre("$roomobjs $roomdesc","\bcurtain\b") && ("%lastmoved" != "go curtain")) then gosub MOVE go curtain
               if (matchre("$roomobjs $roomdesc","\bdoor") && ("%lastmoved" != "go door")) then gosub MOVE go door
               if (matchre("$roomobjs $roomdesc","double door") && ("%lastmoved" != "go door")) then gosub MOVE go door
               if (%moved = 1) then return
               if (matchre("$roomobjs $roomdesc","\bportal\b") && ("%lastmoved" != "go portal")) then gosub MOVE go portal
               if (matchre("$roomobjs $roomdesc","\btunnel\b") && ("%lastmoved" != "go tunnel")) then gosub MOVE go tunnel
               if (matchre("$roomobjs $roomdesc","\bjagged crack\b") && ("%lastmoved" != "go crack")) then gosub MOVE go crack
               if (matchre("$roomobjs $roomdesc","\bthe street\b") && ("%lastmoved" != "go street")) then gosub MOVE go street
               if (matchre("$roomobjs $roomdesc","(?i)\ba gate\b") && ("%lastmoved" != "go gate")) then gosub MOVE go gate
               if (%moved = 1) then return
               if (matchre("$roomobjs $roomdesc","\b(stairs|staircase|stairway)\b") && ("%lastmoved" != "climb stair")) then gosub MOVE climb stair
               if (matchre("$roomobjs $roomdesc","\bsteps\b") && ("%lastmoved" != "climb step")) then gosub MOVE climb step
               if (matchre("$roomobjs $roomdesc","\btrail\b") && ("%lastmoved" != "go trail")) then gosub MOVE go trail
               if (%moved = 1) then return
               if (matchre("$roomobjs $roomdesc","\bpanel\b") && ("%lastmoved" != "go panel")) then gosub MOVE go panel
               if (matchre("$roomobjs $roomdesc","\btent flap\b") && ("%lastmoved" != "go flap")) then gosub MOVE go flap
               if (matchre("$roomobjs $roomdesc","\bnarrow track\b") && ("%lastmoved" != "go track")) then gosub MOVE go track
               if (matchre("$roomobjs $roomdesc","\blava field\b") && ("%lastmoved" != "go lava field")) then gosub MOVE go lava field
          }
     if (%moved = 0) then goto RANDOMMOVE
     # if ($roomid = 0) then goto RANDOMMOVE
     # if $roomid == 0 then goto moveRandomDirection_2
     return
### RANDOM CARDINAL DIRECTIONS ONLY
RANDOMMOVE_CARDINAL:
     pause 0.0001
     var moved 0
     math randomloop add 1
     if (%randomloop > 50) then
          {
               var lastmoved null
               var randomloop 0
               echo *** Cannot find a room exit??
               echo *** Attempting to Revert back..
               echo *** Trying Alternate Methods..
               if matchre("$roomobjs $roomdesc","pitch black") then gosub LIGHT_SOURCE
               pause 0.2
               gosub TRUE_RANDOM_2
               return
          }
     if matchre("$roomname", "Deadman's Confide, Beach") || (matchre("$roomobjs","thick fog") || matchre("$roomexits","thick fog")) then
          {
               gosub TRUE_RANDOM_2
               return
          }
     if matchre("$roomname","Temple Hill Manor, Grounds") then
          {
               gosub MOVE go gate
               return
          }
     if matchre("$roomname","Darkling Wood, Ironwood Tree") then
          {
               gosub MOVE climb pine branches
               return
          }
     if matchre("$roomname","Darkling Wood, Pine Tree") then
          {
               gosub MOVE climb white pine
               return
          }
     if matchre("$roomobjs","strong creeper") then
          {
               gosub MOVE climb ladder
               return
          }
     random 1 11
     if (%moved = 1) then return
     if ((%r = 1) && ($north) && ("%lastmoved" != "south")) then gosub MOVE north
     if ((%r = 2) && ($northeast) && ("%lastmoved" != "southwest")) then gosub MOVE northeast
     if ((%r = 3) && ($east) && ("%lastmoved" != "west")) then gosub MOVE east
     if (%moved = 1) then return
     if ((%r = 4) && ($northwest) && ("%lastmoved" != "southeast")) then gosub MOVE northwest
     if ((%r = 5) && ($southeast) && ("%lastmoved" != "northwest")) then gosub MOVE southeast
     if ((%r = 6) && ($south) && ("%lastmoved" != "north")) then gosub MOVE south
     if ((%r = 7) && ($southwest) && ("%lastmoved" != "northeast")) then gosub MOVE southwest
     if (%moved = 1) then return
     if ((%r = 8) && ($west) && ("%lastmoved" != "east")) then gosub MOVE west
     if (%r = 9) && ($out) then gosub MOVE out
     if ((%r = 10) && ($up) && ("%lastmoved" != "up")) then gosub MOVE up
     if ((%r = 11) && ($down) && ("%lastmoved" != "down")) then gosub MOVE down
     if (%moved = 1) then return
     if (%moved = 0) then goto RANDOMMOVE_CARDINAL
     # if ($roomid = 0) then goto RANDOMMOVE
     # if $roomid == 0 then goto moveRandomDirection_2
     return
### GO IN RANDOM DIRECTIONS, PREFER A SOUTHERN / WESTERN DIRECTION IF AVAILABLE
RANDOMMOVE_SOUTH:
     pause 0.0001
     var moved 0
     math randomloop add 1
     if (%randomloop > 5) then
          {
               put look
               pause 0.2
               var lastmoved null
               var randomloop 0
               return
          }
     if $south then
          {
               gosub MOVE south
               return
          }
     if $southwest then
          {
               gosub MOVE southwest
               return
          }
     if $southeast then
          {
               gosub MOVE southeast
               return
          }
     if $northwest then
          {
               gosub MOVE northwest
               return
          }
     if $west then
          {
               gosub MOVE west
               return
          }
     if $north then
          {
               gosub MOVE north
               return
          }
     if $northeast then
          {
               gosub MOVE northeast
               return
          }
     if $east then
          {
               gosub MOVE east
               return
          }

     if $out then
          {
               gosub MOVE out
               return
          }
     if $up then
          {
               gosub MOVE up
               return
          }
     if $down then
          {
               gosub MOVE down
               return
          }
     pause 0.01
     if (%moved = 0) then goto RANDOMMOVE_SOUTH
     # if $roomid == 0 then goto moveRandomDirection_2
     return
### TRUE RANDOM USED FOR MOVING IN PURE RANDOM DIRECTIONS REGARDLESS OF WHATS IN ROOM (FOG FILLED OR DARK ROOMS)
TRUE_RANDOM_2:
     pause 0.0001
     var moved 0
     math randomloop add 1
     if (%randomloop > 9) then
          {
               put look
               pause 0.2
               var lastmoved null
               var randomloop 0
               return
          }
     random 1 8
     if (%r = 1) then gosub MOVE n
     if (%r = 2) then gosub MOVE ne
     if (%r = 3) then gosub MOVE e
     if (%r = 4) then gosub MOVE nw
     if (%r = 5) then gosub MOVE se
     if (%r = 6) then gosub MOVE s
     if (%r = 7) then gosub MOVE sw
     if (%r = 8) then gosub MOVE w
     if ($out) then gosub MOVE out
     if (%moved = 1) then return
     if matchre("$roomobjs $roomdesc","\bexit\b") && ("%lastmoved" != "go exit") then gosub MOVE go exit
     if matchre("$roomobjs $roomdesc","\bpath\b") && ("%lastmoved" != "go path") then gosub MOVE go path
     if matchre("$roomobjs $roomdesc","\btrapdoor\b") && ("%lastmoved" != "go trapdoor") then gosub MOVE go trapdoor
     if matchre("$roomobjs $roomdesc","\bcurtain\b") && ("%lastmoved" != "go path") then gosub MOVE go curtain
     if matchre("$roomobjs $roomdesc","\bdoor") && ("%lastmoved" != "go door") then gosub MOVE go door
     if matchre("$roomobjs $roomdesc","\bgate") && ("%lastmoved" != "go gate") then gosub MOVE go gate
     if matchre("$roomobjs $roomdesc","\barch") && ("%lastmoved" != "go arch") then gosub MOVE go arch
     if (%moved = 1) then return
     if matchre("$roomobjs $roomdesc","\bportal\b") && ("%lastmoved" != "go portal") then gosub MOVE go portal
     if matchre("$roomobjs $roomdesc","\btunnel\b") && ("%lastmoved" != "go tunnel") then gosub MOVE go tunnel
     if matchre("$roomobjs $roomdesc","\b(stairs|staircase|stairway)\b") && ("%lastmoved" != "climb stair") then gosub MOVE climb stair
     if matchre("$roomobjs $roomdesc","\bsteps\b") && ("%lastmoved" != "climb step") then gosub MOVE climb step
     if (%moved = 1) then return
     if matchre("$roomobjs $roomdesc","\bpanel\b") && ("%lastmoved" != "go panel") then gosub MOVE go panel
     if matchre("$roomobjs $roomdesc","\bnarrow track\b") && ("%lastmoved" != "go track") then gosub MOVE go track
     if (%moved = 0) then goto TRUE_RANDOM_2
     return
TRUE_RANDOM:
     pause 0.0001
     var moved 0
     math randomloop add 1
     if (%randomloop > 9) then
          {
               put look
               pause 0.2
               var lastmoved null
               var randomloop 0
          }
     random 1 16
     if (%r = 1) then gosub MOVE n
     if (%r = 2) then gosub MOVE ne
     if (%r = 3) then gosub MOVE e
     if (%r = 4) then gosub MOVE nw
     if (%r = 5) then gosub MOVE se
     if (%r = 6) then gosub MOVE s
     if (%r = 7) then gosub MOVE sw
     if (%r = 8) then gosub MOVE w
     if (%r = 9) then gosub MOVE out
     if (%r = 10) then gosub MOVE up
     if (%r = 11) then gosub MOVE go door
     if (%r = 12) then gosub MOVE go path
     if (%r = 13) then gosub MOVE climb stair
     if (%r = 14) then gosub MOVE climb step
     if (%r = 15) then gosub MOVE go panel
     if (%r = 16) then gosub MOVE go arch
     if (%moved = 0) then goto TRUE_RANDOM
     return
RANDOMWEIGHT:
     var weight $1
     var randomweight
     if $%weight then var randomweight %randomweight|%weight
     if $north%weight then var randomweight %randomweight|north%weight
     if $south%weight then var randomweight %randomweight|south%weight
     eval randomweightcount count("%randomweight", "|")
RANDOMWEIGHT_2:
     if ("%randomweight" = "") then return
     random 1 %randomweightcount
     gosub MOVE %randomweight(%r)
     return
RANDOMNORTH:
     if (($north) && ("%lastmoved" != "south")) then
          {
               gosub MOVE north
               goto RANDOMSOUTH_RETURN
          }
     if (($northeast) && ("%lastmoved" != "southwest")) then
          {
               gosub MOVE northeast
               goto RANDOMSOUTH_RETURN
          }
     if (($northwest) && ("%lastmoved" != "southeast")) then
          {
               gosub MOVE northwest
               return
          }
     if (($west) && ("%lastmoved" != "east")) then
          {
               gosub MOVE west
               goto RANDOMSOUTH_RETURN
          }
     if (($east) && ("%lastmoved" != "west")) then
          {
               gosub MOVE east
               goto RANDOMSOUTH_RETURN
          }
     var lastmoved null
     return
RANDOMSOUTH:
     if (($south) && ("%lastmoved" != "north")) then
          {
               gosub MOVE south
               goto RANDOMSOUTH_RETURN
          }
     if (($southeast) && ("%lastmoved" != "northwest")) then
          {
               gosub MOVE southeast
               goto RANDOMSOUTH_RETURN
          }
     if (($southwest) && ("%lastmoved" != "northeast")) then
          {
               gosub MOVE southwest
               goto RANDOMSOUTH_RETURN
          }
     if (($east) && ("%lastmoved" != "west")) then
          {
               gosub MOVE east
               goto RANDOMSOUTH_RETURN
          }
     if (($west) && ("%lastmoved" != "east")) then
          {
               gosub MOVE west
               goto RANDOMSOUTH_RETURN
          }
     var lastmoved null
RANDOMSOUTH_RETURN:
     return
####################################################################################
# Auto Repairer Ver 1.3
# Original by VTCifer - with a few tweaks
####################################################################################
AUTO_REPAIR:
AUTOREPAIR:
     if ($invisible = 1) then gosub STOP_INVIS
     ## debuglevel 10
     ## var Repair.Item.List $UC_Weapon01|$Weapon02|$Weapon03|$Weapon04|$Weapon05|$Weapon06|$Weapon07|$Weapon08|$Weapon09|$Weapon10|$Weapon11|$Weapon12|$Weapon13|$Weapon14|$Weapon15|$Weapon16
# CONSTANT VARIABLES
     var RepairerList Catrox|Randal|Unspiek|Wyla|Kamze|Dagul|Ylono|Lakyan|Osmandikar|Krrikt'k|Raven|Ladar|Shh'yris|Sefu|Fekoeti|Diwitt|repairman
     if def(Repair.Item.List) then var ItemList $UC_Repair.Item.List
     else var ItemList
     eval MaxItems count("%ItemList" , "|")
# VARIABLES
     var Foci.Active 0
     var Name
     var CurrentItem -1
     put #var UC_repairCost 0
     put #var UC_repairCurrency Kronars
# ACTIONS
     action put #var UC_repairCost {#evalmath ($UC_repairCost + $1)};put #var UC_repairCurrency $2 when ^\s*You\s+hand\s+\S+\s+(\d+)\s+(Kronars?|Dokoras?|Lirums?|kronars?|dokoras?|lirums?)\s+and\s+
# SCRIPT START
REPAIR_START:
     if !matchre("$lefthand", "Empty") then gosub WEAR left
     if !matchre("$righthand", "Empty") then gosub WEAR right
     if matchre("$roomdesc" "(%RepairerList)") then var Name $0
     if matchre("$lefthand $righthand", "ticket") then gosub STOWIT ticket
     if ("%Name" = "") then if matchre("$roomobjs" "(%RepairerList)") then var Name $0
     if ("%Name" = "") then return
REPAIR_ALL:
     pause 0.0001
     matchre REPAIR_NO_MONEY You will need more coin if I am to be repairing that
     matchre REPAIR_ALL ^\.\.\.wait|^Sorry\.
     matchre REPAIR_ALL ^.* looks over .* and says\, \"That will cost .* to repair\.\s*Just give it to me again if you want\, and I'll have it ready in .*\.\"
     matchre REPAIR_ALL ^.* says\, \"It will cost .* and take .* to repair .*\.\s*Just ask me again and I can get started\.\"
     matchre REPAIR_ALL .* says\, \"It will cost .* and take .* to repair
     matchre REPAIR_LIST_LOOP \"I will not repair something that isn't broken\.\"
     matchre REPAIR_LIST_LOOP \"Lucky for you\!\s*That isn't damaged\!\"
     matchre REPAIR_LIST_LOOP \"Read the sign please\!\s*I don't work on those here\.\"
     matchre REPAIR_LIST_LOOP \"Read the sign on the wall\!\s*I don't work on those here\.\"
     matchre REPAIR_LIST_LOOP \"There isn't a scratch on that\, and I'm not one to rob you\.\"
     matchre REPAIR_LIST_LOOP \"I'm sorry\, but I don't work on those\.\"
     matchre REPAIR_LIST_LOOP \"I don\'t repair those here
     matchre REPAIR_LIST_LOOP \"Read the hide on the wall\, please\.  I don't work on those here\.\"
     matchre REPAIR_STOW_RIGHT Please don't lose this ticket\!
     matchre STOW_HANDS ^You realize both your hands are full
     send ask %Name about repair all
     matchwait 20
     echo *** MISSING MATCH IN REPAIR_ALL! ***
     put #echo >$Log Crimson $datetime *** MISSING MATCH IN REPAIR_ALL! ***
     put #log $datetime MISSING MATCH IN REPAIR_ALL
REPAIR_LIST_LOOP:
     math CurrentItem add 1
     pause 0.0001
     pause 0.0001
     pause 0.1
     if ((%CurrentItem > %MaxItems) || ("%ItemList" = "")) then goto REPAIR_EXIT
     var Item %ItemList(%CurrentItem)
     if contains("%Item" , "NULL") then goto REPAIR_LIST_LOOP
     gosub GET my %Item
     if ("%Name" = "") then
          {
               if matchre("$roomname", "(%Repairer.List)") then var Name $1
               if matchre("$roomdesc", "(%Repairer.List)") then var Name $1
               if matchre("$roomobjs" "(%Repairer.List)") then var Name $1
               pause 0.1
          }
     if ("$righthand" = "Empty") then goto REPAIR_LIST_LOOP
     pause 0.1
     gosub EXO_CHECK
REPAIR_LIST_ITEM:
     pause 0.0001
     matchre REPAIR_LIST_ITEM ^\.\.\.wait|^Sorry\.
     matchre REPAIR_LIST_ITEM ^.* looks over .* and says\, \"That will cost .* to repair\.\s*Just give it to me again if you want\, and I'll have it ready in .*\.\"
     matchre REPAIR_LIST_ITEM ^.* says\, \"It will cost .* and take .* to repair .*\.\s*Just ask me again and I can get started\.\"
     matchre REPAIR_LIST_ITEM This is an exclusive item reserved for a certain subset of the population
     matchre REPAIR_STOW_RIGHT ^.* shrugs and says\, \"I will not repair something that isn\'t broken\.\"
     matchre REPAIR_STOW_RIGHT \"I will not repair something that isn't broken\.\"
     matchre REPAIR_STOW_RIGHT \"Lucky for you\!\s*That isn't damaged\!\"
     matchre REPAIR_STOW_RIGHT \"Read the sign please\!\s*I don't work on those here\.\"
     matchre REPAIR_STOW_RIGHT \"Read the sign on the wall\!\s*I don't work on those here\.\"
     matchre REPAIR_STOW_RIGHT \"There isn't a scratch on that\, and I'm not one to rob you\.\"
     matchre REPAIR_STOW_RIGHT I'm sorry\, but I don't work on those\.
     matchre REPAIR_STOW_RIGHT I don\'t repair those here
     matchre REPAIR_STOW_RIGHT Read the hide on the wall\, please\.|I don't work on those here
     matchre REPAIR_STOW_RIGHT Please don't lose this ticket\!
     matchre REPAIR_NO_MONEY You will need more coin if I am to be repairing that\!
     send give %Name
     matchwait 20
     echo *** MISSING MATCH IN REPAIR_LIST_ITEM! ***
     put #echo >$Log Crimson $datetime *** MISSING MATCH IN REPAIR_LIST_ITEM! ***
     put #log $datetime MISSING MATCH IN REPAIR_LIST_ITEM
     goto REPAIR_STOW_RIGHT
REPAIR_STOW_RIGHT:
     pause 0.5
     if matchre("$righthand $lefthand", "(heavy steel|polished brass|thick copper|bronze|steel|dark|rippled|desert-tan steel|washed|pink|gloomwood|haralun|bark|coral|golden) katavdar") then gosub KAT_RESET
     if matchre("$righthand $lefthand", "exoskeletal (ritual dagger|sword|mace|rapier|maul|scimitar|longsword|katar|claymore|broadsword|axe|bludgeon|hammer|nightstick|pike|halberd|morning star|battle axe)") then gosub EXO_RESET
     gosub SHEATH_CHECK
     gosub STOWIT right
     goto REPAIR_LIST_LOOP
REPAIR_NO_MONEY:
     put #echo >$Log Crimson $datetime NO MONEY FOR REPAIRS!
     put #echo NO MONEY FOR REPAIRS!
     put #parse NO MONEY!
     action remove ^\s*You\s+hand\s+\S+\s+(\d+)\s+(Kronars?|Dokoras?|Lirums?|kronars?|dokoras?|lirums?)\s+and\s+
     goto REPAIR_REMOVE
REPAIR_EXIT:
     put #echo Repair Cost: $UC_repairCost $UC_repairCurrency
     put #parse REPAIR DONE!
REPAIR_REMOVE:
     action remove ^\s*You\s+hand\s+\S+\s+(\d+)\s+(Kronars?|Dokoras?|Lirums?|kronars?|dokoras?|lirums?)\s+and\s+
     unvar ItemList
     unvar ItemList
     unvar MaxItems
     unvar CurrentItem
     return
STOW_HANDS:
     gosub EMPTY_HANDS
     goto REPAIR_START
###################################################################################################
# REPAIR DONE Ver 1.7
# Originally based off VTCifer's repair module
# Many many Custom Tweaks and handling of special items / FC repair etc
##################################################################################################
REPAIR_DONE:
DONEREPAIR:
     pause 0.001
# CONSTANT VARIABLES
     var Repairer.List Catrox|Randal|Unspiek|Wyla|Kamze|Dagul|Ylono|Lakyan|Osmandikar|Krrikt'k|Raven|Ladar|Shh'yris|Sefu|Fekoeti|Diwitt|repairman
     if def(Repair.Item.List) then var Item.List $UC_Repair.Item.List
     else var Item.List
     eval MaxItems count("%Item.List","|")
# VARIABLES
     var Foci.Active 0
     var LakTick 0
     var OsTick 0
     var RepTick 0
     var ItemList
     var NounList
     var MaxItemCount
     var Source
     var ItemCount 0
     var Name
     var Bag
     var Bag2 $UC_Container.Box
# ACTIONS
     action (sack) var ItemList $1 when ^In the .+ you see (.*)\.
     action (sack) var ItemList NULL when ^There is nothing in there\.
# SCRIPT START
RepairDoneStart:
     ##debug 5
     pause 0.0001
     if matchre("$righthand", "large sack") then goto Check.Item
     if matchre("$righthand $lefthand", "large sack") then goto Check.Item
     if matchre("$righthand $lefthand", "small sack") then goto Check.Item
     if !matchre("$lefthand", "large sack") && !matchre("$lefthand", "Empty") then gosub STOWIT left
     if !matchre("$righthand", "large sack") && !matchre("$righthand", "Empty") then gosub STOWIT right
     if matchre("$roomdesc", "(%Repairer.List)") then var Name $0
     if matchre("$roomname", "(%Repairer.List)") then var Name $0
     if matchre("$roomobjs" "(%Repairer.List)") then var Name $0
     pause 0.1
     if ("%Name" = "") then
          {
               if matchre("$roomname", "(%Repairer.List)") then var Name $1
               if matchre("$roomdesc", "(%Repairer.List)") then var Name $1
               if matchre("$roomobjs" "(%Repairer.List)") then var Name $1
               pause 0.1
          }
Get.Ticket:
     if ("%Name" = "") then goto DONE.REPAIR
     if matchre("%Name", "(^%|^\s*$|^$)") then goto DONE.REPAIR
     if matchre("%Name", "$^") then goto DONE.REPAIR
     var ticket %Name
     echo Ticket: %ticket
     gosub stowing
     pause 0.5
     gosub GET %Name ticket
     pause 0.4
Ticket.Check:
     if (("$righthand" = "Empty") && !matchre("$lefthand", "Empty")) then goto DONE.REPAIR
     if (!matchre("$righthand", "ticket") && !matchre("$righthand", "Empty")) then gosub STOWIT $righthand
     if matchre("$lefthand", "ticket") then gosub SWAP
     if matchre("$righthand", "(%Repairer.List) ticket") then var ticket $1
     pause 0.1
     if !matchre("$righthand $lefthand", "ticket") then
          {
               if (matchre("%ticket", "(?i)repairman") && (%RepTick = 0)) then
                    {
                         if (%LakTick = 0) then var Name Lakyan
                         if (%LakTick = 1) then var Name Osmandikar
                         var RepTick 1
                         goto Get.Ticket
                    }
               if (matchre("%ticket", "(?i)Lakyan") && (%LakTick = 0)) then
                    {
                         if (%RepTick = 0) then var Name repairman
                         if (%RepTick = 1) then var Name Osmandikar
                         var LakTick 1
                         goto Get.Ticket
                    }
               if (matchre("%ticket", "(?i)Osmandikar") && (%OsTick = 0)) then
                    {
                         if (%RepTick = 0) then var Name repairman
                         if (%LakTick = 0) then var Name Lakyan
                         var OsTick 1
                         goto Get.Ticket
                    }
               goto DONE.REPAIR
          }
     if ("$righthand" == "Empty") then goto DONE.REPAIR
Give.Ticket:
     var RepairGuy %Name
     if matchre("$roomname", "(%Repairer.List)") then var RepairGuy $1
     if matchre("$roomdesc", "(%Repairer.List)") then var RepairGuy $1
     if matchre("$roomobjs", "(%Repairer.List)") then var RepairGuy $1
Give.Ticket1:
     pause 0.2
     matchre Give.Ticket1 ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre WrongTicket You realize that ticket isn\'t|back at my shop first thing in the morning
     matchre WaitRepair Well that is almost done|isn't gonna be done
     matchre Check.Item ^You hand (%Repairer.List) your ticket and are handed back|What is it
     matchre Check.Item ^.* takes your ticket and disappears|returns and hands you
     put give %RepairGuy
     matchwait 20
WaitRepair:
     echo *** waiting.....
     pause 10
     goto Give.Ticket
WrongTicket:
     echo ** WRONG TICKET??
     if matchre("%ticket", "Osmandikar") then var OsTick 1
     if matchre("%ticket", "Lakyan") then var LakTick 1
     if matchre("%ticket", "repairman") then var RepTick 1
     pause 0.4
     gosub STOWIT ticket
     pause 0.2
     goto Ticket.Check
Check.Item:
CheckingItem:
     action (sack) off
     if ((matchre("$lefthand", "large sack") && !matchre("$righthand", "Empty")) || (matchre("$lefthand", "small sack") && !matchre("$righthand", "Empty"))) then
          {
               send swap
               pause 0.5
               pause 0.2
               put open my sack
               pause 0.2
               pause 0.5
               goto Get.Item.List
          }
     pause 0.01
     if matchre("$righthand $lefthand", "(small|large) sack") then
          {
               put open my sack
               pause 0.2
               pause 0.5
               goto Get.Item.List
          }
     if matchre("$righthand $lefthand", "(heavy steel|polished brass|thick copper|bronze|steel|dark|rippled|desert-tan steel|washed|pink|gloomwood|haralun|bark|coral|golden) katavdar") then gosub KAT_RESET
     if matchre("$righthand $lefthand", "exoskeletal (ritual dagger|sword|mace|rapier|maul|scimitar|longsword|katar|claymore|broadsword|axe|bludgeon|hammer|nightstick|pike|halberd|morning star|battle axe)") then gosub EXO_RESET
     pause 0.1
     gosub SHEATH_CHECK
     if matchre("$lefthand", "(%MyShield|%CHEST.ARMOR|%HEAD.ARMOR|%FACE.ARMOR|%HEAD.ARMOR|%ARM.ARMOR|%LEG.ARMOR|%HAND.ARMOR|%BACK.ARMOR|%ABDOMEN.ARMOR|%KNUCKLE|%PARRYSTICK|parry stick|pugilist's armguard)") then
          {
               send wear my $1
               wait
               pause 0.2
          }
     if matchre("$righthand", "(%MyShield|%CHEST.ARMOR|%HEAD.ARMOR|%FACE.ARMOR|%HEAD.ARMOR|%ARM.ARMOR|%LEG.ARMOR|%HAND.ARMOR|%BACK.ARMOR|%ABDOMEN.ARMOR|%KNUCKLE|%PARRYSTICK|parry stick|pugilist's armguard)") then
          {
               send wear my $1
               wait
               pause 0.2
          }
     pause 0.001
     if (matchre("$lefthand", "(%B.CHEST.ARMOR|%B.HEAD.ARMOR|%B.FACE.ARMOR|%B.HEAD.ARMOR|%B.ARM.ARMOR|%B.LEG.ARMOR|%B.HAND.ARMOR|%B.BACK.ARMOR|%B.ABDOMEN.ARMOR)") && !matchre("$lefthand", "(small|large) sack")) then gosub STOWIT $1
     if matchre("$righthand", "(%B.CHEST.ARMOR|%B.HEAD.ARMOR|%B.FACE.ARMOR|%B.HEAD.ARMOR|%B.ARM.ARMOR|%B.LEG.ARMOR|%B.HAND.ARMOR|%B.BACK.ARMOR|%B.ABDOMEN.ARMOR)") && !matchre("$righthand", "(small|large) sack")) then gosub STOWIT $1
     pause 0.001
     if (matchre("$righthand $lefthand", "(%MyShield|%CHEST.ARMOR|%HEAD.ARMOR|%FACE.ARMOR|%HEAD.ARMOR|%ARM.ARMOR|%LEG.ARMOR|%HAND.ARMOR|%BACK.ARMOR|%ABDOMEN.ARMOR|%KNUCKLE|%PARRYSTICK|parry stick|pugilist's armguard)") && !matchre("$righthand $lefthand", "(small|large) sack")) then gosub STOWIT $1
     pause 0.01
     if (("$lefthand" = "Empty") && ("$righthand" = "Empty")) then goto Get.Ticket
     if matchre("$righthand", "(?i)%Wear.Weapons") then send wear my $righthandnoun
     if matchre("$lefthand", "(?i)%Wear.Weapons") then send wear my $lefthandnoun
     pause 0.01
     if (("$lefthand" = "Empty") && ("$righthand" = "Empty")) then goto Get.Ticket
     pause 0.01
     if !matchre("$lefthand", "(?i)(sack|Empty)") then gosub STOWIT left
     if ("$righthandnoun" = "ball and chain") then put stow my ball
     pause 0.01
     # if matchre("$righthand","(sieve|mixing stick|mortar|pestle)") then
          # {
               # put tie $righthand to my alch belt
               # pause 0.5
          # }
     if (!matchre("$righthand", "Empty") && !matchre("$righthand", "sack")) then
     {
          pause 0.01
          if matchre("$righthand", "(?i)%Wear.Weapons") then send wear my $righthandnoun
          pause 0.01
          if !matchre("$righthand", "Empty") then
               {
                    send put my $righthandnoun in my $UC_Container
                    wait
                    pause 0.4
                    pause 0.2
               }
          pause 0.001
          if !matchre("$righthand", "Empty") then
               {
                    send put my $righthandnoun in my $UC_Container.Box
                    wait
                    pause 0.3
                    pause 0.2
               }
          pause 0.001
          if !matchre("$righthand", "Empty") then
               {
                    send put my $righthandnoun in my $UC_Container.Backup
                    wait
                    pause 0.3
                    pause 0.2
               }
          pause 0.001
          if !matchre("$righthand", "Empty") then
               {
                    send put my $righthandnoun in my $UC_Container.Sheath
                    wait
                    pause 0.3
                    pause 0.2
               }
          pause 0.001
          if !matchre("$righthand", "Empty") then
               {
                    send wear my $righthandnoun
                    wait
                    pause 0.3
                    pause 0.2
               }
          if !matchre("$righthand", "Empty") then gosub STOWIT right
          if ((!matchre("$righthand", "sack") && !matchre("$righthand", "Empty")) || (!matchre("$lefthand", "sack") && !matchre("$lefthand", "Empty"))) then goto BAG_ERROR
          if !matchre("$righthand", "Empty") then goto Check.Item
          goto Get.Ticket
     }
     if (("$lefthand" = "Empty") && ("$righthand" = "Empty")) then goto Get.Ticket
### CHECKS SMALL SACK HERE AND GENERATES LIST OF ITEMS
Get.Item.List:
     action (sack) on
     pause 0.02
     send look in my sack
     waitforre In the|^There is
     pause 0.5
     pause 0.3
     gosub LISTEXTRACT ItemList NounList MaxItemCount
     if ("%ItemList" = "NULL") then goto CheckSource
     if matchre("%ItemList", "(?i)NULL") then goto CheckSource
     goto Get.Item2
### FIRST METHOD - STRIPS ALL EXTRA CRAP OFF EACH ITEM INDIVIDUALLY AND TRIES TO GRAB ROOT NOUN
Get.Item2:
     pause 0.1
     var itemloop 0
     var Item %NounList(%ItemCount)
     gosub ITEM_STRIP
     if (%ItemCount > %MaxItemCount) then goto CheckSource
     if ("%ItemList" = "NULL") then goto CheckSource
     if ("%Item" = "NULL") then goto CheckSource
     if ("%Item" = "") then
          {
               math ItemCount add 1
               goto Get.Item2
          }
     echo *** ITEM: %Item
Get.Item3:
     math itemloop add 1
     gosub Get %Item from my sack
     if (%itemloop > 2) then goto STOW_SACK
     if !matchre("$righthand $lefthand", "%Item") then
          {
               gosub SWAP
               goto Get.Item3
          }
     gosub STOW_REPAIR_ITEM
     math ItemCount add 1
     goto Get.Item2
### DOUBLE CHECK SACK AFTER FULL NORMAL LOOP TO MAKE SURE NO ITEMS MISSED
### SECOND METHOD - DOES A FULL LIST EXTRACT OF THE ROOT NOUN
CheckSource:
     action (sack) on
     echo *** DOUBLE CHECKING SACK
     pause 0.1
     pause 0.5
     matchre CheckSource ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre SackDone There is nothing in there.
     matchre DoubleCheck You glance|In the
     put look in my sack
     put glance
     matchwait 20
DoubleCheck:
     var itemloop 0
     var ItemCount 0
     pause 0.5
     gosub LISTEXTRACTFULL ItemList NounList MaxItemCount
     pause 0.5
DoubleCheck1:
     var itemloop 0
     var Item %NounList(%ItemCount)
     if (%ItemCount > %MaxItemCount) then goto SackFinal
     if ("%ItemList" = "NULL") then goto SackFinal
     if ("%Item" = "") then
          {
               math ItemCount add 1
               goto Get.Item2
          }
     echo *** ITEM: %Item
DoubleCheck2:
     math itemloop add 1
     gosub Get %Item from my sack
     pause 0.1
     if (%itemloop > 2) then goto STOW_SACK
     if !matchre("$righthand $lefthand", "%Item") then
          {
               gosub SWAP
               goto DoubleCheck2
          }
     gosub STOW_REPAIR_ITEM
     math ItemCount add 1
     goto Get.Item2
### TRIPLE CHECK SACK AFTER FINISHED WITH BOTH METHODS - STOWS SACK IF ANY ITEMS LEFT
SackFinal:
     echo *** TRIPLE CHECKING SACK
     pause 0.1
     pause 0.5
     matchre SackFinal ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     matchre SackDone There is nothing in there.
     matchre Repair.Fail You glance|In the
     put look in my sack
     put glance
     matchwait 20
     goto SackDone
STOW_SACK:
     echo
     echo **** HANDS TOO DAMAGED TO GET SACK?!
     echo **** STOWING SACK UNTIL LATER
     echo
     gosub stowing
     goto DONE.REPAIR
####################################################################
STOW_REPAIR_ITEM:
     pause 0.1
     if matchre("$righthand $lefthand", "(heavy steel|polished brass|thick copper|bronze|steel|dark|rippled|desert-tan steel|washed|pink|gloomwood|haralun|bark|coral|golden) katavdar") then gosub KAT_RESET
     if matchre("$righthand $lefthand", "exoskeletal (ritual dagger|sword|mace|rapier|maul|scimitar|longsword|katar|claymore|broadsword|axe|bludgeon|hammer|nightstick|pike|halberd|morning star|battle axe)") then gosub EXO_RESET
     pause 0.1
     gosub SHEATH_CHECK
     pause 0.01
     if matchre("$lefthand $righthand", "(?i)%PARRYSTICK") then send wear my %PARRYSTICK
     if matchre("$lefthand $righthand", "(?i)(%MyShield|%CHEST.ARMOR|%HEAD.ARMOR|%FACE.ARMOR|%HEAD.ARMOR|%ARM.ARMOR|%LEG.ARMOR|%HAND.ARMOR|%BACK.ARMOR|%ABDOMEN.ARMOR|%KNUCKLE)") then gosub WEAR $1
     pause 0.01
     if (!matchre("$righthand", "sack") && matchre("$righthand", "(?i)%Wear.Weapons")) then put wear my %Item
     if (!matchre("$lefthand", "sack") && matchre("$lefthand", "(?i)%Wear.Weapons")) then put wear my %Item
     pause 0.01
     if (matchre("$righthand", "sack") && matchre("$lefthand", "Empty")) then return
     if (matchre("$lefthand", "sack") && matchre("$righthand", "Empty")) then return
     pause 0.1
     pause 0.2
     if (!matchre("$righthand", "sack") && !matchre("$righthand", "Empty")) then put put my %Item in my $UC_Container.Sheath
     if (!matchre("$lefthand", "sack") && !matchre("$lefthand", "Empty")) then put put my %Item in my $UC_Container.Sheath
     pause 0.2
     if (matchre("$righthand", "sack") && matchre("$lefthand", "Empty")) then return
     if (matchre("$lefthand", "sack") && matchre("$righthand", "Empty")) then return
     pause 0.2
     if (!matchre("$righthand", "sack") && !matchre("$righthand", "Empty")) then put put my %Item in my $UC_Container
     if (!matchre("$lefthand", "sack") && !matchre("$lefthand", "Empty")) then put put my %Item in my $UC_Container
     pause 0.1
     if (!matchre("$righthand", "sack") && !matchre("$righthand", "Empty")) then gosub PUT put my %Item in my $UC_Container.Box
     if (!matchre("$lefthand", "sack") && !matchre("$lefthand", "Empty")) then gosub PUT put my %Item in my $UC_Container.Box
     pause 0.1
     if (matchre("$righthand", "sack") && matchre("$lefthand", "Empty")) then return
     if (matchre("$lefthand", "sack") && matchre("$righthand", "Empty")) then return
     pause 0.1
     if (!matchre("$righthand", "sack") && !matchre("$righthand", "Empty")) then gosub PUT put my %Item in my $UC_Container.Backup
     if (!matchre("$lefthand", "sack") && !matchre("$lefthand", "Empty")) then gosub PUT put my %Item in my $UC_Container.Backup
     pause 0.1
     pause 0.1
     if (!matchre("$righthand", "sack") && !matchre("$righthand", "Empty")) then put wear my %Item
     if (!matchre("$lefthand", "sack") && !matchre("$lefthand", "Empty")) then put wear my %Item
     pause 0.2
     if ((!matchre("$righthand", "sack") && !matchre("$righthand", "Empty")) || (!matchre("$lefthand", "sack") && !matchre("$lefthand", "Empty"))) then goto BAG_ERROR
     return

SackDone:
     var righthanditem NULL
     var lefthanditem NULL
     pause 0.1
     if matchre("$lefthand", "sack") then var lefthanditem #$lefthandid
     if matchre("$righthand", "sack") then var righthanditem #$righthandid
     pause 0.2
     if matchre("$righthand $lefthand", "sack") then
          {
               gosub DUMPSTER_CHECK
               pause 0.3
               if ("%dumpster" != "NULL") then
                    {
                              if !matchre("%lefthanditem", "NULL") then gosub PUT put %lefthanditem in %dumpster
                              if !matchre("%righthanditem", "NULL") then gosub PUT put %righthanditem in %dumpster
                    }
               pause 0.1
               if (("%dumpster" = "NULL") || (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty"))) then
                    {
                              if !matchre("%lefthanditem", "NULL") then put drop %lefthanditem
                              if !matchre("%righthanditem", "NULL") then put drop %righthanditem
                              pause 0.3
                              pause 0.3
                    }
               pause 0.2
          }
     pause 0.2
     send get my large sack
     wait
     pause 0.2
     pause 0.1
     if matchre("$righthand $lefthand", "sack") then goto Check.Item
     send get my small sack
     wait
     pause 0.2
     pause 0.1
     if matchre("$righthand $lefthand", "sack") then goto Check.Item
     goto Get.Ticket
Repair.Fail:
     echo #########################
     echo *** REPAIR FAILURE!
     echo *** Still items left in the sack!
     echo ########################
     put #echo >Log #ff9933 ** Repair Error! Still items left in small sack!
     pause 0.5
     gosub stowing
     pause 0.5
     action remove ^In the .+ you see (.*)\.
     goto DONE.REPAIR
DONE.REPAIR:
     put #parse REPAIR DONE
     put #parse REPAIR DONE!
     put #parse REPAIR DONE!
     action remove ^In the .+ you see (.*)\.
     return
#version 2.0
LISTEXTRACT:
     var NounListVar $2
     var ListVar $1
     var ItemCountVar $3
     eval %ListVar replace("%%ListVar", ", ", "|")
     eval %ListVar replacere("%%ListVar", "( and )(?:a |an |some )(?!.*and (a |an |some ))","|")
     var %ListVar |%%ListVar
     eval %ItemCountVar count("%%ListVar", "|")
     var %NounListVar %%ListVar
     return
LISTEXTRACT.LOOP.TRIM:
     eval %NounListVar replacere ("%%NounListVar", " with a .+ on it", "|")
     eval %NounListVar replacere ("%%NounListVar", "\|[\w'-]+ ", "|")
     if contains("%%NounListVar", " ") then goto ListExtract.Loop.Trim
     eval NounList replace("%NounList", "||", "|")
     eval NounList replace("%NounList", "||", "|")
     return
LISTEXTRACTFULL:
     var NounListVar $2
     var ListVar $1
     var ItemCountVar $3
     eval %ListVar replace("%%ListVar", ", ", "|")
     eval %ListVar replacere("%%ListVar", "( and )(?:a |an |some )(?!.*and (a |an |some ))","|")
     var %ListVar |%%ListVar
     eval %ItemCountVar count("%%ListVar", "|")
     var %NounListVar %%ListVar
LISTEXTRACT.LOOP.TRIM2:
     eval %NounListVar replacere ("%%NounListVar", "\|[\w'-]+ ", "|")
     if contains("%%NounListVar", " ") then goto LISTEXTRACT.LOOP.TRIM2
     eval NounList replace("%NounList", "||", "|")
     eval NounList replace("%NounList", "||", "|")
     return
ITEM_STRIP:
     eval Item replacere("%Item", " (bearing|crafted|inked in|worked in) .+", "")
     eval Item replacere("%Item", " (delicately embroidered) with .+", "")
     eval Item replacere("%Item", " (banded|carved|detailed|emblazoned|embroidered|embossed|engraved|fit|inlaid|inset|painted|secured|set|tied|tinted|topped|trimmed) with .+", "")
     eval Item replacere("%Item", " with a .+ on it", "")
     eval Item replacere("%Item", " with .+", "")
     eval Item replacere("%Item", " polished to a sheen", "")
     eval Item replacere("%Item", " of unpolished .+", "")
     eval Item replacere("%Item", " in the form of a woman", "")
     eval Item replacere("%Item", " of viscous gloop", "")
     eval Item replacere("%Item", "\ba ", "")
     # STRIP TO VERY ROOT NOUN AFTER TAKING OFF ANY DESCRIPTORS - MAYBE REMOVE THIS??!!
     eval Item replacere("%Item", "([\w'-]+\s){0,5}", "")
     return
############################################################################################
# REPAIR WEAPONS MODULE
############################################################################################
REPAIR_WEAPONS:
     action put #var UC_repairCost {#evalmath ($UC_repairCost + $1)};put #var UC_repairCurrency $2 when ^\s*You\s+hand\s+\S+\s+(\d+)\s+(Kronars?|Dokoras?|Lirums?|kronars?|dokoras?|lirums?)\s+and\s+
REAPAIR_WEAPON_2:
     if !matchre("%MyShield", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item %MyShield
               gosub REPAIR_IT
          }
     if !matchre("%Light_Armor.Helm", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item %Light_Armor.Helm
               gosub REPAIR_IT
          }
     if !matchre("%Chain_Armor.Helm", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item %Chain_Armor.Helm
               gosub REPAIR_IT
          }
     if !matchre("%Light_Armor.Helm", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item %Light_Armor.Helm
               gosub REPAIR_IT
          }
     if !matchre("%Brigandine.Helm ", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item %Brigandine.Helm
               gosub REPAIR_IT
          }
     if !matchre("%Plate_Armor.Helm", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item %Plate_Armor.Helm
               gosub REPAIR_IT
          }
     if !matchre("%LIGHTARMOR1", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item %LIGHTARMOR1
               gosub REPAIR_IT
          }
     if !matchre("%LIGHTARMOR2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item %LIGHTARMOR2
               gosub REPAIR_IT
          }
     if !matchre("%LIGHTARMOR3", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item %LIGHTARMOR3
               gosub REPAIR_IT
          }
     if !matchre("%LIGHTARMOR4", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item %LIGHTARMOR4
               gosub REPAIR_IT
          }
     if !matchre("%KNUCKLE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item %KNUCKLE
               gosub REPAIR_IT
          }
     if !matchre("%PARRYSTICK", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item %PARRYSTICK
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_SE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_SE
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_OH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_OH
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_BS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_BS
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_LE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_LE
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_THE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_THE
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_SB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_SB
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_LB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_LB
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_THB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_THB
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_STAVES", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_STAVES
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_POLEARMS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_POLEARMS
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_LT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_LT
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_HT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_HT
               gosub REPAIR_IT
          }
     action remove ^\s*You\s+hand\s+\S+\s+(\d+)\s+(Kronars?|Dokoras?|Lirums?|kronars?|dokoras?|lirums?)\s+and\s+
     return

REPAIR_WEAPONS_2:
     action put #var UC_repairCost {#evalmath ($UC_repairCost + $1)};put #var UC_repairCurrency $2 when ^\s*You\s+hand\s+\S+\s+(\d+)\s+(Kronars?|Dokoras?|Lirums?|kronars?|dokoras?|lirums?)\s+and\s+
     if !matchre("$UC_WEAPON_CROSSBOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_CROSSBOW
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_BOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_BOW
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_SLING
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_SB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_SB
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_LB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_LB
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_STAVES", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_STAVES
               gosub REPAIR_IT
          }
     if !matchre("$UC_WEAPON_OH", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then
          {
               var item $UC_WEAPON_OH
               gosub REPAIR_IT
          }
     action remove ^\s*You\s+hand\s+\S+\s+(\d+)\s+(Kronars?|Dokoras?|Lirums?|kronars?|dokoras?|lirums?)\s+and\s+
     return
REPAIR_IT:
     pause 0.1
     if ($invisible = 1) then gosub STOP_INVIS
     if matchre("$lefthand", "ticket") then gosub STOWIT ticket
     gosub GET my %item
     pause 0.2
     pause 0.1
     if matchre("$righthand", "icy-blue blade") then
          {
               echo *** REPAIRING ICY-BLUE BLADE WITH MAGIC!
               pause 0.2
               put rub my icy-blue blade
               pause 20
               pause 21
               gosub SHEATH_CHECK
               if matchre("$righthand", "blade") then gosub STOWIT blade
               return
          }
     gosub EXO_CHECK
     if matchre("$righthandnoun", "(crossbow|bow|short bow|sling|arbalest|slurbow|longbow)") then gosub UNLOAD
     pause 0.1
     gosub PUT give my %item to %Name
     gosub PUT give my %item to %Name
     pause 0.1
     if !matchre("$righthand", "Empty") then gosub STOWIT right
     if !matchre("$lefthand", "Empty") then gosub STOWIT left
     return
#######################################################################################################################################
#### END REPAIR LOGIC
#######################################################################################################################################
HEALTH_WALK:
HEALTHWALK:
     var walkloop 0
     var roomloop 0
     var percrooms 5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24
     var healthwalk 1
     var nextroom %percrooms(0)
     ## if ($Empathy.Ranks < 60) then goto EMPATHY_ERROR
     if ("$guild" = "Empath") then
          {
               echo #######################
               echo ** EMPATH HEALTH WALK!
               echo #######################
          }
     if ("$guild" != "Empath") then
          {
               echo ##################
               echo ** POWER WALKING!
               echo ##################
          }
     if ("$guild" = "Necromancer") then
          {
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               if (($spellEOTB = 0) && matchre("%abbrevs", "(?i)EOTB")) then gosub EOTB
          }
     if (%Playing = 1) then put stop play
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     pause 0.1
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "40") then gosub AUTOMOVE theren
     if ("$zoneid" = "1") then goto XING_WALK
     if ("$zoneid" = "30") then goto HAVEN_WALK
     if ("$zoneid" = "42") then goto THEREN_WALK
     # if ("$zoneid" = "47") then goto MUSPARI_WALK
     if ("$zoneid" = "61") then goto LETH_WALK
     if ("$zoneid" = "67") then goto SHARD_WALK
     # if ("$zoneid" = "90") then goto RATHA_WALK
     # if ("$zoneid" = "99") then goto AESRY_WALK
     # if ("$zoneid" = "107") then goto MERK_WALK
     if ("$zoneid" = "116") then goto HIB_WALK
     if ("$zoneid" = "150") then goto FANG_WALK
     echo ##############################################
     echo ** UNSUPPORTED / UNRECOGNIZED LOCATION
     echo ** FOR EMPATH HEALTH WALK / POWER PERC WALK
     echo ##############################################
     pause
     return
EMPATHY_ERROR:
     echo ##############################################
     echo ** NOT ENOUGH EMPATHY TO PERCEIVE NPCs! (~60+)
     echo ** GO SIT IN SOME EMPATHY CLASSES!
     echo ** USE .ubercombat NOOB
     echo ** To train in one single room
     echo ##############################################
     pause
     return
XING_WALK:
     math walkloop add 1
     if ("$guild" = "Necromancer") then
          {
               gosub AUTOMOVE east
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               # if (($spellEOTB = 0) && matchre("%abbrevs", "(?i)EOTB")) then gosub EOTB
          }
     if matchre("$zoneid","\b(2|4|6|7|8)\b") then gosub AUTOMOVE cross
     gosub TOWNRUN_TIMERS
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if matchre("$zoneid","\b(2|4|6|7|8)\b") then gosub AUTOMOVE cross
     gosub HEALTH_WALKING bottom
     gosub HEALTH_WALKING elite
     gosub HEALTH_WALKING marble
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if matchre("$zoneid","\b(2|4|6|7|8)\b") then gosub AUTOMOVE cross
     gosub HEALTH_WALKING carpet
     gosub HEALTH_WALKING bundle
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING tanner
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     gosub HEALTH_WALKING locks
     gosub HEALTH_WALKING music
     gosub HEALTH_WALKING durantine
     gosub HEALTH_WALKING floors
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING braziers
     gosub HEALTH_WALKING windows
     gosub HEALTH_WALKING herilo
     gosub HEALTH_WALKING exterior
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING doors
     gosub HEALTH_WALKING pawn
     send out
     pause 0.5
     gosub HEALTH_WALKING chiz
     gosub HEALTH_WALKING herbs
     gosub HEALTH_WALKING healer
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING florist
     gosub HEALTH_WALKING weapon
     gosub HEALTH_WALKING armor
     gosub HEALTH_WALKING general
     gosub HEALTH_WALKING card
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING catrox
     gosub HEALTH_WALKING shoe
     if (%walkloop > 2) then goto HEALTH_WALK_DONE
     if ($Attunement.LearningRate > 30) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate < 30)) then goto XING_WALK
     if (("$guild" != "Empath") && ($Attunement.LearningRate < 30)) then goto XING_WALK
     goto HEALTH_WALK_DONE
HAVEN_WALK:
     math walkloop add 1
     if ("$guild" = "Necromancer") then
          {
               gosub AUTOMOVE E Gate
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               # if (($spellEOTB = 0) && matchre("%abbrevs", "(?i)EOTB")) then gosub EOTB
          }
     if matchre("$zoneid","\b(31|32|33)\b") then gosub AUTOMOVE river
     if matchre("$zoneid","\b(31|32|33)\b") then gosub AUTOMOVE river
     gosub TOWNRUN_TIMERS
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     gosub HEALTH_WALKING healer
     gosub HEALTH_WALKING 152
     gosub HEALTH_WALKING 150
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     gosub HEALTH_WALKING samlet
     gosub HEALTH_WALKING jelna
     gosub HEALTH_WALKING 25
     if (%Playing = 0) then gosub PLAY
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING karaz
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     gosub HEALTH_WALKING 158
     gosub HEALTH_WALKING 320
     gosub HEALTH_WALKING bed
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING artif
     gosub HEALTH_WALKING locks
     gosub HEALTH_WALKING smara
     gosub HEALTH_WALKING mirglyn
     gosub HEALTH_WALKING touch
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING seli
     gosub HEALTH_WALKING wyla
     gosub HEALTH_WALKING unspiek
     gosub HEALTH_WALKING noel
     gosub HEALTH_WALKING pawn
     send out
     pause 0.5
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING gem
     gosub HEALTH_WALKING bundle
     gosub HEALTH_WALKING 241
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING door
     gosub HEALTH_WALKING saltfish
     gosub HEALTH_WALKING driftwood
     gosub HEALTH_WALKING fays
     if (%walkloop > 2) then goto HEALTH_WALK_DONE
     if ($Attunement.LearningRate > 30) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate < 30)) then goto HAVEN_WALK
     if (("$guild" != "Empath") && ($Attunement.LearningRate < 30)) then goto HAVEN_WALK
     goto HEALTH_WALK_DONE
THEREN_WALK:
     math walkloop add 1
     if ("$guild" = "Necromancer") then
          {
               gosub AUTOMOVE gate
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               # if (($spellEOTB = 0) && matchre("%abbrevs", "(?i)EOTB")) then gosub EOTB
          }
     if matchre("$zoneid","\b(40|41)\b") then gosub AUTOMOVE theren
     gosub TOWNRUN_TIMERS
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     gosub HEALTH_WALKING healer
     gosub HEALTH_WALKING vault
     gosub HEALTH_WALKING clothing
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     gosub HEALTH_WALKING 38
     gosub HEALTH_WALKING engrave
     gosub HEALTH_WALKING smith
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING krrish
     gosub HEALTH_WALKING fireplace
     gosub HEALTH_WALKING 212
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     gosub HEALTH_WALKING 211
     gosub HEALTH_WALKING 210
     gosub HEALTH_WALKING 209
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING gems
     gosub HEALTH_WALKING pawn
     send out
     pause 0.5
     gosub HEALTH_WALKING 170
     gosub HEALTH_WALKING 169
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     gosub HEALTH_WALKING courtly
     gosub HEALTH_WALKING painting
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING nongwen
     gosub HEALTH_WALKING passport
     gosub HEALTH_WALKING genea
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     gosub HEALTH_WALKING citizen
     gosub HEALTH_WALKING gilbair
     gosub HEALTH_WALKING carpent
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (%walkloop > 2) then goto HEALTH_WALK_DONE
     if ($Attunement.LearningRate > 29) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate < 30)) then goto THEREN_WALK
     if (("$guild" != "Empath") && ($Attunement.LearningRate < 30)) then goto THEREN_WALK
     goto HEALTH_WALK_DONE
LETH_WALK:
     math walkloop add 1
     if ("$guild" = "Necromancer") then
          {
               gosub AUTOMOVE crossing
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               # if (($spellEOTB = 0) && matchre("%abbrevs", "(?i)EOTB")) then gosub EOTB
          }
     if ("$zoneid" != "61") then gosub AUTOMOVE leth
     gosub TOWNRUN_TIMERS
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     gosub HEALTH_WALKING healer
     gosub HEALTH_WALKING portal
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     gosub HEALTH_WALKING perfume
     gosub HEALTH_WALKING trader
     gosub HEALTH_WALKING 187
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING taproot
     gosub HEALTH_WALKING 73
     gosub HEALTH_WALKING bows
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if ($UC_Premium = 1) then gosub HEALTH_WALKING 238
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING vault
     gosub HEALTH_WALKING registrar
     gosub HEALTH_WALKING dove
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING doors
     gosub HEALTH_WALKING sinysa
     gosub HEALTH_WALKING music
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING 153
     gosub HEALTH_WALKING weapon
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 30)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING chestnut
     gosub HEALTH_WALKING observatory
     if (%walkloop > 3) then goto HEALTH_WALK_DONE
     if ($Attunement.LearningRate > 29) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate < 30)) then goto LETH_WALK
     if (("$guild" != "Empath") && ($Attunement.LearningRate < 30)) then goto LETH_WALK
     goto HEALTH_WALK_DONE
SHARD_WALK:
     gosub TIME_CHECK
     math walkloop add 1
     if ("$guild" = "Necromancer") then
          {
               gosub AUTOMOVE east
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               # if (($spellEOTB = 0) && matchre("%abbrevs", "(?i)EOTB")) then gosub EOTB
          }
     gosub TOWNRUN_TIMERS
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     gosub HEALTH_WALKING 490
     gosub HEALTH_WALKING zerek
     gosub HEALTH_WALKING gems
     gosub HEALTH_WALKING 385
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING herbs
     gosub HEALTH_WALKING healer
     gosub HEALTH_WALKING 53
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (($UC_shardCitizen = 0) && ("%TIME" = "NIGHT")) then goto SHARD_WALK_2
     gosub HEALTH_WALKING fiona
     gosub HEALTH_WALKING genev
SHARD_WALK_2:
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     gosub HEALTH_WALKING milene
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING pawn
     send out
     pause 0.5
     if (($UC_shardCitizen = 0) && ("%TIME" = "NIGHT")) then goto SHARD_WALK_3
     gosub HEALTH_WALKING bows
     send out
     pause 0.5
     pause 0.2
SHARD_WALK_3:
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     gosub HEALTH_WALKING snow
     if (($UC_shardCitizen = 0) && ("%TIME" = "NIGHT")) then goto SHARD_WALK_4
     gosub HEALTH_WALKING armor
SHARD_WALK_4:
     if ("$guild" = "Necromancer") then
          {
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               # if (($spellEOTB = 0) && matchre("%abbrevs", "(?i)EOTB")) then gosub EOTB
          }
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING macfra
     gosub HEALTH_WALKING barman
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (($UC_shardCitizen = 0) && ("%TIME" = "NIGHT")) then goto SHARD_WALK_5
     gosub HEALTH_WALKING malik
     gosub HEALTH_WALKING locks
     gosub HEALTH_WALKING artif
SHARD_WALK_5:
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING 463
     gosub HEALTH_WALKING 81
     gosub HEALTH_WALKING seats
     gosub HEALTH_WALKING 487
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING flawless
     gosub HEALTH_WALKING 43
     gosub HEALTH_WALKING 1
     gosub HEALTH_WALKING 32
     gosub HEALTH_WALKING glassus
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     gosub AUTOMOVE 85
     gosub AUTOMOVE 89
     gosub HEALTH_WALKING sister
     gosub AUTOMOVE 86
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING curious
     gosub HEALTH_WALKING barber
     gosub HEALTH_WALKING casino
     gosub HEALTH_WALKING lyle
     gosub HEALTH_WALKING herald
     gosub HEALTH_WALKING dira
     if (%walkloop > 2) then goto HEALTH_WALK_DONE
     if ($Attunement.LearningRate > 29) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate < 29)) then goto SHARD_WALK
     if (("$guild" != "Empath") && ($Attunement.LearningRate < 30)) then goto SHARD_WALK
     goto HEALTH_WALK_DONE
HIB_WALK:
     math walkloop add 1
     if ("$guild" = "Necromancer") then
          {
               gosub AUTOMOVE raven
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               # if (($spellEOTB = 0) && matchre("%abbrevs", "(?i)EOTB")) then gosub EOTB
          }
     gosub TOWNRUN_TIMERS
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     gosub HEALTH_WALKING healer
     gosub HEALTH_WALKING pet
     gosub HEALTH_WALKING gems
     gosub HEALTH_WALKING clothing
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     if (%Playing = 0) then gosub PLAY
     gosub HEALTH_WALKING vault
     gosub HEALTH_WALKING shield
     gosub HEALTH_WALKING citizen
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING 199
     gosub HEALTH_WALKING pawn
     send out
     pause 0.5
     gosub HEALTH_WALKING raelem
     gosub HEALTH_WALKING 236
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (%Playing = 0) then gosub PLAY
     gosub HEALTH_WALKING 232
     gosub HEALTH_WALKING kwint
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING grocer
     gosub HEALTH_WALKING toggery
     gosub HEALTH_WALKING cherulisa
     gosub HEALTH_WALKING yazi
     gosub HEALTH_WALKING darius
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING jorent
     gosub HEALTH_WALKING dagreth
     gosub HEALTH_WALKING tawk
     if (%walkloop > 3) then goto HEALTH_WALK_DONE
     if ($Attunement.LearningRate > 29) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate < 30)) then goto HIB_WALK
     if (("$guild" != "Empath") && ($Attunement.LearningRate < 30)) then goto HIB_WALK
     goto HEALTH_WALK_DONE
FANG_WALK:
     math walkloop add 1
     if ("$guild" = "Necromancer") then
          {
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               # if (($spellEOTB = 0) && matchre("%abbrevs", "(?i)EOTB")) then gosub EOTB
          }
     gosub TOWNRUN_TIMERS
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING 89
     gosub HEALTH_WALKING 85
     gosub HEALTH_WALKING vault
     gosub HEALTH_WALKING 225
     gosub HEALTH_WALKING thazz
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING 132
     gosub HEALTH_WALKING 7
     gosub HEALTH_WALKING gems
     gosub HEALTH_WALKING armor
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING weapon
     gosub HEALTH_WALKING furs
     gosub HEALTH_WALKING healer
     gosub HEALTH_WALKING 9
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (%walkloop > 3) then goto HEALTH_WALK_DONE
     if ($Attunement.LearningRate > 29) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate < 30)) then goto FANG_WALK
     if (("$guild" != "Empath") && ($Attunement.LearningRate < 30)) then goto FANG_WALK
     goto HEALTH_WALK_DONE
MUSPARI_WALK:
     math walkloop add 1
     if ("$guild" = "Necromancer") then
          {
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               # if (($spellEOTB = 0) && matchre("%abbrevs", "(?i)EOTB")) then gosub EOTB
          }
     gosub TOWNRUN_TIMERS
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     gosub HEALTH_WALKING 330
     gosub HEALTH_WALKING 329
     gosub HEALTH_WALKING 328
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING 327
     gosub HEALTH_WALKING 325
     gosub HEALTH_WALKING 324
     gosub HEALTH_WALKING 323
     gosub HEALTH_WALKING 322
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING 314
     gosub HEALTH_WALKING 313
     gosub HEALTH_WALKING 312
     gosub HEALTH_WALKING 311
     gosub HEALTH_WALKING 310
     gosub HEALTH_WALKING 309
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING 59
     gosub HEALTH_WALKING 57
     gosub HEALTH_WALKING 266
     gosub HEALTH_WALKING 263
     gosub HEALTH_WALKING 264
     gosub HEALTH_WALKING 262
     gosub HEALTH_WALKING 261
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     if ("$guild" = "Necromancer") then
          {
               if (($spellROC = 0) && ($spellROG = 0)) then gosub ROC
               if (($spellEOTB = 0) && matchre("%abbrevs", "(?i)EOTB")) then gosub EOTB
          }
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     if (("$guild" != "Empath") && ($Attunement.LearningRate > 30)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING 251
     gosub HEALTH_WALKING 252
     gosub HEALTH_WALKING 250
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     gosub HEALTH_WALKING 246
     gosub HEALTH_WALKING 248
     gosub HEALTH_WALKING 247
     gosub HEALTH_WALKING 1
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate > 33)) then goto HEALTH_WALK_DONE
     gosub HEALTH_WALKING 150
     gosub HEALTH_WALKING 151
     gosub HEALTH_WALKING 153
     gosub HEALTH_WALKING 149
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     gosub HEALTH_WALKING 148
     gosub HEALTH_WALKING 147
     gosub HEALTH_WALKING 146
     gosub HEALTH_WALKING 145
     if ($Attunement.LearningRate > 29) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60) && ($Attunement.LearningRate > 28)) then goto HEALTH_WALK_DONE
     if (("$guild" = "Empath") && ($Empathy.LearningRate < 30)) then goto MUSPARI_WALK
     if (("$guild" != "Empath") && ($Attunement.LearningRate < 30)) then goto MUSPARI_WALK
     if (%walkloop > 2) then goto HEALTH_WALK_DONE
     goto HEALTH_WALK_DONE
##############################
HEALTH_WALKING:
     var healthwalk 1
     var place $1
     var nextroom %percrooms(%roomloop)
     pause 0.1
     if !matchre("$guild", "Empath") then
          {
               echo ** Next Room: %nextroom
               gosub AUTOMOVE %nextroom
               goto HEALTH_WALKING_1
          }
     gosub AUTOMOVE %place
HEALTH_WALKING_1:
     math roomloop add 1
     pause 0.1
     if (%roomloop > 19) then
          {
               var roomloop 0
          }
     if (%Playing = 1) then gosub STOP_PLAY
     if !($standing) then gosub STAND
     if !matchre("$guild", "Empath") then
          {
               gosub PERCEIVE
               pause 5
               return
          }
     if (("$guild" = "Empath") && ($Empathy.Ranks < 60)) then goto HEALTH_WALK_RETURN
     matchre HEALTH_WALK_WAIT ^You\'re not ready to do that again\, yet
     matchre HEALTH_WALK_RETURN ^You sense|^You fail to sense anything, however
     send perceive health
     matchwait 7
HEALTH_WALK_RETURN:
     pause
     pause 0.5
     echo
     echo *** Killing some time between Perceive Health cooldown
     echo
     put perceive mana
     pause 8
     pause
     if ($out) then gosub MOVE out
     gosub RANDOMMOVE
     pause 0.2
     put perceive mana
     pause 5
     gosub RANDOMMOVE
     pause 0.2
     put perceive mana
     pause 5
     return
HEALTH_WALK_WAIT:
     echo *** waiting...
     pause 10
     goto HEALTH_WALKING_1

HEALTH_WALK_DONE:
     if ("$guild" != "Empath") then
          {
               echo #######################
               echo ** POWER WALK COMPLETE!
               echo #######################
               put #echo >Log #00f9ff *** POWER WALK - Attunement: $Attunement.Ranks $Attunement.LearningRate/34
          }
     if ("$guild" = "Empath") then
          {
               echo #############################
               echo ** EMPATH HEALTH WALK COMPLETE!
               echo #############################
               put #echo >Log #00f9ff *** EMPATH HEALTH WALK - Empathy: $Empathy.Ranks $Empathy.LearningRate/34
          }
     pause 0.1
     unvar walkloop
     unvar roomloop
     unvar percrooms
     unvar nextroom
     var healthwalk 0
     return
#########################################################
CLIMBSHARD:
CLIMB_SHARD:
     #Climbing in Shard by Shroom
     if ($Outdoorsmanship.Ranks < 200) then var Collect grass
     if (($Outdoorsmanship.Ranks >= 200) && ($Outdoorsmanship.Ranks < 1200)) then var Collect rock
     if ($Outdoorsmanship.Ranks >= 1200) then var Collect coin
     var maxLoops 10
     var weapon1 $UC_WEAPON_SE
     var weapon2 $UC_WEAPON_SB
     ## END VARIABLES
     ########################
     var LOOP 0
     var shardloops 0
     gosub stowing
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     # echo
     # echo *** START ANYWHERE INSIDE OR AROUND SHARD
     # echo
     ## Add weapons here to make climbing harder for higher ranks
     if ($Athletics.Ranks > 600) then send get %weapon1
     pause 0.3
     pause 0.1
     if ($Athletics.Ranks > 650) then send get %weapon2
     pause 0.5
     pause 0.2
     pause 0.1
     if ($Athletics.Ranks > 1000) then
          {
               echo *** OVER 1000 Athletics Ranks!
               echo *** Going to train climbing outside the west gate on Wyvern Peak
               goto WESTGATE_TRAINING
          }
     if ($Athletics.Ranks <= 500) then
         {
          if !contains("$righthandnoun $lefthandnoun", "rope") then
               {
               pause 0.001
               pause 0.1
               send get my braided rope
               pause 0.2
               send uncoil my braided rope
               pause 0.5
               pause 0.5
               }
          if !contains("$righthandnoun $lefthandnoun", "rope") then
               {
               pause 0.001
               pause 0.1
               send get my heavy rope
               pause 0.2
               send uncoil my heavy rope
               pause 0.5
               pause 0.5
               }
         }
     if ("$guild" = "Thief") then
          {
               send khri start focus flight
               pause
               pause 0.5
               pause 0.2
               pause 0.1
          }
     if ("$guild" = "Moon Mage") then
          {
               send prep symbiosis explore
               pause 0.5
               pause 0.2
               send prep shadows 5
               pause 2
               send charge my %Cambrinth 5
               pause 2
               pause 0.5
               send invoke my %Cambrinth
               pause 14
               send cast
          }
CLIMBSHARD_GO:
     var location Undergondola
     if ($Athletics.LearningRate >= 29) then goto DONECLIMB_SHARD
     if (%shardloops >= %maxLoops) then goto DONECLIMB_SHARD
     echo
     echo *** STARTING CLIMBING SESSION %shardloops ***
     echo
     math shardloops add 1
     if (%Playing = 0) then gosub PLAY
     pause 0.3
     if ($Athletics.Ranks < 200) then goto SHARD_WALLS
SHARD_TO_UNDER:
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "66") then gosub AUTOMOVE waterfall
UNDER_TO_PRACTICE:
     ### SKIP GOING INTO BLADE SPIDERS/TWISTING GROTTO IF LOW ATHLETICS
     if ($Athletics.Ranks < 290) then
          {
               gosub AUTOMOVE 40
               goto BRANCH_CHECK
          }
     ### GO ONE ROOM FURTHER INTO BLADE SPIDERS FOR EXTRA CLIMB XP
     gosub AUTOMOVE 50
     pause 0.2
BRANCH_CHECK:
     ## SKIP STRAIGHT TO BRANCH TRAIN IF HIGH ATHLETICS
     if ($Athletics.Ranks > 450) then goto TO_BRANCH
     goto BACK_TO_START
#######################################################################
TO_BRANCH:
     gosub AUTOMOVE 26
     if ($Athletics.Ranks < 520) then
          {
               matchre BRANCH2 ^(The|This) climb is too difficult
               matchre BRANCH2 ^You (stop|finish)
               matchre BRANCH2 ^You are engaged
               put climb practice wall
               matchwait 120
               goto BRANCH2
          }
     if ($Athletics.Ranks > 500) then gosub AUTOMOVE 43
     if ($Athletics.Ranks < 520) then
          {
               matchre BRANCH2 ^(The|This) climb is too difficult
               matchre BRANCH2 ^You (stop|finish)
               matchre BRANCH2 ^You are engaged
               put climb practice ledge
               matchwait 120
               goto BRANCH2
          }
BRANCH2:
     action remove ^You are engaged
     put stop climb
     pause 0.5
     pause 0.1
     send ret;ret
     pause 0.5
     if ($Athletics.Ranks >= 540) then gosub AUTOMOVE 42
     #### SKIP CLIMBING NICHE IF UNDER <540
     if ($Athletics.Ranks < 540) then goto BRANCH_CONT_2
     pause 0.5
     gosub AUTOMOVE 41
     pause 0.5
     if ($Athletics.Ranks < 560) then put app branch
     pause
     pause
     if ($Athletics.Ranks < 750) then
          {
               matchre BRANCH_CONT ^(The|This) climb is too difficult
               matchre BRANCH_CONT ^You (stop|finish)
               matchre BRANCH_CONT ^You are engaged
               put climb practice branch
               matchwait 120
               goto BRANCH_CONT
          }
BRANCH_CONT:
     action remove ^You are engaged
     var LOOP 0
     put stop climb
     pause 0.5
     pause 0.1
     send ret;ret
     pause 0.5
BRANCH_CONT_2:
     ### FINAL TRAINING - CLIMB THE BRANCH IF HIGH ENOUGH ATHLETICS
     if ($Athletics.Ranks >= 580) then
          {
               if ("$zoneid" = "65") then gosub AUTOMOVE cross
               pause
               if ("$zoneid" = "62") then gosub AUTOMOVE under
          }
     if ("$zoneid" = "62") then gosub AUTOMOVE under
     gosub AUTOMOVE 23
     pause 0.5
     gosub AUTOMOVE 15
     goto TO_RESET
##########################
BACK_TO_START:
     gosub AUTOMOVE 26
     pause 0.5
     if (($Athletics.Ranks < 450) && ($Athletics.Ranks > 190)) then
          {
               echo
               echo **** PRACTICING CLIMBING
               echo
               matchre ESCAPE_SHARDCLIMB ^(The|This) climb is too difficult
               matchre ESCAPE_SHARDCLIMB ^You (stop|finish)
               matchre ESCAPE_SHARDCLIMB ^You are engaged
               put climb practice wall
               matchwait 120
               goto ESCAPE_SHARDCLIMB
          }
     goto TO_RESET
ESCAPE_SHARDCLIMB:
     send stop climb
     pause 0.1
     pause 0.1
     send ret;ret
     pause 0.2
     pause 0.1
     goto TO_RESET
##########################
TO_RESET:
     gosub AUTOMOVE 2
     pause 0.5
     pause 0.1
     if !matchre("$lefthand", "Empty") then
          {
               put STOW $lefthandnoun
               pause 0.5
          }
     pause 0.2
     if (%Playing = 1) then gosub STOP_PLAY
     echo ##################
     echo ** Collecting Coins/Rocks
     echo ** Waiting for Climbing Cooldown
     echo ##################
     pause 0.5
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     send collect %Collect
     pause 3
     pause
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     pause 0.1
     send collect %Collect
     pause 3
     pause
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     pause 0.4
     if (($Athletics.Ranks > 750) && ("$lefthand" = "Empty")) then
          {
               send get %weapon2
               pause 0.5
          }
     goto CONTINUE_CLIMBSHARD

CONTINUE_CLIMBSHARD:
     if (%shardloops > %maxLoops) then goto LEAVE_UNDERGONDOLA
     if ($Athletics.LearningRate < 28) then
          {
               echo #############
               echo ** RESUMING CLIMBING
               echo #############
               goto CLIMBSHARD_GO
          }
LEAVE_UNDERGONDOLA:
     pause 0.1
     pause 0.1
     if ("$righthandnoun" = "rope") then
          {
               send coil my rope
               send stow my rope
               pause 0.5
               pause 0.4
          }
     if ("$zoneid" = "65") then gosub AUTOMOVE 1
     pause 0.5
     if "$righthandnoun" != "Empty" then put STOW $righthandnoun
     if "$lefthandnoun" != "Empty" then put STOW $lefthandnoun
     pause 0.5
     goto DONECLIMB_SHARD
#############################################################################
SHARD_WALLS:
SHARDWALLS:
var location Shard Walls
     math shardloops add 1
     echo
     echo *** STARTING CLIMBING SESSION %shardloops ***
     echo
     if ($Athletics.LearningRate >= 29) then goto DONECLIMB_SHARD
     echo *** EAST WALL
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     pause 0.1
     if ("$zoneid" = "66") then gosub AUTOMOVE 44
     pause 0.1
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     pause 0.1
     if ("$zoneid" = "66") then gosub AUTOMOVE 44
     pause 0.1
     if (%Playing = 0) then gosub PLAY
     pause 0.3
     put app wall quick
     pause 0.5
     pause
     if ($Athletics.Ranks < 70) then
          {
               matchre SHARD_WALLS_11 ^This climb is too difficult|^You stop
               put climb practice wall
               matchwait 60
               goto SHARD_WALLS_11
          }
     put climb wall
     pause 2
     pause 0.5
SHARD_WALLS_11:
     if ($Athletics.Ranks < 70) then
          {
               put stop climb
               pause 0.5
          }
     if matchre("$roomname" "East Battlements") then
          {
               put climb embras
               pause 0.5
          }
     if matchre("$roomname" "Shard, East Bridge") then goto SHARD_WALLS_2
     pause 0.2
     put south
     pause 0.5
     put climb ladder
     pause 0.5
SHARD_WALLS_2:
     echo **** NORTH WALL
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     pause 0.1
     if ("$zoneid" = "67") then gosub AUTOMOVE 48
     pause 0.2
     if (%Playing = 0) then gosub PLAY
     pause 0.3
     put app wall quick
     pause 0.5
     pause
     if ($Athletics.Ranks < 70) then
          {
               matchre SHARD_WALLS_21 ^(The|This) climb is too difficult|^You stop|^You are engaged|^(The|This) climb is too easy
               put climb practice wall
               matchwait 60
               goto SHARD_WALLS_21
          }
     put climb wall
     pause
     pause 0.5
SHARD_WALLS_21:
     if ($Athletics.Ranks < 70) then
          {
               put stop climb
               pause 0.5
          }
     if matchre("$roomname" "North Battlements") then
          {
               put climb embras
               pause 0.5
               if matchre("$roomname" "North Bridge") then put climb wall
               pause 0.5
          }
     if matchre("$roomname" "Shard, North Bridge") then goto SHARD_WALLS_3
     pause 0.2
     put east
     pause 0.5
     put climb ladder
     pause 0.5
SHARD_WALLS_3:
     echo **** WEST INNER WALL
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "67") then gosub AUTOMOVE 42
     if (%Playing = 0) then gosub PLAY
     pause 0.2
     put app wall quick
     pause 0.5
     pause
     put climb wall
     pause 2
     pause 0.5
     if matchre("$roomname" "West Battlements") then
          {
               put climb embras
               pause 0.5
               if matchre("$roomname" "West Bridge") then put climb wall
               pause 0.5
          }
     if matchre("$roomname" "West Bridge") then goto SHARD_WALLS_4
     pause 0.2
     put north
     pause 0.5
     put climb ladder
     pause 0.5
SHARD_WALLS_4:
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     pause 0.2
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     pause 0.2
     if ("$zoneid" = "67") then gosub AUTOMOVE 228
     if (%Playing = 1) then gosub PUT stop play
     pause 0.2
     if ($Athletics.Ranks < 70) then
          {
               put climb practice embras
               pause 60
          }
     put stop climb
     pause 0.5
     if ($Athletics.LearningRate >= 29) then goto DONECLIMB_SHARD
     goto SHARD_WALLS

WESTGATE_TRAINING:
     var location Wyvern Peak
     math shardloops add 1
     # if ("$guild" = "Thief" then
          # {
          # send khri silence
          # pause 1
          # pause
          # }
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
     if (%Playing = 0) then gosub PLAY
     pause 0.3
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     if ("$zoneid" = "67") then gosub AUTOMOVE east
     pause 0.1
     if ("$zoneid" = "66") then gosub AUTOMOVE west
     pause 0.1
     if ("$zoneid" = "66") then gosub AUTOMOVE w gate
     pause 0.1
     if ("$zoneid" = "69") then gosub AUTOMOVE 464
     pause 0.2
     if ("$zoneid" = "69") then gosub AUTOMOVE 468
     pause 0.2
     if ("$zoneid" = "69") then gosub AUTOMOVE 513
     pause 0.2
     if ("$zoneid" = "69") then gosub AUTOMOVE 509
     pause 0.2
     if ("$zoneid" = "69") then gosub AUTOMOVE 508
     pause 0.2
     if ("$zoneid" = "69") then gosub AUTOMOVE 536
WESTGATE_FORAGE:
     if !matchre("$lefthand", "Empty") then
          {
               put STOW $lefthandnoun
               pause 0.5
          }
     if (%Playing = 1) then gosub STOP_PLAY
     pause 0.3
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     send collect %Collect
     pause 3
     pause
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     send collect %Collect
     pause 3
     pause
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     if $Athletics.LearningRate >= 29 then goto DONECLIMB_SHARD
     if %shardloops > %maxLoops then goto DONECLIMB_SHARD
     goto WESTGATE_TRAINING

DONECLIMB_SHARD:
     put #echo >Log #7FFFD4 *** Trained ATHLETICS - %shardloops loops of %location - $Athletics.Ranks $Athletics.LearningRate / 34  ***
     put stow %weapon1
     pause 0.5
     pause 0.4
     put stow %weapon2
     pause 0.5
     pause 0.5
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     pause 0.1
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     pause 0.1
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     pause 0.1
     put exp
     pause 0.5
     unvar shardloops
     unvar maxLoops
     unvar weapon1
     unvar weapon2
     unvar LOOP
     put #parse CLIMBING DONE
     put #parse DONE CLIMBING
     put #parse CLIMBING LOCKED
     goto CLIMB_DONE
##############################################################################################
## LOCKPICK STOCKING UP
##############################################################################################
GET_LOCKPICKS:
     var lockpicks 0
     if (("$zoneid" = "150") && (%Teleport = 0)) then gosub LEAVE_SEACAVE
     if matchre("$zoneid", "\b(35|90|99|106|107|108|112|114|150)\b") then goto NO_LOCKPICK_ZONE
     if matchre("$zoneid","(116|127)") then
          {
               if (%Playing = 1) then gosub STOP_PLAY
               put .travel shard
               waitforre ^YOU ARRIVED
          }
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     pause 0.1
     gosub AUTOMOVE teller
LOCKPICK_MONEY:
     pause 0.2
     pause 0.2
     matchre NO_MONEY_LOCKPICKS You don't have that much money|we are not lending money|do not seem to have an account with us
     matchre TO_LOCKSMITH ^The clerk counts out|it looks like your current balance|^You count out|Searching methodically|^You find
     put withdraw 10 gold
     matchwait 20
NO_MONEY_LOCKPICKS:
     put #echo >Log #ff0000 ** NO MONEY TO BUY LOCKPICKS IN ZONE $zoneid !
     gosub LEAVE_BANK
     return
TO_LOCKSMITH:
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     if matchre("$zoneid","(116|127)") then
          {
               if (%Playing = 1) then gosub STOP_PLAY
               put .travel shard
               waitforre ^YOU ARRIVED
          }
     if matchre("$zoneid","(42|40)") then
          {
               put .travel riverhaven
               waitforre ^YOU ARRIVED
          }
     if matchre("$zoneid","60") then
          {
               put .travel cross
               waitforre ^YOU ARRIVED
          }
     if !matchre("$zoneid", "\b(1|30|47|67)\b") then goto NO_LOCKPICK_ZONE
     gosub AUTOMOVE locks
     pause 0.3
     if ("$zoneid" = "1") then
          {
               var lockpick.type slim
               var lockpick.offer 499
          }
     if matchre("$zoneid","(30|47)") then
          {
               var lockpick.type slim
               var lockpick.offer 400
          }
     if ("$zoneid" = "67") then
          {
               var lockpick.type stout iron
               var lockpick.offer 250
          }
BUY_LOCKPICKS:
     math lockpicks add 1
     pause 0.1
     pause 0.001
     gosub STAND
     pause 0.2
     send buy %lockpick.type lockpick
     pause 0.3
     send offer %lockpick.offer
     pause 0.2
     send offer %lockpick.offer
     wait
     pause 0.2
     gosub STOWIT lockpick
     pause 0.001
     if (%lockpicks > 7) then goto LOCKPICK_RESTOCK_DONE
     goto BUY_LOCKPICKS

LOCKPICK_RESTOCK_DONE:
     pause 0.1
     put #echo >Log #00FF00 *** Restocked %lockpicks lockpicks!
     put #var RestockLockpicks 0
     pause 0.2
     if (matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|112|114|116|127)\b") && matchre("%FANGCOVE", "(?i)ON")) then
          {
               if (matchre("$game", "(DRF|DRX)") || ($UC_Premium = 1)) then
                    {
                         var Teleport 0
                         if ("$zoneid" = "42") then gosub AUTOMOVE gate
                         if ("$zoneid" = "67") then gosub AUTOMOVE east
                         if ("$zoneid" = "112") then gosub AUTOMOVE leth
                         if ("$zoneid" = "127") then gosub AUTOMOVE south
                         gosub TO_SEACAVES
                         if (($Athletics.Ranks > 45) && ("$game" != "DRF")) then gosub AUTOMOVE 45
                         if (($roomid != 85) && ("$game" = "DRF")) then gosub AUTOMOVE 85
                    }
          }
     if (("$zoneid" = "1") && (%Necro.Known = 1)) then
          {
               gosub AUTOMOVE NE gate
               gosub AUTOMOVE 558
          }
     if (("$zoneid" = "1") && ("$guild" = "Ranger")) then gosub AUTOMOVE 587
     if (("$zoneid" = "1") && ("$guild" != "Ranger")) then gosub AUTOMOVE 1
     if ((("$zoneid" = "30") && ("$guild" = "Ranger")) || (("$zoneid" = "30") && (%Necro.Known = 1))) then
          {
               gosub AUTOMOVE e gate
               gosub AUTOMOVE 78
          }
     if (("$zoneid" = "30") && ("$guild" != "Ranger")) then gosub AUTOMOVE 243
     if ((("$zoneid" = "42") && ("$guild" = "Ranger")) || (("$zoneid" = "30") && (%Necro.Known = 1))) then
          {
               gosub AUTOMOVE gate
               gosub AUTOMOVE 222
          }
     if (("$zoneid" = "42") && ("$guild" != "Ranger")) then gosub AUTOMOVE 3
     if (("$zoneid" = "47") && (%Necro.Known = 1)) then gosub AUTOMOVE 401
     if (("$zoneid" = "47") && (%Necro.Known = 0)) then gosub AUTOMOVE bucket
     if (("$zoneid" = "61") && (%Necro.Known = 1)) then gosub AUTOMOVE ilaya
     if (("$zoneid" = "61") && (%Necro.Known = 0)) then gosub AUTOMOVE gym
     if (("$zoneid" = "66") && (%Necro.Known = 1)) then gosub AUTOMOVE 640
     if (("$zoneid" = "66") && ("$guild" = "Ranger")) then gosub AUTOMOVE 640
     if (("$zoneid" = "66") && ("$guild" != "Ranger") && (%Necro.Known = 0)) then gosub AUTOMOVE east
     if ((("$zoneid" = "67") && ("$guild" = "Ranger")) || (("$zoneid" = "67") && (%Necro.Known = 1)))  then
          {
               gosub AUTOMOVE east
               gosub AUTOMOVE 640
          }
     if (("$zoneid" = "67") && ("$guild" != "Ranger")) then gosub AUTOMOVE 154
     if ("$zoneid" = "90") then gosub AUTOMOVE 42
     if (("$zoneid" = "99") && ("$guild" = "Ranger")) then
          {
               gosub AUTOMOVE west
               gosub AUTOMOVE 53
          }
     if (("$zoneid" = "99") && ("$guild" != "Ranger") && (%Necro.Known = 0)) then gosub AUTOMOVE 91
     if ("$zoneid" = "107") then gosub AUTOMOVE 58
     if (("$zoneid" = "116") && (%Necro.Known = 0)) then gosub AUTOMOVE 96
     if (("$zoneid" = "116") && (%Necro.Known = 1)) then
          {
               gosub AUTOMOVE boar
               gosub AUTOMOVE 45
          }
     if (("$zoneid" = "150") && ($Athletics.Ranks > 45) && ($roomid != 45)) then gosub AUTOMOVE 45
     return
NO_LOCKPICK_ZONE:
     echo ##############################################
     echo *** NO LOCKPICK VENDOR IN THIS ZONE
     echo *** RESTOCK YOUR LOCKPICKS MANUALLY!!
     echo ##############################################
     put #echo >Log Orange ** No Lockpick Vendor in this Zone! Restock Lockpicks Manually!
     pause 2
     return
#######################################
### RESTOCK ON TORCHES AND FLINT
#######################################
#### BUYING TORCHES/FLINT
TORCH_RESTOCK:
     var bought 0
     if (%Necro.Known = 1) then return
     echo ###########################
     echo ** TORCH/FLINT RESTOCK NEEDED!
     echo ###########################
     if !matchre("$zoneid", "\b(1|30|35|42|67|99|116)\b") then
          {
               #### ESCAPE TO NEAREST CITY
               var GOSUBBING ON
               var escaping ON
               gosub ESCAPE_NOW
               var GOSUBBING OFF
               #### DONE ESCAPING TO CITY
          }
     if !matchre("$zoneid", "\b(1|30|35|42|67|99|116)\b") then
          {
               put #echo >Log Orange ** NOT IN A ZONE TO BUY TORCH/FLINT!!
               echo ######################################################
               echo ** NOT IN A RECOGNIZED ZONE TO BUY TORCHES!!
               echo ** Skipping Torch Restock.. Buy Torch and Flint!!
               echo ** XING/HAVEN/THEREN/SHARD/THRONE/AESRY/HIB
               echo ######################################################
               return
          }
     gosub stowing
     pause 0.2
     echo *** TO BANK
     gosub AUTOMOVE teller
     pause 0.3
     put withdraw 5 gold
     pause 0.7
     ### TO GENERAL STORE
     if matchre("$zoneid", "\b(1|30|35|42|67|99)\b") then gosub AUTOMOVE general
     if ("$zoneid" = "116") then gosub AUTOMOVE lamp
     pause 0.1
BUY_TORCH:
     if (%HaveTorch = 1) then goto BUY_FLINT
     pause 0.1
     math bought add 1
     put buy torch
     pause 0.7
     # if ("$zoneid" = "116") then put offer 27;put offer 27
     if ("$zoneid" = "99") then put offer 149;offer 149
     if ("$zoneid" = "67") then put offer 98;offer 98
     if ("$zoneid" = "42") then put offer 65;offer 65
     if ("$zoneid" = "35") then put offer 274;offer 274
     if ("$zoneid" = "30") then put offer 145;offer 145
     if ("$zoneid" = "1") then put offer 92;offer 92
     pause 0.5
     pause 0.3
     gosub stowing
     if (%bought < 2) then goto BUY_TORCH
     var bought 0
BUY_FLINT:
     if (%HaveFlint = 1) then goto TORCH_RESTOCK_DONE
     pause 0.1
     math bought add 1
     put buy flint
     pause 0.7
     # if ("$zoneid" = "116") then put offer 9;put offer 9
     if ("$zoneid" = "99") then put offer 50;offer 50
     if ("$zoneid" = "67") then put offer 35;offer 35
     if ("$zoneid" = "42") then put offer 60;offer 60
     if ("$zoneid" = "35") then put offer 349;offer 349
     if ("$zoneid" = "30") then put offer 114;offer 114
     if ("$zoneid" = "1") then put offer 142;offer 142
     pause 0.5
     pause 0.3
     gosub stowing
TORCH_RESTOCK_DONE:
     put #echo >Log #00FF00 *** Restocked Torches and Flint!
     echo #################################
     echo *** Restocked on Torches and Flint!
     echo #################################
     return
TORCH_RETURN:
     echo *** Torch and Flint found!
     unvar bought
     return
######################
## GET FAVORS
######################
##############################################################################################
# FAVOR CHECK AND TURNING IN FULL ORBS
#############################################################################################
FAVOR_CHECK:
ORB_CHECK:
     pause 0.0001
     gosub OPEN $UC_Container.GemPouch
     gosub OPEN $UC_Container.RepairKit
     echo **** CHECKING FOR FAVOR ORB
     pause 0.0001
     pause 0.0001
     matchre ORB_CHECK ^\s*\.\.\.wait|^You are still stunned
     matchre FAVOR_GET ^I could not|^What were you|^Tap what
     matchre FAVORORB_RETURN ^You tap|^The orb is delicate
     send tap my %FAVOR.GOD orb
     matchwait 20
     return

ORB_CHECK_ALT:
     pause 0.0001
     matchre ORB_CHECK ^\s*\.\.\.wait|^You are still stunned
     matchre FAVOR_GET ^I could not|^What were you|^Tap what
     matchre FAVORORB_RETURN ^You tap|^The orb is delicate
     send tap my %FAVOR.GOD orb in my watery portal
     matchwait 20
     return

FAVORORB_RETURN:
     gosub PUT close my $UC_Container.GemPouch
     pause 0.01
     gosub PUT close my $UC_Container.RepairKit
     pause 0.01
     return

ORB_RUB:
RUB_ORB:
     pause 0.01
     gosub stowing
     if !matchre("$zoneid", "(66|67|68|69|1|4|7|8|61|42|40|34|34a|33a|33|32|31|127|126|123|116|114|113|112)") then
          {
               echo
               echo #####################
               echo * SKIPPING ORB RUBBING!
               echo * NOT IN A LOCATION (Zoneid:%zoneid)
               echo * THAT SUPPORTS FAVOR ORBS!
               echo #####################
               echo
               pause 0.5
               goto ORB_RUB_DONE
          }
     if (%HaveFavorIdol = 1) then
          {
               gosub GET my %IdolType idol
               pause 0.2
               if !matchre("$righthand $lefthand", "idol") then gosub HOLD my %IdolType idol
               if !matchre("$righthand $lefthand", "idol") then gosub GET my idol
               pause 0.2
               if !matchre("$righthand $lefthand", "idol") then
                    {
                         echo
                         echo ######################
                         echo * ERROR! FAVOR IDOL NOT FOUND!
                         echo * REVERTING TO FAVOR ORBS
                         echo ######################
                         echo
                         put #echo >Log #FF2272 * ERROR! Favor Idol %IdolType idol not found!
                         var HaveFavorIdol 0
                         goto RUB_ORB_1
                    }
               put turn my idol to %FAVOR.GOD
               pause 0.5
               pause 0.4
          }
RUB_ORB_1:
     pause 0.01
     matchre ORB_DONE The strange tugging sensation is gone\,
     matchre FAVOR_GET ^Note\: Some rub locations may not be available
     if (%HaveFavorIdol = 1) then send rub my %IdolType idol
     else send rub my %FAVOR.GOD orb
     matchwait 4
ORB_RUB_DONE:
     gosub PUT close my $UC_Container.GemPouch
     pause 0.1
     gosub PUT close my $UC_Container.RepairKit
     pause 0.1
     return

FAVOR_GET:
     gosub PUT close my $UC_Container.GemPouch
     pause 0.1
     gosub PUT close my $UC_Container.RepairKit
     pause 0.1
     if !matchre("$zoneid", "\b(66|67|68|69|63|1|4|7|8|61|42|40|34|34a|33a|33|32|31|127|126|123|116|114|113|112)\b") then return
     gosub GET_FAVOR $UC_favorGod
     pause 0.2
     return
#### FILL FAVOR ORB
ORB_DONE:
     action (inventory) off
     echo #######################################
     echo *** FILLED A FAVOR ORB!
     echo *** GOING TO TURN IN AND GET A NEW ORB!
     echo #######################################
     put #echo >Log PaleGoldenrod *** Filled a Favor Orb!
     pause 0.5
     # put #script abort all except ubercombat
     gosub stowing
     pause 0.5
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if contains("$roomname", "Fang Cove") then gosub LEAVE_SEACAVE
     pause
     if ($roomid = 0) then gosub RANDOMMOVE
     if ("$zoneid" = "2a") then gosub AUTOMOVE cross
     if matchre("$zoneid", "\b(61|62|7|8|9|10)\b") then
          {
               put .travel cross
               waitforre YOU ARRIVED\!
          }
     if matchre("$zoneid", "\b(42|40|34|34a|33a|33|32|31)\b") then
          {
               put .travel haven
               waitforre YOU ARRIVED\!
          }
     if matchre("$zoneid", "\b(65|66|67|68|69|127|126|123|116|114|113|112)\b") then
          {
               if (%Playing = 1) then gosub STOP_PLAY
               put .travel shard
               waitforre YOU ARRIVED\!
          }
     if matchre("$zoneid", "\b(32|33)\b") then gosub AUTOMOVE riverhaven
     if matchre("$zoneid", "\b(65|68|69)\b") then gosub AUTOMOVE shard
     if matchre("$zoneid", "\b(2a|5|7|8)\b") then gosub AUTOMOVE cross
     if ("$zoneid" == "8") then gosub AUTOMOVE cross
     if ("$zoneid" == "7") then gosub AUTOMOVE cross
     if ("$zoneid" == "4") then gosub AUTOMOVE cross
     if ("$zoneid" == "68") then gosub AUTOMOVE shard
     if ("$zoneid" == "69") then gosub AUTOMOVE shard
     pause 0.1
     if ("$zoneid" == "66") then gosub AUTOMOVE east
     pause 0.2
     pause 0.1
     if ("$zoneid" == "67") then goto SHARD_TO_TEMPLE
     if ("$zoneid" == "1") then goto CROSS_TO_TEMPLE
     if ("$zoneid" = "30") then goto HAVEN_TO_TEMPLE
     echo *** NOT IN CROSSINGS, SHARD OR HAVEN !!!
     goto ORB_RETURN
##### TURN IN FAVOR ORBS
SHARD_TO_TEMPLE:
     var LAST SHARD_TO_TEMPLE
     pause 0.3
     gosub AUTOMOVE 86
     gosub AUTOMOVE Temple of Light
     pause
     gosub AUTOMOVE depart
     pause 0.2
     if (%HaveFavorIdol = 1) then
          {
               gosub GET my %IdolType idol
               if !matchre("$righthand $lefthand", "idol") then gosub HOLD my %IdolType idol
          }
     if (%HaveFavorIdol = 0) then
          {
               gosub GET my $UC_favorGod orb
               if !matchre("$righthand $lefthand", "orb") then put get my $UC_favorGod orb from my watery portal
          }
     pause 0.3
     pause 0.2
     if matchre("$righthand $lefthand", "orb") then put put my orb on altar
     if matchre("$righthand $lefthand", "idol") then put put my idol on altar
     pause 0.5
     pause 0.3
     gosub stowing
     gosub AUTOMOVE 86
SHARD_ORB_CHECK:
     if (%HaveFavorIdol = 1) then goto INIT_PREP
     matchre SHARD_ORB_CHECK ^\s*\.\.\.wait|^You are still stunned
     matchre GET_FAVOR_SHARD ^I could not|^What were you|^Tap what
     matchre INIT_PREP ^You tap|^The orb is delicate
     send tap my %FAVOR.GOD orb
     matchwait 7
     goto GET_FAVOR_SHARD
GET_FAVOR_SHARD:
     var LAST GET_FAVOR_SHARD
     pause 0.5
     gosub FAVORS_SHARD
     pause 0.5
     gosub stowing
     goto INIT_PREP

HAVEN_TO_TEMPLE:
     var LAST HAVEN_TO_TEMPLE
     pause 0.3
     pause
     gosub AUTOMOVE divyaush
     pause 0.5
     if (%HaveFavorIdol = 1) then
          {
               gosub GET my %IdolType idol
               if !matchre("$righthand $lefthand", "idol") then gosub HOLD my %IdolType idol
          }
     if (%HaveFavorIdol = 0) then
          {
               gosub GET my $UC_favorGod orb
               if !matchre("$righthand $lefthand", "orb") then put get my $UC_favorGod orb from my watery portal
          }
     pause 0.3
     pause 0.2
     if matchre("$righthand $lefthand", "orb") then put put my orb on altar
     if matchre("$righthand $lefthand", "idol") then put put my idol on altar
     pause 0.5
     pause 0.3
     gosub stowing
HAVEN_ORB_CHECK:
     if (%HaveFavorIdol = 1) then goto INIT_PREP
     matchre HAVEN_ORB_CHECK ^\s*\.\.\.wait|^You are still stunned
     matchre GET_FAVOR_HAVEN ^I could not|^What were you|^Tap what
     matchre INIT_PREP ^You tap|^The orb is delicate
     send tap my %FAVOR.GOD orb
     matchwait 7
     goto GET_FAVOR_HAVEN
GET_FAVOR_HAVEN:
     var LAST GET_FAVOR_HAVEN
     pause 0.5
     gosub FAVORS_HAVEN
     pause 0.5
     gosub stowing
     goto INIT_PREP

CROSS_TO_TEMPLE:
     gosub AUTOMOVE temple
     pause 0.5
     gosub AUTOMOVE favor
     pause 0.5
     if (%HaveFavorIdol = 1) then
          {
               gosub GET my %IdolType idol
               if !matchre("$righthand $lefthand", "idol") then gosub HOLD my %IdolType idol
          }
     if (%HaveFavorIdol = 0) then
          {
               gosub GET my $UC_favorGod orb
               if !matchre("$righthand $lefthand", "orb") then put get my $UC_favorGod orb from my watery portal
          }
     pause 0.3
     pause 0.2
     if matchre("$righthand $lefthand", "orb") then put put my orb on altar
     if matchre("$righthand $lefthand", "idol") then put put my idol on altar
     pause 0.5
     pause 0.3
     gosub stowing
     pause 0.2
     gosub AUTOMOVE cross
     pause 0.5
CROSS_ORB_CHECK:
     if (%HaveFavorIdol = 1) then goto INIT_PREP
     matchre CROSS_ORB_CHECK ^\s*\.\.\.wait|^You are still stunned
     matchre GET_FAVOR_CROSS ^I could not|^What were you|^Tap what
     matchre INIT_PREP ^You tap|^The orb is delicate
     send tap my %FAVOR.GOD orb
     matchwait 7
     goto GET_FAVOR_CROSS
GET_FAVOR_CROSS:
     var LAST GET_FAVOR_CROSS
     pause 0.2
     gosub FAVORS_CROSSING
     pause 0.5
     gosub stowing
     goto INIT_PREP
ORB_RETURN:
     gosub clear
     action remove your sacrifice is properly prepared
     action remove ^Note\: Some rub locations may not be available
     goto INIT_PREP
ORB_RETURN2:
     gosub clear
     action remove your sacrifice is properly prepared
     action remove ^Note\: Some rub locations may not be available
     goto INIT_PREP
#############################
##### GET NEW FAVOR ORB
GET_FAVOR:
GET.FAVOR:
GETFAVOR:
     var god $1
     var gotFavor 0
     pause 0.1
     put #var UC_favorGod %god
     action (inventory) off
     if ("$guild" = "Necromancer") then
          {
               gosub JUSTICE_TIMER
               if (($spellROC = 0) || ($spellEOTB = 0)) then gosub NECRO_PREP
          }
     #### ESCAPE TO NEAREST CITY
     var GOSUBBING ON
     var escaping ON
     gosub ESCAPE_NOW
     var GOSUBBING OFF
     #### DONE ESCAPING TO CITY
     if !matchre("$zoneid", "\b(66|67|68|69|63|1|4|7|8|61|42|40|34|34a|33a|33|32|31|127|126|123|116|114|113|112)\b") then goto ORB_RETURN
     if ($roomid = 0) then gosub RANDOMMOVE
     pause 0.1
     if matchre("$zoneid", "\b(61|62|63|5|6|7|8|9|10)\b") then
          {
               put .travel cross
               waitforre YOU ARRIVED\!
          }
     if matchre("$zoneid", "\b(42|40|47|34|34a|33a|33|32|31)\b") then
          {
               put .travel haven
               waitforre YOU ARRIVED\!
          }
     if matchre("$zoneid", "\b(127|126|123|116|114|113|112)\b") then
          {
               if (%Playing = 1) then gosub STOP_PLAY
               put .travel shard
               waitforre YOU ARRIVED\!
          }
     if matchre("$zoneid", "\b(32|33)\b") then gosub AUTOMOVE riverhaven
     if matchre("$zoneid", "\b(32|33)\b") then gosub AUTOMOVE riverhaven
     if matchre("$zoneid", "\b(65|68|69)\b") then gosub AUTOMOVE shard
     if matchre("$zoneid", "\b(65|68|69)\b") then gosub AUTOMOVE shard
     if matchre("$zoneid", "\b(65|68|69)\b") then gosub AUTOMOVE shard
     if matchre("$zoneid", "\b(2a|3|4|4a|6|7|7a|8|8a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid", "\b(2a|3|4|4a|6|7|7a|8|8a)\b") then gosub AUTOMOVE cross
     if matchre("$zoneid", "\b(2a|3|4|4a|6|7|7a|8|8a)\b") then gosub AUTOMOVE cross
     pause 0.2
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     pause 0.2
     if ("$zoneid" = "67") then goto GET_FAVOR_SHARD
     if ("$zoneid" = "4") then goto GET_FAVOR_CROSS
     if ("$zoneid" = "1") then goto GET_FAVOR_CROSS
     if ("$zoneid" = "30") then goto GET_FAVOR_HAVEN
     goto FAVOR_ERROR
#### CROSSING TO FAVORS
FAVORS_CROSSING:
     delay 0.0001
     echo
     echo ********  GETTING A FAVOR ORB  ********
     echo
     if ("$zoneid" = "2a") then gosub AUTOMOVE crossing
CROSSING_TO_FAVORS:
     delay 0.0001
     if ("$zoneid" = "1") then gosub AUTOMOVE w gate
     pause 0.3
     if ("$zoneid" = "1") then gosub AUTOMOVE w gate
     gosub AUTOMOVE favors
     goto FAVOR_KNEEL

FAVORS_HAVEN:
     delay 0.0001
     echo
     echo ********  GETTING A FAVOR ORB  ********
     echo
     if ("$zoneid" = "30") then gosub AUTOMOVE e gate
HAVEN_TO_FAVORS:
     delay 0.0001
     if ("$zoneid" = "30") then gosub AUTOMOVE e gate
     pause 0.3
     if ("$zoneid" = "31") then gosub AUTOMOVE 107
     goto FAVOR_KNEEL

#### SHARD TO FAVORS
FAVORS_SHARD:
GET_ORB_SHARD:
     var LAST GET_ORB_SHARD
     var LOCATION GET_ORB_SHARD
     echo
     echo ********  GETTING A FAVOR ORB  ********
     echo
     if matchre("$roomname", "Temple of Light") then gosub AUTOMOVE 86
     if matchre("$roomname", "Temple of Darkness") then gosub AUTOMOVE 86
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     pause 0.3
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     pause 0.4
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "66") then gosub AUTOMOVE east
     if ("$zoneid" = "67") then
          {
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then gosub AUTOMOVE w gate
               if (($UC_shardCitizen = 0) && ($Time.isDay = 0)) then
                    {
                         if ("$zoneid" = "67") then gosub AUTOMOVE e gate
                         pause 0.5
                         if ("$zoneid" = "66") then gosub AUTOMOVE w gate
                    }
          }
     pause 0.2
     if ("$zoneid" = "67") then
          {
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then gosub AUTOMOVE w gate
               if (($UC_shardCitizen = 0) && ($Time.isDay = 0)) then
                    {
                         if ("$zoneid" = "67") then gosub AUTOMOVE e gate
                         pause 0.5
                         if ("$zoneid" = "66") then gosub AUTOMOVE w gate
                    }
          }
     pause 0.1
     if ("$zoneid" = "66") then gosub AUTOMOVE w gate
     pause 0.2
     if ("$zoneid" = "69") then gosub AUTOMOVE 6
     pause 0.2
SEARCH_PATH:
     pause 0.5
     pause 0.5
     matchre SEARCH_PATH ^\.\.\.wait|^Sorry\,|^You are still stunned\.
     match SEARCH_PATH You don't find anything
     match FOUND_PATH You find a narrow path
     put search
     matchwait 20
     goto SEARCH_PATH
FOUND_PATH:
     pause 0.2
     pause 0.5
     pause 0.1
     gosub MOVE go path
     pause 0.5
     gosub MOVE w
     gosub MOVE w
     gosub MOVE w
     gosub MOVE w
     gosub MOVE w
     pause 0.2
     if ($standing = 1) then send lie
     pause 0.5
     if ($standing = 1) then send lie
     pause 0.2
     pause 0.1
     send look brush
     wait
     pause 0.3
     pause 0.2
     send go open
     waitforre Light passes through cracks|Obvious exits|you crawl out of the passage|After a seemingly interminible length of time
     pause 0.5
     pause
     if ($standing = 0) then gosub STAND
     pause 0.5
     if ($standing = 0) then gosub STAND
     pause 0.1
FAVOR_WHITE_ARCH:
     pause 0.1
     if ($standing = 0) then put stand
     pause 0.3
     #matchre NEXT Obvious exits: down
     #matchre ARCH Obvious exits: none
     send go white arch
     pause 0.5
     pause 0.3
     pause 0.3
     if ($down) then goto FAVOR_ARCH_NEXT
     else goto FAVOR_WHITE_ARCH
FAVOR_ARCH_NEXT:
     pause 0.2
     pause 0.5
     send down
     pause 0.5
     matchre FAVOR_ARCH_NEXT_2 Six carved columns of pale marble|Wyvern Mountain\, Dragon Shrine
     matchre FAVOR_WHITE_ARCH Wyvern Mountain\, Cavern
     put look
     matchwait 20
     goto FAVOR_WHITE_ARCH
FAVOR_ARCH_NEXT_2:
     pause 0.1
     pause 0.1
     send go dais
     pause 0.5
     pause 0.2
     goto FAVOR_KNEEL

### AT PRAY LOCATION
FAVOR_KNEEL:
     pause 0.0001
     matchre FAVOR_KNEEL ^\.\.\.wait|^Sorry\,
     matchre FAVOR_PRAY ^You kneel down upon the ground\.
     send kneel
     matchwait 10
     goto FAVOR_KNEEL
FAVOR_PRAY:
     pause 0.001
     pause 0.1
     if ($standing = 1) then put kneel
     matchre FAVOR_PRAY ^\.\.\.wait|^Sorry\,
     matchre FAVOR_PRAY ^You close your eyes and pray\.
     matchre FAVOR_PRAY ^As you continue to pray\, another sound presents itself\.
     matchre FAVOR_PRAY ^You begin to pray
     matchre FAVOR_PRAY ^You continue to pray
     matchre FAVORS_DONE ^The gods ignore the pleas of your decaying spirit
     matchre FAVORS_DONE ^You quickly realize the folly of pleading to the gods as a creature of Unlife
     matchre FAVORS_DONE ^The gods do not hear the pleas of a forsaken Necromancer
     matchre DECLARE_GOD ^As the world around you returns to normal\, you hear a faint voice echo within you\.
     send pray
     matchwait 9
     goto FAVOR_PRAY
DECLARE_GOD:
     pause 0.1
     pause 0.5
     put '$UC_favorGod
     pause
     pause 0.5
     pause 0.3
     if ($standing = 0) then gosub STAND
     pause 0.5
     if ($standing = 0) then gosub STAND
     pause 0.5
     gosub stowing
     pause 0.5
     pause 0.2
     pause 0.2
     send get $UC_favorGod orb
     pause 0.5
     pause 0.3
     pause 0.1
     send go arch
     pause 0.5
     goto FAVOR_PUZZLE

FAVOR_PUZZLE:
     pause 0.2
     pause 0.1
     matchre FAVOR_FILLFONT You also see a granite altar with several candles and a water jug on it\, and a granite font\.
     matchre FAVOR_LIGHTCANDLE You also see some tinders\, several candles\, a granite font and a granite altar\.
     matchre FAVOR_CLEANALTAR You also see a granite altar with several candles on it\, a granite font and a small sponge\.
     matchre FAVOR_PICKFLOWERS You also see a vase on top of the altar\.
     matchre FAVOR_OPENWINDOW A table sits against one wall\, directly opposite an ancient window\.
     matchre SHARD_FAVOR_DONE ^\[Wyvern Mountain, Raised Dais\]
     matchre CROSS_FAVOR_DONE ^\[Siergelde, Stone Grotto\]
     matchre HAVEN_FAVOR_DONE ^\[Mausoleum, Alcove of the Font\]
     put look
     matchwait 20
     goto FAVOR_PUZZLE

FAVOR_FILLFONT:
     pause 0.2
     var gotFavor 1
     put fill font
     pause 0.3
     match FAVOR_FILLFONT With a practiced eye, you begin to check the various acoutrements around you.
     match FAVOR_FILLFONT_2 You reach the top of the stairway, and notice that the door has swung open of its own accord!
     put climb stair
     matchwait 20
     goto FAVOR_FILLFONT
     FAVOR_FILLFONT_2:
     put go door
     goto FAVOR_PUZZLE
FAVOR_PICKFLOWERS:
     pause 0.2
     var gotFavor 1
     put pick flowers
     pause 0.5
     put go tree
     goto FAVOR_PUZZLE
FAVOR_LIGHTCANDLE:
     pause 0.2
     var gotFavor 1
     put light candle
     pause 0.2
     match FAVOR_LIGHTCANDLE With a practiced eye, you begin to check the various acoutrements around you.
     match FAVOR_LIGHTCANDLE_2 You reach the top of the stairway, and notice that the door has swung open of its own accord!
     put climb stair
     matchwait 20
     goto FAVOR_LIGHTCANDLE
     FAVOR_LIGHTCANDLE_2:
     pause 0.2
     send go door
     goto FAVOR_PUZZLE
FAVOR_CLEANALTAR:
     pause 0.2
     var gotFavor 1
     send clean altar
     pause 0.5
     matchre FAVOR_CLEANALTAR With a practiced eye\, you begin to check the various acoutrements around you\.
     matchre FAVOR_CLEANALTAR_2 You reach the top of the stairway\, and notice that the door has swung open of its own accord\!
     put climb stair
     matchwait 20
     goto FAVOR_CLEANALTAR
     FAVOR_CLEANALTAR_2:
     pause 0.2
     send go door
     goto FAVOR_PUZZLE
FAVOR_OPENWINDOW:
     pause 0.1
     pause 0.1
     matchre FAVOR_OPENWINDOW ^\.\.\.wait|^Sorry\,
     matchre FAVOR_OPENWINDOW ^Judging the thickness of the paint which has sealed the window shut, you shimmy the frame of the glass to loosen it\.  After a few strong shakes, you notice a thin crack running along the painted edge\.
     matchre FAVOR_OPENWINDOW ^Shaking the frame of the glass once more, you manage to loosen it even further\.  As you grunt with effort, you feel the thick paint binding slip, and flakes of the stuff fall to the floor\.
     matchre FAVOR_OPENWINDOW_2 ^That is already open\.
     matchre FAVOR_OPENWINDOW_2 ^A cool, swift breeze moves into the room, chasing the stifling heat from your skin\.
     put open window
     matchwait 20
     goto FAVOR_OPENWINDOW
FAVOR_OPENWINDOW_2:
     var gotFavor 1
     pause 0.5
     match FAVOR_OPENWINDOW closed window
     match FAVOR_PUZZLE hoist yourself
     put go window
     matchwait 20
     goto FAVOR_OPENWINDOW_2
FAVORS_DONE:
     pause 0.2
     pause 0.1
     matchre FAVOR_FILLFONT You also see a granite altar with several candles and a water jug on it\, and a granite font\.
     matchre FAVOR_LIGHTCANDLE You also see some tinders\, several candles\, a granite font and a granite altar\.
     matchre FAVOR_CLEANALTAR You also see a granite altar with several candles on it\, a granite font and a small sponge\.
     matchre FAVOR_PICKFLOWERS You also see a vase on top of the altar\.
     matchre FAVOR_OPENWINDOW A table sits against one wall\, directly opposite an ancient window\.
     matchre SHARD_FAVOR_DONE ^\[Wyvern Mountain, Raised Dais\]
     matchre CROSS_FAVOR_DONE ^\[Siergelde, Stone Grotto\]
     matchre HAVEN_FAVOR_DONE ^\[Mausoleum, Alcove of the Font\]
     put look
     matchwait 20
SHARD_FAVOR_DONE:
     pause 0.1
     if (!matchre("$UC_Container", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container
     if (!matchre("$UC_Container.Box", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Box
     if (!matchre("$UC_Container.Backup", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Backup
     if (!matchre("$UC_Container.Crafting", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Crafting
     if (!matchre("$UC_Container.Sheath", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Sheath
     if matchre("$righthand $lefthand", "orb") then gosub PUT put orb in my $UC_Container
     pause 0.1
     gosub stowing
     pause 0.2
     move down
     move up
SHARD_ARCH_RETURN:
     pause 0.5
     if matchre("$roomname", "Wyvern Trail\, Clearing") then goto FAVOR_SHARD_RETURN_2
     if matchre("$roomobjs", "low opening") then goto FAVOR_SHARD_RETURN
     pause 0.4
     matchre FAVOR_SHARD_RETURN a low opening
     matchre SHARD_ARCH_RETURN Obvious exits|Obvious paths
     put go white arch
     matchwait 20
     goto SHARD_ARCH_RETURN
FAVOR_SHARD_RETURN:
     pause 0.5
     send lie
     pause 0.5
     matchre FAVOR_SHARD_RETURN_2 After a seemingly interminible length of time\, you crawl out of the passage into
     matchre FAVOR_SHARD_RETURN_2 Wyvern Trail\, Clearing|Tangled brush surrounds a small clearing
     matchre SHARD_ARCH_RETURN You also see a black arch and a white arch
     send go open
     matchwait 80
     goto SHARD_ARCH_RETURN
FAVOR_SHARD_RETURN_2:
     if ($standing = 0) then gosub STAND
     pause 0.5
     if ($standing = 0) then gosub STAND
     pause 0.3
     put go trail
     pause 0.5
     pause 0.5
     gosub AUTOMOVE North
     pause 0.5
     gosub AUTOMOVE east
     pause 0.5
     goto GET_FAVOR_DONE

CROSS_FAVOR_DONE:
     delay 0.0001
     pause 0.1
     if (!matchre("$UC_Container", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container
     if (!matchre("$UC_Container.Box", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Box
     if (!matchre("$UC_Container.Backup", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Backup
     if (!matchre("$UC_Container.Crafting", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Crafting
     if (!matchre("$UC_Container.Sheath", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Sheath
     if matchre("$righthand $lefthand", "orb") then gosub PUT put orb in my $UC_Container
     pause 0.1
     gosub stowing
     gosub AUTOMOVE crossing
     gosub AUTOMOVE 337
     goto GET_FAVOR_DONE

HAVEN_FAVOR_DONE:
     delay 0.0001
     pause 0.1
     if (!matchre("$UC_Container", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container
     if (!matchre("$UC_Container.Box", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Box
     if (!matchre("$UC_Container.Backup", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Backup
     if (!matchre("$UC_Container.Crafting", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Crafting
     if (!matchre("$UC_Container.Sheath", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Sheath
     if matchre("$righthand $lefthand", "orb") then gosub PUT put orb in my $UC_Container
     pause 0.1
     gosub stowing
     gosub AUTOMOVE riverhaven
     goto GET_FAVOR_DONE
###########################################################################
GET_FAVOR_DONE:
     if (%gotFavor = 0) then goto FAVOR_NO
     echo ###################################
     echo *****  YOU GOT A NEW FAVOR!   *****
     echo ###################################
     put #echo >Log #e600e6 *** GOT A NEW FAVOR ORB - $UC_favorGod ***
     pause
     put #parse FAVOR DONE
     put #var UC_favorGod %FAVOR.GOD
     if (!matchre("$UC_Container", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container
     if (!matchre("$UC_Container.Box", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Box
     if (!matchre("$UC_Container.Backup", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Backup
     if (!matchre("$UC_Container.Crafting", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Crafting
     if (!matchre("$UC_Container.Sheath", "(?i)(eddy|portal)") && matchre("$righthand $lefthand", "orb")) then gosub PUT put orb in my $UC_Container.Sheath
     if matchre("$righthand $lefthand", "orb") then gosub PUT put orb in my $UC_Container
     return
FAVOR_ERROR:
     gosub clear
     put #var UC_favorGod %FAVOR.GOD
     pause 0.1
     echo ###################################
     echo ** FAVOR ERROR! FAVOR ERROR!
     echo * NOT IN A RECOGNIZED PLACE TO GET FAVORS
     echo ###################################
     put #echo >Log #e600e6 *** Favor Error - Not in a recognized favor location
     goto INIT_PREP
FAVOR_NO:
     gosub clear
     put #var UC_favorGod %FAVOR.GOD
     pause 0.0001
     echo ###################################
     echo ** FAVOR ERROR! NOT ENOUGH SPIRIT TO GET ORB??
     echo * TRYING AGAIN LATER
     echo ###################################
     put #echo >Log #e600e6 *** Favor Error - Not enough spirit to get orb!
     goto INIT_PREP
############################################################################
CLAN.ITEM:
     matchre CLAN.ITEM ^You pull your mind
     matchre RETURN ^You draw on the innate powers|^Rub what\?|Note|^You can't
     put rub my sphere
     matchwait 3
     return
##############################################################################
### DISABLE THE PVP TRIGGERS
PVP_REMOVE:
     # put #var UC_Log.on.Stun 0
     put #var UC_No.Contact 0
     action (PVPPLAYER) off
     return
##################################################################################################################################
### PVP SECTION / BITCH KILLING MODULE
##################################################################################################################################
THIEF_PVP_BUFF:
     if ($SpellTimer.KhriSilence.active = 0) then gosub KHRI_START silence cunning steady sensing sight serenity
     if ($SpellTimer.KhriCunning.active = 0) then gosub khri silence cunning steady sensing sight serenity
     if ($SpellTimer.KhriSteady.active = 0) then gosub KHRI_START silence cunning steady sensing sight serenity
     if ($SpellTimer.KhriSensing.active = 0) then gosub KHRI_START silence cunning steady sensing sight serenity
     if ($SpellTimer.KhriSight.active = 0) then gosub KHRI_START silence cunning steady sensing sight serenity
     if ($SpellTimer.KhriSerenity.active = 0) then gosub KHRI_START silence cunning steady sensing sight serenity
     if ($concentration < 20) then send touch my grey stone
     return

HUNTEM_DOWN:
HUNTNOOBS:
     delay 0.001
     action (PVP) on
     var PVPkills 0
     var kill.target NULL
     var count 0
     var KOSroom 0
     pause 0.1
     gosub stowing
     pause 0.01
     send khri stop
     wait
     pause
     if matchre("$righthand", "Empty") then
          {
               send get my t blades
               pause 0.1
               pause 0.01
               pause 0.01
          }
CHECK_FOR_KOS:
     pause 0.1
     matchre KOS_YES Brave Adventurer
     matchre CHECK_FOR_KOS_2 ^There are no adventurers|The syntax
     put find dickcheese
     matchwait 4
CHECK_FOR_KOS_2:
     pause 0.1
     matchre KOS_YES Brave Adventurer
     matchre KOS_NO ^There are no adventurers|The syntax
     put find rottenbox
     matchwait 10
     goto KOS_NO
KOS_YES:
     put #echo >Log Orange *** GOING ON A NOOB MURDER SPREE!
     echo ##############################
     echo *** GOING ON MURDER RUN!!
     echo ##############################
     pause 0.2
     send sleep
     pause 0.2
     send sleep
     pause 0.2
     put khri silence steady elusion sagacity sensing sight cunning
     pause
     pause 0.5
     pause 0.1
     send .travel boar
     waitforre ^YOU ARRIVED\!
     if ("$guild" = "Thief") then gosub THIEF_PVP_BUFF
HUNTEM_DOWN_1:
     #### BOAR CLAN
     var LAST HUNTEM_DOWN_2
     var KOSroom 0
     echo ###################################
     echo *** MURDER RUN CHECK 1 - BOAR CLAN !
     echo *** HUNTING: %kill.on.sight
     echo ###################################
     var ROOMS.TO.CHECK 75|76|77|78|79|80|81|82|83|84|85|86|87|88|89|90|91|92|93|94|95|96|97|98|99|100|101|102|103|104|105|106|107|108|109|110|111|112|113|114|115|164|165|166|167|168|169|170|171|172|173|174|175|176|177|178|179|180|181|182|183|184|185|186|187|188|189|190|191|192|193|194|195|196|197|198|199|200|201|202|203|204|205|206|207|208|209|210|211|212|213|214|234|235|236|237|238|239|240|241|242|243|372|373|374|375|376|396|397|398|399|400|401|402|403|404|405|406|407|408|409|410|411|412|413|414|415|416|417|418|560|561|562|563|564|565|566|567|568|569|570|571|572|573|574|575|576|577|578|579
     eval RoomCount count("%ROOMS.TO.CHECK ", "|")
     gosub CHECK_KOS_ROOMS
HUNTEM_DOWN_2:
     #### RAVENS POINT
     var LAST HUNTEM_DOWN_3
     var KOSroom 0
     pause 0.1
     echo ########################################
     echo *** MURDER RUN CHECK 2 - RAVEN'S POINT !
     echo *** HUNTING: %kill.on.sight
     echo ########################################
     if ("$zoneid" = "127") then gosub AUTOMOVE south
     pause 0.2
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     pause 0.2
     send east
     pause 0.2
     if ("$zoneid" = "126") then gosub AUTOMOVE hib
     pause 0.2
     pause 0.1
     send east
     pause 0.4
     if ("$zoneid" != "116") then goto HUNTEM_DOWN_2
     gosub AUTOMOVE raven
     pause 0.5
     if ("$zoneid" = "116") then gosub AUTOMOVE raven
     pause 0.3
     if ("$guild" = "Thief") then gosub THIEF_PVP_BUFF
     var ROOMS.TO.CHECK 187|188|189|190|191|192|193|194|195|196|197
     eval RoomCount count("%ROOMS.TO.CHECK ", "|")
     gosub CHECK_KOS_ROOMS
HUNTEM_DOWN_3:
     #### SHARD WEST GATE
     var LAST HUNTEM_DOWN_4
     var KOSroom 0
     pause 0.2
     echo ########################################
     echo *** MURDER RUN CHECK 3 - SHARD WEST GATE !
     echo *** HUNTING: %kill.on.sight
     echo ########################################
     if ("$zoneid" = "123") then gosub AUTOMOVE 175
     pause 0.2
     if ("$guild" = "Thief") then gosub THIEF_PVP_BUFF
     var ROOMS.TO.CHECK 317|318|319|320|321|323|324|325|326|327|328|329|346|347|348|349|350|351|352|353|354|355|359|396|397|398|399|400|401|402|403|404|405|406|407|408|409|410|411|412|413|414|415|416|417|418|419|420|427|452|453|454|455|456|457|458|459|460|461|462|463|464|515|516|517||518|519|520|521|522|523|524|525|473|474|475|476|477|478|479
     eval RoomCount count("%ROOMS.TO.CHECK ", "|")
     gosub CHECK_KOS_ROOMS
HUNTEM_DOWN_4:
     #### ROSSMAN
     var LAST HUNTEM_DOWN_5
     var KOSroom 0
     pause 0.1
     echo ########################################
     echo *** MURDER RUN CHECK 4 - ROSSMAN !
     echo *** HUNTING: %kill.on.sight
     echo ########################################
     if ($invisible) then put khri stop silence
     pause 0.5
     gosub stowing
     pause 0.2
     put .travel rossman
     waitforre ^YOU ARRIVED
     pause 0.2
     if ("$guild" = "Thief") then gosub THIEF_PVP_BUFF
     var ROOMS.TO.CHECK 47|48|49|50|51|52|53|54|55|56|57|58|59|60|61|62
     eval RoomCount count("%ROOMS.TO.CHECK ", "|")
     gosub CHECK_KOS_ROOMS
HUNTEM_DOWN_5:
     #### MISTWOOD FOREST
     var LAST HUNTEM_DOWN_6
     var KOSroom 0
     pause 0.1
     if ($invisible) then put khri stop silence
     pause 0.5
     gosub AUTOMOVE mist
     pause 0.5
     echo ########################################
     echo *** MURDER RUN CHECK 5 - MISTWOOD FOREST !
     echo *** HUNTING: %kill.on.sight
     echo ########################################
     pause 0.2
     if ("$guild" = "Thief") then gosub THIEF_PVP_BUFF
     var ROOMS.TO.CHECK 59|60|61|62|63|64|65|66|67|68|69|70|71|72|73|74|75|76|77|78|79|80|81|82|83|94|95|96|97|98|99|100|101|102|103|104|105|106|107|108|109|110|111|112|113|114|115
     eval RoomCount count("%ROOMS.TO.CHECK ", "|")
     gosub CHECK_KOS_ROOMS
     goto HUNTEM_DOWN_DONE
HUNTEM_DOWN_6:
     #### STONE CLAN
     var LAST HUNTEM_DOWN_DONE
     var KOSroom 0
     pause 0.1
     if ($invisible) then put khri stop silence
     pause 0.5
     put .travel stone
     waitforre ^YOU ARRIVED
     pause 0.1
     if ("$zoneid" = "7") then gosub AUTOMOVE stone
     if ("$zoneid" = "7") then gosub AUTOMOVE stone
     echo ########################################
     echo *** MURDER RUN CHECK 6 - STONE CLAN !
     echo *** HUNTING: %kill.on.sight
     echo ########################################
     pause 0.2
     if ("$guild" = "Thief") then gosub THIEF_PVP_BUFF
     var ROOMS.TO.CHECK 39|40|41|42|43|44|45|46|47
     eval RoomCount count("%ROOMS.TO.CHECK ", "|")
     gosub CHECK_KOS_ROOMS
     if ("$zoneid" = "10") then gosub AUTOMOVE NTR
     goto HUNTEM_DOWN_DONE

CHECK_KOS_ROOMS:
     pause 0.0001
     if ("%ROOMS.TO.CHECK(%KOSroom)" = "") then return
     gosub AUTOMOVE %ROOMS.TO.CHECK(%KOSroom)
     pause 0.1
     if matchre("$roomplayers", "%kill.on.sight") then goto KILL_BITCH
     gosub CHECKPLAYER
     if matchre("%Players", "%kill.on.sight") then goto KILL_BITCH
     pause 0.1
     if matchre("$roomplayers", "%kill.on.sight") then goto KILL_BITCH
     pause 0.1
     gosub CHECKPLAYER
     if matchre("$roomplayers", "%kill.on.sight") then goto KILL_BITCH
     if (%KOSroom > %RoomCount) then return
     math KOSroom add 1
     goto CHECK_KOS_ROOMS

HUNTEM_DOWN_DONE:
     echo ########################################
     echo *** DONE HUNTING BITCH MOTHERFUCKERS
     echo ########################################
     pause 0.2
     send .travel shard
     waitforre ^YOU ARRIVED\!
KOS_NO:
     var command NULL
     goto INIT_PREP
#### PVP TRIGGERS/REACTIONS
SLIPPED:
     if matchre("$righthand $lefthand", "%ALLWEAPONS") then
          {
               put #echo >Log Orange *** SOMEONE SLIPPED YOU A %slipped - But matches our weapon name - Stowing for safety!!
               gosub stowing
               goto %LAST
          }
     put #echo >Log Orange *** SOMEONE SLIPPED YOU A %slipped - Dropping
     gosub PUT drop my %slipped
     gosub PUT drop my %slipped
     pause 0.5
     pause 0.1
     goto %LAST
GIVE_COINS:
     put #queue clear
     put #script abort all except %scriptname
     gosub clear
     pause 0.1
     send give %kill.target %coins.given %coins.type
     pause 0.1
     pause 0.1
     goto KILL_BITCH
KILL_DRAG:
     put #queue clear
     put #script abort all except %scriptname
     gosub clear
     pause 0.01
     gosub MOVE %drag.direction
     goto KILL_BITCH
KILL_BITCH_MOVE:
     put #queue clear
     put #script abort all except %scriptname
     gosub clear
     pause 0.01
     gosub MOVE %direction
     goto KILL_BITCH
ORIGINAL_ROOM:
     pause 0.4
     echo *** MOVING BACK TO OG ROOM
     echo
     pause 0.001
     gosub AUTOMOVE %ORIGINAL.ROOM
KILL_BITCH:
     var killingLoop 0
     put #queue clear
     put #script abort all except %scriptname
     gosub clear
     pause 0.0001
     if ($UC_Log.on.Stun = 1) then goto EXIT_QUICK
     if ("%kill.target" = "NULL") then if matchre("$roomplayers", "%kill.on.sight") then var kill.target $0
     if ("%kill.target" = "NULL") then goto KILL_BITCH_DONE
     put cc ENEMY %kill.target Spotted! KILLING! Location: $zonename - $roomname | ZoneID:$zoneid  RoomID:$roomid
     put #echo >Log #ff0000 *** KILLING MFERS! TARGETING: %kill.target
     echo ###################################
     echo ** KILL BITCH ROUTINE TRIGGERED!!!
     echo ** ATTACKING %kill.target !
     echo ##################################
     if matchre("$righthand", "Empty") then gosub stowing
     pause 0.1
KILL_BITCH_2:
     action (TF) off
     pause 0.001
     math killingLoop add 1
     if matchre("$righthand", "Empty") then
          {
               send get my t blades
               pause 0.1
               pause 0.01
               pause 0.01
          }
     pause 0.001
     if matchre("$roomplayers", "%kill.on.sight") then send hurl %kill.target
     pause 0.01
     pause 0.01
     if (%killingLoop > 12) then goto KILL_BITCH_DONE
     if !matchre("$roomplayers", "%kill.on.sight") then goto KILL_BITCH_DONE
     goto KILL_BITCH_2
KILL_BITCH_DONE:
     action (TF) on
     if matchre("$roomplayers", "%kill.on.sight") then goto KILL_BITCH
     echo ########################
     echo ** DONE KILLING MFERS?
     echo ########################
     if ($SpellTimer.KhriCunning.active = 0) then gosub khri cunning steady elusion sagacity silence sensing sight
     if ($SpellTimer.KhriSteady.active = 0) then gosub khri cunning steady elusion sagacity silence sensing sight
     if ($SpellTimer.KhriElusion.active = 0) then gosub khri cunning steady elusion sagacity silence sensing sight
     if ($SpellTimer.KhriSagacity.active = 0) then gosub khri cunning steady elusion sagacity silence sensing sight
     if ($SpellTimer.KhriSensing.active = 0) then gosub khri cunning steady elusion sagacity silence sensing sight
     if ($SpellTimer.KhriSilence.active = 0) then gosub khri cunning steady elusion sagacity silence sensing sight
     pause 0.1
     if matchre("$roomplayers", "%kill.on.sight") then goto KILL_BITCH
     pause 0.2
     if matchre("$roomplayers", "%kill.on.sight") then goto KILL_BITCH
     pause 0.1
     put search
     pause
     pause 0.2
     if matchre("$roomplayers", "%kill.on.sight") then goto KILL_BITCH
     put search
     pause
     pause 0.2
     if matchre("$roomplayers", "%kill.on.sight") then goto KILL_BITCH
     pause 2
     if matchre("$roomplayers", "%kill.on.sight") then goto KILL_BITCH
     pause
     put search
     pause 2
     if matchre("$roomplayers", "%kill.on.sight") then goto KILL_BITCH
     gosub stowing
     if matchre("$roomplayers", "%kill.on.sight") then goto KILL_BITCH
     action (TF) on
     pause 0.1
     send awaken
     pause 0.2
     send awaken
     pause 0.2
     goto %LAST

DEPART_CAMP:
     action (TF) OFF
     echo #########################################
     echo ** KILLED FUCKBOY! GOING TO CAMP DEPART
     echo #########################################
     put #echo >Log #ffff66 *** KILLED %kill.target !! GOING TO CAMP DEPART SPOT!!
     put #queue clear
     put #script abort all except %scriptname
     gosub clear
     pause 0.2
     action (TF) ON
     if ("$zoneid" = "92") then gosub AUTOMOVE ratha
     if ("$zoneid" = "95") then gosub AUTOMOVE ratha
     if ("$zoneid" = "90") then
          {
               gosub AUTOMOVE 393
               goto INIT_PREP
          }
     if ("$zoneid" = "69") then gosub AUTOMOVE hib
     if ("$zoneid" = "10") then gosub AUTOMOVE NTR
     if ("$zoneid" = "7") then gosub AUTOMOVE dirge
     if ("$zoneid" = "34") then gosub AUTOMOVE rossman
     if ("$zoneid" = "1") then gosub AUTOMOVE temple
     gosub AUTOMOVE depart
     pause 0.1
     goto KILL_CAMPING_LOOP

KILL_CAMPING_LOOP:
     pause 0.1
     var ORIGINAL.ROOM $roomid
     action (TF) on
     if !matchre("$righthand", "throwing blades") then
          {
               if matchre("$righthand", "Empty") then send get t blades
               else gosub stowing
               pause 0.2
          }
     pause 0.1
     if ($SpellTimer.KhriSilence.active = 0) then gosub khri silence
     if ("$guild" = "Thief") then
          {
               if ($SpellTimer.KhriCunning.active = 0) then gosub khri cunning steady elusion sagacity silence sensing sight
               if ($SpellTimer.KhriSteady.active = 0) then gosub khri cunning steady elusion sagacity silence sensing sight
               if ($SpellTimer.KhriElusion.active = 0) then gosub khri cunning steady elusion sagacity silence sensing sight
               if ($SpellTimer.KhriSagacity.active = 0) then gosub khri cunning steady elusion sagacity silence sensing sight
               if ($SpellTimer.KhriSensing.active = 0) then gosub khri cunning steady elusion sagacity silence sensing sight
               if ($SpellTimer.KhriSilence.active = 0) then gosub khri cunning steady elusion sagacity silence sensing sight
          }
     if ($concentration < 30) then send touch my grey stone
     if matchre("$roomplayers", "(%kill.on.sight)") then goto KILL_BITCH
     # if ($hidden = 0) then send hide
     pause
     echo ###########################
     echo *** KILL SCRIPT ACTIVE
     echo *** CAMPING DEPART ROOM!!!
     echo *** WAITING FOR VICTIMS..
     echo ###########################
     echo #########################################
     echo *** KILL ON SIGHT LIST: %kill.on.sight
     echo #########################################
     if matchre("$roomobjs" , "a pile of \S+") then gosub KICKIT
     if matchre("$roomobjs" , "a pile of \S+") then gosub KICKIT
     put info
     if ($SpellTimer.KhriSilence.active = 0) then gosub khri silence
     pause 3
     if ($SpellTimer.KhriSilence.active = 0) then gosub khri silence
     put look
     pause 3
     if ($SpellTimer.KhriSilence.active = 0) then gosub khri silence
     goto KILL_CAMPING_LOOP

BITCHASS_DOWN:
     pause 0.1
     action (PVP) off
     if ("%kill.target" = "NULL") then goto KILL_BITCH_DONE
     math PVPkills add 1
     put #parse KILLED A MOTHERFUCKER!
     put #echo >Log #ff0000 *** KILLED A MOTHERFUCKER! Target: %kill.target
     pause
     pause 0.2
     random 1 6
     goto BITCH_%r
BITCH_1:
     # put chatter You have been pwned by a Bot. Thank you bitchass please come again!
     pause
     var kill.target NULL
     goto KILL_BITCH_DONE
BITCH_2:
     # put chatter Beep boop beep. Destroyer Bot 9000 - +1 Victim
     pause
     var kill.target NULL
     goto KILL_BITCH_DONE
BITCH_3:
     # put chatter Boop Beep Boop.
     pause
     var kill.target NULL
     goto KILL_BITCH_DONE
BITCH_4:
     # put chatter Beep beep beep boop
     pause
     var kill.target NULL
     goto KILL_BITCH_DONE
BITCH_5:
     # put chatter Rapage routine completed
     pause
     var kill.target NULL
     goto KILL_BITCH_DONE
BITCH_6:
     # put chatter You've been raped by a bot. Thank you come again
     pause
     var kill.target NULL
     goto KILL_BITCH_DONE

CHECKPLAYER:
     delay 0.0001
     # debuglevel 10
     if ("$roomplayers" = "") then
          {
               var Players
               return
          }
     var players $roomplayers
     eval players replacere("%players", "Also here\:\s+", "")
     eval players replacere("%players", "Our Lord and Thy\s", "")
     eval players replacere("%players", "Hitler Bad\,\s", "")
     eval players replacere("%players", "\sand", ",")
     eval players replacere("%players", "\.", ", ")
     eval players replacere("%players", "\swho\b[^,]*,", ",")
     eval players replacere("%players", "([\w'-]+\s){0,5}", "")
     eval players replacere("%players", "\,\s+", "|")
     eval players replacere("%players", "\|+" "|")
     eval players replacere("%players", "^\|" "")
     eval len length("%players")
     math len subtract 1
     eval players substr("%players", 0, %len)
     eval totalPlayers count("%players", "|")
     var playerloop 0
     eval Players tolower(%players(%c))
     var PlayersTemp %Players
     CHECKPLAYER_SUBCOUNT:
          math playerloop add 1
          eval PlayersTemp tolower(%players(%playerloop))
          var Players %Players|%PlayersTemp
          if (%playerloop < %totalPlayers) then goto CHECKPLAYER_SUBCOUNT
     # echo players: %Players
     # debuglevel 0
     unvar playerloop
     return


TRAVEL_TO:
     var Travel.Loc $1
     pause 0.1
     if matchre("$guild", "%MAGICUSER") then gosub RELEASE cyclic
     pause 0.1
     matchre TRAVEL_ARRIVED ^YOU ARRIVED\!
     send .travel %Travel.Loc
     matchwait 2500
     put #echo >Log #ff0000 *** ERROR IN TRAVEL_TO: ! Unknown location or did not reach destination!!
     return
#######################################################################################
### EMPTY PACK CHECK - EMPTIES ALL TRASH FROM BAGS
#######################################################################################
EMPTY_PACK_CHECK:
     # debug 5
     var bag $0
     var packcount 0
     delay 0.0001
     gosub stowing
     gosub DUMPSTER_SET
     echo
     echo ################
     echo *** EMPTYING TRASH FROM %bag
     echo ################
     echo
EMPTY_PACK_CHECK_1:
     var TempItem null
     var TempItem2 null
     var Contents null
     action var Contents $1 when ^You rummage through .+ and see (.*)\.
     action var Contents $1 when ^In the .* you see (.*)\.
     matchre EMPTY_PACK_CHECK_2 ^In the .* you see|^There is nothing in there\.|^You rummage|^I could not find|^You feel
     send look in my %bag
     matchwait 4
EMPTY_PACK_CHECK_2:
     action remove ^In the .* you see (.*)\.|^You rummage through .+ and see (.*)\.
     if ("%Contents" = "null") then return
     pause 0.0001
     eval Contents replace("%Contents" , ", " , "|")
     eval Contents replace("%Contents" , " and a" , "|a")
     eval Contents replace("%Contents" , " and an" , "|an")
     eval Contents replace("%Contents" , " and some" , "|some")
     eval Contents replace("%Contents"," with a .+ on it",  "")
     eval Contents replace("%Contents"," on it",  "")
     eval Contents replace("%Contents","some ",  "")
BAG_EMPTY_Loop:
     pause 0.01
     eval item element("%Contents", 0)
     eval number Count("%Contents", "%item")
     var Count 0
     gosub BAG_EMPTY_RemoveLoop
     eval TempItem replacere("%item", "^(\S+ )+(?=\S+ \S+)", "")
     eval TempItem2 replacere("%item", "([\w'-]+\s){0,5}", "")
     var packcount %Count
     if matchre("%TempItem", "%trash") then gosub BAG_EMPTY_ItemAction
     if matchre("%TempItem", "\b((?:%metal.list)\s(armband|broom|cup|fork|griddle|knife|lid|pan|plate|pot|spoon|teapot|bowl))") then gosub BAG_EMPTY_ItemAction
     if ("%Contents" != "") then goto BAG_EMPTY_Loop
     return
 BAG_EMPTY_RemoveLoop:
     eval number Count("%Contents", "%item")
     eval Contents replace("%Contents" , "%item" , "|")
     eval Contents replacere("%Contents" , "\|+" , "|")
     eval Contents replacere("%Contents", "^\|", "")
     eval Contents replacere("%Contents", "\|$", "")
     # eval Contents replacere("%Contents", "\ba ", "")
     evalmath Count (%Count + %number)
     if ("%Contents" = "") then return
     if !contains("%Contents", "%item") then return
     goto BAG_EMPTY_RemoveLoop
BAG_EMPTY_ItemAction:
     math packcount subtract 1
     if matchre("%TempItem", "\b((?!:%metal.list)\s(?:armband|broom|cup|fork|griddle|knife|lid|pan|plate|pot|spoon|teapot|bowl))") then goto BAG_EMPTY_ItemAction2
     if !matchre("%TempItem", "%Trash") then return
BAG_EMPTY_ItemAction2:
     gosub DUMP_ITEM
     if (%packcount < 1) then return
     goto BAG_EMPTY_ItemAction
DUMP_ITEM:
     if (!matchre("%TempItem", "%Trash") && !matchre("%Trash", "%TempItem2")) then
          {
               if !matchre("%TempItem", "\b((?!:%metal.list)\s(?:armband|broom|cup|fork|griddle|knife|lid|pan|plate|pot|spoon|teapot|bowl))") then return
          }
     echo
     echo ################
     echo **** SELLING/DUMPING ITEM:
     echo **** %item
     echo ################
     echo
     pause 0.01
     gosub GET %TempItem from my %bag
     pause 0.2
     pause 0.1
     if !matchre("$righthand $lefthand", "%TempItem2") then gosub GET %TempItem from my watery portal
     pause 0.01
     if !matchre("$righthand $lefthand", "%TempItem2") then
          {
               gosub GET %TempItem2 from my %bag
               pause 0.5
          }
     pause 0.1
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then goto DUMP_ITEM_1
     pause 0.1
     pause 0.1
     if (!matchre("$righthand $lefthand", "%TempItem2") && !matchre("$righthand $lefthand", "%TempItem")) then return
     if (matchre("$righthand", "Empty") && matchre("$lefthand", "Empty")) then return
     pause 0.2
DUMP_ITEM_1:
     echo
     echo ###################################
     echo **** DOUBLE CHECKING %item
     echo *** MAKING SURE IT'S NOT A SPECIAL RARE ITEM
     echo *** OR ONE OF OUR WEAPONS / ARMOR / WANDS / ALMANACS etc..
     echo ###################################
     echo
     pause 0.3
     ### MAKE SURE THE ITEM IN HAND MATCHES THE ITEM WE INTENDED TO TAKE OUT (ROOT VERB MATCHES FULL NAME)
     if (!matchre("$righthand $lefthand", "%TempItem") && !matchre("$righthand $lefthand", "%TempItem2")) then
          {
               echo
               echo ############################
               echo ** FALSE POSITIVE???
               echo ** ITEM NAME DOES NOT MATCH TEMPITEM VAR
               echo ** STOWING FOR SAFE KEEPING!!
               echo ** TempItem = %TempItem
               echo ** TempItem2 = %TempItem2
               echo ############################
               echo
               pause
               gosub stowing
               return
          }
     if (matchre("$righthand $lefthand", "runestone") && matchre("$guild", "%MAGICUSER") && ($Sorcery.Ranks < 60)) then
          {
               echo
               echo #####################
               echo ** SORCERY UNDER 60
               echo ** KEEPING RUNESTONE FOR TRAINING
               echo #####################
               echo
               pause 0.5
               gosub stowing
               return
          }
     echo *** %item PASSES FALSE POSITIVE CHECK
     pause 0.2
     ##### PERSONAL ITEM CHECK - MAKE SURE TRASH ITEM IS NOT ONE OF OUR PERSONAL ITEMS!
     if (matchre("$righthand $lefthand", "(?i)(%ALLWEAPONS|%ALLARMOR|%REPAIR.KIT|%ROPE.NAME|%TEXTBOOK.TYPE|%SKINTRAIN.NOUN|%ALMANAC.TYPE|%LOCKPICK.ITEM|%Wand1|%Wand2)") || matchre("%item", "(?i)(%ALLWEAPONS|%ALLARMOR|%REPAIR.KIT|%ROPE.NAME|%TEXTBOOK.TYPE|%SKINTRAIN.NOUN|%ALMANAC.TYPE|%LOCKPICK.ITEM|%Wand1|%Wand2)")) then
          {
               put #echo >Log #ffff99 *** Trash match alert on %item!!
               put #echo >Log #ffff99 *** Matches one of our items! Stowing for safety!
               echo
               echo #####################
               echo ** WARNING! ~~
               echo ** ITEM: %item MATCHES ONE OF OUR
               echo ** WEAPON/ARMOR/ALMANAC/WAND  ETC VARIABLES!
               echo ** POSSIBLY A FALSE POSITIVE?
               echo ** STOWING IT FOR SAFETY!
               echo #####################
               echo
               pause 0.5
               if matchre("$righthand", "(%ALLWEAPONS|%ALLARMOR|%REPAIR.KIT|%ROPE.NAME|%TEXTBOOK.TYPE|%SKINTRAIN.NOUN|%ALMANAC.TYPE|%LOCKPICK.ITEM|%Wand1|%Wand2)") then gosub STOWIT right
               if matchre("$lefthand", "(%ALLWEAPONS|%ALLARMOR|%REPAIR.KIT|%ROPE.NAME|%TEXTBOOK.TYPE|%SKINTRAIN.NOUN|%ALMANAC.TYPE|%LOCKPICK.ITEM|%Wand1|%Wand2)") then gosub STOWIT left
               pause
               if (matchre("$righthand", "Empty") || matchre("$lefthand", "Empty")) then gosub stowing
               return
          }
     echo *** %item DOES ~NOT~ MATCH OUR MAIN ITEMS!~
     pause 0.2
     ##### RARE ITEM CHECK - MAKE SURE TRASH ITEM IS NOT A RARE ITEM!
     if matchre("$righthand $lefthand", "(?i)(parazonium|mirror .+|senci|vardite|tyrium|telothian|damite|glaes|haralun|kiralan|lumium|nielio|orichalcum|muracite|tomiek|icesteel|assassin's|sniper's|exoskeletal|zweihander|shadowleaf|shadowbark|prayer mat|battle bow|gaethzen|duskblade|umbrella)") then
          {
               put #echo >Log #ffff99 *** Trash match alert on %item!!
               put #echo >Log #ffff99 *** Matches a uber rare item! Stowing for safety!
               echo
               echo #################
               echo ** WARNING! ~~
               echo ** ITEM: %item IS A RARE ITEM!?
               echo ** STOWING IT FOR SAFETY
               echo #################
               gosub stowing
               return
          }
     pause 0.0001
     echo *** %item DOES ~NOT~ MATCH KNOWN RARE ITEMS!
     echo *** %item PASSED ALL SAFEGUARD CHECKS!
     pause 0.5
     echo
     echo #################
     echo *** ATTEMPTING TO SELL: %item
     echo *** IN 2 SECONDS..
     echo *** HIT ESC TO ABORT!
     echo #################
     echo
     pause 0.1
     pause 0.5
     pause 2
     if !matchre("$righthand", "Empty") then put sell my $righthandnoun
     pause 0.4
     if !matchre("$lefthand", "Empty") then put sell my $lefthandnoun
     pause 0.2
     if (matchre("$righthand", "Empty") && matchre("$lefthand", "Empty")) then goto DUMP_ITEM_2
     put sell my %item
     pause 0.4
     pause 0.2
     if (matchre("$righthand", "Empty") && matchre("$lefthand", "Empty")) then goto DUMP_ITEM_2
     if !matchre("%dumpster", "(?i)(NULL|gelapod)") then
          {
               pause 0.2
               if matchre("$righthand", "%TempItem") then put put my %TempItem2 in %dumpster
               if matchre("$lefthand", "%TempItem") then put put my %TempItem2 in %dumpster
               pause 0.5
          }
     if matchre("%dumpster", "gelapod") then
          {
               pause 0.2
               if matchre("$righthand", "%TempItem") then put feed my %TempItem2 to gelapod
               if matchre("$lefthand", "%TempItem") then put feed my %TempItem2 to gelapod
               pause 0.5
          }
     if !matchre("$righthand", "%TempItem") && ("%dumpster" = "NULL") then put put my %TempItem2 in %dumpster
     pause 0.1
     pause 0.1
     if !matchre("$righthand", "Empty") then put drop my $righthandnoun
     if !matchre("$lefthand", "Empty") then put drop my $righthandnoun
     pause 0.1
DUMP_ITEM_2:
     #if (%packcount < 1) then return
     pause 0.1
     goto DUMP_ITEM
###############################################################################################################
### SELL INDIVIDUAL SKINS
SKIN_SELL:
SELL_SKINS:
     var Loop 0
     var skinloop 0
     var SkinContainer $0
     var Total.items.sold 0
     var Total.sales.price 0
     action var Contents $2 when ^You rummage through .+ (and see|but there is) (.*)\.
     action math Total.sales.price add $1;var skinCurrency $2;math Total.items.sold add 1 when hands you (\d+)\s+(Kronars?|Lirums?|Dokoras?|kronars?|lirums?|dokoras?)\.
     # action math total.items.sold add 1;math total.sales.price add $1 when hands you (\d+)
     pause 0.01
     send open my %SkinContainer
     pause 0.3
     pause 0.2
     matchre SELL_SKINS_2 ^You rummage|^I could not|^What were|^You feel|^I don\'t
     send rummage %SkinContainer
     matchwait 20
SELL_SKINS_2:
     eval Contents replace("%Contents", ", ", "|")
     eval Contents replace("%Contents", " and ", "|")
     eval Contents replace("%Contents", "biting its tail", "")
     var Contents |%Contents|
     if matchre("%Contents", "nothing in there") then return
     eval TotalSkins count("%Contents", "|")
SkinLoop:
     math Loop add 1
     eval item element("%Contents", 1)
     eval number count("%Contents", "|%item")
     var Count 0
     gosub SkinRemoveLoop
     if !matchre("%item", "%Skinables") then
          {
               if (%Loop > %TotalSkins) then goto SkinLoop_4
               goto SkinLoop
          }
     action var item $1 when ^@(?:an?|some) .* (\S+)
     put #parse @%item
     var skinloop %number
     if matchre("%item", "%Skinables") then goto SkinLoop_2
     # if (%Loop > 25) then return
     if (%Loop > %TotalSkins) then goto SkinLoop_4
     goto SkinLoop
SkinLoop_2:
     gosub sellskin
SkinLoop_3:
     var Loop 0
     if (%Contents != "|") then goto SkinLoop
SkinLoop_4:
     if (%Total.items.sold > 0) then echo * Sold: %Total.items.sold skins - %Total.sales.price %skinCurrency
     action remove hands you (\d+)\s+(Kronars?|Lirums?|Dokoras?|kronars?|lirums?|dokoras?)\.
     action remove ^You rummage through .+ and see (.*)\.
     unvar SkinContainer
     unvar Loop
     unvar skinloop
     unvar item
     return
SkinRemoveLoop:
     pause 0.001
     pause 0.001
     eval number count("%Contents", "|%item|")
     eval Contents replace("%Contents", "|%item|", "|")
     eval Contents replace("%Contents", "||" "|")
     evalmath Count (%Count + %number)
     if !contains("%Contents", "|%item|") then return
     goto SkinRemoveLoop
sellskin:
     math skinloop subtract 1
     pause 0.001
     gosub GET my %item from my %SkinContainer
     pause 0.1
     if ($righthand = "Empty") then return
     put sell my %item
     pause 0.1
     pause 0.2
     if ($righthand != "Empty") then gosub STOW $righthandnoun
     if ($lefthand != "Empty") then gosub STOW $lefthandnoun
     # if (%skinloop < 1) then return
     goto sellskin
########################################################################################################
# INDIVIDUAL GEM SELLER BY DASFFION - Robustified by Shroom
# action var gemContainer $1 when \s+gems: .+ (\w+)$
SELL_GEMS:
     var gemContainer $0
     var sellgemloop 0
     action send open my %gemContainer;send rummage /b my %gemContainer when ^While it's closed\?
     action var Contents $1 when ^You rummage through .+ and see (.*)\.
     action send hum ruff off;send stop hum;send rummage my gem pouch when ^You feel about a.+gem pouch\.
     action send hum ruff off;send stop hum;send sell my $righthandnoun when ^You might want to be visible for that\.
     echo
     echo #########################
     echo *** SCANNING %gemContainer FOR GEMS
     echo #########################
     echo
SellGems2:
     var Count 0
     var Contents null
     pause 0.001
     math sellgemloop add 1
     # matchre SellGems2 ^\.\.\.wait|^Sorry\,
     # matchre SellGemsNext gems:
     # send store gems
     # matchwait
SellGemsNext:
     pause 0.1
     matchre SellGemsNext ^\.\.\.wait|^Sorry\,
     matchre SellGemsParse ^You rummage|^You feel
     matchre SellGemsParse ^I don\'t know|^I could not|nothing in there
     matchre SellGemsParse ^While it\'s closed
     send rummage /g my %gemContainer
     matchwait 9
SellGemsParse:
     pause 0.001
     pause 0.001
     pause 0.001
     eval Contents replace("%Contents", ", ", "|")
     eval Contents replace("%Contents", " and ", "|")
     eval Contents replacere("%Contents", "(?:and (?:an?|some))", "|")
     var Contents |%Contents|
     eval total count("%Contents", "|")
     if (matchre("%Contents", "I don't know")||matchre("%Contents", "I could not")||matchre("%Contents", "nothing in there")||matchre("%Contents", "nothing in there like that")||matchre("%Contents", "null")||matchre("%Contents", "it's closed")) then goto DoneSellGemLoop
GemPouchLoop:
    eval item element("%Contents", 1)
    eval number count("%Contents", "|%item")
    var Count 0
    var removeloop 0
    gosub GemPouchRemoveLoop
    var removeloop 0
    action var item $1 when ^@a .* (\S+)
    put #parse @%item
    var gemloop %number
    pause 0.1
    echo ** Gem: %item / Count: %number
    gosub SellSingleGem
    if (%Contents != "|") then goto GemPouchLoop
    pause 0.001
GemPouchRemoveLoop:
    math removeloop add 1
    pause 0.01
    # eval nonce count("%Contents", "|%item")
    eval Contents replace("%Contents", "|%item|", "|")
    eval Contents replace("%Contents", "|%item", "|")
    eval Contents replace("%Contents", "||" "|")
    # evalmath Count (%Count + %nonce)
    if !contains("%Contents", "%item") then return
    if (%removeloop > 30) then return
    pause 0.01
    goto GemPouchRemoveLoop
SellSingleGem:
    math gemloop subtract 1
    if contains("%item", "runestone") then return
    if contains("%item", "nothing") then goto DoneSellGemLoop
    pause 0.001
    pause 0.001
    pause 0.01
    gosub GET my %item from my %gemContainer
    pause 0.001
    pause 0.001
    send sell my %item
    wait
    pause 0.2
    pause 0.1
    if contains("%item", "nothing") then goto DoneSellGemLoop
    if matchre("($righthand|$lefthand)", "(?i)%item") then gosub STOWIT %item
    if (%gemloop < 1) then return
    goto SellSingleGem
DoneSellGemLoop:
    if (%sellgemloop < 2) then
     {
          echo ** Double Checking Pouch..
          goto SellGems2
     }
    put #parse DONE SELLING GEMS
    echo ** Done selling gems from %gemContainer
    action remove ^You might want to be visible for that\.
    action remove ^You feel about a.+gem pouch\.
    action remove ^You rummage through .+ and see (.*)\.
    action remove ^While it's closed\?
    pause 0.01
    unvar gemContainer
    unvar gemloop
    unvar sellgemloop
    return
#################################################
### SELL NUGGETS AND BARS
################################################
SELL_NUGGETS:
     echo
     echo ######################
     echo *** SELLING ALL METALS/NUGGETS!
     echo ######################
     echo
     pause 0.1
     action (nugget) math $2.$1 add 1 when ^\s+(?:an?|some) (?:\S+ )?(%metalstosell) (nugget|bar|ingot)
     eval MetalCount count("%metalstosell", "|")
     math MetalCount add 1
     gosub NUGRESET nugget
     gosub NUGRESET bar
     gosub NUGRESET ingot
     pause 0.001
     action (nugget) on
     if matchre("$UC_Container", "(?i)(eddy|portal)") then
          {
               send inv eddy
          }
     else send inv %Container
     pause 0.4
     pause 0.2
     pause 0.1
     if matchre("$UC_Container.Box", "(?i)(eddy|portal)") then
          {
               send inv eddy
          }
     else send inv %Container.Boxes
     pause 0.4
     pause 0.2
     pause 0.1
     if matchre("$UC_Container.Backup", "(?i)(eddy|portal)") then
          {
               send inv eddy
          }
     else send inv %Container.Backup
     pause 0.4
     pause 0.2
     pause 0.1
     # send inv %Container.Crafting
     # waitfor INVENTORY
     action (nugget) off
     pause 0.1
     pause 0.1
     echo ##############
     echo *** SELLING NUGGETS
     echo ##############
     gosub SELL.CRAP nugget
     echo ##############
     echo *** SELLING BARS
     echo ##############
     gosub SELL.CRAP bar
     if def(MC_FORGING.STORAGE) then put close $MC_FORGING.STORAGE
     pause 0.1
     echo ##############
     echo *** SELLING INGOTS
     echo ##############
     gosub SELL.CRAP ingot
     echo
     echo #########################
     echo #########################
     echo * Sold METALS - PROFIT: %TotalGemProfit
     echo #########################
     echo #########################
     echo
     pause 0.1
     if def(MC_FORGING.STORAGE) then put open $MC_FORGING.STORAGE
     unvar SellType
     unvar SellCount
     unvar MetalCount
     unvar nug
     unvar bar.brass
     unvar bar.bronze
     unvar bar.coal
     unvar bar.copper
     unvar bar.covellite
     unvar bar.iron
     unvar bar.lead
     unvar bar.nickel
     unvar bar.oravir
     unvar bar.pewter
     unvar bar.silver
     unvar bar.tin
     unvar bar.zinc
     unvar bar.gold
     unvar bar.electrum
     unvar bar.platinum
     unvar ingot.brass
     unvar ingot.bronze
     unvar ingot.coal
     unvar ingot.copper
     unvar ingot.covellite
     unvar ingot.iron
     unvar ingot.lead
     unvar ingot.nickel
     unvar ingot.oravir
     unvar ingot.pewter
     unvar ingot.silver
     unvar ingot.tin
     unvar ingot.zinc
     unvar ingot.gold
     unvar ingot.electrum
     unvar ingot.platinum
     unvar nugget.brass
     unvar nugget.bronze
     unvar nugget.coal
     unvar nugget.copper
     unvar nugget.covellite
     unvar nugget.iron
     unvar nugget.lead
     unvar nugget.nickel
     unvar nugget.oravir
     unvar nugget.pewter
     unvar nugget.silver
     unvar nugget.tin
     unvar nugget.zinc
     unvar nugget.gold
     unvar nugget.electrum
     unvar nugget.platinum
     action remove ^\s+(?:an?|some) (?:\S+ )?(%metalstosell) (nugget|bar|ingot)
     return
SELL.CRAP:
     var SellType $1
     var SellCount 0
SELL.CRAP_1:
     if (%SellCount > %MetalCount) then return
     if (%%SellType.%metalstosell(%SellCount) > 0) then gosub SELLING
     math SellCount add 1
     goto SELL.CRAP_1
SELLING:
     pause 0.0001
     pause 0.0001
     if (%%SellType.%metalstosell(%SellCount) < 1) then return
     gosub GET %metalstosell(%SellCount) %SellType
     pause 0.0001
     put sell my %metalstosell(%SellCount) %SellType
     pause 0.1
     math %SellType.%metalstosell(%SellCount) subtract 1
     pause 0.0001
     pause 0.0001
     if (!matchre("$righthand", "Empty") || !matchre("$lefthand", "Empty")) then gosub STOWING
     goto SELLING
NUGRESET:
     var nug $1
     var %nug.brass 0
     var %nug.bronze 0
     var %nug.coal 0
     var %nug.copper 0
     var %nug.covellite 0
     var %nug.iron 0
     var %nug.lead 0
     var %nug.nickel 0
     var %nug.oravir 0
     var %nug.pewter 0
     var %nug.silver 0
     var %nug.tin 0
     var %nug.zinc 0
     var %nug.gold 0
     var %nug.electrum 0
     var %nug.platinum 0
     return
##################################################################################################################################
#### ERRORS / MESSAGES
##################################################################################################################################
AUTOHEAL_EXIT:
     echo #####################################
     echo **** VAR AUTOHEAL IS OFF!
     echo **** EXITING COMBAT SCRIPT
     echo **** GO GET YOURSELF HEALED!!!
     echo *** IF YOU WANT THE SCRIPT TO CONTINUE/HEAL AUTOMATICALLY
     echo *** VAR AUTOHEAL ON
     echo #####################################
     put #echo >Log Orange *** AutoHeal is OFF! Exiting Ubercombat - GET HEALED!
     put #parse HELP ESCAPE!
     put #parse HELP ESCAPE!
     put #parse TOO HURT!
     put #parse TOO HURT!
     put #parse HELP.ESCAPE.PLZ!
     put #parse HELP ESCAPE PLZ!
     put #parse ESCAPE PLZ|
     put #parse ESCAPE PLZ|
     exit
WAKE_UP:
     pause 0.001
     gosub clear
     echo
     echo #####################################
     echo *** WE'VE BEEN SLEPT BY A BOX
     echo *** ATTEMPTING TO WAKE UP
     echo *** DO NOT ENTER ANY COMMANDS!!
     echo *** FOR 30+ SECONDS!!!
     echo #####################################
     echo
     pause 0.5
     pause 0.5
     pause 0.5
     put wake
     pause 32
     put kneel
     pause 0.8
     put stand
     pause 0.3
     pause 0.7
     if ($prone = 1) then
          {
               echo #########################################
               echo *** I TOLD YOU NOT TO TYPE ANYTHING DUMBASS!!!
               echo *** RESTARTING... DO NOT FUCKING TYPE!!!!
               echo #########################################
               goto WAKE_UP
          }
     echo ##########################
     echo ** ATTEMPTING TO RECOVER...
     echo ##########################
     pause 0.7
     goto %LAST
WELCOME:
     put #echo >Log #0080FF cxxxxxxâªâªÂ§][=============================>
     put #echo >Log #03CA9D -=x= ~UBER COMBAT~ v.%version ~~~ =x=-
     put #echo >Log #00ff00 â¡ WEAPON SWAP! in combat to skip to next weapon
     put #echo >Log #00ff00 â¡ TOWN RUN! in combat to escape to healing/town run
     put #echo >Log #00ff00 â¡ SKIP! in town run to skip to next module
     put #echo >Log #00ff00 â¡ SKIPALL! in town run to return to combat
     put #echo >Log #0080FF o()xxxxxxxx[{::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::>
     echo
     echo
     echo ================
     echo * ~~ UBER COMBAT ~~
     echo * ~ Version: %version
     echo * The Ultimate DR Bot!
     echo ================
     echo
     echo
     echo                     ____
     echo                   .'* *.'
     echo                __/_*_*(_
     echo               / _______ \     (-
     echo              _\_)/___\(_/_    )
     echo             / _((\- -/))_ \    (
     echo             \ \())(-)======
     echo              ' \(((()))/ '
     echo             / ' \)).))/ ' \
     echo            / _ \ - | - /_  \
     echo           (   ( .;''';. .'  )
     echo           _\"_ /    )\ _"/_
     echo             \/  \   ' /  \/
     echo              .'  '...' ' )
     echo               / /  |  \ \
     echo              / .   .   . \
     echo             /   .     .   \
     echo            /   /   |   \   \
     echo          .'   /    b    '.  '.
     echo      _.-'    /     Bb     '-. '-._
     echo  _.-'       |      BBb       '-.  '-.
     echo (____mfr\___.dBBBb.___)___)
     echo
     return
################################################################################
EXIT:
     echo
     echo #####################################
     echo *** SCRIPT FINISHED!
     echo *** IF YOU WANT SCRIPT TO LOOP AND RETURN YOU TO COMBAT
     echo *** SET THE VAR RETURN.TO.COMBAT to ON!~
     echo #####################################
     echo
     put #parse UBER COMBAT FINISHED!
     put #parse UBER COMBAT FINISHED!
     put #echo >Log #ff00ff ** Ubercombat finished! Turn Return.To.Combat ON to continue after healing
     exit
WEAPON_ERROR:
     if (("$guild" = "Warrior Mage") && ($UC_SummonWeapons = 1)) then
     {
          if (matchre("%WEAPON_EXP", "Small_Edged") && matchre("%SummonSE", "(?i)(ON|1|YES)")) then
               {
                    gosub SUMMON_WEAPON SE
                    return
               }
          if (matchre("%WEAPON_EXP", "Small_Blunt") && matchre("%SummonSB", "(?i)(ON|1|YES)")) then
               {
                    gosub SUMMON_WEAPON SB
                    return
               }
          if (matchre("%WEAPON_EXP", "Large_Blunt") && matchre("%SummonLB", "(?i)(ON|1|YES)")) then
               {
                    gosub SUMMON_WEAPON LB
                    return
               }
          if (matchre("%WEAPON_EXP", "Twohanded_Blunt") &&  matchre("%SummonTHB", "(?i)(ON|1|YES)")) then
               {
                    gosub SUMMON_WEAPON 2HB
                    return
               }
          if (matchre("%WEAPON_EXP", "Heavy_Thrown") && matchre("%SummonHT", "(?i)(ON|1|YES)")) then
               {
                    gosub SUMMON_WEAPON HT
                    return
               }
          if (matchre("%WEAPON_EXP", "Light_Thrown") && matchre("%SummonLT", "(?i)(ON|1|YES)")) then
               {
                    gosub SUMMON_WEAPON LT
                    return
               }
          if (matchre("%WEAPON_EXP", "Large_Edged") && matchre("%SummonLE", "(?i)(ON|1|YES)")) then
               {
                    gosub SUMMON_WEAPON Large Edged
                    return
               }
          if (matchre("%WEAPON_EXP", "Twohanded_Edged") && matchre("%SummonTHE", "(?i)(ON|1|YES)")) then
               {
                    gosub SUMMON_WEAPON 2HE
                    return
               }
          if (matchre("%WEAPON_EXP", "Stave") && matchre("%SummonStaves", "(?i)(ON|1|YES)")) then
               {
                    gosub SUMMON_WEAPON Stave
                    return
               }
          if (matchre("%WEAPON_EXP", "Polearm") && matchre("%SummonPolearms", "(?i)(ON|1|YES)")) then
               {
                    gosub SUMMON_WEAPON Polearm
                    return
               }
     }
     echo
     echo ############################################################################
     echo *** NO WEAPON FOUND!! WHERE IS YOUR WEAPON??
     echo *** CHECK TO MAKE SURE YOUR WEAPON VARIABLES ARE PROPERLY SETUP!
     echo *** SET ANY WEAPON YOU AREN'T USING TO NULL
     echo ############################################################################
     echo *** IMPORTANT: WEAPON VARIABLE MUST EXACTLY MATCH HOW THE WEAPON LOOKS IN HAND!
     echo *** AND ONLY 2 WORDS MAXIMUM - DO NOT USE PERIODS
     echo *** Ex. 'stout longsword' - do NOT use 'stout.longsword' or black stout longsword
     echo ##############################################################################
     echo
     put #echo >Log #ff0000 *** Weapon not found! - %WEAPON - Check weapon variables! Turning off $UC_WeaponType
     pause
     if ("$UC_WeaponType" = "THE") then put #var UC_WEAPON_THE NULL
     if ("$UC_WeaponType" = "LE") then put #var UC_WEAPON_LE NULL
     if ("$UC_WeaponType" = "SE") then put #var UC_WEAPON_SE NULL
     if ("$UC_WeaponType" = "THB") then put #var UC_WEAPON_THB NULL
     if ("$UC_WeaponType" = "LB") then put #var UC_WEAPON_LB NULL
     if ("$UC_WeaponType" = "SB") then put #var UC_WEAPON_SB NULL
     if ("$UC_WeaponType" = "STAVES") then put #var UC_WEAPON_STAVES NULL
     if ("$UC_WeaponType" = "POLEARMS") then put #var UC_WEAPON_POLEARMS NULL
     if ("$UC_WeaponType" = "CROSSBOW") then put #var UC_WEAPON_CROSSBOW NULL
     if ("$UC_WeaponType" = "BOW") then put #var UC_WEAPON_BOW NULL
     if ("$UC_WeaponType" = "SLINGS") then put #var UC_WEAPON_SLING NULL
     if ("$UC_WeaponType" = "LT") then put #var UC_WEAPON_LT NULL
     if ("$UC_WeaponType" = "HT") then put #var UC_WEAPON_HT NULL
     if ("$UC_WeaponType" = "BACKSTAB") then put #var UC_WEAPON_BS NULL
     if ("$UC_WeaponType" = "OFFHAND") then put #var UC_WEAPON_OH NULL
     goto SWITCH
ABSOLUTION_ERROR:
     gosub clear
     echo
     echo ################################
     echo *** FATAL ABSOLUTION ERROR!!!!
     echo *** DID NOT DETECT KNOWING ABSOLUTION SPELL
     echo *** AND YOU ARE HUNTING AN UNDEAD CREATURE!
     echo *** ABORTING SCRIPT!!!
     echo *** GET ABSOLUTION OR CHOOSE A NON-UNDEAD TO HUNT
     echo ################################
     echo
     put #echo >Log #ff0000 ** Absolution Error - No Absolution Spell! Hunt a Non-Undead or Get Absolution spell!
     pause
     exit
CURSED_ITEM:
     gosub clear
     echo
     echo #############################
     echo *** ERROR IN STOWING!
     echo *** WE HAVE A CURSED ITEM IN HANDS!
     echo *** THE ONLY THING YOU CAN DO IS WAIT FOR IT TO WEAR OFF
     echo *** OR GET A CLERIC TO UNCURSE YOU
     echo ############################
     echo
     echo **** WAITING FOR IT TO WEAR OFF
     echo **** WILL TRY AGAIN IN 10 MINUTES
     echo
     put #echo >Log #ff0000 *** ERROR! Cursed Item in hands!! Waiting 10 minutes and trying again
     pause 100
     put glance
     pause 100
     put glance
     pause 100
     put glance
     pause 100
     put glance
     pause 100
     put glance
     pause 100
     put glance
     goto INIT_PREP
OFFHAND_ERROR:
     math errorloop add 1
     if (%errorloop < 3) then
          {
               gosub SWAP
               goto OFFHAND
          }
     echo
     echo #################################
     echo ***         OFFHAND WEAPON ERROR!!!
     echo *** OFFHAND WEAPON TOO LARGE! USE LIGHTER WEAPON
     echo *** OFFHAND WEAPON MUST BE UNDER 30 STONES!!
     echo #################################
     echo
     put #echo >Log #ff0000 ** OFFHAND ERROR - Weapon too heavy! Choose lighter weapon under 30 stones!
     var UC_WEAPON_OH NULL
     put #var UC_WEAPON_OH NULL
     pause
     var errorloop 0
     goto SWITCH
FULL_GEMS:
     echo
     echo ###############################
     echo *** OH NO! GEMPOUCH CONTAINER IS TOO FULL!
     echo *** MAKE SOME MORE ROOM OR SELL FULL GEM POUCHES!
     echo *** OR USE A BIGGER BAG.. ITS JUST A FEW POUCHES JEEZ
     echo ###############################
     echo
     put #echo >Log Crimson *** GemPouch Container - $UC_Container.GemPouch is too full to store gem pouches!
     put #echo >Log Crimson *** Make room / Sell full gem pouches! - Use a bigger bag, it's just a few pouches jeez
     var Loot.Gems OFF
     gosub PUT close my $UC_Container.GemPouch
     gosub stowing
     goto DROP_LOOT
MISSING_SHIELD:
     if (("$guild" = "Cleric") && matchre("%buffs", "(?i)(SOL|ShieldofLight)") && matchre("$UC_MyShield", "(?i)shield") && (%SOLcheck = 0)) then
          {
               var SOLcheck 1
               gosub PREPARE SOL $Mana.SOL
               pause 15
               gosub SPELL_CAST
               pause
               goto SHIELD_CHECK
          }
     echo
     echo #############################################
     echo ** MISSING SHIELD!! OH NOEZ! WHAT HAPPENED?
     echo ** DOUBLE CHECK YOUR VARIABLES
     echo #############################################
     echo ##########################################################################################
     echo ** ALSO MAKE SURE THAT YOUR ~Container.GemPouch~ & ~REPAIR.KIT.CONTAINER~ VARIABLES DO NOT MATCH YOUR MAIN BAGS!!!
     echo ** REPAIR.KIT.CONTAINER and CONTAINER.GEMPOUCH ARE SPECIAL CONTAINERS THAT ARE KEPT CLOSED
     echo ** DO NOT SHARE THESE BAGS WITH ANY OF YOUR MAIN CONTAINERS!
     echo ###########################################################################################
     echo
     pause 10
     put #echo >Log Crimson *** SHIELD MISSING! OH NOEZ! ABORT! (Check variables)
     var TicketCheck 1
     gosub OPEN_CONTAINERS
     pause 0.5
     goto ESCAPE
BAG_ERROR:
     echo
     echo #############################################
     echo *** CRITICAL BAG ERROR
     echo *** FIX YO BAG SITUATION!
     echo *** You should have multiple different bags
     echo *** And bags big enough to hold all your weapons
     echo #############################################
     echo
     pause
     put #echo >Log #ff4da6 *** CRITICAL BAG ERROR AT REPAIRODONE!
     put #echo >Log #ff4da6 *** FIX YOUR BAG SITUATION!
     exit
BAD_BAGS_ERROR:
     echo
     echo #############################################
     echo *** CRITICAL BAG ERROR! YOUR CONTAINERS ARE SET INCORRECTLY!!
     echo *** GEMPOUCH CONTAINER AND REPAIRKIT CONTAINER ARE MATCHING WITH MAIN CONTAINERS!
     echo *** THESE ARE SPECIAL CONTAINERS - THEY MUST BE KEPT CLOSED DURING THE RUN!
     echo *** THIS BAG MUST NOT MATCH WITH ANY OF YOUR OTHER MAIN CONTAINERS!!!
     echo ***
     echo *** Offending Var: %errortype  |  Bag: %errorbag
     echo *** MAKE SURE - %errorbag IS ~ONLY~ USED FOR GEMPOUCH/REPAIRKIT CONTAINERS
     echo #############################################
     echo
     pause
     put #echo >Log #ff4da6 *** CRITICAL BAG ERROR! %errorbag CANNOT MATCH MAIN BAGS!!
     exit
OUT_OF_SPACE:
     echo
     echo #################################
     echo *** CRITICAL ERORR! NO SPACE - ALL BAGS ARE FULL!
     echo *** MAKE SOME MORE SPACE IN YOUR BAGS!
     echo *** OR GET SOME BIGGER BAGS NOOB!
     echo ################################
     echo
     pause
     put #echo >Log #ff4da6 *** CRITICAL ERROR! ALL BAGS FULL??! Escaping Combat! Make some room!
     put #var UC_bagsFull 1
     put #var UC_bundleFull 1
     put #parse BAGS TOO FULL!
     if ("%LAST" = "ESCAPE.BAGS") then goto ESCAPE_REAL_2
     goto ESCAPE.BAGS
BAD_WEAPON:
     echo #############################################
     echo *** ERROR! %WEAPON NOT A RECOGNIZED WEAPON!!!
     echo *** UPDATE YOUR WEAPON VARIABLES TO BE MORE SPECIFIC
     echo *** MUST MATCH THE EXACT NAME AS SEEN IN DR
     echo *** i.e: a sinuous elven gold dagger = gold dagger NOT elven dagger
     echo #############################################
     put #echo >Log #ff0000 ** Weapon Error! %WEAPON is not a weapon - Update your weapon Variables
     gosub stowing
     goto SWITCH
TOO_MANY_ITEMS:
     action (inventory) off
     echo
     echo #############################################
     echo ** WARNING! INVENTORY COUNT TOO TOO HIGH!!
     echo ** EMPTY YOUR BAGS AND CLEAR OUT SOME SPACE!
     echo ** AT RISK OF ENDING UP IN JUNK YARD!
     echo #############################################
     echo
     pause 2
     echo #####################################
     echo ** ESCAPING COMBAT TO CLEAR OUT BAGS
     echo ** SELL GEMS / SKINS / PICK BOXES
     echo ####################################
     echo
     put #echo >Log #e600e6 *** WARNING: Inventory count too high - at risk of Junk Yard!
     put #play Error.wav
     pause
     put #var UC_bagsFull 1
     put #var UC_bundleFull 1
     put #parse BAGS TOO FULL!
     goto ESCAPE.BAGS
JUNK.YARD:
     echo
     echo ####################################
     echo * OH NO! LANDED IN THE JUNK YARD!!!
     echo * DUMP ALL YOUR TRASH!!!
     echo * ABORTING SCRIPT
     echo ####################################
     echo
     put #echo >Log Crimson *** ALERT! LANDED IN THE JUNK YARD!
     put #echo >Log Crimson *** GET RID OF SOME ITEMS!
     put #play Error.wav
     exit
NO_FUNDS:
     if (%debt = 1) then goto NO_MONEY_DEBT
     put #echo >Log #ff0000 ########################################################################
     put #echo >Log #ff0000 **** CRITICAL ERROR!!! WARNING!! OUT OF FUNDS TO PAY FINE IN %CITY !!
     put #echo >Log #ff0000 **** DO NOT PASS GO! DO NOT COLLECT TWO HUNDRED DOLLA!
     put #echo >Log #ff0000 **** GO GET SOME MONEY FROM ANOTHER TOWN AND PAY YOUR FINE ASAP!
     put #echo >Log #ff0000 **** YOU MUST PAY YOUR FINE IN %CITY WITHIN ~24 HOURS OR YOU COULD LOSE YOUR STUFF!
     put #echo >Log #ff0000 ########################################################################
     echo
     echo ########################################################################
     echo * WARNING! YOU DON'T HAVE ENOUGH MONEY TO PAY THIS FINE!
     echo * GO GET SOME FUNDS FROM ANOTHER BANK AND PAY YOUR FINE AND GET YOUR STUFF!
     echo * IT IS RECOMMENDED TO KEEP PLENTY OF PLATS IN THE BANK IN THE CITIES YOU STEAL IN!
     echo * THE FINES CAN RACK UP ESPECIALLY IF YOU DO NOT REGULARLY CLEAR YOUR HEAT!
     echo ########################################################################
     echo
     echo ########################################################################
     echo **** GET SOME MONEY FROM ANOTHER BANK AND PAY YOUR FINE IN %CITY !!!!!!!!!!
     echo ########################################################################
     put #parse OUT.OF.FUNDS
     put #parse DONE STEALING!
     pause 0.5
     exit
NO_MONEY_MRISS:
     put #echo >Log #ff0000 ########################################
     put #echo >Log #ff0000 **** ERROR! NOT ENOUGH MONEY IN MERK TO TRAVEL TO MRISS
     put #echo >Log #ff0000 **** OR YOU ARE NECRO AND KNOWN AS NECRO HERE - SO WE SKIPPED THE BANK
     put #echo >Log #ff0000 **** PUT SOME MONEY IN MERK BANK! OR GET SOME COINS SOMEHOW
     put #echo >Log #ff0000 ########################################
     echo ###############################################################
     echo **** ERROR! NOT ENOUGH MONEY IN MERK TO TRAVEL TO MRISS
     echo **** OR YOU ARE NECRO AND KNOWN AS NECRO HERE - SO WE SKIPPED THE BANK
     echo **** PUT SOME MONEY IN MERK BANK! OR GET SOME COINS SOMEHOW
     echo ###############################################################
     echo
     put #parse OUT.OF.FUNDS
     put #parse DONE STEALING!
     pause 0.5
     exit
#######################################
#####################################
# LOGOUT AND RECONNECTION SUBS
######################################
QUIT:
     delay 0.005
     matchre QUIT ^\.\.\.wait\s+\d+\s+sec(?:onds?|s)?\.?
     matchre QUIT ^Sorry\,
     matchre RETURN ^\[\d+\:\d+\] Connection closed\.
     matchre RETURN ^Disconnected from\:
     put quit
     put exit
     matchwait 5
     exit
EXIT_DEATH:
     action (stunned) off
     action (reconnect) off
     action (combat) off
     action (escape) off
     put #queue clear
     gosub clear
     put #echo >Log Crimson *** ZOINKS WE DIED OR ARE ABOUT TO!
     echo ==========
     echo *** DIED!!!
     echo ==========
     if ($UC_Log.on.Death = 0) then goto EXIT_ALT
     gosub QUIT
     put exit
     put #echo >Log Crimson *** FULL EXIT INITIATED!
     put #script abort all
     exit
EXIT_ALT:
     echo #############################
     echo ** LOG.ON.DEATH IS DISABLED
     echo ** STAYING LOGGED IN!
     echo ** GOOD LUCK!~
     echo #############################
     pause
     put look
     pause
     exit
EXIT_FULL:
     action (stunned) off
     action (reconnect) off
     action (combat) off
     action (escape) off
     put #queue clear
     delay 0.001
     if ($UC_Log.on.Stun = 0) then
          {
               echo
               echo **** LOG.ON.STUN IS DISABLED!!!!
               echo **** ATTEMPTING TO ESCAPE...
               echo **** Good luck!
               if (("$guild" = "Thief") && ($circle > 70)) then
                    {
                         put khri vanish
                         pause 0.4
                    }
               goto ESCAPE_NOW
          }
     math LOGOFF add 1
     put #var UC_Logouts %LOGOFF
     put #var save
     gosub clear
     gosub QUIT
     pause 0.1
     echo
     echo #############################
     echo **** FULL EXIT INITIATED ****
     echo #############################
     echo
     put exit
     put #echo >Log Crimson *** FULL EXIT INITIATED!
     put #script abort
     exit
EXIT_QUICK:
     delay 0.005
     put #queue clear
     var person $1
     action (reconnect) off
     put #echo >Log Crimson *** %person tried to drag us away!!
     if ($UC_No.Contact = 0) then
          {
               echo
               echo **** NO.CONTACT IS DISABLED!!
               echo **** %person TRIED TO ATTACK US!
               echo *** ATTEMPTING TO ESCAPE
               echo
               goto ESCAPE
          }
     math LOGOFF add 1
     put #var UC_Logouts %LOGOFF
     put #var save
     gosub clear
     gosub QUIT
     pause 0.1
     echo
     echo #############################
     echo * %person TRIED TO ATTACK US
     echo * LOGGING OFF FOR 5 MINUTES
     echo #############################
     echo
     put exit
     put #echo >Log Crimson *** SOMEONE TRIED ATTACKING OR DRAGGING US! LOGGING OUT FOR 5 MINUTES!
     pause
     pause
     pause
     pause
     action (reconnect) on
     pause 300
     goto STUN.CONNECT
STUNNEDOUT:
     action (stunned) off
     action (reconnect) off
     action (combat) off
     action (escape) off
     put #queue clear
     gosub clear
     put #script abort all except %scriptname
     if ($UC_Log.on.Stun = 0) then
          {
               echo
               echo **** LOG.ON.STUN IS DISABLED!!!!
               echo **** ATTEMPTING TO ESCAPE...
               echo **** Good luck!
               action (escape) off
               goto ESCAPE_NOW
          }
     put #echo >Log #cc00ff ***** TOO HURT! STUNNED OUT! *****
     put #echo >Log #cc00ff **** LOGGING OUT FOR 45 MINUTES ****
     var escape.loop 0
     gosub QUIT
     pause
     pause
     pause
     math LOGOFF add 1
     put #var UC_Logouts %LOGOFF
     put #var save
     echo *** TOO HURT!!! PANIC EXIT! ***
     echo *** LOGGING OUT FOR 45 MINUTES TO LET MONSTERS CLEAR OUT!
     action (reconnect) on
     pause 2400
     echo *** 6 MINUTES LEFT!! ***
     pause 360
STUN.CONNECT:
     echo *** LOGGING BACK IN! BE CAREFUL! ***
     echo *** You have been stunned out.  Attempting to reconnect ***
     put #echo >Log #e600e6 *** Reconnecting after stun... Be careful! ***
     action goto STUN.CONNECTED when You look around, taking a moment to get your bearings|Welcome to DragonRealms
STUN.CONNECTING:
     action (stunned) off
     action (combat) off
     action (escape) off
     gosub CONNECT_NOW
     pause 2
STUN.CONNECTED:
     var stun.connect ON
     pause 0.5
     pause
     goto ESCAPE

DISCONNECTED:
     put #var connected 0
     action (reconnect) off
     action (stunned) off
     action (combat) off
     action (escape) off
     gosub clear
     pause 0.3
     # action (reconnect) off
     # put #script abort all except %scriptname
     put #echo >Log Orange *** DISCONNECTED! Attempting reconnect in 15 seconds ***
     echo *** YOU HAVE BEEN DISCONNECTED!  Attempting to reconnect in 15 seconds.. ***
     pause 0.5
     math LOGOFF add 1
     put #var UC_Logouts %LOGOFF
     put #var save
RECONNECT_TRY:
     pause 12
     gosub CONNECT_NOW
     pause 4
     if ($connected = 1) then goto RECONNECTED
     pause 2
     if ($connected = 0) then goto RECONNECT_TRY
     goto RECONNECTED
RECONNECTED:
     action (escape) off
     action (stunned) off
     pause .001
     put look
     pause
     pause
     if ($connected = 0) then goto RECONNECT_TRY
     echo *** You have been Reconnected ***
     put #echo >Log #00FF00  *** RECONNECTED! - Restarting script! ***
     # put #script abort all except %scriptname
     pause 0.5
     pause 0.5
     if ($health < 75) && (%InCombat = 1) then goto ESCAPE
     if ($bleeding = 1) && (%InCombat = 1) then goto ESCAPE
     #if ($health < 20) then goto exit
     action (reconnect) on
     pause 0.1
     pause 0.1
     goto ESCAPE_DC
### CONNECT SUB
RECONNECT:
     delay 0.0001
     gosub CONNECT_NOW
     goto ESCAPE
CONNECT:
     delay 0.0001
     var connectloop 0
     pause 300
     goto CONNECT_RETRY
CONNECT_NOW:
     action (reconnect) off
     delay 0.0001
     var connectloop 0
CONNECT_RETRY:
     delay 0.0001
     pause 0.5
     math connectloop add 1
     if (%connectloop > 10) then goto CONNECT_WAIT
     pause 0.1
     put #echo >Log LightCyan *** Reconnect Attempt %connectloop
CONNECTING:
     pause 0.3
     put #connect
     pause 3
     pause
     put look
     pause 6
     pause
     if ($connected = 0) then goto CONNECT_RETRY
CONNECTED:
     pause 0.3
     put #echo >Log #00FF00  ******** Reconnected!
     pause 2
     unvar connectloop
     # action (reconnect) on
     return
CONNECT_WAIT:
     pause 0.1
     put #echo >Log LightCyan *** Reconnect pausing 60 seconds..
     pause 60
     goto CONNECT

GENIE_FUCKUP:
   put #echo >Log #cc00ff **** GENIE FUCKUP - ATTEMPTING TO RECOVER!! ****
RESTART.GENIE:
RESTART:
   action (reconnect) off
   pause 0.2
   var main_script_cmd $scriptlist(0)
   eval main_script replace("%main_script_cmd", ".cmd", "")
   put /restart $charactername$gamename .%main_script
   put #beep
   put quit
   # put #script abort all
   exit

#### CATCH AND RETRY SUBS
WAIT:
     delay 0.0001
     pause 0.0001
     pause 0.1
     pause 0.1
     if ($standing = 0) then send STAND
     goto %LOCATION
WEBBED:
     delay 0.0001
     if ($webbed) then waiteval (!$webbed)
     if ($standing = 0) then send STAND
     goto %LOCATION
IMMOBILE:
     delay 0.0001
     if contains("$prompt" , "I") then pause 20
     if ($standing = 0) then send STAND
     goto %LOCATION
STUNNED:
     delay 0.0001
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then send STAND
     goto %LOCATION
CALMED:
     delay 5
     if ($stunned) then waiteval (!$stunned)
     if ($standing = 0) then send STAND
     goto %LOCATION
STOWFOOTITEM:
     pause 0.001
     if matchre("%footitem", "(mat|rug|cloth|tapestry)") then
          {
               put roll my %footitem
               pause 0.5
          }
     if !matchre("$lefthand", "Empty") && !matchre("$righthand", "Empty") then gosub STOWIT left
     pause 0.001
     put STOW feet
     pause 0.3
     pause 0.1
     put STOW feet
     pause 0.2
     pause 0.2
     goto %LAST
#### OLD RETRY - STILL USES location.unload
RETRY:
     matchre location ^\.\.\.wait
     matchre location ^Sorry, you may
     matchre location ^Sorry, system is slow
     matchre location ^You don't seem to be able to move to do that
     matchre location.p ^It's all a blur
     matchre location.p ^You're unconscious\!
     matchre location.p ^You are still stunned
     matchre location.p There is no need for violence here\.
     matchre location.p ^You can't do that while entangled in a web
     matchre location.p ^You struggle against the shadowy webs to no avail\.
     matchre location.p ^You attempt that, but end up getting caught in an invisible box\.
     matchre location1 ^You should stop Playing before you do that\.
     matchre location1 ^You are a bit too busy performing to do that\.
     matchre location1 ^You are concentrating too much upon your performance to do that\.
     matchwait 22
     put #echo >Log Gold matchwait %location %todo
LOCATION.P:
     pause
LOCATION:
     pause 0.1
     goto %LOCATION
LOCATION.UNLOAD:
     gosub unload
     var LOCATION STOW_1
     gosub STOW_1
     return
LOCATION.UNLOAD1:
     gosub unload
     var LOCATION WEAR_1
     gosub WEAR_1
     return
LOCATION1:
     send stop play
     pause 0.1
     goto %LOCATION
#### EMPATH HEALTH CHECK (ONLY IF BLEEDING)
EMPATH_HEALTH:
     delay 0.0001
     put #var needHealing 0
     delay 0.2
     pause 0.1
     matchre HEALTH_BAD ^Bleeding
     matchre HEALTH_GOOD You have no significant injuries\.
     matchre HEALTH_GOOD ^\s*Encumbrance\s+\:
     put -health;-0.05 encumbrance
     matchwait 15
     goto HEALTH_BAD
#### HEALTH CHECKING
HEALTH_CHECK:
     delay 0.00001
     var BLEEDING_HEAD NO
     var BLEEDING_NECK NO
     var BLEEDING_CHEST NO
     var BLEEDING_ABDOMEN NO
     var BLEEDING_BACK NO
     var BLEEDING_R_ARM NO
     var BLEEDING_L_ARM NO
     var BLEEDING_R_LEG NO
     var BLEEDING_L_LEG NO
     var BLEEDING_R_HAND NO
     var BLEEDING_L_HAND NO
     var BLEEDING_L_EYE NO
     var BLEEDING_R_EYE NO
     var BLEEDING_SKIN NO
     action var BLEEDING_HEAD YES when ^(?!.*\(tended\))\s*(head)\s{7}(.*)
     action var BLEEDING_NECK YES when ^(?!.*\(tended\))\s*(neck)\s{7}(.*)
     action var BLEEDING_CHEST YES when ^(?!.*\(tended\))\s*(chest)\s{7}(.*)
     action var BLEEDING_ABDOMEN YES when ^(?!.*\(tended\))\s*(abdomen)\s{7}(.*)
     action var BLEEDING_BACK YES when ^(?!.*\(tended\))\s*(back)\s{7}(.*)
     action var BLEEDING_R_ARM YES when ^(?!.*\(tended\))\s*r(?:ight|.) arm\s{7}(.*)
     action var BLEEDING_L_ARM YES when ^(?!.*\(tended\))\s*l(?:eft|.) arm\s{7}(.*)
     action var BLEEDING_R_LEG YES when ^(?!.*\(tended\))\s*r(?:ight|.) leg\s{7}(.*)
     action var BLEEDING_L_LEG YES when ^(?!.*\(tended\))\s*l(?:eft|.) leg\s{7}(.*)
     action var BLEEDING_R_HAND YES when ^(?!.*\(tended\))\s*r(?:ight|.) hand\s{7}(.*)
     action var BLEEDING_L_HAND YES when ^(?!.*\(tended\))\s*l(?:eft|.) hand\s{7}(.*)
     action var BLEEDING_L_EYE YES when ^(?!.*\(tended\))\s*l(?:eft|.) eye\s{7}(.*)
     action var BLEEDING_R_EYE YES when ^(?!.*\(tended\))\s*r(?:ight|.) eye\s{7}(.*)
     action var BLEEDING_SKIN YES when ^(?!.*\(tended\))\s*(skin)\s{7}(.*)
     action var BLEEDING_HEAD YES when (lodged\s*.*|mite|leech) (into|in|on) your head
     action var BLEEDING_NECK YES when (lodged\s*.*|mite|leech) (into|in|on) your neck
     action var BLEEDING_CHEST YES when (lodged\s*.*|mite|leech) (into|in|on) your chest
     action var BLEEDING_ABDOMEN YES when (lodged\s*.*|mite|leech) (into|in|on) your abdomen
     action var BLEEDING_BACK YES when (lodged\s*.*|mite|leech) (into|in|on) your back
     action var BLEEDING_R_ARM YES when (lodged\s*.*|mite|leech) (into|in|on) your right arm
     action var BLEEDING_L_ARM YES when (lodged\s*.*|mite|leech) (into|in|on) your left arm
     action var BLEEDING_R_LEG YES when (lodged\s*.*|mite|leech) (into|in|on) your right leg
     action var BLEEDING_L_LEG YES when (lodged\s*.*|mite|leech) (into|in|on) your left leg
     action var BLEEDING_R_HAND YES when (lodged\s*.*|mite|leech) (into|in|on) your right hand
     action var BLEEDING_L_HAND YES when (lodged\s*.*|mite|leech) (into|in|on) your left hand
     action var BLEEDING_L_EYE YES when (lodged\s*.*|mite|leech) (into|in|on) your left eye
     action var BLEEDING_R_EYE YES when (lodged\s*.*|mite|leech) (into|in|on) your right eye
     action put #var needHealing 0 when ^You have no significant injuries\.
     put #var needHealing 0
     pause 0.0001
     matchre HEALTH_BAD ^Bleeding
     matchre HEALTH_GOOD You have no significant injuries\.
     matchre HEALTH_GOOD ^You have a mildly poisoned
     matchre HEALTH_CHECK_2 ^You have a dormant infection\.
     matchre HEALTH_BAD ^\s*Encumbrance\s+\:
     put -health;-0.05 encumbrance
     matchwait 20
     goto HEALTH_CHECK
HEALTH_BAD:
     put #var needHealing 1
     pause 0.0001
     if ($needHealing = 0) then goto HEALTH_GOOD
     action remove ^You have no significant injuries\.
     goto HEALTH_REMOVE
HEALTH_CHECK_2:
     delay 0.0001
     put #queue clear
     if ("$guild" = "Necromancer") then put #var needHealing 0
     else put #var needHealing 1
     goto HEALTH_REMOVE
HEALTH_GOOD:
     delay 0.0001
     # if (%TicketCheck = 1) then goto HEALTH_BAD
     put #queue clear
     put #var needHealing 0
     action remove ^You have no significant injuries\.
     goto HEALTH_REMOVE
HEALTH_REMOVE:
     action remove ^(?!.*\(tended\))\s*(head)\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*(neck)\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*(chest)\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*(abdomen)\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*(back)\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*r(?:ight|.) arm\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*l(?:eft|.) arm\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*r(?:ight|.) leg\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*l(?:eft|.) leg\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*r(?:ight|.) hand\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*l(?:eft|.) hand\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*l(?:eft|.) eye\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*r(?:ight|.) eye\s{7}(.*)
     action remove ^(?!.*\(tended\))\s*(skin)\s{7}(.*)
     action remove (lodged\s*.*|mite|leech) (into|in|on) your head
     action remove (lodged\s*.*|mite|leech) (into|in|on) your neck
     action remove (lodged\s*.*|mite|leech) (into|in|on) your chest
     action remove (lodged\s*.*|mite|leech) (into|in|on) your abdomen
     action remove (lodged\s*.*|mite|leech) (into|in|on) your back
     action remove (lodged\s*.*|mite|leech) (into|in|on) your right arm
     action remove (lodged\s*.*|mite|leech) (into|in|on) your left arm
     action remove (lodged\s*.*|mite|leech) (into|in|on) your right leg
     action remove (lodged\s*.*|mite|leech) (into|in|on) your left leg
     action remove (lodged\s*.*|mite|leech) (into|in|on) your right hand
     action remove (lodged\s*.*|mite|leech) (into|in|on) your left hand
     action remove (lodged\s*.*|mite|leech) (into|in|on) your left eye
     action remove (lodged\s*.*|mite|leech) (into|in|on) your right eye
     action remove ^You have no significant injuries\.
     return
HEALTH_CHECK_ALL:
     var BLEEDING_HEAD NO
     var BLEEDING_NECK NO
     var BLEEDING_CHEST NO
     var BLEEDING_ABDOMEN NO
     var BLEEDING_BACK NO
     var BLEEDING_R_ARM NO
     var BLEEDING_L_ARM NO
     var BLEEDING_R_LEG NO
     var BLEEDING_L_LEG NO
     var BLEEDING_R_HAND NO
     var BLEEDING_L_HAND NO
     var BLEEDING_L_EYE NO
     var BLEEDING_R_EYE NO
     var BLEEDING_SKIN NO
     action var BLEEDING_HEAD YES when ^(?!.*\(tended\))\s*(head)\s{7}(.*)
     action var BLEEDING_NECK YES when ^(?!.*\(tended\))\s*(neck)\s{7}(.*)
     action var BLEEDING_CHEST YES when ^(?!.*\(tended\))\s*(chest)\s{7}(.*)
     action var BLEEDING_ABDOMEN YES when ^(?!.*\(tended\))\s*(abdomen)\s{7}(.*)
     action var BLEEDING_BACK YES when ^(?!.*\(tended\))\s*(back)\s{7}(.*)
     action var BLEEDING_R_ARM YES when ^(?!.*\(tended\))\s*r(?:ight|.) arm\s{7}(.*)
     action var BLEEDING_L_ARM YES when ^(?!.*\(tended\))\s*l(?:eft|.) arm\s{7}(.*)
     action var BLEEDING_R_LEG YES when ^(?!.*\(tended\))\s*r(?:ight|.) leg\s{7}(.*)
     action var BLEEDING_L_LEG YES when ^(?!.*\(tended\))\s*l(?:eft|.) leg\s{7}(.*)
     action var BLEEDING_R_HAND YES when ^(?!.*\(tended\))\s*r(?:ight|.) hand\s{7}(.*)
     action var BLEEDING_L_HAND YES when ^(?!.*\(tended\))\s*l(?:eft|.) hand\s{7}(.*)
     action var BLEEDING_L_EYE YES when ^(?!.*\(tended\))\s*l(?:eft|.) eye\s{7}(.*)
     action var BLEEDING_R_EYE YES when ^(?!.*\(tended\))\s*r(?:ight|.) eye\s{7}(.*)
     action var BLEEDING_SKIN YES when ^(?!.*\(tended\))\s*(skin)\s{7}(.*)
     action var BLEEDING_HEAD YES when (lodged\s*.*|mite|leech) (into|in|on) your head
     action var BLEEDING_NECK YES when (lodged\s*.*|mite|leech) (into|in|on) your neck
     action var BLEEDING_CHEST YES when (lodged\s*.*|mite|leech) (into|in|on) your chest
     action var BLEEDING_ABDOMEN YES when (lodged\s*.*|mite|leech) (into|in|on) your abdomen
     action var BLEEDING_BACK YES when (lodged\s*.*|mite|leech) (into|in|on) your back
     action var BLEEDING_R_ARM YES when (lodged\s*.*|mite|leech) (into|in|on) your right arm
     action var BLEEDING_L_ARM YES when (lodged\s*.*|mite|leech) (into|in|on) your left arm
     action var BLEEDING_R_LEG YES when (lodged\s*.*|mite|leech) (into|in|on) your right leg
     action var BLEEDING_L_LEG YES when (lodged\s*.*|mite|leech) (into|in|on) your left leg
     action var BLEEDING_R_HAND YES when (lodged\s*.*|mite|leech) (into|in|on) your right hand
     action var BLEEDING_L_HAND YES when (lodged\s*.*|mite|leech) (into|in|on) your left hand
     action var BLEEDING_L_EYE YES when (lodged\s*.*|mite|leech) (into|in|on) your left eye
     action var BLEEDING_R_EYE YES when (lodged\s*.*|mite|leech) (into|in|on) your right eye
     put #var needHealing 0
     pause 0.0001
     matchre HEALTH_BAD ^Bleeding|scar|abrasion|scratch|bruising|bruised|swelling|swollen|slashes|cuts
     matchre HEALTH_GOOD You have no significant injuries\.
     matchre HEALTH_CHECK_2 ^You have a dormant infection\.
     matchre HEALTH_BAD ^\s*Encumbrance\s+\:
     put -health;-0.05 encumbrance
     matchwait 20
     goto HEALTH_CHECK
#### RETURNS
RETURN:
     action (buffs) on
     return
RETURN_CLEAR:
     delay 0.00001
     put #queue clear
     action (buffs) on
     gosub CLEAR_MATCHTABLE
     return
CLEAR_MATCHTABLE:
     matchre CLEARED_MATCHTABLE .*
     put fatigue
     matchwait
CLEARED_MATCHTABLE:
     return
#### STRIP ARAAYS
STRIP_IT:
     var STRIPVAR $1
     var VARNAME $2
     eval %VARNAME replacere("%%VARNAME", "%%STRIPVAR", "")
     eval %VARNAME replacere("%%VARNAME", "\|+", "|")
     eval %VARNAME replacere("%%VARNAME", "^\||\|$", "")
     return
################################################################################################################################
### TRIGGERS UNLOAD
BUFF_TRIGGER_REMOVE:
     action remove eval ($SpellTimer.KhriAvoidance.active = 1)
     action remove eval ($SpellTimer.KhriCredence.active = 1)
     action remove eval ($SpellTimer.KhriCunning.active = 1)
     action remove eval ($SpellTimer.KhriDampen.active = 1)
     action remove eval ($SpellTimer.KhriDarken.active = 1)
     action remove eval ($SpellTimer.KhriElusion.active = 1)
     action remove eval ($SpellTimer.KhriEliminate.active = 1)
     action remove eval ($SpellTimer.KhriEndure.active = 1)
     action remove eval ($SpellTimer.KhriEvanescence.active = 1)
     action remove eval ($SpellTimer.KhriFlight.active = 1)
     action remove eval ($SpellTimer.KhriFocus.active = 1)
     action remove eval ($SpellTimer.KhriFright.active = 1)
     action remove eval ($SpellTimer.KhriGuile.active = 1)
     action remove eval ($SpellTimer.KhriHarrier.active = 1)
     action remove eval ($SpellTimer.KhriHasten.active = 1)
     action remove eval ($SpellTimer.KhriIntimidate.active = 1)
     action remove eval ($SpellTimer.KhriPlunder.active = 1)
     action remove eval ($SpellTimer.KhriProwess.active = 1)
     action remove eval ($SpellTimer.KhriSafe.active = 1)
     action remove eval ($SpellTimer.KhriSagacity.active = 1)
     action remove eval ($SpellTimer.KhriSensing.active = 1)
     action remove eval ($SpellTimer.KhriSerenity.active = 1)
     action remove eval ($SpellTimer.KhriShadowstep.active = 1)
     action remove eval ($SpellTimer.KhriSight.active = 1)
     action remove eval ($SpellTimer.KhriSilence.active = 1)
     action remove eval ($SpellTimer.KhriSlight.active = 1)
     action remove eval ($SpellTimer.KhriSteady.active = 1)
     action remove eval ($SpellTimer.KhriStrike.active = 1)
     action remove eval ($SpellTimer.KhriTerrify.active = 1)
     action remove eval ($SpellTimer.KhriAvoidance.active = 0)
     action remove eval ($SpellTimer.KhriCredence.active = 0)
     action remove eval ($SpellTimer.KhriCunning.active = 0)
     action remove eval ($SpellTimer.KhriDampen.active = 0)
     action remove eval ($SpellTimer.KhriDarken.active = 0)
     action remove eval ($SpellTimer.KhriElusion.active = 0)
     action remove eval ($SpellTimer.KhriEliminate.active = 0)
     action remove eval ($SpellTimer.KhriEndure.active = 0)
     action remove eval ($SpellTimer.KhriEvanescence.active = 0)
     action remove eval ($SpellTimer.KhriFlight.active = 0)
     action remove eval ($SpellTimer.KhriFocus.active = 0)
     action remove eval ($SpellTimer.KhriFright.active = 0)
     action remove eval ($SpellTimer.KhriGuile.active = 0)
     action remove eval ($SpellTimer.KhriHarrier.active = 0)
     action remove eval ($SpellTimer.KhriHasten.active = 0)
     action remove eval ($SpellTimer.KhriIntimidate.active = 0)
     action remove eval ($SpellTimer.KhriPlunder.active = 0)
     action remove eval ($SpellTimer.KhriProwess.active = 0)
     action remove eval ($SpellTimer.KhriSafe.active = 0)
     action remove eval ($SpellTimer.KhriSagacity.active = 0)
     action remove eval ($SpellTimer.KhriSensing.active = 0)
     action remove eval ($SpellTimer.KhriSerenity.active = 0)
     action remove eval ($SpellTimer.KhriShadowstep.active = 0)
     action remove eval ($SpellTimer.KhriSight.active = 0)
     action remove eval ($SpellTimer.KhriSilence.active = 0)
     action remove eval ($SpellTimer.KhriSlight.active = 0)
     action remove eval ($SpellTimer.KhriSteady.active = 0)
     action remove eval ($SpellTimer.KhriStrike.active = 0)
     action remove eval ($SpellTimer.KhriTerrify.active = 0)

	action remove ^Your hand twitches slightly in anticipation as you focus your mind towards relieving others of their hard earned possessions\.
	action remove ^You are under the influence of the Plunder meditation
	action remove to relieve others of their possessions wanes\.
	action remove ^Your recent use of the Plunder meditation is preoccupying|^You have not recovered from your previous use of the Plunder meditation\.
     action remove ^You are under the influence of the Hasten meditation|^Centering your mind\, you allow your practiced discipline to spread throughout your body\, making thought and motion one\.
     action remove ^Your concentration fails\, and you feel your body perceptibly slow\.
     action remove ^Your recent use of the Hasten meditation is preoccupying|^You have not recovered from your previous use of the Hasten meditation\.
     action remove ^With deep breaths\, you recall your training and focus your mind into the most universal of meditations\, improving your overall performance\.
     action remove ^You are under the influence of the Focus meditation|^With deep breaths\, you recall your training and focus your mind to hone in on improving your physical dexterity\.
     action remove ^You're already using the Focus meditation\.
     action remove ^Your focused mind falters\, and you feel downright clumsy by comparison\.
     action remove ^Your recent use of the Focus meditation is preoccupying|^You have not recovered from your previous use of the Focus meditation\.
     action remove The sensation of believing that your enemies will tremble at the mere thought of you translates from your every movement\.
     action remove ^You're already using the Prowess meditation\.
     action remove ^You feel your muscles relax as you settle into a less threatening demeanor\.
     action remove ^Your recent use of the Prowess meditation is preoccupying|^You have not recovered from your previous use of the Prowess meditation\.
     action remove ^You are under the influence of the Safe meditation|^With but a quick thought\, your hands steady and your mind gears itself to the purpose of getting into what others want you out of\.
     action remove ^Your hands no longer feel quite as steady as your grasp on the meditation fails\.
     action remove ^Your recent use of the Safe meditation|^You have not recovered from your previous use of the Safe meditation\.
     action remove ^You are under the influence of the Darken meditation|^Focusing your mind\, you look around yourself to find the subtle differences lurking in the shadows nearby
     action remove ^You are unable to maintain your focus on the shadows around you\, and your knowledge of better hiding places subsides\.
     action remove ^Your recent use of the Darken meditation|^You have not recovered from your previous use of the Darken meditation\.
     action remove ^Focusing your mind\, you attempt to attune your senses to the paths between shadows\. You quickly feel more comfortable with your ability to navigate terrain unseen\.
     action remove ^You are under the influence of the Dampen meditation|^Focusing your mind\, you attempt to attune your senses to even your most minor movements\.  You quickly feel more comfortable with your ability to control your motions to prevent detection\.
     action remove ^You are unable to maintain your focus on every movement\, and your knowledge of better ways to stay unnoticed in armor subsides\.
     action remove ^Your recent use of the Dampen meditation is preoccupying|^You have not recovered from your previous use of the Dampen meditation\.
     action remove ^Darkness is no bar to a trained Thief\. With careful focus\, you adjust your eyes to see in shadow as they do in light\.
     action remove ^You're already using the Sight meditation\.
     action remove ^Light and shadow are once again thrown into stark contrast as your heightened vision fades\.
     action remove ^You have not recovered from your previous use of the Sight meditation\.
     action remove ^Placing all of your worries and concerns aside\, you mentally wall them off where they no longer bother you\. Soon\, your inward calm seems unshakeable\.
     action remove ^You're already using the Calm meditation\.
     action remove ^You attempt to relax your mind from all of its meditative states\.
     action remove ^Your recent use of the Calm meditation|^You have not recovered from your previous use of the Calm meditation\.
     action remove ^Willing your body to meet the heightened functionality of your mind\, you feel your motions steady considerably\.
     action remove ^With but a moment's focus\, every worry or care becomes trivial\, and you surround yourself with unshakable serenity\.
     action remove ^You're already using the Steady meditation\.
     action remove ^The steadying influence your mind was exerting on your self fades away as you lose concentration upon it\.
     action remove ^Your recent use of the Steady meditation|^You have not recovered from your previous use of the Steady meditation\.
     action remove ^With but a moment's focus\, every worry or care becomes trivial\, and you surround yourself with unshakable serenity\.
     action remove ^You're already using the Serenity meditation\.|^You are under the influence of the Serenity meditation\.
     action remove ^Your unshakable calm dissipates\, leaving the world around you suddenly seeming more chaotic\.
     action remove ^Your recent use of the Serenity meditation|^You have not recovered from your previous use of the Serenity meditation\.
     action remove ^Knowing that a dose of paranoia is healthy
     action remove ^You're already using the Flight meditation\.|^You are under the influence of the Flight meditation\.
     action remove ^You feel mentally fatigued as your heightened paranoia ceases to enhance your knowledge of nearby escape routes\.
     action remove ^Your recent use of the Flight meditation|^You have not recovered from your previous use of the Flight meditation\.
     action remove ^You carefully relax your mind through your expert training
     action remove ^You're already using the Sagacity meditation|^You are under the influence of the Sagacity meditation\.
     action remove ^Your strong sense of survival fades
     action remove ^Your recent use of the Sagacity meditation|^You have not recovered from your previous use of the Sagacity meditation\.
     action remove The sensation of such fluid movement even startles you for a few moments\, as you get accustomed to the mezmerizing rhythm\.
     action remove ^You're already using the Guile meditation\.|^You are under the influence of the Guile meditation\.
     action remove ^Your strong sense of survival fades
     action remove ^Your recent use of the Guile meditation|^You have not recovered from your previous use of the Guile meditation\.
     action remove ^Honing your mind and body to a single purpose\, you prepare to execute the perfect strike\.
     action remove ^You're already using the Eliminate meditation\.|^You are under influence of the Elimination meditation\.
     action remove ^You feel your inner fire cool as you finish practicing the Form of the Eagle\.
     action remove ^Your recent use of the ELIMINATE meditation|^You have not recovered from your previous use of the ELIMINATE meditation\.
     action remove ^You calm your body and mind\, recalling your training on how to seek the vital part of any opponent\. Wrapping yourself in this cool composure\, your eyes quickly become drawn to exposed weaknesses around you\.
     action remove ^You're already using the Strike meditation\.|^You are under the influence of the Strike meditation\.
     action remove ^Your cool composure fades, and with it your heightened
     action remove ^Your recent use of the Strike meditation|^You have not recovered from your previous use of the Strike meditation\.
     action remove ^Tapping into the well of mental power within\, you focus on a world without your presence in it\. Through determined concentration\, you achieve a limited subversion of reality\, becoming unseen and removed from danger\.
     action remove ^Tapping into the well of mental power within\, you focus on a world without your presence in it\. Through determined concentration\, you achieve a limited subversion of reality\, becoming unseen and removed from danger\.
     action remove ^Tapping into the well of mental power within\, you focus on a world without your presence in it\. Through determined concentration\, you achieve a limited subversion of reality\, becoming unseen and removed from danger\.
     action remove ^Taking a deep breath\, you focus on making your mind and body one\, your mental discipline trained on quickly noticing\, analyzing\, and evading approaching threats\.
     action remove ^You're already using the Avoidance meditation|^You are under the influence of the Avoidance meditation\.
     action remove ^Your concentration runs out, and your rapid analysis|^Your recent use of the Avoidance meditation|^You have not recovered from your previous use of the Avoidance meditation\.
     action remove ^Purging yourself of all distractions and extraneous thoughts\, you allow your mind and body to become one\, becoming preternaturally aware of threats around you and the best ways to defend yourself\.
     action remove ^You're already using the Elusion meditation\.$|^You are under the influence of the Elusion meditation\.
     action remove ^You are no longer able to keep your thoughts free from distraction|^Your recent use of the Elusion meditation|^You have not recovered from your previous use of the Elusion meditation\.
     action remove you reopen them, you feel much more intimidating
     action remove ^You're already using the Intimidate meditation\.|^You are under the influence of the Intimidate meditation\.
     action remove ^Something distracts your inner focus and you are no longer as dominant as you were|^Your recent use of the Intimidate meditation|^You have not recovered from your previous use of the Intimidate meditation\.
     action remove ^Deep within yourself you call forth a calming presence that radiates out from you to your surroundings
     action remove ^You're already using the Credence meditation\.|^You are under the influence of the Credence meditation\.
     action remove ^Something disturbs your inner peace and you stop radiating calm|^Your recent use of the Credence meditation|^You have not recovered from your previous use of the Credence meditation\.
     action remove ^After a deep breath, your meditation bears fruit and you feel much more frightening
     action remove ^You are under the influence of the Fright meditation\.|^You're already using the Fright meditation\.
     action remove ^Something shakes your concentration and you lose your enhanced frightfulness|^Your recent use of the Fright meditation|^You have not recovered from your previous use of the Fright meditation\.
     action remove ^Drawing upon your inner strength, you set yourself to endure and slow your heartbeat
     action remove ^You're already using the Endure meditation\.|^You are under the influence of the Endure meditation\.
     action remove ^Your additional endurance fades away as your inner focus slips|^Your recent use of the Endure meditation|^You have not recovered from your previous use of the Endure meditation\.
     action remove ^Preparing your voice, you concentrate on projecting horrifying whispers at a foe
     action remove ^You're already using the Terrify|^You are under the influence of the Terrify meditation
     action remove ^Your focus slips and you feel less horrifying|^Your recent use of the Terrify meditation|^You have not recovered from your previous use of the Terrify meditation\.
     action remove ^With mental effort, you center your mind on improving your physical prowess
     action remove ^You're already using the Harrier meditation|^You are under influence of the Harrier meditation\.
     action remove ^Your focus fails, and you immediately feel less strong|^Your recent use of the Harrier meditation|^You have not recovered from your previous use of the Harrier meditation\.
     action remove ^Your dedicated training lends you grace in both mind and body, allowing you to easily escape binding situations\.|^You're already using the Liberation meditation\.|^You have not recovered from your previous use of the Liberation meditation\.
     action remove ^Your preternatural ability to escape binding situations ceases|^Your recent use of the Liberation meditation|^You have not recovered from your previous use of the Liberation meditation\.
     action remove struck|^You're already using the Evanescence meditation\.|^You are under the influence of the Evanescence meditation\.
     action remove ^Your focus fails and you suddenly feel a bit more solid|^Your recent use of the Evanescence meditation|^You have not recovered from your previous use of the Evanescence meditation\.
     action remove ^Letting your thoughts fall into the depths
     action remove ^You're already using the Shadowstep meditation|^You are under the influence of the Shadowstep meditation
     action remove ^You can no longer move so quickly through shadows|^Your recent use of the Shadowstep meditation|^You have not recovered from your previous use of the Shadowstep meditation\.
     action remove ^Your dedicated training lends you grace in both mind and body\, allowing you to easily escape binding situations\.
     action remove ^You are under the influence of the Cunning meditation
     action remove ^Your preternatural ability to escape binding situations ceases\.
     return

#############################################################################################
### MASTERY CALCULATOR
MASTERY_SET:
     pause 0.0001
     var CheckSkill $1
     var WeaponVar $2
     var Mastery Melee
     if matchre("(Small_Edged|Large_Edged|Twohanded_Edged|Small_Blunt|Large_Blunt|Twohanded_Blunt|Staves|Polearms|Brawling|Offhand_Weapon|Backstab)", "%CheckSkill") then var Mastery Melee
     if matchre("(Light_Thrown|Heavy_Thrown|Slings|Bows|Crossbow)", "%CheckSkill") then var Mastery Missile
     pause 0.0001
     if ($%CheckSkill.Ranks > $%Mastery_Mastery.Ranks) then var %WeaponVar $%CheckSkill.Ranks
     if ($%CheckSkill.Ranks <= $%Mastery_Mastery.Ranks) then evalmath %WeaponVar ($%CheckSkill.Ranks * .75) + ($%Mastery_Mastery.Ranks * .25)
     if (%WeaponVar > $%Mastery_Mastery.Ranks) then var %WeaponVar $%Mastery_Mastery.Ranks
     echo *** %CheckSkill Ranks ($%CheckSkill.Ranks) + Mastery ($%Mastery_Mastery.Ranks) = %%WeaponVar effective ranks
     return
################################################################################################################################
#### UBER TRAVEL SECTION - FINDS INITIAL COMBAT ROOM FROM ANY LOCATION
################################################################################################################################
NECRO_HEAL_RUN:
FIND_CRITTER_NECROHEAL:
     action (stunned) off
     action (inventory) off
     action (combat) off
     action (escape) off
     var CURRENT Finding Necro Heal Critter
     var NecroHealing 1
     var Backtraining 0
     #### RE-SETUP WEAPON VARS HERE TO MAIN WEAPONS
     var WeaponSet 1
     gosub WEAPON_SETUP
     var WeaponSet 0
     ###############################################
     gosub STATUSBAR
     gosub ARMOR_INIT
     if matchre("%NecroHeal.Critter", "(?i)(NULL|OFF|^%|^\s*$)") then goto HEALING
     put #var UC_Combat.Time $gametime
     put #var UC_combatCritter %NecroHeal.Critter
     put #var UC_priorityRooms NULL
     pause 0.2
     echo
     echo ##################################
     echo ***  SEARCHING FOR YOUR NECRO HEAL CRITTER LOCATION!
     echo ***  TARGET LOCATION: $UC_combatCritter
     echo ##################################
     echo *** TURNING OFF COMBAT / HEALTH TRIGGERS
     echo *** ONLY LOGGING OUT UNDER 20% HEALTH
     echo ##################################
     echo
     put #echo >Log DeepSkyBlue *** Auto-Moving to NECRO HEALING Critter: $UC_combatCritter
     pause 0.5
     goto FIND_CRITTER_GO
FIND_CRITTER_BACKTRAIN:
     action (inventory) off
     var CURRENT Finding Backtrain Critter
     gosub STATUSBAR
     # if !matchre("%FIND.CRITTER", "(?i)(ON|1|YES)") then goto TrainLoop
     if matchre("%BACKTRAIN.CRITTER", "(?i)(NULL|OFF|^%|^\s*$)") then goto FIND_CRITTER
     put #var UC_priorityRooms %BACKTRAIN.PRIORITY.ROOMS
     put #var UC_Combat.Time $gametime
     put #var UC_backtrainCritter %BACKTRAIN.CRITTER
     put #var UC_combatCritter %BACKTRAIN.CRITTER
     pause 0.2
     #### CHECKS FOR AND RESTOCKS TORCH/FLINT IF HUNTING IN A DARK ZONE
     if !matchre("$guild", "(Moon Mage|Thief|Ranger|Cleric|Barbarian)") then
          {
               if ((%HaveStarglass = 1) || (%HaveGaethzen = 1) || (%HaveGoggles = 1) || (%HaveLantern = 1)) then goto FIND_CRITTER_BACKTRAIN_2
               if ((matchre("$UC_combatCritter", "\b(?i)(moth)\b") && ($zoneid < 50)) then
                    {
                         if ((%HaveTorch = 0) && (%HaveFlint = 0)) then
                              {
                                   if ((%HaveTorch = 0) && (%HaveLighter = 0)) then gosub TORCH_RESTOCK
                              }
                    }
               if (matchre("$UC_combatCritter", "\b(?i)(Crypt Fiend|Ghoul Raven|Snaer|Hafwa|Resuscitants?)\b") then
                    {
                         if ((%HaveTorch = 0) && (%HaveFlint = 0)) then
                              {
                                   if ((%HaveTorch = 0) && (%HaveLighter = 0)) then gosub TORCH_RESTOCK
                              }
                    }
          }
FIND_CRITTER_BACKTRAIN_2:
     if matchre("$guild", "%MAGICUSER") then gosub RELEASE cyclic
     echo
     echo ######################################
     echo ######################################
     echo ***  SEARCHING FOR YOUR BACKTRAIN CRITTER LOCATION!
     echo ***  TARGET LOCATION: $UC_backtrainCritter
     echo ######################################
     echo ######################################
     echo
     put #echo >Log DeepSkyBlue *** Auto-Moving to BACKTRAIN Critter: $UC_backtrainCritter
     pause 0.5
     var Backtraining 1
     goto FIND_CRITTER_GO

ALTERNATE_CRITTER:
FIND_CRITTER_ALTERNATE:
     if matchre("$guild", "%MAGICUSER") then gosub RELEASE cyclic
     echo
     echo #################################
     echo ***  SEARCHING FOR YOUR ALTERNATE CRITTER LOCATION!
     echo ***  TARGET LOCATION: $UC_alternateCritter
     echo #################################
     echo
     put #echo >Log DeepSkyBlue *** Auto-Moving to ALTERNATE Critter: $UC_alternateCritter
     pause 0.5
     var Backtraining 0
     var PRIORITY.ROOMS NULL
     put #var UC_combatCritter %ALTERNATE.CRITTER
     put #var UC_priorityRooms NULL
     put #var UC_Combat.Time $gametime
     goto FIND_CRITTER_GO
FIND_CRITTER:
     pause 0.1
     action (inventory) off
     var CURRENT Finding Combat Critter
     var Backtraining 0
     gosub STATUSBAR
     gosub stowing
     put #var UC_priorityRooms %PRIORITY.ROOMS
     put #var UC_Combat.Time $gametime
     put #var UC_combatCritter %COMBAT.CRITTER
     pause 0.2
     #### CHECKS FOR AND RESTOCKS TORCH/FLINT IF HUNTING IN A DARK ZONE
     if !matchre("$guild", "(Moon Mage|Thief|Ranger|Cleric|Barbarian)") then
          {
               if ((%HaveStarglass = 1) || (%HaveGaethzen = 1) || (%HaveGoggles = 1) || (%HaveLantern = 1)) then goto FIND_CRITTER_2
               if ((matchre("$UC_combatCritter", "\b(?i)(moth)\b") && ($zoneid < 50)) then
                    {
                         if ((%HaveTorch = 0) && (%HaveFlint = 0)) then
                              {
                                   if ((%HaveTorch = 0) && (%HaveLighter = 0)) then gosub TORCH_RESTOCK
                              }
                    }
               if (matchre("$UC_combatCritter", "\b(?i)(Crypt Fiend|Ghoul Raven|Snaer|Hafwa|Resuscitants?)\b") then
                    {
                         if ((%HaveTorch = 0) && (%HaveFlint = 0)) then
                              {
                                   if ((%HaveTorch = 0) && (%HaveLighter = 0)) then gosub TORCH_RESTOCK
                              }
                    }
          }
FIND_CRITTER_2:
     if ("$roomid" = "0") then gosub RANDOMMOVE
     if matchre("$guild", "%MAGICUSER") then gosub RELEASE cyclic
     # if !matchre("%FIND.CRITTER", "(?i)(ON|1|YES)") then goto TrainLoop
     if ("%COMBAT.CRITTER" = "NULL") then goto TrainLoop
     # if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     echo
     echo ######################################
     echo ######################################
     echo ***  SEARCHING FOR YOUR COMBAT CRITTER LOCATION!
     echo ***  TARGET LOCATION: $UC_combatCritter
     echo ######################################
     echo ######################################
     echo
     put #echo >Log #00FF80 *** Auto-Moving to MAIN COMBAT Critter: $UC_combatCritter
     pause 0.5
FIND_CRITTER_GO:
     var NecroMoved 0
     #### SPECIAL ESCAPE LOGIC FOR MAZES/HARD TO ESCAPE AREAS
     if (matchre("$roomname", "(Maelshyve's Fortress, Hall of Malice|Glutton's Rest|Fallen Altar|Great Dais|Inner Sanctum)") && !matchre("$UC_combatCritter", "(?i)(HEIROPHANT|HIEROPHANT)")) then gosub MAELSHYVE_FORTRESS_ESCAPE
     if (matchre("$roomname", "(Charred Caverns|Beneath the Zaulfung|Maelshyve's Threshold)") && !matchre("$UC_combatCritter", "(?i)(CINDER BEAST|SHADOW BEAST|HIEROPHANT|HEIROPHANT)")) then gosub BENEATH_ZAULFUNG_ESCAPE
     if (matchre("$roomname", "(Zaulfung, Dense Swamp|Kweld Gelvdael|Zaulfung, Urrem'tier's Spire)") && !matchre("$UC_combatCritter", "(?i)(GREATER SLUAGH|SHADOW HOUND)")) then gosub ZAULFUNG_ESCAPE_0
     if (matchre("$roomname", "Zaulfung, Swamp") && matchre("$roomdesc", "Rancid mire") && !matchre("$UC_combatCritter", "(?i)(GREATER SLUAGH|SHADOW HOUND)")) then gosub ZAULFUNG_ESCAPE
     if (matchre("$roomname", "Zaulfung, Trackless Swamp") && !matchre("$UC_combatCritter", "(?i)SWAMP TROLL")) then gosub ZAULFUNG_ESCAPE_2
     if (matchre("$roomname", "Velaka Desert") && !matchre("$UC_combatCritter", "(?i)(ZOMBIE NOMAD|SLAVER)")) then gosub VELAKA_ESCAPE
     if (matchre("$roomname", "Undershard") && !matchre("$UC_combatCritter", "(?i)(THUG|CUTTRHOAT|RUFFIAN|FAENRAE STALKER)"))  then gosub WARRENS_ESCAPE
     if (matchre("$roomname", "The Marsh\, In The Water") && !matchre("$UC_combatCritter", "(?i)CROCODILE")) then gosub CROC_ESCAPE
     if (matchre("$roomname", "Maelshyve's Ascent") && && !matchre("$UC_combatCritter", "(?i)(BLOOD WRAITH|BONE GOLEM)")) then gosub MAELSHYVE_ASCENT_ESCAPE
     if (matchre("$roomname", "(Abyssal Descent|Abyssal Seed)") && !matchre("$UC_combatCritter", "(?i)(SHYLVIC|MASTIFF|GREY LACH)")) then gosub ABYSSAL_ESCAPE
     if (matchre("$roomname", "Deadman's Confide, Beach") && !matchre("$UC_combatCritter", "(?i)(DARK SPIRIT|DEATH SPIRIT|SKELETAL SAILOR|SKELETAL PIRATE)")) then gosub DEADMAN_ESCAPE
     if (matchre("$roomname", "Adder\'s Nest") && !matchre("$UC_combatCritter", "(?i)ICE ADDER")) then gosub ADDERNEST_ESCAPE
     if (matchre("$roomname", "Temple of the North Wind\, Catacombs") && !matchre("$UC_combatCritter", "(?i)(ICY BLUE GHAST)")) then gosub NORTHWIND_ESCAPE
     if (matchre("$roomname", "Temple of the North Wind\, High Priestess\' Sanctum") && !matchre("$UC_combatCritter", "(?i)MARBLE GARGOYLE")) then gosub ASKETI_ESCAPE
     if (matchre("$roomname", "Temple of the North Wind\, Dark Sanctuary") && !matchre("$UC_combatCritter", "(?i)MARBLE GARGOYLE")) then gosub ASKETI_ESCAPE
     if (matchre("$roomname", "Temple of the North Wind\, Last Sacrifice") && !matchre("$UC_combatCritter", "(?i)MARBLE GARGOYLE")) then gosub ASKETI_ESCAPE
     if (matchre("$roomname", "Asketi\'s Mount") && !matchre("$UC_combatCritter", "(?i)MARBLE GARGOYLE")) then gosub ASKETI_ESCAPE
     if (matchre("$roomname", "The Fangs of Ushnish") && !matchre("$UC_combatCritter", "(?i)ATIKET")) then gosub USHNISH_ESCAPE
     if (matchre("$roomname", "Temple of Ushnish") && !matchre("$UC_combatCritter", "(?i)(ATIKET|WESTANURYN)")) then gosub USHNISH_ESCAPE_2
     if (matchre("$roomname", "Beyond the Gate of Souls") && !matchre("$UC_combatCritter", "(?i)(ATIKET|WESTANURYN)")) then gosub USHNISH_ESCAPE_3
	if (matchre("$roomname", "Kads Vawterjra Klajur") && !matchre("$UC_combatCritter", "(?i)(BROCKET DEER)")) then gosub BROCKET_ESCAPE
     if (matchre("$roomname", "Ehhrsk Highway")  && !matchre("$UC_combatCritter", "(?i)KRAHEI")) then gosub EHHRSK_ESCAPE
     #### 0 - 100
     #### 0 - 100
     if matchre("$UC_combatCritter", "(?i)FROG") then goto FROG_GO
     if matchre("$UC_combatCritter", "(?i)(RAT 1|RAT1|RATS? CROSS|XING RAT|CROSSING RATS?|RATS? XING)") then goto RAT_GO
     if matchre("$UC_combatCritter", "(?i)(RAT2|RAT 2|RATS? SHARD|SHARD RATS?|RAT ILITHI)") then goto RATSHARD_GO
     if matchre("$UC_combatCritter", "(?i)(FC RAT|RAT FC|FANG RAT|FANG COVE RATS?|RATS FC|FCRATS|RATS? FANG COVE)") then goto FC_RAT_GO
     if matchre("$UC_combatCritter", "(?i)(LOUTS?$|LOUTS1|LOUT1|LOUT 1|LOUT CROSS|LOUTS? XING|XING LOUTS?|CROSSING LOUTS?)") then goto LOUT_GO
     if matchre("$UC_combatCritter", "(?i)(LOUT2|LOUT 2|LOUTS 2|LOUTS2|SHARD LOUTS?|LOUTS? SHARD)") then goto LOUTSHARD_GO
     # if matchre("$UC_combatCritter", "(?i)MOUSE") then goto MOUSE_GO
     if matchre("$UC_combatCritter", "(?i)ZOMBIE GOBLIN$") then goto ZOMBIEGOBLIN_GO
     if matchre("$UC_combatCritter", "(?i)(ANIMATED$|ANIMATED OBJECT|ANIMATED ITEM)") then goto ANIMATED_GO
     if matchre("$UC_combatCritter", "(?i)BLACK RAT") then goto BLACKRAT_GO
	if matchre("$UC_combatCritter", "(?i)(ZOMBIE GOBLIN 2|ZOMBIE GOBLIN2|ZOMBIE GOBLIN RIVER|ZOMBIE GOBLIN HAVEN)") then goto ZOMBIEGOBLIN_GO
     if matchre("$UC_combatCritter", "(?i)(SILVERFISH2|SILVERFISH 2|SILVERFISH T2|HARDENED SILVERFISH|SILVERFISHT2)") then goto SILVERFISH2_GO
     if matchre("$UC_combatCritter", "(?i)(SILVERFISH3|SILVERFISH 3|SILVERFISH T3|ELDER SILVERFISH|SILVERFISHT3)") then goto SILVERFISH3_GO
     if matchre("$UC_combatCritter", "(?i)SILVERFISH") then goto SILVERFISH_GO
     if matchre("$UC_combatCritter", "(?i)MUSK HOG") then goto MUSKHOG_GO
     if matchre("$UC_combatCritter", "(?i)SQUIRREL") then goto SQUIRREL_GO
     if matchre("$UC_combatCritter", "(?i)FELL HOG") then goto FELLHOG_GO
     if matchre("$UC_combatCritter", "(?i)SKELETON") then goto SKELETON_GO
     if matchre("$UC_combatCritter", "(?i)FORAGER GOBLIN") then goto FORAGERGOBLIN_GO
     if matchre("$UC_combatCritter", "(?i)CRAYFISH") then goto CRAYFISH_GO
     if matchre("$UC_combatCritter", "(?i)GIDI") then goto GIDI_GO
     if matchre("$UC_combatCritter", "(?i)MADMAN") then goto MADMEN_GO
     if matchre("$UC_combatCritter", "(?i)GOBLIN ZOMBIE") then goto GOBLINZOMBIE_GO
     if matchre("$UC_combatCritter", "(?i)TORTURED SOUL") then goto TORTUREDSOUL_GO
     if matchre("$UC_combatCritter", "(?i)FIELD GOBLIN") then goto FIELDGOBLIN_GO
     if matchre("$UC_combatCritter", "(?i)WILDLAND GOBLIN") then goto WILDLANDGOBLIN_GO
     if matchre("$UC_combatCritter", "(?i)SCAVENGER GOBLIN") then goto SCAVENGERGOBLIN_GO
     if matchre("$UC_combatCritter", "(?i)BURROWER") then goto BROWNBURROWER_GO
     if matchre("$UC_combatCritter", "(?i)SKUNK") then goto SKUNK_GO
     if matchre("$UC_combatCritter", "(?i)WILD BOAR") then goto WILDBOAR_GO
     if matchre("$UC_combatCritter", "(?i)BADGER") then goto BADGER_GO
     if matchre("$UC_combatCritter", "(?i)ANTELOPE") then goto ANTELOPE_GO
     if matchre("$UC_combatCritter", "(?i)INKHORNE") then goto INKHORNE_GO
     if matchre("$UC_combatCritter", "(?i)(GOBLIN SHAMAN$|GOBLIN SHAMAN 1|GOBLIN SHAMAN T1)") then goto GOBLINSHAMAN_GO
     if matchre("$UC_combatCritter", "(?i)(GOBLIN SHAMAN 2|GOBLIN SHAMAN2|GOBLIN SHAMAN RIVER)") then goto GOBLINSHAMAN2_GO
     if matchre("$UC_combatCritter", "(?i)ORIGAMI") then goto ORIGAMI_GO
     if matchre("$UC_combatCritter", "(?i)CROFF POTHANIT") then goto CROFFPOTHANIT_GO
     if matchre("$UC_combatCritter", "(?i)BLOOD DRYAD") then goto BLOODDRYAD_GO
     if matchre("$UC_combatCritter", "(?i)BLOOD NYAD") then goto BLOODNYAD_GO
     if matchre("$UC_combatCritter", "(?i)SALT CRAB") then goto SALTCRAB_GO
     if matchre("$UC_combatCritter", "(?i)CORPSE GRUB") then goto CORPSEGRUB_GO
     if matchre("$UC_combatCritter", "(?i)^DEER") then goto DEER_GO
     if matchre("$UC_combatCritter", "(?i)(GRASS EEL$|GRASS EEL 1|GRASS EEL1|GRASS EEL T1|GRASS EEL CROSS|GRASS EEL$)") then goto GRASSEEL_GO
     if matchre("$UC_combatCritter", "(?i)(GRASS EEL 2|GRASS EEL2|GRASS EEL RIVER)") then goto GRASSEEL2_GO
     if matchre("$UC_combatCritter", "(?i)(GRASS EEL 3|GRASS EEL3|GRASS EEL SHARD)") then goto GRASSEEL3_GO
     if matchre("$UC_combatCritter", "(?i)GHOUL 1|GHOUL T1|GHOUL CROSS") then goto GHOUL_GO
     if matchre("$UC_combatCritter", "(?i)GREATER WATER SPRITE") then goto WATERSPRITEPREM_GO
     if matchre("$UC_combatCritter", "\b(?i)WATER SPRITE$") then goto WATERSPRITE_GO
     if matchre("$UC_combatCritter", "(?i)COUGAR") then goto COUGAR_GO
     if matchre("$UC_combatCritter", "(?i)LIPOPOD") then goto LIPOPOD_GO
     if matchre("$UC_combatCritter", "(?i)TROLLKIN") then goto TROLLKIN_GO
     if matchre("$UC_combatCritter", "(?i)GIANT WASP") then goto GIANTWASP_GO
     if matchre("$UC_combatCritter", "(?i)KELPIE") then goto KELPIE_GO
     if matchre("$UC_combatCritter", "(?i)(GRENDEL|GRENDAL)") then goto GRENDAL_GO
     if matchre("$UC_combatCritter", "(?i)REAVER") then goto REAVER_GO
     if matchre("$UC_combatCritter", "(?i)WIND HOUND") then goto WINDHOUND_GO
     if matchre("$UC_combatCritter", "(?i)(^KOBOLDS?$|^KOBOLD$)") then goto KOBOLD_GO
     if matchre("$UC_combatCritter", "(?i)(SLAI SCOUT|S\'LAI)") then goto SLAISCOUT_GO
     if matchre("$UC_combatCritter", "(?i)JACKAL") then goto JACKAL_GO
     if matchre("$UC_combatCritter", "(?i)LARGE BROWN SPIDER") then goto LARGEBROWNSPIDER_GO
     if matchre("$UC_combatCritter", "(?i)(WOOD TROLL$|WOOD TROLL 1|WOOD TROLL T1|WOOD TROLL CROSS)") then goto WOODTROLL_GO
     if matchre("$UC_combatCritter", "(?i)BOGGLE") then goto BOGGLE_GO
     if matchre("$UC_combatCritter", "(?i)REVENANT CONSCRIPT") then goto CONSCRIPT_GO
     if matchre("$UC_combatCritter", "(?i)BLACK BEAR") then goto BLACKBEAR_GO
     # if matchre("$UC_combatCritter", "(?i)BROWN BEAR") then goto BROWNBEAR_GO
     if matchre("$UC_combatCritter", "(?i)REVENANT ZOMBIE") then goto REVENANTZOMBIE_GO
     if matchre("$UC_combatCritter", "(?i)(^BOBCAT$|BOBCAT1|BOBCAT 1|BOBCAT T1|REGULAR BOBCAT|CROSSING BOBCAT|CROSS BOBCAT|XING BOBCAT)") then goto BOBCAT_GO
     if matchre("$UC_combatCritter", "(?i)CAVE BEAR") then goto CAVEBEAR_GO
     if matchre("$UC_combatCritter", "(?i)MEADOW RAM") then goto MEADOWRAM_GO
     if matchre("$UC_combatCritter", "(?i)THUNDER RAM") then goto THUNDERRAM_GO
     if matchre("$UC_combatCritter", "(?i)BEISSWURM") then goto BEISSWURM_GO
     if matchre("$UC_combatCritter", "(?i)BUCCA") then goto BUCCA_GO
     if matchre("$UC_combatCritter", "(?i)SAND SPRITE") then goto SANDSPRITE_GO
     if matchre("$UC_combatCritter", "(?i)BOOBRIE") then goto BOOBRIE_GO
     if matchre("$UC_combatCritter", "(?i)ARBELOG") then goto ARBELOG_GO
     if matchre("$UC_combatCritter", "(?i)BIRDCATCHER") then goto BIRDCATCHER_GO
     if matchre("$UC_combatCritter", "(?i)TREE SNAKE") then goto TREESNAKE_GO
     if matchre("$UC_combatCritter", "(?i)(STORM (GOOSE|GEESE|GANDER))") then goto STORMGOOSE_GO
     ### CAVE FISH NOT SUPPORTED
     # if matchre("$UC_combatCritter", "(?i)CAVE FISH") then goto CAVEFISH_GO
     ### VYKATHI NOT SUPPORTED BECAUSE THEY ARE INSIDE THE HIVE - TOO DIFFICULT TO NAVIGATE
     # if matchre("$UC_combatCritter", "(?i)VYKATHI BUILDER") then goto VYKATHI_GO
     # if matchre("$UC_combatCritter", "(?i)VYKATHI EXCAVATOR") then goto VYKATHI_GO
     if matchre("$UC_combatCritter", "(?i)(COPPER VIPER|COPPERHEAD VIPER)") then goto COPPERVIPER_GO
     if matchre("$UC_combatCritter", "(?i)(STONE-THROWING IMP|STONE THROWING IMP)") then goto IMP_GO
     if matchre("$UC_combatCritter", "(?i)(BONE WOLF|BONE WOLVES)") then goto BONEWOLF_GO
     if matchre("$UC_combatCritter", "(?i)SAND CRAB") then goto SANDCRAB_GO
     # if matchre("$UC_combatCritter", "(?i)DRAGON PRIEST FANATIC") then goto FANATIC_GO
     if matchre("$UC_combatCritter", "(?i)(GIANT BEARS?|GBEAR)") then goto GIANTBEAR_GO
     if matchre("$UC_combatCritter", "(?i)(ROCK TROLL$|ROCK TROLL 1|ROCK TROLL T1|ROCKIE 1|ROCK TROLLS 1|ROCK TROLL CROSS)") then goto ROCKTROLL_GO
     if matchre("$UC_combatCritter", "(?i)(ROCK TROLL SHARD|ROCKIE SHARD)") then goto ROCKTROLLSHARD_GO
     if matchre("$UC_combatCritter", "(?i)(BLOOD WOLF$|BLOOD WOLF 1|BLOOD WOLVES 1|BLOOD WOLF1|BLOOD WOLF T1|BLOOD WOLF CROSS)") then goto BLOODWOLF_GO
     if matchre("$UC_combatCritter", "(?i)DUSK OGRE") then goto DUSKOGRE_GO
     if matchre("$UC_combatCritter", "(?i)FIRE SPRITE") then goto FIRESPRITE_GO
     if matchre("$UC_combatCritter", "(?i)(SPOTTED BOBCAT|BOBCAT 2|BOBCAT2|BOBCAT T2|FC BOBCAT|BOBCAT FC)") then goto SPOTTEDBOBCAT_GO
     if matchre("$UC_combatCritter", "(?i)DARK FIEND") then goto DARKFIEND_GO
     if matchre("$UC_combatCritter", "(?i)ENDRUS SERPENT") then goto ENDRUSSERPENT_GO
     if matchre("$UC_combatCritter", "(?i)SUW BIZAR") then goto SUWBIZAR_GO
     if matchre("$UC_combatCritter", "(?i)GIANT WOLF SPIDER") then goto WOLFSPIDER_GO
     if matchre("$UC_combatCritter", "(?i)SUN VULTURE") then goto SUNVULTURE_GO
     if matchre("$UC_combatCritter", "(?i)(LESSER SLAUGH$|LESSER SLAUGH 1|LESSER SLUAGH 1|SLUAGH T1|SLUAGH1)") then goto LESSERSLUAGH_GO
     if matchre("$UC_combatCritter", "(?i)(MORAH VINE|MORAH CREEPER)") then goto MORAHVINE_GO
     if matchre("$UC_combatCritter", "(?i)(BLOOD WOLF2|BLOOD WOLF 2|BLOOD WOLF T2|BLOOD WOLVES 2|BLOOD WOLVES T2)") then goto BLOODWOLF2_GO
     if matchre("$UC_combatCritter", "(?i)SNOWBEAST") then goto SNOWBEAST_GO
     if matchre("$UC_combatCritter", "(?i)RIVER CAIMAN") then goto RIVERCAIMAN_GO
     if matchre("$UC_combatCritter", "(?i)FIRE MAIDEN") then goto FIREMAIDEN_GO
     if matchre("$UC_combatCritter", "(?i)SAND SPIDER") then goto SANDSPIDER_GO
     if matchre("$UC_combatCritter", "(?i)RAZORTUSK SOW") then goto RAZORTUSKSOW_GO
     if matchre("$UC_combatCritter", "(?i)BISON") then goto BISON_GO
     if matchre("$UC_combatCritter", "(?i)(ROCK TROLL2|ROCK TROLL 2|ROCK TROLL T2|ROCKIE2|ROCKIE 2)") then goto ROCKTROLL2_GO
     if matchre("$UC_combatCritter", "(?i)YOUNG OGRE$") then goto YOUNGOGRE_GO
     if matchre("$UC_combatCritter", "(?i)(YOUNG OGRE 2|YOUNG OGRE2|YOUNG OGRE RIVER)") then goto YOUNGOGRE2_GO
     if matchre("$UC_combatCritter", "(?i)(MAIDENS TRESS|MAIDEN TRESS|TRESSES)") then goto MAIDENTRESS_GO
     if matchre("$UC_combatCritter", "(?i)(LARVA|KARVA)") then goto SCYTHEWINGLARVA_GO
     if matchre("$UC_combatCritter", "(?i)SILVER LEUCRO") then goto SILVERLEUCRO_GO
     if matchre("$UC_combatCritter", "(?i)(SILVER-BACKED BEAR|SILVER BEAR|SILVER BACKED BEAR|SILVERBACK BEAR)") then goto SILVERBEAR_GO
     if matchre("$UC_combatCritter", "(?i)(KOBOLD HEADHUNTER|ZOMBIE KOBOLD|SKELETAL KOBOLD)") then goto KOBOLDHEADHUNTER_GO
     if matchre("$UC_combatCritter", "(?i)KOBOLD SAVAGE") then goto KOBOLDSAVAGE_GO
     if matchre("$UC_combatCritter", "(?i)(YOUNG CAVE TROLL|CAVE TROLL HIB|YOUNG TROLL)") then goto YOUNGCAVETROLL_GO
     # if matchre("$UC_combatCritter", "(?i)SPOTTED SHARK") then goto SPOTTEDSHARK_GO
     if matchre("$UC_combatCritter", "(?i)IMMATURE FIRECAT") then goto IMMATUREFIRECAT_GO
     if matchre("$UC_combatCritter", "(?i)GRAVE WORM") then goto GRAVEWORM_GO
     if matchre("$UC_combatCritter", "(?i)(BROCKET DEER$|YOUNG (RED )?BROCKET DEER|BROCKET DEER T1|BROCKET DEER 1)") then goto YOUNGDEER_GO
     if matchre("$UC_combatCritter", "(?i)MOSS MEY") then goto MOSSMEY_GO
     if matchre("$UC_combatCritter", "(?i)YOUNG FIRECAT") then goto YOUNGFIRECAT_GO
     # if matchre("$UC_combatCritter", "(?i)DROWNED ONE") then goto DROWNED_GO
     if matchre("$UC_combatCritter", "(?i)BLIGHT BAT") then goto BLIGHTBAT_GO
     if matchre("$UC_combatCritter", "(?i)GRANITE GARGOYLE|GRANITE GARG|GRAN GARG") then goto GRANITEGARGOYLE_GO
     #### 100 - 200
     #### 100 - 200
     if matchre("$UC_combatCritter", "(?i)EIDOLON STEED") then goto EIDOLONSTEED_GO
     if matchre("$UC_combatCritter", "(?i)(GRAVEROBBER$|GRAVEROBBER1|GRAVEROBBER 1|GRAVEROBBER T1)") then goto GRAVEROBBER1_GO
     if matchre("$UC_combatCritter", "(?i)MARAUDER") then goto MARAUDER_GO
     if matchre("$UC_combatCritter", "(?i)RAZORTUSK BOAR") then goto RAZORTUSKBOAR_GO
     if matchre("$UC_combatCritter", "(?i)(CROCODILE$|CROCS$)") then goto CROCODILE_GO
	if matchre("$UC_combatCritter", "(?i)(CROCODILE2|CROCS2|CROCTHRONE|CROC THRONE)") then goto CROCODILE2_GO
     if matchre("$UC_combatCritter", "(?i)CRYPT FIEND") then goto CRYPTFIEND_GO
     if matchre("$UC_combatCritter", "(?i)(WOOD TROLL2|WOOD TROLL T2|WOOD TROLL 2)") then goto WOODTROLL2_GO
	if matchre("$UC_combatCritter", "(?i)(WOOD TROLL LANG|WOOD TROLLLANG|WOOD TROLL 3)") then goto WOODTROLLLANG_GO
     if matchre("$UC_combatCritter", "(?i)MONEYGRUBBER") then goto MONEYGRUBBER_GO
     if matchre("$UC_combatCritter", "(?i)PIRUATI SERPENT") then goto PIRUATISERPENT_GO
     if matchre("$UC_combatCritter", "(?i)SKINFLINT") then goto SKINFLINT_GO
     if matchre("$UC_combatCritter", "(?i)TIGHTWAD") then goto TIGHTWAD_GO
     if matchre("$UC_combatCritter", "(?i)(LESSER SLAUGH2|LESSER SLUAGH 2|LESSER SLUAGH T2|SLUAGH 2)") then goto LESSERSLUAGH2_GO
     if matchre("$UC_combatCritter", "(?i)PINCHFIST") then goto PINCHFIST_GO
     if matchre("$UC_combatCritter", "(?i)KASHIKA SERPENT") then goto KASHIKASERPENT_GO
     if matchre("$UC_combatCritter", "(?i)NIGHTWEAVER UNYN") then goto NIGHTWEAVERUNYN_GO
     if matchre("$UC_combatCritter", "(?i)(SNOW GOBLIN$|SNOW GOBLIN1|SNOW GOBLINS? 1|SNOW GOBLIN T1)") then goto SNOWGOBLIN1_GO
     if matchre("$UC_combatCritter", "(?i)CUTTHROAT") then goto CUTTHROAT_GO
     if matchre("$UC_combatCritter", "(?i)FOOTPAD") then goto FOOTPAD_GO
     if matchre("$UC_combatCritter", "(?i)RUFFIAN") then goto RUFFIAN_GO
     if matchre("$UC_combatCritter", "(?i)(^THUG$|^THUGS$)") then goto THUG_GO
     if matchre("$UC_combatCritter", "(?i)BAWDY SWAIN") then goto SWAIN_GO
     if matchre("$UC_combatCritter", "(?i)MERROWS") then goto MERROW_GO
     if matchre("$UC_combatCritter", "(?i)(ELDER RAZORTUSK BOAR|RAZORTUSK PREMIUM|ELDER RAZORTUSK|ELDER BOAR)") then goto ELDERRAZORTUSK_GO
     if matchre("$UC_combatCritter", "(?i)(UNDEAD GERBIL|GERBIL$)") then goto UNDEADGERBIL_GO
     if matchre("$UC_combatCritter", "(?i)SCOUT OGRE$") then goto SCOUTOGRE_GO
     if matchre("$UC_combatCritter", "(?i)(SCOUT OGRE 2|SCOUT OGRE2|SCOUT OGRE RIVER)") then goto SCOUTOGRE2_GO
     if matchre("$UC_combatCritter", "(?i)(SWAMP TROLL$|SWAMP TROLLS? 1|SWAMP TROLL1|SWAMP TROLL T1|SWAMPIE 1|SWAMPIE1|SWAMPIE T1|SWAMP 1)") then goto SWAMPTROLL_GO
     if matchre("$UC_combatCritter", "(?i)DIRE BEAR") then goto DIREBEAR_GO
     if matchre("$UC_combatCritter", "(?i)(^ATIKET$|GOLDEN SCALED ATIKET|ATIKET1|ATIKET T1|ATIKET 1)") then goto ATIKET_GO
     if matchre("$UC_combatCritter", "(?i)(GREY WESTANURYN|TAN WESTANURYN|WESTANURYN 1|WESTANURYN T1|GREY AND TAN WESTANURYN)") then goto WESTANURYN_GO
     if matchre("$UC_combatCritter", "(?i)BARGHEST") then goto BARGHEST_GO
     if matchre("$UC_combatCritter", "(?i)BARGHEST") then goto BARGHEST_GO
     if matchre("$UC_combatCritter", "(?i)(PRERENI$|PRERENI1$|PRERENI 1$|PRERENI T1$)") then goto YOUNGPRERENI_GO
     if matchre("$UC_combatCritter", "(?i)(PRERENI PREMIUM|PRERENI1 PREMIUM|PRERENI 1 PREMIUM|PRERENI T1 PREMIUM|PRERENI 1 PRE)") then goto YOUNGPRERENI_PREMIUM_GO
     # if matchre("$UC_combatCritter", "(?i)WORMWOOD VINE") then goto WORMWOODVINE_GO
     if matchre("$UC_combatCritter", "(?i)BLOODVINE") then goto BLOODVINE_GO
     if matchre("$UC_combatCritter", "(?i)THICKET VIPER") then goto THICKETVIPER_GO
     if matchre("$UC_combatCritter", "(?i)RETCH FIEND") then goto RETCHFIEND_GO
     if matchre("$UC_combatCritter", "(?i)FROST CRONE") then goto FROSTCRONE_GO
     if matchre("$UC_combatCritter", "(?i)(SNOW GOBLIN2|SNOBLIN 2|SNOW GOBLIN 2|SNOW GOBLIN T2|SNOBLIN T2|GOBLINS2|SNOW GOBLINS 2)") then goto SNOWGOBLIN2_GO
     if matchre("$UC_combatCritter", "(?i)TOGBALL") then goto TOGBALL_GO
     if matchre("$UC_combatCritter", "(?i)(DARK SPIRIT$|DARK SPIRIT 1|DARK SPIRIT T1)") then goto DARKSPIRIT_GO
	if matchre("$UC_combatCritter", "(?i)(DARK SPIRIT2|DARK SPIRIT 2|DARK SPIRIT T2)") then goto DARKSPIRIT2_GO
	if matchre("$UC_combatCritter", "(?i)(DARK SPIRIT3|DARK SPIRIT 3|DARK SPIRIT T3)") then goto DARKSPIRIT3_GO
     if matchre("$UC_combatCritter", "(?i)GHOUL CROW") then goto GHOULCROW_GO
     if matchre("$UC_combatCritter", "(?i)KRAHEI HATCHLING") then goto KRAHEIHATCHLING_GO
     if matchre("$UC_combatCritter", "(?i)(^RED BROCKET DEER|BROCKET DEER T2|BROCKET DEER 2)") then goto BROCKETDEER_GO
     if matchre("$UC_combatCritter", "(?i)(QUARTZ GARGOYLE|QUARTZ GARG)") then goto QUARTZGARGOYLE_GO
     if matchre("$UC_combatCritter", "(?i)(ZOMBIE LEUCRO|ZOMBIE RED LEUCRO)") then goto ZOMBIEREDLEUCRO_GO
     if matchre("$UC_combatCritter", "(?i)LITHE BLIGHT OGRE") then goto LITHEBLIGHTOGRE_GO
     if matchre("$UC_combatCritter", "(?i)(RIVER SPRITE|WATER SPRITE)") then goto RIVERSPRITE_GO
     if matchre("$UC_combatCritter", "(?i)(SNOW GOBLIN3|SNOW GOBLIN 3|SNOW GOBLIN T3|SNOBLIN3|SNOBLIN 3|SNOBLIN T3|SNOW GOBLINS 3|GOBLINS 3)") then goto SNOWGOBLIN3_GO
     # if matchre("$UC_combatCritter", "(?i)PIRATE") then goto PIRATE_GO
     if matchre("$UC_combatCritter", "(?i)DYRACHIS") then goto DYRACHIS_GO
     if matchre("$UC_combatCritter", "(?i)(ALLEY THUG|ALLEY THUGS|THUG THRONE)") then goto ALLEYTHUG_GO
     if matchre("$UC_combatCritter", "(?i)(SWAMP TROLLS? 2|SWAMP TROLL T2|SWAMP TROLL2|SWAMP 2|SWAMPIE 2)") then goto SWAMPTROLL2_GO
     if matchre("$UC_combatCritter", "(?i)(SCYTHEWING MOTH|SCYTH MOTH|SCYTHE MOTH)") then goto SCYTHEWINGMOTH_GO
     #### 150 - 250
     if matchre("$UC_combatCritter", "(?i)(HEGGARANGI BOAR|HEG BOAR)") then goto HEGBOAR_GO
     if matchre("$UC_combatCritter", "(?i)LESSER SLUAGH3|LESSER SLUAGH 3|LESSER SLUAGH T3") then goto LESSERSLUAGH3_GO
     if matchre("$UC_combatCritter", "(?i)NIGHTREAVER UNYN") then goto NIGHTREAVERUNYN_GO
     if matchre("$UC_combatCritter", "(?i)STUMPY BLIGHT OGRE") then goto STUMPYBLIGHTOGRE_GO
     if matchre("$UC_combatCritter", "(?i)CLAY SOLDIER") then goto CLAYSOLDIER_GO
     if matchre("$UC_combatCritter", "(?i)NIPOH OSHU$") then goto NIPOHOSHU1_GO
     if matchre("$UC_combatCritter", "(?i)OCHRE LAHEKE") then goto OCHRELAHEKE_GO
     if matchre("$UC_combatCritter", "(?i)^LACHMATE$") then goto LACHMATE_GO
     if matchre("$UC_combatCritter", "(?i)DEADWOOD DRYAD") then goto DEADWOODDRYAD_GO
     # if matchre("$UC_combatCritter", "(?i)SHADOWEAVER") then goto SHADOWEAVER_GO
     if matchre("$UC_combatCritter", "(?i)(CADAVEROUS YEEHAR|YEEHAR)") then goto YEEHAR_GO
     if matchre("$UC_combatCritter", "(?i)CRAG") then goto CRAG_GO
     if matchre("$UC_combatCritter", "(?i)(LATAMI$|YVHH LATAMI 1|LA'TAMIS? 1|LA'TAMIS?1|LATAMI T1|LATAMI)") then goto LATAMI_GO
     if matchre("$UC_combatCritter", "(?i)(YVHH LATAMI 2|LA'TAMIS? 2|LA'TAMIS?2|LATAMI2|LATAMI 2|LATAMI T2)") then goto YVHHLATAMI2_GO
     if matchre("$UC_combatCritter", "(?i)LESSER SHADOW HOUND") then goto LESSERSHADOWHOUND_GO
     if matchre("$UC_combatCritter", "(?i)(BLACK LEUCRO|BLACK LUECRO|BLEUCRO)") then goto BLACKLEUCRO_GO
     # if matchre("$UC_combatCritter", "(?i)VYKATHI HARVESTER") then goto RATS_GO
     if matchre("$UC_combatCritter", "(?i)(VICIOUS WARCAT|VICIOUSCAT|VICIOUSWAR)") then goto VICIOUSWARCAT_GO
     if matchre("$UC_combatCritter", "(?i)(BLIGHTWATER NYAD|BLIGHT NYAD)") then goto BLIGHTWATERNYAD_GO
     if matchre("$UC_combatCritter", "(?i)SCAVENGER TROLL") then goto SCAVENGERTROLL_GO
     if matchre("$UC_combatCritter", "(?i)(BLACKTIP SHARK|BLACK SHARK)") then goto BLACKTIPSHARK_GO
     if matchre("$UC_combatCritter", "(?i)(NIPOH OSHU 2|OSHU 2|OSHU T2|OSHU2)") then goto OSHU2_GO
     if matchre("$UC_combatCritter", "(?i)(DRYAD PRIESTESS|DRYAD PRIEST)") then goto DRYADPRIESTESS_GO
     if matchre("$UC_combatCritter", "(?i)TWISTED DRYAD") then goto TWISTEDDRYAD_GO
     if matchre("$UC_combatCritter", "(?i)(FROSTWEYR BEAR|FROST BEAR)") then goto FROSTBEAR_GO
     if matchre("$UC_combatCritter", "(?i)CLAY MAGE") then goto CLAYMAGE_GO
     if matchre("$UC_combatCritter", "(?i)(SMALL PECCARY|SMALL PECC)") then goto SMALLPECCARY_GO
     if matchre("$UC_combatCritter", "(?i)ORC SCOUT") then goto ORCSCOUT_GO
     if matchre("$UC_combatCritter", "(?i)KARTAIS") then goto KARTAIS_GO
     if matchre("$UC_combatCritter", "(?i)(UR HHRKIIZH|HHRKIIZH)") then goto HHRKIIZH_GO
     if matchre("$UC_combatCritter", "(?i)(GOLDEN PARD|PARD)") then goto GOLDENPARD_GO
     if matchre("$UC_combatCritter", "(?i)CLAY ARCHER") then goto CLAYARCHER_GO
     if matchre("$UC_combatCritter", "(?i)ANGISWAERD HATCHLING") then goto ANGHATCHLING_GO
     if matchre("$UC_combatCritter", "(?i)(BLUE-DAPPLED PRERENI 2$|PRERENI2$|PRERENI 2$|PRERENI T2$)") then goto PRERENI_GO
     if matchre("$UC_combatCritter", "(?i)(BLUE-DAPPLED PRERENI 2 PREMIUM|PRERENI2 PREMIUM|PRERENI 2 PREMIUM|PRERENI T2 PREMIUM|PRERENI 2 PRE)") then goto PRERENI_PREMIUM_GO
     if matchre("$UC_combatCritter", "(?i)BLIGHT OGRE") then goto BLIGHTOGRE_GO
     if matchre("$UC_combatCritter", "(?i)FROSTWEAVER") then goto FROSTWEAVER_GO
     if matchre("$UC_combatCritter", "(?i)ROCK GUARDIAN") then goto ROCKGUARDIAN_GO
     if matchre("$UC_combatCritter", "(?i)(MOTTLED WESTANURYN|MOTTLED WEST|WESTANURYN 2|WESTANURYN T2|WESTIE 2|WESTIE T2)") then goto MOTTLEDWESTANURYN_GO
     if matchre("$UC_combatCritter", "(?i)ORC BANDIT") then goto ORCBANDIT_GO
     if matchre("$UC_combatCritter", "(?i)BULL SHARK") then goto BULLSHARK_GO
     if matchre("$UC_combatCritter", "(?i)(SWAMP TROLL3|SWAMP TROLLS? 3|SWAMP TROLL T3|SWAMPIE 3|SWAMPIE T3)") then goto SWAMPTROLL3_GO
     if matchre("$UC_combatCritter", "(?i)FENDRYAD") then goto FENDRYAD_GO
     if matchre("$UC_combatCritter", "(?i)LANKY GREY LACH") then goto GREYLACH_GO
     if matchre("$UC_combatCritter", "(?i)RHOAT MODA") then goto RHOATMODA_GO
     if matchre("$UC_combatCritter", "(?i)TIGER SHARK") then goto TIGERSHARK_GO
     #### 200 - 300
     if matchre("$UC_combatCritter", "(?i)RED LEUCRO") then goto REDLEUCRO_GO
     if matchre("$UC_combatCritter", "(?i)(PALE GREY DEATH SPIRIT|DEATH SPIRIT)") then goto DEATHSPIRIT_GO
     if matchre("$UC_combatCritter", "(?i)(ELDER (RED )?BROCKET DEER|BROCKET DEER T3|BROCKET DEER 3)") then goto ELDERDEER_GO
     # if matchre("$UC_combatCritter", "(?i)VYKATHI SOLDIER") then goto RATS_GO
     if matchre("$UC_combatCritter", "(?i)SHADEFIELD EVISCERATOR") then goto EVISCERATOR_GO
     if matchre("$UC_combatCritter", "(?i)ICE ADDER") then goto ICEADDER_GO
     if matchre("$UC_combatCritter", "(?i)FOREST BANDIR") then goto FORESTBANDIT_GO
     if matchre("$UC_combatCritter", "(?i)(BELTUNUMSHI|BELTUNMUSHI|BELTINUMUSHI|BELTUNAMUSHI)") then goto BELTUNUMSHI_GO
     if matchre("$UC_combatCritter", "(?i)DARK SPRITE") then goto DARKSPRITE_GO
     if matchre("$UC_combatCritter", "(?i)SKELETAL SAILOR") then goto SKELETALSAILOR_GO
     if matchre("$UC_combatCritter", "(?i)(BARGHEST|ABRGHEST)") then goto BARGHEST_GO
     if matchre("$UC_combatCritter", "(?i)FRAIL DARKENED SILHOUETTE") then goto SILHOUETTE_GO
     if matchre("$UC_combatCritter", "(?i)GAUNT SHADOW MASTER") then goto SHADOWMASTER_GO
     if matchre("$UC_combatCritter", "(?i)(LONG-FANGED WARCAT|LONG WARCAT)") then goto LONGWARCAT_GO
     if matchre("$UC_combatCritter", "(?i)BLUE-GREEN PIVUH|PIVUH") then goto PIVUH_GO
     if matchre("$UC_combatCritter", "(?i)UR HHRKIIZH2") then goto HHRKIIZH2_GO
     if matchre("$UC_combatCritter", "(?i)FAENRAE STALKER") then goto FSTALKER_GO
     if matchre("$UC_combatCritter", "(?i)(PECCARY 2|PECCARY T2|ADULT PECCARY|SHARD PECCARY|PECCARY SHARD)") then goto PECCARY_GO
     if matchre("$UC_combatCritter", "(?i)CARACAL") then goto CARACAL_GO
     if matchre("$UC_combatCritter", "(?i)VELAKAN SLAVER") then goto SLAVER_GO
     if matchre("$UC_combatCritter", "(?i)(RED-GOLD SCALED ATIKET|RED-SCALED ATIKET|RED ATIKET|GOLD ATIKET|ATIKET2|ATIKET T2|ATIKET 2)") then goto REDATIKET_GO
     if matchre("$UC_combatCritter", "(?i)CLOUDED ARZUMOS") then goto ARZUMOS_GO
     if matchre("$UC_combatCritter", "(?i)(TRANSPARENT SHYLVIC|SHYLVIC)") then goto SHYLVIC_GO
     if matchre("$UC_combatCritter", "(?i)(NIPOH3|NIPOH 3|OSHU3|OSHU 3|OSHU T3)") then goto NIPOHOSHU3_GO
     if matchre("$UC_combatCritter", "(?i)\bCAVE TROLL$") then goto CAVETROLL_GO
     if matchre("$UC_combatCritter", "(?i)(FERAL BONE MASTIFF|BONE MASTIFF|MASTIFF)") then goto MASTIFF_GO
     #### 250 - 400
     if matchre("$UC_combatCritter", "(?i)(ELDER BLUE-DAPPLED PRERENI$|PRERENI 3$|PRERENI T3$)") then goto ELDERPRERENI_GO
     if matchre("$UC_combatCritter", "(?i)(ELDER BLUE-DAPPLED PRERENI PREMIUM|PRERENI 3 PREMIUM|PRERENI T3 PREMIUM|PRERENI 3 PRE|PRERENI T3 PRE)") then goto ELDERPRERENI_PREMIUM_GO
     if matchre("$UC_combatCritter", "(?i)NIMBUS") then goto NIMBUS_GO
     if matchre("$UC_combatCritter", "(?i)(ADANF BLOOD WARRIOR|ADAN\'F BLOOD|BLOOD WARRIOR)") then goto BLOODWARRIOR_GO
     if matchre("$UC_combatCritter", "(?i)SPECTRAL PIRATE") then goto SPECTRALPIRATE_GO
     if matchre("$UC_combatCritter", "(?i)UMBRAMAGUS") then goto UMBRAMAGUS_GO
     # if matchre("$UC_combatCritter", "(?i)VYKATHI REAPER") then goto VYKATHIREAPER_GO
     if matchre("$UC_combatCritter", "(?i)(BABY (FOREST )?GRYPHON$|BABY (FOREST )?GRYPHON 1|BABY GRYPHON ROSS|BABY GRYPHON T1)") then goto BABYGRYPHON_GO
     if matchre("$UC_combatCritter", "(?i)(BABY (FOREST )?GRYPHON 2|BABY GRYPHON SHARD|BABY GRYPHON 2|BABY GRYPHON T2|BABY (FOREST )?GRYPHON)") then goto BABYGRYPHON2_GO
     if matchre("$UC_combatCritter", "(?i)(FOREST GENI|GENI)") then goto GENI_GO
     if matchre("$UC_combatCritter", "(?i)(RED-BRISTLED GREMLIN|RED GREMLINS)") then goto REDGREMLINS_GO
     if matchre("$UC_combatCritter", "(?i)SLEEK HELELA") then goto HELELA_GO
     if matchre("$UC_combatCritter", "(?i)(ADANF SHADOW MAGE|ADAN\'F SHADOW MAGE|SHADOW MAGE)") then goto SHADOWMAGE_GO
     if matchre("$UC_combatCritter", "(?i)FROST ANGISWAERD") then goto FROSTANGISWAERD_GO
     if matchre("$UC_combatCritter", "(?i)GHOUL RAVEN") then goto GHOULRAVEN_GO
     if matchre("$UC_combatCritter", "(?i)CLOUD RAT") then goto CLOUDRAT_GO
     if matchre("$UC_combatCritter", "(?i)RETAN DOLOMAR") then goto DOLOMAR_GO
     if matchre("$UC_combatCritter", "(?i)ZOMBIE NOMAD") then goto ZNOMAD_GO
     if matchre("$UC_combatCritter", "(?i)ELBA DARVAGER") then goto DARVAGER_GO
     if matchre("$UC_combatCritter", "(?i)(GRAVEROBBER 2|GRAVEROBBER2|GRAVEROBBER T2)") then goto GRAVEROBBER2_GO
     if matchre("$UC_combatCritter", "(?i)GREATER SHADOW HOUND") then goto GREATERSHADOWHOUND_GO
     if matchre("$UC_combatCritter", "(?i)RIVER BOA") then goto RIVERBOA_GO
     if matchre("$UC_combatCritter", "(?i)(RIVER BOA2|RIVER BOA THRONE)") then goto RIVERBOA2_GO
     if matchre("$UC_combatCritter", "(?i)PIRANHA") then goto PIRANHA_GO
     if matchre("$UC_combatCritter", "(?i)(GREATER SLUAGH|GREAT SLUAGH)") then goto GREATERSLUAGH_GO
     if matchre("$UC_combatCritter", "(?i)MUSCULAR FIRECAT") then goto MUSCULARFIRECAT_GO
     if matchre("$UC_combatCritter", "(?i)(ORC REIVER|REIVER)") then goto ORCREIVER_GO
     if matchre("$UC_combatCritter", "(?i)(ATIKET 3|ATIKET3|RED-GOLD SCALED ATIKET3|AKITET T3|ATIKET T3)") then goto REDATIKET2_GO
     if matchre("$UC_combatCritter", "(?i)(SABRE-TOOTHED WARCAT|SABRE WARCAT|SABRETOOTH WARCAT)") then goto SABRETOOTHWARCAT_GO
     if matchre("$UC_combatCritter", "(?i)(BRISTLE-BACKED PECCARY|BRISTLE PECCARY|BRISTLEBACK)") then goto BRISTLEPECCARY_GO
     if matchre("$UC_combatCritter", "(?i)(FLEDGLING FOREST GRYPHON$|FLEDGLING GRYPHON$|FLEDGLING FOREST GRYPHON1|FLEDGLING FOREST GRYPHON 1|FLEDGLING GRYPHON ROSS|FLEDGLING GRYPHON 1)") then goto FLEDGLINGGRYPHON_GO
     if matchre("$UC_combatCritter", "(?i)(FLEDGLING FOREST GRYPHON2|FLEDGLING FOREST GRYPHON 2|FLEDGLING GRYPHON SHARD|FLEDGLING GRYPHON 2|FLEDGLING (FOREST )?GRYPHON)") then goto FLEDGLINGGRYPHON2_GO
     if matchre("$UC_combatCritter", "(?i)NIGHTSTALKER UNYN") then goto UNYN_GO
     if matchre("$UC_combatCritter", "(?i)(YELLOW BRISTLED GREMLIN|YELLOW GREMLIN|YELLOW-BRISTLED GREMLIN)") then goto YELLOWGREMLIN_GO
     ### 300 - 500
     if matchre("$UC_combatCritter", "(?i)(ICY BLUE GHAST$|BLUE GHAST$|ICY GHAST$|ICE GHAST$|GHAST T1|GHAST1|GHAST 1)") then goto ICYGHAST_GO
     if matchre("$UC_combatCritter", "(?i)(ICY BLUE GHAST 2$|BLUE GHAST 2|ICY GHAST 2$|ICE GHAST 2|GHAST T2|GHAST2|GHAST 2)") then goto ICYGHAST2_GO
     if matchre("$UC_combatCritter", "(?i)(ICY BLUE GHAST 3$|BLUE GHAST 2|ICY GHAST 3$|ICE GHAST 3|GHAST T3|GHAST3|GHAST 3)") then goto ICYGHAST3_GO
     if matchre("$UC_combatCritter", "(?i)(ICY BLUE GHAST 4$|BLUE GHAST 2|ICY GHAST 4$|ICE GHAST 4|GHAST T4|GHAST4|GHAST 4)") then goto ICYGHAST4_GO
     if matchre("$UC_combatCritter", "(?i)ELSRALAEL2|ELSRALAEL LANG") then goto ELSRALAEL2_GO
     if matchre("$UC_combatCritter", "(?i)ELSRALAEL$") then goto ELSRALAEL_GO
     if matchre("$UC_combatCritter", "(?i)TOAD") then goto TOAD_GO
     if matchre("$UC_combatCritter", "(?i)SHALSWAR") then goto SHALSWAR_GO
     if matchre("$UC_combatCritter", "(?i)BLADE SPIDER") then goto BLADESPIDER_GO
     if matchre("$UC_combatCritter", "(?i)BRONZE LEUCRO") then goto BRONZELEUCRO_GO
     if matchre("$UC_combatCritter", "(?i)KRAHEI") then goto KRAHEI_GO
     if matchre("$UC_combatCritter", "(?i)(MARBLED ANGISWAERD|MARBLE ANGI|MARBLE ANGISW)") then goto MARBLEANGISWAERD_GO
     if matchre("$UC_combatCritter", "(?i)WIR DINEGO") then goto WIRDINEGO_GO
     if matchre("$UC_combatCritter", "(?i)(YOUNG (FOREST )?GRYPHON$|YOUNG FOREST GRYPHON 1|YOUNG GRYPHON 1|YOUNG FOREST GRYPHON1|YOUNG GRYPHON ROSS|YGRYPHON1)") then goto YOUNGGRYPHON_GO
     if matchre("$UC_combatCritter", "(?i)(YOUNG FOREST GRYPHON 2|YOUNG GRYPHON 2|YOUNG FOREST GRYPHON2|YOUNG GRYPHON SHARD|YGRYPHON2|YOUNG (FOREST )?GRYPHON 2)") then goto YOUNGGRYPHON2_GO
     if matchre("$UC_combatCritter", "(?i)(DRAGON PRIEST CRONE|DP CRONE|CRONE|PRIEST CRONE)") then goto DPCRONE_GO
     if matchre("$UC_combatCritter", "(?i)(DOBEK MORURYN|DOBEK)") then goto DOBEK_GO
     if matchre("$UC_combatCritter", "(?i)(ONYX GARGOYLE|ONYX GARG)") then goto ONYXGARGOYLE_GO
     if matchre("$UC_combatCritter", "(?i)GAM CHAGA") then goto GAMCHAGA_GO
     if matchre("$UC_combatCritter", "(?i)(^GIGANTIC LACHMATE$|^GIANT LACHMATE$)") then goto GIGANTICLACHMATE_GO
     if matchre("$UC_combatCritter", "(?i)(^PREMIUM GIGANTIC LACHMATE$|^PREMIUM GIANT LACHMATE$|^PREMIE GIGANTIC LACHMATE$)") then goto PREMIUMGIGANTICLACHMATE_GO
     if matchre("$UC_combatCritter", "(?i)SPIDER CRAB") then goto SPIDERCRAB_GO
     if matchre("$UC_combatCritter", "(?i)SUPPLE FIRECAT") then goto SUPPLEFIRECAT_GO
     if matchre("$UC_combatCritter", "(?i)(DRAGON PRIEST SENTINEL|DP SENTINEL|DP SENT)") then goto DPSENTINEL_GO
     if matchre("$UC_combatCritter", "(?i)(SAILFIN LIZARD|SAILFIN)") then goto SAILFIN_GO
     if matchre("$UC_combatCritter", "(?i)(LESSER DUSKY-SCALED BASILISK|DUSKY BASILISK|BASILISK)") then goto BASILISK_GO
     if matchre("$UC_combatCritter", "(?i)(BLACK MARBLE GARGOYLE|MARBLE GARGOYLE|BLACK GARG)") then goto MARBLEGARGOYLE_GO
     if matchre("$UC_combatCritter", "(?i)(ADULT FOREST GRYPHON$|ADULT FOREST GRYPHON 1|ADULT GRYPHON 1|ADULT GRYPHON T1|ADULT GRYPHON ROSS)") then goto ADULTGRYPHON_GO
     if matchre("$UC_combatCritter", "(?i)(ADULT FOREST GRYPHON2|ADULT GRYPHON 2|ADULT GRYPHON T2|ADULT GRYPHON SHARD)") then goto ADULTGRYPHON2_GO
     if matchre("$UC_combatCritter", "(?i)LUNSHELE HUNTER") then goto LUNSHELE_GO
     if matchre("$UC_combatCritter", "(?i)(SILVER-TIPPED MATURE FOREST GRYPHON|SILVER-TIPPED MATURE FOREST GRYPHON 1|MATURE GRYPHON1|MATURE GRYPHON 1|MATURE GRYPHON ROSS|MATURE FOREST GRYPHON)") then goto MATUREGRYPHON_GO
     if matchre("$UC_combatCritter", "(?i)VAPOROUS BLOOD WRAITH|BLOOD WRAITH") then goto BLOODWRAITH_GO
     if matchre("$UC_combatCritter", "(?i)(MAELSHYVEAN|SHADOW BEAST)") then goto SHADOWBEAST_GO
     if matchre("$UC_combatCritter", "(?i)(GARGANTUAN|BONE GOLEM)") then goto BONEGOLEM_GO
     if matchre("$UC_combatCritter", "(?i)(MISSHAPEN GERMISHDIN|GERMISH|GERMISH\'DIN|GERMISHDIN)") then goto GERMISHDIN_GO
     if matchre("$UC_combatCritter", "(?i)(GREATER GHOUL RAVEN|GHOUL RAVEN2)") then goto GHOULRAVEN2_GO
     if matchre("$UC_combatCritter", "(?i)(DRAGON PRIEST PURIFIER|DP PURIFIER|PURIFER)") then goto PURIFIER_GO
     if matchre("$UC_combatCritter", "(?i)(ROBED DRAGON PRIEST|DRAGON PRIESTESS)") then goto DRAGONPRIEST_GO
     if matchre("$UC_combatCritter", "(?i)(SNAER HAFWA$|HAFWA 1|HAWFA T1)") then goto HAFWA_GO
     if matchre("$UC_combatCritter", "(?i)(SNAER HAFWA2|HAFWA 2|HAFWA T2)") then goto SNAERHAFWA2_GO
     if matchre("$UC_combatCritter", "(?i)(MAELSHYVEAN CINDER BEAST|CINDER BEAST)") then goto CINDERBEAST_GO
     if matchre("$UC_combatCritter", "(?i)SPINY BLOODFISH") then goto BLOODFISH_GO
     if matchre("$UC_combatCritter", "(?i)TELGA MORADU") then goto TMORADU_GO
     if matchre("$UC_combatCritter", "(?i)ISUNDJEN CONJURER") then goto CONJURER_GO
     if matchre("$UC_combatCritter", "(?i)(LUNSHELE TREKHALO|LUN\'SHELE TREKHALO)") then goto TREKHALO_GO
     if matchre("$UC_combatCritter", "(?i)FAENRAE ASSASSIN") then goto FASSASSIN_GO
     if matchre("$UC_combatCritter", "(?i)MOUNTAIN GIANT") then goto MOUNTAINGIANT_GO
     if matchre("$UC_combatCritter", "(?i)ORC RAIDER") then goto ORCRAIDER_GO
     if matchre("$UC_combatCritter", "(?i)(ADANF SPIRIT DANCER|SPIRIT DANCER|ADAN\'F SPIRIT|ADAN\'F DANCER)") then goto DANCER_GO
     if matchre("$UC_combatCritter", "(?i)(GOLD-TALONED ELDER FOREST GRYPHON|ELDER GRYPHON|ELDER GRYPHONE ROSS)") then goto ELDERGRYPHON_GO
     #### 400 - 550
     if matchre("$UC_combatCritter", "(?i)(DRAGON PRIEST JUGGERNAUT|JUGGERNAUT)") then goto DPJUGGERNAUT_GO
     if matchre("$UC_combatCritter", "(?i)(ORC CLAN-CHIEF|CLAN CHIEF)") then goto ORCCHIEF_GO
     if matchre("$UC_combatCritter", "(?i)WARKLIN MAULER") then goto WARKLIN_GO
     if matchre("$UC_combatCritter", "(?i)(DRAGON PRIEST ZEALOT|DP ZEALOT|DRAGON PRIEST ZEAL)") then goto DPZEALOT_GO
     if matchre("$UC_combatCritter", "(?i)SEORDMAOR") then goto SEORDMAOR_GO
     if matchre("$UC_combatCritter", "(?i)ARMORED WARKLIN") then goto WARKLIN_GO
     if matchre("$UC_combatCritter", "(?i)(RATHA CELP|CELPEZE RATHA|CELPEZE 1|CELPEZE1|CELPEZE T1)") then goto CELPEZERATHA_GO
     if matchre("$UC_combatCritter", "(?i)(CELPEZE2|CELPEZE T2|CELPEZE 2|CELPEZE MERK)") then goto CELPEZE2_GO
     if matchre("$UC_combatCritter", "(?i)(VILE PLAGUE WRAITH|PLAGUE WRAITH)") then goto PLAGUEWRAITH_GO
     if matchre("$UC_combatCritter", "(?i)ZOMBIE STOMPER") then goto ZSTOMPER_GO
     #### 500 - 700
     # if matchre("$UC_combatCritter", "(?i)GIANT SNOW HAWK") then goto SNOWHAWK_GO
     if matchre("$UC_combatCritter", "(?i)BLACK GOBLIN") then goto BLACKGOBLIN_GO
     if matchre("$UC_combatCritter", "(?i)BLACK APE") then goto BLACKAPE_GO
     if matchre("$UC_combatCritter", "(?i)(CELPEZE3|CELPEZE T3|CELPEZE 3)") then goto CELPEZE3_GO
     if matchre("$UC_combatCritter", "(?i)ZOMBIE MAULER|MAULER") then goto ZMAULER_GO
     if matchre("$UC_combatCritter", "(?i)ASHU HHINVI") then goto ASHUHHINVI_GO
     if matchre("$UC_combatCritter", "(?i)POLOHIZH") then goto POLOHIZH_GO
     if matchre("$UC_combatCritter", "(?i)SSUGI MALCHATA|S\'SUGI|MALCHATA") then goto MALCHATA_GO
     # if matchre("$UC_combatCritter", "(?i)ENRAGED TUSKY") then goto TUSKY_GO
     if matchre("$UC_combatCritter", "(?i)STORM BULL SHARD|STORM BULL 2|STORM BULL T2") then goto STORMBULL_SHARD_GO
     if matchre("$UC_combatCritter", "(?i)STORM BULL PREMIUM|PREMIUM STORM BULL|STORM BULL PREMIE|PREMIE STORM BULL") then goto STORMBULL_SHARD_PREMIUM_GO
     if matchre("$UC_combatCritter", "(?i)STORM BULL") then goto STORMBULL_GO
     if matchre("$UC_combatCritter", "(?i)(CELPEZE4|CELPEZE T4|CELPEZE 4)") then goto CELPEZE4_GO
     if matchre("$UC_combatCritter", "(?i)(CELPEZE5|CELPEZE T5|CELPEZE 5)") then goto CELPEZE5_GO
     if matchre("$UC_combatCritter", "(?i)(MISENSEOR RESUSCITANT|MISEN RESUS|RESUSCITANT)") then goto RESUSCITANT_GO
     if matchre("$UC_combatCritter", "(?i)(SINISTER MAELSHYVEAN|HIEROPHANT|HEIROPHANT)") then goto HEIROPHANT_GO
     ## 600 - 800
     if matchre("$UC_combatCritter", "(?i)(ZOMBIE HEAD-SPLITTER|HEAD SPLITTER|HEADSPLITTER)") then goto HEADSPLITTER_GO
     if matchre("$UC_combatCritter", "(?i)(JUVENILE DESERT ARMADILLO|JUVIE DILLO|JUVENILE DILLO|JUVENILE ARMADILLO)") then goto JUVENILEDILLO_GO
     if matchre("$UC_combatCritter", "(?i)(SKY GIANT|SKYGIANT)") then goto SKYGIANT_GO
     if matchre("$UC_combatCritter", "(?i)YOUNG WYVERN") then goto YWYVERN_GO
     ## 700 - 1000
     if matchre("$UC_combatCritter", "(?i)(WIGHT|FORAGER WIGHT)") then goto FORAGERWIGHT_GO
     if matchre("$UC_combatCritter", "(?i)(FORAGER GHOUL)") then goto FORAGERGHOUL_GO
     if matchre("$UC_combatCritter", "(?i)(WIND HAG|\bHAGS\b|WINDHAG)") then goto WINDHAG_GO
     if matchre("$UC_combatCritter", "(?i)(WIND WRETCH|WINDWRETCH|WRETCH)") then goto WINDWRETCH_GO
     if matchre("$UC_combatCritter", "(?i)(ELDER DESERT ARMADILLO|ELDER DILLO|ELDER ARMADILLO)") then goto ELDERDILLO_GO
     if matchre("$UC_combatCritter", "(?i)(JUVENILE WYVERN|JUVIE WYVERN)") then goto JWYVERN_GO
     if matchre("$UC_combatCritter", "(?i)(ADULT DESERT ARMADILLO|ADULT ARMADILLO|ADULT DILLO)") then goto ADULTDILLO_GO
     if matchre("$UC_combatCritter", "(?i)(XALASHAR MAGUS|XALA\'SHAR MAGUS)") then goto XMAGUS_GO
     if matchre("$UC_combatCritter", "(?i)(XALASHAR THRALL|XALA\'SHAR THRALL)") then goto XTHRALL_GO
     if matchre("$UC_combatCritter", "(?i)(DRAGON PRIEST ASSASSIN|DP ASSASSIN|DRAGON PRIEST ASS|DP ASS|ASSASSIN)") then goto DPASSASSIN_GO
     ## 800 - 1100
     if matchre("$UC_combatCritter", "(?i)(XALASHAR CONJURER|XALA\'SHAR CONJURER)") then goto XCONJURER_GO
     if matchre("$UC_combatCritter", "(?i)(XALASHAR VANQUISHER|XALA\'SHAR VANQ)") then goto XVANQUISHER_GO
     ## 900 - 1200
     if matchre("$UC_combatCritter", "(?i)LAVA DRAKE") then goto LAVADRAKE_GO
     if matchre("$UC_combatCritter", "(?i)BANSHEE") then goto WINDBANSHEE_GO
     if matchre("$UC_combatCritter", "(?i)TELGA OREK") then goto TELGAOREK_GO
     if matchre("$UC_combatCritter", "(?i)(XALASHAR SLAYER|XALA\'SHAR SLAYER)") then goto XSLAYER_GO
     if matchre("$UC_combatCritter", "(?i)(XALASHAR ARCHIMAGE|XALA\'SHAR ARCHIMAGE)") then goto XARCHIMAGE_GO
     if matchre("$UC_combatCritter", "(?i)(XALASHAR VINDICATOR|XALA\'SHAR VINDI)") then goto XVINDICATOR_GO
     if matchre("$UC_combatCritter", "(?i)(INTERCESSOR|DP INTERCESSOR|DRAGON PRIEST INT)") then goto INTERCESSOR_GO
     if matchre("$UC_combatCritter", "(?i)(^UMBRAL MOTH$|UMBRAL MOTH1|UMBRAL MOTH 1|MOTH 1 DIRGE|UMBRAL MOTH DIRGE|UMBRAL MOTH T1)") then goto UMOTH_GO
     if matchre("$UC_combatCritter", "(?i)(XALASHAR ARCHER|XALA\'SHAR ARCHER)") then goto XARCHER_GO
     if matchre("$UC_combatCritter", "(?i)(XALASHAR OVERSEER|XALA\'SHAR OVERSEER)") then goto XOVERSEER_GO
     if matchre("$UC_combatCritter", "(?i)(XALASHAR SHREDDER|XALA\'SHAR SHREDDER)") then goto XSHREDDER_GO
     ## 1000 - 1400
     if matchre("$UC_combatCritter", "(?i)ADULT WYVERN") then goto AWYVERN_GO
     ## 1100 - 1500
     if matchre("$UC_combatCritter", "(?i)CABALIST") then goto CABALIST_GO
     if matchre("$UC_combatCritter", "(?i)(FULIGIN MOTH BOAR|FULIGIN MOTH 2|FULIGIN UMBRAL MOTH BOAR|FULIGIN BOAR|FULIGIN T2|FMOTH BOAR)") then goto FMOTH2_GO
     if matchre("$UC_combatCritter", "(?i)(^FULIGIN MOTH$|FULIGIN MOTH DIRGE|FULIGIN UMBRAL MOTH 1|FMOTH DIRGE|FULIGIN DIRGE|FULIGIN UMBRAL|UMBRAL MOTH 2|MOTH T2|MOTH 2 DIRGE|MOTH T2 DIRGE|MOTH2 DIRGE|FMOTH1)") then goto FMOTH_GO
     ## 1200 - 1750
     if matchre("$UC_combatCritter", "(?i)ICE ARCHON") then goto ARCHON_GO
     if matchre("$UC_combatCritter", "(?i)BONE WYVERN") then goto BONEWYVERN_GO
     if matchre("$UC_combatCritter", "(?i)(JEOL MORADU|MORADU)") then goto JMORADU_GO
     if matchre("$UC_combatCritter", "(?i)(ADAN'F BLADEMASTER|BLADEMASTER|ADANF BLADE)") then goto BLADEMASTER_GO
     if matchre("$UC_combatCritter", "(?i)(ADAN'F SORCERER|ADANF SORCERER|SORCERER)") then goto ASORCERER_GO
     if matchre("$UC_combatCritter", "(?i)(^VOID MOTH$|BLACK UMBRAL MOTH$|BLACK UMBRAL MOTH 1|VOID MOTH 1|VOID BLACK MOTH$|VOID MOTH DIRGE|BLACK MOTH DIRGE|VOID BLACK MOTH 1|VOID BLACK UMBRAL MOTH 1|VOID BLACK UMBRAL MOTH DIRGE)") then goto VMOTH_GO
     if matchre("$UC_combatCritter", "(?i)(BLACK UMBRAL MOTH 2|VOID MOTH 2|VOID BLACK MOTH BOAR|VOID MOTH BOAR|VOID BLACK MOTH 2|BLACK MOTH BOAR|BLACK MOTH 2|VOID BLACK UMBRAL MOTH 2|VOID BLACK UMBRAL MOTH BOAR)") then goto VMOTH2_GO
     if matchre("$UC_combatCritter", "(?i)(SCAVENGER GIANT|SCAV GIANT|CROSS GIANT|GIANT CROSS)") then goto SCAVENGERGIANT_GO
     if matchre("$UC_combatCritter", "(?i)(SHADOWFROST MOTH|SHADOW MOTH|FROST MOTH|SHADOWFROST|SHADOW FROST)") then goto SHADOWMOTH_GO
     ### FLEX CRITTERS 0 - 2000+
     if matchre("$UC_combatCritter", "(?i)(MECHANICAL MOUSE|MECHANICAL MICE|MECH MICE|MECH MOUSE)") then goto MECHMOUSE_GO
     goto UNKNOWN_CRITTER
###### CROSSING INSIDE
RAT_GO:
	if (("$game" = "DRF") && ("$zoneid" != "1")) then goto FC_RAT_GO
     var FIGHTING.CRITTER Shipyard Rats
     var CRITTER.ROOMS 240|239|238|245|241|242|243|244|245|765|454|455|456|457|458
     ## if ($UC_Premium = 1) then var CRITTER.ROOMS 441|442|443|444|445|446|447|448|449|450|451|452|453|765|454|455|456|457|458
     #if ($UC_Premium = 1) then goto BLACKRAT_GO
     goto CROSSING_GO
FC_RAT_GO:
	var FIGHTING.CRITTER Shipyard Rats (FC)
	var CRITTER.ROOMS 162|163|164
	if ("$guild" = "Necromancer") then var CRITTER.ROOMS 164|162|163
	goto FANGCOVE_GO
SILVERFISH_GO:
     if ($UC_Premium = 1) then goto SILVERFISHPREM_GO
     var FIGHTING.CRITTER Silverfish {T1)
     var CRITTER.ROOMS 295|296|297|298|299|300|621
     goto CROSSING_GO
SILVERFISH2_GO:
     var FIGHTING.CRITTER Hardened Silverfish (T2)
     var CRITTER.ROOMS 622|633|634|623|624|625|626|627|631|632
     goto CROSSING_GO
SILVERFISH3_GO:
     var FIGHTING.CRITTER Elder Silverfish (T3)
     var CRITTER.ROOMS 628|629|630
     goto CROSSING_GO
CUTTHROAT_GO:
RUFFIAN_GO:
THUG_GO:
FOOTPAD_GO:
     if (matchre("$zoneid", "(65|66|67|68|69|116|127)") || matchre("$roomname", "Undershard")) then goto THUG2_GO
     var FIGHTING.CRITTER Thugs/Cutthroats/Footpads
     var LOG.ON.STUN OFF
     put #var UC_Log.on.Stun 0
     put #var UC_No.Contact 0
     action (PVPPLAYER) off
     var CRITTER.ROOMS 409|419|420|421|422|423|424|425
     goto CROSSING_GO
CROSSING_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|7|4)\b") then
          {
               send .travel CROSS
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "4") then gosub AUTOMOVE cross
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     pause 0.2
     if ("$zoneid" != "1") then goto CROSSING_GO
     if ("$zoneid" = "1") then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### CROSSING NORTH GATE
CROFFPOTHANIT_GO:
     var FIGHTING.CRITTER Croff Pothanits
     var CRITTER.ROOMS 41|42|43|44|45|46|47|48|49|50
     goto CROSSNORTH_GO
TROLLKIN_GO:
BADGER_GO:
     var FIGHTING.CRITTER Badgers / Trollkins
     var CRITTER.ROOMS 77|78|79|80|81|82|83|84|85|86|87|88|89|90|91|92
     goto CROSSNORTH_GO
DEATHSPIRITPREM_GO:
     var FIGHTING.CRITTER Pale Grey Death Spirits / Skunks (Premium)
     var CRITTER.ROOMS 142|140|141|147|148|149|155|156|157
     goto CROSSNORTH_GO
GRANITEGARGOYLEPREM_GO:
SKUNK_GO:
     var FIGHTING.CRITTER Granite Gargoyles (Premium)
     var CRITTER.ROOMS 117|118|119|120|121|122|123|124|125|126
     goto CROSSNORTH_GO
SCAVENGERGIANT_GO:
     var FIGHTING.CRITTER Scavenger Giants
     var CRITTER.ROOMS 70|71|72|73|74|75|76|77|78|292|299|300|301
     goto CROSSNORTH_GO
CROSSNORTH_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|7|6)\b") then
          {
               send .travel CROSS
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE N gate
     if ("$zoneid" = "7") then gosub AUTOMOVE N gate
     pause 0.2
     if ("$zoneid" != "6") then goto CROSSNORTH_GO
     if ("$zoneid" = "6") then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### VINEYARDS
BLACKRAT_GO:
SILVERFISHPREM_GO:
     var FIGHTING.CRITTER Black Rats / Silverfish (Premium)
     var CRITTER.ROOMS 5|6|7|8|9|10|11|12|13|14
     goto VINEYARDS_GO
ANIMATED_GO:
     var FIGHTING.CRITTER Animated Objects
     var CRITTER.ROOMS 70|73|74|75|76|77|78|79|80|81|82
     goto VINEYARDS_GO
WOODTROLLPREM_GO:
     var FIGHTING.CRITTER Wood Trolls (Premium)
     var CRITTER.ROOMS 30|31|32|33|34
     goto VINEYARDS_GO
GRENDALPREM_GO:
COUGARPREM_GO:
     var FIGHTING.CRITTER Cougars / Grendals (Premium)
     var CRITTER.ROOMS 25|26|27|28|29
     goto VINEYARDS_GO
MUSKHOGPREM_GO:
BOARPREM_GO:
WILDBOARPREM_GO:
     var FIGHTING.CRITTER Wild Boars / Musk Hogs (Premium)
     var CRITTER.ROOMS 16|17|18|19|20
     goto VINEYARDS_GO
BIRDCATCHER_GO:
TREESNAKE_GO:
     var FIGHTING.CRITTER Birdcatcher Spiders / Tree Snakes (Premium)
     var CRITTER.ROOMS 83|84|85|86|87|88|89|90|91|92
     goto VINEYARDS_GO
STORMGOOSE_GO:
STORMGANDER_GO:
     var FIGHTING.CRITTER Storm Geese / Ganders
     var CRITTER.ROOMS 47|48|49|50|52|53
     goto VINEYARDS_GO
ELDERRAZORTUSK_GO:
     var FIGHTING.CRITTER Elder Razortusk Boars / Sows
     var CRITTER.ROOMS 45|46|41|42|43|44
     goto VINEYARDS_GO
UNDEADGERBIL_GO:
     var FIGHTING.CRITTER Undead Gerbils
     var CRITTER.ROOMS 39|40|37|36|35|38
     goto VINEYARDS_GO
WATERSPRITEPREM_GO:
     var FIGHTING.CRITTER Greater Water Sprites (Premium)
     var CRITTER.ROOMS 54|55|56|57|58|59|60|61
     goto VINEYARDS_GO
###### CROSSING NTR AREA
SQUIRREL_GO:
     var FIGHTING.CRITTER Pale Grey Death Squirrels
     var CRITTER.ROOMS 518|519|520|521|522|523|524|525|526|527|528|529|530|531
     goto NTR_GO
ORIGAMI_GO:
     var FIGHTING.CRITTER Origami Creatures
     var CRITTER.ROOMS 257|258|259|260|261|262|263|264|265|266|788|789|790|791
     goto NTR_GO
GHOUL_GO:
     var FIGHTING.CRITTER Ghouls
     var CRITTER.ROOMS 420|421|422|423|424|425|426|427|428|429|430|431|432|433
     goto NTR_GO
GRENDAL_GO:
     if ($UC_Premium = 1) then goto GRENDALPREM_GO
     var FIGHTING.CRITTER Wood Trolls/Grendals/Wild Boar/Cougars
     var CRITTER.ROOMS 299|300|301|302|303|304|305|306|307|308|309|310|311
     goto NTR_GO
WINDHOUND_GO:
REAVER_GO:
     var FIGHTING.CRITTER Faenrae Reavers / Wind Hounds
     var CRITTER.ROOMS 768|767|766|756|719|720|721|722|723|724|725|726
     goto NTR_GO
ROCKTROLL_GO:
     var FIGHTING.CRITTER Rock Trolls T1
     var CRITTER.ROOMS 446|447|453|454|455|456|457|458|459|463|464|465|466|467|468
     goto NTR_GO
GIANTBEAR_GO:
     var FIGHTING.CRITTER Giant Bears
     var CRITTER.ROOMS 810|811|812|813
     goto NTR_GO
ONYXGARGOYLE_GO:
     var FIGHTING.CRITTER Onyx Gargoyles
     var CRITTER.ROOMS 814|815|816|817|818|819|820
     goto NTR_GO
YOUNGFIRECAT_GO:
FIREMAIDEN_GO:
IMMATUREFIRECAT_GO:
     var FIGHTING.CRITTER Fire Maidens / Fire Sprites
     var CRITTER.ROOMS 177|178|179|180|181|182|183|184
     goto NTR_GO
FIRESPRITE_GO:
     var FIGHTING.CRITTER Fire Sprites
     var CRITTER.ROOMS 151|152|153|154|155|156|157|158
     goto NTR_GO
CROCODILE_GO:
     if matchre("$zoneid","35") then goto CROCODILE2_GO
     if matchre("$zoneid","(66|67|68|69|112|114)") then goto CROCODILE3_GO
     var FIGHTING.CRITTER Blue Belly Crocodiles
     var CRITTER.ROOMS 8|9|10|11|12|18|19|34|40|47|51|52
     goto NTR_GO
WESTANURYN_GO:
ATIKET_GO:
     var FIGHTING.CRITTER Golden Scaled Atik'ets / Grey/Tan Westanuryn
     var CRITTER.ROOMS 220|221|222|223
     goto NTR_GO
MOTTLEDWESTANURYN_GO:
REDATIKET_GO:
ATIKET2_GO:
     if ("$zoneid" = "47") then goto MOTTLEDWESTANURYN2_GO
     var FIGHTING.CRITTER Red-Gold Scaled Atik'ets T1 / Mottled Westanuryn
     var CRITTER.ROOMS 228|229|230|231|232|233|234|235|236|237|238|239|240|241|242
     goto NTR_GO
MUSCULARFIRECAT_GO:
SUPPLEFIRECAT_GO:
REDATIKET2_GO:
ATIKET3_GO:
     var FIGHTING.CRITTER Red-Gold Scaled Atik'ets T2 / Supple Firecats
     var CRITTER.ROOMS 248
     gosub PVP_REMOVE
     goto NTR_GO
MECHMOUSE_GO:
     var FIGHTING.CRITTER Giant Mechanical Mice
     var CRITTER.ROOMS 801|802|803|804|805|806|807|808
     goto NTR_GO
NTR_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|7)\b") then
          {
               send .travel CROSS
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     pause 0.0001
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     pause 0.0001
     if ("$zoneid" != "7") then goto NTR_GO
     if matchre("%COMBAT.CRITTER", "(?i)(ATIKET|WESTANURYN|MOTTLED WEST|WESTIES|MOTTLEDWESTANURYN|SUPPLE FIRECAT|MUSCULAR FIRECAT|REDATIKET)") then goto USHNISH_GO
     if matchre("%COMBAT.CRITTER", "(?i)CROC") then
          {
               gosub AUTOMOVE 3
               pause 0.2
               put go reed
               goto COMBAT_LOCATION
          }
     if ("$zoneid" = "7") then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
VINEYARDS_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|7|7a)\b") then
          {
               send .travel CROSS
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     if ("$zoneid" = "7") then gosub AUTOMOVE vine
     pause 0.1
     if ("$zoneid" != "7a") then goto VINEYARDS_GO
     if ("$zoneid" = "7a") then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
#######################################################################
#### GATE OF SOULS AREA / TEMPLE OF USHNISH MAZE ZONES
USHNISH_GO:
     if matchre("$roomname", "Beyond the Gate of Souls") then gosub USHNISH_AT_ZONE1
     if matchre("$roomname", "Temple of Ushnish") then gosub USHNISH_AT_ZONE3
     if matchre("$roomname", "The Fangs of Ushnish") then gosub USHNISH_AT_ZONE4
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     if ("$zoneid" != "7") then goto USHNISH_GO
     pause 0.2
     gosub AUTOMOVE gate of soul
     pause 0.2
USHNISH_GO2:
     gosub stowing
     if ($invisible) then gosub STOP_INVIS
     pause 0.1
USHNISH_GO22:
     if ("$zoneid" = "1") then goto USHNISH_GO
     pause 0.1
     if ($roomid != 188) then gosub AUTOMOVE 188
     if contains("$roomobjs", "low tunnel") then goto USHNISH_GO3
     if ($standing = 0) then gosub STAND
     if contains("$roomobjs", "low tunnel") then goto USHNISH_GO3
     gosub RETREAT
     matchre USHNISH_GO3 ^At the bottom of the hollow\, a low tunnel is revealed
     matchre USHNISH_GO22 ^You stop pushing
     send push boulder
     matchwait 20
     goto USHNISH_GO2
USHNISH_GO3:
     gosub RETREAT
     if ("$zoneid" = "1") then goto USHNISH_GO
     if ($roomid != 188) then gosub AUTOMOVE 188
     if !contains("$roomobjs", "low tunnel") then goto USHNISH_GO2
     put fall
     wait
     pause 0.2
     pause 0.2
     if ($standing = 1) then put lie
     if !contains("$roomobjs", "low tunnel") then goto USHNISH_GO2
USHNISH_GO_3:
     pause 0.1
     matchre USHNISH_GO_3 ^Sorry
     matchre USHNISH_GO_ZONE1 ^Wriggling on your stomach\, you crawl into a low tunnel
     matchre USHNISH_GO3 ^It\'s a pretty tight fit
     send go tunnel
     matchwait 20
     goto USHNISH_GO3
#### TO BEYOND GATE OF SOULS - BLASTED PLAIN - MAZE AREA - ZONEID=0
USHNISH_GO_ZONE1:
     matchre USHNISH_GO_ZONE11 Coarse black grit blows in swirling eddies
     matchwait 90
USHNISH_GO_ZONE11:
     gosub STAND
     pause 0.2
     put go lava field
     pause 0.5
USHNISH_AT_ZONE1:
     if matchre("%COMBAT.CRITTER", "(?i)(RED-GOLD SCALED ATIKET|RED-SCALED ATIKET|RED ATIKET|REDATIKET|ATIKET2|ATIKET T2|ATIKET 2|ATIKET 3|ATIKET3|ATIKET T3|RED ATIKET2|RED ATIKET 2|RED ATIKET T2|AKITET T3|SUPPLE FIRECAT|MUSCULAR FIRECAT)") then goto USHNISH_GO_ZONE2
     # if ("$zoneid" = "7") then gosub AUTOMOVE %FirstRoom
     if ("$roomplayers" != "") then gosub RANDOMMOVE
     if ("$roomplayers" != "") then gosub RANDOMMOVE
     if ("$roomplayers" != "") then gosub RANDOMMOVE
     if ("$roomplayers" != "") then gosub RANDOMMOVE
     if ("$roomplayers" != "") then goto USHNISH_AT_ZONE1
     goto COMBAT_LOCATION
#### FROM BEYOND GATE OF SOULS (MAZE) TO TEMPLE OF USHNISH (MAPPED AREA)
USHNISH_GO_ZONE2:
     echo *** Attempting to find Sandstone Temple inside this damn Maze...
     pause 0.3
     if matchre("$roomobjs", "sandstone temple") then goto USHNISH_GO_ZONE3
     gosub RANDOMWEIGHT east
     if matchre("$roomobjs", "sandstone temple") then goto USHNISH_GO_ZONE3
     gosub RANDOMWEIGHT east
     if matchre("$roomobjs", "sandstone temple") then goto USHNISH_GO_ZONE3
     gosub RANDOMMOVE
     if matchre("$roomobjs", "sandstone temple") then goto USHNISH_GO_ZONE3
     gosub RANDOMMOVE
     if matchre("$roomobjs", "sandstone temple") then goto USHNISH_GO_ZONE3
     gosub RANDOMMOVE
     if matchre("$roomobjs", "sandstone temple") then goto USHNISH_GO_ZONE3
     gosub RANDOMMOVE
     if matchre("$roomobjs", "sandstone temple") then goto USHNISH_GO_ZONE3
     gosub RANDOMMOVE
     if matchre("$roomobjs", "sandstone temple") then goto USHNISH_GO_ZONE3
     gosub RANDOMMOVE
     if matchre("$roomobjs", "sandstone temple") then goto USHNISH_GO_ZONE3
     gosub RANDOMMOVE
     if matchre("$roomobjs", "sandstone temple") then goto USHNISH_GO_ZONE3
     gosub RANDOMMOVE_SOUTH
     if matchre("$roomobjs", "sandstone temple") then goto USHNISH_GO_ZONE3
     gosub RANDOMMOVE_SOUTH
     pause 0.1
     if matchre("$roomobjs", "sandstone temple") then goto USHNISH_GO_ZONE3
     goto USHNISH_GO_ZONE2
USHNISH_GO_ZONE3:
     echo ################################
     echo ** FOUND THE TEMPLE OF USHNISH!
     echo ################################
     pause 0.2
     pause 0.2
     send go temple
     pause 0.2
     pause 0.3
     pause 0.2
     put south
     pause 0.3
     pause 0.2
     put south
     pause 0.3
     pause 0.2
     pause 0.2
     put southeast
     pause 0.5
     pause 0.2
     put go door
     pause 0.5
USHNISH_AT_ZONE3:
     if matchre("%COMBAT.CRITTER", "(?i)(ATIKET T1|ATIKET 1|ATIKET1|WESTIES 1|WESTIES T1|WESTY 1|WESTANURYN 1|WESTANURYN T1)") then
          {
               gosub ESCAPE_TEMPLE
               goto USHNISH_AT_ZONE1
          }
     if matchre("%COMBAT.CRITTER", "(?i)(REDATIKET 2|REDATIKET2|RED ATIKET T2|ATIKET 3|ATIKET3|ATIKET T3|RED ATIKET2|RED ATIKET 2|RED ATIKET T2|SUPPLE FIRECAT|MUSCULAR FIRECAT)") then goto USHNISH_GO_ZONE4
     gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
#### THE FANGS OF USHNISH - SHIFTING MAZE AREA - ZONEID=0
USHNISH_GO_ZONE4:
     pause 0.1
     if matchre("$roomname", "The Fangs of Ushnish") then gosub USHNISH_AT_FANGS
     if matchre("$roomname", "Beyond the Gate of Souls") then goto USHNISH_AT_ZONE1
     if matchre("$roomname", "Temple of Ushnish") then gosub AUTOMOVE 247
     pause 0.2
     if ($roomid != 247) then goto USHNISH_GO_ZONE4
     gosub RETREAT
     send climb cliff
     pause 0.5
USHNISH_AT_ZONE4:
     pause 0.2
     if matchre("$roomname", "Temple of Ushnish") then goto USHNISH_GO_ZONE4
USHNISH_AT_FANGS:
     echo ########################
     echo ** AT FANGS OF USHNISH!
     echo ** ~SHIFTING MAZE~
     echo ########################
     if matchre("%COMBAT.CRITTER", "(?i)(ATIKET T1|ATIKET 1|ATIKET1|WESTIES 1|WESTIES|WESTY|WESTANURYN|RED-GOLD SCALED ATIKET|RED-SCALED ATIKET|RED ATIKET 1|REDATIKET T1|ATIKET2|ATIKET T2|ATIKET 2)") then
          {
               gosub ESCAPE_FANG
               goto USHNISH_AT_ZONE3
          }
     if ("$roomplayers" != "") then gosub RANDOMMOVE
     if ("$roomplayers" != "") then gosub RANDOMMOVE
     if ("$roomplayers" != "") then gosub RANDOMMOVE
     if ("$roomplayers" != "") then gosub RANDOMMOVE
     goto COMBAT_LOCATION
########## GATE OF SOULS ESCAPE FROM SPECIFIC SECTIONS
ESCAPE_FANG:
     echo ###########################################
     echo ** ESCAPING FANGS OF USHNISH - SHIFTING MAZE
     echo ###########################################
ESCAPE_FANG_1:
     pause 0.001
     if matchre("$roomname", "Temple of Ushnish") then return
     gosub RANDOMMOVE
     if matchre("$roomobjs", "steep cliff") then goto ESCAPE_TO_TEMPLE
     goto ESCAPE_FANG_1
ESCAPE_TO_TEMPLE:
     echo *** FOUND CLIFF! ESCAPING MAZE
     pause 0.1
     pause 0.1
     put climb cliff
     pause 0.5
     pause 0.2
     return
ESCAPE_TEMPLE:
     echo ############################
     echo ** ESCAPING TEMPLE OF USHNISH
     echo ############################
     pause 0.5
     if matchre("$roomname", "Temple of Ushnish") then gosub AUTOMOVE 224
     if matchre("$roomname", "Before the Temple of Ushnish") then goto ESCAPE_TO_MAZE
ESCAPE_TO_MAZE:
     pause 0.1
     put go lava field
     pause 0.5
     pause 0.2
     return
ESCAPE_MAZE_1:
     echo ##############################
     echo ** ESCAPING GATE OF SOULS MAZE
     echo ##############################
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "low cavern") then goto ESCAPE_GATEOFSOUL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "low cavern") then goto ESCAPE_GATEOFSOUL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "low cavern") then goto ESCAPE_GATEOFSOUL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "low cavern") then goto ESCAPE_GATEOFSOUL
     # gosub RANDOMWEIGHT east
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "low cavern") then goto ESCAPE_GATEOFSOUL
     gosub RANDOMNORTH
     if matchre("$roomobjs", "low cavern") then goto ESCAPE_GATEOFSOUL
     gosub RANDOMNORTH
     if matchre("$roomobjs", "low cavern") then goto ESCAPE_GATEOFSOUL
     gosub RANDOMNORTH
     if matchre("$roomobjs", "low cavern") then goto ESCAPE_GATEOFSOUL
     gosub RANDOMNORTH
     if matchre("$roomobjs", "low cavern") then goto ESCAPE_GATEOFSOUL
     goto ESCAPE_MAZE_1
ESCAPE_GATEOFSOUL:
     echo *** FOUND CAVERN!
     echo *** ESCAPING MAZE
     pause 0.2
     pause 0.1
     send go cavern
     wait
     pause 0.5
     pause 0.5
     send lie
     wait
     pause 0.2
     send go tunnel
     waitforre Rising in a snubbed tower|After a seemingly|Obvious
     pause 0.2
     gosub STAND
     gosub AUTOMOVE 104
     return
#### END GATE OF SOULS
###
#### START MISENSEOR ABBEY
CRYPTFIEND_GO:
     var FIGHTING.CRITTER Crypt Fiends
     var CRITTER.ROOMS 40|41|42|43|44|45
     goto ABBEY_GO
HAFWA_GO:
     var FIGHTING.CRITTER Snaer Hafwa
     var CRITTER.ROOMS 46|47|48|49|50|51
     goto ABBEY_GO
RESUSCITANT_GO:
     var FIGHTING.CRITTER Misenseor Resuscitants
     var CRITTER.ROOMS 22|23|24|25|27|28|29|30|31|33|34|35|36|37|38
     goto ABBEY_GO
ABBEY_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|7|12a)\b") then
          {
               send .travel CROSS
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     if ("$zoneid" = "7") then gosub AUTOMOVE misenseor
     pause 0.2
     gosub LIGHT_SOURCE
     gosub AUTOMOVE 10
     pause 0.1
     put turn sconce
     pause 0.5
     if ("$zoneid" = "12a") then gosub AUTOMOVE %FirstRoom
     if ("$zoneid" != "12a") then goto ABBEY_GO
     goto COMBAT_LOCATION
CAVEBEAR_GO:
     var FIGHTING.CRITTER Cave Bears
     var CRITTER.ROOMS 53|54|55|56|57|58|59
     goto STONECLAN_GO
BEISSWURM_GO:
     var FIGHTING.CRITTER Beisswurms
     var CRITTER.ROOMS 31|33|34|35|36|37
     goto STONECLAN_GO
WARKLIN_GO:
     var FIGHTING.CRITTER Armored Warklin
     var CRITTER.ROOMS 41|42|43|44|45|46|47
     goto STONECLAN_GO
STONECLAN_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" != "10") then
          {
               send .travel STONE
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     pause 0.2
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     pause 0.2
     if ("$zoneid" = "7") then gosub AUTOMOVE stone
     pause 0.5
     if ("$zoneid" = "7") then gosub AUTOMOVE stone
     if ("$zoneid" = "10") then gosub AUTOMOVE %FirstRoom
     if ("$zoneid" != "10") then goto STONECLAN_GO
     goto COMBAT_LOCATION
SLAISCOUT_GO:
     var FIGHTING.CRITTER S'lai Scouts
     var CRITTER.ROOMS 14|15|16|17|18|19|20|21|30|32|33|34|60|61|62|63|64|65|66
     goto SORROW_GO
COPPERVIPER_GO:
     var FIGHTING.CRITTER Copperhead Vipers
     var CRITTER.ROOMS 131|132|133|134|135
     goto SORROW_GO
BUCCA_GO:
     var FIGHTING.CRITTER Malodorous Buccas
     var CRITTER.ROOMS 124|125|126|127
     if ($UC_Premium = 1) then var CRITTER.ROOMS 137|138|139|124|125|126|127
     goto SORROW_GO
WIRDINEGO_GO:
     var FIGHTING.CRITTER Wir Dinego
     if matchre("$zoneid","99") then goto WIRDINEGO2_GO
     var CRITTER.ROOMS 86|87|88|89|90|91|92|93|94|95|96|97|98|99|100
     goto SORROW_GO
SORROW_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|7|9b)\b") then
          {
               send .travel CROSS
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     if ("$zoneid" = "7") then gosub AUTOMOVE 395
SORROW_SEARCH:
     if ("$zoneid" = "9b") then goto SORROW_SEARCH_2
     if ("$zoneid" = "10") then gosub AUTOMOVE NTR
     pause 0.3
     if (("$zoneid" = "7") && ($roomid != 395)) then gosub AUTOMOVE 395
     put search
     pause 0.4
     put look
     pause 0.4
     if !matchre("$roomobjs", "overgrown path") then goto SORROW_SEARCH
     pause 0.2
     if ("$zoneid" = "7") then gosub AUTOMOVE sorrow
     pause 0.2
     if ("$zoneid" = "7") then gosub AUTOMOVE sorrow
     pause 0.2
     if ("$zoneid" = "10") then goto SORROW_SEARCH
SORROW_SEARCH_2:
     if ("$zoneid" = "9b") then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
BLACKLEUCRO_GO:
     var FIGHTING.CRITTER Giant Black Leucros
     var CRITTER.ROOMS 11|12|13|14|15|16|17|18|19|20|21|22
     goto WILDERNESS_GO
THICKETVIPER_GO:
     var FIGHTING.CRITTER Giant Thicket Vipers
     var CRITTER.ROOMS 42|47|43|46|45|48|55|46
     goto WILDERNESS_GO
ROCKGUARDIAN_GO:
     var FIGHTING.CRITTER Rock Guardians
     var CRITTER.ROOMS 65|66|67|68|69|70|71|72|73|74|75|76|77|78
     goto WILDERNESS_GO
GENI_GO:
     var FIGHTING.CRITTER Forest Genis
     var CRITTER.ROOMS 120|121|122|123|124|125|126|127|128|129|130|131|132|133|134|135|136|137|138|139
     goto WILDERNESS_GO
WILDERNESS_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|7|11)\b") then
          {
               send .travel CROSS
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     pause 0.2
     if ("$zoneid" = "7") then gosub AUTOMOVE leucros
     pause 0.2
     if ("$zoneid" = "7") then gosub AUTOMOVE leucros
     pause 0.3
     if ("$zoneid" = "7") then gosub AUTOMOVE leucros
     pause 0.3
     if ("$zoneid" = "7") then gosub AUTOMOVE leucros
     pause 0.3
     if ("$zoneid" = "11") then gosub AUTOMOVE %FirstRoom
     if ("$zoneid" != "11") then goto WILDERNESS_GO
     if ("$roomid" = "5") then
          {
               gosub AUTOMOVE 11
               gosub AUTOMOVE %FirstRoom
          }
     goto COMBAT_LOCATION
###### CROSSING EAST GATE
LOUT_GO:
     var FIGHTING.CRITTER Sleazy Louts
     var CRITTER.ROOMS 3|4|5|6|7|8|9|10|11|12
     gosub PVP_REMOVE
     goto XINGEAST_GO
CONSCRIPT_GO:
     var FIGHTING.CRITTER Revenant Conscripts
     var CRITTER.ROOMS 104|105|106|107
     goto XINGEAST_GO
XINGEAST_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|8a|8)\b") then
          {
               send .travel CROSS
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "8a") then gosub AUTOMOVE cross
     if ("$zoneid" = "1") then gosub AUTOMOVE e gate
     if ("$zoneid" != "8") then goto XINGEAST_GO
     if (("$zoneid" = "8") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     pause 0.2
     goto COMBAT_LOCATION
DEATHSPIRIT_GO:
     if matchre("$zoneid", "\b(([1-5]([0-9])?[a-z]?)|[6-9][a-z]?)\b") && ($UC_Premium = 1) then goto DEATHSPIRITPREM_GO
     if matchre("$zoneid", "\b(60|61|67|68|69|114|116|127)\b") then goto DEATHSPIRIT2_GO
     if matchre("$zoneid", "\b(30|30a|32|33|34|42|47)\b") then goto DEATHSPIRIT3_GO
     var FIGHTING.CRITTER Pale Grey Death Spirits
     var CRITTER.ROOMS 30|31|32|33|34|35|36|37|38|39|40|41|42|43|44|45|46|47|48|49|50|51|52|53|54|55|56|57
     goto LOSTCROSS_GO
LOSTCROSS_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|8|8a)\b") then
          {
               send .travel CROSS
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE e gate
     if ("$zoneid" = "8") then gosub AUTOMOVE lost
     pause 0.2
     if ("$zoneid" != "8a") then goto LOSTCROSS_GO
     if (("$zoneid" = "8a") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### CROSSING WEST GATE
MUSKHOG_GO:
     if ($UC_Premium = 1) then goto MUSKHOGPREM_GO
     var FIGHTING.CRITTER Musk Hogs
     var CRITTER.ROOMS 44|45|46|47|48|73|74|75|76
     goto XINGWEST_GO
INKHORNE_GO:
DEER_GO:
     var FIGHTING.CRITTER Deer / Inkhorne / Wild Boar
     var CRITTER.ROOMS 143|144|145|146|147|148|149|150|151|152|153|154|155|156|157|158|159|160|161|162|163|164|165|166|167|168
     goto XINGWEST_GO
SILVERBEAR_GO:
     var FIGHTING.CRITTER Silver Backed Bears / Blood Wolves
     var CRITTER.ROOMS 305|306|307|308|319|325
     goto XINGWEST_GO
COUGAR_GO:
     if ($UC_Premium = 1) then goto COUGARPREM_GO
     var CRITTER.ROOMS 101|106|107|108|109
     goto XINGWEST_GO
BOBCAT_GO:
JACKAL_GO:
     var FIGHTING.CRITTER Bobcats / Jackals / Cougars
     var CRITTER.ROOMS 365|366|367|368|369|370|371|372|373|374|375|376|377|378
     goto XINGWEST_GO
LARGEBROWNSPIDER_GO:
     var FIGHTING.CRITTER Large Brown Spiders
     var CRITTER.ROOMS 37|38|39|40|41|42
     goto XINGWEST_GO
BROWNBURROWER_GO:
     var FIGHTING.CRITTER Brown Burrowers / Corpse Grubs
     var CRITTER.ROOMS 175|176|177|178|179|180|181|182|183|184|185|186|187|188
     goto XINGWEST_GO
CORPSEGRUB_GO:
GOBLINZOMBIE_GO:
     var FIGHTING.CRITTER Goblin Zombies / Corpse Grubs
     var CRITTER.ROOMS 208|209|210|211|212|213|214|215|216|217|218|219
     goto XINGWEST_GO
WILDBOAR_GO:
     if ($UC_Premium = 1) then goto WILDBOARPREM_GO
     var FIGHTING.CRITTER Wild Boar / Deer
     var CRITTER.ROOMS 145|146|147|148|149|150|151|152|153|154|155|156|157|158|159|160
     goto XINGWEST_GO
FORAGERGOBLIN_GO:
LARGEMUSKHOG_GO:
     var FIGHTING.CRITTER Forager Goblins / Large Musk Hogs
     var CRITTER.ROOMS 50|51|52|53|54|68|69|70|71|72
     goto XINGWEST_GO
GRASSEEL_GO:
     var FIGHTING.CRITTER Grass Eels
     var CRITTER.ROOMS 228|229|230|231|232|233
     goto XINGWEST_GO
GIANTWASP_GO:
     var FIGHTING.CRITTER Giant Wasps
     var CRITTER.ROOMS 24|25|26|27|28|29|30|31|32
     goto XINGWEST_GO
SCAVENGERGOBLIN_GO:
FELLHOG_GO:
     var FIGHTING.CRITTER Scavenger Goblins / Fell Hogs
     var CRITTER.ROOMS 55|56|57|58|59|60|61|62|65|66
     goto XINGWEST_GO
FIELDGOBLIN_GO:
GOBLINSHAMAN_GO:
     var FIGHTING.CRITTER Goblin Shaman / Field Goblins
     var CRITTER.ROOMS 256|248|249|251|252|254|255
     goto XINGWEST_GO
BLOODWOLF_GO:
     if matchre("$zoneid", "\b(90|90a|90d|90f|92|95|98|98a|99|99a|106|107|107a|108)\b") then goto BLOODWOLFAESRY_GO
     var FIGHTING.CRITTER Blood Wolves T1
     var CRITTER.ROOMS 301|302|303
     goto XINGWEST_GO
SCOUTOGRE_GO:
     if matchre("$zoneid","\b(104|105|106|107|108|109|110|111|138)\b") then goto SCOUTOGRE2_GO
     var FIGHTING.CRITTER Scout Ogres
     var CRITTER.ROOMS 328|329|330|331
     goto XINGWEST_GO
YOUNGOGRE_GO:
     if matchre("$zoneid","\b(104|105|106|107|108|109|110|111|138)\b") then goto YOUNGOGRE2_GO
     var FIGHTING.CRITTER Scout Ogres
     var CRITTER.ROOMS 336|337|338|339|340
     goto XINGWEST_GO
DIREBEAR_GO:
     var FIGHTING.CRITTER Dire Bears / Blood Wolves
     var CRITTER.ROOMS 314|315|316|324
     goto XINGWEST_GO
XMAGUS_GO:
XTHRALL_GO:
XALASHAR_T1:
     var FIGHTING.CRITTER Xalashar Thralls / Magus
     var CRITTER.ROOMS 482|483|484|485|486|487|488
     goto XINGWEST_GO
XCONJURER_GO:
XVANQUISHER_GO:
XALASHAR_T2:
     var FIGHTING.CRITTER Xalashar Vanquishers / Conjurers
     var CRITTER.ROOMS 489|490|491|492|493|494|495|496
     goto XINGWEST_GO
XSLAYER_GO:
XARCHIMAGE_GO:
XVINDICATOR_GO:
XALASHAR_T3:
     var FIGHTING.CRITTER Xalashar Slayer / Archimage / Vindicator
     var CRITTER.ROOMS 497|498|499|500|501|502|503
     goto XINGWEST_GO
XARCHER_GO:
XOVERSEER_GO:
XSHREDDER_GO:
XALASHAR_T4:
     var FIGHTING.CRITTER Xalashar Shredder / Overseer / Archer
     var CRITTER.ROOMS 507|508|509|510|511|512
XINGWEST_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|2|4|6|7)\b") then
          {
               send .travel CROSS
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     if ("$zoneid" = "6") then gosub AUTOMOVE W gate
     if ("$zoneid" = "1") then gosub AUTOMOVE W gate
     if ("$zoneid" = "1") then gosub AUTOMOVE W gate
     if ("$zoneid" = "1") then gosub AUTOMOVE W gate
     if ("$zoneid" = "2") then gosub AUTOMOVE 2
     pause 0.2
     if ("$zoneid" != "4") then goto XINGWEST_GO
     if (("$zoneid" = "4") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
DARKSPIRIT_GO:
     var FIGHTING.CRITTER Dark Spirits
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if matchre("$zoneid", "\b(41|40|42)\b") then goto DARKSPIRIT2_GO
     if matchre("$zoneid", "\b(90|92|95)\b") then goto DARKSPIRIT3_GO
     var CRITTER.ROOMS 61|62|63|64|65|66|67|68|69|70|71|72
     goto TIGERCLAN_GO
TIGERCLAN_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|2|4|4a|6|7)\b") then
          {
               send .travel CROSS
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "7") then gosub AUTOMOVE cross
     if ("$zoneid" = "6") then gosub AUTOMOVE W gate
     if ("$zoneid" = "1") then gosub AUTOMOVE W gate
     if ("$zoneid" = "2") then gosub AUTOMOVE 2
     if ("$zoneid" = "4") then gosub AUTOMOVE tiger
     pause 0.2
     if ("$zoneid" != "4a") then goto TIGERCLAN_GO
     if (("$zoneid" = "4a") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
WATERSPRITE_GO:
LIPOPOD_GO:
     var FIGHTING.CRITTER Water Sprites / Lipopods
     var CRITTER.ROOMS 7|8|9|10|11|12|13|14|15|16|17|18|19
     goto LAKEOFDREAM_GO
GIDI_GO:
     var FIGHTING.CRITTER Ring-Necked Gidis
     var CRITTER.ROOMS 38|39|40|41|42|43|44|45|46
     goto LAKEOFDREAM_GO
WOODTROLL_GO:
     if matchre("$zoneid","(40|42|34|40a)") then goto WOODTROLLLANG_GO
     if ($UC_Premium = 1) then goto WOODTROLLPREM_GO
     var FIGHTING.CRITTER Wood Trolls
     var CRITTER.ROOMS 48|49|50|51|52|53|54|55|56
     goto LAKEOFDREAM_GO
LAKEOFDREAM_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|2|4)\b") then
          {
               send .travel CROSS
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE w gate
     if ("$zoneid" = "4") then gosub AUTOMOVE lake
     pause 0.2
     if ("$zoneid" != "2") then goto LAKEOFDREAM_GO
     if (("$zoneid" = "2") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### DIRGE
CAVETROLL2_GO:
     if matchre("$zoneid","\b(112|114|116|127|69|68|67|65|61)\b") then goto CAVETROLL_GO
     if ($Athletics_Ranks < 180) then goto NO_CAVETROLL
     var FIGHTING.CRITTER Cave Trolls (Dirge)
     var CRITTER.ROOMS 150|151|152|153
     goto DIRGE_GO
SKELETON_GO:
     var FIGHTING.CRITTER Lesser Skeletons
     var CRITTER.ROOMS 95|96|97|98|99|100|101|102|103|104|105|106
     goto DIRGE_GO
MADMEN_GO:
     var FIGHTING.CRITTER Crazed Madmen
     var CRITTER.ROOMS 22|23|24|25|26|27|20|21|162
     goto DIRGE_GO
SCAVENGERTROLL_GO:
     var FIGHTING.CRITTER Scavenger Trolls
     var CRITTER.ROOMS 75|76|77|78|79|80|81|82
     goto DIRGE_GO
LAVADRAKE_GO:
     var FIGHTING.CRITTER Lava Drakes
     var CRITTER.ROOMS 189|190|191|192|193|194|195
     if ($UC_Premium = 1) then var CRITTER.ROOMS 300|301|302|303|304|305|189|190|191|192|193|194|195
     goto DIRGE_GO
UMOTH_GO:
     var FIGHTING.CRITTER Umbral Moths (T1)
     var CRITTER.ROOMS 213|214|215|216|217|218|219
     goto DIRGE_GO
FMOTH_GO:
     if matchre("$zoneid", "\b(66|67|69|116|124|127)\b") then goto FMOTH2_GO
     var FIGHTING.CRITTER Fuligin Umbral Moths (T2)
     var CRITTER.ROOMS 213|214|215|216|217|218|219
     goto DIRGE_GO
VMOTH_GO:
     if matchre("$zoneid", "\b(66|67|69|116|124|127)\b") then goto VMOTH2_GO
     var FIGHTING.CRITTER Void Black Umbral Moths (T3)
     var CRITTER.ROOMS 221|222|223|224|225|226|220
     goto DIRGE_GO
CABALIST_GO:
     var FIGHTING.CRITTER Arthelun Cabalists
     var CRITTER.ROOMS 196|197|198|199|200|201|202|306|307|308
     goto DIRGE_GO
DIRGE_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(1|7|13)\b") then
          {
               send .travel dirge
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "1") then gosub AUTOMOVE NTR
     pause 0.3
     if ("$zoneid" = "7") then gosub AUTOMOVE dirge
     pause 0.3
     if ("$zoneid" = "7") then gosub AUTOMOVE dirge
     pause 0.5
     put look
     pause 0.5
     if ("$zoneid" = "7") then gosub AUTOMOVE dirge
     if ("$zoneid" != "13") then goto DIRGE_GO
     put east
     wait
     pause 0.5
     gosub LIGHT_SOURCE
     echo MOVING TO: %FirstRoom
     if (("$zoneid" = "13") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### RIVERHAVEN AREA
SALTCRAB_GO:
     var FIGHTING.CRITTER Salt Crabs
     var CRITTER.ROOMS 77|78|79|80|339|81|83
     goto HAVEN_GO
HAVEN_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(30|30a)\b") then
          {
               send .travel HAVEN
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "30a") then gosub AUTOMOVE riverhaven
     pause 0.2
     if ("$zoneid" != "30") then goto HAVEN_GO
     if (("$zoneid" = "30") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
DARKSPRITE_GO:
     var FIGHTING.CRITTER Dark Sprites
     var CRITTER.ROOMS 82|83|84|85|86|87|88|89|90|91|92|93|94
     goto HAVENNORTH_GO
ZOMBIEGOBLIN_GO:
     var FIGHTING.CRITTER Zombie Goblins
     var CRITTER.ROOMS 37|38|39|40|41|42|43
     goto HAVENNORTH_GO
WILDLANDGOBLIN_GO:
     var FIGHTING.CRITTER Wildland Goblins
     var CRITTER.ROOMS 6|7|8|9|10|11|12|25|26|27|28|29|30
     goto HAVENNORTH_GO
HAVENNORTH_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(30|32)\b") then
          {
               send .travel HAVEN
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "30") then gosub AUTOMOVE N gate
     pause 0.2
     if ("$zoneid" != "32") then goto HAVENNORTH_GO
     if (("$zoneid" = "32") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
TORTUREDSOUL_GO:
     var FIGHTING.CRITTER Tortured Souls
     var CRITTER.ROOMS 38|39|40|41|42|43|44|45
     goto DUNSHADE_GO
DARKFIEND_GO:
     var FIGHTING.CRITTER Dark Fiends
     var CRITTER.ROOMS 46|47|48|49|50|51|52|53|54
     goto DUNSHADE_GO
DEATHSPIRIT3_GO:
     var FIGHTING.CRITTER Pale Grey Death Spirits / Dark Fiends
     var CRITTER.ROOMS 21|22|23|24|25|26|27|28
     goto DUNSHADE_GO
DUNSHADE_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(30|30a)\b") then
          {
               send .travel HAVEN
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "30") then gosub AUTOMOVE dunshade
     pause 0.2
     if ("$zoneid" != "30a") then goto DUNSHADE_GO
     if (("$zoneid" = "30a") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
CRAYFISH_GO:
     var FIGHTING.CRITTER Crayfish
     var CRITTER.ROOMS 78|79|80|81|82|83|84|85|86|87|88
     goto HAVENWEST_GO
YOUNGOGRE2_GO:
SCOUTOGRE2_GO:
     var FIGHTING.CRITTER Young Ogres / Scout Ogres
     var CRITTER.ROOMS 103|104|105|106|107|108|109|110|111
     goto HAVENWEST_GO
ARBELOG_GO:
MEADOWRAM_GO:
BLACKBEAR_GO:
     var FIGHTING.CRITTER Arbelogs / Meadow Rams / Black Bears
     var CRITTER.ROOMS 95|96|97|98|99|100|101|102|136|137|74|75|76
     goto HAVENWEST_GO
GOBLINSHAMAN2_GO:
GRASSEEL2_GO:
     var FIGHTING.CRITTER Goblin Shaman / Grass Eels
     var CRITTER.ROOMS 30|31|32|33|34|35|36|37|38|39|40
     goto HAVENWEST_GO
WOLFSPIDER_GO:
DUSKOGRE_GO:
     var FIGHTING.CRITTER Wolf Spiders / Dusk Ogres
     var CRITTER.ROOMS 52|53|54|55|56|57|58|59|60|61|62|63|64|65|66|67|68
     goto HAVENWEST_GO
HAVENWEST_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(30|33a|33)\b") then
          {
               send .travel HAVEN
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" = "33a") then gosub AUTOMOVE riverhaven
     if ("$zoneid" = "30") then gosub AUTOMOVE w gate
     pause 0.2
     if ("$zoneid" != "33") then goto HAVENWEST_GO
     if (("$zoneid" = "33") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
NIGHTREAVERUNYN_GO:
     if matchre("$zoneid", "\b(90|90a|90d|90f|92|95|98|98a|99|99a|106|107|107a|108)\b") then goto NIGHTREAVERUNYN2_GO
NIGHTWEAVERUNYN_GO:
     if matchre("$zoneid", "\b(90|90a|90d|90f|92|95|98|98a|99|99a|106|107|107a|108)\b") then goto NIGHTWEAVERUNYN2_GO
     var FIGHTING.CRITTER Nightreaver/Nightweaver Unyn
     var CRITTER.ROOMS 2|3|4|5|6|7|8|9
     goto ROADTHEREN_GO
BARGHEST_GO:
     var FIGHTING.CRITTER Barghest
     var CRITTER.ROOMS 32|33|34|35|36|37|38|39|40|41|42|43|44|45
     goto ROADTHEREN_GO
ROADTHEREN_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(30|33a|33)\b") then
          {
               send .travel HAVEN
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" = "30") then gosub AUTOMOVE w gate
     if ("$zoneid" = "33") then gosub AUTOMOVE rossman
     if ("$zoneid" != "33a") then goto ROADTHEREN_GO
     if (("$zoneid" = "33a") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
FROG_GO:
     var FIGHTING.CRITTER Heggarangi Frogs
     var CRITTER.ROOMS 41|42|43|44|45|46
     goto HAVENEAST_GO
BOOBRIE_GO:
     var FIGHTING.CRITTER Boobries / Boars
     var CRITTER.ROOMS 11|12|13|14|15|16|17|18
     goto HAVENEAST_GO
PIRUATISERPENT_GO:
     var FIGHTING.CRITTER Piruati Serpents
     var CRITTER.ROOMS 51|52|53|54|55|56|57|58
     goto HAVENEAST_GO
DYRACHIS_GO:
LESSERSLUAGH_GO:
     var FIGHTING.CRITTER Spiny Dyrachis / Lesser Sluagh
     var CRITTER.ROOMS 30|31|32|85|86|87|88|89|90|91|92
     goto HAVENEAST_GO
SWAMPTROLL_GO:
LESSERSLUAGH2_GO:
     var FIGHTING.CRITTER Swamp Trolls T1 / Lesser Sluagh T2
     var CRITTER.ROOMS 39|111|110|109|108|81|80|82|83|84
     goto HAVENEAST_GO
LESSERSLUAGH3_GO:
LESSERSHADOWHOUND_GO:
     var FIGHTING.CRITTER Lesser Shadow Hounds / Lesser Sluagh T3
     var CRITTER.ROOMS 96|97|98|99
     goto HAVENEAST_GO
UNYN_GO:
     if matchre("$zoneid","\b(98a|98|99)\b") then goto UNYN2_GO
RHOATMODA_GO:
     var FIGHTING.CRITTER Nightstalker Unyn / Rhoat Moda
     var CRITTER.ROOMS 135|136|137|138|139|140|141|142|143|144|145|146|147|148|149|150|151|152|153|154
     goto HAVENEAST_GO
FORAGERGHOUL_GO:
     var FIGHTING.CRITTER Forager Ghouls
     var CRITTER.ROOMS 165|166|167|168|169|170|171|172|173|174|175|176|189|190|191
     goto HAVENEAST_GO
FORAGERWIGHT_GO:
     var FIGHTING.CRITTER Forager Wights
     var CRITTER.ROOMS 192|193|194|195|196|197|198|199|200
     goto HAVENEAST_GO
HAVENEAST_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(30|31)\b") then
          {
               send .travel HAVEN
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" = "30") then gosub AUTOMOVE e gate
     if ("$zoneid" != "31") then goto HAVENEAST_GO
     if (("$zoneid" = "31") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
GREATERSHADOWHOUND_GO:
GREATERSLUAGH_GO:
     var FIGHTING.CRITTER Greater Sluaghs / Greater Shadow Hounds
     var CRITTER.ROOMS 4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25
     goto ZAULFUNG_GO
ZAULFUNG_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(30|31a|31b|31)\b") then
          {
               send .travel HAVEN
               waitforre ^YOU ARRIVED\!
          }
     if (("$guild" = "Cleric") && matchre("%abbrevs", "(?i)PFE")) then
          {
               echo
               echo **** CASTING PFE BEFORE GOING INTO ZAULFUNG
               echo
               gosub PREPARE PFE 15
               pause 13
               put cast;gesture
               pause 0.5
               pause 0.5
          }
     if ("$zoneid" = "31b") then goto MAELSHYVE_GO
     pause 0.2
     if ("$zoneid" = "30") then gosub AUTOMOVE e gate
     if ("$zoneid" = "31") then gosub AUTOMOVE 89
     if ("$zoneid" = "31") then send go path
     pause 0.4
     pause 0.4
     if ("$zoneid" = "31a") then goto ZAULFUNG_REAL_2
     if ("$zoneid" = "31b") then goto MAELSHYVE_GO
ZAULFUNG_MAZE:
     if !$standing then put stand
     echo *** Navigating Zaulfung Maze - Looking for Sickly Tree
     if (("$zoneid" = "31") && ("$roomid" != "0")) then
          {
               gosub AUTOMOVE 89
               send go path
               pause 0.5
          }
     pause 0.3
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMWEIGHT east
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMSOUTH
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMSOUTH
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     put look
     pause 0.2
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMNORTH
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMNORTH
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMNORTH
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMNORTH
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     put look
     pause 0.3
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
     gosub RANDOMMOVE_CARDINAL
     if matchre("$roomobjs", "sickly tree ") then goto ZAULFUNG_REAL
########"
     gosub RANDOMMOVE_CARDINAL
     goto ZAULFUNG_MAZE
ZAULFUNG_REAL:
     gosub MOVE climb tree
ZAULFUNG_REAL_2:
     if matchre("%COMBAT.CRITTER", "(?i)(HIEROPHANT|HEIROPHANT|SHADOW BEAST|MAELSHYVIAN|MAELSHYVEAN|CINDER BEAST|CINDERBEAST|BASILISK|BASILISK)") then goto ZAULFUNG2_GO
     if (("$zoneid" = "31a") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
ZAULFUNG2_GO:
     action goto ZAULFUNG3_GO when ^After slowing considerably, your captor comes to an abrupt halt and the enormous clawed fingers open
     if ("$zoneid" = "31b") then goto ZAULFUNG3_GO
     if matchre("$roomname", "Gargantuan Skeletal Claw") then goto ZALFUNG_CLAW_WAIT
     gosub AUTOMOVE 109
     pause 0.1
     if ("$roomid" != "109") then goto ZAULFUNG2_GO
     pause 0.1
     pause 0.5
     send touch altar
     pause 0.5
     pause 0.1
     send touch altar
     pause 0.5
     pause 0.2
     send pray
     pause 0.5
     pause 0.2
     send pray
     pause 0.5
     pause 0.2
     send pray
     pause 0.5
     pause 0.2
     send pray
     pause 0.5
     pause 0.2
     send pray
     pause 0.5
     pause 0.2
#### Waiting for Claw to Drag us into Maelshyve
ZALFUNG_CLAW_WAIT:
     echo *** Waiting for the Claw
     matchre ZAULFUNG3_GO ^The murky waters end
     matchwait 85
     if ("$zoneid" = "31b") then goto ZAULFUNG3_GO
     goto ZAULFUNG2_GO
ZAULFUNG3_GO:
     action remove ^After slowing considerably, your captor comes to an abrupt halt and the enormous clawed fingers open
     pause 0.1
     pause 0.1
     gosub STAND
     pause 0.1
     pause 0.1
     gosub move SE
     pause 0.1
     gosub move go crack
     pause 0.1
     if ("$roomid" = "0") then gosub RANDOMMOVE
     pause 0.1
     if (("$zoneid" = "31b") && matchre("%COMBAT.CRITTER", "HIEROPHANT|HEIROPHANT")) then goto MAELSHYVE_GO
     if (("$zoneid" = "31b") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### MAELSHYVE'S FORTRESS
BASILISK_GO:
SHADOWBEAST_GO:
     var FIGHTING.CRITTER Maelshyvean Shadow Beasts
     var CRITTER.ROOMS 25|26|27|28|29|30|31|32|33|34|35|36|37|38|39|40
     goto ZAULFUNG_GO
CINDERBEAST_GO:
     var FIGHTING.CRITTER Maelshyvean Cinder Beasts
     var CRITTER.ROOMS 50|51|52|53|54|55|56|57|58|59|60
     goto ZAULFUNG_GO
HEIROPHANT_GO:
     var FIGHTING.CRITTER Sinister Maelshyvean Heirophants
     var CRITTER.ROOMS 109|110|111|112|120|113|114|115
     goto ZAULFUNG_GO
MAELSHYVE_GO:
MAELSHYVE:
     if (("$zoneid" = "31b") && matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then goto COMBAT_LOCATION
     if (("$zoneid" = "31b") && matchre("$roomid", "(74|75|76|77|78|79|80)")) then goto AT_OBELISK
     if (("$zoneid" = "31b") && matchre("$roomid", "(82|83|84|85|86|87|88|89|90|91|92|93|94|95|96|97)")) then goto MAELSHYVE_GO_2
     if ("$zoneid" = "31b") then gosub AUTOMOVE 67
     if (("$zoneid" = "31b") && ("$roomid" != "67")) then gosub AUTOMOVE 67
#### NAVIGATING THE ROPE BRIDGE
ROPE_BRIDGE:
     pause 0.2
     echo
     echo *** Navigating the Rope Bridge to Maelshyve's Fortress
     echo
     if ("$roomid" = "67") then
          {
               put go rope bridge
               pause 5
               pause
               if ($stunned) then waiteval (!$stunned)
          }
     pause 0.1
     if matchre("$roomname", "Murky Caverns") then
          {
               echo
               echo ########################
               echo ** SHIT! We fell off the rope? 
               echo ** Resetting..
               echo ########################
               echo
               pause
               goto ZAULFUNG2_GO
          }
     if matchre("$roomname", "Beneath The Zaulfung, Charred Caverns") then goto MAELSHYVE_GO
     if matchre("$roomname", "Rope Bridge") then
          {
               pause 0.3
               send shuffle east
               pause 5
               pause
               if ($stunned) then waiteval (!$stunned)
               goto ROPE_BRIDGE
          }
     if ("$roomid" = "74") then
          {
               gosub MOVE east
               goto AT_OBELISK
          }
     goto ROPE_BRIDGE
AT_OBELISK:
     if (("$zoneid" = "31b") && ("$roomid" != "80")) then gosub AUTOMOVE 80
     if ("$roomid" = "80") then
          {
          if ($north) then
               {
                    gosub MOVE north
                    goto MAELSHYVE_GO_2
               }
          }
     if (("$zoneid" = "31b") && ("$roomid" != "77")) then gosub AUTOMOVE 77
     if ($north) then
          {
               gosub MOVE north
               goto MAELSHYVE_GO_2
          }
	action (orb) var orb %orb|black when ^Veils of shadows flicker erratically over your field of vision briefly\.
	action (orb) var orb %orb|blue when ^An intense shock of cold chills your veins as an icy, glacial glow pulses deep within the obsidian obelisk\.
     action (orb) var orb %orb|red when ^A fiery flash washes through the depths of the obsidian obelisk as an intense warmth meets your touch\.
	var orb
	action (orb) on
	pause 0.2
	gosub touch
     pause 0.2
	var maelshyveloop 1
	gosub orbs
	if matchre("$roomdesc", "^Carved into the face") then
          {
               move east
               move north
		}
	if matchre("$roomdesc", "^A small pile of corse") then
		{
               move west
               move north
		}
	if matchre("$roomdesc", "^A pile of rubble is strewn") then
		{
               move north
		}
     action (orbs) off
MAELSHYVE_GO_2:
     if ($north) then
     {
          gosub MOVE north
          goto MAELSHYVE_GO_3
     }
     gosub MOVE northwest
     pause 0.1
	gosub AUTOMOVE 92
     pause 0.01
	put pull arm
     pause 0.5
     pause 0.5
     if ($stunned) then waiteval (!$stunned)
	gosub AUTOMOVE 82
     gosub MOVE northeast
     pause 0.1
     gosub AUTOMOVE 87
	put pull tail
     pause 0.5
     pause 0.5
     if ($stunned) then waiteval (!$stunned)
MAELSHYVE_GO_3:
	gosub AUTOMOVE 108
	if $north then move n
	else gosub circle
	put n
     pause 0.5
     goto COMBAT_LOCATION
CIRCLE:
     pause 0.2
	put stand circle
	match RETURN As the lights within the circle fade and die, you step out
	matchwait 40
     goto CIRCLE
     
TOUCH_PAUSE:
echo *** Pausing....
pause 8  
TOUCH:
     pause 0.1
     pause 0.2
	matchre TOUCH \.\.\.wait
     matchre TOUCH_PAUSE ^Your fingers tingle, but nothing else happens\.
     matchre RETURN ^A tingling sensation spreads through your body
	put touch obelisk
	matchwait 4
	goto touch
ORBS:
     echo
     echo *** ORB ORDER: %orb
	echo
     pause 0.2
     if (%maelshyveloop > 3) then return
	gosub AUTOMOVE %orb(%maelshyveloop)
     pause 0.1
     pause 0.01
	put touch statue
	pause 1
	pause 1
     if ($stunned) then waiteval (!$stunned)
	math maelshyveloop add 1
	goto orbs

###### MISTWOOD
BRISTLEPECCARY_GO:
     var FIGHTING.CRITTER Bristleback Peccaries
     var CRITTER.ROOMS 59|60|61|62|47|48|49|50|51|52|53|54|55|56|57|58
     goto ROSSMAN_GO
ROSSMAN_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ($zoneid != 34a) then
          {
               if ($Athletics.Ranks < 200) then gosub ARMOR_REMOVE
               send .travel ROSSMAN
               waitforre ^YOU ARRIVED\!
               if ($Athletics.Ranks < 200) then gosub WEAR_ARMOR
          }
     pause 0.2
     if ("$zoneid" != "34a") then goto ROSSMAN_GO
     if (("$zoneid" = "34a") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
BABYGRYPHON_GO:
     if matchre("$zoneid", "\b(60|61|62|65|66|67|68|69|116|126|127|150)\b") then goto BABYGRYPHON2_GO
     var FIGHTING.CRITTER Baby / Fledgling Forest Gryphons (Rossmans)
     var CRITTER.ROOMS 90|91|92
     goto MISTWOOD_GO
YOUNGGRYPHON_GO:
     if matchre("$zoneid", "\b(60|61|62|65|66|67|68|69|116|126|127|150)\b") then goto YOUNGGRYPHON2_GO
     var FIGHTING.CRITTER Fledgling / Young Forest Gryphons (Rossmans)
     var CRITTER.ROOMS 116|117|118|119
     goto MISTWOOD_GO
FLEDGLINGGRYPHON2_GO:
     var FIGHTING.CRITTER Fledgling / Young Forest Gryphons (Rossmans)
     var CRITTER.ROOMS 116|117|118|119
     goto MISTWOOD_GO
MATUREGRYPHON_GO:
     var FIGHTING.CRITTER Mature / Young Forest Gryphons (Rossmans)
     var CRITTER.ROOMS 96|107|108|109|110|111|112|113|114|115
     goto MISTWOOD_GO
ADULTGRYPHON_GO:
ELDERGRYPHON_GO:
     var FIGHTING.CRITTER Elder / Adult Forest Gryphons (Rossmans)
     var CRITTER.ROOMS 97|98|99|100|101|102|103|104|105|106
     goto MISTWOOD_GO
ORCBANDIT_GO:
VICIOUSWARCAT_GO:
     var FIGHTING.CRITTER Orc Bandits / Warcats
     var CRITTER.ROOMS 43|44|45|46|47|48|49|50|51|52|53|54|55|56|57|58
     gosub PVP_REMOVE
     goto MISTWOOD_GO
LONGWARCAT_GO:
ORCSCOUT_GO:
ORCSCOUTS_GO:
     var FIGHTING.CRITTER Orc Scouts / Warcats
     var CRITTER.ROOMS 30|31|32|33|34|35|37|38|39|40|26|27|28|29
     gosub PVP_REMOVE
     goto MISTWOOD_GO
ORCREIVER_GO:
SABRETOOTHWARCAT_GO:
     var FIGHTING.CRITTER Orc Reivers / Sabretooth Warcats
     var CRITTER.ROOMS 65|66|67|68|69|70|71|72|73|74|60|61|62|63|64
     gosub PVP_REMOVE
     goto MISTWOOD_GO
ORCRAIDER_GO:
     var FIGHTING.CRITTER Orc Raiders
     var CRITTER.ROOMS 75|76|77|78|79|80|81|82|83
     goto MISTWOOD_GO
ORCCHIEF_GO:
     var FIGHTING.CRITTER Orc Clan-Chiefs
     var CRITTER.ROOMS 75|76|77|78|79|80|81|82|83
     goto MISTWOOD_GO
SKYGIANT_GO:
     var FIGHTING.CRITTER Sky Giants
     var CRITTER.ROOMS 138|139|140|141|142|143|144|145|146|147|148|149|150|151|152
     goto MISTWOOD_GO
MISTWOOD_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" = "42") then gosub AUTOMOVE 2
     pause 0.1
     if (("$zoneid" = "40") && matchre("%COMBAT.CRITTER", "(?i)(SKY GIANT|SKYGIANT)")) then gosub AUTOMOVE mistwood
     pause 0.1
     if ("$zoneid" != "34") then
          {
               if ($Athletics.Ranks < 200) then gosub ARMOR_REMOVE
               send .travel ROSSMAN
               waitforre ^YOU ARRIVED\!
               if ($Athletics.Ranks < 200) then gosub WEAR_ARMOR
               if ("$zoneid" != "34a") then goto MISTWOOD_GO
               if ("$zoneid" = "34a") then gosub AUTOMOVE mistwood
          }
     pause 0.2
     if ("$zoneid" != "34") then goto MISTWOOD_GO
     if (("$zoneid" = "34") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### LANGENFIRTH AREA
CLAYSOLDIER_GO:
     var FIGHTING.CRITTER Grey Clay Soldiers
     var CRITTER.ROOMS 108|109|110|111|112|113
     goto SIKSRAJA_GO
CLAYMAGE_GO:
     var FIGHTING.CRITTER Grey Clay Mages
     var CRITTER.ROOMS 114|115|116|117|118
     goto SIKSRAJA_GO
CLAYARCHER_GO:
     var FIGHTING.CRITTER Grey Clay Archers
     var CRITTER.ROOMS 119|120|121|122|123|124
     goto SIKSRAJA_GO
YOUNGDEER_GO:
	 var FIGHTING.CRITTER Young Brocket Deer (T1)
	 var CRITTER.ROOMS 104|105|146|147
	 goto SIKSRAJA_GO
BROCKETDEER_GO:
	 var FIGHTING.CRITTER Brocket Deer (T2)
	 var CRITTER.ROOMS 148|149|150|151
	 goto SIKSRAJA_GO
ELDERDEER_GO:
	 var FIGHTING.CRITTER Elder Brocket Deer (T3)
	 var CRITTER.ROOMS 155|154|153|152
	 goto SIKSRAJA_GO
SIKSRAJA_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" = "42") then gosub AUTOMOVE lang
     if !matchre("$zoneid", "40|40a") then
          {
               send .travel rakash
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "40") then gosub AUTOMOVE siks
     pause 0.2
     if ("$zoneid" != "40a") then goto SIKSRAJA_GO
	if (("$zoneid" = "40a") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
WOODTROLLLANG_GO:
KELPIE_GO:
     var FIGHTING.CRITTER Wood Trolls/ Kelpies / Cougars / Boars
     var CRITTER.ROOMS 126|127|128|129|130|131|132|133|134|135|136
     goto LANGENFIRTH_GO
SUNVULTURE_GO:
     var FIGHTING.CRITTER Sun Vultures / Bone Wolves / Blood Wolves / Zombies
     var CRITTER.ROOMS 265|266|267|268|269|270|271|272|273|274|275|276|277|278
     goto LANGENFIRTH_GO
THUNDERRAM_GO:
     var FIGHTING.CRITTER Thunder Rams
     var CRITTER.ROOMS 348|349|350|351
     goto LANGENFIRTH_GO
BONEWOLF2_GO:
     var FIGHTING.CRITTER Bone Wolves / Blood Wolves
     var CRITTER.ROOMS 280|281|282|283|284|285|286
     goto LANGENFIRTH_GO
BLOODWOLF2_GO:
     var FIGHTING.CRITTER Blood Wolves T2
     var CRITTER.ROOMS 352|353|354|355|356|357|358|359|360|361|362
     goto LANGENFIRTH_GO
SMALLPECCARY2_GO:
SWAMPTROLL2_GO:
     var FIGHTING.CRITTER Swamp Trolls T2 / Peccaries
     var CRITTER.ROOMS 70|71|72|73|74|75|76|77|78|96|98|99
     goto LANGENFIRTH_GO
SWAMPTROLL3_GO:
     var FIGHTING.CRITTER Swamp Trolls T3 / Fendryads
     var CRITTER.ROOMS 90|91|92|93|94|95|80|81|82|83|84|85|87|88|89
     goto LANGENFIRTH_GO
FENDRYAD_GO:
     var FIGHTING.CRITTER Fendryads
     var CRITTER.ROOMS 85|86|87|101|102|103|104|105|106|107|108|109|110|111|112
     goto LANGENFIRTH_GO
ELSRALAEL2_GO:
     var FIGHTING.CRITTER Sinuous Elsrael / Blue Belly Crocodiles
     var CRITTER.ROOMS 322|323|324|325|326|327|328|329|330|331|332|333|334|335|336|337|338|339|340|341|342|343
     goto LANGENFIRTH_GO
BRONZELEUCRO_GO:
     action var LeucroAction $1 when You believe you could (.*) out of the way of the leucro, if you act quickly enough.
     var FIGHTING.CRITTER Bronze Leucros
     var CRITTER.ROOMS 378|379|380|381|382|383
     goto LANGENFIRTH_GO
LANGENFIRTH_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" != "40") then
          {
               send .travel LANGEN
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" != "40") then goto LANGENFIRTH_GO
     if (("$zoneid" = "40") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### THRONE CITY
CROCODILE2_GO:
     var FIGHTING.CRITTER Blue Belly Crocodiles (THRONE CITY)
     var CRITTER.ROOMS 180|181|182|183|184
     goto THRONE_GO
RIVERCAIMAN_GO:
     var FIGHTING.CRITTER River Caiman
     var CRITTER.ROOMS 172|173|174|175|176
     goto THRONE_GO
RIVERBOA2_GO:
     var FIGHTING.CRITTER River Boa
     var CRITTER.ROOMS 191|192|193
     goto THRONE_GO
ALLEYTHUG_GO:
     var FIGHTING.CRITTER Alley Thugs
     gosub PVP_REMOVE
     var CRITTER.ROOMS 4|5|6|7|8|9|10|11
     goto THRONE_GO
HEGBOAR2_GO:
     var FIGHTING.CRITTER Heggarangi Boars
     var CRITTER.ROOMS 194|163|178|179|185|186
     goto THRONE_GO
ANGHATCHLING_GO:
     var FIGHTING.CRITTER Angiswaerd Hatchlings
     var CRITTER.ROOMS 34|35|36|37|38|39|40|41|42|43|44
     goto THRONE_GO
MARBLEANGISWAERD_GO:
     var FIGHTING.CRITTER Marbled Angiswaerds
     var CRITTER.ROOMS 19|20|21|22|23|24|25|26|27|28
     goto THRONE_GO
THRONE_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" != "35") then
          {
               send .travel THRONE
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" != "35") then goto THRONE_GO
     if (("$zoneid" = "35") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### THEREN AREA
VELVER_GO:
     var FIGHTING.CRITTER Velver
     var CRITTER.ROOMS 215|216|217|218|219|220|221|222
     goto HVARAL_GO
HVARAL_GO:
     gosub FIRST_COMBAT_ROOM_SET
     send .travel HVARAL
     waitforre ^YOU ARRIVED\!
     pause 0.2
     if ("$zoneid" != "41") then goto HVARAL_GO
     if (("$zoneid" = "41") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
MORAHVINE_GO:
     var FIGHTING.CRITTER Morah Vines / Marauders
     var CRITTER.ROOMS 3|4|5|6|7|8|9|10|11|12
     goto KERLEOR_GO
WOODTROLL2_GO:
MARAUDER_GO:
     var FIGHTING.CRITTER Marauders / Wood Trolls T2
     var CRITTER.ROOMS 16|17|18|19|20|21|22|23|24|25|26|27|28|29
     goto KERLEOR_GO
DARKSPIRIT2_GO:
     var FIGHTING.CRITTER Dark Spirits
     var CRITTER.ROOMS 192|193|186|187|188|189|191|202|203
     goto KERLEOR_GO
SEORDMAOR_GO:
     var FIGHTING.CRITTER Scaly Seordmaor
     var CRITTER.ROOMS 60|61|62|63|64|65|66|67|68|69|70|71|72|73|74
     goto KERLEOR_GO
KERLEOR_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" != "41") then
          {
               send .travel FORNSTED
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" != "41") then goto KERLEOR_GO
     if (("$zoneid" = "41") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### MUSPARI
MONEYGRUBBER_GO:
TIGHTWAD_GO:
     var FIGHTING.CRITTER Moneygrubbers / Tightwads
     var CRITTER.ROOMS 207|208|209|210|211|212|213|214|215|216
     goto MUSPARI_GO
PINCHFIST_GO:
SKINFLINT_GO:
     var FIGHTING.CRITTER Pinchfists / Skinflints
     var CRITTER.ROOMS 218|219|220|221|222|223|224|225|226|227
     goto MUSPARI_GO
YEEHAR_GO:
     var FIGHTING.CRITTER Cadaverous Yeehar
     var CRITTER.ROOMS 50|51|52|53|54|55|56|57|58|59|60|61|62|63|64|65
     goto HAIZEN_GO
HAIZEN_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(47|48)\b") then
          {
               send .travel YEEHAR
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" = "47") then
          {
               send .travel YEEHAR
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" != "48") then goto HAIZEN_GO
     if (("$zoneid" = "48") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
SANDSPIDER_GO:
     var FIGHTING.CRITTER Sand Spiders
     var CRITTER.ROOMS 122|123|124|125|126|127|128|129|130|131
     goto MUSPARI_GO
MOTTLEDWESTANURYN2_GO:
SLAVER_GO:
     var FIGHTING.CRITTER Velakan Slaver
     var CRITTER.ROOMS 118|
     goto MUSPARI_GO
ZNOMAD_GO:
     var FIGHTING.CRITTER Zombie Nomads
     var CRITTER.ROOMS 390|389|388|387|385|386
     goto MUSPARI_GO
MONEYGRUBBERS_GO:
     var FIGHTING.CRITTER Moneygrubbers
     gosub PVP_REMOVE
     var CRITTER.ROOMS 217|218|219|220|221|222|223|224|225|226|227
     goto MUSPARI_GO
GAMCHAGA_GO:
CONJURER_GO:
     var FIGHTING.CRITTER Isundjen Conjurers / Gam Chagas
     var CRITTER.ROOMS 408|409|410|411|418|419|420|421|432
     goto MUSPARI_GO
ASHUHHINVI_GO:
     var FIGHTING.CRITTER Ashu Hhinvi
     var CRITTER.ROOMS 441|442|443|444|445|446|447|448|449|450|451|452|453|454|455
     goto MUSPARI_GO
MUSPARI_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" != "47") then
          {
               send .travel MUSPARI
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if matchre("%COMBAT.CRITTER", "(?i)(NOMAD|ZOMBIE)") then goto VELAKA_GO
     if ("$zoneid" != "47") then goto MUSPARI_GO
     if (("$zoneid" = "47") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
VELAKA_GO:
     if matchre("$roomname", "Velaka Desert") then goto VELAKA_RANDOM
     gosub AUTOMOVE 118
VELAKA_RANDOM:
     if !matchre("$roomname", "Velaka Desert") then goto MUSPARI_GO
     echo *** WANDERING THE VELAKA DESET
     echo *** Searching for: HIGH PLATEAU
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMWEIGHT east
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMWEIGHT east
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMWEIGHT east
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMWEIGHT east
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMMOVE
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMMOVE
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMMOVE
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMSOUTH
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMSOUTH
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMSOUTH
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMSOUTH
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMSOUTH
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMWEIGHT east
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMWEIGHT east
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMWEIGHT east
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMWEIGHT east
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMNORTH
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMNORTH
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMNORTH
     if matchre("$roomobjs", "high plateau") then goto VELAKA2_GO
     gosub RANDOMNORTH
     goto VELAKA_RANDOM
VELAKA2_GO:
     send climb plateau
     wait
     pause 0.4
     gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
####### STR/LETH AREA
BLOODDRYAD_GO:
BLOODNYAD_GO:
     var FIGHTING.CRITTER Blood Dryads / Blood Nyads
     var CRITTER.ROOMS 97|98|99|100|101|102|103|104
     goto STR1_GO
DRYADPRIESTESS_GO:
     var FIGHTING.CRITTER Dryad Priestesses
     var CRITTER.ROOMS 125|126|127|128|129|130|131
     goto STR1_GO
TWISTEDDRYAD_GO:
     gosub PVP_REMOVE
     var FIGHTING.CRITTER Twisted Dryads
     var CRITTER.ROOMS 132|133|134|135|136|137|138|139
     goto STR1_GO
DEATHSPIRIT2_GO:
     var FIGHTING.CRITTER Pale Grey Death Spirits
     var CRITTER.ROOMS 111|112|113|114|115|116|117|118|119|120|121|122|123
     goto STR1_GO
ENDRUSSERPENT_GO:
     var FIGHTING.CRITTER Endrus Serpents
     var CRITTER.ROOMS 147|148|149|150|151|152|153|154|155
     goto STR1_GO
RIVERSPRITE_GO:
     var FIGHTING.CRITTER Water Sprites
     var CRITTER.ROOMS 42|43|44|45|46
     gosub PVP_REMOVE
     goto STR1_GO
STR1_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(60|61|50)\b") then
          {
               send .travel ALFREN
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "61") then gosub AUTOMOVE cross
     if matchre("%COMBAT.CRITTER", "(?i)RIVER SPRITE") then goto SEGOLTHA_GO
     pause 0.2
     if ("$zoneid" != "60") then goto STR1_GO
     if (("$zoneid" = "60") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
SEGOLTHA_GO:
     if ("$zoneid" = "61") then gosub AUTOMOVE cross
     if ("$zoneid" = "60") then gosub AUTOMOVE segoltha
     pause 0.2
     if ("$zoneid" = "60") then gosub AUTOMOVE segoltha
     if ("$zoneid" != "50") then goto STR1_GO
     if (("$zoneid" = "50") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
TOAD_GO:
     var FIGHTING.CRITTER Treehopper Toads
     var CRITTER.ROOMS 194|195|196|197|198|199|200|201|202|203|204|205
     goto LETH_GO
LETH_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" != "61") then
          {
               send .travel LETH
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" != "61") then goto LETH_GO
     if (("$zoneid" = "61") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
MOSSMEY_GO:
     if matchre("$zoneid", "\b(90|90a|90d|90f|92|95|98|98a|99|99a|106|107|107a|108)\b") then goto MOSSMEY2_GO
     var FIGHTING.CRITTER Moss Meys
     var CRITTER.ROOMS 28|29|30|31|32|33|34|35|36|37|38|39|40|41|42|43|44|45
     goto BOGGYWOOD_GO
BOGGYWOOD_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(61|59)\b") then
          {
               send .travel LETH
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" = "61") then gosub AUTOMOVE moss
     pause 0.2
     if ("$zoneid" != "59") then goto BOGGYWOOD_GO
     if (("$zoneid" = "59") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
GRAVEWORM_GO:
     var FIGHTING.CRITTER Grave Worms / Zombies / Bone Wolves
     var CRITTER.ROOMS 85|86|87|88|89|90|91|92|93
     goto OSHUMANOR_GO
KARTAIS_GO:
     var FIGHTING.CRITTER Seordhevor kartais
     var CRITTER.ROOMS 12|13|14|15|16|17|18|19|20|21|22
     goto OSHUMANOR_GO
REVENANTZOMBIE_GO:
BONEWOLF_GO:
     if matchre("$zoneid","\b(40|42|34|30)\b") then goto BONEWOLF2_GO
     var FIGHTING.CRITTER Bone Wolves
     var CRITTER.ROOMS 71|72|73|74|75|76|77
     goto OSHUMANOR_GO
GERMISHDIN_GO:
     var Germish.Alert 1
     var FIGHTING.CRITTER Misshapen Germish'din
     var CRITTER.ROOMS 42|43|44|45|46|47|48|49
     goto OSHUMANOR_GO
OSHUMANOR_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(61|62|63)\b") then
          {
               send .travel LETH
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" = "61") then gosub AUTOMOVE shard
     if ("$zoneid" = "62") then gosub AUTOMOVE oshu
     if ("$zoneid" != "63") then goto OSHUMANOR_GO
GRAVEWORM_CHECK:
     if matchre("%COMBAT.CRITTER", "(?i)GRAVE WORM") then
          {
               if ($roomid != 57) then gosub AUTOMOVE 57
               put dig grave
               pause 20
               if matchre("$roomname","Overgrown Manor Grounds") then goto GRAVEWORMS
               if ($roomid != 91) then goto GRAVEWORM_CHECK
          }
GRAVEWORMS:
     gosub STAND
     if (("$zoneid" = "63") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
SNOWBEAST_GO:
     if matchre("$zoneid", "\b(66|67|68|69|112|116|127)\b") then goto SNOWBEAST2_GO
     var FIGHTING.CRITTER Snowbeasts
     var CRITTER.ROOMS 16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31|32
     goto STR2_GO
GIGANTICLACHMATE_GO:
     var FIGHTING.CRITTER Gigantic Lachmates
     var CRITTER.ROOMS 189|190|191|192|193|194
     goto STR2_GO
PREMIUMGIGANTICLACHMATE_GO:
     var FIGHTING.CRITTER Gigantic Lachmates (Premium)
     var CRITTER.ROOMS 195|196|197|198
     goto STR2_GO
NIMBUS_GO:
     var FIGHTING.CRITTER Nimbuses
     var CRITTER.ROOMS 164|165|166|167|168|169|170
     goto STR2_GO
STR2_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(61|62|63)\b") then
          {
               send .travel LETH
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" = "63") then gosub AUTOMOVE STR
     if ("$zoneid" = "61") then gosub AUTOMOVE shard
     if ("$zoneid" != "62") then goto STR2_GO
     if (("$zoneid" = "62") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### ILAYA TAIPA
STORMBULL_GO:
     if matchre("$zoneid", "\b(127|126|124|123|116|114|69|66|68|67)\b") then goto STORMBULL_SHARD_GO
     var FIGHTING.CRITTER Storm Bulls (Ilaya)
     var CRITTER.ROOMS 78|79|80|81|82|83|84|85|86|87|88|89|90|91|92|93|94
     goto ILAYA_GO
FORESTBANDIT_GO:
     var FIGHTING.CRITTER Forest Bandits
     var CRITTER.ROOMS 172|173|174|175|176|177|178|179|180|181|182|183
     goto ILAYA_GO
ILAYA_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" != "112") then
          {
               send .travel ILAYA
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" != "112") then goto ILAYA_GO
     gosub AUTOMOVE 16
     gosub BLEEDERCHECK
     pause
     if ($health < 90) then
          {
               echo ** Pausing for Health..
               pause 10
          }
     if (("$zoneid" = "112") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### AIN GHAZAL
GRAVEROBBER1_GO:
     if matchre("$zoneid","\b(98|99)\b") then goto GRAVEROBBER2_GO
     var FIGHTING.CRITTER Graverobbers
     gosub PVP_REMOVE
     var CRITTER.ROOMS 130|131|132|133|134|135|136|137|138|139|140|141|142|143|144|145
     goto AINGHAZAL_GO
CAVETROLL_GO:
     if matchre("$zoneid","\b(1|2|4|6|7|8|10|13|30|35|40|42|47)\b") then goto CAVETROLL2_GO
     if ($Athletics_Ranks < 220) then goto NO_CAVETROLL
     var FIGHTING.CRITTER Cave Trolls
     var CRITTER.ROOMS 77|78|79|80|81|82|83|84|85|86|87|88|89|90|91|92|93|94|95|96
     goto AINGHAZAL_GO
AINGHAZAL_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" != "114") then
          {
               send .travel AIN
               waitforre ^YOU ARRIVED\!
          }
     pause 0.1
     gosub AUTOMOVE 20
     gosub AUTOMOVE 19
     gosub AUTOMOVE 17
     if ("$zoneid" != "114") then goto AINGHAZAL_GO
     if (("$zoneid" = "114") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### SHARD
RATSHARD_GO:
LOUTSHARD_GO:
	var FIGHTING.CRITTER rat|lout
	var CRITTER.ROOMS 735|736|737|738|739|740|741|742|743|744|745|746|747|748|749|750|751|752|753|754
	goto SHARDWARRENS_GO
CUTTHROAT2_GO:
RUFFIAN2_GO:
THUG2_GO:
FOOTPAD2_GO:
FSTALKER_GO:
     var FIGHTING.CRITTER Thugs/Footpads/Ruffians/Cutthroats/Stalkers
     gosub PVP_REMOVE
     var CRITTER.ROOMS 355|356|357|358|359|360|361|362|362|365|366|367|368|369|370|371
     goto SHARDWARRENS_GO
FASSASSIN_GO:
     var FIGHTING.CRITTER Faenrae Assassins
     gosub PVP_REMOVE
     var CRITTER.ROOMS 302|303|304|305|306|307|308|309|310|311|312|313|314|315
     goto SHARDWARRENS_GO
SHARDWARRENS_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(65|66|67|68|69)\b") then
          {
               send .travel SHARD
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "69") then
          {
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then gosub AUTOMOVE shard
               if (($UC_shardCitizen = 0) && ($Time.isDay = 0)) then
                    {
                         if ("$zoneid" = "69") then gosub AUTOMOVE north
                         if ("$zoneid" = "66") then gosub AUTOMOVE e gate
                    }
          }
     if ("$zoneid" = "66") then gosub AUTOMOVE e gate
     pause 0.2
     if ("$guild" = "Necromancer") then
          {
               if ($spellEOTB = 0) then gosub NECRO_PREP
          }
     if (("$zoneid" = "67") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then
          {
               ### UNDERSHARD THIEF ENTRANCE Katamba's Crescent Road
               # if matchre("$guild", "Thief") then
                    # {
                         # gosub AUTOMOVE 595
                         # pause 0.2
                         # gosub AUTOMOVE 16
                         # pause 0.5
                         # gosub AUTOMOVE %FirstRoom
                         # goto COMBAT_LOCATION
                    # }
               ## UNDERSHARD NECRO ENTRANCE
               if matchre("$guild", "Necromancer") then
                    {
                         gosub AUTOMOVE 29
                         gosub AUTOMOVE 377
                         gosub AUTOMOVE %FirstRoom
                         goto COMBAT_LOCATION
                    }
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then gosub AUTOMOVE south
               if (($UC_shardCitizen = 0) && ($Time.isDay = 0) && ("$zoneid" = "67")) then gosub AUTOMOVE east
               if ("$zoneid" = "67") then gosub AUTOMOVE east
               if ("$zoneid" = "66") then gosub AUTOMOVE 3
               pause 0.001
               if ("$zoneid" = "66") then gosub AUTOMOVE 3
          }
SHARDWARRENS_GO2:
     if ("$zoneid" = "66") then gosub AUTOMOVE 3
     if ("$zoneid" = "68") then gosub TO_UNDERSHARD
     gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
### INTO UNDERSHARD FROM SHARD SOUTH GATE (NON-THIEVES/NECROS)
TO_UNDERSHARD:
     if ("$zoneid" = "66") then gosub AUTOMOVE 3
     pause 0.001
     if ("$zoneid" = "67") then gosub AUTOMOVE south
     pause 0.001
     gosub AUTOMOVE 177
     pause 0.001
     gosub MOVE NORTH
     pause 0.001
     gosub MOVE go branch
     pause 0.001
     gosub MOVE NORTH
SWIM_GAP:
     pause 0.001
     matchre RETREAT_GAP ^You are engaged|^While in combat\?|better luck if you first retreat
     matchre GAP_DONE You also see a broken sewer grate|Obvious|Eternities|Eddies of brown-red currents
     put go gap
     matchwait 65
     goto GAP_DONE
RETREAT_GAP:
     gosub RETREAT
     goto SWIM_GAP
GAP_DONE:
     pause 0.001
     gosub AUTOMOVE 188
     pause 0.1
     if ("$zoneid" = "68") then gosub AUTOMOVE 188
     gosub AUTOMOVE 279
     return
###### SHARD EAST GATE/GONDOLA AREA
GREYLACH_GO:
     var FIGHTING.CRITTER Lanky Grey Lach
     var CRITTER.ROOMS 349|350|351|352|353|354|355|356|357|358|359|360|361|362|363|364|366|367|368
     goto ABYSS_GO
SHYLVIC_GO:
MASTIFF_GO:
     var FIGHTING.CRITTER Feral Bone Mastiffs / Transparent Shylvics
     var CRITTER.ROOMS 324|325|326|327|328|329|330|331|332|334|335|336|337|338|339|340|341|342|343|344|345|346|347
     goto ABYSS_GO
BONEGOLEM_GO:
BLOODWRAITH_GO:
     var FIGHTING.CRITTER Vaporous Blood Wraiths / Gargantuan Bone Golems
     var CRITTER.ROOMS 410|411|412|413|414|415|416|417|418|419|420|421|422|423|424|425|426|427|428|429|430|431|432|433|434|435|436|437|438|439|440|441|442|443|444|445|446|447
     goto ABYSS_GO
ABYSS_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if matchre("$roomname","Abyssal Descent") then goto ABYSS_ARRIVE
     if matchre("$roomname","Maelshyve's Ascent") then goto ASCENT_ARRIVED
     if !matchre("$zoneid", "\b(65|66|67|68|69)\b") then
          {
               send .travel SHARD
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "68") then gosub AUTOMOVE e gate
     if ("$zoneid" = "67") then gosub AUTOMOVE e gate
     if ("$zoneid" = "69") then gosub AUTOMOVE North
     pause 0.2
     if ("$zoneid" = "66") then gosub AUTOMOVE 365
     if matchre("%COMBAT.CRITTER", "(?i)(BONE GOLEM|BLOOD WRAITH)") then goto ASCENT_GO
     gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
ASCENT_GO:
     pause 0.1
     gosub AUTOMOVE 333
     pause 0.2
     send jump abyss
     pause 30
     pause 5
     if ($stunned) then waiteval (!$stunned)
ASCENT_ARRIVED:
     gosub STAND
     goto COMBAT_LOCATION
KOBOLD_GO:
     var FIGHTING.CRITTER Kobolds / Jackals
     var CRITTER.ROOMS 11|30|34|35|10|9|8|7|6|1|2|14
     goto SHARDEAST_GO
BOGGLE_GO:
     var FIGHTING.CRITTER Small Boggles
     var CRITTER.ROOMS 224|227|228|229|230
     goto SHARDEAST_GO
CRAG_GO:
SCYTHEWINGMOTH_GO:
SCYTHEWINGLARVA_GO:
     var FIGHTING.CRITTER Crags / Dusky Scythewing Moth / Larva
     var CRITTER.ROOMS 391|392|393|394|395|461|449|389|450|400|401|448|451|454|460
     goto SHARDEAST_GO
ZOMBIEREDLEUCRO_GO:
     var FIGHTING.CRITTER Zombie Red Leucro
     var CRITTER.ROOMS 684|685|687|688
     goto SHARDEAST_GO
FROSTWEAVER_GO:
     if matchre("$zoneid","\b(98a|98|99)\b") then goto FROSTWEAVER2_GO
     var FIGHTING.CRITTER Frostweavers
     var CRITTER.ROOMS 643|644|645|646|647|648|649
     goto SHARDEAST_GO
GRANITEGARGOYLE_GO:
     if (matchre("$zoneid", "\b((?:[6-9]|[1-5]([0-9])?)[a-z]?)\b") && ($UC_Premium = 1)) then goto GRANITEGARGOYLEPREM_GO
     var FIGHTING.CRITTER Granite Gargoyles
     var CRITTER.ROOMS 172|173|174|178|179|180|181|182|183|184|185|186|187|191
     goto SHARDEAST_GO
SNOWBEAST2_GO:
     var FIGHTING.CRITTER Snowbeasts (Shard)
     var CRITTER.ROOMS 165|166|167|169|170|171|168|175|176|177
     goto SHARDEAST_GO
KOBOLDSAVAGE_GO:
KOBOLDHEADHUNTER_GO:
     var FIGHTING.CRITTER Zombie Kobold Savages / Headhunters
     var CRITTER.ROOMS 282|283|284|285|286|287|288|289|290|291|292|293|294|295
     goto SHARDEAST_GO
YOUNGPRERENI_GO:
     var FIGHTING.CRITTER Young Blue-Dappled Prereni (T1)
     var CRITTER.ROOMS 657|658|659
     goto SHARDEAST_GO
PRERENI_GO:
     var FIGHTING.CRITTER Blue-Dappled Prereni (T2)
     var CRITTER.ROOMS 664|665|666
     goto SHARDEAST_GO
ELDERPRERENI_GO:
     var FIGHTING.CRITTER Elder Blue-Dappled Prereni (T3)
     var CRITTER.ROOMS 667|668|669
     goto SHARDEAST_GO
YOUNGPRERENI_PREMIUM_GO:
YOUNGPRERENIPREM_GO:
     var FIGHTING.CRITTER Young Blue-Dappled Prereni (T1) PREMIUM
     var CRITTER.ROOMS 660|662|657|658|659
     goto SHARDEAST_GO
PRERENI_PREMIUM_GO:
PRERENIPREM_GO:
     var FIGHTING.CRITTER Blue-Dappled Prereni (T2) PREMIUM
     var CRITTER.ROOMS 661|663|664|665|666
     goto SHARDEAST_GO
ELDERPRERENI_PREMIUM_GO:
ELDERPRERENIPREM_GO:
     var FIGHTING.CRITTER Elder Blue-Dappled Prereni (T3) PREMIUM
     var CRITTER.ROOMS 679|680|667|668|669
     goto SHARDEAST_GO
FROSTCRONE_GO:
     var FIGHTING.CRITTER Frostcrones
     var CRITTER.ROOMS 695|696|697|698|699|700|701|702
     goto SHARDEAST_GO
REDGREMLINS_GO:
     var FIGHTING.CRITTER Red-Bristled Gremlins
     var CRITTER.ROOMS 621|622|624|625|626|627|628|629|630|631|632|633|634
     goto SHARDEAST_GO
MALCHATA_GO:
     var FIGHTING.CRITTER S'sugi Malchata
     var CRITTER.ROOMS 471|472|473|474|475|476|477|478|479|480|481|482|483|484|485|486|487|488
     goto SHARDEAST_GO
SHARDEAST_GO:
     gosub FIRST_COMBAT_ROOM_SET
     gosub TIME_CHECK
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(65|66|67|68|69)\b") then
          {
               send .travel SHARD
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "68") then gosub AUTOMOVE e gate
     if ("$zoneid" = "67") then gosub AUTOMOVE e gate
     if ("$zoneid" = "66") then
          {
               put e
               pause 0.4
          }
     if ("$zoneid" = "69") then gosub AUTOMOVE North
     pause 0.2
     if ("$zoneid" != "66") then goto SHARDEAST_GO
     if (("$zoneid" = "66") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### UNDERGONDOLA
LATAMI_GO:
     var FIGHTING.CRITTER Yvhh La'tamis
     var CRITTER.ROOMS 24|25|26|27|28|29|30|31|32|33|34|35|36|37|38|39
     goto UNDERGONDOLA_GO
REDLEUCRO_GO:
     var FIGHTING.CRITTER Grizzled Red Leucros
     var CRITTER.ROOMS 3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21
     goto UNDERGONDOLA_GO
BLADESPIDER_GO:
     var FIGHTING.CRITTER Blade Spiders
     var CRITTER.ROOMS 53|54|55|56|57|60|61|62|63|64|70|71|72
     goto UNDERGONDOLA_GO
UNDERGONDOLA_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(65|66|67)\b") then
          {
               send .travel SHARD
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "67") then gosub AUTOMOVE e gate
     pause 0.1
     if ("$zoneid" = "67") then gosub AUTOMOVE e gate
     pause 0.1
     if ("$zoneid" = "66") then gosub AUTOMOVE waterfall
     pause 0.2
     if ("$zoneid" = "66") then gosub AUTOMOVE waterfall
     pause 0.2
     if ("$zoneid" != "65") then goto UNDERGONDOLA_GO
     if (("$zoneid" = "65") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### SHARD SOUTH GATE
CROCODILE3_GO:
     var FIGHTING.CRITTER Blue Belly Crocodiles (Shard south)
     var CRITTER.ROOMS 185|186|187
     goto SHARDSOUTH_GO
ROCKTROLLSHARD_GO:
     var FIGHTING.CRITTER Rock Trolls T1 / Jackals (Shard)
     var CRITTER.ROOMS 35|36|37|38|39|40|41|42|43|44|45|46|47
     goto SHARDSOUTH_GO
ROCKTROLL2_GO:
     var FIGHTING.CRITTER Rock Trolls T2
     var CRITTER.ROOMS 9|10|11|12|13
     goto SHARDSOUTH_GO
EIDOLONSTEED_GO:
     var FIGHTING.CRITTER Eidolon Steeds
     var CRITTER.ROOMS 57|58|59|60|61|62|63|64|65|66|67|68|69|70
     goto SHARDSOUTH_GO
ELSRALAEL_GO:
     var FIGHTING.CRITTER Sinuous Elsrael
     var CRITTER.ROOMS 177|178|180|181
     goto SHARDSOUTH_GO
BLOODWARRIOR_GO:
SHADOWMAGE_GO:
     var FIGHTING.CRITTER A'danf Shadow Mages / Blood Warriors
     var CRITTER.ROOMS 139|140|141|142|143|144|210|209|145|146|147|148|149|150
     goto SHARDSOUTH_GO
BLADEMASTER_GO:
     var FIGHTING.CRITTER A'danf Blademasters
     var CRITTER.ROOMS 164|165|166|167|168|169|170|171|172|173|174|175|176
     goto SHARDSOUTH_GO
ASORCERER_GO:
     var FIGHTING.CRITTER Adan'f Sorcerer's
     var CRITTER.ROOMS 151|152|153|154|155|156|157|158|159|160|161|162|163
     goto SHARDSOUTH_GO
SHARDSOUTH_GO:
     gosub FIRST_COMBAT_ROOM_SET
     gosub TIME_CHECK
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(65|66|67|68|69)\b") then
          {
               send .travel SHARD
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     pause 0.001
     if ("$zoneid" = "69") then gosub AUTOMOVE north
     if ("$zoneid" = "66") then
          {
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then
                    {
                         gosub AUTOMOVE e gate
                         pause 0.5
                         gosub AUTOMOVE south
                         pause 0.1
                         pause 0.1
                    }
               if (($UC_shardCitizen = 0) && ($Time.isDay = 0)) then gosub AUTOMOVE s gate
          }
     pause 0.001
     pause 0.001
     if ("$zoneid" = "67") then
          {
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then gosub AUTOMOVE south
               if ($UC_shardCitizen = 0) && ($Time.isDay = 0) then
                    {
                         gosub AUTOMOVE e gate
                         gosub AUTOMOVE s gate
                    }
          }
     pause 0.001
     if ("$zoneid" != "68") then goto SHARDSOUTH_GO
     pause 0.001
     if matchre("%COMBAT.CRITTER", "(?i)(CROCODILE)") then gosub TO_SHARD_SEWER
     pause 0.001
     if (("$zoneid" = "68") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
TO_SHARD_SEWER:
     if ("$zoneid" = "66") then gosub AUTOMOVE 3
     pause 0.001
     if ("$zoneid" = "67") then gosub AUTOMOVE south
     pause 0.001
     gosub AUTOMOVE 177
     pause 0.001
     gosub MOVE NORTH
     pause 0.001
     gosub MOVE go branch
     pause 0.001
     gosub MOVE NORTH
SWIMMING_GAP:
     pause 0.001
     matchre RETREATING_GAP ^You are engaged|^While in combat\?|better luck if you first retreat
     matchre GAPIS_DONE You also see a broken sewer grate|Obvious|Eternities|Eddies of brown-red currents
     put go gap
     matchwait 65
     goto GAP_DONE
RETREATING_GAP:
     gosub RETREAT
     goto SWIMMING_GAP
GAPIS_DONE:
     return
##################################################################
DANCER_GO:
     var FIGHTING.CRITTER A'danf Spirit Dancers / Shadow Mages
     var CRITTER.ROOMS 16|8|9|10|11|12|13|14|15|17|22|25|26|27|28|18|19
     goto ICECAVE_GO
ICECAVE_GO:
     gosub FIRST_COMBAT_ROOM_SET
     gosub TIME_CHECK
     action (PVPPLAYER) off
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(65|66|67|68|69|68a)\b") then
          {
               send .travel SHARD
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "69") then gosub AUTOMOVE shard
     if ("$zoneid" = "66") then
          {
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then
                    {
                         gosub AUTOMOVE e gate
                         gosub AUTOMOVE south
                    }
               if (($UC_shardCitizen = 0) && ($Time.isDay = 0)) then gosub AUTOMOVE s gate
          }
     if ("$zoneid" = "67") then
          {
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then gosub AUTOMOVE south
               if (($UC_shardCitizen = 0) && ($Time.isDay = 0)) then
                    {
                         gosub AUTOMOVE e gate
                         gosub AUTOMOVE s gate
                    }
          }
     pause 0.2
     if ("$zoneid" = "68") then gosub AUTOMOVE ice
     pause 0.2
     if ("$zoneid" = "68") then gosub AUTOMOVE ice
     pause 0.3
     if ("$zoneid" = "68") then gosub AUTOMOVE ice
     if (("$zoneid" = "68a") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     if ("$zoneid" != "68a") then goto ICECAVE_GO
     goto COMBAT_LOCATION
###### SHARD WEST GATE HUNTING
GRASSEEL3_GO:
	var FIGHTING.CRITTER Grass Eel
	var CRITTER.ROOMS 116|117|119|120|121|122|123|124
	goto SHARDWEST_GO
ANTELOPE_GO:
BISON_GO:
GOLDENPARD_GO:
     var FIGHTING.CRITTER Golden Pards / Antelope / Bison
     var CRITTER.ROOMS 107|108|109|110|111|112|113|114|115|129|130|131|132
     goto SHARDWEST_GO
PIVUH_GO:
     var FIGHTING.CRITTER Blue-Green Pivuhs
     var CRITTER.ROOMS 291|292|293|294|295|296|297|298|299|300|301|302|303|304|305
     goto SHARDWEST_GO
PECCARY_GO:
     if matchre("$zoneid", "\b(90|90a|90d|90f|92|95|98|98a|99|99a|106|107|107a|108)\b") then goto PECCARY2_GO
     var FIGHTING.CRITTER Peccaries
     var CRITTER.ROOMS 134|135|136|137|138|139|140|141|142|143|144|145|146|147|148
     goto SHARDWEST_GO
ARZUMOS_GO:
     var FIGHTING.CRITTER Clouded Arzumos
     var CRITTER.ROOMS 77|79|80|81|82|83|84|88
     goto SHARDWEST_GO
BABYGRYPHON2_GO:
     var FIGHTING.CRITTER Baby Forest Gryphons (Shard)
     var CRITTER.ROOMS 233|234|235|236|237|238|239
     goto SHARDWEST_GO
FLEDGLINGGRYPHON_GO:
     if matchre("$zoneid", "\b(30|31|32|33|34|34a|40|40a|41|42|47)\b") then goto FLEDGLINGGRYPHON2_GO
     var FIGHTING.CRITTER Fledgling Forest Gryphons (Shard)
     var CRITTER.ROOMS 236|237|238|239|235|234|233
     goto SHARDWEST_GO
YOUNGGRYPHON2_GO:
     var FIGHTING.CRITTER Young Forest Gryphons (Shard)
     var CRITTER.ROOMS 241|242|243|244
     goto SHARDWEST_GO
MATUREGRYPHON2_GO:
     var FIGHTING.CRITTER Mature Forest Gryphons (Shard)
     var CRITTER.ROOMS 244|245|246|247
     goto SHARDWEST_GO
SHALSWAR_GO:
     var FIGHTING.CRITTER Armored Shalswar
     var CRITTER.ROOMS 252|253|254|255|256|257|260|261|262|263
     goto SHARDWEST_GO
BELTUNUMSHI_GO:
     var FIGHTING.CRITTER Beltunumshi
     var CRITTER.ROOMS 618|619|620|621|622|623|624|625|626|627|628
     goto SHARDWEST_GO
CLOUDRAT_GO:
     var FIGHTING.CRITTER Cloud Rats
     var CRITTER.ROOMS 611|612|613|614|615|607|608|609|610
     goto SHARDWEST_GO
DPCRONE_GO:
     var FIGHTING.CRITTER Dragon Priest Crones
     var CRITTER.ROOMS 346|347|348|349|350
     goto SHARDWEST_GO
DPSENTINEL_GO:
     var FIGHTING.CRITTER Dragon Priest Sentinels
     var CRITTER.ROOMS 351|352|353|354|355
     goto SHARDWEST_GO
STORMBULL_SHARD_GO:
     var FIGHTING.CRITTER Storm Bulls (Shard)
     var CRITTER.ROOMS 597|598|599|600|601|602
     goto SHARDWEST_GO
STORMBULL_SHARD_PREMIUM_GO:
     var FIGHTING.CRITTER Premium Storm Bulls (Shard)
     var CRITTER.ROOMS 603|604|605
     goto SHARDWEST_GO
PURIFIER_GO:
DPPURIFIER_GO:
     var FIGHTING.CRITTER Dragon Priest Purifiers
     var CRITTER.ROOMS 307|308|309|310|311|312|313|314|315
     goto SHARDWEST_GO
DRAGONPRIEST_GO:
SMALLPECCARY_GO:
     if matchre("$zoneid","\b(30|31|32|33|34|34a|40a|40|41)\b") then goto SMALLPECCARY2_GO
     var FIGHTING.CRITTER Dragon Priest/Priestess
     var CRITTER.ROOMS 155|156|157|158|159|160|161|162|163|164|165|166|167
     goto SHARDWEST_GO
DPJUGGERNAUT_GO:
     # Juggernaut Orb Triggers
     action (combat) var Juggernaut.Orb ON when A Dragon Priest juggernaut giggles softly to itself as it frees a large dark orb
     action (combat) var Juggernaut.Orb ON when A muted roar suddenly fills the air\, originating from somewhere within a large dark orb
     action (combat) var Juggernaut.Orb ON when A Dragon Priest juggernaut giggles loudly as it gazes at the orb with loving admiration and hisses
     action (combat) var Juggernaut.Orb OFF when The orb gives a final rumble before falling dormant
     var FIGHTING.CRITTER Dragon Priest Juggernauts
     var CRITTER.ROOMS 323|324|325|326|327|328|329
     goto SHARDWEST_GO
DPZEALOT_GO:
     var FIGHTING.CRITTER Dragon Priest Zealots
     var CRITTER.ROOMS 317|318|319|320|321
     goto SHARDWEST_GO
PLAGUEWRAITH_GO:
     var FIGHTING.CRITTER Vile Plague Wraiths
     var CRITTER.ROOMS 397|398|399|400|401|402|403|404|405|406|407|408|409|410|411|412
     goto SHARDWEST_GO
TELGAOREK_GO:
     action (PVPPLAYER) off
     var FIGHTING.CRITTER Telga Orek
     var CRITTER.ROOMS 464|515|516|517|518|519|520|521|522|523|524|525
     goto SHARDWEST_GO
YWYVERN_GO:
     var FIGHTING.CRITTER Young Wyverns
     var CRITTER.ROOMS 480|481|482|483|484|485|486|487|511|512
     if ($UC_Premium = 1) then var CRITTER.ROOMS 567|568|569|570|571|572|480|481|482|483|484|485|486|487|511|512
     goto SHARDWEST_GO
JWYVERN_GO:
     var FIGHTING.CRITTER Juvenile Wyverns
     var CRITTER.ROOMS 454|455|456|457|458|459|460|461|462|463
     if ($UC_Premium = 1) then var CRITTER.ROOMS 575|576|577|578|579|454|455|456|457|458|459|460|461|462|463
     goto SHARDWEST_GO
AWYVERN_GO:
     var FIGHTING.CRITTER Adult Wyverns
     var CRITTER.ROOMS 473|474|475|476|477|478
     goto SHARDWEST_GO
BONEWYVERN_GO:
     var FIGHTING.CRITTER Bone Wyverns
     var CRITTER.ROOMS 496|495|494|491|492|493
     goto SHARDWEST_GO
ARCHON_GO:
     var FIGHTING.CRITTER Ice Archons
     var CRITTER.ROOMS 510|509|500|506|501|499|502|498
     goto SHARDWEST_GO
DPASSASSIN_GO:
     var FIGHTING.CRITTER Dragon Priest Assassins
     gosub PVP_REMOVE
     var CRITTER.ROOMS 339|340|341|343|344|345|449|451|450
     goto SHARDWEST_GO
INTERCESSOR_GO:
     var FIGHTING.CRITTER Dragon Priest Intercessors
     gosub PVP_REMOVE
     var CRITTER.ROOMS 444|445|446|438|439|440|441|442|443
SHARDWEST_GO:
     gosub FIRST_COMBAT_ROOM_SET
     gosub TIME_CHECK
     action (PVPPLAYER) off
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(65|66|67|68|69)\b") then
          {
               send .travel SHARD
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "65") then gosub AUTOMOVE shard
     if ("$zoneid" = "68") then gosub AUTOMOVE shard
     if ("$zoneid" = "66") then
          {
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then
                    {
                         gosub AUTOMOVE east
                         gosub AUTOMOVE w gate
                    }
               if (($UC_shardCitizen = 0) && ($Time.isDay = 0) && ("$zoneid" = "66")) then gosub AUTOMOVE w gate
          }
     if ("$zoneid" = "67") then
          {
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then gosub AUTOMOVE w gate
               if (($UC_shardCitizen = 0) && ($Time.isDay = 0)) then
                    {
                         gosub AUTOMOVE east
                         gosub AUTOMOVE w gate
                    }
          }
     pause 0.1
     if ("$zoneid" = "67") then
          {
               if (($UC_shardCitizen = 1) || ($Time.isDay = 1)) then gosub AUTOMOVE w gate
               if (($UC_shardCitizen = 0) && ($Time.isDay = 0)) then
                    {
                         gosub AUTOMOVE east
                         gosub AUTOMOVE w gate
                    }
          }
     pause 0.1
     if ("$zoneid" != "69") then goto SHARDWEST_GO
     pause 0.2
     if (("$zoneid" = "69") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### HIMINELDAR SHEL / RAVENS POINT
IMP_GO:
     var FIGHTING.CRITTER Stone Throwing Imps / Buccas
     var CRITTER.ROOMS 206|207|208|209|210|211|212|213|214
     goto RAVEN_GO
RETCHFIEND_GO:
     var FIGHTING.CRITTER Retch Fiends
     var CRITTER.ROOMS 231|232|236|237|238|239|240|241|242|243|244|245
     goto RAVEN_GO
YOUNGCAVETROLL_GO:
     if ($Athletics.Ranks < 80) then goto NO_YOUNG_CAVETROLL
     var FIGHTING.CRITTER Young Cave Trolls
     var CRITTER.ROOMS 220|221
     goto RAVEN_GO
FROSTANGISWAERD_GO:
     var FIGHTING.CRITTER Frost Angiswaerd
     var CRITTER.ROOMS 247|248|249|250|251|252|253
     goto RAVEN_GO
FROSTBEAR_GO:
     var FIGHTING.CRITTER Frostweyr Bears
     var CRITTER.ROOMS 73|74|75|76|77|78|79|80|81
     goto RAVEN_GO
MOUNTAINGIANT_GO:
     var FIGHTING.CRITTER Mountain Giants
     var CRITTER.ROOMS 192|193|194|195|196|197|189|190|191|188|189
     goto RAVEN_GO
JMORADU_GO:
     var FIGHTING.CRITTER Jeol Moradu
     var CRITTER.ROOMS 150|151|152|153|154|155|156|157
     goto RAVEN_GO
RAVEN_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" = "116") then gosub AUTOMOVE raven
     if ("$zoneid" != "123") then
          {
               send .travel RAVEN
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" != "123") then goto RAVEN_GO
     if (("$zoneid" = "123") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### BOAR CLAN
MAIDENTRESS_GO:
     var FIGHTING.CRITTER Maiden's Tresses
     var CRITTER.ROOMS 252|253|254|255|256|257|258|259|260
     goto BOARCLAN_GO
BLIGHTBAT_GO:
     var FIGHTING.CRITTER Giant Blight Bats
     var CRITTER.ROOMS 126|127|128|129|130|131|132|133
     goto BOARCLAN_GO
BLOODVINE_GO:
     var FIGHTING.CRITTER Vela'Tohr Bloodvines
     var CRITTER.ROOMS 234|235|236|237|238|239|240|241|242|243|244|245
     goto BOARCLAN_GO
BLIGHTWATERNYAD_GO:
DEADWOODDRYAD_GO:
     var FIGHTING.CRITTER Blightwater Nyads / Deadwood Dryads
     var CRITTER.ROOMS 266|267|268|269|270|271|272|273|274|275|276|277|278|279|280|281
     goto BOARCLAN_GO
STUMPYBLIGHTOGRE_GO:
LITHEBLIGHTOGRE_GO:
BLIGHTOGRE_GO:
     var FIGHTING.CRITTER Giant Blight Ogres
     var CRITTER.ROOMS 308|309|310|311|312|313|314|315|316|317|318|319|320|321
     goto BOARCLAN_GO
TOGBALL_GO:
     var FIGHTING.CRITTER Mutant Togballs
     var CRITTER.ROOMS 583|584|585|586|587|588|589|590|591
     goto BOARCLAN_GO
ZSTOMPER_GO:
     var FIGHTING.CRITTER Zombie Stompers
     var CRITTER.ROOMS 560|561|562|563|564|565
     goto BOARCLAN_GO
ZMAULER_GO:
     var FIGHTING.CRITTER Zombie Maulers
     var CRITTER.ROOMS 566|567|568|569|570|571
     goto BOARCLAN_GO
HEADSPLITTER_GO:
     var FIGHTING.CRITTER Zombie Head-Splitters
     var CRITTER.ROOMS 572|573|574|575|576|577|578|579|580
     goto BOARCLAN_GO
BLACKGOBLIN_GO:
     var FIGHTING.CRITTER Black Goblins
     var CRITTER.ROOMS 101|102|103|104|105|106|107|108|109|110|111|112|113|114|115|116|117|118|119|120|121|122|123
     goto BOARCLAN_GO
BLACKAPE_GO:
     var FIGHTING.CRITTER Black Apes
     var CRITTER.ROOMS 164|165|166|167|168|169|170|171|172|173|174|175|176|177|178|179|180|181|182|183|184|185|186|187|188|189|190|191|192|193|194
     goto BOARCLAN_GO
FMOTH2_GO:
     var FIGHTING.CRITTER Fuligin Umbral Moths (Boar Clan)
     var CRITTER.ROOMS 637|638|639|640|641|642
     goto BOARCLAN_GO
VMOTH2_GO:
     var FIGHTING.CRITTER Void Black Umbral Moths (Boar Clan)
     var CRITTER.ROOMS 643|644|645|646|647|648
     goto BOARCLAN_GO
SHADOWMOTH_GO:
     var FIGHTING.CRITTER Shadowfrost Moths
     var CRITTER.ROOMS 649|650|651|652|653|654
     goto BOARCLAN_GO
BOARCLAN_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" != "127") then
          {
               gosub OPEN_CONTAINERS
               send .travel BOAR
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" != "127") then goto BOARCLAN_GO
     if (("$zoneid" = "127") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
ICEADDER_GO:
     var FIGHTING.CRITTER Sinuous Ice Adders
     var CRITTER.ROOMS 422|423|424|425|426|427|428|429|430|431|432|433|435|436|437|438|439|440|441|442|443|444|445|446|447|448|449
     goto ASKETI_GO
ICYGHAST_GO:
     var FIGHTING.CRITTER Icy Blue Ghasts T1
     var CRITTER.ROOMS 500|501|498|499|487|497|485|486|488|489|490|491|492|493|494|495|496
     goto ASKETI_GO
ICYGHAST2_GO:
     var FIGHTING.CRITTER Icy Blue Ghasts T2
     var CRITTER.ROOMS 478|477|475|476|473|474|471|472|470|480|482|483|484
     goto ASKETI_GO
ICYGHAST3_GO:
     var FIGHTING.CRITTER Icy Blue Ghasts T3
     var CRITTER.ROOMS 469|468|465|466|467|462|463|464|458|459|460|461
     goto ASKETI_GO
ICYGHAST4_GO:
     var FIGHTING.CRITTER Icy Blue Ghasts T4
     var CRITTER.ROOMS 450|451|452|453|454|455|456|457
     goto ASKETI_GO
WINDHAG_GO:
WINDWRETCH_GO:
     var FIGHTING.CRITTER Wind Hags / Wind Wretches
     var CRITTER.ROOMS 393|392|391|390|389|388|377|378|379|380|395|394
     goto ASKETI_GO
MARBLEGARGOYLE_GO:
     var FIGHTING.CRITTER Black Marble Gargoyle
     var CRITTER.ROOMS 373|374|375|396|397|398|399|400|401|402|403|404|405|406|407|408|409|410|411|412|413|414|415|416
     goto ASKETI_GO
WINDBANSHEE_GO:
     var FIGHTING.CRITTER Lesser North Wind Banshees
     var CRITTER.ROOMS 383|382|381|384|387|386|385|551|552
     goto ASKETI_GO
ASKETI_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(116|126|127)\b") then
          {
               gosub OPEN_CONTAINERS
               send .travel boar
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "116") then gosub AUTOMOVE boar
     pause 0.2
     if ("$zoneid" = "126") then gosub AUTOMOVE boar
     pause 0.2
     if ("$zoneid" != "127") then goto ASKETI_GO
     pause 0.1
     if matchre("%abbrevs", "(?i)UNCURSE") then gosub ASKETI_SHORTCUT
     if (("$zoneid" = "127") && !matchre("$roomname","(Asketi's Mount|Temple of the North Wind|Adder's Nest)")) then
          {
               gosub AUTOMOVE 265
               gosub AUTOMOVE 367
               gosub AUTOMOVE 372
          }
     if matchre("%COMBAT.CRITTER", "(?i)(GHAST|ICE ADDER)") then goto GHAST_GO
     if !matchre("$roomid", "\b(%CRITTER.ROOMS)\b") then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
GHAST_GO:
     if matchre("$roomname","Adder's Nest") then goto GHAST_GO_2
     if matchre("$roomname","Temple of the North Wind\, Catacombs") then goto GHAST_GO_2
     gosub AUTOMOVE 384
     pause 0.5
     send pull sconce
     pause 0.5
     gosub MOVE go door
     pause 0.5
     gosub PUT climb step
     pause 0.5
     if matchre("%COMBAT.CRITTER", "(?i)ICE ADDER") then goto ICYADDER_GO_2
GHAST_GO_2:
     if !matchre("$roomid", "\b(%CRITTER.ROOMS)\b") then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
ICYADDER_GO:
     if matchre("$roomname","Adder's Nest") then goto GHAST_GO_2
     gosub AUTOMOVE 436
     pause 0.5
     send go port
     pause 0.5
     pause 0.2
     send climb pit
     pause 0.5
     pause 0.2
ICYADDER_GO_2:
     gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
ASKETI_SHORTCUT:
     var asketiloop 0
     echo
     echo ######################################
     echo # WE KNOW UNCURSE! TAKING THE SHORTCUT
     echo # BYPASSING STUPID GARGOYLE MOUNTAIN
     echo ######################################
     echo
     ASKETI_SHORTCUT_1:
     pause 0.5
     pause 0.3
     if (%asketiloop > 3) then return
     if ($roomid != 303) then gosub AUTOMOVE cursed
     pause 0.1
     put prep uncurse 25
     pause 13
     matchre ASKETI_SHORTCUT_2 ^Bluish\-white tendrils of mist escape as the door swings silently open
     matchre ASKETI_SHORTCUT_2 ^You sense the curse on the granite door break\!
     matchre ASKETI_SHORTCUT_2 ^The crystal shard embedded in the granite door flares with an icy brilliance as a gust of frigid wind blasts through the area\.
     matchre ASKETI_SHORTCUT_2 ^There's not much point in uncursing it when it's not locked\!
     matchre ASKETI_SHORTCUT_1 ^You sense the curse on the door shudder violently\.
     put cast door
     matchwait 8
     math asketiloop add 1
     goto ASKETI_SHORTCUT_1
ASKETI_SHORTCUT_2:
     pause 0.2
     pause 0.1
     put go door
     pause 0.5
     pause 0.3
     put up
     pause 0.5
     if matchre("$roomname","Vela'Tohr Woods") then goto ASKETI_SHORTCUT_1
     return
####### MRISS
BABYPECCARY_GO:
     var FIGHTING.CRITTER Baby Peccaries
     var CRITTER.ROOMS 256|259|257|255|258|260|262|261|263|254|252|253
     goto MRISS_GO
PECCARY2_GO:
     var FIGHTING.CRITTER Peccaries
     var CRITTER.ROOMS 256|260|258|255|259
     goto MRISS_GO
CARACAL_GO:
     var FIGHTING.CRITTER Caracels
     var CRITTER.ROOMS 193|194|195|196|197|199|198|200|204
     goto MRISS_GO
LUNSHELE_GO:
TREKHALO_GO:
     var FIGHTING.CRITTER Lun'Shele Trekhalo / Hunters
     var CRITTER.ROOMS 170|171|172|173|174|175|176|177|178|179|180|181|182|183
     goto MRISS_GO
JUVENILEDILLO_GO:
     var FIGHTING.CRITTER Juvenile Desert Armadillos
     var CRITTER.ROOMS 384|385|386|387|388|389|390|379|380|381|382|383
     if ($UC_Premium = 1) then var CRITTER.ROOMS 403|404|405|406|407|408|409|384|385|386|387|388|389|390|379|380|381|382|383
     goto MRISS_GO
ELDERDILLO_GO:
     var FIGHTING.CRITTER Elder Desert Armadillos
     var CRITTER.ROOMS 391|392|393|394|395|396|397|398|399
     if ($UC_Premium = 1) then var CRITTER.ROOMS 410|411|412|413|414|391|392|393|394|395|396|397|398|399
     goto MRISS_GO
ADULTDILLO_GO:
     var FIGHTING.CRITTER Adult Desert Armadillos
     var CRITTER.ROOMS 1|2|3|4|5|6|7|8|9|10
     if ($UC_Premium = 1) then var CRITTER.ROOMS 415|416|417|418|1|2|3|4|5|6|7|8|9|10
     goto MRISS_GO
MRISS_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" = "107") then
          {
                  action (debt) on
                  if (%Necro.Known = 0) then gosub AUTOMOVE teller
                  if matchre("%BANKRUN", "(?i)(ON|1|YES)") then put deposit all
                  pause 0.5
                  pause 0.5
                  action (debt) off
                  gosub put withdraw 100 copper
                  gosub AUTOMOVE 113
                  gosub MONEY_CHECK
                  if (%WealthLirums < 20) then goto NO_MONEY_MRISS
                  waitforre glides into the dock|A loud voice
                  if ($invisible = 1) then gosub STOP_INVIS
                  put go galley
                  pause
                  waitforre reaches the dock
                  put go dock
                  pause 0.5
                  pause 0.1
                  send north
                  pause
          }
     if ("$zoneid" != "108") then
          {
               send .travel MRISS
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" != "108") then goto MRISS_GO
     if (("$zoneid" = "108") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### RATHA
PIRATE_GO:
     var FIGHTING.CRITTER Pirates
     if ("$zoneid" != "998") then goto PIRATE_ERROR
     goto COMBAT_LOCATION
SANDCRAB_GO:
SANDSPRITE_GO:
     var FIGHTING.CRITTER Sand Sprites
     var CRITTER.ROOMS 8|9|10|11|12|13|14|19|20|21|22|23|24|25
     goto RATHAWEST_GO
OCHRELAHEKE_GO:
     var FIGHTING.CRITTER Ochre La'heke
     var CRITTER.ROOMS 26|27|28|29|30|31|32|33|34|35|36|37|38|39|40|49|50|51|52|53|54|55|56|57|58|59|60
     goto RATHAWEST_GO
RATHAWEST_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(90|90a)\b") then
          {
               send .travel RATHA
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "90") then gosub AUTOMOVE sprites
     pause 0.2
     if ("$zoneid" = "90") then gosub AUTOMOVE sprites
     pause 0.2
     if ("$zoneid" != "90a") then goto RATHAWEST_GO
     if (("$zoneid" = "90a") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
SILVERLEUCRO_GO:
     var FIGHTING.CRITTER Silver Leucro
     var CRITTER.ROOMS 68|69|70|71|72|73|74|75|76|77|78
     goto RESHALIA_GO
RAZORTUSKSOW_GO:
     var FIGHTING.CRITTER Razortusk Sow
     var CRITTER.ROOMS 34|35|36|37|38|39|40|41
     goto RESHALIA_GO
RAZORTUSKBOAR_GO:
     var FIGHTING.CRITTER Razortusk Boars
     var CRITTER.ROOMS 43|44|45|46|47|48|49|50
     goto RESHALIA_GO
DARKSPIRIT3_GO:
SKELETALSAILOR_GO:
SPECTRALPIRATE_GO:
     var FIGHTING.CRITTER Spectral Pirates / Skeletal Sailors
     var CRITTER.ROOMS 250|251|252|253|254|255|256|257|258|259|260|261|262|263|264|265|266|267|268|269|270
     goto RESHALIA_GO
RESHALIA_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(90|90a|92|95)\b") then
          {
               send .travel RATHA
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "90a") then gosub AUTOMOVE ratha
     if ("$zoneid" = "95") then gosub AUTOMOVE ratha
     if ("$zoneid" = "90") then gosub AUTOMOVE NW
     if ("$zoneid" != "92") then goto RESHALIA_GO
     if matchre("%COMBAT.CRITTER", "(?i)(SPECTRAL PIRATE|SKELETAL SAILOR)") then goto DEADMAN_GO
     if (("$zoneid" = "92") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
DEADMAN_GO:
     gosub AUTOMOVE 189
     pause 0.2
     if ("$roomid" != "189") then gosub AUTOMOVE 189
     pause 0.1
     put climb handhold
     wait
     pause 0.3
     gosub TRUE_RANDOM_2
     goto COMBAT_LOCATION
SWAIN_GO:
     var FIGHTING.CRITTER Bawdy Swain
     var CRITTER.ROOMS 245|246|247|248|249|250|798|799
     goto RATHA_GO
CELPEZERATHA_GO:
     var FIGHTING.CRITTER Celpeze (Ratha)
     var CRITTER.ROOMS 368|369|370|371|372|373|374|375|376
     goto RATHA_GO
MERROW_GO:
     var FIGHTING.CRITTER Selkies / Merrows / Silver Leucros
     var CRITTER.ROOMS 619|620|621|605|604|603|602|601|600|599
     goto RATHA_GO
DOLOMAR_GO:
     if matchre("$zoneid","106") then goto DOLOMAR2_GO
     var FIGHTING.CRITTER Retan Dolomars
     var CRITTER.ROOMS 583|584|585|586|587|588|589|590|591|592|626|625
     goto RATHA_GO
KRAHEI_GO:
     var FIGHTING.CRITTER Kra'hei
     var CRITTER.ROOMS 756|757|759|761|762|763|765|767|768|769
     goto RATHA_GO
KRAHEIHATCHLING_GO:
     var FIGHTING.CRITTER Kra'hei Hatchlings
     var CRITTER.ROOMS 696|697|698|699|700|701|702|703|704|705|707|708|709|710|711|712|713
     goto RATHA_GO
DOBEK_GO:
     var FIGHTING.CRITTER Dobek Moruryn
     var CRITTER.ROOMS 669|670|671|672|673|674|675|676|677|678|679|680|681|682|683|684|685|686
     goto RATHA_GO
RATHA_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if !matchre("$zoneid", "\b(90|90a|92|95)\b") then
          {
               send .travel RATHA
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "92") then gosub AUTOMOVE ratha
     if ("$zoneid" = "90a") then gosub AUTOMOVE ratha
     if ("$zoneid" = "95") then gosub AUTOMOVE ratha
     if ("$zoneid" != "90") then goto RATHA_GO
     if matchre("%COMBAT.CRITTER", "(?i)(DOBEK|MORURYN)") then goto URREMTIER_GO
     if matchre("%COMBAT.CRITTER", "(?i)(KRAHEI)") then goto KRAHEI_SEWER
     if (("$zoneid" = "90") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
KRAHEI_SEWER:
     gosub AUTOMOVE 723
     pause 0.3
     put go valve
     wait
     pause 0.7
     gosub RANDOMMOVE
     goto COMBAT_LOCATION

URREMTIER_GO:
     if ("$zoneid" = "90") then gosub AUTOMOVE 666
     pause 0.5
     if ($roomid != 666) then gosub AUTOMOVE 666
     pause 0.5
     send kiss scorpion
     pause 32
     gosub STAND
     pause 0.1
     put go door
     pause
     gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### AESRY
BLOODWOLFAESRY_GO:
     var FIGHTING.CRITTER Blood Wolves
     var CRITTER.ROOMS 88|89|90|91|92|93|94|95|96|97|98|99|100
     goto AESRYROAD_GO
FROSTWEAVER2_GO:
     var FIGHTING.CRITTER Frostweavers
     var CRITTER.ROOMS 104|105|106|107|108|109|110|111|112|113|114|115|116|117|118|119|120
     goto AESRYROAD_GO
MOSSMEY2_GO:
     var FIGHTING.CRITTER Moss Meys
     var CRITTER.ROOMS 66|67|68|69|70|71|72
     goto AESRYROAD_GO
SNOWGOBLIN1_GO:
     var FIGHTING.CRITTER Snow Goblins T1
     var CRITTER.ROOMS 126|127|128|129|130|131
     goto AESRYROAD_GO
SNOWGOBLIN2_GO:
     var FIGHTING.CRITTER Snow Goblins T2
     var CRITTER.ROOMS 132|133|134|135|136|137|138|139|140|141|142
     goto AESRYROAD_GO
SNOWGOBLIN3_GO:
     var FIGHTING.CRITTER Snow Goblins T3
     var CRITTER.ROOMS 143|144|145|146|147|152|153
     goto AESRYROAD_GO
TIGERSHARK_GO:
BULLSHARK_GO:
BLACKTIPSHARK_GO:
     var FIGHTING.CRITTER Bull/Blacktip/Tiger Sharks
     var CRITTER.ROOMS 20|21|22|149|150|154|155|156|157
     goto AESRYROAD_GO
AESRYROAD_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(98a|98|99)\b") then
          {
               send .travel AESRY
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "98a") then gosub AUTOMOVE 97
     if ("$zoneid" = "99") then gosub AUTOMOVE 390
     pause 0.1
     if ("$zoneid" = "99") then gosub AUTOMOVE 390
     if ("$zoneid" != "98") then goto AESRYROAD_GO
     if (("$zoneid" = "98") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
NIPOHOSHU1_GO:
     var FIGHTING.CRITTER Nipoh Oshu T1
     var CRITTER.ROOMS 19|20|21|22|23|24|25
     goto AESRYCAVES_GO
NIPOHOSHU2_GO:
     var FIGHTING.CRITTER Nipoh Oshu T2
     var CRITTER.ROOMS 26|27|28|29|30|31|32
     goto AESRYCAVES_GO
NIPOHOSHU3_GO:
     var FIGHTING.CRITTER Nipoh Oshu T3
     var CRITTER.ROOMS 33|34|35|36|37|38|39
     goto AESRYCAVES_GO

NIGHTSTALKER2_GO:
NIGHTWEAVERUNYN2_GO:
NIGHTREAVERUNYN2_GO:
UNYN2_GO:
     var FIGHTING.CRITTER Nightweaver Unyns
     var CRITTER.ROOMS 43|44|45|46|47|48|49|50|51|52|53|54|55
     goto AESRYCAVES_GO
DARVAGER_GO:
     var FIGHTING.CRITTER Elba Darvager
     var CRITTER.ROOMS 82|83|84|85|86|87
     goto AESRYCAVES_GO
AESRYCAVES_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if !matchre("$zoneid", "\b(98a|98|99)\b") then
          {
               send .travel AESRY
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" = "99") then gosub AUTOMOVE west
     if ("$zoneid" = "98") then gosub AUTOMOVE 36
     if ("$zoneid" != "98a") then goto AESRYCAVES_GO
     if (("$zoneid" = "98a") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
SNAERHAFWA2_GO:
     var FIGHTING.CRITTER Snaer Hafwa
     var CRITTER.ROOMS 326|327|328|329|330|331|332
     goto AESRY_GO
YVHHLATAMI2_GO:
     var FIGHTING.CRITTER Yvhh La'tami
     var CRITTER.ROOMS 301|302|303|304|305|306|307|308
     goto AESRY_GO
GHOULCROW_GO:
     var FIGHTING.CRITTER Ghoul Crows
     var CRITTER.ROOMS 333|334|335|336|337
     goto AESRY_GO
HHRKIIZH_GO:
     var FIGHTING.CRITTER Ur Hhrkiizh T1
     var CRITTER.ROOMS 374|375|376|377|378|379|380|381
     goto AESRY_GO
HHRKIIZH2_GO:
     var FIGHTING.CRITTER Ur Hhrkiizh T2
     var CRITTER.ROOMS 382|382|384|385|386|387|388
     goto AESRY_GO
GRAVEROBBER2_GO:
GHOULRAVEN_GO:
     var FIGHTING.CRITTER Graverobbers / Ghoul Ravens
     var CRITTER.ROOMS 340|341|342|343|344|345|346|347|348|349|350
     goto AESRY_GO
WIRDINEGO2_GO:
GHOULRAVEN2_GO:
     var FIGHTING.CRITTER Greater Ghoul Ravens / Wir Dinegos
     var CRITTER.ROOMS 352|353|354|355|356|357|358|359|360
     goto AESRY_GO
AESRY_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" != "99") then
          {
               send .travel AESRY
               waitforre ^YOU ARRIVED\!
          }
     if matchre("%COMBAT.CRITTER", "\b(?i)(Crypt Fiend|Ghoul Raven|Snaer|Hafwa|Resuscitants?|Moths?)\b") then gosub LIGHT_SOURCE
     if ("$zoneid" != "99") then goto AESRY_GO
     if (("$zoneid" = "99") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### MERKRESH
BLOODFISH_GO:
     var FIGHTING.CRITTER Spiny Bloodfish / Celpeze T2
     var CRITTER.ROOMS 139|140|141|142|143|144|145|146|147|148|149|150|151|152
     goto MERKRESH_GO
CELPEZE2_GO:
     var FIGHTING.CRITTER Asaren Celpeze T2 / Spiny Bloodfish
     var CRITTER.ROOMS 139|140|141|142|143|144|145|146|147|148|149|150|151|152
     goto MERKRESH_GO
CELPEZE3_GO:
     var FIGHTING.CRITTER Asaren Super Celpeze T3
     var CRITTER.ROOMS 156|155|154|157|158|159|160|161|162|163|164|165|166|167|168|169
     goto MERKRESH_GO
CELPEZE4_GO:
     var FIGHTING.CRITTER Super Celpeze (T4) South Barricade
     var CRITTER.ROOMS 38|37|36|35|34|33|32|31|39|153|40|41
     goto MERKRESH_GO
CELPEZE5_GO:
     var FIGHTING.CRITTER Super Celpeze (T5) North Barricade
     var CRITTER.ROOMS 103|104|105|106|107|311|310|312|313|314|308|309|307
     goto MERKRESH_GO
MERKRESH_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" != "107") then
          {
               send .travel MERK
               waitforre ^YOU ARRIVED\!
          }
     if ("$zoneid" != "107") then goto MERKRESH_GO
     if (("$zoneid" = "107") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### HARA'JAAL
HEGBOAR_GO:
     if ("$zoneid" = "35") then goto HEGBOAR2_GO
     var FIGHTING.CRITTER Heggarangi Boars
     var CRITTER.ROOMS 50|51|53|54|55|56|57
     goto HARAJAAL_GO
LACHMATE_GO:
     var FIGHTING.CRITTER Lachmates
     var CRITTER.ROOMS 132|133|134|135|136|137|138|139|140|141
     goto HARAJAAL_GO
HELELA_GO:
     var FIGHTING.CRITTER Sleek Hele'las
     var CRITTER.ROOMS 124|125|126|127|144|145|146|153|154|155|156
     goto HARAJAAL_GO
RIVERBOA_GO:
     var FIGHTING.CRITTER River Boa
     var CRITTER.ROOMS 128|129|130|131|142|143
     goto HARAJAAL_GO
PIRANHA_GO:
     var FIGHTING.CRITTER Piranha
     var CRITTER.ROOMS 120|121|122|150|151|152
     goto HARAJAAL_GO
SPIDERCRAB_GO:
     var FIGHTING.CRITTER Huge Spider Crabs
     var CRITTER.ROOMS 160|161|162|163
     goto HARAJAAL_GO
SAILFIN_GO:
     var FIGHTING.CRITTER Sailfin Lizard
     var CRITTER.ROOMS 117|118|119|147|148|149|157|158|159
     goto HARAJAAL_GO
TMORADU_GO:
     var FIGHTING.CRITTER Telga Moradu
     var CRITTER.ROOMS 72|73|74|75|76|77|78
     goto HARAJAAL_GO
POLOHIZH_GO:
     var FIGHTING.CRITTER Poloh'izh
     var CRITTER.ROOMS 197|198|199|200|201|202|203|204|205|206|207|208|209|210
     goto HARAJAAL_GO
HARAJAAL_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ("$zoneid" != "106") then
          {
               send .travel hara
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" != "106") then goto HARAJAAL_GO
     if (("$zoneid" = "106") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     if matchre("$UC_combatCritter", "(?i)POLO") then gosub POLO_GO
     goto COMBAT_LOCATION
POLO_GO:
     if matchre("$roomobjs", "slope") then
          {
               send climb slope
               return
          }
     gosub MOVE n
     goto POLO_GO
###### TAISGATH
SILLHOUETTE_GO:
SHADOWMASTER_GO:
     var FIGHTING.CRITTER Gaunt Shadow Masters
     var CRITTER.ROOMS 59|60|61|62
     goto TAISGATH_GO
EVISCERATOR_GO:
UMBRAMAGUS_GO:
     var FIGHTING.CRITTER Emaciated Umbramagus / Shadefield Eviscerators
     var CRITTER.ROOMS 46|47|48|49|50|51|52|53|54|55
     goto TAISGATH_GO
TAISGATH_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("$zoneid" = "150") then gosub LEAVE_SEACAVE
     if ($zoneid != 90d) then
          {
               send .travel TAISGATH
               waitforre ^YOU ARRIVED\!
          }
     pause 0.2
     if ("$zoneid" != "90d") then goto TAISGATH_GO
     if (("$zoneid" = "90d") && !matchre("$roomid", "\b(%CRITTER.ROOMS)\b")) then gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION
###### FANG COVE
SUWBIZAR_GO:
     var FIGHTING.CRITTER Suw Bizar
     var CRITTER.ROOMS 20|21|22|23|24|25|26|27|28|29|30
     goto FANGCOVE_GO
DROWNED_GO:
SPOTTEDSHARK_GO:
     var FIGHTING.CRITTER Drowned Ones / Spotted Sharks
     var CRITTER.ROOMS 31|32|33|34|35|36|37
     goto FANGCOVE_GO
KASHIKASERPENT_GO:
     var FIGHTING.CRITTER Spotted Kashika Serpents
     var CRITTER.ROOMS 91|92|93|94|95
     goto FANGCOVE_GO
SPOTTEDBOBCAT_GO:
     var FIGHTING.CRITTER Spotted Bobcats
     var CRITTER.ROOMS 80|81|82|83|84
     goto FANGCOVE_GO
QUARTZGARGOYLE_GO:
     var FIGHTING.CRITTER Quartz Gargoyles
     var CRITTER.ROOMS 65|66|67|68|69|70|71|72|73|74|75
     goto FANGCOVE_GO
YELLOWGREMLIN_GO:
     var FIGHTING.CRITTER Yellow Bristled Gremlins
     var CRITTER.ROOMS 107|108|109|110|111|112|113|114|115|116|117
     goto FANGCOVE_GO
FANGCOVE_GO:
     gosub FIRST_COMBAT_ROOM_SET
     if ("%game" = "DR") && (!$UC_Premium) then goto NO_FANGCOVE
     if ("$zoneid" = "150") then goto FANGCOVE2_GO
     if matchre("%JumpJewelry", "(?i)(ON|1|YES)") then
          {
               send push my %JewerlyVerb
               pause 0.5
               pause 0.5
               put #mapper reset
          }
     if (((!matchre("$zoneid","150")) && matchre("%game", "(DRF|DRX)")) || (!matchre("$zoneid","150") && ($UC_Premium = 1))) then goto FANGCOVETF_GO
     pause 0.2
     # if ("$zoneid" = "90") then goto TO_RATHA_MAMMOTH
     # if ("$zoneid" != "99") || ("$zoneid" != "98") || ("$zoneid" != "99a") || ("$zoneid" != "90d") || ("$zoneid" != "106") || ("$zoneid" != "107") || ("$zoneid" != "108") then goto TO_ACE_MAMMOTH
     # if !matchre("$zoneid","\b(90d|98|99|99a|106|107|108)\b") then goto TO_ACE_MAMMOTH
     if !matchre("$zoneid","150") then goto FANGCOVETF_GO
     if ("$zoneid" = "150") then goto FANGCOVE2_GO
     echo ####################################################################
     echo *** ERROR! YOU ARE NOT IN A RECOGNIZED LOCATION TO GET TO FANG COVE!
     echo ####################################################################
     exit
NO_FANGCOVE:
     echo ##################################
     echo *** YOU ARE NOT PREMIUM!
     echo *** CHOOSE A MONSTER NOT IN FANG COVE!
     echo ##################################
     exit
FANGCOVE2_GO:
     pause 0.1
     gosub AUTOMOVE %FirstRoom
     goto COMBAT_LOCATION

###################################################################################################
COMBAT_LOCATION:
     action put #var UC_Secrecy NO when You see signs that someone|^You notice
     put #var UC_CRITTER.ROOMS %CRITTER.ROOMS
     if !matchre("$UC_combatCritter", "(?i)(ZOMBIE NOMAD|CROC|GENI|SPECTRAL PIRATE|SKELETAL SAILOR|ATIKET|SUPPLE FIRECAT|MUSCULAR FIRECAT|BROCKET DEER|SLAVER|MOTTLED WEST)") then
          {
               if (("$roomid" != "%FirstRoom") && ($roomid != 0)) then gosub AUTOMOVE %FirstRoom
               if (("$roomid" != "%FirstRoom") && ($roomid != 0)) then gosub AUTOMOVE %FirstRoom
          }
     action (inventory) on
     if ($UC_No.Contact = 1) then
          {
               action (PVPPLAYER) on
          }
     echo
     echo ##############################
     echo * ~ ARRIVED AT COMBAT LOCATION!
     echo ** HUNTING: %FIGHTING.CRITTER
     echo ##############################
     echo
     pause 0.5
     echo
     echo ########################################################################################
     echo * ~ CHECKING FOR AN EMPTY COMBAT ROOM! ~ WILL HUNT WITH ANY FRIENDS IF SPOTTED
     echo * FRIENDS: %FRIENDS
     echo ########################################################################################
     pause 0.2
FINDING_ROOM:
     pause 0.2
     echo ####################################
     echo *  *** Hunting Rooms to Check ***
     echo * %CRITTER.ROOMS
     echo ####################################
     echo
     pause 0.2
     pause 0.5
     # debug 5
     gosub FIND_COMBAT_ROOM
     # debug 0
     if (matchre("$roomplayers", "%FRIENDS") && (%Germish.Alert = 0)) then
          {
               echo
               echo #####################
               echo *** !!! SUCCESS !!!
               echo *** FOUND COMBAT ROOM!
               echo *** HUNTING WITH FRIENDS!
               echo #####################
               echo
          }
     if (matchre("$roomplayers", "") && ("$UC_Secrecy" = "YES") && (%Germish.Alert = 0)) then
          {
                    echo
                    echo #####################
                    echo *** !!! SUCCESS !!!
                    echo * FOUND EMPTY COMBAT ROOM!
                    echo #####################
                    echo
          }
     if (!matchre("$roomplayers", "") && (%Germish.Alert = 1)) then goto FINDING_ROOM
     if ("$UC_Secrecy" = "NO") then goto FINDING_ROOM
     action remove You see signs that someone|^You notice
     gosub clear
     put #var UC_Combat.Time $gametime
     put #echo >$Log #B0DDE2 **** Hunting in %FIGHTING.CRITTER ! Roomid - $roomid
     gosub INDOOR_CHECK
     if matchre("$righthand $lefthand", "(lantern|torch)") then put drop $1
     goto TrainLoop

#########################################################################################################################
### FINDING AN EMPTY COMBAT ROOM
### Checks for Empty Combat Room among your Critter Rooms
FIND_COMBAT_ROOM:
     var RoomCheck 0
     action put #var UC_Secrecy NO when You see signs that someone|^You notice a?\s?(?!($UC_friends|%critters))\w+, who is
     if matchre("$roomname", "Beyond the Gate of Souls") then return
     var GOOD.ROOMS $UC_CRITTER.ROOMS
     put #var UC_ROOMSEARCH %GOOD.ROOMS
     gosub COMBAT_ROOM_SET
     gosub ROOMCHECK
	if ("$UC_Secrecy" = "YES") then return
     gosub FINDROOMSETUP
     ### MAY NEED TO ADD A COUNTER HERE TO PREVENT INFINITE LOOPS
     if ((!matchre("$UC_combatCritter", "(?i)(ZOMBIE NOMAD|CROC|GENI|SPECTRAL PIRATE|SKELETAL SAILOR|ATIKET|SUPPLE FIRECAT|MUSCULAR FIRECAT|BROCKET DEER|SLAVER|MOTTLED WEST)")) && !matchre("$roomid","(%GOOD.ROOMS)")) then goto FIND_COMBAT_ROOM
     action remove You see signs that someone|You notice .+\, who is
     return
COMBAT_ROOM_SET:
     if (!matchre("$UC_combatCritter", "(?i)(ZOMBIE NOMAD|CROC|SPECTRAL PIRATE|SKELETAL SAILOR|ATIKET|SUPPLE FIRECAT|MUSCULAR FIRECAT|BROCKET DEER|SLAVER|MOTTLED WEST)") && ($roomid = 0)) then gosub RANDOMMOVE
	if matchre("%FIGHTING.CRITTER", "(?i)young brocket deer|elder brocket deer") then put #var UC_ROOMSEARCH west|west|west
	if matchre("%FIGHTING.CRITTER", "(?i)^brocket deer") then put #var UC_ROOMSEARCH east|east|east
     eval RoomCount count("$UC_ROOMSEARCH", "|")
     return
FINDROOMSETUP:
     var count 0
     var searchloop 0
ROOMFIND:
     if (%count > %RoomCount) then
          {
               math searchloop add 1
               if (%searchloop > 3) then goto ESCAPE_NOROOMS
               var count 0
          }
     if matchre("$UC_combatCritter", "(?i)(ZOMBIE NOMAD|CROC|GENI|SPECTRAL PIRATE|SKELETAL SAILOR|ATIKET|SUPPLE FIRECAT|MUSCULAR FIRECAT|BROCKET DEER|SLAVER|MOTTLED WEST)") then
          {
               gosub RANDOMMOVE
               goto ROOMFIND_2
          }
     if matchre("%FIGHTING.CRITTER", "(?i)elder brocket deer") then
          {
          gosub move w
          gosub move w
          gosub move w
          put climb hill
          gosub move e
          gosub move e
          gosub move e
          put climb hill
          pause 0.5
          return
          }
     if matchre("$UC_combatCritter", "(?i)brocket deer") then
		{
               math brocketcount add 1
               gosub MOVE $UC_ROOMSEARCH(%count)
		}
	else gosub MOVEMENT $UC_ROOMSEARCH(%count)
ROOMFIND_2:
     var RoomCheck 0
     gosub ROOMCHECK
     math count add 1
     if ("$UC_Secrecy" = "YES") then return
     goto ROOMFIND
ROOMCHECK:
     gosub FRIEND_CHECK
     if ("$UC_Secrecy" = "NO") then return
ROOMCHECK_SEARCH:
     matchre ROOMCHECK_SEARCH ^\s*\.\.\.wait|^You are still stunned
     matchre ROOM_IS_GOOD ^(?:$UC_friends) whispers|^You don't find anything of interest here|^You find a|^You're not in any condition
     matchre ROOM_IS_BAD ^You see signs that someone|^You notice the vague silhouette of a?\s?(?!($UC_friends|%critters))\w+\.|^You notice a?\s?(?!($UC_friends|%critters))\w+, who is quite obviously attempting to remain hidden\.|^(?!($UC_friends|%critters))\w+ says|^(?!($UC_friends|%critters))\w+ exclaims|^(?!($UC_friends|%critters))\w+ asks|^You hear the.* voice of (?!($UC_friends|%critters))|^(?!($UC_friends|%critters))\w+ comes out of hiding|^(?!($UC_friends|%critters))\w+ (leaps|bursts) from hiding|^Someone snipes
     send search
     matchwait 4
ROOM_IS_BAD:
     pause 0.001
     put #var UC_Secrecy NO
     return
ROOM_IS_GOOD:
     gosub FRIEND_CHECK
     math RoomCheck add 1
     pause 0.1
     if (%RoomCheck > 1) then return
     goto ROOMCHECK
MOVEMENT:
     var LASTGOTOPLACE $0
     if ("$roomid" = "0") then gosub RANDOMMOVE
     send #goto %LASTGOTOPLACE
     matchre RETURN ^YOU HAVE ARRIVED!
     matchwait 8
     send #goto %LASTGOTOPLACE
     matchre RETURN ^YOU HAVE ARRIVED!
     matchwait 10
     return
##################################################################################################################################
# CHECK FOR FRIENDS/ROOMPLAYERS SUB
## Checks for Roomplayers matching your var FRIENDS list
## If your friends are in the room it will return positive and hunt with them
## If no one in the room it returns positive
## If room is occupied but no one in your friends list, it will return a negative and leave
## UC_Secrey YES = OK TO HUNT / UC_Secrecy NO = OCCUPIED/NON-FRIEND
##################################################################################################################################
FRIEND_CHECK:
     put #var UC_Secrecy YES
     var StartRoom $roomplayers
     var FriendList $UC_friends
     eval FriendCount count("%FriendList", "|")
Friend_Main:
     gosub Base.GetRoomPlayers
     gosub CheckFriends
     return
Base.GetRoomPlayers:
     var Base.Roomplayers.Output
     var Base.Roomplayers.Input $roomplayers
     eval Base.Roomplayers.Input replace("%Base.Roomplayers.Input","Also here: ","")
     eval Base.Roomplayers.Input replace("%Base.Roomplayers.Input",", ","|")
     eval Base.Roomplayers.Input replacere("%Base.Roomplayers.Input","( and )(?!.*and )","|")
     eval Base.Roomplayers.Input replace("%Base.Roomplayers.Input",".","")
     eval tempcount count("%Base.Roomplayers.Input","|")
     var index 0
Base.GetRoomPlayers.FindName.Loop:
     if %index > %tempcount then goto FriendlyFinal
     if matchre("%Base.Roomplayers.Input(%index)","([A-Z][a-z]+)(?!.*[A-Z])")  then
     {
               var temp $1
               var Base.Roomplayers.Output %Base.Roomplayers.Output|%temp
     }
     math index add 1
     goto Base.GetRoomPlayers.FindName.Loop

CheckFriends:
     eval PlayerCount count("%Base.Roomplayers.Output", "|")
     var index 1

TestPlayers:
     if (%index > %PlayerCount) then goto FriendlyEnd
     if (%PlayerCount > 2) then goto FriendlyCount
     if !contains("%FriendList", "%Base.Roomplayers.Output(%index)") then
     {
          put #echo >Log %Base.Roomplayers.Output(%index) is not a friend! Roomid $roomid
          echo *** %Base.Roomplayers.Output(%index) is not a friend! Moving Rooms..
          goto FoundNonFriendly
     }
     math index add 1
     goto TestPlayers

FriendlyCount:
     echo *** Too many players already in one room, Moving Rooms
FoundNonFriendly:
     put #var UC_Secrecy NO
FriendlyEnd:
     if ("$roomplayers" != "%StartRoom") then
     {
          put #echo >Log Room had different players then when player check started - Skipping
          put #var UC_Secrecy NO
     }
FriendlyFinal:
     return
#################################################################################################################
## SET COMBAT ROOMS
FIRST_COMBAT_ROOM_SET:
     if !matchre("$UC_priorityRooms", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               gosub PRIORITY_REMOVE
               echo *** NEW PRIORITY ROOMS: $UC_priorityRooms
               pause 0.5
               if matchre("$UC_priorityRooms", "(?i)(NULL|OFF|^%|^\s*$)") then goto FIRST_COMBAT_ROOM_SET_1
               gosub PRIORITY.ROOMS
          }
FIRST_COMBAT_ROOM_SET_1:
     eval CritterRooms count("%CRITTER.ROOMS", "|")
     var count 0
     var FirstRoom %CRITTER.ROOMS(%count)
     echo *** First room to check: %FirstRoom
     echo ##################################
     echo
     if matchre("$UC_combatCritter", "(?i)brocket deer") then var brocketcount 0
     return
PRIORITY.ROOMS:
     var count 0
     eval total count("$UC_priorityRooms", "|")
PRIORITYREMOVELOOP:
     if (%count > %total) then goto PRIORITY.SET
     eval CRITTER.ROOMS replace("%CRITTER.ROOMS", "$UC_priorityRooms(%count)", "")
     math count add 1
     goto PRIORITYREMOVELOOP
PRIORITY.SET:
     eval CRITTER.ROOMS replacere("%CRITTER.ROOMS", "\|+", "|")
     eval CRITTER.ROOMS replacere("%CRITTER.ROOMS", "^\||\|$" "")
     var CRITTER.ROOMS $UC_priorityRooms|%CRITTER.ROOMS
     unvar count
     unvar total
     unvar index
     unvar Prior.Rooms
     unvar PriorMax
     return
#### STRIP PRIORITY ROOM NUMBERS FROM ARRAY IF THEY DON'T EXIST IN THE CRITTER ROOMS
PRIORITY_REMOVE:
     var index 0
     var Prior.Rooms $UC_priorityRooms
     echo
     echo ##################################
     echo *** CRITTER ROOMS: %CRITTER.ROOMS
     echo *** PRIORITY ROOMS: $UC_priorityRooms
     eval PriorMax count("$UC_priorityRooms", "|")
PRIORITY_REMOVE_1:
     pause 0.001
     if !matchre("%Prior.Rooms(%index)", "\b(%CRITTER.ROOMS)\b") then
          {
               eval Prior.Rooms replacere("%Prior.Rooms", "%Prior.Rooms(%index)", "")
          }
     math index add 1
     if (%index > %PriorMax) then
          {
               eval Prior.Rooms replacere("%Prior.Rooms", "\|+", "|")
               eval Prior.Rooms replacere("%Prior.Rooms", "^\||\|$" "")
               eval Prior.Rooms replacere("%Prior.Rooms", "\|$" "")
               eval PriorMax count("%Prior.Rooms", "|")
               if ("%Prior.Rooms" = "") then var Prior.Rooms NULL
               put #var UC_priorityRooms %Prior.Rooms
               return
          }
     pause 0.001
     goto PRIORITY_REMOVE_1
#############################################################################################
#############################################################################################
##### FANG COVE MAMMOTH TRAVEL FOR PRIME
TO_ACE_MAMMOTH:
     pause 0.1
     send .travel acen
     waitforre ^YOU ARRIVED\!
     goto ACE_MAMMOTH_CHECK
ACE_MAMMOTH_WAIT:
     action goto ACE_MAMMOTH_CHECK when ^The Merelew driver says\, \"I\'m leaving shortly
     echo *** WAITING FOR A SEA MAMMOTH TO ARRIVE
     if (%Playing = 0) then gosub PLAY
     pause 30
ACE_MAMMOTH_CHECK:
     if !matchre("$roomobjs", "mammoth") then goto ACE_MAMMOTH_WAIT
     pause 0.2
     send join mammoth
     pause 2
ACE_FC_WAIT:
     action remove ^The Merelew driver says\, \"I\'m leaving shortly
     pause 2
     echo *** Travelling on a Sea Mammoth to Fang Cove
     if (%Playing = 0) then gosub PLAY
     pause 30
     if matchre("$zoneid", "150") then goto FANGCOVE2_GO
     goto ACE_FC_WAIT
TO_RATHA_MAMMOTH:
     pause 0.1
     gosub AUTOMOVE 834
     goto RATHA_MAMMOTH_CHECK
RATHA_MAMMOTH_WAIT:
     action goto RATHA_MAMMOTH_CHECK when ^The Merelew driver says\, \"I\'m leaving shortly
     echo *** WAITING FOR A SEA MAMMOTH TO ARRIVE
     if (%Playing = 0) then gosub PLAY
     pause 30
RATHA_MAMMOTH_CHECK:
     if !matchre("$roomobjs", "mammoth") then goto RATHA_MAMMOTH_WAIT
     pause 0.2
     send join mammoth
     pause 2
RATHA_FC_WAIT:
     action remove ^The Merelew driver says\, \"I\'m leaving shortly
     pause 2
     echo *** Travelling on a Sea Mammoth to Fang Cove
     if (%Playing = 0) then gosub PLAY
     pause 30
     if matchre("$zoneid", "150") then goto FANGCOVE2_GO
     goto RATHA_FC_WAIT
#### TO FANG COVE FOR TF
FANGCOVETF_GO:
     if !matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|112|114|116|127)\b") then
          {
               #### ESCAPE TO NEAREST CITY
               var GOSUBBING ON
               var escaping ON
               gosub ESCAPE_NOW
               var GOSUBBING OFF
               #### DONE ESCAPING TO CITY
          }
     if matchre("$zoneid", "\b(1|30|40|42|47|61|66|67|90|99|107|108|112|114|116|127)\b") then
          {
               gosub TO_SEACAVE
               goto FANGCOVE2_GO
          }
     if !matchre("$zoneid", "150") then
          {
               gosub TO_SEACAVE
               goto FANGCOVE2_GO
          }
     echo ##############################################
     echo **** ERROR! UNRECOGNIZED LOCATION FOR PORTAL TO FC!
     echo **** SEND ME LOG OF YOUR LOCATION
     echo ##############################################
     exit
#############################################################################################
#############################################################################################
### ESCAPING MODULES (For Escaping from Areas where Automapper doesn't work properly)
#############################################################################################
#############################################################################################
EHHRSK_ESCAPE:
     if (($roomid >= 734) && ($roomid <= 755)) then goto KRAHEI_ESCAPE_1
     if (($roomid >= 756) && ($roomid <= 770)) then goto KRAHEI_ESCAPE_2
     if (($roomid >= 771) && ($roomid <= 782)) then goto KRAHEI_ESCAPE_3
KRAHEI_ESCAPE_1:
     gosub AUTOMOVE 747
     put go valve
     wait
     pause 0.1
     return
KRAHEI_ESCAPE_2:
     gosub AUTOMOVE 760
     put go valve
     wait
     pause 0.1
     return
KRAHEI_ESCAPE_3:
     gosub AUTOMOVE 771
     put go valve
     wait
     pause 0.1
     return
MAELSHYVE_FORTRESS_ESCAPE:
     echo
     echo ##################################
     echo ** ESCAPING FROM MAELSHYVE'S FORTRESS
     echo ##################################
     echo
     if matchre("$roomname", "(Maelshyve's Fortress, Hall of Malice|Glutton's Rest|Fallen Altar|Great Dais)") then goto MAELSHYVE_FORTRESS_ESCAPE_2
     gosub AUTOMOVE 109
	gosub MOVE south
     gosub circle
     gosub RETREAT
	move south
MAELSHYVE_FORTRESS_ESCAPE_2:
	gosub AUTOMOVE 93
     if ("$roomid" != "93") then gosub AUTOMOVE 93
     pause 0.1
	put touch etching
	pause 0.5
	pause 0.2
	pause 0.5
	gosub MOVE south
     gosub MOVE south
     return
BENEATH_ZAULFUNG_ESCAPE:
     echo
     echo #############################
     echo ** ESCAPING FROM BENEATH ZAULFUNG
     echo #############################
     echo
     pause 0.1
     if (("$guild" = "Cleric") && matchre("%abbrevs", "(?i)PFE") && ($SpellTimer.ProtectionfromEvil.duration < 5)) then
          {
               echo
               echo **** CASTING PFE BEFORE ESCAPING ZAULFUNG
               echo
               if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
               gosub PREPARE PFE 25
               pause 5
               if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
               pause 5
               if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
               pause 4
               if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
               put cast;gesture
               pause 0.5
               pause 0.5
          }
     if ($roomid = 0) then gosub RANDOMMOVE
     pause 0.1
     gosub AUTOMOVE 5
     pause 0.5
     if ("$zoneid" = "31b") then goto BENEATH_ZAULFUNG_ESCAPE
ZAULFUNG_ESCAPE_0:
     gosub AUTOMOVE 121
ZAULFUNG_ESCAPE:
     if (("$guild" = "Cleric") && matchre("%abbrevs", "(?i)PFE") && ($SpellTimer.ProtectionfromEvil.duration < 5)) then
          {
               echo
               echo **** CASTING PFE BEFORE ESCAPING ZAULFUNG
               echo
               if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
               gosub PREPARE PFE 25
               pause 5
               if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
               pause 5
               if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
               pause 4
               if ((%Melee.Range = 1) || (%Pole.Range = 1)) then gosub RETREAT
               put cast;gesture
               pause 0.5
               pause 0.2
          }
### LESSER SHADOW HOUNDS MAZE Map 31a (Rancid Mire)
     if matchre("$roomname", "Trackless Swamp") then gosub ZAULFUNG_ESCAPE_2
     if matchre("$roomname", "Trackless Swamp") then gosub ZAULFUNG_ESCAPE_2
     echo
     echo ###########################################
     echo ** ESCAPING FROM LESSER SHADOW HOUNDS MAZE!
     echo ** LOOKING FOR CURVING PATH
     echo ###########################################
     echo
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMWEIGHT west
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMWEIGHT west
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "curving path") then goto ZAULFUNG_MAZE_2
     goto ZAULFUNG_ESCAPE
ZAULFUNG_MAZE_2:
     pause 0.2
     pause 0.5
     pause 0.2
     send go path
     wait
     pause 0.5
     if matchre("$roomobjs", "curving path\.$") then goto ZAULFUNG_ESCAPE
     return
ZAULFUNG_ESCAPE_2:
     if matchre("$roomdesc", "Rancid mire") then gosub ZAULFUNG_ESCAPE
     echo ##################################
     echo ** ESCAPING FROM SWAMP TROLLS T2
     echo ##################################
     if !$standing then put stand
     gosub RANDOMMOVE
     pause 0.1
     if ($up) then gosub MOVE up
     pause 0.1
     if ($roomid != 0) then return
     gosub RANDOMMOVE
     pause 0.1
     if ($up) then gosub MOVE up
     pause 0.1
     if ($roomid != 0) then return
     gosub RANDOMMOVE
     pause 0.1
     if ($up) then gosub MOVE up
     pause 0.1
     if ($roomid != 0) then return
     goto ZAULFUNG_ESCAPE_2
ZAULFUNG_ESCAPE_3:
     if matchre("$roomname", "Zaulfung, Chickee") then gosub ZAULFUNG_ESCAPE
     echo ##############################
     echo ** ESCAPING FROM SWAMP TROLLS
     echo ##############################
     if !$standing then put stand
     gosub RANDOMMOVE
     pause 0.1
     if ($up) then gosub MOVE up
     pause 0.1
     if ($roomid != 0) then return
     gosub RANDOMMOVE
     pause 0.1
     if ($up) then gosub MOVE up
     pause 0.1
     if ($roomid != 0) then return
     goto ZAULFUNG_ESCAPE_2
BROCKET_ESCAPE:
     echo ##############################
     echo ** ESCAPING BROCKET DEER
     echo ##############################
	 if ($east) then gosub move east
      if ($east) then gosub move east
      if ($east) then gosub move east
      if matchre("$roomobjs", "rolling hill") then
          {
               send climb hill
               pause 0.5
               pause 0.1
          }
      if matchre("$roomobjs", "log fence") then
          {
               send climb fence
               pause 0.5
               gosub move NE
          }
      if ($roomid != 0) then return
      if ($west) then gosub move west
      if ($west) then gosub move west
      if ($west) then gosub move west
      if matchre("$roomobjs", "gentle hill") then
          {
               send climb hill
               pause 0.5
               pause 0.1
          }
	 if ($east) then gosub move east
      if ($east) then gosub move east
      if ($east) then gosub move east
      if matchre("$roomobjs", "log fence") then
          {
               send climb fence
               pause 0.5
               gosub move NE
          }
      if ($roomid != 0) then return
     goto BROCKET_ESCAPE
DEADMAN_ESCAPE:
     echo ################################
     echo ** ESCAPING DEADMAN'S CONFIDE BEACH
     echo ################################
     pause 0.3
     if matchre("$roomdesc", "A cliff wall rises out of sight") then goto DEADMAN_ESCAPE_2
     gosub TRUE_RANDOM_2
     if matchre("$roomdesc", "A cliff wall rises out of sight") then goto DEADMAN_ESCAPE_2
     gosub TRUE_RANDOM_2
     if matchre("$roomdesc", "A cliff wall rises out of sight") then goto DEADMAN_ESCAPE_2
     gosub TRUE_RANDOM_2
     if matchre("$roomdesc", "A cliff wall rises out of sight") then goto DEADMAN_ESCAPE_2
     gosub TRUE_RANDOM_2
     if matchre("$roomdesc", "A cliff wall rises out of sight") then goto DEADMAN_ESCAPE_2
     gosub TRUE_RANDOM_2
     if matchre("$roomdesc", "A cliff wall rises out of sight") then goto DEADMAN_ESCAPE_2
     gosub TRUE_RANDOM_2
     if matchre("$roomdesc", "A cliff wall rises out of sight") then goto DEADMAN_ESCAPE_2
     gosub TRUE_RANDOM_2
     if matchre("$roomdesc", "A cliff wall rises out of sight") then goto DEADMAN_ESCAPE_2
     gosub TRUE_RANDOM_2
     if matchre("$roomdesc", "A cliff wall rises out of sight") then goto DEADMAN_ESCAPE_2
     gosub TRUE_RANDOM_2
     if matchre("$roomdesc", "A cliff wall rises out of sight") then goto DEADMAN_ESCAPE_2
     gosub TRUE_RANDOM_2
     if matchre("$roomdesc", "A cliff wall rises out of sight") then goto DEADMAN_ESCAPE_2
     gosub TRUE_RANDOM_2
     if matchre("$roomdesc", "A cliff wall rises out of sight") then goto DEADMAN_ESCAPE_2
     gosub TRUE_RANDOM_2
     goto DEADMAN_ESCAPE
DEADMAN_ESCAPE_2:
     gosub RETREAT
     pause 0.001
     put climb handhold
     wait
     pause 0.2
     pause 0.2
     put look
     pause 0.2
     if matchre("$roomname", "Deadman's Confide, Beach") then
          {
               gosub TRUE_RANDOM_2
               pause 0.1
               gosub TRUE_RANDOM_2
               pause 0.1
               goto DEADMAN_ESCAPE
          }
     return

USHNISH_ESCAPE:
     echo #############################################
     echo ** ESCAPING FANGS OF USHNISH - SHIFTING MAZE
     echo #############################################
USHNISH_ESCAPE_1:
     pause 0.001
     if matchre("$roomname", "Temple of Ushnish") then goto USHNISH_ESCAPE_TEMPLE
     if matchre("$roomname", "Beyond the Gate of Souls") then goto USHNISH_ESCAPE_3
     gosub RANDOMMOVE
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMNORTH
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMNORTH
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMNORTH
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMSOUTH
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMSOUTH
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMSOUTH
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMSOUTH
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     gosub RANDOMSOUTH
     if matchre("$roomobjs", "steep cliff") then goto USHNISH_ESCAPE_2
     goto USHNISH_ESCAPE_1
USHNISH_ESCAPE_2:
     pause 0.1
     pause 0.1
     put climb cliff
     pause 0.5
     pause 0.2
USHNISH_ESCAPE_TEMPLE:
     echo #############################
     echo ** ESCAPING TEMPLE OF USHNISH
     echo #############################
     pause 0.5
     if matchre("$roomname", "The Fangs of Ushnish") then goto USHNISH_ESCAPE_1
     if matchre("$roomname", "Temple of Ushnish") then gosub AUTOMOVE 224
     if matchre("$roomname", "Before the Temple of Ushnish") then goto USHNISH_ESCAPE_3
USHNISH_ESCAPE_3:
     pause 0.1
     gosub RETREAT
     put go lava field
     pause 0.5
     pause 0.2
USHNISH_ESCAPE_GATE:
     echo #############################################
     echo ** ESCAPING GATE OF SOULS BLASTED PLAINS MAZE
     echo #############################################
USHNISH_ESCAPE_GATE_1:
     gosub RANDOMMOVE
     if matchre("$roomname", "The Fangs of Ushnish") then goto USHNISH_ESCAPE_1
     if matchre("$roomobjs", "low cavern") then goto USHNISH_ESCAPE_4
     gosub RANDOMMOVE
     if matchre("$roomobjs", "low cavern") then goto USHNISH_ESCAPE_4
     gosub RANDOMMOVE
     if matchre("$roomobjs", "low cavern") then goto USHNISH_ESCAPE_4
     gosub RANDOMMOVE
     if matchre("$roomobjs", "low cavern") then goto USHNISH_ESCAPE_4
     gosub RANDOMNORTH
     if matchre("$roomobjs", "low cavern") then goto USHNISH_ESCAPE_4
     gosub RANDOMNORTH
     if matchre("$roomobjs", "low cavern") then goto USHNISH_ESCAPE_4
     gosub RANDOMNORTH
     if matchre("$roomobjs", "low cavern") then goto USHNISH_ESCAPE_4
     gosub RANDOMNORTH
     if matchre("$roomobjs", "low cavern") then goto USHNISH_ESCAPE_4
     gosub RANDOMNORTH
     if matchre("$roomobjs", "low cavern") then goto USHNISH_ESCAPE_4
     goto USHNISH_ESCAPE_GATE_1
USHNISH_ESCAPE_4:
     pause 0.2
     pause 0.1
     send go cavern
     pause 0.5
     pause 0.5
     send lie
     pause 0.2
     send go tunnel
     waitforre Rising in a snubbed tower
     pause 0.2
     gosub STAND
     gosub AUTOMOVE 104
     return
VELAKADUNES_ESCAPE:
     echo #############################
     echo ** ESCAPING FROM VELAKA DUNES MAZE
     echo #############################
VELAKADUNES_ESCAPE_1:
     pause 0.01
     if matchre("$roomobjs", "(?i)path") then
          {
               gosub MOVE go path
               pause 0.3
               gosub AUTOMOVE 2
          }
     gosub RANDOMMOVE
     goto VELAKADUNES_ESCAPE_1
VELAKA_ESCAPE:
     echo ##############################
     echo ** ESCAPING FROM VELAKA DESERT MAZE
     echo ##############################
VELAKA_ESCAPE_1:
     pause 0.001
     if matchre("$roomname", "Walk of Bones") then gosub AUTOMOVE 118
     if matchre("$roomobjs", "rocky trail") then goto VELAKA_ESCAPE_2
     gosub RANDOMWEIGHT west
     if matchre("$roomobjs", "rocky trail") then goto VELAKA_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "rocky trail") then goto VELAKA_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "rocky trail") then goto VELAKA_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "rocky trail") then goto VELAKA_ESCAPE_2
     gosub RANDOMWEIGHT west
     if matchre("$roomobjs", "rocky trail") then goto VELAKA_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "rocky trail") then goto VELAKA_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "rocky trail") then goto VELAKA_ESCAPE_2
     gosub RANDOMMOVE
     if matchre("$roomobjs", "rocky trail") then goto VELAKA_ESCAPE_2
     goto VELAKA_ESCAPE_1
VELAKA_ESCAPE_2:
     send go trail
     wait
     pause 0.1
     return
WARRENS_ESCAPE:
     echo
     echo ########################
     echo ** ESCAPING FROM SHARD WARRENS
     echo ########################
     echo
     pause 0.001
     # if ("$guild" = "Necromancer") then
          # {
               # gosub AUTOMOVE 316
               # gosub AUTOMOVE 29
               # return
          # }
     if ("$guild" = "Thief") then
          {
               gosub AUTOMOVE 279
               gosub AUTOMOVE 292
               gosub AUTOMOVE 596
               pause 0.01
               gosub AUTOMOVE 8
          }
     if ("$guild" != "Thief") then
          {
               gosub AUTOMOVE 279
               gosub AUTOMOVE 316
               gosub AUTOMOVE 29
          }
     if matchre("$roomname", "Undershard") then
          {
               gosub AUTOMOVE 279
               gosub AUTOMOVE 316
               gosub AUTOMOVE 29
          }
     return
MAELSHYVE_ASCENT_ESCAPE:
     echo ##################################
     echo ** ESCAPING FROM MAESHYVE'S ASCENT
     echo ##################################
     if ($hidden = 0) then gosub HIDE
     pause 0.1
     gosub AUTOMOVE 447
     pause 0.2
     if ($roomid != 447) then goto MAELSHYVE_ASCENT_ESCAPE
     send go throne
     pause 8
ABYSSAL_ESCAPE:
     pause
     echo ######################
     echo ** ESCAPING FROM ABYSS
     echo ######################
     pause 0.2
     if ($stunned) then waiteval (!$stunned)
     pause
     gosub AUTOMOVE 199
     return
ADDERNEST_ESCAPE:
     echo ############################
     echo ** ESCAPING FROM ADDER'S NEST
     echo ############################
     pause 0.2
     if matchre("%abbrevs", "(?i)UNCURSE") then gosub ASKETI_ESCAPE_SHORTCUT
     if matchre("$roomname", "Vela'Tohr Woods") then goto ASKETI_ESCAPE_2
     gosub AUTOMOVE 434
     gosub PUT climb open
     gosub PUT go port
     pause 0.5
     pause 0.2
NORTHWIND_ESCAPE:
     echo
     echo #################################
     echo ** ESCAPING FROM TEMPLE NORTH WIND
     echo #################################
     echo
     pause 0.2
     if matchre("%abbrevs", "(?i)UNCURSE") then gosub ASKETI_ESCAPE_SHORTCUT
     if matchre("$roomname", "Vela'Tohr Woods") then goto ASKETI_ESCAPE_2
     pause 0.2
     gosub AUTOMOVE 506
     pause 0.5
     send pull sconce
     pause 0.5
     pause 0.3
     gosub MOVE go door
     pause 0.3
     gosub MOVE SE
     pause 0.3
ASKETI_ESCAPE:
     put #queue clear
     echo
     echo #############################
     echo ** ESCAPING FROM ASKETI'S MOUNT
     echo #############################
     echo
     if matchre("%abbrevs", "(?i)UNCURSE") then gosub ASKETI_ESCAPE_SHORTCUT
     if matchre("$roomname", "Vela'Tohr Woods") then goto ASKETI_ESCAPE_2
     if (("$guild" = "Cleric") && matchre("%abbrevs", "REV")) then goto CLERIC_ASKETI_ESCAPE
ASKETI_ESCAPE_1:
     ### 100 foot cliff
     gosub AUTOMOVE 369
     pause 0.1
     gosub AUTOMOVE 124
     pause 0.1
ASKETI_ESCAPE_2:
     gosub AUTOMOVE south
     return

CLERIC_ASKETI_ESCAPE:
     echo
     echo ################################
     echo # WE KNOW REVELATION!
     echo # TAKING THE CLERIC SHORTCUT
     echo # BYPASSING STUPID GARGOYLE MOUNTAIN
     echo ################################
     echo
     gosub RETREAT
     gosub RELEASE CYCLIC
     gosub PREPARE REV 8
     pause 5
     gosub RETREAT
     pause 5
     gosub RETREAT
     pause 5
     gosub SPELL_CAST
     gosub RETREAT
     pause 0.01
     gosub AUTOMOVE 382
     pause 0.1
     if !matchre("$roomobjs", "spectral shimmer") then goto ASKETI_ESCAPE_1
     pause 0.1
     put go shimmer
     pause 0.3
     pause 0.3
     put go tunnel
     waitforre Pilgrimage Trail|This cellar is packed|Obvious (paths|exits)
     put go cloud
     pause 0.3
     pause 0.3
     gosub AUTOMOVE south
     return
ASKETI_ESCAPE_SHORTCUT:
     var asketiloop 0
     echo
     echo ######################################
     echo # WE KNOW UNCURSE! TAKING THE SHORTCUT
     echo # BYPASSING STUPID GARGOYLE MOUNTAIN
     echo ######################################
     echo
     ASKETI_ESCAPE_SHORTCUT_1:
     pause 0.5
     pause 0.3
     math asketiloop add 1
     if (%asketiloop > 3) then return
     if ($roomid != 449) then gosub AUTOMOVE 449
     pause 0.1
     put prep uncurse 25
     pause 9
     matchre ASKETI_ESCAPE_SHORTCUT_2 ^Bluish\-white tendrils of mist escape as the door swings silently open
     matchre ASKETI_ESCAPE_SHORTCUT_2 ^You sense the curse on the granite door break\!
     matchre ASKETI_ESCAPE_SHORTCUT_2 ^The crystal shard embedded in the granite door flares with an icy brilliance as a gust of frigid wind blasts through the area\.
     matchre ASKETI_ESCAPE_SHORTCUT_2 ^There's not much point in uncursing it when it's not locked\!
     matchre ASKETI_ESCAPE_SHORTCUT_1 ^You sense the curse on the door shudder violently\.
     put cast door
     matchwait 8
     goto ASKETI_ESCAPE_SHORTCUT_1
ASKETI_ESCAPE_SHORTCUT_2:
     pause 0.2
     pause 0.1
     put retreat
     pause 0.3
     pause 0.3
     put retreat
     pause 0.1
     put go door
     pause 0.5
     pause 0.4
     put down
     pause 0.5
     if matchre("$roomname", "Adder's Nest") then goto ASKETI_ESCAPE_SHORTCUT_2
     return
CROC_ESCAPE:
     pause 0.1
     echo ##############################
     echo ** ESCAPING FROM CROCODILE MAZE
     echo ##############################
     var croc.count 0
     var direction sw
     goto CROC_MOVE
CROC_RET:
     gosub retreat
     pause 0.1
CROC_MOVE:
     math croc.count add 1
     if (%croc.count > 6) && ("%direction" = "sw") then
          {
               var direction north
               var croc.count 0
          }
     if (%croc.count > 6) && ("%direction" = "north") then
          {
               var direction south
               var croc.count 0
          }
     if (%croc.count > 6) && ("%direction" = "south") then
          {
               var direction east
               var croc.count 0
          }
     if (%croc.count > 6) && ("%direction" = "east") then
          {
               var direction sw
               var croc.count 0
          }
     pause 0.0001
     pause 0.0001
     matchre CROC_RET ^You are engaged
     matchre CROC_MOVE ^\.\.\.wait|^Sorry, you may only type|^You.*are.*still.*stunned\.
     matchre REEDGO ^Roundtime
     put %direction
     matchwait 20
     goto CROC_MOVE
REEDGO:
     pause .0001
     pause .0001
     matchre CROC_RET ^You are engaged
     matchre REEDGO ^\.\.\.wait|^Sorry, you may only type|^You.*are.*still.*stunned\.
     matchre CROC_MOVE ^\[The Marsh\, In The Water\]|^What were you
     matchre OUT_OF_CROCS ^\[The Marsh\, Stone Road\]
     put go reed
     matchwait 20
     goto CROC_MOVE
OUT_OF_CROCS:
     pause .0001
     pause .0001
     put south
     wait
     pause 0.1
     put south
     wait
     pause 0.1
     put south
     wait
     put southeast
     pause 0.5
     if matchre("$roomname", "The Marsh, In The Water") then goto CROC_ESCAPE
     put #parse OUT OF CROCS
     pause 0.5
     return

###############################################################################################
UNKNOWN_CRITTER:
     put #echo >Log #ff0000 **** ERROR! DID NOT RECOGNIZE YOUR COMBAT CRITTER!
     put #echo >Log #ff0000 **** DO NOT PASS GO! DO NOT COLLECT 200 DOLLARS!
     put #echo >Log #ff0000 **** ABORTING SCRIPT! EDIT YOUR VARIABLES
     echo
     echo ######################################################
     echo # ~ ERROR! DID NOT RECOGNIZE YOUR COMBAT CRITTER: $UC_combatCritter
     echo # ~ EDIT YOUR VARIABLES TO INCLUDE CORRECT NAME OF CREATURE
     echo ######################################################
     echo # ~ As a general rule - Use the full proper name of the creature
     echo # ~ Ignore any special characters ( - ' : ) and just use LETTERS and NUMBERS
     echo # - IF IT IS A CRITTER WITH MULTIPLE TIERS, YOU MUST USE NUMBERS AT THE END!
     echo # - Example: "SNOW GOBLINS 2" OR "SNOW GOBLIN T2" - "SWAMP TROLL 1"  etc
     echo ######################################################
     echo # Common Matches for Tiered Critters:
     echo # Lout 1, Rat 1, (Crossing louts and Rats)
     echo # Lout 2, (SHARD)  Rat 2 (Fang Cove)
     echo # CELPEZE 1, CELPEZE 2, CELPEZE 3, CELPEZE 4
     echo # ATIKET 1, ATIKET 2, ATIKET 3
     echo # PRERENI 1, PRERENI 2, PRERENI 3 (elder)
     echo ######################################################
     echo
     pause 2
     echo
     echo ####################################################
     echo # PLEASE NOTE THAT ONLY ~99% OF CREATURES ARE SUPPORTED,
     echo # A FEW SPECIFIC CREATURES ARE INTENTIONALLY EXLUDED
     echo # BECAUSE THEY ARE TOO HARD TO GET IN AND OUT OF, OR REQUIRE SPECIAL ITEMS
     echo # OR DESTROY YOUR ITEMS OR HAVE EXTREMELY HIGH CHANCE OF DEATH ETC..
     echo # Examples: The Hive (Vykathi), Drowned Ones, Sharks, The Lost Ground
     echo #####################################################
     echo
     echo #############################################################
     echo ! ~ Note that travelling to/from Islands to Mainland may not work properly
     echo ! ~ Until the Travel script is further updated and robustified to include island travel
     echo ! ~ If you want to hunt on an island, then start it from that island for now
     echo #############################################################
     exit
PIRATE_ERROR:
     echo ######################################################
     echo ** ERROR! You do not appear to be on a ship to hunt pirates
     echo ** Edit your COMBAT.CRITTER variable
     echo ######################################################
     exit
NO_YOUNG_CAVETROLL:
     echo
     echo ################################################
     echo ** ERROR! NOT ENOUGH ATHLETICS TO GET IN/OUT OF YOUNG CAVE TROLLS!
     echo ** YOU NEED AT LEAST 80 TO BE SAFE ( Current Athletics: $Athletics.Ranks )
     echo ** CHOOSE A DIFFERENT COMBAT CRITTER! SUGGESTED CRITTERS IN THIS RANGE:
     echo ** KOBOLD SAVAGE / GRANITE GARGOYLE / SILVER LEUCRO
     echo ################################################
     echo
     put #echo >Log #ffff99 *** ERROR! Not enough Athletics for Young Cave Trolls! Pick different critter.
     exit
NO_CAVETROLL:
     echo
     echo ##################################################
     echo ** ERROR! NOT ENOUGH ATHLETICS TO GET IN/OUT OF CAVE TROLLS!
     echo ** YOU NEED AT LEAST ~200 TO BE SAFE ( Current Athletics: $Athletics.Ranks )
     echo ** CHOOSE A DIFFERENT COMBAT CRITTER! SUGGESTED CRITTERS IN THIS RANGE:
     echo ** ICE ADDER / PRERENI T3 / ADANF BLOOD WARRIOR
     echo ##################################################
     echo
     put #echo >Log #ffff99 *** ERROR! Not enough Athletics for Cave Trolls! Pick different critter.
     exit
################################################################################################################################
################################################################################################################################
################################################################################################################################
# AUTO PROGRESS MODULE
################################################################################################################################
################################################################################################################################
### MAIN COMBAT AUTO PROGRESS CALCULATOR ( AVERAGE DEFENSE AND WEAPON SKILLS )
AUTO_PROGRESSION:
     if (%numberOfAllCombats < 1) then return
     if (%skillcount < 1) then return
     # debug 10
     pause 0.001
     pause 0.001
     var PROGRESS.MODE BASE
     var DEFENSE1 $Evasion.Ranks
     var DEFENSE2 $Parry_Ability.Ranks
     var DEFENSE3 $Defending.Ranks
     var DEFENSE4 $Shield_Usage.Ranks
     evalmath BaseDefense (%DEFENSE1+%DEFENSE2+%DEFENSE3+%DEFENSE4)/4
     echo
     echo #############################
     echo * AUTO-PROGRESSION MODULE INITIATED!
     echo * CALCULATING AUTO PROGRESSION RANKS
     echo * (AVERAGE OF ALL WEAPONS AND ARMORS)
     echo #############################
     echo
     pause 0.1
     pause 0.001
     gosub HighRate_Check
AUTO_CALCULATE:
     if (%numberOfAllCombats < 2) then
          {
               echo *** Top Weapon: %HighSkill
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               evalmath BaseWeapons round((%TopWeapon),2)
               evalmath TotalProgression (%BaseDefense+%BaseWeapons)/2
               goto AUTOMODE_CHOOSE
          }
     if (%numberOfAllCombats = 2) then
          {
               echo *** Top Weapon: %HighSkill
               echo *** Lowest Weapon: %combatsToTrain(0)
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               gosub MASTERY_SET %combatsToTrain(0) FourthWeapon
               evalmath BaseWeapons (%TopWeapon+%FourthWeapon)/1.7
               evalmath TotalProgression (%BaseDefense+%BaseWeapons)/2
               goto AUTOMODE_CHOOSE
          }
     if (%numberOfAllCombats = 3) then
          {
               echo *** Top Weapon: %HighSkill
               echo *** 2nd Lowest Weapon: %SecondHigh
               echo *** Lowest Weapon: %combatsToTrain(0)
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               gosub MASTERY_SET %SecondHigh SecondWeapon
               gosub MASTERY_SET %combatsToTrain(0) ThirdWeapon
               evalmath BaseWeapons (%TopWeapon+%SecondWeapon+%ThirdWeapon)/2.7
               evalmath TotalProgression (%BaseDefense+%BaseWeapons)/2
               goto AUTOMODE_CHOOSE
          }
     if (%numberOfAllCombats = 4) then
          {
               echo *** Top Weapon: %HighSkill
               echo *** 2nd Highest Weapon: %SecondHigh
               echo *** 2nd Lowest Weapon: %combatsToTrain(1)
               echo *** Lowest Weapon: %combatsToTrain(0)
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               gosub MASTERY_SET %SecondHigh SecondWeapon
               gosub MASTERY_SET %combatsToTrain(1) ThirdWeapon
               gosub MASTERY_SET %combatsToTrain(0) FourthWeapon
               evalmath BaseWeapons (%TopWeapon+%SecondWeapon+%ThirdWeapon+%FourthWeapon)/3.7
               evalmath TotalProgression (%BaseDefense+%BaseWeapons)/2
               pause 0.2
          }
     if (%numberOfAllCombats = 5) then
          {
               echo *** Top Weapon: %HighSkill
               echo *** 2nd Highest Weapon: %SecondHigh
               echo *** 3rd Lowest Weapon: %combatsToTrain(2)
               echo *** 2nd Lowest Weapon: %combatsToTrain(1)
               echo *** Lowest Weapon: %combatsToTrain(0)
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               gosub MASTERY_SET %SecondHigh SecondWeapon
               gosub MASTERY_SET %combatsToTrain(2) ThirdWeapon
               gosub MASTERY_SET %combatsToTrain(1) FourthWeapon
               gosub MASTERY_SET %combatsToTrain(0) FifthWeapon
               evalmath BaseWeapons (%TopWeapon+%SecondWeapon+%ThirdWeapon+%FourthWeapon+%FifthWeapon)/4.7
               evalmath TotalProgression (%BaseDefense+%BaseWeapons)/2
               pause 0.2
          }
     if (%numberOfAllCombats = 6) then
          {
               echo *** Top Weapon: %HighSkill
               echo *** 2nd Highest Weapon: %SecondHigh
               echo *** 3rd Highest Weapon: %ThirdHigh
               echo *** 3rd Lowest Weapon: %combatsToTrain(2)
               echo *** 2nd Lowest Weapon: %combatsToTrain(1)
               echo *** Lowest Weapon: %combatsToTrain(0)
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               gosub MASTERY_SET %SecondHigh SecondWeapon
               gosub MASTERY_SET %ThirdHigh ThirdWeapon
               gosub MASTERY_SET %combatsToTrain(2) FourthWeapon
               gosub MASTERY_SET %combatsToTrain(1) FifthWeapon
               gosub MASTERY_SET %combatsToTrain(0) SixthWeapon
               evalmath BaseWeapons (%TopWeapon+%SecondWeapon+%ThirdWeapon+%FourthWeapon+%FifthWeapon+%SixthWeapon)/5.7
               evalmath TotalProgression (%BaseDefense+%BaseWeapons)/2
               pause 0.2
          }
     if (%numberOfAllCombats = 7) then
          {
               echo *** Top Weapon: %HighSkill
               echo *** 2nd Highest Weapon: %SecondHigh
               echo *** 3rd Highest Weapon: %ThirdHigh
               echo *** 4th Lowest Weapon: %combatsToTrain(3)
               echo *** 3rd Lowest Weapon: %combatsToTrain(2)
               echo *** 2nd Lowest Weapon: %combatsToTrain(1)
               echo *** Lowest Weapon: %combatsToTrain(0)
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               gosub MASTERY_SET %SecondHigh SecondWeapon
               gosub MASTERY_SET %ThirdHigh ThirdWeapon
               gosub MASTERY_SET %combatsToTrain(3) FourthWeapon
               gosub MASTERY_SET %combatsToTrain(2) FifthWeapon
               gosub MASTERY_SET %combatsToTrain(1) SixthWeapon
               gosub MASTERY_SET %combatsToTrain(0) SeventhWeapon
               evalmath BaseWeapons (%TopWeapon+%SecondWeapon+%ThirdWeapon+%FourthWeapon+%FifthWeapon+%SixthWeapon+%SeventhWeapon)/6.7
               evalmath TotalProgression (%BaseDefense+%BaseWeapons)/2
               pause 0.2
          }
     if (%numberOfAllCombats > 7) then
          {
               echo *** Top Weapon: %HighSkill
               echo *** 2nd Highest Weapon: %SecondHigh
               echo *** 3rd Highest Weapon: %ThirdHigh
               echo *** 4th Highest Weapon: %FourthHigh
               echo *** 4th Lowest Weapon: %combatsToTrain(3)
               echo *** 3rd Lowest Weapon: %combatsToTrain(2)
               echo *** 2nd Lowest Weapon: %combatsToTrain(1)
               echo *** Lowest Weapon: %combatsToTrain(0)
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               gosub MASTERY_SET %SecondHigh SecondWeapon
               gosub MASTERY_SET %ThirdHigh ThirdWeapon
               gosub MASTERY_SET %FourthHigh FourthWeapon
               gosub MASTERY_SET %combatsToTrain(3) FifthWeapon
               gosub MASTERY_SET %combatsToTrain(2) SixthWeapon
               gosub MASTERY_SET %combatsToTrain(1) SeventhWeapon
               gosub MASTERY_SET %combatsToTrain(0) EighthWeapon
               evalmath BaseWeapons (%TopWeapon+%SecondWeapon+%ThirdWeapon+%FourthWeapon+%FifthWeapon+%SixthWeapon+%SeventhWeapon+%EighthWeapon)/7.7
               evalmath TotalProgression (%BaseDefense+%BaseWeapons)/2
               pause 0.2
          }
     goto AUTOMODE_CHOOSE
###############################################################
### AUTO PROGRESS BACKTRAIN CALCULATOR (WEAPONS ONLY)
AUTO_PROGRESSION_BACKTRAIN:
     # debug 10
     pause 0.001
     pause 0.001
     var DEFENSE1 $Evasion.Ranks
     var DEFENSE2 $Parry_Ability.Ranks
     var DEFENSE3 $Defending.Ranks
     var DEFENSE4 $Shield_Usage.Ranks
     evalmath BaseDefense (%DEFENSE1+%DEFENSE2+%DEFENSE3+%DEFENSE4)/4
     echo #######################################
     echo *** AUTO PROGRESSION ~BACKTRAIN~ MODULE INITIATED!
     echo *** CALCULATING BACKTRAIN WEAPONS AVERAGE...
     echo #######################################
     pause 0.2
     pause 0.2
     gosub HighRate_Check
     pause 0.2
     if (%numberOfAllCombats < 2) then
          {
               echo *** Top Weapon: %HighSkill
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               var BaseWeapons %TopWeapon
               var TotalProgression %BaseWeapons
               goto AUTOMODE_CHOOSE
          }
     if (%numberOfAllCombats = 2) then
          {
               echo *** Top Weapon: %HighSkill
               echo *** Lowest Weapon: %combatsToTrain(0)
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               gosub MASTERY_SET %combatsToTrain(0) FourthWeapon
               evalmath BaseWeapons (%TopWeapon+%FourthWeapon)/1.8
               var TotalProgression %BaseWeapons
               goto AUTOMODE_CHOOSE
          }
     if (%numberOfAllCombats = 3) then
          {
               echo *** Top Weapon: %HighSkill
               echo *** 2nd Lowest Weapon: %SecondHigh
               echo *** Lowest Weapon: %combatsToTrain(0)
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               gosub MASTERY_SET %SecondHigh SecondWeapon
               gosub MASTERY_SET %combatsToTrain(0) FourthWeapon
               evalmath BaseWeapons (%TopWeapon+%SecondWeapon+%FourthWeapon)/2.8
               var TotalProgression %BaseWeapons
               goto AUTOMODE_CHOOSE
          }
     if (%numberOfAllCombats = 4) then
          {
               echo *** Top Weapon: %HighSkill
               echo *** 2nd Highest Weapon: %SecondHigh
               echo *** 2nd Lowest Weapon: %combatsToTrain(1)
               echo *** Lowest Weapon: %combatsToTrain(0)
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               gosub MASTERY_SET %SecondHigh SecondWeapon
               gosub MASTERY_SET %combatsToTrain(1) ThirdWeapon
               gosub MASTERY_SET %combatsToTrain(0) FourthWeapon
               evalmath BaseWeapons (%TopWeapon+%SecondWeapon+%ThirdWeapon+%FourthWeapon)/3.8
               var TotalProgression %BaseWeapons
          }
     if (%numberOfAllCombats >= 5) then
          {
               echo *** Top Weapon: %HighSkill
               echo *** 2nd Highest Weapon: %SecondHigh
               echo *** 3rd Lowest Weapon: %combatsToTrain(2)
               echo *** 2nd Lowest Weapon: %combatsToTrain(1)
               echo *** Lowest Weapon: %combatsToTrain(0)
               echo
               echo *** SETTING EFFECTIVE RANKS BASED ON MASTERY
               gosub MASTERY_SET %HighSkill TopWeapon
               gosub MASTERY_SET %SecondHigh SecondWeapon
               gosub MASTERY_SET %combatsToTrain(2) ThirdWeapon
               gosub MASTERY_SET %combatsToTrain(1) FourthWeapon
               gosub MASTERY_SET %combatsToTrain(0) FifthWeapon
               evalmath BaseWeapons (%TopWeapon+%SecondWeapon+%ThirdWeapon+%FourthWeapon+%FifthWeapon)/4.8
               var TotalProgression %BaseWeapons
          }
     goto AUTOMODE_CHOOSE
#############################################################################################
### AUTO PROGRESSION MODE CHOOSE AND SET COMBAT CREATURE
AUTOMODE_CHOOSE:
     var PROGRESS.MODE BASE
     evalmath TotalProgression round((%TotalProgression),2)
     evalmath BaseWeapons round((%BaseWeapons),2)
     evalmath BaseDefense round((%BaseDefense),2)
     if (%Backtraining = 0) then
          {
               if matchre("%PROGRESS.TYPE", "(?i)SKIN") then var PROGRESS.MODE SKIN
               if matchre("%PROGRESS.TYPE", "\b(?i)F2P\b") then var PROGRESS.MODE F2P
               if matchre("%PROGRESS.TYPE", "\b(?i)(F2PLOCK|F2PLOCKPICK)\b") then var PROGRESS.MODE F2P_LOCK
               if matchre("%PROGRESS.TYPE", "(?i)EMPATH") then var PROGRESS.MODE EMPATH
               if matchre("%PROGRESS.TYPE", "(?i)NECRO") then var PROGRESS.MODE NECRO
               if matchre("%PROGRESS.TYPE", "\b(?i)(LOCKPICK|LOCK)\b") then var PROGRESS.MODE LOCKPICK
               if matchre("%PROGRESS.TYPE", "(?i)(NORMAL|BASE)") then var PROGRESS.MODE BASE
               if matchre("%PROGRESS.TYPE", "(?i)(MM|MOON)") then var PROGRESS.MODE MM
               if matchre("%PROGRESS.TYPE", "(?i)(UNDEAD|CLERIC)") then var PROGRESS.MODE UNDEAD
               pause 0.0001
               goto AUTOMODE_CHOOSE_1
          }
     if (%Backtraining = 1) then
          {
               if matchre("%BACKTRAIN.PROGRESS.TYPE", "(?i)SKIN") then var PROGRESS.MODE SKIN
               if matchre("%BACKTRAIN.PROGRESS.TYPE", "\b(?i)F2P\b") then var PROGRESS.MODE F2P
               if matchre("%BACKTRAIN.PROGRESS.TYPE", "\b(?i)(F2PLOCK|F2PLOCKPICK)\b") then var PROGRESS.MODE F2P_LOCK
               if matchre("%BACKTRAIN.PROGRESS.TYPE", "(?i)EMPATH") then var PROGRESS.MODE EMPATH
               if matchre("%BACKTRAIN.PROGRESS.TYPE", "(?i)NECRO") then var PROGRESS.MODE NECRO
               if matchre("%BACKTRAIN.PROGRESS.TYPE", "\b(?i)(LOCKPICK|LOCK)\b") then var PROGRESS.MODE LOCKPICK
               if matchre("%BACKTRAIN.PROGRESS.TYPE", "(?i)(NORMAL|BASE)") then var PROGRESS.MODE BASE
               if matchre("%BACKTRAIN.PROGRESS.TYPE", "(?i)(MM|MOON)") then var PROGRESS.MODE MM
               if matchre("%PROGRESS.TYPE", "(?i)(UNDEAD|CLERIC)") then var PROGRESS.MODE UNDEAD
          }
AUTOMODE_CHOOSE_1:
     echo
     echo ########################
     echo *** DEFENSIVE RANKS:
     echo ** Evasion: $Evasion.Ranks / Shield: $Shield_Usage.Ranks
     echo ** Parry: $Parry_Ability.Ranks / Defending: $Defending.Ranks
     echo ########################
     echo
     echo ########################
     echo *** WEAPONS AVERAGE: %BaseWeapons
     if (%Backtraining = 0) then echo *** DEFENSIVE AVERAGE: %BaseDefense
     echo *** TOTAL PROGRESSION RANKS: %TotalProgression
     if (($UC_AutoProgress = 0) && (%Backtraining = 0)) then
          {
               put #echo >Log #00FF80 *** Auto-Progress is (OFF) - Progression Ranks: %TotalProgression
               return
          }
     if (($UC_AutoProgress.Backtrain = 0) && (%Backtraining = 1)) then
          {
               put #echo >Log #00FF80 *** Auto-Progress Backtrain is (OFF) - Progression Ranks: %TotalProgression
               return
          }
     put #echo >Log #00FF80 *** AUTO-PROGRESS (%PROGRESS.TYPE) - Progression Ranks: %TotalProgression
     echo *** PROGRESS MODE: %PROGRESS.MODE
     echo *** CHOOSING CREATURE BASED ON MODE & RANKS
     echo ########################
     pause 0.1
     gosub %PROGRESS.MODE_PROGRESSION
     pause 0.0001
     if (%Backtraining = 1) then var BACKTRAIN.CRITTER %COMBAT.CRITTER
     echo
     echo ###########################
     if (%Backtraining = 1) then echo *** BACKTRAIN CREATURE: %COMBAT.CRITTER
     if (%Backtraining = 0) then echo *** COMBAT CREATURE: %COMBAT.CRITTER
     echo ###########################
     echo
     pause 0.0001
     gosub STATUSBAR
     pause 0.0001
     return
##############################################################################
### MAIN AUTO PROGRESS LOGIC - SET CREATURE TYPES BASED ON RANKS / MODE
##############################################################################
### FULL ACCOUNT - STANDARD PROGRESSION (MIXED SKIN/BOX MOBS - OPTIMAL SPAWNS)
BASE_PROGRESSION:
     if (%TotalProgression < 20) then var COMBAT.CRITTER RAT 1
     if ((%TotalProgression > 18) && (%TotalProgression <= 30)) then var COMBAT.CRITTER SCAVENGER GOBLIN
     if ((%TotalProgression > 30) && (%TotalProgression <= 36)) then var COMBAT.CRITTER GOBLIN SHAMAN
     if ((%TotalProgression > 36) && (%TotalProgression <= 43)) then var COMBAT.CRITTER GRASS EEL
     if ((%TotalProgression > 43) && (%TotalProgression <= 52) && ("$guild" != "Moon Mage")) then var COMBAT.CRITTER REAVER
     if ((%TotalProgression > 43) && (%TotalProgression <= 52) && ("$guild" = "Moon Mage")) then var COMBAT.CRITTER SLAI SCOUT
     if ((%TotalProgression > 52) && (%TotalProgression <= 60) && ("$guild" != "Moon Mage")) then var COMBAT.CRITTER BEISSWURM
     if ((%TotalProgression > 52) && (%TotalProgression <= 60) && ("$guild" = "Moon Mage")) then var COMBAT.CRITTER MALODOROUS BUCCA
     if ((%TotalProgression > 60) && (%TotalProgression <= 72) && ($circle < 5)) then var COMBAT.CRITTER COPPERHEAD VIPER
     if ((%TotalProgression > 60) && (%TotalProgression <= 72) && ($circle >= 5)) then var COMBAT.CRITTER ROCK TROLL 1
     if ((%TotalProgression > 70) && (%TotalProgression <= 88)) then var COMBAT.CRITTER ENDRUS SERPENT
     if ((%TotalProgression > 85) && (%TotalProgression <= 100)) then var COMBAT.CRITTER SNOWBEAST
     if ((%TotalProgression > 100) && (%TotalProgression <= 120)) then var COMBAT.CRITTER GRANITE GARGOYLE
     if ((%TotalProgression > 120) && (%TotalProgression <= 125)) then var COMBAT.CRITTER CROCODILE
     if ((%TotalProgression > 125) && (%TotalProgression <= 135) && !matchre("$guild", "%MAGICUSER")) then var COMBAT.CRITTER SWAMP TROLL 1
     if ((%TotalProgression > 125) && (%TotalProgression <= 140) && matchre("$guild", "%MAGICUSER")) then var COMBAT.CRITTER THICKET VIPER
     if ((%TotalProgression > 135) && (%TotalProgression <= 148)) then var COMBAT.CRITTER RIVER SPRITE
     if ((%TotalProgression > 148) && (%TotalProgression <= 175)) then var COMBAT.CRITTER PRERENI T1
     if ((%TotalProgression > 175) && (%TotalProgression <= 205)) then var COMBAT.CRITTER TWISTED DRYAD
     if ((%TotalProgression > 205) && (%TotalProgression <= 220)) then var COMBAT.CRITTER RED LEUCRO
     if ((%TotalProgression > 220) && (%TotalProgression <= 240)) then var COMBAT.CRITTER PRERENI T2
     if ((%TotalProgression > 240) && (%TotalProgression <= 290) && ($Athletics.Ranks >= 300)) then var COMBAT.CRITTER ICE ADDER
     if ((%TotalProgression > 240) && (%TotalProgression <= 290) && ($Athletics.Ranks < 300)) then var COMBAT.CRITTER PRERENI T3
     if ((%TotalProgression > 290) && (%TotalProgression <= 340)) then var COMBAT.CRITTER SHADOW MAGE
     if ((%TotalProgression > 340) && (%TotalProgression <= 400)) then var COMBAT.CRITTER YOUNG FOREST GRYPHON
     if ((%TotalProgression > 400) && (%TotalProgression <= 430)) then var COMBAT.CRITTER CLOUD RAT
     if ((%TotalProgression > 420) && (%TotalProgression <= 520) && ($Athletics.Ranks >= 300)) then var COMBAT.CRITTER BLACK MARBLE GARGOYLE
     if ((%TotalProgression > 420) && (%TotalProgression <= 520) && ($Athletics.Ranks < 300)) then var COMBAT.CRITTER DP ZEALOT
     if ((%TotalProgression > 500) && (%TotalProgression <= 530)) then var COMBAT.CRITTER SPIRIT DANCER
     if ((%TotalProgression > 520) && (%TotalProgression <= 560)) then var COMBAT.CRITTER ZOMBIE STOMPER
     if ((%TotalProgression > 560) && (%TotalProgression <= 600)) then var COMBAT.CRITTER ZOMBIE MAULER
     if ((%TotalProgression > 600) && (%TotalProgression <= 715)) then var COMBAT.CRITTER ZOMBIE HEAD SPLITTER
     if ((%TotalProgression > 715) && (%TotalProgression <= 850)) then var COMBAT.CRITTER YOUNG WYVERN
     if ((%TotalProgression > 850) && (%TotalProgression <= 980)) then var COMBAT.CRITTER JUVENILE WYVERN
     if ((%TotalProgression > 980) && (%TotalProgression <= 1080)) then var COMBAT.CRITTER DP ASSASSIN
     if ((%TotalProgression > 1080) && (%TotalProgression <= 1250)) then var COMBAT.CRITTER INTERCESSOR
     if ((%TotalProgression > 1250) && (%TotalProgression <= 1650)) then var COMBAT.CRITTER CABALIST
     if ((%TotalProgression > 1650) && (%TotalProgression <= 3000)) then var COMBAT.CRITTER BONE WYVERN
     return
#### FULL ACCOUNT - PURE SKINNING PROGRESSION
SKIN_PROGRESSION:
     if (%TotalProgression < 20) then var COMBAT.CRITTER RAT 1
     if ((%TotalProgression > 18) && (%TotalProgression <= 30)) then var COMBAT.CRITTER SCAVENGER GOBLIN
     if ((%TotalProgression > 30) && (%TotalProgression <= 36)) then var COMBAT.CRITTER GOBLIN SHAMAN
     if ((%TotalProgression > 36) && (%TotalProgression <= 43)) then var COMBAT.CRITTER GRASS EEL
     if ((%TotalProgression > 43) && (%TotalProgression <= 52)) then var COMBAT.CRITTER REAVER
     if ((%TotalProgression > 52) && (%TotalProgression <= 60)) then var COMBAT.CRITTER BEISSWURM
     if ((%TotalProgression > 60) && (%TotalProgression <= 70)) then var COMBAT.CRITTER BONE WOLF
     if ((%TotalProgression > 70) && (%TotalProgression <= 88)) then var COMBAT.CRITTER ENDRUS SERPENT
     if ((%TotalProgression > 85) && (%TotalProgression <= 100)) then var COMBAT.CRITTER SNOWBEAST
     if ((%TotalProgression > 100) && (%TotalProgression <= 120)) then var COMBAT.CRITTER GRANITE GARGOYLE
     if ((%TotalProgression > 120) && (%TotalProgression <= 125)) then var COMBAT.CRITTER CROCODILE
     if ((%TotalProgression > 125) && (%TotalProgression <= 155)) then var COMBAT.CRITTER THICKET VIPER
     if ((%TotalProgression > 155) && (%TotalProgression <= 175)) then var COMBAT.CRITTER PRERENI T1
     if ((%TotalProgression > 175) && (%TotalProgression <= 200)) then var COMBAT.CRITTER SWAMP TROLL T2
     if ((%TotalProgression > 200) && (%TotalProgression <= 220)) then var COMBAT.CRITTER RED LEUCRO
     if ((%TotalProgression > 220) && (%TotalProgression <= 230)) then var COMBAT.CRITTER VICIOUS WARCAT
     if ((%TotalProgression > 230) && (%TotalProgression <= 245)) then var COMBAT.CRITTER PRERENI T2
     if ((%TotalProgression > 245) && (%TotalProgression <= 290) && ($Athletics.Ranks >= 300)) then var COMBAT.CRITTER ICE ADDER
     if ((%TotalProgression > 245) && (%TotalProgression <= 290) && ($Athletics.Ranks < 300)) then var COMBAT.CRITTER PRERENI T3
     if ((%TotalProgression > 280) && (%TotalProgression <= 360)) then var COMBAT.CRITTER SHADOW MAGE
     if ((%TotalProgression > 360) && (%TotalProgression <= 410)) then var COMBAT.CRITTER YOUNG FOREST GRYPHON
     if ((%TotalProgression > 380) && (%TotalProgression <= 420)) then var COMBAT.CRITTER CLOUD RAT
     if ((%TotalProgression > 420) && (%TotalProgression <= 520) && ($Athletics.Ranks >= 300)) then var COMBAT.CRITTER BLACK MARBLE GARGOYLE
     if ((%TotalProgression > 420) && (%TotalProgression <= 520) && ($Athletics.Ranks < 300)) then var COMBAT.CRITTER ARMORED WARKLIN
     if ((%TotalProgression > 510) && (%TotalProgression <= 540)) then var COMBAT.CRITTER SPIRIT DANCER
     if ((%TotalProgression > 540) && (%TotalProgression <= 650)) then var COMBAT.CRITTER SSUGI MALCHATA
     if ((%TotalProgression > 650) && (%TotalProgression <= 850)) then var COMBAT.CRITTER YOUNG WYVERN
     if ((%TotalProgression > 850) && (%TotalProgression <= 1050)) then var COMBAT.CRITTER JUVENILE WYVERN
     if ((%TotalProgression > 1050) && (%TotalProgression <= 1250)) then var COMBAT.CRITTER ADULT WYVERN
     if ((%TotalProgression > 1250) && (%TotalProgression <= 1500)) then var COMBAT.CRITTER FULIGIN MOTH
     if ((%TotalProgression > 1500) && (%TotalProgression <= 3000)) then var COMBAT.CRITTER BONE WYVERN
     return
#### FULL ACCOUNT - PURE LOCKSMITHING PROGRESSION (EXCEPT FOR MAJOR COMBAT GAPS)
LOCKPICK_PROGRESSION:
     if (%TotalProgression < 20) then var COMBAT.CRITTER LOUT 1
     if ((%TotalProgression > 18) && (%TotalProgression <= 30)) then var COMBAT.CRITTER SCAVENGER GOBLIN
     if ((%TotalProgression > 30) && (%TotalProgression <= 40)) then var COMBAT.CRITTER BLOOD DRYAD
     if ((%TotalProgression > 40) && (%TotalProgression <= 52)) then var COMBAT.CRITTER REAVER
     if ((%TotalProgression > 52) && (%TotalProgression <= 64)) then var COMBAT.CRITTER MALODOROUS BUCCA
     if ((%TotalProgression > 62) && (%TotalProgression <= 72) && ($circle < 5)) then var COMBAT.CRITTER COPPERHEAD VIPER
     if ((%TotalProgression > 62) && (%TotalProgression <= 72) && ($circle >= 5)) then var COMBAT.CRITTER ROCK TROLL 1
     if ((%TotalProgression > 70) && (%TotalProgression <= 88)) then var COMBAT.CRITTER ENDRUS SERPENT
     if ((%TotalProgression > 85) && (%TotalProgression <= 100)) then var COMBAT.CRITTER FIRE MAIDEN
     if ((%TotalProgression > 100) && (%TotalProgression <= 125)) then var COMBAT.CRITTER GRANITE GARGOYLE
     if ((%TotalProgression > 125) && (%TotalProgression <= 145)) then var COMBAT.CRITTER SWAMP TROLL T1
     if ((%TotalProgression > 145) && (%TotalProgression <= 170)) then var COMBAT.CRITTER RIVER SPRITE
     if ((%TotalProgression > 170) && (%TotalProgression <= 200)) then var COMBAT.CRITTER SWAMP TROLL T2
     if ((%TotalProgression > 200) && (%TotalProgression <= 220)) then var COMBAT.CRITTER ORC SCOUT
     if ((%TotalProgression > 220) && (%TotalProgression <= 300)) then var COMBAT.CRITTER ORC BANDIT
     if ((%TotalProgression > 300) && (%TotalProgression <= 340)) then var COMBAT.CRITTER ORC REIVER
     if ((%TotalProgression > 340) && (%TotalProgression <= 420)) then var COMBAT.CRITTER DRAGON PRIEST CRONE
     if ((%TotalProgression > 420) && (%TotalProgression <= 520) && ($Athletics.Ranks >= 300)) then var COMBAT.CRITTER BLACK MARBLE GARGOYLE
     if ((%TotalProgression > 420) && (%TotalProgression <= 520) && ($Athletics.Ranks < 300)) then var COMBAT.CRITTER DP ZEALOT
     if ((%TotalProgression > 500) && (%TotalProgression <= 530)) then var COMBAT.CRITTER SPIRIT DANCER
     if ((%TotalProgression > 530) && (%TotalProgression <= 570)) then var COMBAT.CRITTER ZOMBIE STOMPER
     if ((%TotalProgression > 570) && (%TotalProgression <= 600)) then var COMBAT.CRITTER ZOMBIE MAULER
     if ((%TotalProgression > 600) && (%TotalProgression <= 715)) then var COMBAT.CRITTER ZOMBIE HEAD SPLITTER
     if ((%TotalProgression > 710) && (%TotalProgression <= 750)) then var COMBAT.CRITTER SKY GIANT
     if ((%TotalProgression > 750) && (%TotalProgression <= 980)) then var COMBAT.CRITTER XALASHAR MAGUS
     if ((%TotalProgression > 980) && (%TotalProgression <= 1080)) then var COMBAT.CRITTER DP ASSASSIN
     if ((%TotalProgression > 1080) && (%TotalProgression <= 1250)) then var COMBAT.CRITTER INTERCESSOR
     if ((%TotalProgression > 1250) && (%TotalProgression <= 1600)) then var COMBAT.CRITTER ICE ARCHON
     if ((%TotalProgression > 1600) && (%TotalProgression <= 3000)) then var COMBAT.CRITTER ADANF BLADEMASTER
     # if ((%TotalProgression > 1700) && (%TotalProgression <= 1800)) then
          # {
               # var COMBAT.CRITTER VOID MOTH
               # var BACKTRAIN.CRITTER ICE ARCHON
               # var BACKTRAIN ON
               # put #var UC_Backtrain 1
          # }
     return
#### FULL ACCOUNT - PURE EMPATH PROGRESSION *(UNDEAD / CONSTRUCTS ONLY - WHEN AVAILABLE)
EMPATH_PROGRESSION:
     if (%TotalProgression < 8) then var COMBAT.CRITTER RAT 1
     if ((%TotalProgression > 8) && (%TotalProgression <= 34)) then var COMBAT.CRITTER ORIGAMI
     if ((%TotalProgression > 34) && (%TotalProgression <= 50)) then var COMBAT.CRITTER SMALL BOGGLE
     if ((%TotalProgression > 50) && (%TotalProgression <= 60) && (%ABSOLUTION = 1)) then var COMBAT.CRITTER REAVER
     if ((%TotalProgression > 50) && (%TotalProgression <= 60) && (%ABSOLUTION = 0)) then var COMBAT.CRITTER BEISSWURM
     if ((%TotalProgression > 34) && (%TotalProgression <= 62) && ($UC_Premium = 1)) then var COMBAT.CRITTER ANIMATED OBJECT
     if ((%TotalProgression > 60) && (%TotalProgression <= 89)) then var COMBAT.CRITTER ENDRUS SERPENT
     if ((%TotalProgression > 89) && (%TotalProgression <= 105) && (%ABSOLUTION = 1)) then var COMBAT.CRITTER ZOMBIE KOBOLD
     if ((%TotalProgression > 89) && (%TotalProgression <= 105) && (%ABSOLUTION = 0)) then var COMBAT.CRITTER FIRE MAIDEN
     if ((%TotalProgression > 105) && (%TotalProgression <= 125)) then var COMBAT.CRITTER GRANITE GARGOYLE
     if ((%TotalProgression > 125) && (%TotalProgression <= 160) && (%ABSOLUTION = 1)) then var COMBAT.CRITTER MUTANT TOGBALL
     if ((%TotalProgression > 125) && (%TotalProgression <= 160) && (%ABSOLUTION = 0)) then var COMBAT.CRITTER CROCODILE
     if ((%TotalProgression > 135) && (%TotalProgression <= 150) && (%ABSOLUTION = 1)) then var COMBAT.CRITTER ZOMBIE LEUCRO
     if ((%TotalProgression > 135) && (%TotalProgression <= 150) && (%ABSOLUTION = 0)) then var COMBAT.CRITTER RIVER SPRITE
     if ((%TotalProgression > 165) && (%TotalProgression <= 195)) then var COMBAT.CRITTER DEADWOOD DRYAD
     if ((%TotalProgression > 145) && (%TotalProgression <= 175) && ($UC_Premium = 1)) then var COMBAT.CRITTER QUARTZ GARGOYLE
     if ((%TotalProgression > 195) && (%TotalProgression <= 230)) then var COMBAT.CRITTER CLAY SOLDIER
     if ((%TotalProgression > 230) && (%TotalProgression <= 270)) then var COMBAT.CRITTER LANKY GREY LACH
     if ((%TotalProgression > 270) && (%TotalProgression <= 300) && ($Athletics.Ranks >= 300)) then var COMBAT.CRITTER ICE ADDER
     if ((%TotalProgression > 270) && (%TotalProgression <= 300) && ($Athletics.Ranks < 300)) then var COMBAT.CRITTER TRANSPARENT SHYLVIC
     if ((%TotalProgression > 300) && (%TotalProgression <= 370)) then var COMBAT.CRITTER ONYX GARGOYLE
     if ((%TotalProgression > 370) && (%TotalProgression <= 450) && ($Athletics.Ranks >= 300)) then var COMBAT.CRITTER ICY BLUE GHAST
     if ((%TotalProgression > 370) && (%TotalProgression <= 450) && ($Athletics.Ranks < 300)) then var COMBAT.CRITTER WIR DINEGO
     if ((%TotalProgression > 450) && (%TotalProgression <= 520) && ($Athletics.Ranks >= 300)) then var COMBAT.CRITTER BLACK MARBLE GARGOYLE
     if ((%TotalProgression > 450) && (%TotalProgression <= 520) && ($Athletics.Ranks < 300)) then var COMBAT.CRITTER SHADOW BEAST
     if ((%TotalProgression > 520) && (%TotalProgression <= 570)) then var COMBAT.CRITTER ZOMBIE STOMPER
     if ((%TotalProgression > 570) && (%TotalProgression <= 600)) then var COMBAT.CRITTER ZOMBIE MAULER
     if ((%TotalProgression > 600) && (%TotalProgression <= 715)) then var COMBAT.CRITTER ZOMBIE HEAD SPLITTER
     if ((%TotalProgression > 715) && (%TotalProgression <= 800)) then var COMBAT.CRITTER FORAGER GHOUL
     if ((%TotalProgression > 800) && (%TotalProgression <= 990)) then var COMBAT.CRITTER FORAGER WIGHT
     if ((%TotalProgression > 990) && (%TotalProgression <= 1250)) then var COMBAT.CRITTER TELGA OREK
     if ((%TotalProgression > 1250) && (%TotalProgression <= 1700)) then var COMBAT.CRITTER ICE ARCHON
     if ((%TotalProgression > 1700) && (%TotalProgression <= 3000)) then var COMBAT.CRITTER BONE WYVERN
     return
### CLERIC PROGRESSION - UNDEAD MONSTERS MAINLY - CURSED MONSTERS WHEN UNDEAD NOT AVAILABLE IN GAP
UNDEAD_PROGRESSION:
CLERIC_PROGRESSION:
     if (%TotalProgression < 15) then var COMBAT.CRITTER ZOMBIE GOBLIN
     if ((%TotalProgression > 15) && (%TotalProgression <= 28)) then var COMBAT.CRITTER DEATH SQUIRREL
     if ((%TotalProgression > 28) && (%TotalProgression <= 39)) then var COMBAT.CRITTER GHOUL 1
     if ((%TotalProgression > 39) && (%TotalProgression <= 50)) then var COMBAT.CRITTER FAENRAE REAVER
     if ((%TotalProgression > 50) && (%TotalProgression <= 60)) then var COMBAT.CRITTER MALODOROUS BUCCA
     if ((%TotalProgression > 60) && (%TotalProgression <= 72) && ($circle < 5)) then var COMBAT.CRITTER COPPERHEAD VIPER
     if ((%TotalProgression > 60) && (%TotalProgression <= 72) && ($circle >= 5)) then var COMBAT.CRITTER ROCK TROLL 1
     if ((%TotalProgression > 70) && (%TotalProgression <= 88)) then var COMBAT.CRITTER ENDRUS SERPENT
     if ((%TotalProgression > 88) && (%TotalProgression <= 105)) then var COMBAT.CRITTER ZOMBIE KOBOLD
     if ((%TotalProgression > 100) && (%TotalProgression <= 120)) then var COMBAT.CRITTER EIDOLON STEED
     if ((%TotalProgression > 120) && (%TotalProgression <= 135)) then var COMBAT.CRITTER FOOTPAD
     if ((%TotalProgression > 135) && (%TotalProgression <= 160)) then var COMBAT.CRITTER MUTANT TOGBALL
     if ((%TotalProgression > 160) && (%TotalProgression <= 175)) then var COMBAT.CRITTER SCYTHEWING MOTH
     if ((%TotalProgression > 175) && (%TotalProgression <= 230)) then var COMBAT.CRITTER DEADWOOD DRYAD
     if ((%TotalProgression > 230) && (%TotalProgression <= 300) && ($Athletics.Ranks >= 300)) then var COMBAT.CRITTER ICE ADDER
     if ((%TotalProgression > 230) && (%TotalProgression <= 300) && ($Athletics.Ranks < 300)) then var COMBAT.CRITTER LANKY GREY LACH
     if ((%TotalProgression > 300) && (%TotalProgression <= 320)) then var COMBAT.CRITTER TRANSPARENT SHYLVIC
     if ((%TotalProgression > 320) && (%TotalProgression <= 450) && ($Athletics.Ranks >= 300)) then var COMBAT.CRITTER ICY BLUE GHAST
     if ((%TotalProgression > 320) && (%TotalProgression <= 450) && ($Athletics.Ranks < 300)) then var COMBAT.CRITTER WIR DINEGO
     if ((%TotalProgression > 420) && (%TotalProgression <= 490)) then var COMBAT.CRITTER FAENRAE ASSASSIN
     if ((%TotalProgression > 490) && (%TotalProgression <= 520)) then var COMBAT.CRITTER VILE PLAGUE WRAITH
     if ((%TotalProgression > 520) && (%TotalProgression <= 570)) then var COMBAT.CRITTER ZOMBIE STOMPER
     if ((%TotalProgression > 570) && (%TotalProgression <= 600)) then var COMBAT.CRITTER ZOMBIE MAULER
     if ((%TotalProgression > 600) && (%TotalProgression <= 715)) then var COMBAT.CRITTER ZOMBIE HEAD SPLITTER
     if ((%TotalProgression > 715) && (%TotalProgression <= 850)) then var COMBAT.CRITTER YOUNG WYVERN
     if ((%TotalProgression > 850) && (%TotalProgression <= 950)) then var COMBAT.CRITTER JUVENILE WYVERN
     if ((%TotalProgression > 950) && (%TotalProgression <= 1250)) then var COMBAT.CRITTER TELGA OREK
     if ((%TotalProgression > 1250) && (%TotalProgression <= 1450)) then var COMBAT.CRITTER FULIGIN MOTH
     if ((%TotalProgression > 1450) && (%TotalProgression <= 3000)) then var COMBAT.CRITTER BONE WYVERN
     return
MM_PROGRESSION:
     if (%TotalProgression < 20) then var COMBAT.CRITTER RAT 1
     if ((%TotalProgression > 18) && (%TotalProgression <= 30)) then var COMBAT.CRITTER SCAVENGER GOBLIN
     if ((%TotalProgression > 30) && (%TotalProgression <= 36)) then var COMBAT.CRITTER GOBLIN SHAMAN
     if ((%TotalProgression > 36) && (%TotalProgression <= 43)) then var COMBAT.CRITTER GRASS EEL
     if ((%TotalProgression > 43) && (%TotalProgression <= 52)) then var COMBAT.CRITTER SLAI SCOUT
     if ((%TotalProgression > 52) && (%TotalProgression <= 60)) then var COMBAT.CRITTER MALODOROUS BUCCA
     if ((%TotalProgression > 60) && (%TotalProgression <= 72) && ($circle < 5)) then var COMBAT.CRITTER COPPERHEAD VIPER
     if ((%TotalProgression > 60) && (%TotalProgression <= 72) && ($circle >= 5)) then var COMBAT.CRITTER ROCK TROLL 1
     if ((%TotalProgression > 70) && (%TotalProgression <= 88)) then var COMBAT.CRITTER ENDRUS SERPENT
     if ((%TotalProgression > 85) && (%TotalProgression <= 100)) then var COMBAT.CRITTER SNOWBEAST
     if ((%TotalProgression > 100) && (%TotalProgression <= 115)) then var COMBAT.CRITTER GRANITE GARGOYLE
     if ((%TotalProgression > 115) && (%TotalProgression <= 125)) then var COMBAT.CRITTER CROCODILE
     if ((%TotalProgression > 125) && (%TotalProgression <= 145)) then var COMBAT.CRITTER THICKET VIPER
     if ((%TotalProgression > 145) && (%TotalProgression <= 160)) then var COMBAT.CRITTER RIVER SPRITE
     if ((%TotalProgression > 160) && (%TotalProgression <= 175)) then var COMBAT.CRITTER PRERENI T1
     if ((%TotalProgression > 175) && (%TotalProgression <= 205)) then var COMBAT.CRITTER TWISTED DRYAD
     if ((%TotalProgression > 205) && (%TotalProgression <= 250)) then var COMBAT.CRITTER FENDRYAD
     if ((%TotalProgression > 250) && (%TotalProgression <= 280)) then var COMBAT.CRITTER BABY FOREST GRYPHON
     if ((%TotalProgression > 280) && (%TotalProgression <= 300)) then var COMBAT.CRITTER PRERENI T3
     if ((%TotalProgression > 300) && (%TotalProgression <= 340)) then var COMBAT.CRITTER FLEDGLING FOREST GRYPHON
     if ((%TotalProgression > 340) && (%TotalProgression <= 400)) then var COMBAT.CRITTER YOUNG FOREST GRYPHON
     if ((%TotalProgression > 400) && (%TotalProgression <= 430)) then var COMBAT.CRITTER CLOUD RAT
     if ((%TotalProgression > 430) && (%TotalProgression <= 520) && ($Athletics.Ranks >= 300)) then var COMBAT.CRITTER BLACK MARBLE GARGOYLE
     if ((%TotalProgression > 430) && (%TotalProgression <= 520) && ($Athletics.Ranks < 300)) then var COMBAT.CRITTER DP ZEALOT
     if ((%TotalProgression > 520) && (%TotalProgression <= 570)) then var COMBAT.CRITTER ZOMBIE STOMPER
     if ((%TotalProgression > 570) && (%TotalProgression <= 600)) then var COMBAT.CRITTER ZOMBIE MAULER
     if ((%TotalProgression > 600) && (%TotalProgression <= 715)) then var COMBAT.CRITTER ZOMBIE HEAD SPLITTER
     if ((%TotalProgression > 715) && (%TotalProgression <= 850)) then var COMBAT.CRITTER YOUNG WYVERN
     if ((%TotalProgression > 850) && (%TotalProgression <= 950)) then var COMBAT.CRITTER XALASHAR MAGUS
     if ((%TotalProgression > 950) && (%TotalProgression <= 1080)) then var COMBAT.CRITTER LAVA DRAKE
     if ((%TotalProgression > 1080) && (%TotalProgression <= 1250)) then var COMBAT.CRITTER ADULT WYVERN
     if ((%TotalProgression > 1250) && (%TotalProgression <= 1650)) then var COMBAT.CRITTER FULIGIN UMBRAL MOTH
     if ((%TotalProgression > 1650) && (%TotalProgression <= 3000)) then var COMBAT.CRITTER VOID BLACK MOTH BOAR
     return
#### NECROMANCER PROGRESSION LADDER
NECRO_PROGRESSION:
     if (%TotalProgression < 15) then var COMBAT.CRITTER RAT 1
     if ((%TotalProgression > 18) && (%TotalProgression <= 30)) then var COMBAT.CRITTER SCAVENGER GOBLIN
     if ((%TotalProgression > 30) && (%TotalProgression <= 36)) then var COMBAT.CRITTER GOBLIN SHAMAN
     if ((%TotalProgression > 36) && (%TotalProgression <= 43)) then var COMBAT.CRITTER GRASS EEL
     if ((%TotalProgression > 45) && (%TotalProgression <= 52)) then var COMBAT.CRITTER REAVER
     if ((%TotalProgression > 52) && (%TotalProgression <= 61)) then var COMBAT.CRITTER BEISSWURM
     if ((%TotalProgression > 61) && (%TotalProgression <= 70)) then var COMBAT.CRITTER ROCK TROLL 1
     if ((%TotalProgression > 70) && (%TotalProgression <= 88) && ($UC_Premium = 1)) then var COMBAT.CRITTER SUW BIZAR
     if ((%TotalProgression > 70) && (%TotalProgression <= 88) && ($UC_Premium = 0)) then var COMBAT.CRITTER ENDRUS SERPENT
     if ((%TotalProgression > 85) && (%TotalProgression <= 105)) then var COMBAT.CRITTER SNOWBEAST
     if ((%TotalProgression > 98) && (%TotalProgression <= 120)) then var COMBAT.CRITTER MARAUDER
     if ((%TotalProgression > 120) && (%TotalProgression <= 145)) then var COMBAT.CRITTER FOOTPAD
     if ((%TotalProgression > 145) && (%TotalProgression <= 160)) then var COMBAT.CRITTER RIVER SPRITE
     if ((%TotalProgression > 160) && (%TotalProgression <= 175)) then var COMBAT.CRITTER PRERENI T1
     if ((%TotalProgression > 175) && (%TotalProgression <= 220)) then var COMBAT.CRITTER LESSER SLUAGH 3
     if ((%TotalProgression > 220) && (%TotalProgression <= 260)) then var COMBAT.CRITTER RED LEUCRO
     if ((%TotalProgression > 260) && (%TotalProgression <= 300)) then var COMBAT.CRITTER BABY FOREST GRYPHON
     if ((%TotalProgression > 300) && (%TotalProgression <= 360)) then var COMBAT.CRITTER SHADOW MAGE
     if ((%TotalProgression > 360) && (%TotalProgression <= 380)) then var COMBAT.CRITTER YOUNG FOREST GRYPHON
     if ((%TotalProgression > 380) && (%TotalProgression <= 420) && ($UC_Premium = 1)) then var COMBAT.CRITTER YELLOW BRISTLED GREMLIN
     if ((%TotalProgression > 380) && (%TotalProgression <= 420) && ($UC_Premium = 0)) then var COMBAT.CRITTER CLOUD RAT
     if ((%TotalProgression > 420) && (%TotalProgression <= 510)) then var COMBAT.CRITTER FAENRAE ASSASSIN
     if ((%TotalProgression > 510) && (%TotalProgression <= 560)) then var COMBAT.CRITTER SPIRIT DANCER
     if ((%TotalProgression > 560) && (%TotalProgression <= 650)) then var COMBAT.CRITTER SSUGI MALCHATA
     if ((%TotalProgression > 650) && (%TotalProgression <= 820)) then var COMBAT.CRITTER YOUNG WYVERN
     if ((%TotalProgression > 820) && (%TotalProgression <= 1050)) then var COMBAT.CRITTER JUVENILE WYVERN
     if ((%TotalProgression > 1050) && (%TotalProgression <= 1250)) then var COMBAT.CRITTER ADULT WYVERN
     if ((%TotalProgression > 1250) && (%TotalProgression <= 1500)) then var COMBAT.CRITTER FULIGIN MOTH
     if ((%TotalProgression > 1500) && (%TotalProgression <= 3000)) then var COMBAT.CRITTER BONE WYVERN
     return

### F2P ACCOUNT - BASE ZOLUREN-ONLY PROGRESSION (MIXED BOX/SKIN MOBS)
F2P_PROGRESSION:
     if (%TotalProgression < 20) then var COMBAT.CRITTER RAT 1
     if ((%TotalProgression > 18) && (%TotalProgression <= 30)) then var COMBAT.CRITTER SCAVENGER GOBLIN
     if ((%TotalProgression > 30) && (%TotalProgression <= 36)) then var COMBAT.CRITTER GOBLIN SHAMAN
     if ((%TotalProgression > 36) && (%TotalProgression <= 43)) then var COMBAT.CRITTER GRASS EEL
     if ((%TotalProgression > 43) && (%TotalProgression <= 52) && ("$guild" != "Moon Mage")) then var COMBAT.CRITTER REAVER
     if ((%TotalProgression > 43) && (%TotalProgression <= 52) && ("$guild" = "Moon Mage")) then var COMBAT.CRITTER SLAI SCOUT
     if ((%TotalProgression > 52) && (%TotalProgression <= 60) && ("$guild" != "Moon Mage")) then var COMBAT.CRITTER BEISSWURM
     if ((%TotalProgression > 52) && (%TotalProgression <= 60) && ("$guild" = "Moon Mage")) then var COMBAT.CRITTER MALODOROUS BUCCA
     if ((%TotalProgression > 60) && (%TotalProgression <= 72) && ($circle < 5)) then var COMBAT.CRITTER COPPERHEAD VIPER
     if ((%TotalProgression > 60) && (%TotalProgression <= 72) && ($circle >= 5)) then var COMBAT.CRITTER ROCK TROLL 1
     if ((%TotalProgression > 70) && (%TotalProgression <= 90)) then var COMBAT.CRITTER ENDRUS SERPENT
     if ((%TotalProgression > 90) && (%TotalProgression <= 110)) then var COMBAT.CRITTER SNOWBEAST
     if ((%TotalProgression > 110) && (%TotalProgression <= 130)) then var COMBAT.CRITTER CROCODILE
     if ((%TotalProgression > 130) && (%TotalProgression <= 160)) then var COMBAT.CRITTER THICKET VIPER
     if ((%TotalProgression > 160) && (%TotalProgression <= 200)) then var COMBAT.CRITTER BLACK LEUCRO
     if ((%TotalProgression > 200) && (%TotalProgression <= 205)) then var COMBAT.CRITTER TWISTED DRYAD
     if ((%TotalProgression > 205) && (%TotalProgression <= 265)) then var COMBAT.CRITTER ROCK GUARDIAN
     if ((%TotalProgression > 265) && (%TotalProgression <= 300)) then var COMBAT.CRITTER ATIKET T2
     if ((%TotalProgression > 300) && (%TotalProgression <= 345)) then var COMBAT.CRITTER FOREST GENI
     if ((%TotalProgression > 345) && (%TotalProgression <= 430)) then var COMBAT.CRITTER SUPPLE FIRECAT
     if ((%TotalProgression > 430) && (%TotalProgression <= 570)) then var COMBAT.CRITTER WARKLIN MAULER
     if ((%TotalProgression > 570) && (%TotalProgression <= 680)) then var COMBAT.CRITTER STORM BULL
     if ((%TotalProgression > 650) && (%TotalProgression <= 800)) then var COMBAT.CRITTER RESUSCITANT
     if ((%TotalProgression > 800) && (%TotalProgression <= 970)) then var COMBAT.CRITTER XALASHAR THRALL
     if ((%TotalProgression > 970) && (%TotalProgression <= 1055)) then var COMBAT.CRITTER LAVA DRAKE
     if ((%TotalProgression > 1055) && (%TotalProgression <= 1250)) then var COMBAT.CRITTER UMBRAL MOTH
     if ((%TotalProgression > 1250) && (%TotalProgression <= 1450)) then var COMBAT.CRITTER FULIGIN MOTH
     if ((%TotalProgression > 1450) && (%TotalProgression <= 3050)) then var COMBAT.CRITTER CABALIST
     return
### F2P ACCOUNT - LOCKSMITHING LADDER - ZOLUREN-ONLY BOX PROGRESSION FOR F2Ps
F2P_LOCK_PROGRESSION:
     if (%TotalProgression < 20) then var COMBAT.CRITTER LOUT 1
     if ((%TotalProgression > 18) && (%TotalProgression <= 30)) then var COMBAT.CRITTER SCAVENGER GOBLIN
     if ((%TotalProgression > 30) && (%TotalProgression <= 40)) then var COMBAT.CRITTER BLOOD DRYAD
     if ((%TotalProgression > 40) && (%TotalProgression <= 52)) then var COMBAT.CRITTER REAVER
     if ((%TotalProgression > 52) && (%TotalProgression <= 64)) then var COMBAT.CRITTER MALODOROUS BUCCA
     if ((%TotalProgression > 62) && (%TotalProgression <= 72) && ($circle < 5)) then var COMBAT.CRITTER COPPERHEAD VIPER
     if ((%TotalProgression > 62) && (%TotalProgression <= 72) && ($circle >= 5)) then var COMBAT.CRITTER ROCK TROLL 1
     if ((%TotalProgression > 70) && (%TotalProgression <= 88)) then var COMBAT.CRITTER ENDRUS SERPENT
     if ((%TotalProgression > 85) && (%TotalProgression <= 95)) then var COMBAT.CRITTER FIRE MAIDEN
     if ((%TotalProgression > 94) && (%TotalProgression <= 102)) then var COMBAT.CRITTER SILVER BEAR
     if ((%TotalProgression > 102) && (%TotalProgression <= 120)) then var COMBAT.CRITTER GRAVE WORM
     if ((%TotalProgression > 120) && (%TotalProgression <= 150)) then var COMBAT.CRITTER THUG
     if ((%TotalProgression > 150) && (%TotalProgression <= 170)) then var COMBAT.CRITTER RIVER SPRITE
     if ((%TotalProgression > 170) && (%TotalProgression <= 210)) then var COMBAT.CRITTER TWISTED DRYAD
     if ((%TotalProgression > 210) && (%TotalProgression <= 260)) then var COMBAT.CRITTER ROCK GUARDIAN
     if ((%TotalProgression > 260) && (%TotalProgression <= 280)) then var COMBAT.CRITTER MOTTLED WESTANURYN
     if ((%TotalProgression > 280) && (%TotalProgression <= 340)) then var COMBAT.CRITTER FOREST GENI
     if ((%TotalProgression > 340) && (%TotalProgression <= 350)) then var COMBAT.CRITTER ATIKET T3
     if ((%TotalProgression > 350) && (%TotalProgression <= 420)) then var COMBAT.CRITTER SUPPLE FIRECAT
     if ((%TotalProgression > 420) && (%TotalProgression <= 550)) then var COMBAT.CRITTER WARKLIN MAULER
     if ((%TotalProgression > 550) && (%TotalProgression <= 770)) then var COMBAT.CRITTER RESUSCITANT
     if ((%TotalProgression > 770) && (%TotalProgression <= 1000)) then var COMBAT.CRITTER XALASHAR MAGUS
     if ((%TotalProgression > 1000) && (%TotalProgression <= 1250)) then var COMBAT.CRITTER XALASHAR ARCHER
     if ((%TotalProgression > 1250) && (%TotalProgression <= 1600)) then var COMBAT.CRITTER CABALIST
     if ((%TotalProgression > 1600) && (%TotalProgression <= 3000)) then var COMBAT.CRITTER VOID BLACK MOTH
     return
#########################################################################################################
#########################################################################################################
#########################################################################################################
SHOW_VARIABLES:
     pause 0.0001
     echo ####################################
     echo ** DISPLAYING MAIN UBERCOMBAT VARIABLES
     echo ** (Shows all your current settings)
     echo **
     echo ~~~~~~ MAIN MODULES ~~~~~~
     echo ** HOME CITY: $UC_HomeCity
     echo ** SAFE ROOM: $UC_HomeRoom
     echo ** HEAL CITY: %HEAL.CITY
     if ($UC_AutoProgress = 1) then
          {
               echo ** AUTO PROGRESS: ON
          }
          else echo ** AUTO PROGRESS: OFF
     if ($UC_AutoProgress = 1) then echo ** PROGRESS MODE: %PROGRESS.TYPE
     echo ** COMBAT.CRITTER: %COMBAT.CRITTER
     if ($UC_Backtrain = 1) then
          {
               echo ** BACKTRAIN: ON
          }
          else echo ** BACKTRAIN: OFF
     if ($UC_AutoProgress.Backtrain = 1) then
          {
               echo ** AUTO PROGRESS BACKTRAIN: ON
          }
          else echo ** AUTO PROGRESS BACKTRAIN: OFF
     if ($UC_Backtrain = 1) then echo ** BACKTRAIN.CRITTER: %BACKTRAIN.CRITTER
     echo ** NO.CONTACT: %NO.CONTACT
     echo ** LOG ON STUN: %LOG.ON.STUN
     echo ** LOG ON DEATH: %LOG.ON.DEATH
     echo ** ZILLS: %Zills
     echo ** TEACHING: %TEACH
     echo ** TEXTBOOK: %TEXTBOOK
     echo ** TARANTULA: %Tarantula
     echo ** ALMANAC: %ALMANAC
     echo ** ASTROLABE: %ASTROLABE
     echo *********************************
SHOW_VARIABLES_2:
     if matchre("$guild", "%MAGICUSER") then
          {
               echo ~~~~~~~ MAGIC SPELLS ~~~~~~~~
               echo ** Augmentation: $%GuildType.Augmentation.Spell
               echo ** Debilitation: $%GuildType.Debilitation.Spell
               echo ** Targetted Magic: $%GuildType.Target.Spell
               echo ** Utility: $%GuildType.Utility.Spell
               echo ** Warding: $%GuildType.Warding.Spell
               echo ** Sorcery: $%GuildType.Sorcery.Spell
               echo ** Cyclic(s): $%GuildType.Cyclics
               echo ~~~~~~~ GENERAL MAGIC ~~~~~~~~
               echo ** Smart Mana: %SMART.SPELLS
               echo ** Magic Rate: %Magic.Rate
               echo ** Cambrinth Charges: %CambrinthCharge
               echo ** Cambrinth Mana: %CambrinthMana
               echo ** Cyclic Charge: %CyclicCharge
               echo ** Camb Heavy: %Camb.Heavy
               echo ** No Cambrinth TM: %NoCambTM
               echo ** Magic Snap: %MAGIC.SNAP
               echo ** Ritual Focus: %Ritual
               echo ** TM Foci: %TMFoci
               echo ** Magic Tattoo: %Magic.Tattoo
               echo ** Target Symbiosis: %Target.Symbiosis
               echo ** Debilitation Symbiosis: %Debilitation.Symbiosis
               echo ** Augmentation Symbiosis: %Augmentation.Symbiosis
               echo ** Utility Symbiosis: %Utility.Symbiosis
               echo ** Warding Symbiosis: %Warding.Symbiosis
               echo ** Sorcery Symbiosis: %Sorcery.Symbiosis
               echo *********************************
          }
     echo ~~~~~~ WEAPONS ~~~~~~
     if !matchre("$UC_WEAPON_SE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** SE: $UC_WEAPON_SE
     if !matchre("$UC_WEAPON_LE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** LE: $UC_WEAPON_LE
     if !matchre("$UC_WEAPON_THE", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** THE: $UC_WEAPON_THE
     if !matchre("$UC_WEAPON_SB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** SB: $UC_WEAPON_SB
     if !matchre("$UC_WEAPON_LB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** LB: $UC_WEAPON_LB
     if !matchre("$UC_WEAPON_THB", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** THB: $UC_WEAPON_THB
     if !matchre("$UC_WEAPON_STAVES", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** STAVES: $UC_WEAPON_STAVES
     if !matchre("$UC_WEAPON_POLEARMS", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** POLEARMS: $UC_WEAPON_POLEARMS
     if !matchre("$UC_WEAPON_LT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** LT: $UC_WEAPON_LT
     if !matchre("$UC_WEAPON_HT", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** HT: $UC_WEAPON_HT
     if !matchre("$UC_WEAPON_BOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** BOW: $UC_WEAPON_BOW
     if !matchre("$UC_WEAPON_CROSSBOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** CROSSBOW: $UC_WEAPON_CROSSBOW
     if !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** SLING: $UC_WEAPON_SLING
     if !matchre("$UC_WEAPON_BRAWL", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** BRAWLING: $UC_WEAPON_BRAWL
     if ("$guild" = "Thief") then echo ** BACKSTAB: $UC_WEAPON_BS
     echo ~~ AMMO ~~
     if !matchre("$UC_WEAPON_CROSSBOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** Xbow Ammo: %XbowAmmo
     if !matchre("$UC_WEAPON_BOW", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** Bow Ammo: %BowAmmo
     if !matchre("$UC_WEAPON_SLING", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** Sling Ammo: %SlingAmmo
     echo *********************************
     echo ~~~~~~ ARMOR ~~~~~~
     echo ** SHIELD: %MyShield
     if !matchre("$UC_Armor.Chest", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** CHEST ARMOR: $UC_Armor.Chest
     if !matchre("$UC_Armor.Face", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** FACE ARMOR: $UC_Armor.Face
     if !matchre("$UC_Armor.Head", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** HEAD ARMOR: $UC_Armor.Head
     if !matchre("$UC_Armor.Arms", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** ARM ARMOR: $UC_Armor.Arms
     if !matchre("$UC_Armor.Abdomen", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** ABDOMEN ARMOR: $UC_Armor.Abdomen
     if !matchre("$UC_Armor.Back", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** BACK ARMOR: $UC_Armor.Back
     if !matchre("$UC_Armor.Hands", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** HAND ARMOR: $UC_Armor.Hands
     if !matchre("$UC_Armor.Legs", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** LEG ARMOR: $UC_Armor.Legs
     if !matchre("$UC_Armor.Knuckle", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b") then echo ** KNUCKLES: $UC_Armor.Knuckle
     if ($UC_ParryStick = 1) then echo ** PARRY STICK: %PARRYSTICK
     if ($UC_ParryStick = 0) then echo ** NO PARRY STICK! FAIL!!!
     echo *********************************
     pause 0.0001
     echo ~~~~~~ CONTAINERS ~~~~~~
     echo ** MAIN CONTAINER: %Container
     echo ** BOX CONTAINER: %Container.Boxes
     echo ** BACKUP CONTAINER: %Container.Backup
     echo ** CRAFTING CONTAINER: %Container.Crafting
     echo ** AMMO CONTAINER: %Container.Ammo
     echo ** AMMO BACKUP CONTAINER: %Container.Ammo.Backup
     echo ** EMPTY POUCH CONTAINER: %Container.EmptyPouch
     echo ** SHEATH CONTAINER: %Container.Sheath
     echo ** DIRT CONTAINER: %Container.Dirt
     if matchre("%Sheath.1", "(?i)(NULL|OFF|^%|^\s*$)") then echo ** SHEATH CONTAINER1: %Sheath.1
     if matchre("%Sheath.2", "(?i)(NULL|OFF|^%|^\s*$)") then echo ** SHEATH CONTAINER2: %Sheath.2
     if matchre("%Sheath.3", "(?i)(NULL|OFF|^%|^\s*$)") then echo ** SHEATH CONTAINER3: %Sheath.3
     if matchre("%Sheath.4", "(?i)(NULL|OFF|^%|^\s*$)") then echo ** SHEATH CONTAINER4: %Sheath.4
     if matchre("%Sheath.5", "(?i)(NULL|OFF|^%|^\s*$)") then echo ** SHEATH CONTAINER5: %Sheath.5
     if matchre("%Sheath.6", "(?i)(NULL|OFF|^%|^\s*$)") then echo ** SHEATH CONTAINER6: %Sheath.6
     echo ~~~~ *SPECIAL* CONTAINERS ~~~~
     echo * THESE CONTAINERS ARE KEPT CLOSED!
     echo * DO NOT SHARE WITH MAIN CONTAINERS ABOVE!!
     if !matchre("%REPAIR.KIT.CONTAINER", "(?i)(NULL|OFF|^%|^\s*$)") then echo ** REPAIR KIT CONTAINER: $UC_Container.RepairKit
     if !matchre("%REPAIR.KIT.2.CONTAINER", "(?i)(NULL|OFF|^%|^\s*$)") then echo ** REPAIR KIT CONTAINER 2: $UC_Container.RepairKit2
     echo ** GemPouch Container: %Container.GemPouch
     echo *********************************
     echo ~~~~~~ COMBAT OPTIONS ~~~~~~
     echo ** Max Weapon Time: %MAX.TIME seconds
     if ("%MAX.TRAIN" != "0") then echo ** Max Combat Time: %MAX.TRAIN seconds
     if ("%MAX.TRAIN" = "0") then echo ** Max Combat Time: Infinity! (Until too hurt/burdened)
     echo ** SMART WEAPONS: %SMART.WEAPONS
     echo ** TRAIN LOWEST: %TrainLowest
     echo ** PRIORITY WEAPONS: %Priority.Weapons
     echo ** MAX LEARNINGRATE WEAPON: %MAX.LEARNINGRATE
     echo ** LEARNING RATE INCREASE: %LEARNING.INCREASE
     echo ** MAX TIME PER WEAPON: %MAX.TIME
     echo ** MAX COMBAT TIME: %MAX.TRAIN
     echo ** APPRAISE: %APPRAISE
     echo ** DANCE COUNT: %Dance.Count
     echo ** AIM ACTIONS: %AimActions
     echo ** STEALTH: %TrainStealth
     echo ** SNIPE: %Snipe
     echo ** POACH: %Poach
     echo ** RETREAT(Ranged): %Retreat
     echo ** TACTICS: %Tactics
     echo ** HUNT: %HUNT
     echo ** WEAK ATTACK: %WeakAttack
     echo ** OFFHAND THROW: %OffhandThrow
     echo ** THROW TYPE: %ThrowType
     echo ** ROAMING: %Roaming
     echo ** SKINNING: %Skin
     echo ** BUNDLING: %Bundle
     echo ** ARRANGE ALL: %ArrangeAll
     echo ** MAX BUNDLE SKINS: %MaxBundle
     echo ** TIE BUNDLES: %TieBundle
     echo ** BUNDLE LOCATION: %BundleLocation
     echo ** MAX BOXES: %Max.Boxes
     echo ** TIE POUCHES: %TiePouch
     echo ** LOOT OPTION: %Loot.Option
     echo ** LOOT GEMS: %Loot.Gems
     echo ** LOOT BOXES: %Loot.Boxes
     echo ** LOOT METALS: %Loot.Metals
     echo ** LOOT SCROLLS: %Loot.Scrolls
     echo ** LOOT COLLECTIBLES: %Loot.Collectibles
     echo ** LOOT SPIDER PARTS: %Loot.SpiderParts
     echo ** SANOWRET: %SanowretCombat
     echo ** HELM SWAP: %Armor.Swap
     echo *********************************
     pause 0.00001
     echo ~~~~~~ TOWN RUN OPTIONS ~~~~~~
     echo ** AUTOHEAL: %AUTOHEAL
     if matchre("%AUTOHEAL", "(?i)(NULL|OFF|^%|^\s*$)") then
          {
               echo ** WARNING! AUTOHEAL OFF WILL ABORT SCRIPT AFTER ESCAPING COMBAT!!
               echo *********************************
          }
     echo ** JUMP JEWELRY: %JumpJewelry
     echo ** FANG COVE: %FANGCOVE
     echo ** SELL GEMS: %SELLGEMS
     echo ** SELL METAL: %SELLMETALS
     echo ** SELL SKINS: %SELLSKINS
     echo ** BANK RUN: %BANKRUN
     echo ** BUY HERBS: %HERBS
     echo ** INVENTORY CHECK: %INVCHECK
     echo ** GET FAVORS: %GET.FAVORS
     echo ** REPAIR ARMOR: %REPAIR.ARMOR
     echo ** AMMO RESTOCK: %AmmoStock
     echo ** RETURN TO COMBAT (LOOP SCRIPT): %RETURN.TO.COMBAT
     echo *********************************
     echo ~~~~~~ TOWN RUN TRAINING OPTIONS ~~~~~~
     echo ** CLIMBING: %CLIMBING
     echo ** MAGIC ROPE: %MAGIC.ROPE
     echo ** SKIN/FA TRAINER: %SKINTRAINER
     echo ** COLLECTING: %COLLECTING
     echo ** BRAIDING: %BRAIDING
     echo ** DISARM: %DISARM
     echo ** BURGLE: %BURGLE
     echo ** STEALING: %STEAL
     echo ** RAVEN COURT: %RAVEN
     echo ** PERFORMANCE: %PERFORMANCE
     echo ** ALCHEMY: %ALCHEMY
     echo ** ENGINEERING: %ENGINEERING
     echo ** FORGING: %FORGING
     echo ** OUTFITTING: %OUTFITTING
     echo ** ENCHANTING: %ENCHANTING
     echo ** POWER WALK: %POWERWALK
     echo ** PERFORMANCE RUN: %PERFORMANCE
     echo ** MAGICAL RESEARCH: %MAGICAL.RESEARCH
     if matchre("$guild", "(Cleric|Paladin)") then echo ** PILGRIM BADGE: %PILGRIM
     echo ####################################
     var errorbag NULL
     var errortype NULL
     if (matchre("$UC_Container.GemPouch", "(?i)\b($UC_Container|$UC_Container.Box|$UC_Container.Crafting|$UC_Container.Backup|$UC_Container.Ammo|$UC_Container.Almanac|$UC_Container.Ritual|$UC_Container.Textbook|$UC_Container.Wand1|$UC_Container.Wand2|$UC_Container.Dirt|$UC_Container.Herb)") && !matchre("$UC_Container.GemPouch", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then
          {
               var errorbag $UC_Container.GemPouch
               var errortype GemPouch Container
               goto BAD_BAGS_ERROR
          }
     if (matchre("$UC_Container.RepairKit", "(?i)\b($UC_Container|$UC_Container.Box|$UC_Container.Crafting|$UC_Container.Backup|$UC_Container.Ammo|$UC_Container.Almanac|$UC_Container.Ritual|$UC_Container.Textbook|$UC_Container.Wand1|$UC_Container.Wand2|$UC_Container.Dirt|$UC_Container.Herb)") && !matchre("$UC_Container.RepairKit", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then
          {
               var errorbag $UC_Container.RepairKit
               var errortype RepairKit Container
               goto BAD_BAGS_ERROR
          }
     if (matchre("$UC_Container.RepairKit2", "(?i)\b($UC_Container|$UC_Container.Box|$UC_Container.Crafting|$UC_Container.Backup|$UC_Container.Ammo|$UC_Container.Almanac|$UC_Container.Ritual|$UC_Container.Textbook|$UC_Container.Wand1|$UC_Container.Wand2|$UC_Container.Dirt|$UC_Container.Herb)") && !matchre("$UC_Container.RepairKit2", "(?i)\b(NULL|OFF|0|^%|^\s*$)\b")) then
          {
               var errorbag $UC_Container.RepairKit2
               var errortype RepairKit2 Container
               goto BAD_BAGS_ERROR
          }
     pause 0.0001
     return
WEAPONLOAD:
     include ubercombat-weapon.inc
     return
LINKLOAD:
     include ubercombat-link.inc
     return
INCLUDE:
     include ubercombat-buffs.inc
     include ubercombat-vars.inc
     ### include UberConfig.inc
#### END OF UBER MAIN
############################################################################################################################################################
############################################################################################################################################################
############################################################################################################################################################
############################################################################################################################################################
############################################################################################################################################################
############################################################################################################################################################
##############################################################################
##############################################################################
# EMPATH HEALBOT
HEALBOT:
     put #queue clear
     gosub clear
     action (stunned) on
     action (reconnect) on
     action (dead) on
     action (combat) off
     action (escape) off
     action (sorcery) off
     var LastTraining EMPATHTRAINING
     var patients NULL
     var client NULL
     var takespeed quick
     var disease 0
     var poison 0
     var Unity.Active 0
     var NoWounds 0
     var DenyNecro 0
     var Deny 0
     var healbot 1
     var LAST HEALBOT
     var CURRENT Healbot Mode
     eval Blacklist replacere("%Blacklist", "\|+", "|")
     eval Blacklist replacere("%Blacklist", "\|$", "")
     eval Blacklist replacere("%Blacklist", "^\|", "")
     delay 0.0001
     delay 0.0001
     put #var healingblacklist %Blacklist
     echo
     echo #####################
     echo ** EMPATH HEALBOT MODE ACTIVE!
     echo ** HEALING OTHERS / TRAINING LOOPS
     echo ** LEAN ACTIVATES HEALING
     echo ** BLACKLIST: $healingblacklist
     echo #####################
     echo
     put #echo >Log #DDFF09 *** EMPATH HEALBOT MODE INITIATED!
     put #echo >Log #DDFF09 *** HEALING OTHERS / TRAINING IN ONE SPOT!
     pause 0.5
HEALBOT_ACTIONS:
	action put tend my $1 when The bandages binding your (.*) soak through with blood becoming useless
	action goto HEALBOT when eval $useridle = 1
	action goto HEALBOT when ^(\w+) gives you a little prod between the
     # action goto shift when ^$shiftee/i
	# action put #var shiftee $2;put #var shiftto $3;send cc $1, I am all set to attempt to shift $2 to a $3 when ^Your mind hears (\S+) thinking\, \"$charactername shift (\S+) (\S+)\"/i
	action send #echo >Familiar #FF00FF ***** $datetime ********** when (his|her|of|normal) vitality
	action put #echo >Log $1 Script fuckup $datetime when \[Script timeout in (\w+)\.cmd\((\d+)\)\:
	action put #statusbar 2 * Patients = %patients *;put #statusbar 3 * Class = %TeachClass *;put #statusbar 4 * Skill = $skilltrain *;put #statusbar 5 * Favors = $favors *;put #statusbar 6 Timer: %t when ^Roundtime\:
	action put #echo >Log #0080FF Sorcery Blow-up;put var disease 1 when ^A sudden and violent explosion of pale
	action put #parse $2 leans on you. when ^Your mind hears (\S+) thinking\, \"$charactername heal (\S+)\"/i
	action var class $1 when You are teaching a class on (.*) which is
	action var disease 1 when ^Your body is covered in open oozing sores\.|You have a dormant infection\.|^Your wounds are badly infected\.|You managed to get some\, but more still remains\.|^Your wounds are infected\.
	action var poison 1 when You have a .* poisoned .*\.|^You are under the influence of a .* stunning poison\.|nerve poison\.|internal poison\.
	action goto HEALMYSELF when ^Touch what?|^An instant rush of black and blue fire explodes into being\,|^The spell pattern resists the influx of unstable mana and everything goes black\.|^Geysers of uncontrolled mana suddenly erupt from your flesh|^The pattern you are experimenting with wrenches itself out of your control\!
	action goto UNCONSCIOUS when ^You\'re unconscious\!
	#######################################################################################################
     action var NoWounds 1 when ^You sense nothing wrong with .+\.$|no injuries to speak
     action var DenyNecro 1 when quickly recoil
     action var Deny 1 when avoids your
	action (onduty) put whisper $1 LEAN for heals when (\S+)(?<!(?i)$healingblacklist) just arrived
	action instant (onduty) put #queue clear;var client $1;goto HEALCLIENT when ^(\S+) leans on you\.
	# action (onduty) goto healclient when (\w+) leans on you\.
	action (onduty) put #queue clear;var client $1;goto HEALCLIENT when (\S+) leans back against you with a tender
	action (onduty) put #queue clear;put touch $1;-0.8 put take $1 disease;put take $1 disease when (\S+) pokes you in the ribs\.
	action (onduty) put #queue clear;put touch $1;-0.8 put take $1 disease;put take $1 disease when (\S+) gives you a gentle poke in the ribs\.
	action (onduty) var clientpart $1;var actualpart $2;goto HEALPART when ^(\S+) whispers\, \"take (.*)\"$
	#######################################################################################################
	action (offduty) put whisper $1 I am still cleaning up from my last client, adding you to healing queue. when (\S+) leans on you\.
	action (offduty) put whisper $1 I am still cleaning up from my last client, adding you to healing queue. when (\S+) leans back against you with a tender
	action (offduty) var nextclient $1 when (\w+) leans on you
	action (offduty) var nextclient $1 when (\w+) leans back against you with a tender
	#######################################################################################################
	action (healingduty) put whisper $1 I am healing %client right now. Please wait. when (\S+) leans on you
	action (healingduty) put whisper $1 I am healing %client right now. Please wait. when (\S+) leans back against you with a tender
	action (healingduty) goto touch.denynecro when ^As you establish the transference link with (\S+)\, you abruptly sense the antithetical necromantic taint running
	action (healingduty) var nextclient $1 when (\w+) leans on you
	action (healingduty) var nextclient $1 when (\S+) leans back against you with a tender
     #######################################################################################################
     action var Unity.Active 1 when ^Your nerves sing with pain as you draw
     action var Unity.Active 1 when ^The feeling of unity with .* gradually ebbs away\.
     action var Unity.Active 1 when ^^You strain\, but your system is still recovering from your last manifestation of the unity link\.
	action var Unity.Active 0 when ^You sense that your system has fully recovered from your recent manifestation of the unity link\.
	action var Unity.Active 0 when ^\s*LINK \<target\'s name\> UNITY\s*\- Invokes a manifestation of the Unity link
     #######################################################################################################
     pause 0.01
     pause 0.001
     if (($circle < 70) || ($Empathy.Ranks < 380)) then
          {
               echo
               echo #################################
               echo *** Empathy Ranks / Circle too low for Unity Link
               echo *** Turning UNITY LINK OFF
               echo #################################
               echo
               put #var UNITY 0
          }
HEAL_CLIENT:
HEALCLIENT:
     var healbot 1
	action var client.poison 1 when poison|has a (\S+) poisoned
	action var client.disease 1 when covered with open oozing
	action var client.disease 1 when infected
	action var client.disease 1 when has a dormant infection
	action var client.disease 1 when has (\S+) gangrene
	action var client.disease 1 when has (\S+) disease
	gosub clear
     if ("%client" = "NULL") then goto HEALMYSELF
	if contains("$healingblacklist","%client") then goto DENYCLIENT
	action (teach) off
	action (onduty) off
	action (offduty) off
	action (healingduty)on
     if ("$preparedspell" != "None") then
          {
               gosub RELEASE spell
               gosub RELEASE_CAMB
          }
	pause 0.01
	pause 0.1
	#send prep foc 100
	#pause .5
	gosub stowing
	put whisper %client One moment please.
	pause 0.4
	#if $preparedspell != none then send release spell
	gosub CLIENTCLEAR
	pause 0.1
	if ((%Unity.Active = 1) || ($UNITY = 0)) then goto HEALOLDSCHOOL
	send touch %client
	pause 0.5
     pause 0.3
     if (%NoWounds = 1) then goto TOUCH.NOWOUNDS
     if (%Deny = 1) then goto TOUCH.DENY
     if (%DenyNecro = 1) then goto TOUCH.DENYNECRO
	if (%client.poison = 1) then gosub TAKE.POISON
	if (%client.disease = 1) then gosub TAKE.DISEASE
     pause 0.01
	send take %client vitality careful
     pause 0.1
     pause 0.1
	send link %client unity
	pause 0.5
     pause 0.5
     pause 0.4
	math patients add 1
	send whisper %client, All clean
	put #echo >Log #E109FF *** Healed %client via Unity***
     pause 0.2
     pause 0.2
	send nod %client
	put #parse HEALING DONE
	put #var client none
	gosub CLIENTCLEAR
	goto HEALMYSELF

HEALOLDSCHOOL:
	pause
	gosub stowing
	gosub HEALINGCLIENT
	pause 0.1
	pause 0.1
	math patients add 1
	action (teach) on
	action (healingduty) off
	action (offduty) on
	goto HEALMYSELF

UNCONSCIOUS:
	pause 0.1
     echo **** UNCONSCIOUS!!
	pause 0.1
	action (teach) off
	action (onduty) off
	action (offduty) off
	action (boaton) off
	action (trader) off
	action (healingduty)off
	action (boatoff) off
	pause 120
	send look

HEALMYSELF:
	pause 0.001
	pause 0.01
	action (teach) on
	action (healingduty) off
	action (offduty) on
	gosub SELFCLEAR
	pause 0.1
	pause 0.1
	if contains ("$prompt","U") then pause 25
	send health
	send perceive health self
	wait
	pause 2
	#if "$preparedspell" != "Fountain of Creation" then
	#			{
	#				send release all
	#				wait
	#				pause
	#				send prep FOC 100
	#				pause 7
	#			}
	#pause 10
	#if $FOC = on then pause 25
	#send cast
     if ($health < 80) then gosub HEALVITALITY
	if ($stamina < 80) then gosub HEALFATIGUE
	if ($SpellTimer.Regenerate.active = 0) then gosub REGENERATE
	if ($SpellTimer.Heal.active = 0) then gosub HEAL
	if (%disease = 1) then gosub CUREDISEASE
	if (%poison = 1) then gosub FLUSHPOISON
	pause 0.1
	pause 0.1
HEALINGRESET:
	action (offduty) off
	action (healingduty) off
	action (teach) on
	action (onduty) on
	if $standing = 0 then gosub stand
	gosub clear
	goto %LastTraining

HEALPART:
	pause 0.1
	pause 0.1
	#put #script abort all except empath
	if contains ("$healingblacklist","%clientpart") then goto DENYCLIENT
	pause 0.1
	pause 0.1
	send touch %clientpart
	pause 0.1
	pause 0.1
	send take %clientpart %actualpart part quick
	pause 3
	send take %clientpart %actualpart ext scar quick
	pause
	send whisper %clientpart %actualpart should be taken down by one part.
	pause 0.1
	pause 0.1
	send nod %clientpart
	put #echo >Log #E109FF Healed %clientpart %actualpart part
	goto %LastTraining

DENYCLIENT:
	pause 0.1
	send whisper %client You have been blacklisted from using any of my services! Good day!
	pause 0.1
	pause 0.1
	send release
	goto %LastTraining
############################
### Heal client sub ########
############################

HEALINGCLIENT:
CLIENTACTIONS:
	action var client.poison 1 when poison|has a (\S+) poisoned
	action var client.disease 1 when covered with open oozing
	action var client.disease 1 when infected
	action var client.disease 1 when has a dormant infection
	action var client.disease 1 when has (\S+) gangrene
	action var client.disease 1 when has (\S+) disease
	action var client.skin.heals 1 when Wounds to the SKIN
	action var client.head.heals 1 when Wounds to the HEAD
	action var client.reye.heals 1 when Wounds to the RIGHT EYE
	action var client.leye.heals 1 when Wounds to the LEFT EYE
	action var client.neck.heals 1 when Wounds to the NECK
	action var client.chest.heals 1 when Wounds to the CHEST
	action var client.abdo.heals 1 when Wounds to the ABDOMEN
	action var client.back.heals 1 when Wounds to the BACK
	action var client.rarm.heals 1 when Wounds to the RIGHT ARM
	action var client.larm.heals 1 when Wounds to the LEFT ARM
	action var client.rhnd.heals 1 when Wounds to the RIGHT HAND
	action var client.lhnd.heals 1 when Wounds to the LEFT HAND
	action var client.rleg.heals 1 when Wounds to the RIGHT LEG
	action var client.lleg.heals 1 when Wounds to the LEFT LEG
	action var badwounds 1 when -- useless|-- devastating|-- very devastating|-- very severe
	action var deathscars 1 when severe scarring and chunks of flesh missing|missing chunks|a punctured and shriveled|a partially paralyzed|a painful chest area and difficulty getting a breath without pain| a definite greenish pallor and emaciated look|severe scarring and
	action var vitalitytake 0 when He is dead
	action var vitalitytake 0 when She is dead
	action var vitalitytake 0 when has normal vitality\.
	action put touch %client;put take %client disease when You managed to get some\, but more still remains\.
	var vitalitytake 1

HEALGO:
	pause 0.001
	if ($sitting = 0) then put sit
	pause 0.1
	var level all
	gosub CLIENTCLEAR
	gosub TOUCH.CLIENT
	if (%vitalitytake = 1) then send take %client vitality careful
	#if %client.poison = on then gosub TAKE.POISON
	#if %client.disease = on then gosub TAKE.DISEASE
	if (%badwounds = 1) then var level half
	if (%deathscars = 1) then var level half
	gosub TAKEALL
	goto ENDHEALING

TOUCH.CLIENT:
	pause 0.01
	pause 0.01
	matchre TOUCH.NOWOUNDS no injuries to speak
     matchre TOUCH.NOWOUNDS ^You sense nothing wrong with .+
	matchre TOUCH.RETURN Wounds to|poison|poisoned|rot|oozing|infected|infection|disease|gangrene|is suffering from
	matchre TOUCH.DENY avoids your
	matchre TOUCH.DENYNECRO quickly recoil
	send touch %client
	matchwait 10
	put #echo >Log Ran away: %client
	goto ENDHEALINGNOHEAL

TOUCH.DENY:
	pause 0.1
	send whisper %client You are avoiding my healing.. go away.
	pause 0.1
	put #echo >Log Avoiding healing: %client
	goto ENDHEALINGNOHEAL

TOUCH.DENYNECRO:
	pause 0.01
	send whisper %client You are a Necromancer and I cannot heal you, sorry.
	pause 0.1
	pause 0.01
	put #echo >Log Bad Necro: %client
	goto ENDHEALINGNOHEAL

TOUCH.NOWOUNDS:
	pause 0.01
	pause 0.01
	if (%vitalitytake = 1) then send take %client vitality
	if (%client.poison = 1) then goto TOUCH.ONLYEXTRAS
	if (%client.disease = 1) then goto TOUCH.ONLYEXTRAS
	send whisper %client You have leaned on me with no wounds.
	put #echo >Log *** %client NO WOUNDS ***
	pause 0.01
	goto ENDHEALINGNOHEAL

TOUCH.RETURN:
	pause 0.1
	pause 0.001
	return

ENDHEALINGNOHEAL:
	pause 0.1
	pause 0.1
	#put #echo >log Silver *** NOHEAL: %client***
	put #parse HEALING DONE
	put #var client none
	#put release
	goto HEALINGRESET

############ POISON ###############
TAKE.POISON:
	pause 0.1
	pause 0.1
     echo
	echo *** Taking Poison ***
	echo
     send touch %client
	matchre TAKE.POISON remaining poison transfers to you fully
	matchre return Your patient does not have any poison in their body.
	put take %client poison
	matchwait 15
	return

############# DISEASE #############
TAKE.DISEASE:
	pause 0.1
	pause 0.1
     echo
	echo *** Taking Disease ***
	echo
     put touch %client
	matchre TAKE.DISEASE remaining disease transfers to you fully
	matchre return Your patient does not have any disease
	put take %client disease
	matchwait 15
	return

STAMINA.WAIT:
	pause 0.1
	send whisper %client I'm waiting for stamina to recover I'll resume in a minute or so.
	STAMINA.WAITING:
     echo **** Pausing for Stamina to Recover...
	pause 20
	send health
	pause 0.1
	pause 0.1
	if ($stamina > 70) then return
	pause 0.1
	pause 0.1
	goto STAMINA.WAITING

TAKEALL:
	pause 0.1
	pause 0.1
	#gosub CLIENTCLEAR
	put touch %client
	waitforre You sense a successful empathic link has been forged|Touch what|I could not find
	pause
	if ($vitalitytake = 1) then send take %client vitality careful
	if (%client.poison = 1) then gosub TAKE.POISON
	if (%client.disease = 1) then gosub TAKE.DISEASE
	if (%client.skin.heals = 1) then gosub TAKE.WOUND skin
	if (%client.head.heals = 1) then gosub TAKE.WOUND head
	if (%client.reye.heals = 1) then gosub TAKE.WOUND right eye
	if (%client.leye.heals = 1) then gosub TAKE.WOUND left eye
	if (%client.neck.heals = 1) then gosub TAKE.WOUND neck
	if (%client.chest.heals = 1) then gosub TAKE.WOUND chest
	if (%client.abdo.heals = 1) then gosub TAKE.WOUND abdomen
	if (%client.back.heals = 1) then gosub TAKE.WOUND back
	if (%client.rarm.heals = 1) then gosub TAKE.WOUND right arm
	if (%client.larm.heals = 1) then gosub TAKE.WOUND left arm
	if (%client.rhnd.heals = 1) then gosub TAKE.WOUND right hand
	if (%client.lhnd.heals = 1) then gosub TAKE.WOUND left hand
	if (%client.rleg.heals = 1) then gosub TAKE.WOUND right leg
	if (%client.lleg.heals = 1) then gosub TAKE.WOUND left leg
	pause
	################## SCARS ###############################
	if (%client.skin.heals = 1) then gosub TAKE.INT skin
	if (%client.head.heals = 1) then gosub TAKE.INT head
	if (%client.reye.heals = 1) then gosub TAKE.INT right eye
	if (%client.leye.heals = 1) then gosub TAKE.INT left eye
	if (%client.neck.heals = 1) then gosub TAKE.INT neck
	if (%client.chest.heals = 1) then gosub TAKE.INT chest
	if (%client.abdo.heals = 1) then gosub TAKE.INT abdomen
	if (%client.back.heals = 1) then gosub TAKE.INT back
	if (%client.rarm.heals = 1) then gosub TAKE.INT right arm
	if (%client.larm.heals = 1) then gosub TAKE.INT left arm
	if (%client.rhnd.heals = 1) then gosub TAKE.INT right hand
	if (%client.lhnd.heals = 1) then gosub TAKE.INT left hand
	if (%client.rleg.heals = 1) then gosub TAKE.INT right leg
	if (%client.lleg.heals = 1) then gosub TAKE.INT left leg
	pause 8
	if (%level = half) then goto HALF.RESET
	#send touch %client
	return

HALF.RESET:
	pause 0.1
	pause 0.1
	var level all
	pause 0.1
	pause 0.1
	goto TAKEALL

TAKE.WOUND:
     var client.area $0
	pause 0.01
	if ($sitting = 0) then send sit
     pause 0.1
	if matchre ("%client","Ackolone") and matchre ("%client.area","$ackolonewounds") then goto SKIPPEDWOUND
	if matchre ("%client","Achilles") and matchre ("%client.area","$achilleswounds") then goto SKIPPEDWOUND
	#if matchre ("%client","Kathris") and matchre ("%client.area","$kathriswounds") then goto SKIPPEDWOUND
	#if matchre ("%client","Ragonii") and matchre ("%client.area","$ragoniiwounds") then goto SKIPPEDWOUND
	if matchre ("%client","Pewpew") and matchre ("%client.area","$pewpewwounds") then goto SKIPPEDWOUND
     echo
	echo *** Taking %client.area Wounds ***
     echo
	send take %client %client.area %level %takespeed
	pause 0.2
	pause 0.1
SKIPPEDWOUND:
	send take %client int %client.area %level %takespeed
	pause 0.2
	return

TAKE.INT:
     var client.area $0
	pause 0.01
	if $sitting = 0 then send sit
     pause 0.1
     echo
	echo *** Taking %client.area full ***
	echo
     send take %client ext scar %client.area %level %takespeed
	pause 0.4
	pause 0.1
	send take %client int scar %client.area %level %takespeed
	pause 0.4
	return

CLIENTCLEAR:
	var deathscars 0
	var client.poison 0
	var client.disease 0
	var client.skin.heals 0
	var client.head.heals 0
	var client.reye.heals 0
	var client.leye.heals 0
	var client.neck.heals 0
	var client.chest.heals 0
	var client.abdo.heals 0
	var client.back.heals 0
	var client.rarm.heals 0
	var client.larm.heals 0
	var client.rhnd.heals 0
	var client.lhnd.heals 0
	var client.rleg.heals 0
	var client.lleg.heals 0
	var badwounds 0
	var deathscars 0
     var NoWounds 0
     var DenyNecro 0
     var Deny 0
	return

TOUCH.ONLYEXTRAS:
	pause 0.01
	pause 0.01
	send take %client disease
	pause 0.1
	pause 0.1
	send take %client poison
	pause 0.1
	pause 10

ENDHEALING:
	pause 0.1
	pause 0.01
	send whisper %client, All clean
	put #echo >log #E109FF *** Healed %client via Old school***
	send nod %client
	put #parse HEALING DONE
	put #var client none
	return
############################
### Healbot Skills  ########
############################
EMPATHTRAINING:
	pause 0.01
	pause 0.01
	EMPATHTEACH:
     var LastTraining EMPATHTEACH
	gosub TEACHINGTRAIN
	gosub APPRAISAL
	EMPATHFIRSTAID:
     var LastTraining EMPATHFIRSTAID
	if ($Appraisal.LearningRate < 33) then gosub APPRAISAL
	#send research stop
	if ($First_Aid.LearningRate < 33) then gosub FIRSTAIDTRAIN
	EMPATHMECH:
     var LastTraining EMPATHMECH
	# if $trainmech = yes then gosub mechtrain
	# if $trainsorcery = yes then gosub sorcerytrain
	EMPATHFORAGE:
     var LastTraining EMPATHFORAGE
	if ($Appraisal.LearningRate < 33) then gosub APPRAISAL
     gosub EMPATHMAGIC
	if ($Outdoorsmanship.LearningRate < 33) then gosub FORAGETRAIN
	EMPATHSORCERY:
     var LastTraining EMPATHSORCERY
	if ($Sorcery.LearningRate < 33) then gosub EMPATH.RESEARCH
	# if $trainsorcery = yes then gosub sorcerytrain
	goto EMPATHTRAINING

TEACHINGTRAIN:
	gosub TEACH.CHECK
	pause .1
	pause .1
	#gosub clear
	goto NOTEACH

TEACH.CHECK:
	pause 0.1
	echo
	echo ****************
	echo  TEACHING CHECK
	echo ****************
	echo
	matchre TEACH.CHECK \.\.\.wait|type ahead
	matchre NOTEACH You are in this class
	matchre TEACHER You are teaching a class|Roundtime
	send asses teach
	matchwait

TEACHER:
	eval players replace("$roomplayers", "Also here: ", ", ")
	eval players replace("%players", " and", ",")
	eval players replace("%players", ".", ", ")
	eval players replacere("%players", " who is kneeling,", ",")
	eval players replacere("%players", " who is lying down,", ",")
	eval players replacere("%players", " who is sitting,", ",")
	eval players replacere("%players", " who is behind a plexus of azure lines,", ",")
	eval players replacere("%players", " who is emanating a benevolent holy aura,", ",")
	eval players replacere("%players", " who is emanating a bright holy aura,", ",")
	eval players replacere("%players", " who is emanating a malevolent holy aura,", ",")
	eval players replacere("%players", " who is in a fiery crimson cage,", ",")
	eval players replacere("%players", " who is in a geometric azure cage,", ",")
	eval players replacere("%players", " who is radiating a glowing aura,", ",")
	eval players replacere("%players", " who is shrouded in ghostly flames,", ",")
	eval players replacere("%players", " who is surrounded by a fiery mantle,", ",")
	eval players replacere("%players", " who is surrounded by a shimmering shield,", ",")
	eval players replacere("%players", " who is surrounded by one circling blade of ice,", ",")
	eval players replacere("%players", " who is surrounded by two circling blades of ice,", ",")
	eval players replacere("%players", " who is surrounded by three circling blades of ice,", ",")
	eval players replacere("%players", " who is surrounded by four circling blades of ice,", ",")
	eval players replacere("%players", " who is surrounded by five circling blades of ice,", ",")
	eval players replacere("%players", " who is enveloped in a hellish inferno,", ",")
	eval players replacere("%players", " who is in a globe of blue fire,", ",")
	eval players replacere("%players", " who is in a crazed black cage,", ",")
	eval players replacere("%players", " who is hiding,", ",")
	eval players replacere("%players", " who has a stony visage,", ",")
     eval players replacere("%players", "Also here\:\s+", "")
     eval players replacere("%players", "Our Lord and Thy\s", "")
     eval players replacere("%players", "Hitler Bad\,\s", "")
     eval players replacere("%players", "\sand", ",")
     eval players replacere("%players", "\swho\b[^,]*,", ",")
     eval players replacere("%players", "([\w'-]+\s){0,5}", "")
     eval players replacere("%players", "\,\s+", "|")
     eval players replacere("%players", "\.", ", ")
	eval players replacere("%players", ", [\w'-]+ ", ", ")
	eval players replacere("%players", ", [\w'-]+ ", ", ")
	eval players replacere("%players", ", [\w'-]+ ", ", ")
	eval players replace("%players", ", ", "|")
	var players %players
	echo players: %players
	eval total count("%players", "|")

TEACH.LOOP:
     pause 0.001
	eval player element("%players", 1)
	eval number count("%players", "|%player")
	var count 0
	gosub TEACHREMOVELOOP
	action setvariable player $1 when ^@.* (\S+)$
	put #parse @%player
	counter set %count
	gosub teach
	if (%players != "|") then goto TEACH.LOOP
	return

TEACHREMOVELOOP:
     pause 0.0001
	eval number count("%players", "|%player|")
	eval players replace("%players", "|%player|", "|")
	eval players replace("%players", "||" "|")
	evalmath count %count + %number
	if !contains("%players", "|%player|") then return
	goto TEACHREMOVELOOP

TEACH:
	pause 0.01
	if (%c = 0) then return
	counter subtract 1
	matchre TEACH ^I could not find who you were referring to|^That person is too busy teaching|^You cannot listen to a teacher and teach at the same time|^You begin to lecture|^You have already offered to teach|is already listening to you|is listening to someone else|is not paying attention to you|is already trying to teach
	matchre NOTEACH ^I don't understand which
	send teach %TeachClass to %player
	matchwait 2
	goto TEACH

NOTEACH:
TEACHDONE:
	return

EMPATHRESEARCH:
EMPATH.RESEARCH:
     put #var skilltrain Magical Research
	timer clear
	timer start
	var forageloop 0
	gosub stowing
     var healthwalk 0
     action (research) on
     gosub CLEAR_MATCHTABLE
     gosub RESEARCH_STOP
     var Research.Active 0
     var Research.Inactive 0
     var breakthroughcount 0
     if ("$guild" = "Cleric") then
          {
               if (($SpellTimer.OsrelMeraud.active = 1) && ($SpellTimer.OsrelMeraud.duration < 75)) then gosub CHARGE_ORB %OM.Mana
          }
     var researchloop 0
     action math researchloop add 1 when Breakthrough\!|^You have abandoned your research project|^You make definite progress in your .+ and decide to take a break|^You decide to stop researching
     pause 0.2
EMPATH.RESEARCH.TRAINING:
     pause 0.1
     pause 0.1
     #if ((%researchloop > 35) && (%breakthroughcount = 3)) then goto EMPATH.RESEARCH.TRAINING.DONE
     if (%breakthroughcount > 1) then goto EMPATH.RESEARCH.TRAINING.DONE
     if (%researchloop > 30) then goto EMPATH.RESEARCH.TRAINING.DONE
     gosub MAGICAL_RESEARCH
     gosub PERCEIVE_TIMER
     if ($UC_Crystal = 1) then gosub CRYSTAL_TIMER
     echo
     echo #########################
     echo *** MAGICAL RESEARCH TRAINING ACTIVE
     echo *** RESEARCH TYPE: %RESEARCH
     echo #########################
     echo
     if ($Outdoorsmanship.LearningRate < 34) then put collect rock
     pause 15
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     if ($Outdoorsmanship.LearningRate < 34) then put collect rock
     pause 15
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     echo
     echo ##########################
     echo *** MAGICAL RESEARCH TRAINING ACTIVE
     echo *** RESEARCH TYPE: %RESEARCH
     echo *** LOOPS: %researchloop / 42(max)
     echo *** BREAKTHROUGHS: %breakthroughcount
     echo *** Active Research: %Research.Active
     echo *** Research Inactive: %Research.Inactive
     echo ##########################
     echo
     pause 0.2
     if ($UC_Crystal = 1) then gosub CRYSTAL_TIMER
     pause 0.1
     if matchre("%APP.ITEMS", "(?i)(ON|1|YES)") then
          {
               if !matchre("%app1", "(?i)(NULL|OFF|^%|^\s*$)") then put app my %app1 careful
               pause
               pause 0.7
               if !matchre("%app2", "(?i)(NULL|OFF|^%|^\s*$)") then put app my %app2
               pause
               pause 0.7
               if !matchre("%app3", "(?i)(NULL|OFF|^%|^\s*$)") then put app my %app3
          }
     if !matchre("%APP.ITEMS", "(?i)(ON|1|YES)") then
          {
               if ($Outdoorsmanship.LearningRate < 34) then put collect rock
               pause 15
               if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
               if ($Outdoorsmanship.LearningRate < 34) then put collect rock
               pause 15
          }
     if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
     math researchloop add 1
     if (%researchloop > 42) then goto EMPATH.RESEARCH.TRAINING.DONE
     goto EMPATH.RESEARCH.TRAINING
EMPATH.RESEARCH.TRAINING.DONE:
     return


FORAGETRAIN:
	put #var skilltrain Forage
	timer clear
	timer start
	var forageloop 0
	gosub stowing
FORAGING:
	if (%t > 500) then goto doneforage
     if ($Outdoorsmanship.LearningRate > 33) then goto doneforage
     if matchre("%abbrevs", "(?i)GAF") then gosub MAGICAL_RESEARCH
	pause 0.01
	pause 0.01
     if (("$righthand" != "Empty") || ("$lefthand" != "Empty")) then
          {
          gosub DUMPSTER_CHECK
          if ("%dumpster" != "NULL") then
               {
                    if ("$righthand" != "Empty") then gosub PUT put my $righthandnoun in %dumpster
                    if ("$lefthand" != "Empty") then gosub PUT put my $lefthandnoun in %dumpster
                    pause 0.001
               }
          if ("%dumpster" = "NULL") then
               {
                    if ("$righthand" != "Empty") then put drop my $righthandnoun
                    if ("$lefthand" != "Empty") then put drop my $lefthandnoun
                    pause 0.4
               }
          }
	pause 0.1
	if matchre("$roomobjs","(pile of coins|pile of coin|pile of rocks|pile of grass)") then gosub KICKEM
	math forageloop add 1
	if (%forageloop > 8) then
				{
					send app my bundle
					wait
					pause
					var forageloop 0
				}
	#if $researching = no then send research $topic 300
	matchre FORAGING \.\.\.wait|type ahead
	matchre KICK.PILE too cluttered
	matchre FORAGING Roundtime
	send collect %Collect
	matchwait

KICK.PILE:
	gosub KICKEM
	goto FORAGING

DONEFORAGE:
	pause 0.01
	pause 0.01
	send kick pile;kick pile
	gosub stowing
	return

FIRSTAIDTRAIN:
	put #var skilltrain FirstAid
	pause 0.001
	pause 0.001
	timer clear
	timer start
     gosub stowing
	gosub EMPATHMAGIC
TRAIN.SCHOLARSHIP:
	pause 0.001
	if (%t > 400) then goto XTRAIN.SCHOLARSHIP
CHARTS1:
	pause 0.001
	pause 0.001
	if (%t > 400) then goto XTRAIN.SCHOLARSHIP
	if (($First_Aid.LearningRate > 32) && ($Scholarship.LearningRate > 32)) then goto XTRAIN.SCHOLARSHIP
     if !matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub GET my %TEXTBOOK.TYPE
     pause 0.4
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub TEXTBOOK_READ normal
     goto TRAIN.SCHOLARSHIP

XTRAIN.SCHOLARSHIP:
	pause 0.1
	pause 0.001
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub PUT put %TEXTBOOK.TYPE in my $UC_Container.Textbook
     if matchre("$righthand $lefthand", "%TEXTBOOK.TYPE") then gosub STOW my %TEXTBOOK.TYPE
	gosub stowing
	return

APPRAISAL:
	pause 0.01
	pause 0.01
	if ($Appraisal.LearningRate > 32) then return
     if matchre("%APP.ITEMS", "(?i)(ON|1|YES)") then
          {
               if !matchre("%app1", "(?i)(NULL|OFF|^%|^\s*$)") then put app my %app1 careful
               pause
               pause 0.2
               if !matchre("%app2", "(?i)(NULL|OFF|^%|^\s*$)") then put app my %app2
               pause
               pause 0.5
               if !matchre("%app3", "(?i)(NULL|OFF|^%|^\s*$)") then put app my %app3
               pause
               pause 0.5
          }
	return

EMPATHMAGIC:
	pause 0.01
	if (($Utility.LearningRate > 32) && ($Warding.LearningRate > 32) and ($Sorcery.LearningRate > 32)) then return
	if ($mana < 40) then return
	pause 0.1
     gosub BUFF_TIMER
     pause 0.1
PICKSPELL:
	var CurrentSpellMana 12
	var CurrentCambMana 5
	var spells |IC|FP|CD|tranquility|$Empath.Sorcery.Spell
	random 1 5
     if ($Augmentation.LearningRate < 20) then var CurrentSpell tranquility
	if ($Utility.LearningRate < 20) then var CurrentSpell CD
	if ($Warding.LearningRate < 20) then var CurrentSpell IC
     if (%SorceryON = 1) then
          {
              if ($Sorcery.LearningRate < 20) then var CurrentSpell $Empath.Sorcery.Spell
          }
     if ($Augmentation.LearningRate < 33) then var CurrentSpell tranquility
	if ($Utility.LearningRate < 33) then var CurrentSpell CD
	if ($Warding.LearningRate < 33) then var CurrentSpell IC
     if (%SorceryON = 1) then
          {
              if ($Sorcery.LearningRate < 33) then var CurrentSpell $Empath.Sorcery.Spell
          }
	if (($Utility.LearningRate > 32) && ($Warding.LearningRate > 32) and ($Sorcery.LearningRate > 32)) then var CurrentSpell %spells(%r)
	pause 0.1
PREPSPELL:
     # if ("%spelltocast", "CD") then var spelllearn Utility
     # if ("%spelltocast", "IC") then var spelllearn Warding
     # if ("%spelltocast", "(?i)tranquility") then var spelllearn Augmentation
     # if ("%spelltocast", "(?i)tailwind") then var spelllearn Sorcery
     # if ("%spelltocast", "(?i)tailwind") then var spelllearn Sorcery
     # if ("%spelltocast", "%Empath.Sorcery.Spell") then var spelllearn Sorcery
     #var CurrentSpell %spelltocast
     if (%Research.Active = 1) then gosub RESEARCH_CANCEL
	if matchre("%CurrentSpell","tranquility|YS") then var manalevel 15
	if matchre("%CurrentSpell","YS") then
		{
			var CurrentSpellMana 15
			var CurrentCambMana 15
		}
     if matchre("%CurrentSpell","(?i)%Magic.Tattoo") then
          {
               put invoke tattoo
               var spellID %Magic.Tattoo
               var CurrentSpell %Magic.Tattoo
               goto PREPSPELL2
          }
     gosub PREPARE %CurrentSpell %CurrentSpellMana
PREPSPELL2:
     pause 16
     put cast;put gesture
     pause 0.4
	return

##################################
####  EMPATHBOT HEAL SUBS   ######
##################################

SELFCLEAR:
	var disease 0
	var poison 0
	return

CUREDISEASE:
	pause 0.001
	pause 0.001
     echo
	echo *** Healing Disease ***
     echo
	gosub SPELL.CAST cd 30
	pause
	gosub SELFCLEAR
	send health
	pause 0.5
     pause 0.6
	if (%disease = 1) then goto CUREDISEASE
	return

FLUSHPOISON:
	pause 0.001
	pause 0.001
     echo
	echo *** Healing Poison ***
	echo
     gosub SPELL.CAST fp 30
	pause
	gosub selfclear
	send health
	pause 0.5
	pause 0.6
	if (%poison = 1) then goto FLUSHPOISON
	return

HEALFATIGUE:
	pause 0.001
     pause 0.001
     echo
	echo *** Casting Refresh to Recover Stamina ***
	echo
     gosub SPELL.CAST refresh 30
	return

HEALVITALITY:
	pause 0.001
     pause 0.001
	echo
     echo *** Boosting Vitality ***
	echo
     gosub SPELL.CAST vh 30
	return

SPELL.CAST:
     var spell $1
	var MANA $2
	pause 0.001
     pause 0.001
     echo
	echo *** Casting %spell at %MANA Mana***
	echo
	if ($mana < 50) then gosub spell.cast.mana
	pause 1
	put prep %spell %MANA
	pause 9
	send cast
	pause 1
	return

SPELL.CAST.MANA:
	pause 0.1
     echo
	echo *** WAITING FOR MANA ***
	echo
     pause 5
	if ($mana > 50) then return
	pause 1
	goto SPELL.CAST.MANA

REGENERATE:
     var regen.mana 5
     if (%Playing = 1) then gosub STOP_PLAY
     if ($Utility.Ranks < 300) then var regen.mana 5
     if (($Utility.Ranks >= 300) && ($Utility.Ranks < 400)) then var regen.mana 7
     if (($Utility.Ranks >= 400) && ($Utility.Ranks < 500)) then var regen.mana 9
     if (($Utility.Ranks >= 500) && ($Utility.Ranks < 700)) then var regen.mana 11
     if (($Utility.Ranks >= 700) && ($Utility.Ranks < 900)) then var regen.mana 18
     if ($Utility.Ranks >= 900) then var regen.mana 22
	pause 0.01
     pause 0.0001
	matchre REGEN.RELEASE already preparing
	matchre REGEN.PAUSE With .+ movements you prepare your body
	send prep regen %regen.mana
	matchwait 5
	goto REGENERATE
REGEN.RELEASE:
	send release all
	matchwait 2
	goto REGENERATE
REGEN.PAUSE:
     pause 0.1
	send perc
	pause 2
     pause 0.1
     send perc health
	pause 12
	goto REGEN.CAST
REGEN.CAST:
     pause 0.0001
	matchre REGENERATE You don't have a spell prepared!
	matchre REGEN.RELEASE Maintaining two cyclic spells at once is beyond your mental comprehension
	matchre RETURN Rutilant sparks of light encircle you|bathing you in a warm glow
	send cast
	matchwait 8
	goto REGEN.CAST

HEAL:
     var heal.mana 5
     if (%Playing = 1) then gosub STOP_PLAY
     if ($Utility.Ranks < 240) then var heal.mana 15
     if (($Utility.Ranks > 240) && ($Utility.Ranks <= 400)) then var heal.mana 20
     if (($Utility.Ranks > 400) && ($Utility.Ranks <= 600)) then var heal.mana 23
     if (($Utility.Ranks > 600) && ($Utility.Ranks <= 750)) then var heal.mana 27
     if (($Utility.Ranks > 750) && ($Utility.Ranks <= 900)) then var heal.mana 32
     if (($Utility.Ranks > 900) && ($Utility.Ranks <= 1000)) then var heal.mana 40
     if ($Utility.Ranks > 1000) then var heal.mana 50
	pause 0.01
     pause 0.0001
	matchre HEAL.RELEASE already preparing
	matchre HEAL.PAUSE With tense movements you prepare your body
	send prep heal %heal.mana
	matchwait 5
	goto HEAL
HEAL.RELEASE:
	send release all
	matchwait 2
	goto HEAL
HEAL.PAUSE:
     pause 0.1
	send perc
	pause 2
     pause 0.1
     send perc health
	pause 12
	goto HEAL.CAST
HEAL.CAST:
     pause 0.0001
	matchre HEAL You don't have a spell prepared!
	matchre HEAL.RELEASE Maintaining two cyclic spells at once is beyond your mental comprehension
	matchre RETURN ^A wave of feverish heat settles into your flesh|A prickly stinging steals through your body
	send cast
	matchwait 8
	goto HEAL.CAST

#### END OF THE THE MOTHERFUCKING SCRIPT!